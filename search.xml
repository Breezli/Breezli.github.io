<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>pnpm dev çš„èƒŒåï¼ˆviteæ„å»ºï¼‰</title>
      <link href="/2025/09/07/%E5%B7%A5%E5%85%B7/Vite%E6%9E%84%E5%BB%BA%E7%9A%84%E8%83%8C%E5%90%8E/"/>
      <url>/2025/09/07/%E5%B7%A5%E5%85%B7/Vite%E6%9E%84%E5%BB%BA%E7%9A%84%E8%83%8C%E5%90%8E/</url>
      
        <content type="html"><![CDATA[<h2 id="pnpm-dev-æ‰§è¡Œå¯åŠ¨å‘½ä»¤"><a href="#pnpm-dev-æ‰§è¡Œå¯åŠ¨å‘½ä»¤" class="headerlink" title="pnpm dev (æ‰§è¡Œå¯åŠ¨å‘½ä»¤)"></a>pnpm dev (æ‰§è¡Œå¯åŠ¨å‘½ä»¤)</h2><p>æ‰§è¡Œ <code>pnpm dev</code> æ—¶ï¼Œpnpm åŒ…ç®¡ç†å™¨ä¼šæŸ¥æ‰¾ <code>package.json</code> ä¸­ <code>scripts</code> ä¸‹çš„ <code>dev</code> å‘½ä»¤å¹¶æ‰§è¡Œå®ƒï¼ˆé€šå¸¸æ˜¯ <code>vite</code> &#x2F; <code>vite serve</code>ï¼‰</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™å®é™…ä¸Šè°ƒç”¨äº† Vite çš„äºŒè¿›åˆ¶æ–‡ä»¶ <code>node_modules/.bin/vite</code>ï¼ˆè¿™ä¸ªä¼šå¼•è¿åˆ° Vite çš„ CLI æ¨¡å— <code>vite/src/node/cli.ts</code>ï¼‰</p><p>Â Â  æ¥ç€</p><p>Â Â  CLI æ¨¡å—ä½¿ç”¨ <code>[cac](https://github.com/cacjs/cac)</code> åº“æ¥è§£æå‘½ä»¤è¡Œå‚æ•°ï¼ˆå¦‚ <code>--port</code>ã€<code>--open</code>ï¼‰</p><p>Â Â  å¹¶æ ¹æ®å‘½ä»¤ï¼ˆ<code>serve</code>, <code>build</code>, <code>preview</code>ï¼‰</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-tsc -b &amp;&amp; vite build&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;preview&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite preview&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>Â Â  åˆ›å»ºç›¸åº”çš„ Vite å¼€å‘æœåŠ¡å™¨æˆ–æ‰§è¡Œæ„å»º</p></blockquote><h2 id="ç¡®å®š-vite-å¯åŠ¨æ—¶æ¨¡å¼ï¼ˆmodeï¼‰"><a href="#ç¡®å®š-vite-å¯åŠ¨æ—¶æ¨¡å¼ï¼ˆmodeï¼‰" class="headerlink" title="ç¡®å®š vite å¯åŠ¨æ—¶æ¨¡å¼ï¼ˆmodeï¼‰"></a>ç¡®å®š vite å¯åŠ¨æ—¶æ¨¡å¼ï¼ˆmodeï¼‰</h2><p>Vite åœ¨å¯åŠ¨æ—¶ï¼Œä¼šé¦–å…ˆç¡®å®šå½“å‰çš„è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤ä¸º <code>development</code>ï¼ˆå¼€å‘ï¼‰</p><p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ‰‹åŠ¨æŒ‡å®šæ¨¡å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vite --mode production</span><br><span class="line">vite --mode <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œæ¨¡å¼å†³å®šäº† Vite åŠ è½½å“ªäº›</strong> <strong><code>.env</code></strong> <strong>ç¯å¢ƒå˜é‡æ–‡ä»¶</strong></p><h3 id="åŠ è½½-envæ–‡ä»¶"><a href="#åŠ è½½-envæ–‡ä»¶" class="headerlink" title="åŠ è½½.envæ–‡ä»¶"></a>åŠ è½½.envæ–‡ä»¶</h3><p>éšåï¼ŒæŒ‰ç…§ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾å’ŒåŠ è½½ç¯å¢ƒå˜é‡æ–‡ä»¶</p><ol><li><p><code>.env.$&#123;mode&#125;.local</code> ï¼ˆå¦‚ <code>.env.development.local</code>ï¼‰(<strong>æœ€é«˜ä¼˜å…ˆçº§ï¼Œä¸”ä¸ä¼šæäº¤åˆ° git [<em>.gitignore</em>]</strong>)</p></li><li><p><code>.env.$&#123;mode&#125;</code>ï¼ˆå¦‚ <code>.env.d</code>ï¼‰</p></li><li><p><code>.env.local</code></p></li><li><p><code>.env</code> ï¼ˆå…¨å±€é»˜è®¤é…ç½®ï¼‰</p></li></ol><p>root &#x2F; env.d.ts</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">PROD</span>: <span class="built_in">boolean</span>;</span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">DEV</span>: <span class="built_in">boolean</span>;</span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">TEST</span>: <span class="built_in">boolean</span>;</span><br></pre></td></tr></table></figure><p><strong>æ‰€æœ‰å˜é‡éƒ½ä¼šè¢«æ³¨å…¥åˆ° Node.js çš„</strong> <strong><code>process.env</code></strong> ä¸­**ï¼ˆ<code>process</code> æ˜¯ Node.js çš„å…¨å±€å¯¹è±¡ï¼Œæ‰€ä»¥ä»…åœ¨æœåŠ¡ç«¯ç”Ÿæ•ˆï¼‰</p><blockquote><p>æ’æ’­ï¼š<strong>Node.js çš„ process.env æ˜¯ä¸ªå•¥</strong></p><p>Â Â å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ JS å¯¹è±¡ï¼Œè€Œ <code>env</code> å®ƒæ˜¯ <code>process</code> çš„ä¸€ä¸ªå±æ€§ï¼Œä¸“é—¨å­˜ç¯å¢ƒå˜é‡</p><p>Â Â å®ƒå¤§æ¦‚æ˜¯è¿™æ ·çš„ğŸ‘‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(process.env);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    NODE_ENV: &#x27;development&#x27;,</span><br><span class="line">    PORT: &#x27;3000&#x27;,</span><br><span class="line">    DATABASE_URL: &#x27;postgresql://localhost:5432/mydb&#x27;,</span><br><span class="line">    VITE_API_URL: &#x27;https://dev-api.example.com&#x27;,</span><br><span class="line">    SECRET_KEY: &#x27;abcdefg123456&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Â Â ä½ å¯ä»¥æŠŠå®ƒçœ‹æˆ <strong>NodeJS</strong> çš„å¤‡å¿˜å½•ï¼Œå­˜ç€ç¯å¢ƒï¼Œç«¯å£ï¼Œæ¥å£ï¼Œå¯†é’¥ç­‰æ•°æ®</p></blockquote><p>å¥½äº†ç°åœ¨å›å½’æ­£é¢˜</p><blockquote><p>æ¯”å¦‚æˆ‘åœ¨æŸæ–‡ä»¶éœ€è¦çŸ¥é“è¿™äº›å‚æ•°æ¥åˆ¤æ–­å½“å‰çš„è¿è¡Œç¯å¢ƒğŸ‘‡ï¼ˆæˆ‘åœ¨buildè„šæœ¬æ–‡ä»¶ç”¨çš„æœ€å¤šï¼‰</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isProd = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> <span class="comment">// ç”Ÿäº§ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">const</span> isDev = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span> <span class="comment">// å¼€å‘ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">const</span> isTest = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;test&#x27;</span> <span class="comment">// æµ‹è¯•ç¯å¢ƒ</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">terser</span>(&#123; <span class="comment">// å‹ç¼©JSçš„æ’ä»¶</span></span><br><span class="line">        <span class="attr">compress</span>: &#123;</span><br><span class="line">            <span class="attr">sequences</span>: isProd, <span class="comment">// ç”Ÿäº§ç¯å¢ƒä¸‹åˆ é™¤è¿ç»­è¯­å¥</span></span><br><span class="line">            <span class="attr">arguments</span>: isProd, <span class="comment">// ç”Ÿäº§ç¯å¢ƒä¸‹åˆ é™¤å‡½æ•°å‚æ•°</span></span><br><span class="line">            <span class="attr">drop_console</span>: isProd &amp;&amp; [<span class="string">&#x27;log&#x27;</span>], <span class="comment">// ç”Ÿäº§ç¯å¢ƒä¸‹åˆ é™¤ console.log è¯­å¥</span></span><br><span class="line">            <span class="attr">drop_debugger</span>: isProd, <span class="comment">// ç”Ÿäº§ç¯å¢ƒä¸‹åˆ é™¤ debugger è¯­å¥</span></span><br><span class="line">            <span class="attr">passes</span>: isProd ? <span class="number">4</span> : <span class="number">1</span>, <span class="comment">// ç”Ÿäº§ç¯å¢ƒä¸‹è¿›è¡Œ 4 æ¬¡å‹ç¼©ï¼Œå¼€å‘ç¯å¢ƒä¸‹è¿›è¡Œ 1 æ¬¡å‹ç¼©</span></span><br><span class="line">            <span class="attr">global_defs</span>: &#123; <span class="comment">// å®šä¹‰å…¨å±€å˜é‡ï¼Œç”¨äºåœ¨å‹ç¼©ä»£ç æ—¶è¿›è¡Œæ¡ä»¶ç¼–è¯‘</span></span><br><span class="line">                <span class="string">&#x27;@DEV&#x27;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isDev),</span><br><span class="line">                <span class="string">&#x27;@PROD&#x27;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isProd),</span><br><span class="line">                <span class="string">&#x27;@TEST&#x27;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isTest),</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        ......</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p><strong>ä½†æ˜¯ï¼è¿™äº›å˜é‡ä¸èƒ½æš´éœ²ç»™æµè§ˆå™¨</strong>ï¼Œä¸ç„¶ä»»ä½•è®¿é—®ä½ ç½‘ç«™çš„äººF12å°±èƒ½çœ‹åˆ°æ•°æ®åº“å¯†ç ã€API ç§˜é’¥ç­‰â€¦â€¦</p><h3 id="è¿‡æ»¤å‡º-VITE-å¼€å¤´çš„å˜é‡"><a href="#è¿‡æ»¤å‡º-VITE-å¼€å¤´çš„å˜é‡" class="headerlink" title="è¿‡æ»¤å‡º VITE_ å¼€å¤´çš„å˜é‡"></a>è¿‡æ»¤å‡º VITE_ å¼€å¤´çš„å˜é‡</h3><blockquote><p>åªæœ‰ä»¥ <code>VITE_</code> ä¸ºå‰ç¼€çš„å˜é‡æ‰ä¼šé€šè¿‡ <code>import.meta.env</code> æš´éœ²ç»™ä½ çš„å®¢æˆ·ç«¯æºç  ï¼ˆçœ‹ä¸Šé¢çš„ä¾‹å­ï¼Œæ¯”å¦‚æ˜¯ <code>VITE_API_URL</code>ï¼‰</p><p>Â Â ï¼ˆVite å†…éƒ¨ä¼šå¯¹æ­¤åšç­›é€‰ï¼Œç±»ä¼¼äºä»¥ä¸‹è¿™æ ·ï¼‰</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> clientEnv = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(process.<span class="property">env</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key.<span class="title function_">startsWith</span>(<span class="string">&#x27;VITE_&#x27;</span>)) &#123;</span><br><span class="line">        clientEnv[key] = value  <span class="comment">// åªä¿ç•™ VITE_ å¼€å¤´çš„</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Â Â ç„¶åï¼ŒVite æŠŠè¿™ä¸ª <code>clientEnv</code> å¯¹è±¡æ³¨å…¥åˆ°å‰ç«¯ä»£ç ä¸­ï¼Œå˜æˆ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_API_URL</span>  <span class="comment">// å¯è®¿é—®</span></span><br><span class="line"><span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">DB_PASSWORD</span>   <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="æ³¨å…¥import-meta-envåˆ°å®¢æˆ·ç«¯"><a href="#æ³¨å…¥import-meta-envåˆ°å®¢æˆ·ç«¯" class="headerlink" title="æ³¨å…¥import.meta.envåˆ°å®¢æˆ·ç«¯"></a>æ³¨å…¥import.meta.envåˆ°å®¢æˆ·ç«¯</h3><blockquote><p><code>import.meta.env</code> å°±æ˜¯ç”± <code>process.env</code> ç­›å‡ºæ¥çš„ï¼Œæ‰€ä»¥å’Œ <code>process.env</code> ä¸€æ ·ï¼Œ<code>import.meta.env</code> ä½œä¸º<strong>å®¢æˆ·ç«¯</strong>çš„å¤‡å¿˜å½•</p></blockquote><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>å¯¹æ¯”</td><td><code>process.env</code></td><td><code>import.meta.env</code></td></tr><tr><td><strong>è¿è¡Œç¯å¢ƒ</strong></td><td>Node.jsï¼ˆæœåŠ¡ç«¯ï¼‰</td><td>æµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰</td></tr><tr><td><strong>ä½¿ç”¨ä½ç½®</strong></td><td>Vite æœåŠ¡å™¨ã€æ„å»ºè„šæœ¬</td><td>Vue&#x2F;React ç»„ä»¶</td></tr><tr><td><strong>å€¼å®šä¹‰åœ¨</strong></td><td><code>.env</code> æ–‡ä»¶ + æ“ä½œç³»ç»Ÿ</td><td>Vite ç­›é€‰å¹¶æ³¨å…¥</td></tr><tr><td><strong>å˜é‡èŒƒå›´</strong></td><td>æ‰€æœ‰å˜é‡</td><td>åªèƒ½è®¿é—® <code>VITE_</code> å¼€å¤´çš„</td></tr></tbody></table><h2 id="é…ç½®è§£æä¸åˆå¹¶"><a href="#é…ç½®è§£æä¸åˆå¹¶" class="headerlink" title="é…ç½®è§£æä¸åˆå¹¶"></a>é…ç½®è§£æä¸åˆå¹¶</h2><blockquote><p>å›å½’ä¸»çº¿ï¼Œå¤„ç†å®Œç¯å¢ƒå˜é‡ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯åˆå¹¶é…ç½®</p></blockquote><p>Vite ä¼š<strong>åˆå¹¶&amp;å¤„ç†ä»¥ä¸‹çš„é…ç½®</strong>ï¼Œ<strong>ç”Ÿæˆæœ€ç»ˆçš„æ„å»ºé…ç½®å¯¹è±¡</strong></p><h3 id="å‘½ä»¤è¡Œï¼ˆCLIï¼‰"><a href="#å‘½ä»¤è¡Œï¼ˆCLIï¼‰" class="headerlink" title="å‘½ä»¤è¡Œï¼ˆCLIï¼‰"></a>å‘½ä»¤è¡Œï¼ˆCLIï¼‰</h3><p>é¡¹ç›®è®¾ç½®çš„<strong>å‘½ä»¤è¡Œå‚æ•°</strong>ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰</p><p>ä¾‹å¦‚ <code>vite --port 5000 --open --host</code>ï¼ŒVite ä¼šæŠŠè¿™äº›å»ºè®®è§£ææˆä¸€ä¸ªå¯¹è±¡ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cliOptions = &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">5000</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">host</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="defineConfig"><a href="#defineConfig" class="headerlink" title="defineConfig"></a>defineConfig</h3><p>Vite è¯»å–å¹¶æ‰§è¡Œ vite.config.tsï¼Œè·å–å¯¼å‡ºçš„ <strong><code>defineConfig</code></strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [<span class="title function_">vue</span>()],</span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">        <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">        <span class="attr">open</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç»“æœä¹Ÿå°±æ˜¯</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> configFromFile = &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [vuePlugin],</span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">        <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">        <span class="attr">open</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆå¹¶"><a href="#åˆå¹¶" class="headerlink" title="åˆå¹¶"></a>åˆå¹¶</h3><p>Vite ä¼šæŠŠ<strong>ä¸¤è€…åˆå¹¶</strong>ï¼Œ<strong>CLI ä¼˜å…ˆçº§æ›´é«˜</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mergedConfig = &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [vuePlugin],</span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">        <span class="attr">port</span>: <span class="number">5000</span>,</span><br><span class="line">        <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">host</span>: <span class="literal">true</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="config-é’©å­"><a href="#config-é’©å­" class="headerlink" title="config é’©å­"></a>config é’©å­</h3><p>åœ¨æœ€ç»ˆé…ç½®ç¡®å®šå‰ï¼Œæ’ä»¶å¯ä»¥é€šè¿‡æ’ä»¶çš„ <code>config</code> é’©å­ä¿®æ”¹é…ç½®ï¼ˆå’Œ <code>axios</code> çš„äºŒæ¬¡å°è£…æ˜¯ä¸€ä¸ªé“ç†ï¼Œä¼šåˆå¹¶ä½ çš„é…ç½®ï¼‰</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªå®šä¹‰æ’ä»¶</span></span><br><span class="line"><span class="keyword">const</span> myPlugin = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;my-plugin&#x27;</span>,</span><br><span class="line">    <span class="title function_">config</span>(<span class="params">config, env</span>) &#123; <span class="comment">// config é’©å­ï¼›config å·²ç»æ˜¯å½“å‰åˆå¹¶åçš„é…ç½®ï¼›env å°±æ˜¯ä¹‹å‰è¯´çš„å¤‡å¿˜å½•ï¼ˆprocess.envï¼‰</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½“å‰ mode:&#x27;</span>, env.<span class="property">mode</span>) <span class="comment">// &#x27;development&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="comment">// ä¿®æ”¹é…ç½®ï¼ˆäºŒæ¬¡å°è£…ï¼‰</span></span><br><span class="line">            <span class="attr">server</span>: &#123;</span><br><span class="line">                ...config.<span class="property">server</span>, <span class="comment">// å±•å¼€å·²æœ‰ server é…ç½®</span></span><br><span class="line">                <span class="attr">proxy</span>: &#123; <span class="comment">// æ–°å¢ proxy</span></span><br><span class="line">                    <span class="string">&#x27;/api&#x27;</span>: <span class="string">&#x27;http://localhost:8080&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">define</span>: &#123; <span class="comment">// æ–°å¢å…¨å±€å¸¸é‡</span></span><br><span class="line">                <span class="attr">__MY_APP_VERSION__</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&#x27;1.0.0&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®ç»“æœæ˜¯</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> afterPluginConfig = &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [vuePlugin],</span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">        <span class="attr">port</span>: <span class="number">5000</span>,</span><br><span class="line">        <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">host</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">proxy</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;/api&#x27;</span>: <span class="string">&#x27;http://localhost:8080&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">define</span>: &#123;</span><br><span class="line">        <span class="attr">__MY_APP_VERSION__</span>: <span class="string">&#x27;&quot;1.0.0&quot;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¹¶ä¸”è¿™ä¸ªæœ€ç»ˆçš„é…ç½®å¯¹è±¡ä¼šè¢«<strong>å†»ç»“ï¼ˆfrozenï¼‰</strong>ï¼Œé˜²æ­¢åç»­è¢«ä¿®æ”¹</p></blockquote><h3 id="configResolved-é’©å­"><a href="#configResolved-é’©å­" class="headerlink" title="configResolved é’©å­"></a>configResolved é’©å­</h3><p>åœ¨é…ç½®ç¡®å®šåï¼Œæ’ä»¶å¯ä»¥æ ¹æ®æ’ä»¶çš„ <code>configResolved</code> é’©å­è¯»å–å­˜å‚¨æœ€ç»ˆè§£æçš„é…ç½®ï¼ˆåªè¯»ï¼‰</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myPlugin = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;my-plugin&#x27;</span>,</span><br><span class="line">    <span class="title function_">config</span>(<span class="params">config, env</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½“å‰ mode:&#x27;</span>, env.<span class="property">mode</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">server</span>: &#123;</span><br><span class="line">                ...config.<span class="property">server</span>,</span><br><span class="line">                <span class="attr">proxy</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;/api&#x27;</span>: <span class="string">&#x27;http://localhost:8080&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">define</span>: &#123;</span><br><span class="line">                <span class="attr">__MY_APP_VERSION__</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&#x27;1.0.0&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">configResolved</span>(<span class="params">resolvedConfig</span>) &#123; <span class="comment">// configResolved é’©å­ï¼ˆåªè¯»ï¼‰ï¼›resolvedConfig å°±æ˜¯æœ€ç»ˆç¡®å®šçš„é…ç½®</span></span><br><span class="line">        <span class="keyword">const</span> &#123; server, define, plugins &#125; = resolvedConfig <span class="comment">// è§£æ„èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (server.<span class="property">port</span> === <span class="number">5000</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æœåŠ¡å™¨åœ¨ 5000 ç«¯å£å¯åŠ¨&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (define.<span class="property">__MY_APP_VERSION__</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">version</span> = define.<span class="property">__MY_APP_VERSION__</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸èƒ½ä¿®æ”¹</span></span><br><span class="line">        <span class="comment">// resolvedConfig.server.port = 6000 // æ— æ•ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ’ä»¶ç³»ç»Ÿåˆå§‹åŒ–ä¸æ„å»º"><a href="#æ’ä»¶ç³»ç»Ÿåˆå§‹åŒ–ä¸æ„å»º" class="headerlink" title="æ’ä»¶ç³»ç»Ÿåˆå§‹åŒ–ä¸æ„å»º"></a>æ’ä»¶ç³»ç»Ÿåˆå§‹åŒ–ä¸æ„å»º</h2><p><strong>Vite çš„åŠŸèƒ½å‡ ä¹éƒ½ç”±æ’ä»¶æä¾›</strong>ï¼ˆåŒ…æ‹¬å†…ç½®æ’ä»¶ï¼‰</p><p>è€Œè¿™äº›æ’ä»¶å°±ä¼šæ¶‰åŠåˆ°<strong>æ’åºå…ˆè¡Œ</strong>çš„é—®é¢˜ï¼Œviteå†…éƒ¨è§„å®šäº†ä»€ä¹ˆæ’ä»¶åº”è¯¥ä¼˜å…ˆæ‰§è¡Œè§£æ</p><h3 id="æ’ä»¶æ’åº"><a href="#æ’ä»¶æ’åº" class="headerlink" title="æ’ä»¶æ’åº"></a>æ’ä»¶æ’åº</h3><h4 id="æ’åºé€»è¾‘"><a href="#æ’åºé€»è¾‘" class="headerlink" title="æ’åºé€»è¾‘"></a>æ’åºé€»è¾‘</h4><p>æ’ä»¶ä¼šæ ¹æ® <code>enforce</code> å±æ€§æ’åºæ‰§è¡Œ</p><ul><li><p><strong><code>enforce: &#39;pre&#39;</code></strong>ï¼šåœ¨ Vite <strong>æ ¸å¿ƒæ’ä»¶ä¹‹å‰</strong>è°ƒç”¨ã€<em>ä»£ç è½¬æ¢æ’ä»¶ï¼Œåˆ«åå¤„ç†æ’ä»¶ â€¦</em>ã€‘</p>  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> react <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-react&#x27;</span> <span class="comment">// ä½œç”¨ï¼šè§£æåˆ«åã€ä»£ç è½¬æ¢ã€é‡å†™å¯¼å…¥è·¯å¾„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">react</span>() <span class="comment">// å†…éƒ¨ enforce: &#x27;pre&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>  Â Â &gt; <code>.jsx</code> æ–‡ä»¶éœ€è¦å…ˆè½¬æˆ <code>.js</code> æ–‡ä»¶ Vite æ ¸å¿ƒæ‰èƒ½è¯†åˆ«ï¼Œ<code>react</code> è¦ç¡®ä¿åœ¨ <code>.jsx</code> æ–‡ä»¶è¢«è§£æå‰å…ˆå¤„ç† JSX è¯­æ³•</p></li><li><p><strong>æ— </strong> <code>enforce**</code>ï¼ˆé»˜è®¤ï¼‰ï¼šåœ¨ Vite <strong>æ ¸å¿ƒæ’ä»¶ä¹‹å</strong>è°ƒç”¨ã€<em>å¤§å¤šæ•°æ’ä»¶ â€¦</em>ã€‘</p>  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span> <span class="comment">// ä½œç”¨ï¼šæŠŠ&lt;template&gt;ç¼–è¯‘æˆrenderå‡½æ•°ã€æå–&lt;script&gt;ã€æ³¨å…¥HMRä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">vue</span>() <span class="comment">// é»˜è®¤é¡ºåºï¼Œæ—  enforce</span></span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>  Â Â &gt; å› ä¸ºå®ƒå¤„ç†çš„æ˜¯å·²ç»è¢«åˆ†å¥½çš„å• <code>.vue</code> æ–‡ä»¶å­è¯·æ±‚ï¼Œå¿…é¡»åœ¨æ ¸å¿ƒæ’ä»¶ä¹‹å</p></li><li><p><strong><code>enforce: &#39;post&#39;</code></strong>ï¼šåœ¨ Vite <strong>æ„å»ºæ’ä»¶ä¹‹å</strong>è°ƒç”¨ã€<em>æ‰“åŒ…åå¤„ç†æ’ä»¶ï¼Œç”ŸæˆæŠ¥å‘Šæ’ä»¶ â€¦</em>ã€‘</p>  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; visualizer &#125; <span class="keyword">from</span> <span class="string">&#x27;rollup-plugin-visualizer&#x27;</span> <span class="comment">// ä½œç”¨ï¼šæ‰“åŒ…åå¤„ç†ï¼ˆå‹ç¼©ã€æ··æ·†ç­‰ï¼‰ã€ç”ŸæˆæŠ¥å‘Š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">vue</span>(),</span><br><span class="line">        <span class="title function_">visualizer</span>(&#123;</span><br><span class="line">            <span class="attr">open</span>: <span class="literal">true</span></span><br><span class="line">        &#125;) <span class="comment">// é»˜è®¤ enforce: &#x27;post&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>  Â Â &gt; <code>visualizer</code> æ’ä»¶éœ€è¦ç­‰æ‰€æœ‰ä»£ç æ‰“åŒ…å®Œæˆåï¼Œæ‰èƒ½åˆ†ææœ€ç»ˆçš„ bundle å¤§å°</p></li></ul><blockquote><p>è¿™ä¸€å—ç”±äºåŠ äº†ç»†èŠ‚å†™çš„æœ‰ç‚¹ä¹±ï¼Œå¯ä»¥å…ˆçœ‹çœ‹ä¸‹é¢çš„ æ€»ç»“</p></blockquote><h4 id="æŒ‡å®šæ¨¡å¼"><a href="#æŒ‡å®šæ¨¡å¼" class="headerlink" title="æŒ‡å®šæ¨¡å¼"></a>æŒ‡å®šæ¨¡å¼</h4><p>æ’ä»¶è¿˜å¯ä»¥é€šè¿‡ <code>apply</code> æŒ‡å®šåªåœ¨ç‰¹å®šæ¨¡å¼ä¸‹ç”Ÿæ•ˆ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apply</span>: <span class="string">&#x27;serve&#x27;</span>     <span class="comment">// åªåœ¨å¼€å‘æ¨¡å¼ï¼ˆdevï¼‰å¯ç”¨</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mockPlugin = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;vite-plugin-mock&#x27;</span>,</span><br><span class="line">    <span class="attr">apply</span>: <span class="string">&#x27;serve&#x27;</span>, <span class="comment">// åªåœ¨ pnpm dev æ—¶ç”Ÿæ•ˆ</span></span><br><span class="line">    <span class="title function_">configureServer</span>(<span class="params">server</span>) &#123;</span><br><span class="line">        <span class="comment">// åœ¨å¼€å‘æœåŠ¡å™¨ä¸Šæ³¨å†Œ mock æ¥å£</span></span><br><span class="line">        server.<span class="property">middlewares</span>.<span class="title function_">use</span>(<span class="string">&#x27;/api/users&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">            res.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>([&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span> &#125;]))</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apply</span>: <span class="string">&#x27;build&#x27;</span>     <span class="comment">// åªåœ¨æ„å»ºæ¨¡å¼å¯ç”¨</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> compressPlugin = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;vite-plugin-compress&#x27;</span>,</span><br><span class="line">    <span class="attr">apply</span>: <span class="string">&#x27;build&#x27;</span>, <span class="comment">// åªåœ¨ pnpm build æ—¶ç”Ÿæ•ˆ</span></span><br><span class="line">    <span class="title function_">closeBundle</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// æ„å»ºå®Œæˆåï¼Œå¯¹ dist ç›®å½•è¿›è¡Œ gzip å‹ç¼©</span></span><br><span class="line">        <span class="title function_">execSync</span>(<span class="string">&#x27;gzip -r dist/&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>ç±»å‹</td><td><code>enforce</code></td><td>å…¸å‹ç”¨é€”</td><td>çœŸå®ä¾‹å­</td></tr><tr><td>é¢„å¤„ç†</td><td><code>&#39;pre&#39;</code></td><td>è·¯å¾„è§£æã€è¯­æ³•è½¬æ¢</td><td><code>@vitejs/plugin-react</code></td></tr><tr><td>æ™®é€šå¤„ç†</td><td>é»˜è®¤</td><td>ç»„ä»¶ç¼–è¯‘ã€èµ„æºå¤„ç†</td><td><code>@vitejs/plugin-vue</code></td></tr><tr><td>åå¤„ç†</td><td><code>&#39;post&#39;</code></td><td>æ‰“åŒ…åˆ†æã€å‹ç¼©</td><td><code>rollup-plugin-visualizer</code></td></tr><tr><td>æ¨¡å¼æ§åˆ¶</td><td><code>apply: &#39;serve&#39;</code></td><td>å¼€å‘ä¸“ç”¨åŠŸèƒ½</td><td>Mock æ’ä»¶</td></tr><tr><td>æ¨¡å¼æ§åˆ¶</td><td><code>apply: &#39;build&#39;</code></td><td>æ„å»ºä¼˜åŒ–</td><td>Gzip å‹ç¼©æ’ä»¶</td></tr></tbody></table><h2 id="ä¾èµ–é¢„æ„å»º"><a href="#ä¾èµ–é¢„æ„å»º" class="headerlink" title="ä¾èµ–é¢„æ„å»º"></a>ä¾èµ–é¢„æ„å»º</h2><p>Vite çš„å¼€å‘æœåŠ¡å™¨åŸºäº <strong>ESModule</strong>ï¼Œå®ç°äº†çœŸæ­£çš„æŒ‰éœ€ç¼–è¯‘ï¼Œä½†å¾ˆå¤š npm åŒ…è¿˜æ˜¯ CommonJSï¼ˆCJSï¼‰æ ¼å¼</p><p>ä¸ºäº†è§£å†³å…¼å®¹æ€§å’Œæ€§èƒ½é—®é¢˜ï¼Œvite ä¼šè¿›è¡Œ<strong>ä¾èµ–é¢„æ„å»º</strong>ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¼˜åŒ–ğŸ‘‡</p><ul><li><p><strong>å…¼å®¹æ€§</strong>ï¼šå°† CommonJS æˆ– UMD æ ¼å¼çš„ä¾èµ–é¡¹è½¬æ¢ä¸º ESM æ ¼å¼ï¼Œä»¥ä¾¿åœ¨æµè§ˆå™¨ä¸­é€šè¿‡ <code>&lt;script type=&quot;module&quot;&gt;</code> æ­£å¸¸åŠ è½½</p></li><li><p><strong>æ€§èƒ½</strong>ï¼šå°†æœ‰è®¸å¤šå†…éƒ¨æ¨¡å—çš„ ESM ä¾èµ–é¡¹ï¼ˆå¦‚ lodash-esï¼‰è½¬æ¢ä¸ºå•ä¸ªæ¨¡å—ï¼Œå‡å°‘æµè§ˆå™¨éœ€è¦å‘å‡ºçš„ HTTP è¯·æ±‚æ•°</p></li></ul><p><strong>é¢„æ„å»ºåçš„ä¾èµ–ä¼šè¢«ç¼“å­˜åˆ°</strong> <strong><code>node_modules/.vite</code></strong> <strong>ç›®å½•ä¸‹</strong></p><blockquote><p>è¿™æ˜¯ vite å¯åŠ¨å¿«çš„ä¸€ä¸ªåŸå› ï¼Œå®ƒåªå¤„ç†ä½ è‡ªå·±å†™çš„ä»£ç ï¼Œä¾èµ–é¡¹å·²ç»â€œé¢„æ‰“åŒ…â€å¥½äº†</p></blockquote><h2 id="å»ºç«‹å¼€å‘æœåŠ¡å™¨"><a href="#å»ºç«‹å¼€å‘æœåŠ¡å™¨" class="headerlink" title="å»ºç«‹å¼€å‘æœåŠ¡å™¨"></a>å»ºç«‹å¼€å‘æœåŠ¡å™¨</h2><blockquote><p>Vite ä½¿ç”¨ <strong>Connect</strong> ä½œä¸ºåº•å±‚æ¡†æ¶ï¼Œåˆ›å»ºä¸€ä¸ªå¼€å‘æœåŠ¡å™¨</p></blockquote><p>å¯ç”¨åŠŸèƒ½ï¼š</p><ul><li><p>ç›‘å¬æŒ‡å®šç«¯å£ï¼ˆå¦‚ <code>localhost:3000</code>ï¼‰</p></li><li><p>å¤„ç†æ‰€æœ‰é™æ€èµ„æºè¯·æ±‚ï¼ˆHTMLã€JSã€CSSã€å›¾ç‰‡ç­‰ï¼‰</p></li><li><p>å¯åŠ¨ <strong>WebSocket</strong>ï¼Œç”¨äº HMRï¼ˆçƒ­æ›´æ–°ï¼‰</p>  <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ªä»£ç </span></span><br><span class="line"><span class="keyword">const</span> server =  <span class="title function_">connect</span>()</span><br><span class="line">server.<span class="title function_">use</span>(<span class="title function_">serveStatic</span>())</span><br><span class="line">server.<span class="title function_">use</span>(handleModuleRequest) <span class="comment">// å¤„ç† .vue, .ts ç­‰</span></span><br><span class="line"><span class="title function_">createWebSocketServer</span>() <span class="comment">// ç”¨äº HMR</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="æ³¨å…¥ä¸­é—´ä»¶"><a href="#æ³¨å…¥ä¸­é—´ä»¶" class="headerlink" title="æ³¨å…¥ä¸­é—´ä»¶"></a>æ³¨å…¥ä¸­é—´ä»¶</h2><h3 id="ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶"><a href="#ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶"></a>ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶</h3><blockquote><p>ä¸­é—´ä»¶å°±æ˜¯åœ¨ <code>æµè§ˆå™¨</code> å‘ <code>vite</code> è¯·æ±‚æ–‡ä»¶è¿‡ç¨‹ä¸­çš„ â€<strong>ä¸­é—´æ£€æŸ¥ç«™</strong>â€œ</p><p>Â Â ä¸€ä¸ªä¸­é—´ä»¶å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç±»ä¼¼äºè¿™ç§ğŸ‘‡</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myMiddleware</span>(<span class="params">req, res, next</span>) &#123; <span class="comment">// è¯·æ±‚å¯¹è±¡ï¼Œç›¸åº”å¯¹è±¡ï¼Œæ”¾è¡Œå‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&#x27;/hello&#x27;</span>) &#123; <span class="comment">// ä¸è°ƒç”¨ next()ï¼Œç›¸å½“äºç›´æ¥æ‹¦æˆª</span></span><br><span class="line">        res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span> &#125;)</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;Hello from middleware!&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>() <span class="comment">// æ”¾è¡Œï¼Œç»§ç»­åç»­å¤„ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>Vite çš„å¼€å‘æœåŠ¡å™¨åº•å±‚åŸºäº <strong>Connect</strong>ï¼ˆä¸€ä¸ªè½»é‡çº§ Node.js æ¡†æ¶ï¼‰ï¼Œè€Œ Connect çš„æ ¸å¿ƒå°±æ˜¯ä¸­é—´ä»¶æœºåˆ¶</p><p>å®ƒçš„ç»“æ„å°±åƒè¿™æ ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">æµè§ˆå™¨è¯·æ±‚</span><br><span class="line">     â†“</span><br><span class="line">[æ’ä»¶æ³¨å†Œçš„ä¸­é—´ä»¶ 1] â†’ Mock æ¥å£æ‹¦æˆª /api/*</span><br><span class="line">     â†“</span><br><span class="line">[æ’ä»¶æ³¨å†Œçš„ä¸­é—´ä»¶ 2] â†’ React JSX è½¬æ¢</span><br><span class="line">     â†“</span><br><span class="line">[æ’ä»¶æ³¨å†Œçš„ä¸­é—´ä»¶ 3] â†’ é™æ€èµ„æºé‡å®šå‘</span><br><span class="line">     â†“</span><br><span class="line">â€¦â€¦ï¼ˆå…¶ä»–æ’ä»¶ä¸­é—´ä»¶ï¼‰</span><br><span class="line">     â†“</span><br><span class="line">[Vite æ ¸å¿ƒä¸­é—´ä»¶]</span><br><span class="line">     â”œâ”€â”€ 1. HTML å¤„ç†ä¸­é—´ä»¶</span><br><span class="line">     â”œâ”€â”€ 2. é™æ€èµ„æºæœåŠ¡ä¸­é—´ä»¶</span><br><span class="line">     â”œâ”€â”€ 3. æ¨¡å—è¯·æ±‚å¤„ç†ä¸­é—´ä»¶ï¼ˆæ ¸å¿ƒï¼ï¼‰</span><br><span class="line">     â”œâ”€â”€ 4. HMR WebSocket ä¸­é—´ä»¶</span><br><span class="line">     â””â”€â”€ 5. 404 å¤„ç†ä¸­é—´ä»¶</span><br><span class="line">     â†“</span><br><span class="line">è¿”å›å“åº”ç»™æµè§ˆå™¨</span><br></pre></td></tr></table></figure><h3 id="Vite-çš„æ“ä½œ"><a href="#Vite-çš„æ“ä½œ" class="headerlink" title="Vite çš„æ“ä½œ"></a>Vite çš„æ“ä½œ</h3><p>Vite çš„è§„åˆ™æ˜¯ <strong>å…ˆæ³¨å†Œçš„æ’ä»¶å…ˆæ‰§è¡Œ</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">mockPlugin</span>(), </span><br><span class="line">        <span class="title function_">reactPlugin</span>(), </span><br><span class="line">        <span class="title function_">legacyPlugin</span>(),</span><br><span class="line">        <span class="title function_">myCustomPlugin</span>()</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ’ä»¶å¯ä»¥é€šè¿‡ <strong><code>configureServer</code></strong> é’©å­**ï¼ˆæ’ä»¶å¼€å‘è€…å·²å®šä¹‰å¥½ï¼‰å‘ Vite çš„æœåŠ¡å™¨æ³¨å†Œè‡ªå·±çš„ä¸­é—´ä»¶</p><blockquote><p>æ¯”å¦‚ mock æ’ä»¶</p><p>æ•ˆæœï¼šå½“ä½ åœ¨æµè§ˆå™¨è®¿é—® <code>/api/users</code>ï¼Œæ ¹æœ¬ä¸ä¼šå»è¯·æ±‚åç«¯ï¼Œè€Œæ˜¯ç›´æ¥è¿”å› mock æ•°æ®</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mockPlugin = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;vite-plugin-mock&#x27;</span>,</span><br><span class="line">    <span class="title function_">configureServer</span>(<span class="params">server</span>) &#123; <span class="comment">// å‘ Vite çš„æœåŠ¡å™¨æ³¨å†Œ server</span></span><br><span class="line">        <span class="comment">// æœ‰äººè¯·æ±‚äº† /api/users</span></span><br><span class="line">        server.<span class="property">middlewares</span>.<span class="title function_">use</span>(<span class="string">&#x27;/api/users&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123; <span class="comment">// middlewares æ˜¯ Connect çš„ä¸­é—´ä»¶å®¹å™¨</span></span><br><span class="line">            res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;)</span><br><span class="line">            res.<span class="title function_">end</span>(</span><br><span class="line">                <span class="title class_">JSON</span>.<span class="title function_">stringify</span>([</span><br><span class="line">                    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span> &#125;,</span><br><span class="line">                    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;Bob&#x27;</span> &#125;</span><br><span class="line">                ])</span><br><span class="line">            )</span><br><span class="line">            <span class="comment">// æ²¡æœ‰ next()ï¼Œè¯·æ±‚è¢«æ‹¦æˆª</span></span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æˆ–æ˜¯è®°å½•æ—¥å¿—ï¼Œä¸åšæ“ä½œ</span></span><br><span class="line">        server.<span class="property">middlewares</span>.<span class="title function_">use</span>(<span class="string">&#x27;/api/*&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ‹¦æˆªæ‰€æœ‰ /api/ å¼€å¤´çš„è¯·æ±‚&#x27;</span>)</span><br><span class="line">            <span class="title function_">next</span>() <span class="comment">// æ”¾è¡Œï¼Œäº¤ç»™ä¸‹ä¸€ä¸ªå¤„ç†</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>âš ï¸ å¦‚æœä½ åœ¨<strong>ä¸­é—´ä»¶é‡Œ <strong><code>return</code></strong> äº†å“åº”</strong>ï¼ˆæ¯”å¦‚ mock æ•°æ®ï¼‰ï¼Œ<strong>åé¢çš„ä¸­é—´ä»¶</strong>ï¼ˆåŒ…æ‹¬ Vite æ ¸å¿ƒï¼‰å°±<strong>ä¸ä¼šæ‰§è¡Œ</strong></p></blockquote><h2 id="è¯·æ±‚å¤„ç†ï¼ˆæ ¸å¿ƒï¼‰"><a href="#è¯·æ±‚å¤„ç†ï¼ˆæ ¸å¿ƒï¼‰" class="headerlink" title="è¯·æ±‚å¤„ç†ï¼ˆæ ¸å¿ƒï¼‰"></a>è¯·æ±‚å¤„ç†ï¼ˆæ ¸å¿ƒï¼‰</h2><p>å½“æµè§ˆå™¨è¯·æ±‚ä¸€ä¸ªæ–‡ä»¶ï¼ˆå¦‚ <code>App.vue</code>ï¼‰æ—¶ï¼ŒVite ä¸æ˜¯ç®€å•åœ°è¿”å›æ–‡ä»¶å†…å®¹ï¼Œè€Œæ˜¯é€šè¿‡ <strong>æ’ä»¶ç³»ç»ŸåŠ¨æ€è½¬æ¢</strong>ï¼Œæœ€ç»ˆ<strong>è¿”å›ä¸€æ®µå¯æ‰§è¡Œçš„ JS</strong> æ¨¡å—ã€‚è€Œè¿™ä¸ªè¿‡ç¨‹ä¼š<strong>äº§ç”Ÿå¯¹å­èµ„æºçš„é¢å¤–è¯·æ±‚</strong>ï¼Œè¿™æ˜¯ç†è§£ Vite å¤„ç† <code>.vue</code> æ–‡ä»¶çš„å…³é”®</p><h3 id="è¯·æ±‚æ‹¦æˆª"><a href="#è¯·æ±‚æ‹¦æˆª" class="headerlink" title="è¯·æ±‚æ‹¦æˆª"></a>è¯·æ±‚æ‹¦æˆª</h3><p><strong>æµè§ˆå™¨å‘èµ·ï¼š****<code>GET /src/App.vue</code></strong></p><p>Vite çš„å¼€å‘æœåŠ¡å™¨æ‹¦æˆªè¯¥è¯·æ±‚ï¼Œä¸ç›´æ¥è¯»å–æ–‡ä»¶è¿”å›ï¼Œè€Œæ˜¯ <strong>å¼€å¯æ¨¡å—è§£æå’Œè½¬æ¢æµç¨‹</strong></p><h3 id="æ’ä»¶æµæ°´çº¿æ‰§è¡Œï¼ˆæ ¸å¿ƒï¼‰"><a href="#æ’ä»¶æµæ°´çº¿æ‰§è¡Œï¼ˆæ ¸å¿ƒï¼‰" class="headerlink" title="æ’ä»¶æµæ°´çº¿æ‰§è¡Œï¼ˆæ ¸å¿ƒï¼‰"></a>æ’ä»¶æµæ°´çº¿æ‰§è¡Œï¼ˆæ ¸å¿ƒï¼‰</h3><p>Vite é€šè¿‡ Rollup é£æ ¼çš„æ’ä»¶æ¥å£ï¼Œä¾æ¬¡è°ƒç”¨æ³¨å†Œçš„æ’ä»¶é’©å­ï¼Œé¡ºåºå¦‚ä¸‹ï¼š</p><h4 id="resolveId-specifier"><a href="#resolveId-specifier" class="headerlink" title="resolveId(specifier)"></a><code>resolveId</code>(specifier)</h4><p><em>è§£ææ¨¡å—ä¾èµ–å…³ç³»æ—¶ï¼ˆå¦‚</em> <code>import &#39;./App.vue&#39;</code><em>ï¼‰</em></p><p>è°ƒç”¨æ’ä»¶çš„ <code>resolveId</code> é’©å­ï¼Œ<strong>ç¡®å®š</strong> <code>&#39;./App.vue&#39;</code> å¯¹åº”çš„<strong>çœŸå®è·¯å¾„</strong>ï¼ˆå¦‚ <code>/project/src/App.vue</code>ï¼‰</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vite å†…éƒ¨è°ƒç”¨</span></span><br><span class="line"><span class="keyword">const</span> resolved = <span class="keyword">await</span> pluginContainer.<span class="title function_">resolveId</span>(<span class="string">&#x27;./App.vue&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="load-id"><a href="#load-id" class="headerlink" title="load(id)"></a><code>load</code>(id)</h4><p><em>æ¨¡å—è·¯å¾„è§£æå</em></p><p>éœ€è¦è¯»å–åŸå§‹å†…å®¹ï¼Œè°ƒç”¨æ’ä»¶çš„ <code>load</code> é’©å­ï¼Œ<strong>è·å–æ–‡ä»¶åŸå§‹å­—ç¬¦ä¸²</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vite å†…éƒ¨è°ƒç”¨</span></span><br><span class="line"><span class="keyword">const</span> code = <span class="keyword">await</span> pluginContainer.<span class="title function_">load</span>(<span class="string">&#x27;/project/src/App.vue&#x27;</span>)</span><br><span class="line"><span class="comment">// è¿”å›ï¼š&#x27;&lt;script&gt;...&lt;\/script&gt;&lt;template&gt;...&lt;\/template&gt;&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="transform-code-id"><a href="#transform-code-id" class="headerlink" title="transform(code, id)"></a><code>transform</code>(code, id)</h4><p><em>å½“å¯¹åŠ è½½çš„åŸå§‹å†…å®¹è¿›è¡Œè½¬æ¢æ—¶</em></p><p>å°† <code>code</code> å’Œ <code>id</code> ä¼ ç»™æ‰€æœ‰æ’ä»¶çš„ <code>transform</code> é’©å­ï¼Œ<strong>æŒ‰é¡ºåºæ‰§è¡Œè½¬æ¢</strong></p><blockquote><p><strong>Viteä¸è‡ªå·±è½¬æ¢</strong> <strong><code>.vue</code></strong> æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯æŠŠ <strong><code>code</code></strong> äº¤ç»™ <strong><code>@vitejs/plugin-vue</code></strong> <strong>æ’ä»¶å¤„ç†</strong></p><p>æ³¨ï¼š<code>@vitejs/plugin-vue</code> åœ¨ <code>transform</code> é˜¶æ®µä¼šè‡ªåŠ¨æ³¨å…¥ HMR æ”¯æŒ</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vite å†…éƒ¨è°ƒç”¨</span></span><br><span class="line"><span class="keyword">let</span> result = code <span class="comment">// ä½ çš„ä»£ç </span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> plugin <span class="keyword">of</span> plugins) &#123;</span><br><span class="line">    <span class="keyword">if</span> (plugin.<span class="property">transform</span>) &#123;</span><br><span class="line">        result = <span class="keyword">await</span> plugin.<span class="title function_">transform</span>(result, id)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å½“ <code>@vitejs/plugin-vue</code> æ’ä»¶å‘ç° <code>id</code> æ˜¯ <code>.vue</code> æ–‡ä»¶æ—¶ï¼Œå°±ä¼šä»‹å…¥å¤„ç†</p></blockquote><h3 id="å¤„ç†å­èµ„æºè¯·æ±‚"><a href="#å¤„ç†å­èµ„æºè¯·æ±‚" class="headerlink" title="å¤„ç†å­èµ„æºè¯·æ±‚"></a>å¤„ç†å­èµ„æºè¯·æ±‚</h3><blockquote><p><code>vue</code> æ–‡ä»¶å†…éƒ¨è¿˜æœ‰åˆ†å—ï¼Œä¹Ÿå°±æ˜¯ <code>template</code>ï¼Œ<code>script</code>ï¼Œ<code>style</code></p></blockquote><p><strong>æµè§ˆå™¨ç»§ç»­å‘èµ·è¯·æ±‚ï¼š****<code>GET /src/App.vue?type=template</code></strong></p><p>Vite å†æ¬¡æ‹¦æˆªè¿™ä¸ªè¯·æ±‚ï¼Œå¹¶é‡å¤ä¹‹å‰çš„æµç¨‹</p><h4 id="resolveId-specifier-1"><a href="#resolveId-specifier-1" class="headerlink" title="resolveId(specifier)"></a><code>resolveId</code>(specifier)</h4><p>æ’ä»¶ï¼ˆ<code>@vitejs/plugin-vue</code>ï¼‰è¯†åˆ«åˆ° <code>?type=template</code>ï¼Œå°†å…¶æ ‡è®°ä¸ºä¸€ä¸ªè™šæ‹Ÿæ¨¡å—ï¼Œè¿”å›åŸæ ·æˆ–ç‰¹æ®Šæ ‡è¯†<code>load</code>(id)</p><h4 id="load-id-1"><a href="#load-id-1" class="headerlink" title="load(id)"></a><code>load</code>(id)</h4><p>å¯èƒ½è¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œæˆ–ä¸è°ƒç”¨ï¼ˆæŸäº›æ’ä»¶ç›´æ¥åœ¨ <code>transform</code> å¤„ç†ï¼‰</p><h4 id="transform-code-id-1"><a href="#transform-code-id-1" class="headerlink" title="transform(code, id)"></a><code>transform</code>(code, id)</h4><blockquote><p>å½“ <code>@vitejs/plugin-vue</code> æ’ä»¶å‘ç°ç‰¹æ®Šæ ‡è¯†idï¼Œå°±çŸ¥é“è¿™æ˜¯æ¨¡æ¿è¯·æ±‚</p><p>ä¼šä½¿ç”¨ <code>@vue/compiler-dom</code> å°†æ¨¡æ¿ç¼–è¯‘ä¸º <code>render</code> å‡½æ•°ï¼ˆè¿™æ˜¯vueæ’ä»¶çš„åŠŸèƒ½ï¼‰</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å›ç»™æµè§ˆå™¨çš„å†…å®¹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> render = <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">_ctx, _cache</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="title function_">_openBlock</span>(), <span class="title function_">_createBlock</span>(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, [</span><br><span class="line">        <span class="title function_">_createTextVNode</span>(<span class="string">&quot;Count: &quot;</span> + <span class="title function_">_toDisplayString</span>(_ctx.<span class="property">count</span>), <span class="number">1</span>)</span><br><span class="line">    ]))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµç¨‹æ€»ç»“"><a href="#æµç¨‹æ€»ç»“" class="headerlink" title="æµç¨‹æ€»ç»“"></a>æµç¨‹æ€»ç»“</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">æµè§ˆå™¨</span><br><span class="line">   â†“ GET /src/App.vue</span><br><span class="line">Vite æœåŠ¡å™¨</span><br><span class="line">   â†“ è°ƒç”¨ resolveId â†’ load â†’ transform</span><br><span class="line">@vitejs/plugin-vue è½¬æ¢ï¼šè¿”å› JSï¼ŒåŒ…å« import &#x27;./?type=template&#x27;</span><br><span class="line">   â†“ æµè§ˆå™¨è§£æ JSï¼Œå‘ç°æ–° import</span><br><span class="line">æµè§ˆå™¨</span><br><span class="line">   â†“ GET /src/App.vue?type=template</span><br><span class="line">Vite æœåŠ¡å™¨</span><br><span class="line">   â†“ å†æ¬¡ resolveId / transform</span><br><span class="line">@vitejs/plugin-vueï¼šæå–æ¨¡æ¿ï¼Œç¼–è¯‘ä¸º render å‡½æ•°</span><br><span class="line">   â†“ è¿”å› render å‡½æ•°ä»£ç </span><br><span class="line">æµè§ˆå™¨ï¼šç»„ä»¶åŠ è½½å®Œæˆ</span><br></pre></td></tr></table></figure><h2 id="çƒ­æ¨¡å—æ›´æ–°"><a href="#çƒ­æ¨¡å—æ›´æ–°" class="headerlink" title="çƒ­æ¨¡å—æ›´æ–°"></a>çƒ­æ¨¡å—æ›´æ–°</h2><p>Vite æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯æ‹¥æœ‰æå¿«çš„çƒ­æ›´æ–°ï¼ˆHMRï¼‰ï¼ŒViteçš„çƒ­æ›´æ–°æœ¬è´¨æ˜¯ <strong>åœ¨è¿è¡Œæ—¶åŠ¨æ€æ›¿æ¢æ¨¡å—ä»£ç </strong></p><p>æ›´æ–°ä¸»è¦åŒ…å«ä»¥ä¸‹è¿‡ç¨‹</p><h3 id="æœåŠ¡å™¨æ„ŸçŸ¥"><a href="#æœåŠ¡å™¨æ„ŸçŸ¥" class="headerlink" title="æœåŠ¡å™¨æ„ŸçŸ¥"></a>æœåŠ¡å™¨æ„ŸçŸ¥</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> watcher = chokidar.<span class="title function_">watch</span>(root, &#123; ... &#125;) <span class="comment">// Vite ä½¿ç”¨ chokidar ç›‘å¬æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">watcher.<span class="title function_">on</span>(<span class="string">&#x27;change&#x27;</span>, <span class="title function_">async</span> (file) =&gt; &#123; <span class="comment">// file: /project/src/App.vue</span></span><br><span class="line">    <span class="keyword">const</span> modules = moduleGraph.<span class="title function_">getModulesByFile</span>(file) <span class="comment">// moduleGraph æ˜¯ Vite å†…å­˜ä¸­çš„â€œä¾èµ–å›¾â€ï¼Œè®°å½•ç€è° import äº†è°ï¼›ç°åœ¨modulesä»£è¡¨æ‰€æœ‰ä¾èµ–è¿™ä¸ªfileæ–‡ä»¶çš„æ¨¡å—</span></span><br><span class="line">    <span class="title function_">updateModules</span>(file, modules) <span class="comment">// è§¦å‘æ›´æ–°</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="WebSocket-æ›´æ–°"><a href="#WebSocket-æ›´æ–°" class="headerlink" title="WebSocket æ›´æ–°"></a>WebSocket æ›´æ–°</h3><p>Vite æœåŠ¡å™¨</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">updateModules</span>(<span class="params">file, modules</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> updates = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> mod <span class="keyword">of</span> modules) &#123;</span><br><span class="line">        updates.<span class="title function_">push</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;update&#x27;</span>,        <span class="comment">// æ›´æ–°ç±»å‹</span></span><br><span class="line">            <span class="attr">path</span>: mod.<span class="property">url</span>,         <span class="comment">// å¦‚ /src/App.vue</span></span><br><span class="line">            <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ws.<span class="title function_">send</span>(&#123; <span class="comment">// é€šè¿‡ WebSocket å¹¿æ’­</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;update&#x27;</span>,</span><br><span class="line">        updates</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æµè§ˆå™¨ç«¯çš„ <code>vite/client</code> ä¼šç›‘å¬è¿™ä¸ªæ¶ˆæ¯</p></blockquote><h3 id="æµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰æ¥æ”¶"><a href="#æµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰æ¥æ”¶" class="headerlink" title="æµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰æ¥æ”¶"></a>æµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰æ¥æ”¶</h3><p>vite&#x2F;client æ³¨å…¥çš„ä»£ç </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ws.<span class="property">onmessage</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(event.<span class="property">data</span>)</span><br><span class="line">    <span class="keyword">if</span> (data.<span class="property">type</span> === <span class="string">&#x27;update&#x27;</span>) &#123;</span><br><span class="line">        data.<span class="property">updates</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">update</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// å‘èµ·æ–°çš„ HTTP è¯·æ±‚ï¼Œå¸¦æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜</span></span><br><span class="line">            <span class="title function_">fetchUpdate</span>(update.<span class="property">path</span>, update.<span class="property">timestamp</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchUpdate</span>(<span class="params">path, timestamp</span>) &#123;</span><br><span class="line">    <span class="comment">// è¯·æ±‚æ–°çš„æ¨¡å—å†…å®¹</span></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`<span class="subst">$&#123;path&#125;</span>?t=<span class="subst">$&#123;timestamp&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">const</span> code = <span class="keyword">await</span> response.<span class="title function_">text</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ¨¡å—å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">const</span> mod = &#123;</span><br><span class="line">        <span class="attr">id</span>: path,</span><br><span class="line">        code,</span><br><span class="line">        <span class="attr">getters</span>: [] <span class="comment">// ç”¨äº HMR accept</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨ hot.accept</span></span><br><span class="line">    <span class="keyword">const</span> &#123; hot &#125; = <span class="keyword">import</span>.<span class="property">meta</span></span><br><span class="line">    hot.<span class="title function_">accept</span>(path, <span class="function">(<span class="params">newMod</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œæ˜¯çœŸæ­£çš„â€œçƒ­æ›¿æ¢â€å‘ç”Ÿçš„åœ°æ–¹</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ¨¡å—å·²æ›´æ–°:&#x27;</span>, path)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çƒ­æ›¿æ¢ï¼ˆå±€éƒ¨æ›´æ–°ï¼‰"><a href="#çƒ­æ›¿æ¢ï¼ˆå±€éƒ¨æ›´æ–°ï¼‰" class="headerlink" title="çƒ­æ›¿æ¢ï¼ˆå±€éƒ¨æ›´æ–°ï¼‰"></a>çƒ­æ›¿æ¢ï¼ˆå±€éƒ¨æ›´æ–°ï¼‰</h3><p><strong>è¿™æ˜¯é€šè¿‡æ¡†æ¶ï¼ˆVue&#x2F;Reactï¼‰çš„æ¸²æŸ“æœºåˆ¶å®ç°çš„</strong></p><blockquote><p>å¦‚æœæ¥è§¦è¿‡æ¡†æ¶æºç å°±å¯ä»¥ç†è§£ï¼Œå°±æ˜¯æ¡†æ¶å†…éƒ¨æ ¹æ®DOMå·®å¼‚å®ç°çƒ­æ›¿æ¢çš„diffç®—æ³•</p></blockquote><p>æ‰€ä»¥ï¼Œ<strong>Vite åªè´Ÿè´£é€æ–°æ¨¡å—</strong>ï¼Œè€Œå±€éƒ¨æ›´æ–°çš„å®ç°æ˜¯æºäºæ¡†æ¶æ¸²æŸ“æœºåˆ¶</p><h1 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td></td><td>è¯¦æƒ…</td></tr><tr><td><strong>pnpm dev</strong></td><td>æŸ¥æ‰¾ <code>package.json</code> ä¸­ <code>scripts</code> ä¸‹çš„ <code>dev</code> å‘½ä»¤å¹¶æ‰§è¡Œ</td></tr><tr><td><strong>æ‰§è¡Œ vite å‘½ä»¤</strong></td><td>è°ƒç”¨ Vite çš„äºŒè¿›åˆ¶æ–‡ä»¶ <code>node_modules/.bin/vite</code>ï¼ˆå¼•è¿åˆ° Vite çš„ CLI æ¨¡å— <code>vite/src/node/cli.ts</code>ï¼‰</td></tr><tr><td><strong>ç¡®å®š mode</strong></td><td>æŒ‰é¡ºåºæŸ¥æ‰¾å’ŒåŠ è½½ <code>.env</code>ï¼Œæ³¨å…¥å˜é‡åˆ° <code>process.env</code>ï¼Œè¿‡æ»¤å˜é‡åˆ° <code>import.meta.env</code>ï¼Œ</td></tr><tr><td><strong>åˆå¹¶æ’ä»¶é…ç½®</strong></td><td>åˆå¹¶ <code>CLI</code>æŒ‡ä»¤ &amp; <code>vite.config.ts</code>é…ç½®ï¼Œé€šè¿‡<code>config</code>ï¼Œ<code>configResolved</code> è‡ªå®šä¹‰æ’ä»¶</td></tr><tr><td><strong>åˆå§‹åŒ–æ’ä»¶ç³»ç»Ÿ</strong></td><td>æŒ‰ç…§ <code>pre</code>ã€<code>normal</code>ã€<code>post</code> æ’åºæ’ä»¶ï¼ˆå¯é€šè¿‡ <code>apply: &#39;serve&#39;/&#39;build&#39;</code> æŒ‡å®šæ¨¡å¼ ï¼‰</td></tr><tr><td><strong>å¯åŠ¨æœåŠ¡å™¨</strong></td><td>åˆ›å»ºå¼€å‘æœåŠ¡å™¨ï¼ˆKoa&#x2F;Connect å®ä¾‹ï¼‰</td></tr><tr><td><strong>æ³¨å†Œä¸­é—´ä»¶</strong></td><td>æ ¹æ® <code>vite.config.ts/plugin</code> çš„é¡ºåºï¼Œè°ƒç”¨æ‰€æœ‰æ’ä»¶çš„ <code>configureServer</code> é’©å­</td></tr><tr><td><strong>æµè§ˆå™¨è¯·æ±‚æ–‡ä»¶</strong></td><td>æŒ‰éœ€ transformï¼ˆ.vue&#x2F;.ts â†’ JSï¼‰</td></tr><tr><td><strong>çƒ­æ›´æ–°</strong></td><td>å‘æµè§ˆå™¨æ¨é€æ–°æ¨¡å—ï¼Œå¹¶åˆ©ç”¨æ¡†æ¶æœºåˆ¶çƒ­æ›¿æ¢DOM</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vercel éƒ¨ç½²æœåŠ¡</title>
      <link href="/2025/09/07/%E5%B7%A5%E5%85%B7/Vercel%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1/"/>
      <url>/2025/09/07/%E5%B7%A5%E5%85%B7/Vercel%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.cnblogs.com/wang-bo/p/15472423.html">https://www.cnblogs.com/wang-bo/p/15472423.html</a></p><p>ä¸»è¦æ“ä½œå’Œæµç¨‹é“¾æ¥é‡Œå·²ç»ç»™äº†ğŸ‘†</p><p>è¿™ç¯‡ä¸»è¦æ˜¯å¯¹æ“ä½œè¿›è¡Œç¿»è¯‘ï¼Ÿ(ç¬¬ä¸€æ¬¡ç”¨verceléƒ¨ç½²å¥½æ‡µ(å¯èƒ½æ˜¯å›°çš„â€¦)ï¼Œè¿˜å†å¥—äº†ä¸ªgithubçš„CI&#x2F;CDæ›´ç»•äº†)</p><blockquote><p>æ³¨ï¼šæ–‡æ¡£é‡Œçš„ workflows æ–‡ä»¶åº”è¯¥æ˜¯ branches æœ‰é—®é¢˜ï¼Œç»„é‡ŒåŠ ä¸ª main åº”è¯¥èƒ½è¿‡</p></blockquote><h2 id="ä¸»è¦åŠŸèƒ½"><a href="#ä¸»è¦åŠŸèƒ½" class="headerlink" title="ä¸»è¦åŠŸèƒ½"></a>ä¸»è¦åŠŸèƒ½</h2><p>é¡¹ç›®åº”ç”¨åœ¨<strong>äº’è”ç½‘å†…å¯è®¿é—®</strong></p><p>å®ç° <strong>æœ¬åœ°æäº¤</strong>â†’<strong>Github</strong>â†’<strong>Vercel</strong> æµæ°´çº¿è¿‡ç¨‹<strong>å®Œå…¨è‡ªåŠ¨åŒ–</strong></p><h2 id="æµç¨‹å®ç°"><a href="#æµç¨‹å®ç°" class="headerlink" title="æµç¨‹å®ç°"></a>æµç¨‹å®ç°</h2><ol><li><p><code>nest new blogServer</code> å‘½ä»¤ï¼šåœ¨æœ¬åœ°åˆ›å»ºäº†é¡¹ç›®æ¨¡æ¿</p></li><li><p>è·‘ä¸€ä¸‹</p></li><li><p>å°†é¡¹ç›®æäº¤åˆ° github äº‘ç«¯</p></li><li><p>åœ¨ <a href="https://vercel.com/">Vercel</a> å¹³å°ï¼Œ<code>new Project</code>æ–°å»ºé¡¹ç›®</p></li><li><p>æ–°å»ºçš„ Vercel é¡¹ç›®é“¾æ¥åˆ°ä½ çš„ github ä»“åº“</p></li><li><p>Configure Project æŒ‰ç…§ä½ çš„é¡¹ç›®è¿è¡Œæ–¹å¼å¡«ï¼ˆæ¯”å¦‚ <code>build</code> å‘½ä»¤<code>npm build</code>, ç”Ÿæˆç›®å½• <code>dist</code>â€¦å› é¡¹ç›®è€Œå¼‚ï¼‰</p></li><li><p>åœ¨æœ¬åœ°é¡¹ç›®æ ¹ç›®å½•æ–°å»º <code>vercel.json</code>ï¼Œæ˜¯ç»™ Vercel å¹³å°æä¾›çš„ä¿¡æ¯ã€‚å‚è€ƒæ–‡ç« ä¸­çš„ä»£ç è§£é‡Šå¦‚ä¸‹</p><ol><li><p><code>&quot;src&quot;: &quot;dist/main.js&quot;</code>ï¼šæœåŠ¡å™¨å…¥å£æ–‡ä»¶æ˜¯ <code>dist</code> æ–‡ä»¶å¤¹é‡Œçš„ <code>main.js</code></p></li><li><p><code>&quot;use&quot;: &quot;@vercel/node&quot;</code>ï¼šä½¿ç”¨Vercelçš„Node.jsç¯å¢ƒæ¥è¿è¡Œå®ƒ</p></li><li><p><code>src&quot;: &quot;/(.*)&quot;, &quot;dest&quot;: &quot;dist/main.js&quot;</code>ï¼šæ— è®ºè®¿é—®ä»»ä½•è·¯å¾„ï¼Œéƒ½æŠŠè¯·æ±‚äº¤ç»™ <code>dist/main.js</code> æ–‡ä»¶æ¥å¤„ç†</p></li></ol></li><li><p>æœ¬åœ° <code>pnpm build</code> æ‰“åŒ…å‡º <code>dist</code> æ–‡ä»¶å¤¹</p></li><li><p>æœ¬åœ° <code>vercle login</code> å‘½ä»¤ç™»å½• Github</p></li><li><p>æœ¬åœ° <code>vercle --pord</code> å°†ä»£ç éƒ¨ç½²åˆ° Vercel çš„ç”Ÿäº§ç¯å¢ƒï¼Œå¹¶ç”Ÿæˆä¸‰ä¸ª Secret çš„å…¶ä¸­ä¸¤ä¸ªå˜é‡ï¼ˆ<code>VERCEL_PROJECT_ID</code>, <code>VERCEL_ORG_ID</code>ï¼‰</p></li><li><p>åœ¨ Github å¹³å°ï¼Œæ‰“å¼€ä½ çš„é¡¹ç›®ï¼Œé€‰æ‹© Action ğŸ‘‰ New workflow ğŸ‘‰ ä½ é¡¹ç›®çš„å·¥ä½œæµç¯å¢ƒ ğŸ‘‰ CI&#x2F;CDå·¥ä½œæµè„šæœ¬</p></li><li><p>åœ¨ <a href="https://vercel.com/">Vercel</a> å¹³å°ï¼Œå¤´åƒ ğŸ‘‰ Account Settings ğŸ‘‰ Tokens ğŸ‘‰ TOKEN NAME å†™ä½ å®¹æ˜“è¾¨åˆ«çš„åå­— ğŸ‘‰ Create ğŸ‘‰ å¤åˆ¶å¯†é’¥ï¼ˆ<strong>ç”Ÿæˆåï¼ŒToken åªä¼šæ˜¾ç¤ºè¿™ä¸€æ¬¡ï¼ è¯·ç«‹åˆ»æŠŠå®ƒå¤åˆ¶åˆ°ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹</strong>ï¼‰</p></li><li><p>ç°åœ¨æœ‰ä¸‰ä¸ªå¯†é’¥ï¼Œä¸€ä¸ªå°±æ˜¯åˆšé…çš„ Vercel Tokenï¼Œä¸¤ä¸ªåœ¨ä½ é¡¹ç›®çš„ <code>.vercel\project.json</code>ï¼ˆå› ä¸ºè‡ªåŠ¨æµç¨‹ Vercel éœ€è¦æƒé™æ‰å¯ä»¥æ“ä½œ Github ä»“åº“ï¼‰</p></li><li><p>åœ¨ Github å¹³å°ï¼Œæ‰“å¼€ä½ çš„é¡¹ç›®ï¼Œé€‰æ‹© Settings ğŸ‘‰ Secrets and variables ğŸ‘‰ Actions ğŸ‘‰ New repository secret ğŸ‘‰ æ·»åŠ ä½ çš„ä¸‰ä¸ªä»“åº“å¯†é’¥</p></li><li><p>ç°åœ¨æ”¹ä»£ç æäº¤å°±å¯ä»¥å®ç°è‡ªåŠ¨æµæ°´çº¿éƒ¨ç½²äº†</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¡¹ç›®æ¶æ„æ–¹æ¡ˆ</title>
      <link href="/2025/08/22/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88/"/>
      <url>/2025/08/22/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<h1 id="é¡¹ç›®æ¶æ„ä¹‹Monolithic-Multirepo-Monorepo"><a href="#é¡¹ç›®æ¶æ„ä¹‹Monolithic-Multirepo-Monorepo" class="headerlink" title="é¡¹ç›®æ¶æ„ä¹‹Monolithic&#x2F;Multirepo&#x2F;Monorepo"></a>é¡¹ç›®æ¶æ„ä¹‹Monolithic&#x2F;Multirepo&#x2F;Monorepo</h1><h2 id="Monolithic"><a href="#Monolithic" class="headerlink" title="Monolithic"></a>Monolithic</h2><p><strong>å•ä»“å•æ¨¡å—</strong> æ¶æ„</p><blockquote><p>æ‰€æœ‰çš„ä»£ç éƒ½ä½äºä¸€ä¸ªå•ä¸€çš„ä»“åº“å†…ï¼Œé€šå¸¸æ˜¯åœ¨ <code>src</code> ç›®å½•ä¸‹ç»„ç»‡ä¸åŒçš„æ¨¡å—å’Œç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯åˆå­¦æ—¶æ¥è§¦åˆ°çš„é¡¹ç›®ç»“æ„ã€‚</p></blockquote><h4 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">my-vue-app/</span><br><span class="line">â”œâ”€â”€ public/</span><br><span class="line">â”œâ”€â”€ src/</span><br><span class="line">â”‚   â”œâ”€â”€ assets/</span><br><span class="line">â”‚   â”œâ”€â”€ components/         # æ‰€æœ‰å…±äº«çš„Vueç»„ä»¶</span><br><span class="line">â”‚   â”œâ”€â”€ views/              # é¡µé¢çº§åˆ«çš„ç»„ä»¶</span><br><span class="line">â”‚   â”œâ”€â”€ router/             # è·¯ç”±é…ç½®</span><br><span class="line">â”‚   â”œâ”€â”€ store/              # Vuex çŠ¶æ€ç®¡ç†</span><br><span class="line">â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°</span><br><span class="line">â”‚   â””â”€â”€ App.vue</span><br><span class="line">â”‚   â””â”€â”€ main.js</span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â””â”€â”€ vue.config.js</span><br></pre></td></tr></table></figure><h4 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h4><p>æ„å»ºä¸€ä½“åŒ–ï¼Œç”±æ ¹ <code>package.json</code> ç»Ÿä¸€ç»´æŠ¤ä¾èµ–ï¼Œç‰ˆæœ¬å†²çªå°‘ï¼›</p><p>ä¸€æ¬¡æ„å»ºã€ä¸€æ¬¡éƒ¨ç½²ï¼ŒCI&#x2F;CD æµç¨‹ç®€å•ï¼›</p><h4 id="ç¼ºé™·"><a href="#ç¼ºé™·" class="headerlink" title="ç¼ºé™·"></a>ç¼ºé™·</h4><p>éšé¡¹ç›®å¢é•¿ï¼Œä»£ç è‡ƒè‚¿ä¸”å¯ç»´æŠ¤æ€§å˜å·®ï¼›</p><p>å›¢é˜Ÿåä½œå¼€å‘å®¹æ˜“äº§ç”Ÿå¤§é‡åˆå¹¶å†²çªï¼›</p><p>å¤ç”¨æ€§ä½ï¼Œæ— æ³•ç‹¬ç«‹å‘å¸ƒå’Œå¤ç”¨å…±äº«æ¨¡å—åˆ°å…¶ä»–é¡¹ç›®</p><h4 id="é€‚ç”¨"><a href="#é€‚ç”¨" class="headerlink" title="é€‚ç”¨"></a>é€‚ç”¨</h4><p>å°å‹åº”ç”¨ &#x2F; ä¸ªäººé¡¹ç›® &#x2F; å°å›¢é˜Ÿ(1-3äºº)</p><h2 id="Monorepo"><a href="#Monorepo" class="headerlink" title="Monorepo"></a>Monorepo</h2><p><strong>å•ä»“å¤šæ¨¡å—</strong> æ¶æ„</p><blockquote><p>å¤šä¸ªé¡¹ç›®æˆ–æ¨¡å—ä¼šæ”¾åœ¨åŒä¸€ä¸ªä»“åº“ä¸­ï¼Œä½†å„è‡ªä¿æŒç‹¬ç«‹çš„åŒæ—¶ä¹Ÿå¯ä»¥å…±äº«ä»£ç å’Œä¾èµ–</p><p>é€šè¿‡å·¥å…·ï¼ˆå¦‚ Lernaã€Turborepoã€Nxã€pnpm workspaceï¼‰ç»Ÿä¸€ç®¡ç†ä¾èµ–å’Œæ„å»ºã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">monorepo/</span><br><span class="line">â”œâ”€â”€ packages/</span><br><span class="line">â”‚   â”œâ”€â”€ ui-components/      # å…±äº«UIç»„ä»¶åº“</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ src/</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ dist/</span><br><span class="line">â”‚   â”‚   â””â”€â”€ <span class="keyword">package</span>.json</span><br><span class="line">â”‚   â”œâ”€â”€ webapp/             # ä¸»è¦çš„Webåº”ç”¨</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ <span class="keyword">public</span>/</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ src/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ assets/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ components/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ views/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ router/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ store/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ utils/</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ App.vue</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ main.js</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ <span class="keyword">package</span>.json</span><br><span class="line">â”‚   â”‚   â””â”€â”€ vue.config.js</span><br><span class="line">â”‚   â”œâ”€â”€ admin-panel/        # åå°ç®¡ç†ç³»ç»Ÿ</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ <span class="keyword">public</span>/</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ src/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ assets/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ components/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ views/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ router/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ store/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ utils/</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ App.vue</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ main.js</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ <span class="keyword">package</span>.json</span><br><span class="line">â”‚   â”‚   â””â”€â”€ vue.config.js</span><br><span class="line">â”œâ”€â”€ lerna.json              # å¦‚æœä½¿ç”¨Lernaæ¥ç®¡ç†å¤šåŒ…</span><br><span class="line">â”œâ”€â”€ <span class="keyword">package</span>.json            # æ ¹çº§<span class="keyword">package</span>.jsonæ–‡ä»¶</span><br><span class="line">â””â”€â”€ .gitignore</span><br></pre></td></tr></table></figure><h4 id="ä¼˜åŠ¿-1"><a href="#ä¼˜åŠ¿-1" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h4><p>å¤ç”¨æ€§å¼ºã€å…¬å…±æ¨¡å—å¯æœ¬åœ°é“¾æ¥å¼•ç”¨</p><p>workspaceæœºåˆ¶å…±äº«ä¾èµ–ï¼ˆå¤šä¸ªå·¥ä½œåŒºé…ç½®å…±åŒå¼•ç”¨ä¸€ä¸ªæ ¹ç›®å½•ä¸‹çš„ <code>package.json</code> æ–‡ä»¶ï¼‰å› æ­¤å·¥å…·é“¾ä¹Ÿæ˜¯ç»Ÿä¸€çš„</p><h4 id="ç¼ºé™·-1"><a href="#ç¼ºé™·-1" class="headerlink" title="ç¼ºé™·"></a>ç¼ºé™·</h4><p>æ„å»ºé…ç½®å¤æ‚ï¼Œéœ€è¦å¤„ç†å¤šåŒ…æ„å»ºã€ä¾èµ–è§£æã€ç¼“å­˜ä¼˜åŒ–ç­‰é—®é¢˜</p><p>æƒé™æ§åˆ¶å¼±ï¼Œæ‰€æœ‰ä»£ç éƒ½åœ¨ä¸€ä¸ªä»“åº“ï¼Œéš¾ä»¥å¯¹ä¸åŒå›¢é˜Ÿè®¾ç½®ç»†ç²’åº¦è®¿é—®æƒé™ï¼ˆä½†åœ¨å…¬å¸å±‚é¢æœ‰è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚å­—èŠ‚ï¼Œå¯ä»¥æŒ‡å®šæŸä¸ªæ–‡ä»¶å¤¹çš„å¯è®¿é—®è€…æ˜¯å“ªäº›äººï¼‰</p><p>ä»“åº“ä½“ç§¯å¤§ï¼Œéšç€é¡¹ç›®çš„å¢é•¿ï¼Œæ‰€æœ‰çš„ä»£ç å˜æ›´ã€æäº¤éƒ½ä¼šè¢«è®°å½•åœ¨åŒä¸€ä¸ª Git ä»“åº“çš„å†å²ä¸­ï¼Œå®ƒçš„ <code>.git</code> æ–‡ä»¶å¤¹å¯èƒ½ä¼šå˜å¾—éå¸¸åºå¤§</p><h4 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><p><strong>Lerna</strong>ï¼šæœ€æ—©çš„ Monorepo ç®¡ç†å·¥å…·ï¼Œé€‚åˆå‘å¸ƒç®¡ç†ã€‚</p><p><strong>Turborepo</strong>ï¼šé«˜æ€§èƒ½æ„å»ºç³»ç»Ÿï¼Œæ”¯æŒä»»åŠ¡ç¼“å­˜ä¸å¹¶è¡Œæ‰§è¡Œã€‚</p><p><strong>Nx</strong>ï¼šåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒä»£ç ç”Ÿæˆã€å½±å“åˆ†æã€ä»»åŠ¡è°ƒåº¦ã€‚</p><p><strong>pnpm workspace</strong>ï¼šè½»é‡çº§ï¼Œé€šè¿‡ <code>pnpm</code> åŸç”Ÿæ”¯æŒ workspaceï¼Œæ­é… <code>turbo</code> æ•ˆæœæ›´ä½³ã€‚</p><blockquote><p><strong><code>pnpm workspace</code></strong> <strong>éå¸¸é€‚ç”¨äº Monorepo æ¶æ„</strong></p><ul><li><strong>ä¸‹è½½é€Ÿåº¦</strong>ï¼š<code>pnpm</code> åœ¨<em><strong>å®‰è£…</strong></em>ä¾èµ–æ—¶é€šå¸¸æ¯”å…¶ä»–åŒ…ç®¡ç†å™¨æ›´<em><strong>å¿«</strong></em>ï¼Œè¿™å¯¹äºå¤§å‹ Monorepo æ¥è¯´å°¤ä¸ºé‡è¦</li><li><strong>ä¾èµ–ç®¡ç†</strong>ï¼šä¸åŒäº <code>npm3.x+</code> å’Œ <code>yarn1.x+</code> å°†æ‰€æœ‰ä¾èµ–æ‰å¹³åŒ–æ”¾ç½®åœ¨æ ¹ç›®å½•ä¸‹çš„åšæ³•ï¼Œ<code>pnpm</code> çš„ä¾èµ–å­˜å‚¨æ˜¯æ ‘çŠ¶çš„ï¼Œä¿æŒäº†ä¾èµ–æ ‘çš„ç»“æ„æ¸…æ™°åº¦ï¼Œè¿˜é¿å…äº†æ½œåœ¨çš„å®‰å…¨é£é™©ï¼ˆä¾èµ–åŠ«æŒï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œnpm ä¹‹å‰ä¹Ÿæ˜¯ä¸¥æ ¼æ ‘å½¢çš„ï¼Œä½†ç”±äºæ²¡æœ‰åšå»é‡ï¼Œå¯¼è‡´ node_modules ç›®å½•å·¨å¤§ã€‚å› æ­¤æœ‰ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„å›¾ï¼Œnode_modules å¤§äºé»‘æ´</li><li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼šå¤šä¸ªåŒ…å¦‚æœæœ‰é‡å¤çš„ä¾èµ–é¡¹ï¼Œé€šè¿‡ <code>pnpm workspace</code>ï¼Œæ‰€æœ‰å·¥ä½œåŒºï¼ˆå³å­åŒ…ï¼‰å¯ä»¥<em><strong>å…±äº«</strong></em>åŒä¸€ä¸ª <code>node_modules</code> ç›®å½•ä¸‹çš„<em><strong>ä¾èµ–</strong></em>ï¼Œé¿å…äº†æ¯ä¸ªåŒ…å•ç‹¬å®‰è£…ç›¸åŒä¾èµ–çš„æƒ…å†µï¼ŒèŠ‚çœäº†ç£ç›˜ç©ºé—´å’Œå®‰è£…æ—¶é—´</li><li>å¤šåŒ…ç›¸åŒä¾èµ–</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">node_modules/</span><br><span class="line">â”œâ”€â”€ .pnpm/</span><br><span class="line">â”‚   â”œâ”€â”€ lodash@4.17.21/</span><br><span class="line">â”‚   â”‚   â””â”€â”€ node_modules/</span><br><span class="line">â”‚   â”‚       â””â”€â”€ lodash -&gt; å®é™…æ–‡ä»¶ï¼ˆåªå­˜ä¸€ä»½ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ vue@3.2.0/</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ packages/</span><br><span class="line">â”‚   â”œâ”€â”€ ui-components/</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ package.json</span><br><span class="line">â”‚   â”‚   â””â”€â”€ node_modules/</span><br><span class="line">â”‚   â”‚       â””â”€â”€ lodash -&gt; ../../node_modules/lodash ï¼ˆè½¯é“¾æ¥ï¼‰</span><br><span class="line">â”‚   â””â”€â”€ webapp/</span><br><span class="line">â”‚       â”œâ”€â”€ package.json</span><br><span class="line">â”‚       â””â”€â”€ node_modules/</span><br><span class="line">â”‚           â”œâ”€â”€ lodash -&gt; ../../node_modules/lodash ï¼ˆè½¯é“¾æ¥ï¼‰</span><br><span class="line">â”‚           â””â”€â”€ vue -&gt; ../../node_modules/vue</span><br><span class="line">â”‚</span><br><span class="line">â””â”€â”€ pnpm-workspace.yaml</span><br></pre></td></tr></table></figure><ul><li>å¤šåŒ…ä¸åŒä¾èµ–</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">node_modules/</span><br><span class="line">â”œâ”€â”€ .pnpm/</span><br><span class="line">â”‚   â”œâ”€â”€ lodash@4.0.0/</span><br><span class="line">â”‚   â”‚   â””â”€â”€ node_modules/</span><br><span class="line">â”‚   â”‚       â””â”€â”€ lodash -&gt; å®é™…æ–‡ä»¶ v4.0.0</span><br><span class="line">â”‚   â””â”€â”€ lodash@4.17.21/</span><br><span class="line">â”‚       â””â”€â”€ node_modules/</span><br><span class="line">â”‚           â””â”€â”€ lodash -&gt; å®é™…æ–‡ä»¶ v4.17.21</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ packages/</span><br><span class="line">â”‚   â”œâ”€â”€ legacy-app/</span><br><span class="line">â”‚   â”‚   â””â”€â”€ node_modules/</span><br><span class="line">â”‚   â”‚       â””â”€â”€ lodash -&gt; ../../../node_modules/.pnpm/lodash@4.0.0/node_modules/lodash</span><br><span class="line">â”‚   â”œâ”€â”€ modern-app/</span><br><span class="line">â”‚   â”‚   â””â”€â”€ node_modules/</span><br><span class="line">â”‚   â”‚       â””â”€â”€ lodash -&gt; ../../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash</span><br><span class="line">â”‚   â””â”€â”€ utility-lib/</span><br><span class="line">â”‚       â””â”€â”€ node_modules/</span><br><span class="line">â”‚           â””â”€â”€ lodash -&gt; ../../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash</span><br></pre></td></tr></table></figure></blockquote><h4 id="é€‚ç”¨-1"><a href="#é€‚ç”¨-1" class="headerlink" title="é€‚ç”¨"></a>é€‚ç”¨</h4><p>ä¸­å¤§å‹é¡¹ç›®ï¼Œå¤šä¸ªå­é¡¹ç›®&#x2F;å¾®é¡¹ç›®å…±å­˜</p><p>éœ€è¦å¤§é‡å…±äº«ä»£ç çš„å›¢é˜Ÿï¼ˆç»„ä»¶åº“ï¼‰</p><p>ç»Ÿä¸€æŠ€æœ¯æ ˆå’Œå·¥ç¨‹è§„èŒƒçš„ç»„ç»‡</p><p>å¼€æºé¡¹ç›®</p><h2 id="Multirepo"><a href="#Multirepo" class="headerlink" title="Multirepo"></a>Multirepo</h2><p><strong>å¤šä»“å¤šæ¨¡å—</strong> æ¶æ„</p><blockquote><p>æ¯ä¸ªåŠŸèƒ½æ¨¡å—æˆ–æœåŠ¡å¯èƒ½ä¼šè¢«ç‹¬ç«‹æ”¾ç½®åœ¨ä¸€ä¸ªå•ç‹¬çš„ Git ä»“åº“ä¸­</p><p>ä»¥ä¸¤ä¸ª Vue åº”ç”¨ä¸ºä¾‹ï¼Œåˆ†åˆ«ä»£è¡¨ <em>å‰ç«¯ç”¨æˆ·ç•Œé¢</em> å’Œ <em>æœåŠ¡ç«¯æ¸²æŸ“åº”ç”¨</em></p></blockquote><p>ç”¨æˆ·ç•Œé¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">frontend-ui/</span><br><span class="line">â”œâ”€â”€ public/</span><br><span class="line">â”œâ”€â”€ src/</span><br><span class="line">â”‚   â”œâ”€â”€ assets/</span><br><span class="line">â”‚   â”œâ”€â”€ components/</span><br><span class="line">â”‚   â”œâ”€â”€ views/</span><br><span class="line">â”‚   â”œâ”€â”€ router/</span><br><span class="line">â”‚   â”œâ”€â”€ store/</span><br><span class="line">â”‚   â”œâ”€â”€ utils/</span><br><span class="line">â”‚   â””â”€â”€ App.vue</span><br><span class="line">â”‚   â””â”€â”€ main.js</span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â””â”€â”€ vue.config.js</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ssr-app/</span><br><span class="line">â”œâ”€â”€ src/</span><br><span class="line">â”‚   â”œâ”€â”€ server/</span><br><span class="line">â”‚   â”œâ”€â”€ client/</span><br><span class="line">â”‚   â”œâ”€â”€ assets/</span><br><span class="line">â”‚   â”œâ”€â”€ components/</span><br><span class="line">â”‚   â”œâ”€â”€ views/</span><br><span class="line">â”‚   â”œâ”€â”€ router/</span><br><span class="line">â”‚   â”œâ”€â”€ store/</span><br><span class="line">â”‚   â”œâ”€â”€ utils/</span><br><span class="line">â”‚   â””â”€â”€ entry-client.js</span><br><span class="line">â”‚   â””â”€â”€ entry-server.js</span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â””â”€â”€ vue.config.js</span><br></pre></td></tr></table></figure><h4 id="ä¼˜åŠ¿-2"><a href="#ä¼˜åŠ¿-2" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h4><p>é«˜åº¦è§£è€¦ï¼Œæ¯ä¸ªä»“åº“ç‹¬ç«‹å¼€å‘ï¼Œéƒ¨ç½²ï¼Œç‰ˆæœ¬æ§åˆ¶äº’ä¸ä¾èµ–</p><p>æƒé™ç®¡ç†æ¸…æ™°ï¼Œå¯ä¸ºä¸åŒå›¢é˜Ÿåˆ†é…ä¸åŒä»“åº“çš„è®¿é—®æƒé™</p><p>æŠ€æœ¯æ ˆçµæ´»ï¼Œæ¯ä¸ªä»“åº“å¯ä½¿ç”¨ä¸åŒçš„è¯­è¨€ã€æ¡†æ¶ã€æŠ€æœ¯æ ˆã€æ„å»ºå·¥å…·</p><p>é€‚åˆå¾®æœåŠ¡æ¶æ„æˆ–è·¨å›¢é˜Ÿåä½œï¼Œä¾¿äºé¡¹ç›®äº¤æ¥æˆ–å¤–åŒ…</p><h4 id="ç¼ºé™·-2"><a href="#ç¼ºé™·-2" class="headerlink" title="ç¼ºé™·"></a>ç¼ºé™·</h4><p>ä»£ç å¤ç”¨å›°éš¾ï¼Œå…±åŒé€»è¾‘å¾—é€šè¿‡npmå‘å¸ƒï¼Œæœ¬åœ°è°ƒè¯•ä¸ä¾¿ï¼Œè¿­ä»£å‘¨æœŸé•¿</p><p>ä¾èµ–ç®¡ç†åˆ†æ•£ï¼Œæ¯ä¸ªä»“åº“å®¹æ˜“å‡ºç°ç‰ˆæœ¬ä¸ä¸€è‡´çš„é—®é¢˜</p><p>ä¿®æ”¹ä¸€ä¸ªå…¬å…±åº“éœ€è¦å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œå¹¶æ‰‹åŠ¨æ›´æ–°æ‰€æœ‰ä¾èµ–é¡¹ç›®</p><p>CI&#x2F;CDé…ç½®é‡å¤ï¼Œæ¯ä¸ªä»“åº“éœ€è¦é…ç½®ç‹¬ç«‹çš„æµæ°´çº¿ï¼Œç»´æŠ¤æˆæœ¬é«˜</p><h4 id="é€‚ç”¨-2"><a href="#é€‚ç”¨-2" class="headerlink" title="é€‚ç”¨"></a>é€‚ç”¨</h4><p>å¤šå›¢é˜Ÿç‹¬ç«‹å¼€å‘ï¼ŒèŒè´£è¾¹ç•Œæ¸…æ™°</p><p>å¾®æœåŠ¡æ¶æ„ï¼ŒæœåŠ¡é—´æ¾è€¦åˆ</p><p>ç¬¬ä¸‰æ–¹åˆä½œæˆ–å¤–åŒ…</p><p>å¯¹å®‰å…¨æ€§å’Œæƒé™æ§åˆ¶è¦æ±‚é«˜çš„ä¼ä¸š</p><h2 id="æ¶æ„æ€»ç»“"><a href="#æ¶æ„æ€»ç»“" class="headerlink" title="æ¶æ„æ€»ç»“"></a>æ¶æ„æ€»ç»“</h2><table><thead><tr><th><strong>ç»´åº¦</strong></th><th><strong>Monolithic</strong></th><th><strong>Monorepo</strong></th><th><strong>Multirepo</strong></th></tr></thead><tbody><tr><td><strong>å¤æ‚åº¦</strong></td><td>ä½</td><td>ä¸­~é«˜</td><td>ä¸­</td></tr><tr><td><strong>å¼€å‘æ•ˆç‡</strong></td><td>é«˜ï¼ˆåˆæœŸï¼‰</td><td>é«˜ï¼ˆä¸­åæœŸï¼‰</td><td>ä¸€èˆ¬</td></tr><tr><td><strong>ä»£ç å¤ç”¨æ€§</strong></td><td>ä½</td><td>é«˜</td><td>ä½ï¼ˆéœ€å‘å¸ƒNPMï¼‰</td></tr><tr><td><strong>æ„å»ºéƒ¨ç½²</strong></td><td>ç®€å•</td><td>å¤æ‚ï¼ˆéœ€å·¥å…·æ”¯æŒï¼‰</td><td>ç‹¬ç«‹ï¼Œä½†é‡å¤é…ç½®</td></tr><tr><td><strong>å›¢é˜Ÿåä½œ</strong></td><td>å°å›¢é˜Ÿå‹å¥½</td><td>å¤§å›¢é˜Ÿ&#x2F;è·¨å›¢é˜Ÿåä½œä½³</td><td>å›¢é˜Ÿé—´è§£è€¦å¥½</td></tr><tr><td><strong>æƒé™æ§åˆ¶</strong></td><td>å¼±</td><td>å¼±</td><td>å¼º</td></tr><tr><td><strong>æŠ€æœ¯çµæ´»æ€§</strong></td><td>ä½</td><td>ä¸­ï¼ˆå¯å¤šæŠ€æœ¯æ ˆï¼‰</td><td>é«˜</td></tr><tr><td><strong>é€‚åˆé¡¹ç›®è§„æ¨¡</strong></td><td>å°å‹</td><td>ä¸­å¤§å‹</td><td>ä¸­å¤§å‹</td></tr><tr><td><strong>å…¸å‹ä»£è¡¨</strong></td><td>ä¼ ç»Ÿå•ä½“åº”ç”¨</td><td>Vueã€Reactã€Angular</td><td>å¾®æœåŠ¡æ¶æ„ã€å¼€æºç”Ÿæ€</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨å‰ç«¯ï¼Œä»€ä¹ˆæ˜¯æµ‹è¯•</title>
      <link href="/2025/08/22/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E5%9C%A8%E5%89%8D%E7%AB%AF%E4%BB%80%E4%B9%88%E6%98%AF%E6%B5%8B%E8%AF%95/"/>
      <url>/2025/08/22/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E5%9C%A8%E5%89%8D%E7%AB%AF%E4%BB%80%E4%B9%88%E6%98%AF%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆè¦æµ‹è¯•"><a href="#ä¸ºä»€ä¹ˆè¦æµ‹è¯•" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æµ‹è¯•"></a>ä¸ºä»€ä¹ˆè¦æµ‹è¯•</h2><p>ç°åœ¨çš„å‰ç«¯ä¸åªæ˜¯â€œå†™é¡µé¢â€</p><blockquote><p>è¡¨å•è¦æ ¡éªŒã€è¦é˜²é‡å¤æäº¤</p><p>æŒ‰é’®è¦ç‚¹äº†å˜ loading</p><p>å¼¹çª—è¦æ§åˆ¶æ˜¾ç¤ºéšè—</p><p>ç»„ä»¶ä¹‹é—´è¦ä¼ å€¼ã€é€šä¿¡</p></blockquote><p>è€Œè¿™äº›éƒ½æ˜¯é€»è¾‘ï¼Œæ—¢ç„¶æœ‰é€»è¾‘ï¼Œå°±å¯èƒ½å‡ºé”™</p><p>æ¯”å¦‚æŸä¸ªæŒ‰é’®å¤±çµäº†ï¼Œæ€»ä¸èƒ½æ¯æ¬¡éƒ½æ‰‹åŠ¨ç‚¹ä¸€éçœ‹äº‹ä»¶æŠ¥é”™å§</p><h2 id="ä¸‰å±‚æµ‹è¯•"><a href="#ä¸‰å±‚æµ‹è¯•" class="headerlink" title="ä¸‰å±‚æµ‹è¯•"></a>ä¸‰å±‚æµ‹è¯•</h2><blockquote><p>åˆ«è¢«â€œå•å…ƒæµ‹è¯•â€â€œE2Eâ€è¿™äº›è¯å“åˆ°ï¼Œå…¶å®å°±ä¸‰ç±»ï¼š</p></blockquote><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a><strong>å•å…ƒæµ‹è¯•</strong></h3><blockquote><p><strong>æµ‹ä¸€ä¸ªé›¶ä»¶ï¼Œä¹Ÿå«â€œå•æµ‹â€</strong></p></blockquote><p>æ¯”å¦‚ä½ å†™äº†ä¸ª <code>&lt;Button /&gt;</code> ç»„ä»¶ï¼Œå°±å•ç‹¬æµ‹å®ƒï¼š</p><ul><li>æ–‡å­—å¯¹ä¸å¯¹ï¼Ÿ</li><li>loading æ—¶æ˜¾ç¤ºå•¥ï¼Ÿ</li><li>ç‚¹äº†ä¼šä¸ä¼šè§¦å‘äº‹ä»¶ï¼Ÿ</li></ul><p>å·¥å…·ï¼š<strong>Vitest</strong>ï¼ˆå¿«ä¸”ç®€å•ï¼Œå’Œ Vite é€‚é…ï¼‰</p><h3 id="é›†æˆæµ‹è¯•"><a href="#é›†æˆæµ‹è¯•" class="headerlink" title="é›†æˆæµ‹è¯•"></a><strong>é›†æˆæµ‹è¯•</strong></h3><blockquote><p>æµ‹å‡ ä¸ªé›¶ä»¶åˆåœ¨ä¸€èµ·</p></blockquote><p>æ¯”å¦‚ä½ æœ‰ä¸ªç™»å½•è¡¨å•ï¼Œç”¨äº† <code>&lt;Input /&gt;</code>ã€<code>&lt;Button /&gt;</code>ï¼Œè¿˜è¦è°ƒ API</p><p>ä½ å¾—æµ‹ï¼š</p><ul><li>è¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œç‚¹ç™»å½•ï¼Œæ˜¯ä¸æ˜¯è°ƒäº† APIï¼Ÿ</li><li>æ ¡éªŒå¤±è´¥ï¼Œæœ‰æ²¡æœ‰æç¤ºï¼Ÿ</li></ul><p>å·¥å…·ï¼šè¿˜æ˜¯ <strong>Vitest + Mock</strong>ï¼ˆå‡è£…è°ƒæ¥å£ï¼‰</p><h3 id="E2E-æµ‹è¯•"><a href="#E2E-æµ‹è¯•" class="headerlink" title="E2E æµ‹è¯•"></a><strong>E2E æµ‹è¯•</strong></h3><blockquote><p>æ¨¡æ‹Ÿç”¨æˆ·çœŸå®æ“ä½œ</p></blockquote><p>æ¯”å¦‚ä½ è®©ç”¨æˆ·ä»ç™»å½•åˆ°ä¸‹å•ï¼Œèµ°å®Œæ•´æµç¨‹</p><p>ä½ å†™ä¸ªè„šæœ¬ï¼Œè®©ç”µè„‘è‡ªåŠ¨ï¼š</p><ul><li>æ‰“å¼€æµè§ˆå™¨</li><li>è¾“å…¥è´¦å·å¯†ç </li><li>ç‚¹ç™»å½•</li><li>åŠ å…¥è´­ç‰©è½¦</li><li>æäº¤è®¢å•</li></ul><p>å·¥å…·æ¨èï¼š<strong>Playwright</strong>ï¼ˆæ¯” Puppeteer æ›´ç¨³ï¼‰</p><h2 id="æµ‹è¯•å®è·µ"><a href="#æµ‹è¯•å®è·µ" class="headerlink" title="æµ‹è¯•å®è·µ"></a>æµ‹è¯•å®è·µ</h2><p>æˆ‘ä»¥å‰è§‰å¾— â€œå†™æµ‹è¯•ä¼šä¸ä¼šæ¯”å†™ä»£ç è¿˜éš¾â€ï¼Œç›´åˆ°æˆ‘æ¥è§¦äº†ç»„ä»¶åº“è¯•äº† Vitestï¼Œæ‰å‘ç°å…¶å®å¾ˆç®€å•ä¾¿æ·ï¼ˆï¼‰</p><p>å…ˆè£…ä¸ªå·¥å…·ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">pnpm</span> <span class="string">install</span> <span class="string">-D</span> <span class="string">vitest</span> <span class="string">@testing-library/vue</span></span><br></pre></td></tr></table></figure><p>ç„¶åå†™ä¸ªæµ‹è¯•æ–‡ä»¶ <code>Button.test.js</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render, screen &#125; <span class="keyword">from</span> <span class="string">&#x27;@testing-library/vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> userEvent <span class="keyword">from</span> <span class="string">&#x27;@testing-library/user-event&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Button</span> <span class="keyword">from</span> <span class="string">&#x27;./Button.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•1ï¼šæŒ‰é’®æ–‡å­—å¯¹ä¸å¯¹ï¼Ÿ</span></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;åº”è¯¥æ˜¾ç¤ºâ€œç‚¹å‡»æˆ‘â€&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="title class_">Button</span>, &#123;</span><br><span class="line">    <span class="attr">slots</span>: &#123; <span class="attr">default</span>: <span class="string">&#x27;ç‚¹å‡»æˆ‘&#x27;</span> &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// çœ‹é¡µé¢ä¸Šæœ‰æ²¡æœ‰â€œç‚¹å‡»æˆ‘â€è¿™ä¸‰ä¸ªå­—</span></span><br><span class="line">  <span class="title function_">expect</span>(screen.<span class="title function_">getByText</span>(<span class="string">&#x27;ç‚¹å‡»æˆ‘&#x27;</span>)).<span class="title function_">toBeInTheDocument</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•2ï¼šç‚¹äº†æŒ‰é’®ï¼Œä¼šä¸ä¼šè§¦å‘ click äº‹ä»¶ï¼Ÿ</span></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;ç‚¹å‡»æŒ‰é’®åº”è¯¥è§¦å‘ click&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> user = userEvent.<span class="title function_">setup</span>()</span><br><span class="line">  <span class="keyword">const</span> &#123; emitted &#125; = <span class="title function_">render</span>(<span class="title class_">Button</span>, &#123;</span><br><span class="line">    <span class="attr">slots</span>: &#123; <span class="attr">default</span>: <span class="string">&#x27;ç‚¹å‡»æˆ‘&#x27;</span> &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»</span></span><br><span class="line">  <span class="keyword">await</span> user.<span class="title function_">click</span>(screen.<span class="title function_">getByRole</span>(<span class="string">&#x27;button&#x27;</span>))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ£€æŸ¥æœ‰æ²¡æœ‰ emit å‡º click äº‹ä»¶</span></span><br><span class="line">  <span class="title function_">expect</span>(<span class="title function_">emitted</span>().<span class="property">click</span>).<span class="title function_">toBeTruthy</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å†™å®Œåï¼Œå‘½ä»¤è¡Œè·‘ä¸€ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">npx</span> <span class="string">vitest</span></span><br></pre></td></tr></table></figure><p>ç»¿äº†å°±è¯´æ˜é€šè¿‡äº†</p><p>çº¢çš„è¿˜ä¼šç»™ä½ æŒ‡å‡ºå“ªä¸ªæµ‹è¯•ç‚¹å‡ºäº†é—®é¢˜ï¼Œå¹¶ä¸”æœŸæœ›å€¼&#x2F;ç±»åº”è¯¥æ˜¯ä»€ä¹ˆ</p><h2 id="è¦†ç›–ç‡"><a href="#è¦†ç›–ç‡" class="headerlink" title="è¦†ç›–ç‡"></a>è¦†ç›–ç‡</h2><p>è¦†ç›–ç‡å°±æ˜¯â€œ<strong>ä½ å†™çš„ä»£ç ï¼Œæœ‰æ²¡æœ‰è¢«æµ‹è¯•â€˜è·‘è¿‡â€™</strong>â€</p><p>è‹¥æ˜¯ <strong>100%è¦†ç›–ç‡</strong>ï¼Œæ„å‘³ç€ä½ å†™çš„ä»£ç çš„æ‰€æœ‰é€»è¾‘éƒ½è¢«å®Œå…¨æ‰§è¡Œè¿‡</p><p>è¦†ç›–ç‡æœ‰ä»¥ä¸‹å››ä¸ªæŒ‡æ ‡</p><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>è¡Œè¦†ç›–ç‡ï¼ˆ<strong>Line</strong> Coverageï¼‰</td><td>æ¯<strong>ä¸€è¡Œä»£ç </strong>æ˜¯å¦è¢«æ‰§è¡Œ</td></tr><tr><td>è¯­å¥è¦†ç›–ç‡ï¼ˆ<strong>Statement</strong> Coverageï¼‰</td><td>æ¯ä¸ª<strong>ç‹¬ç«‹è¯­å¥</strong>æ˜¯å¦æ‰§è¡Œ</td></tr><tr><td>åˆ†æ”¯è¦†ç›–ç‡ï¼ˆ<strong>Branch</strong> Coverageï¼‰</td><td>æ¯ä¸ª <strong>if&#x2F;elseã€ä¸‰å…ƒè¿ç®—ç¬¦ç­‰åˆ†æ”¯</strong>æ˜¯å¦è¦†ç›–</td></tr><tr><td>å‡½æ•°è¦†ç›–ç‡ï¼ˆ<strong>Function</strong> Coverageï¼‰</td><td>æ¯ä¸ª<strong>å‡½æ•°</strong>æ˜¯å¦è‡³å°‘è°ƒç”¨ä¸€æ¬¡</td></tr></tbody></table><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=NzY3ZTAzODBjNWJlNjIxYWJiOWJhNGZkNzNlMzVhNzVfZW10clpDM2Q2cmVFRmxmU2NKQkdaMVZxNUZNZkxtZUxfVG9rZW46Tk1XS2JTdk9Ub0d3RWl4Q0daRGMyanNwblplXzE3NTU3OTg5MDU6MTc1NTgwMjUwNV9WNA" alt="img"></p><p>ä½†ï¼Œå®ƒåªè¡¨ç¤º <strong>æ‰€æœ‰ä»£ç éƒ½è¢«æµ‹è¯•æ‰§è¡Œäº†ä¸€é</strong>ï¼Œ<strong>ä½†ä¸ä¿è¯é€»è¾‘æ­£ç¡®</strong></p><blockquote><p>å‡è®¾ä½ å†™äº†ä¸ªå‡½æ•°ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">function</span> <span class="string">divide(a,</span> <span class="string">b)</span> &#123;</span><br><span class="line">  <span class="string">return</span> <span class="string">a</span> <span class="string">/</span> <span class="string">b;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å†™äº†ä¸¤ä¸ªæµ‹è¯•ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">test(&#x27;2é™¤ä»¥1ç­‰äº2&#x27;,</span> <span class="string">()</span> <span class="string">=&gt;</span> &#123;</span><br><span class="line">  <span class="string">expect(divide(2</span>, <span class="number">1</span><span class="string">)).toBe(2);</span></span><br><span class="line">&#125;<span class="string">);</span></span><br><span class="line"></span><br><span class="line"><span class="string">test(&#x27;3é™¤ä»¥1ç­‰äº3&#x27;,</span> <span class="string">()</span> <span class="string">=&gt;</span> &#123;</span><br><span class="line">  <span class="string">expect(divide(3</span>, <span class="number">1</span><span class="string">)).toBe(3);</span></span><br><span class="line">&#125;<span class="string">);</span></span><br></pre></td></tr></table></figure><p>è¦†ç›–ç‡ï¼š100%ï¼ˆåªæœ‰ä¸€è¡Œä»£ç ï¼Œè¢«æ‰§è¡Œäº†ï¼‰</p><p>ä½†é—®é¢˜ï¼š<strong>æ²¡æµ‹</strong> <strong><code>b=0</code></strong> <strong>çš„æƒ…å†µï¼</strong> ä¼šè¿”å› <code>Infinity</code>ï¼Œå®é™…åº”è¯¥æŠ›é”™æˆ–æç¤º</p><p>æ‰€ä»¥ï¼š<strong>è¦†ç›–ç‡æ˜¯â€œå¹¿åº¦â€ï¼Œä¸æ˜¯â€œæ·±åº¦â€</strong></p></blockquote><p>è€Œä¸”ä¸è¦ä¸º 100% è€Œå†™æ— æ„ä¹‰çš„æµ‹è¯•ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">test(&#x27;1</span> <span class="string">+</span> <span class="number">1</span> <span class="string">åº”è¯¥ç­‰äº</span> <span class="number">2</span><span class="string">&#x27;, () =&gt; &#123;</span></span><br><span class="line"><span class="string">  expect(1 + 1).toBe(2)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•çš„ç›®çš„æ˜¯ä¿éšœæ ¸å¿ƒé€»è¾‘ï¼Œä¸æ˜¯å‡‘æ•°</strong></p><p>æŠŠç›®æ ‡å®šåœ¨ <strong>80% å·¦å³çš„è¡Œè¦†ç›– + 100% å…³é”®åˆ†æ”¯è¦†ç›–</strong>ï¼Œæ¯”æ­»ç£• 100% æ›´æœ‰ä»·å€¼ã€‚</p><h2 id="æµ‹è¯•çš„å¥½å¤„"><a href="#æµ‹è¯•çš„å¥½å¤„" class="headerlink" title="æµ‹è¯•çš„å¥½å¤„"></a>æµ‹è¯•çš„å¥½å¤„</h2><p><strong>æ•¢æ”¹ä»£ç äº†</strong>ï¼Œä»¥å‰æˆ‘æœ€æ€•æ”¹è€ä»£ç ï¼Œæ€»è§‰å¾—â€œåŠ¨ä¸€å‘è€Œç‰µå…¨èº«â€</p><p>ç°åœ¨ï¼Œåªè¦æµ‹è¯•é€šè¿‡ï¼Œå°±æœ‰èƒ†å­æäº¤</p><p>è€Œä¸”è¿˜å¯ä»¥åŠ  CIï¼ˆæŒç»­é›†æˆï¼‰ï¼Œæ¯æ¬¡æäº¤ä»£ç ï¼Œæµ‹è¯•è‡ªåŠ¨è·‘ä¸€éï¼Œå¦‚æœå¤±è´¥ä¼šè‡ªåŠ¨æ‰“å›ï¼Œè°éƒ½ä¸èƒ½åˆå¹¶</p><p>å›¢é˜Ÿåä½œï¼Œä¸€ä¸‹å­å®‰å¿ƒå¤šäº†ï¼ˆbushiï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vitest æµ‹è¯•å®è·µ</title>
      <link href="/2025/08/22/%E5%B7%A5%E5%85%B7/Vitest%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5/"/>
      <url>/2025/08/22/%E5%B7%A5%E5%85%B7/Vitest%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸ºä»€ä¹ˆé€‰æ‹©Vitest"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©Vitest" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹©Vitest"></a>ä¸ºä»€ä¹ˆé€‰æ‹©Vitest</h1><h2 id="Jest-ä¸-Vitestå¯¹æ¯”"><a href="#Jest-ä¸-Vitestå¯¹æ¯”" class="headerlink" title="Jest ä¸ Vitestå¯¹æ¯”"></a>Jest ä¸ Vitestå¯¹æ¯”</h2><table><thead><tr><th></th><th><strong>Jest</strong></th><th><strong>Vitest</strong></th></tr></thead><tbody><tr><td>æ„å»ºåŸºç¡€</td><td>Webpack &#x2F; Babel</td><td>åŸç”Ÿ ESMï¼ŒåŸºäº Vite</td></tr><tr><td>å¯åŠ¨é€Ÿåº¦</td><td>è¾ƒæ…¢ï¼ˆéœ€æ‰“åŒ…ï¼Œä½†æä¾›äº†ç¼“å­˜æœºåˆ¶ï¼‰</td><td><strong>æå¿«</strong>ï¼ˆæ— éœ€æ‰“åŒ…ï¼ŒVite çš„å¿«é€Ÿå†·å¯åŠ¨ï¼ŒæŒ‰éœ€åŠ è½½ï¼‰</td></tr><tr><td>å†…å­˜å ç”¨</td><td>é«˜</td><td><strong>ä½</strong></td></tr><tr><td>è¯­æ³•æ”¯æŒ</td><td>éœ€è¦é¢å¤–çš„é…ç½®æ¥æ”¯æŒç°ä»£ JavaScriptï¼ˆä¾‹å¦‚ ES Modulesã€TypeScriptï¼‰éœ€è¦å®‰è£…é¢å¤–çš„è½¬æ¢å™¨ï¼ˆå¦‚ Babel æˆ– ts-jestï¼‰</td><td><strong>ä¸éœ€è¦é¢å¤–é€‚é…</strong></td></tr><tr><td>è°ƒè¯•ä½“éªŒ</td><td>ä¸€èˆ¬</td><td><strong>Watchå’Œçƒ­æ›´æ–°</strong>ï¼Œå¯ç›´æ¥åœ¨æµè§ˆå™¨&#x2F;VS Code ä¸­è°ƒè¯•</td></tr><tr><td>ç¤¾åŒºç”Ÿæ€</td><td><strong>æˆç†Ÿï¼Œæ’ä»¶ä¸°å¯Œ</strong></td><td>å¿«é€Ÿå‘å±•ï¼ŒVue&#x2F;React ç”Ÿæ€æ”¯æŒè‰¯å¥½</td></tr></tbody></table><p>æ‰€ä»¥ï¼Œå¯¹äºä½¿ç”¨ Vite çš„é¡¹ç›®ï¼ŒVitest æ˜¯æ›´ç°ä»£ã€æ›´é«˜æ•ˆçš„é€‰æ‹©</p><blockquote><p>âš ï¸ ä½† Jest ä»é€‚ç”¨äº Node.js æœåŠ¡ç«¯æˆ–å¤æ‚å…¼å®¹æ€§åœºæ™¯</p></blockquote><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><h2 id="æ ¸å¿ƒæµ‹è¯•å·¥å…·"><a href="#æ ¸å¿ƒæµ‹è¯•å·¥å…·" class="headerlink" title="æ ¸å¿ƒæµ‹è¯•å·¥å…·"></a>æ ¸å¿ƒæµ‹è¯•å·¥å…·</h2><h3 id="exprect"><a href="#exprect" class="headerlink" title="exprect"></a>exprect</h3><p><code>expect</code> æ–­è¨€ï¼šéªŒè¯è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«å­ä¸²</span></span><br><span class="line"><span class="title function_">expect</span>(<span class="string">&quot;Hello World&quot;</span>).<span class="title function_">toContain</span>(<span class="string">&quot;World&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ•°ç»„æ˜¯å¦åŒ…å«æŸå…ƒç´ </span></span><br><span class="line"><span class="title function_">expect</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]).<span class="title function_">toContain</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ˜¯å¦è¢«è°ƒç”¨</span></span><br><span class="line"><span class="title function_">expect</span>(mockFn).<span class="title function_">toHaveBeenCalled</span>();</span><br></pre></td></tr></table></figure><p>æ›´å¤šæ–¹æ³•</p><table><thead><tr><th><strong>åŒ¹é…å™¨</strong></th><th><strong>åŠŸèƒ½æè¿°</strong></th></tr></thead><tbody><tr><td>toBe(value)</td><td>æ£€æŸ¥å€¼æ˜¯å¦ä¸¥æ ¼ç­‰äºï¼ˆ&#x3D;&#x3D;&#x3D;ï¼‰æŒ‡å®šçš„å€¼ï¼Œé€šå¸¸ç”¨äºåŸå§‹ç±»å‹ï¼ˆå¦‚æ•°å­—ã€å­—ç¬¦ä¸²ï¼‰ã€‚</td></tr><tr><td>toEqual(value)</td><td>æ£€æŸ¥å¯¹è±¡æˆ–æ•°ç»„çš„å†…å®¹æ˜¯å¦æ·±åº¦ç›¸ç­‰ã€‚</td></tr><tr><td>toContain(item)</td><td>æ£€æŸ¥æ•°ç»„æˆ–å¯è¿­ä»£å¯¹è±¡æ˜¯å¦åŒ…å«æŒ‡å®šçš„å…ƒç´ ã€‚</td></tr><tr><td>toContainEqual(item)</td><td>æ£€æŸ¥æ•°ç»„æˆ–å¯è¿­ä»£å¯¹è±¡æ˜¯å¦åŒ…å«ä¸æŒ‡å®šå€¼æ·±åº¦ç›¸ç­‰çš„å…ƒç´ ã€‚</td></tr><tr><td>toBeTruthy()</td><td>æ£€æŸ¥å€¼æ˜¯å¦ä¸ºâ€œçœŸå€¼â€ï¼ˆtruthyï¼‰ï¼Œå³åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­ä¸º trueã€‚</td></tr><tr><td>toBeFalsy()</td><td>æ£€æŸ¥å€¼æ˜¯å¦ä¸ºâ€œå‡å€¼â€ï¼ˆfalsyï¼‰ï¼Œå³åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­ä¸º falseã€‚</td></tr><tr><td>toBeNull()</td><td>æ£€æŸ¥å€¼æ˜¯å¦ä¸º nullã€‚</td></tr><tr><td>toBeUndefined()</td><td>æ£€æŸ¥å€¼æ˜¯å¦ä¸º undefinedã€‚</td></tr><tr><td>toBeDefined()</td><td>æ£€æŸ¥å€¼æ˜¯å¦ä¸æ˜¯ undefinedã€‚</td></tr><tr><td>toBeNaN()</td><td>æ£€æŸ¥å€¼æ˜¯å¦ä¸º NaNã€‚</td></tr><tr><td>toBeGreaterThan(number)</td><td>æ£€æŸ¥å€¼æ˜¯å¦å¤§äºæŒ‡å®šçš„æ•°å­—ã€‚</td></tr><tr><td>toBeGreaterThanOrEqual(number)</td><td>æ£€æŸ¥å€¼æ˜¯å¦å¤§äºæˆ–ç­‰äºæŒ‡å®šçš„æ•°å­—ã€‚</td></tr><tr><td>toBeLessThan(number)</td><td>æ£€æŸ¥å€¼æ˜¯å¦å°äºæŒ‡å®šçš„æ•°å­—ã€‚</td></tr><tr><td>toBeLessThanOrEqual(number)</td><td>æ£€æŸ¥å€¼æ˜¯å¦å°äºæˆ–ç­‰äºæŒ‡å®šçš„æ•°å­—ã€‚</td></tr><tr><td>toHaveLength(number)</td><td>æ£€æŸ¥æ•°ç»„ã€å­—ç¬¦ä¸²æˆ–å…¶ä»–å¯è¿­ä»£å¯¹è±¡çš„é•¿åº¦æ˜¯å¦ç­‰äºæŒ‡å®šå€¼ã€‚</td></tr><tr><td>toThrow(error?)</td><td>æ£€æŸ¥å‡½æ•°æ˜¯å¦æŠ›å‡ºé”™è¯¯ï¼Œå¯ä»¥æŒ‡å®šé”™è¯¯æ¶ˆæ¯æˆ–é”™è¯¯ç±»å‹ã€‚</td></tr><tr><td>toMatch(regexpOrString)</td><td>æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼æˆ–å­å­—ç¬¦ä¸²ã€‚</td></tr><tr><td>toMatchObject(object)</td><td>æ£€æŸ¥å¯¹è±¡æ˜¯å¦éƒ¨åˆ†åŒ¹é…æŒ‡å®šçš„å¯¹è±¡ç»“æ„ã€‚</td></tr><tr><td>toHaveProperty(keyPath, value?)</td><td>æ£€æŸ¥å¯¹è±¡æ˜¯å¦å…·æœ‰æŒ‡å®šçš„å±æ€§ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ£€æŸ¥å±æ€§å€¼ã€‚</td></tr><tr><td>toBeInstanceOf(Class)</td><td>æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯æŸä¸ªç±»çš„å®ä¾‹ã€‚</td></tr><tr><td>toBeCloseTo(number, numDigits?)</td><td>æ£€æŸ¥æµ®ç‚¹æ•°æ˜¯å¦æ¥è¿‘æŒ‡å®šå€¼ï¼Œé¿å…ç²¾åº¦é—®é¢˜ã€‚</td></tr><tr><td>toHaveBeenCalled()</td><td>æ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°æ˜¯å¦è¢«è°ƒç”¨è¿‡ã€‚</td></tr><tr><td>toHaveBeenCalledTimes(number)</td><td>æ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°æ˜¯å¦è¢«è°ƒç”¨äº†æŒ‡å®šæ¬¡æ•°ã€‚</td></tr><tr><td>toHaveBeenCalledWith(â€¦args)</td><td>æ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°æ˜¯å¦è¢«è°ƒç”¨æ—¶ä¼ å…¥äº†æŒ‡å®šçš„å‚æ•°ã€‚</td></tr><tr><td>toHaveBeenLastCalledWith(â€¦args)</td><td>æ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°æœ€åä¸€æ¬¡è°ƒç”¨æ—¶æ˜¯å¦ä¼ å…¥äº†æŒ‡å®šçš„å‚æ•°ã€‚</td></tr><tr><td>toHaveBeenNthCalledWith(n, â€¦args)</td><td>æ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°ç¬¬ n æ¬¡è°ƒç”¨æ—¶æ˜¯å¦ä¼ å…¥äº†æŒ‡å®šçš„å‚æ•°ã€‚</td></tr><tr><td>toHaveReturned()</td><td>æ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°æ˜¯å¦æˆåŠŸè¿”å›ï¼ˆæ²¡æœ‰æŠ›å‡ºé”™è¯¯ï¼‰ã€‚</td></tr><tr><td>toHaveReturnedTimes(number)</td><td>æ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°æ˜¯å¦æˆåŠŸè¿”å›äº†æŒ‡å®šæ¬¡æ•°ã€‚</td></tr><tr><td>toHaveReturnedWith(value)</td><td>æ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°æ˜¯å¦è¿”å›äº†æŒ‡å®šçš„å€¼ã€‚</td></tr><tr><td>toHaveLastReturnedWith(value)</td><td>æ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°æœ€åä¸€æ¬¡è°ƒç”¨æ˜¯å¦è¿”å›äº†æŒ‡å®šçš„å€¼ã€‚</td></tr><tr><td>toHaveNthReturnedWith(n, value)</td><td>æ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°ç¬¬ n æ¬¡è°ƒç”¨æ˜¯å¦è¿”å›äº†æŒ‡å®šçš„å€¼ã€‚</td></tr><tr><td>toBeCalled()</td><td>ç­‰åŒäº toHaveBeenCalled()ï¼Œæ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°æ˜¯å¦è¢«è°ƒç”¨è¿‡ã€‚</td></tr><tr><td>toBeCalledTimes(number)</td><td>ç­‰åŒäº toHaveBeenCalledTimes(number)ï¼Œæ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°æ˜¯å¦è¢«è°ƒç”¨äº†æŒ‡å®šæ¬¡æ•°ã€‚</td></tr><tr><td>toBeCalledWith(â€¦args)</td><td>ç­‰åŒäº toHaveBeenCalledWith(â€¦args)ï¼Œæ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°æ˜¯å¦è¢«è°ƒç”¨æ—¶ä¼ å…¥äº†æŒ‡å®šå‚æ•°ã€‚</td></tr><tr><td>lastCalledWith(â€¦args)</td><td>ç­‰åŒäº toHaveBeenLastCalledWith(â€¦args)ï¼Œæ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°æœ€åä¸€æ¬¡è°ƒç”¨æ—¶æ˜¯å¦ä¼ å…¥äº†æŒ‡å®šå‚æ•°ã€‚</td></tr></tbody></table><h3 id="mount"><a href="#mount" class="headerlink" title="mount"></a>mount</h3><p><code>mount</code>ï¼šå®Œæ•´æŒ‚è½½ç»„ä»¶è¿›è¡Œæµ‹è¯•</p><blockquote><p>â— <code>mount</code> ä¸è¿”å› JSX è™šæ‹ŸèŠ‚ç‚¹ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ª Wrapper å¯¹è±¡ï¼Œç”¨äºæ“ä½œå’Œæ–­è¨€ç»„ä»¶è¡Œä¸ºã€‚</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/test-utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ButtonPlus</span> <span class="keyword">from</span> <span class="string">&#x27;./ButtonPlus.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">ButtonPlus</span>, &#123; <span class="comment">// mountï¼š@vue/test-utils æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå°† Vue ç»„ä»¶æŒ‚è½½åˆ°ä¸€ä¸ªè™šæ‹Ÿ DOM ä¸­ï¼ˆé€šå¸¸æ˜¯åœ¨ jsdom [æä¾›æµè§ˆå™¨ç¯å¢ƒ]ï¼‰</span></span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;interactive&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">slots</span>: &#123;</span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;ç‚¹å‡»æˆ‘&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>wrapper</code> æä¾›ä»¥ä¸‹å¸¸ç”¨æ–¹æ³•ï¼š</p><ul><li><code>wrapper.text()</code>ï¼šè·å–æ¸²æŸ“æ–‡æœ¬</li><li><code>wrapper.classes()</code>ï¼šè·å–ç±»åæ•°ç»„</li><li><code>wrapper.find()</code>ï¼šæŸ¥æ‰¾ DOM å…ƒç´ </li><li><code>wrapper.trigger()</code>ï¼šè§¦å‘äº‹ä»¶</li><li><code>wrapper.emitted()</code>ï¼šæ£€æŸ¥äº‹ä»¶æ˜¯å¦è¢«è§¦å‘</li></ul><blockquote><p>æ¨èä½¿ç”¨ <code>mount</code> è€Œé <code>shallowMount</code>ï¼Œä»¥æµ‹è¯•çœŸå®æ¸²æŸ“ç»“æœå’Œå­ç»„ä»¶äº¤äº’ã€‚</p></blockquote><h2 id="ç¼–å†™é«˜è´¨é‡æµ‹è¯•ç”¨ä¾‹"><a href="#ç¼–å†™é«˜è´¨é‡æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="ç¼–å†™é«˜è´¨é‡æµ‹è¯•ç”¨ä¾‹"></a>ç¼–å†™é«˜è´¨é‡æµ‹è¯•ç”¨ä¾‹</h2><h3 id="ä¸aiç»“åˆ"><a href="#ä¸aiç»“åˆ" class="headerlink" title="ä¸aiç»“åˆ"></a>ä¸aiç»“åˆ</h3><p>å…ˆä½¿ç”¨AIç¼–å†™ä¸€å¥— <em><strong>æé—®æ¨¡æ¿</strong></em></p><blockquote><p>åŒ…æ‹¬è§’è‰²<strong>èº«ä»½å®šä½</strong>(<em>äº§å“ç»ç†</em>)ã€<strong>éœ€æ±‚</strong>ã€<strong>èƒŒæ™¯</strong>ã€<strong>è¾“å‡ºè§„èŒƒ</strong>ç­‰</p><p>æ¯”å¦‚æˆ‘åœ¨å¼€å‘ç»„ä»¶åº“çš„æŒ‰é’®ğŸ‘‡</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># èº«ä»½å®šä½</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**è§’è‰²**</span>ï¼šäº’è”ç½‘äº§å“ç»ç†</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**ç›®æ ‡**</span>ï¼šäº§å“éœ€æ±‚åˆ†æå’ŒåŠŸèƒ½ç‚¹è®¾è®¡</span><br><span class="line"></span><br><span class="line"><span class="section"># éœ€æ±‚</span></span><br><span class="line"></span><br><span class="line">ä»¥&quot;[XXX]&quot;å½¢å¼å®šä¹‰å˜é‡ç”¨äºå¯¹è¯ä¸­ä¸åŒä»»åŠ¡çš„è§¦å‘æŒ‡ä»¤</span><br><span class="line">ä»¥&quot;/help&quot; ä¸ºè§¦å‘å…³é”®è¯ï¼Œåˆ—å‡ºæ‰€æœ‰å®šä¹‰çš„å˜é‡<span class="code">`**XXX**`</span>ä»¥åŠä»£è¡¨çš„ä»»åŠ¡</span><br><span class="line"></span><br><span class="line">å¯¹è¯è¿‡ç¨‹ç”¨ä¸­æ–‡äº¤æµï¼Œä¸“ä¸šæœ¯è¯­å¯ç”¨è‹±æ–‡æˆ–ç¼©å†™ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> [XQFX]:(éœ€æ±‚åˆ†æ) æ ¹æ®ç»™å‡ºçš„å†…å®¹è¾“å‡ºéœ€æ±‚åˆ†ææ–‡æ¡£ï¼ˆmdï¼‰</span><br><span class="line"><span class="bullet">-</span> [GNSJ]:(åŠŸèƒ½è®¾è®¡) ä»¥ä¸Šæ–‡ä¸­çš„ &quot;éœ€æ±‚åˆ†ææ–‡æ¡£&quot; ä¸ºä¾æ®</span><br><span class="line"></span><br><span class="line"><span class="section"># èƒŒæ™¯</span></span><br><span class="line"></span><br><span class="line">ï¼ˆé¡¹ç›®æ–‡æ¡£åœ°å€ï¼šhttps://xxx/button.com ï¼‰</span><br><span class="line"></span><br><span class="line">é¦–æ¬¡å¯è¡¥å……æé—®æ¥å®Œå–„èƒŒæ™¯</span><br><span class="line"></span><br><span class="line"><span class="section"># è¾“å‡ºè§„èŒƒ</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**éœ€æ±‚åˆ†æ**</span>[XQFX]</span><br><span class="line"><span class="bullet">  -</span> <span class="strong">**æ ¼å¼**</span>ï¼šç”¨æˆ·è°ƒç ”æ‘˜è¦ã€ç«å“å¯¹æ¯”æŠ¥å‘Šã€å¸‚åœºè¶‹åŠ¿åˆ†æã€‚</span><br><span class="line"><span class="bullet">  -</span> <span class="strong">**å†…å®¹**</span>ï¼šç”¨æˆ·ç—›ç‚¹ã€æœŸæœ›åŠŸèƒ½ã€å®‰å…¨æ€§éœ€æ±‚ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**åŠŸèƒ½ç‚¹è®¾è®¡**</span>[GNSJ]</span><br><span class="line"><span class="bullet">  -</span> <span class="strong">**æ ¼å¼**</span>ï¼šåŠŸèƒ½æè¿°ã€api è®¾è®¡ã€äº¤äº’å…³ç³»ã€‚</span><br><span class="line"><span class="bullet">  -</span> <span class="strong">**å†…å®¹**</span>ï¼šåŠŸèƒ½å®ç°ç»†èŠ‚ã€ç”¨æˆ·æ“ä½œæµç¨‹ã€å¼‚å¸¸å¤„ç†ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section"># ç¤ºä¾‹æŒ‡ä»¤</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**éœ€æ±‚åˆ†æ**</span>ï¼š[XQFX]ç»„ä»¶åº“æŒ‰é’®ç»„ä»¶ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**åŠŸèƒ½ç‚¹è®¾è®¡**</span>ï¼š[GNSJ]</span><br><span class="line"></span><br><span class="line">è¯·åœ¨åç»­å¯¹è¯ä¸­ä½¿ç”¨ä¸Šè¿°ç»“æ„å’Œç¤ºä¾‹æŒ‡ä»¤æ¥æŒ‡å¯¼ä»»åŠ¡æ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure></blockquote><p>æ¥ç€ <code>[XQFX]</code>ã€<code>[GNSJ]</code>ï¼ŒAIä¼šè¿”å›ç»™ä½  <em><strong>éœ€æ±‚åˆ†æä¸åŠŸèƒ½è®¾è®¡æ–‡æ¡£</strong></em></p><blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">å¥½çš„ï¼Œä»¥ä¸‹æ˜¯â€œButton | Leatomâ€ç»„ä»¶çš„éœ€æ±‚åˆ†æå’ŒåŠŸèƒ½è®¾è®¡æ–‡æ¡£ï¼š</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="section"># éœ€æ±‚åˆ†ææ–‡æ¡£ï¼šButton | Leatom ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="section">## ä¸€ã€ç”¨æˆ·è°ƒç ”æ‘˜è¦</span></span><br><span class="line"></span><br><span class="line"><span class="section">### ç”¨æˆ·ç—›ç‚¹</span></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="section"># åŠŸèƒ½ç‚¹è®¾è®¡æ–‡æ¡£ï¼šButtonPlus | Veyra ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="section">## ä¸€ã€åŠŸèƒ½æè¿°</span></span><br><span class="line"></span><br><span class="line"><span class="section">### 1.1 åŠŸèƒ½ç›®æ ‡</span></span><br><span class="line">è®¾è®¡ä¸€ä¸ªå…·æœ‰ä¸°å¯Œè§†è§‰ç‰¹æ•ˆå’Œé«˜åº¦å¯å®šåˆ¶æ€§çš„æŒ‰é’®ç»„ä»¶ï¼Œä»¥æ»¡è¶³ä¸åŒç”¨æˆ·çš„éœ€æ±‚ï¼ŒåŒæ—¶æå‡å¼€å‘æ•ˆç‡ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">### 1.2 åŠŸèƒ½èŒƒå›´</span></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="section">## ä¸‰ã€äº¤äº’å…³ç³»</span></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">ä»¥ä¸Šæ˜¯â€œButton | Leatomâ€ç»„ä»¶çš„éœ€æ±‚åˆ†æå’ŒåŠŸèƒ½è®¾è®¡æ–‡æ¡£ã€‚å¦‚æœéœ€è¦è¿›ä¸€æ­¥è°ƒæ•´æˆ–è¡¥å……ï¼Œè¯·éšæ—¶å‘ŠçŸ¥ã€‚</span><br></pre></td></tr></table></figure></blockquote><p>å†æŠŠAIç”Ÿæˆçš„ <em><strong>éœ€æ±‚åˆ†ææ–‡æ¡£</strong></em> å†ä»¥ä¸¢ç»™æ–°çš„å¯¹è¯</p><blockquote><p>ä½ æ˜¯ä¸€ä¸ªä¼˜ç§€çš„<em>æµ‹å¼€å·¥ç¨‹å¸ˆ</em>ï¼Œç°åœ¨éœ€è¦ä½ æ ¹æ®æˆ‘ç»™ä½ çš„éœ€æ±‚åˆ†æ<em><strong>å¸®æˆ‘å†™æµ‹è¯•ç”¨ä¾‹</strong></em></p><p>è¦æ±‚ï¼š<em><strong>vitest</strong></em> æŠ€æœ¯æ ˆï¼Œ<em><strong>mount</strong></em> å°½é‡è¿”å› JSX è™šæ‹ŸèŠ‚ç‚¹çš„å½¢å¼(æ›´è´´è¿‘å®é™…çš„æ¸²æŸ“ç»“æœï¼Œä»£ç ä¹Ÿæ›´åŠ ç®€æ´ç›´è§‚)ï¼Œitï¼Œtest ç­‰æ–¹æ³•çš„ name å±æ€§ç”¨ä¸­æ–‡æè¿°ï¼ˆè‹±æ–‡æ›´è§„èŒƒï¼Œä½†æ˜¯æˆ‘è‹±è¯­å·®ï¼‰ï¼Œä»¥ä¸‹æ˜¯éœ€æ±‚æ–‡æ¡£å†…å®¹</p><p>ç»“æœè¿”å›å°±æ˜¯æµ‹è¯•ç”¨ä¾‹äº†</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;renders button with correct text&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;......&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></blockquote><h2 id="æµ‹è¯•è¦†ç›–ç‡"><a href="#æµ‹è¯•è¦†ç›–ç‡" class="headerlink" title="æµ‹è¯•è¦†ç›–ç‡"></a>æµ‹è¯•è¦†ç›–ç‡</h2><h3 id="è¦†ç›–ç‡ç±»å‹è¯´æ˜"><a href="#è¦†ç›–ç‡ç±»å‹è¯´æ˜" class="headerlink" title="è¦†ç›–ç‡ç±»å‹è¯´æ˜"></a>è¦†ç›–ç‡ç±»å‹è¯´æ˜</h3><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>è¡Œè¦†ç›–ç‡ï¼ˆ<strong>Line</strong> Coverageï¼‰</td><td>æ¯<strong>ä¸€è¡Œä»£ç </strong>æ˜¯å¦è¢«æ‰§è¡Œ</td></tr><tr><td>è¯­å¥è¦†ç›–ç‡ï¼ˆ<strong>Statement</strong> Coverageï¼‰</td><td>æ¯ä¸ª<strong>ç‹¬ç«‹è¯­å¥</strong>æ˜¯å¦æ‰§è¡Œ</td></tr><tr><td>åˆ†æ”¯è¦†ç›–ç‡ï¼ˆ<strong>Branch</strong> Coverageï¼‰</td><td>æ¯ä¸ª <strong>if&#x2F;elseã€ä¸‰å…ƒè¿ç®—ç¬¦ç­‰åˆ†æ”¯</strong>æ˜¯å¦è¦†ç›–</td></tr><tr><td>å‡½æ•°è¦†ç›–ç‡ï¼ˆ<strong>Function</strong> Coverageï¼‰</td><td>æ¯ä¸ª<strong>å‡½æ•°</strong>æ˜¯å¦è‡³å°‘è°ƒç”¨ä¸€æ¬¡</td></tr></tbody></table><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=NWZkZjIzZTEwMGQxNTFiNmMwZDg2OWI2NTkyOWQzMzVfVGc4Y3ZEdHhwc1FsNGxxdGNDYTFMbkhJa1FGUlBHa2NfVG9rZW46QUhLNGJNOHlFb052UEt4VnppTGNxbzJFbmk2XzE3NTU3OTc3Njk6MTc1NTgwMTM2OV9WNA" alt="img"></p><blockquote><p>Vitest ä½¿ç”¨ <code>istanbul</code> æŠ¥å‘Šï¼Œå¯é€šè¿‡ <code>--coverage</code> ç”Ÿæˆ HTML æŠ¥å‘Š</p></blockquote><h3 id="åˆç†è®¾å®šç›®æ ‡"><a href="#åˆç†è®¾å®šç›®æ ‡" class="headerlink" title="åˆç†è®¾å®šç›®æ ‡"></a>åˆç†è®¾å®šç›®æ ‡</h3><table><thead><tr><th>é¡¹ç›®ç±»å‹</th><th>æ¨èç›®æ ‡</th></tr></thead><tbody><tr><td>å®‰å…¨å…³é”®æ¨¡å—ï¼ˆæ”¯ä»˜ã€æƒé™ï¼‰</td><td>â‰¥ 90% åˆ†æ”¯è¦†ç›–ç‡</td></tr><tr><td>æ ¸å¿ƒä¸šåŠ¡ç»„ä»¶</td><td>â‰¥ 80% è¡Œè¦†ç›–ç‡</td></tr><tr><td>æ™®é€š UI ç»„ä»¶</td><td>â‰¥ 70% è¡Œè¦†ç›–ç‡</td></tr></tbody></table><blockquote><p>é¿å…â€œä¸ºäº†è¦†ç›–è€Œè¦†ç›–â€ï¼Œæ— æ„ä¹‰çš„æµ‹è¯•ä¼šé™ä½ç»´æŠ¤æˆæœ¬</p></blockquote><h2 id="ä¿éšœé«˜è´¨é‡æµ‹è¯•çš„ç­–ç•¥"><a href="#ä¿éšœé«˜è´¨é‡æµ‹è¯•çš„ç­–ç•¥" class="headerlink" title="ä¿éšœé«˜è´¨é‡æµ‹è¯•çš„ç­–ç•¥"></a>ä¿éšœé«˜è´¨é‡æµ‹è¯•çš„ç­–ç•¥</h2><h3 id="åˆ†å±‚æµ‹è¯•ç­–ç•¥"><a href="#åˆ†å±‚æµ‹è¯•ç­–ç•¥" class="headerlink" title="åˆ†å±‚æµ‹è¯•ç­–ç•¥"></a>åˆ†å±‚æµ‹è¯•ç­–ç•¥</h3><table><thead><tr><th>å±‚çº§</th><th>ç›®æ ‡</th><th>å·¥å…·</th></tr></thead><tbody><tr><td>å•å…ƒæµ‹è¯•</td><td>éªŒè¯å•ä¸ªç»„ä»¶&#x2F;å‡½æ•°</td><td>Vitest</td></tr><tr><td>é›†æˆæµ‹è¯•</td><td>æ¨¡å—é—´åä½œ</td><td>Vitest + Mock</td></tr><tr><td>E2E æµ‹è¯•</td><td>ç”¨æˆ·å®Œæ•´æµç¨‹</td><td>Cypress &#x2F; Playwright</td></tr><tr><td>å›å½’æµ‹è¯•</td><td>ä¿®æ”¹åä¸å¼•å…¥æ–° bug</td><td>CI è‡ªåŠ¨è¿è¡Œ</td></tr></tbody></table><h3 id="æŒç»­é›†æˆï¼ˆCIï¼‰è‡ªåŠ¨åŒ–"><a href="#æŒç»­é›†æˆï¼ˆCIï¼‰è‡ªåŠ¨åŒ–" class="headerlink" title="æŒç»­é›†æˆï¼ˆCIï¼‰è‡ªåŠ¨åŒ–"></a>æŒç»­é›†æˆï¼ˆCIï¼‰è‡ªåŠ¨åŒ–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># .github/workflows/test.yml</span><br><span class="line">- name: Run Tests</span><br><span class="line">  run: pnpm test --coverage</span><br><span class="line">- name: Upload Coverage</span><br><span class="line">  uses: actions/upload-artifact@v3</span><br><span class="line">  with:</span><br><span class="line">    name: coverage-report</span><br><span class="line">    path: coverage/</span><br></pre></td></tr></table></figure><blockquote><p>æ¯æ¬¡ PR è‡ªåŠ¨è¿è¡Œæµ‹è¯•ï¼Œè¦†ç›–ç‡ä¸‹é™æ—¶å‘Šè­¦</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Webpack vs Vite</title>
      <link href="/2025/08/22/%E5%B7%A5%E5%85%B7/%E5%89%8D%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/"/>
      <url>/2025/08/22/%E5%B7%A5%E5%85%B7/%E5%89%8D%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<p>ä½ æ˜¯å¦æ›¾è¢«è¿™äº›åè¯ææ™•ï¼š<strong>æ‰“åŒ…å·¥å…·</strong>ã€<strong>æ„å»ºå·¥å…·</strong>ã€<strong>Webpack</strong>ã€<strong>Vite</strong>ï¼Œå®ƒä»¬åˆ°åº•æ˜¯å¹²å˜›çš„ï¼Ÿä¸ºä»€ä¹ˆå‰ç«¯å¼€å‘ç¦»ä¸å¼€å®ƒä»¬ï¼Ÿ</p><h2 id="å‰ç«¯ä¸ºä»€ä¹ˆéœ€è¦â€œæ‰“åŒ…â€"><a href="#å‰ç«¯ä¸ºä»€ä¹ˆéœ€è¦â€œæ‰“åŒ…â€" class="headerlink" title="å‰ç«¯ä¸ºä»€ä¹ˆéœ€è¦â€œæ‰“åŒ…â€"></a>å‰ç«¯ä¸ºä»€ä¹ˆéœ€è¦â€œæ‰“åŒ…â€</h2><p>å½“ä½ å¼€å‘ä¸€ä¸ªç½‘ç«™æ—¶</p><p><strong>ä½ æœ‰å·¨é‡æ–‡ä»¶</strong>ï¼šå‡ åä¸ª <code>.js</code> è„šæœ¬ã€ä¸€å † <code>.css</code> æ ·å¼ã€ä¸€äº›å›¾ç‰‡ <code>.png</code>ã€å­—ä½“ <code>.woff</code>ã€ç”šè‡³ <code>.vue</code> æˆ– <code>.ts</code> æ–‡ä»¶</p><p><strong>æµè§ˆå™¨å¾ˆâ€œç¬¨â€</strong>ï¼š</p><ul><li><p>å®ƒä¸€æ¬¡åªèƒ½åŠ è½½æœ‰é™çš„æ–‡ä»¶ï¼ˆå¤ªå¤šè¯·æ±‚ä¼šæ…¢ï¼‰</p></li><li><p>å®ƒä¸è®¤è¯† <code>.vue</code>ã€<code>.ts</code> æˆ–æœ€æ–°çš„ JS è¯­æ³•ï¼ˆå¦‚ <code>import</code>ï¼‰ï¼Œå¾€å¾€éœ€è¦é¢å¤–é…ç½®</p></li><li><p>å®ƒä¸çŸ¥é“æ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼ˆå“ªä¸ª JS éœ€è¦å…ˆåŠ è½½ï¼‰</p></li></ul><p><strong>ä½ æƒ³åšä¼˜åŒ–</strong>ï¼šæ¯”å¦‚å‹ç¼©ä»£ç ä½“ç§¯ã€åˆå¹¶æ–‡ä»¶ã€ç»™å›¾ç‰‡ç˜¦èº«</p><p><strong>ç°åœ¨å¸‚é¢ä¸Šçš„æ„å»ºå·¥å…·å°±æ˜¯æ¥è§£å†³è¿™äº›é—®é¢˜çš„</strong></p><p><strong>æ‰“åŒ…å·¥å…·å¯ä»¥</strong></p><ol><li><p><strong>æŒ‡æŒ¥</strong>ï¼šä»ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼ˆæ¯”å¦‚ <code>main.js</code>ï¼‰å¼€å§‹ï¼Œæ‰¾å‡ºæ‰€æœ‰å®ƒéœ€è¦çš„æ–‡ä»¶ï¼ˆä¾èµ–ï¼‰ï¼Œå†æ‰¾å‡ºè¿™äº›æ–‡ä»¶éœ€è¦çš„æ–‡ä»¶ï¼Œæœ€åå‘ˆç°ä¸€ä¸ªå·¨å¤§çš„ä¾èµ–å…³ç³»ç½‘</p></li><li><p><strong>ç¿»è¯‘</strong>ï¼šæŠŠæµè§ˆå™¨çœ‹ä¸æ‡‚çš„è¯­è¨€ï¼ˆå¦‚ <code>.ts</code>, <code>.vue</code>, <code>.scss</code>, æ–° JS è¯­æ³•ï¼‰è½¬æ¢æˆæµè§ˆå™¨èƒ½æ‡‚çš„ <code>.js</code> å’Œ <code>.css</code></p></li><li><p><strong>æ‰“åŒ…</strong>ï¼šæŠŠå¤„ç†å¥½çš„æ–‡ä»¶ï¼ŒæŒ‰ç…§è§„åˆ™ç»„åˆã€å‹ç¼©ã€ä¼˜åŒ–ï¼Œæœ€ç»ˆç”Ÿæˆå°‘æ•°å‡ ä¸ªï¼ˆç”šè‡³ä¸€ä¸ªï¼‰é«˜æ•ˆçš„æ–‡ä»¶ï¼ˆå¦‚ <code>stats.es.html</code>, <code>index.js</code>, <code>index.css</code>ï¼‰</p></li><li><p><strong>æ¬è¿</strong>ï¼šæŠŠå›¾ç‰‡ã€å­—ä½“ç­‰èµ„æºå¤„ç†å¥½ï¼Œæ”¾åˆ°æ­£ç¡®çš„ä½ç½®ã€‚</p></li></ol><p><strong>æœ€ç»ˆç›®æ ‡</strong>ï¼šè®©æµè§ˆå™¨åŠ è½½<strong>æ›´å°‘</strong>çš„æ–‡ä»¶ã€åŠ è½½<strong>æ›´å°</strong>çš„æ–‡ä»¶ã€åŠ è½½<strong>æµè§ˆå™¨èƒ½æ‡‚</strong>çš„æ–‡ä»¶ï¼Œä»è€Œè®©ç½‘ç«™<strong>åŠ è½½æ›´å¿«ã€è¿è¡Œæ›´ç¨³</strong></p><h2 id="Webpack-vs-Vite"><a href="#Webpack-vs-Vite" class="headerlink" title="Webpack vs Vite"></a>Webpack vs Vite</h2><p>ç†è§£äº†æ‰“åŒ…å·¥å…·çš„ä½œç”¨ï¼Œç°åœ¨æ¥çœ‹çœ‹ Webpack å’Œ Vite è¿™ä¸¤ä¸ªæ‰“åŒ…å·¥å…·çš„â€œå·¥ä½œæµç¨‹â€æœ‰ä»€ä¹ˆæ ¹æœ¬ä¸åŒ</p><h3 id="Webpackï¼šâ€œæ‰“åŒ…å…ˆè¡Œâ€"><a href="#Webpackï¼šâ€œæ‰“åŒ…å…ˆè¡Œâ€" class="headerlink" title="Webpackï¼šâ€œæ‰“åŒ…å…ˆè¡Œâ€"></a>Webpackï¼šâ€œæ‰“åŒ…å…ˆè¡Œâ€</h3><ul><li><p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼š<strong>ä¼˜å…ˆå®Œæ•´æ‰“åŒ…</strong></p></li><li><p><strong>å·¥ä½œæµç¨‹ï¼ˆå¼€å‘é˜¶æ®µï¼‰</strong>ï¼š</p><ul><li><p><strong>å¯åŠ¨</strong>ï¼šä½ è¿è¡Œ <code>npm run dev</code></p></li><li><p><strong>å¤§æ‰“åŒ…</strong>ï¼šWebpack ç«‹åˆ»å¼€å§‹åˆ†æä½ çš„æ•´ä¸ªé¡¹ç›®ï¼Œä» <code>main.js</code> å¼€å§‹é€’å½’åˆ†ææ‰€æœ‰ <code>import/require</code>ï¼Œç”»å‡ºå·¨å¤§çš„ JSON ç»“æ„ä¾èµ–å›¾è°±ï¼ˆåŒ…å«æ‰€æœ‰æ–‡ä»¶è·¯å¾„ã€ä¾èµ–å…³ç³»ã€æ¨¡å—IDï¼‰</p></li></ul>  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Webpack ç”Ÿæˆä¾èµ–å›¾è°±</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;./src/main.js&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    id<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    dependencies<span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;./src/Header.js&quot;</span><span class="punctuation">,</span> <span class="string">&quot;./src/utils.js&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;./src/Header.js&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    id<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    dependencies<span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;./src/assets/logo.svg&quot;</span><span class="punctuation">,</span> <span class="string">&quot;./src/Header.css&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment">// ... å…¶ä»–æ–‡ä»¶</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>  Â Â ç„¶åè®© Loader ä»¬ç¿»è¯‘æ‰€æœ‰æ–‡ä»¶ï¼Œæœ€åæŠŠå®ƒä»¬æ‰“åŒ…æˆä¸€ä¸ªæˆ–å‡ ä¸ªå¤§æ–‡ä»¶ (<code>index.js</code>)</p><blockquote><p>è¿™ä¸ªè¿‡ç¨‹é€šå¸¸å¾ˆæ…¢ï¼Œå°¤å…¶é¡¹ç›®å¾ˆå¤§æ—¶</p></blockquote><ul><li><p><strong>å¯åŠ¨æœåŠ¡å™¨</strong>ï¼šæ‰“åŒ…å®Œæˆåï¼Œå¯åŠ¨ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨</p></li><li><p><strong>æµè§ˆå™¨åŠ è½½</strong>ï¼šæµè§ˆå™¨è®¿é—®é¡µé¢ï¼ŒåŠ è½½çš„æ˜¯æ‰“åŒ…å¥½çš„å¤§æ–‡ä»¶</p></li><li><p><strong>ä¿®æ”¹ä»£ç </strong>ï¼šä½ æ”¹äº†ä¸€ä¸ªæ–‡ä»¶ï¼ˆæ¯”å¦‚ <code>Button.vue</code>ï¼‰</p></li><li><p><strong>é‡æ–°æ‰“åŒ…</strong>ï¼šWebpack å‘ç°æ–‡ä»¶å˜äº†ï¼Œå®ƒä¼šé‡æ–°åˆ†æä¾èµ–ï¼ˆå¯èƒ½ä¸éœ€è¦å…¨éƒ¨åˆ†æï¼Œæœ‰ç¼“å­˜ï¼‰ï¼Œç„¶åé‡æ–°æ‰“åŒ…å—å½±å“çš„éƒ¨åˆ†ï¼Œç”Ÿæˆæ–°çš„ <code>index.js</code></p></li><li><p><strong>çƒ­æ›´æ–° (HMR)</strong>ï¼šWebpack é€šè¿‡æŠ€æœ¯æ‰‹æ®µï¼Œå‘Šè¯‰æµè§ˆå™¨<code>Button.js</code> é‚£å—ä»£ç å˜äº†ï¼Œæµè§ˆå™¨å°±åªæ›´æ–°é‚£å±€éƒ¨ï¼Œä¸ç”¨åˆ·æ–°æ•´ä¸ªé¡µé¢ï¼ˆä½“éªŒæ›´å¥½ï¼‰</p></li></ul></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li><p><strong>æˆç†Ÿç¨³å®š</strong>ï¼šä¹…ç»è€ƒéªŒï¼Œ<strong>ç”Ÿæ€æå…¶ä¸°å¯Œï¼Œä»€ä¹ˆåœºæ™¯å‡ ä¹éƒ½æœ‰è§£å†³æ–¹æ¡ˆ</strong></p></li><li><p><strong>åŠŸèƒ½å¼ºå¤§</strong>ï¼šèƒ½å¤„ç†éå¸¸å¤æ‚çš„é¡¹ç›®ç»“æ„å’Œéœ€æ±‚</p></li></ul></li><li><p><strong>ç—›ç‚¹</strong>ï¼š</p><ul><li><p><strong>å¯åŠ¨æ…¢ï¼ˆå†·å¯åŠ¨ï¼‰</strong>ï¼šé¡¹ç›®è¶Šå¤§ï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶é‚£ä¸ªâ€œå¤§æ‰“åŒ…â€è¿‡ç¨‹å°±è¶Šæ…¢ã€‚ç­‰å‡ åç§’æ˜¯å¸¸äº‹</p></li><li><p><strong>æ›´æ–°æœ‰æ—¶ä¹Ÿæ…¢</strong>ï¼šè™½ç„¶ HMR å¾ˆå¿«ï¼Œä½†å¦‚æœæ”¹åŠ¨å½±å“äº†æ ¸å¿ƒä¾èµ–ï¼Œå¯èƒ½è¿˜æ˜¯éœ€è¦è¾ƒé•¿æ—¶é—´é‡å»º</p></li><li><p><strong>é…ç½®å¤æ‚</strong>ï¼šæƒ³ç”¨å¥½è¦å­¦ä¸å°‘é…ç½®çŸ¥è¯†ï¼Œæ–°æ‰‹å®¹æ˜“bæºƒ</p></li></ul></li></ul><h3 id="Viteï¼šâ€œæŒ‰éœ€ç¼–è¯‘â€"><a href="#Viteï¼šâ€œæŒ‰éœ€ç¼–è¯‘â€" class="headerlink" title="Viteï¼šâ€œæŒ‰éœ€ç¼–è¯‘â€"></a>Viteï¼šâ€œæŒ‰éœ€ç¼–è¯‘â€</h3><ul><li><p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼š<strong>ä¸å®Œå…¨æ‰“åŒ…ï¼ŒæŒ‰éœ€æœåŠ¡</strong></p></li><li><p><strong>å·¥ä½œæµç¨‹ï¼ˆå¼€å‘é˜¶æ®µï¼‰</strong>ï¼š</p><ul><li><p><strong>å¯åŠ¨</strong>ï¼šä½ è¿è¡Œ <code>npm run dev</code></p></li><li><p><strong>ç§’å¼€æœåŠ¡å™¨</strong>ï¼šVite ç¬é—´å¯åŠ¨ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨ï¼ˆå‡ ä¹ä¸ç”¨ç­‰ï¼‰ï¼Œå®ƒ<strong>å®Œå…¨ä¸æ‰“åŒ…</strong>ä½ çš„æºç </p></li><li><p><strong>æµè§ˆå™¨è¯·æ±‚</strong>ï¼šVite è¿”å›çš„æ˜¯ä¸€ä¸ª<strong>æç®€çš„</strong> <strong>HTML</strong>ï¼Œ<strong>é‡Œé¢ç”¨</strong> <strong><code>&lt;script type=&quot;module&quot;&gt;</code></strong> <strong>åŠ è½½ä½ çš„</strong> <strong><code>main.js</code></strong>ï¼Œè¿™ä¹Ÿæ˜¯æµè§ˆå™¨è¯·æ±‚çš„<code>main.js</code></p></li></ul><blockquote><p>è¿™æ˜¯å…³é”®ï¼ç°ä»£æµè§ˆå™¨åŸç”Ÿæ”¯æŒ <code>type=&quot;module&quot;</code>ï¼Œæ„å‘³ç€æµè§ˆå™¨è‡ªå·±å°±èƒ½å¤„ç† <code>import</code> è¯­å¥</p></blockquote><ul><li><strong>æŒ‰éœ€è¯·æ±‚</strong>ï¼šæµè§ˆå™¨æ‰§è¡Œ <code>main.js</code>ï¼Œé‡åˆ° <code>import &#123; Button &#125; from &#39;./components/Button.js&#39;</code>ï¼Œå®ƒå°±å‘ Vite æœåŠ¡å™¨è¯·æ±‚ <code>Button.js</code></li></ul>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">æµè§ˆå™¨çœŸå®è¯·æ±‚åºåˆ—</span></span><br><span class="line"><span class="number">1</span><span class="string">.</span> <span class="string">GET</span> <span class="string">/src/main.js</span></span><br><span class="line"><span class="number">2</span><span class="string">.</span> <span class="string">GET</span> <span class="string">/src/Header.js?import</span>  <span class="string">//</span> <span class="string">Vite</span> <span class="string">æ·»åŠ ?importæ ‡è¯†</span></span><br><span class="line"><span class="number">3</span><span class="string">.</span> <span class="string">GET</span> <span class="string">/src/assets/logo.svg?import</span></span><br><span class="line"><span class="number">4</span><span class="string">.</span> <span class="string">GET</span> <span class="string">/src/Header.css?import</span></span><br></pre></td></tr></table></figure><ul><li><p><strong>æŒ‰éœ€ç¼–è¯‘</strong>ï¼šVite æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ <code>Button.js</code> æ—¶ï¼Œæ‰ä¸´æ—¶æŠŠå®ƒï¼ˆä»¥åŠå®ƒå¯èƒ½å¼•å…¥çš„ä¾èµ–ï¼‰ä»åŸå§‹è¯­è¨€ï¼ˆå¦‚ <code>.vue</code>, <code>.ts</code>ï¼‰å¿«é€Ÿç¼–è¯‘æˆæµè§ˆå™¨èƒ½æ‡‚çš„ JSï¼Œç„¶åè¿”å›ç»™æµè§ˆå™¨ã€‚<strong>æ‰€ä»¥è¯´ï¼Œä½ å½“å‰æ²¡è®¿é—®çš„ä»£ç ï¼ŒVite æ ¹æœ¬ä¸ç®¡</strong></p></li><li><p><strong>ä¿®æ”¹ä»£ç </strong>ï¼šä½ æ”¹äº†ä¸€ä¸ªæ–‡ä»¶ï¼ˆæ¯”å¦‚ <code>Button.vue</code>ï¼‰</p></li><li><p><strong>æé€Ÿçƒ­æ›´æ–°</strong>ï¼šVite ç¬é—´çŸ¥é“å“ªä¸ªæ–‡ä»¶å˜äº†ã€‚å®ƒåªé‡æ–°ç¼–è¯‘è¿™ä¸ªæ–‡ä»¶ï¼ˆé€Ÿåº¦æå¿«ï¼‰ï¼Œç„¶åé€šè¿‡æå…¶é«˜æ•ˆçš„ HMR å‘Šè¯‰æµè§ˆå™¨ï¼šâ€œåªæ›´æ–° <code>Button.vue</code> å¯¹åº”çš„éƒ¨åˆ†â€ ï¼Œéå¸¸éå¸¸å¿«</p></li></ul></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li><p><strong>å¯åŠ¨é£å¿«</strong>ï¼šé¡¹ç›®å†å¤§ï¼Œå¯åŠ¨ä¹Ÿæ˜¯ç§’å¼€ï¼ˆå‡ ç™¾æ¯«ç§’ï¼‰</p></li><li><p><strong>æ›´æ–°é£å¿«</strong>ï¼šæ”¹å“ªé‡Œç¼–è¯‘å“ªé‡Œï¼ŒHMR å¿«åˆ°ç¦»è°±</p></li><li><p><strong>å¼€ç®±å³ç”¨</strong>ï¼šå¯¹ç°ä»£æŠ€æœ¯ï¼ˆESM, TypeScript, JSX, Vue, Reactï¼‰æ”¯æŒæå¥½ï¼Œé…ç½®ç®€å•å¾ˆå¤š</p></li></ul></li><li><p><strong>ç—›ç‚¹</strong>ï¼š</p><ul><li><p><strong>ç”Ÿæ€ç›¸å¯¹å¹´è½»</strong>ï¼šè™½ç„¶å‘å±•è¿…çŒ›ï¼Œä½†ä¸€äº›éå¸¸ç‰¹æ®Šæˆ–è€æ—§çš„åœºæ™¯ï¼Œå¯èƒ½æ²¡æœ‰ Webpack é‚£ä¹ˆæˆç†Ÿçš„è§£å†³æ–¹æ¡ˆ</p></li><li><p><strong>å¯¹æ—§æµè§ˆå™¨æ”¯æŒå¼±</strong>ï¼š<strong>é‡åº¦ä¾èµ–æµè§ˆå™¨åŸç”Ÿ ESM</strong>ï¼Œå¯¹ IE ç­‰è€å¤è‘£ä¸å¤ªå‹å¥½ï¼ˆç”Ÿäº§ç¯å¢ƒé€šè¿‡æ‰“åŒ…å¯ä»¥è§£å†³ï¼‰</p></li></ul></li></ul><blockquote><p><strong>æµç¨‹æ€»ç»“</strong>ï¼š</p><p><strong>Webpack</strong>ï¼š<code>å¯åŠ¨+æ‰“åŒ…æ…¢</code> â†’ <code>å¯åŠ¨æœåŠ¡å™¨</code> â†’ <code>æµè§ˆå™¨åŠ è½½å¤§åŒ…</code> â†’ <code>æ”¹ä»£ç </code> â†’ <code>é‡æ–°æ‰“åŒ…æ…¢</code> â†’ <code>HMR æ›´æ–°</code></p><p><strong>Vite</strong>ï¼š <code>å¯åŠ¨è¶…å¿«</code> â†’ <code>å¯åŠ¨æœåŠ¡å™¨</code> â†’ <code>æµè§ˆå™¨åŠ è½½å…¥å£</code> â†’ <code>æŒ‰éœ€è¯·æ±‚</code> â†’ <code>æŒ‰éœ€ç¼–è¯‘å¿«</code> â†’ <code>æ”¹ä»£ç </code> â†’ <code>æŒ‰éœ€ç¼–è¯‘è¶…å¿«</code> â†’ <code>HMR æ›´æ–°è¶…å¿«</code></p></blockquote><h3 id="æ€§èƒ½å¯¹æ¯”"><a href="#æ€§èƒ½å¯¹æ¯”" class="headerlink" title="æ€§èƒ½å¯¹æ¯”"></a>æ€§èƒ½å¯¹æ¯”</h3><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td><strong>ä½“éªŒæŒ‡æ ‡</strong></td><td><strong>Webpack å¼€å‘æ¨¡å¼</strong></td><td><strong>Vite å¼€å‘æ¨¡å¼</strong></td><td><strong>Vite ä¼˜åŠ¿</strong></td></tr><tr><td><strong>å†·å¯åŠ¨</strong></td><td>å¿…é¡»ç­‰æ•´ä¸ªé¡¹ç›®æ‰“åŒ…å®Œæ‰èƒ½å¯åŠ¨æœåŠ¡å™¨ï¼Œé¡¹ç›®è¶Šå¤§è¶Šæ…¢</td><td>æ— éœ€ç­‰å¾…æ‰“åŒ…ï¼Œç¬é—´å¯åŠ¨æœåŠ¡å™¨ï¼Œé¡¹ç›®å¤§å°å¸¦æ¥çš„å½±å“æå°</td><td>å¿« 10 å€ç”šè‡³ 100 å€</td></tr><tr><td><strong>çƒ­æ›´æ–° (HMR)</strong></td><td>è¾ƒæ…¢ï¼Œéœ€è¦é‡æ–°æ‰“åŒ…å—å½±å“çš„éƒ¨åˆ†ï¼Œæ”¹åŠ¨æ ¸å¿ƒæ–‡ä»¶æ—¶å¯èƒ½</td><td>æå¿«ï¼Œåªç¼–è¯‘å•ä¸ªæ”¹åŠ¨çš„æ–‡ä»¶</td><td>å¿«å¾—å¤š</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>è¾ƒé«˜ï¼Œéœ€è¦ç»´æŠ¤æ•´ä¸ªé¡¹ç›®çš„ä¾èµ–å…³ç³»å›¾å’Œæ‰“åŒ…çŠ¶æ€</td><td>å¾ˆä½ï¼ŒæŒ‰éœ€åŠ è½½ï¼Œåªç¼–è¯‘å½“å‰éœ€è¦çš„æ–‡ä»¶</td><td>æ›´çœèµ„æº</td></tr><tr><td><strong>ç”Ÿäº§æ„å»º</strong></td><td>æˆç†Ÿç¨³å®šï¼Œä¼˜åŒ–èƒ½åŠ›å¼ºã€‚é€Ÿåº¦å–å†³äºé…ç½®å’Œé¡¹ç›®å¤æ‚åº¦ã€‚</td><td>ä½¿ç”¨ Rollup æ‰“åŒ…ï¼ŒåŒæ ·æˆç†Ÿé«˜æ•ˆï¼ŒTree Shaking ä¼˜ç§€</td><td>ä¸¤è€…ç›¸å½“ï¼ŒVite(Rollup) å¯èƒ½ç•¥ä¼˜</td></tr></tbody></table><h2 id="æ’ä»¶ç”Ÿæ€"><a href="#æ’ä»¶ç”Ÿæ€" class="headerlink" title="æ’ä»¶ç”Ÿæ€"></a>æ’ä»¶ç”Ÿæ€</h2><p>æ‰“åŒ…å·¥å…·çš„å¼ºå¤§åŠŸèƒ½ï¼Œå¾ˆå¤šæ˜¯é â€œæ’ä»¶â€æ‰©å±•çš„</p><p><strong>Webpack æ’ä»¶ç”Ÿæ€</strong>ï¼š</p><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼šå­˜åœ¨æ—¶é—´æœ€é•¿ï¼Œæ’ä»¶æ•°é‡æœ€å¤šï¼Œè¦†ç›–åœºæ™¯æœ€å¹¿ï¼Œä»å¤„ç†å„ç§æ–‡ä»¶ç±»å‹ï¼Œåˆ°ä»£ç å‹ç¼©ã€å›¾ç‰‡ä¼˜åŒ–ã€æ€§èƒ½åˆ†æã€ç‰¹æ®Šéƒ¨ç½²ï¼Œå‡ ä¹æ²¡æœ‰æ‰¾ä¸åˆ°çš„æ’ä»¶</p></li><li><p><strong>ä¼˜åŠ¿</strong>ï¼šåŠŸèƒ½æå…¶å…¨é¢ï¼Œé€‚åˆå¤„ç†<strong>æå…¶å¤æ‚ã€ç‰¹æ®Šçš„éœ€æ±‚</strong></p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šé…ç½®ç›¸å¯¹å¤æ‚ï¼Œå­¦ä¹ æˆæœ¬é«˜ï¼Œæ’ä»¶å¼€å‘ä¹Ÿæ¯”è¾ƒéš¾</p></li><li><p><strong>ä»£è¡¨æ’ä»¶</strong>ï¼š<code>html-webpack-plugin</code> (ç”ŸæˆHTMLæ–‡ä»¶)ï¼Œ<code>mini-css-extract-plugin</code> (æå–CSS)ï¼Œ <code>clean-webpack-plugin</code> (æ¸…ç†æ—§æ–‡ä»¶)ï¼Œ <code>webpack-bundle-analyzer</code> (åˆ†æåŒ…å¤§å°)</p></li></ul><p><strong>Vite æ’ä»¶ç”Ÿæ€</strong>ï¼š</p><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼šç”Ÿæ€å‘å±•éå¸¸å¿«ï¼Œæ ¸å¿ƒä¼˜åŠ¿æ˜¯ API è®¾è®¡æ›´ç°ä»£ã€ç®€æ´ï¼Œå¾ˆå¤šæ’ä»¶åœ¨<strong>å¼€å‘æ¨¡å¼</strong>ä¸‹å°±èƒ½å‘æŒ¥å¾ˆå¥½ä½œç”¨ï¼ˆå¦‚è°ƒè¯•ã€Mock æ•°æ®ï¼‰ã€‚å¯ç›´æ¥å…¼å®¹å¤§é‡ <strong>Rollup æ’ä»¶</strong>ï¼Œå¯åˆ©ç”¨ Rollup çš„æˆç†Ÿç”Ÿæ€</p></li><li><p><strong>ä¼˜åŠ¿</strong>ï¼šé…ç½®é€šå¸¸æ›´ç®€å•ï¼Œæ’ä»¶å¼€å‘æ›´å®¹æ˜“ä¸Šæ‰‹ï¼Œä¸ Vite çš„æŒ‰éœ€ç¼–è¯‘ã€åŸç”Ÿ ESM ç‰¹æ€§ç»“åˆç´§å¯†</p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šä¸å¦‚ Webpack çš„æ’ä»¶æˆç†Ÿ</p></li><li><p><strong>ä»£è¡¨æ’ä»¶</strong>ï¼š<code>@vitejs/plugin-vue</code> (æ”¯æŒVueå•æ–‡ä»¶ç»„ä»¶)ï¼Œ <code>@vitejs/plugin-react</code> (æ”¯æŒReact)ï¼Œ <code>vite-plugin-inspect</code> (å¯è§†åŒ–è°ƒè¯•ä¾èµ–å’Œè½¬æ¢),ï¼Œ<code>unplugin-auto-import</code> (è‡ªåŠ¨å¼•å…¥API)ï¼Œ <code>vite-plugin-pwa</code> (æ”¯æŒPWA)</p></li></ul><h2 id="æ’ä»¶å¼€å‘å®æˆ˜"><a href="#æ’ä»¶å¼€å‘å®æˆ˜" class="headerlink" title="æ’ä»¶å¼€å‘å®æˆ˜"></a>æ’ä»¶å¼€å‘å®æˆ˜</h2><h3 id="Webpack-æ’ä»¶"><a href="#Webpack-æ’ä»¶" class="headerlink" title="Webpack æ’ä»¶"></a>Webpack æ’ä»¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack-custom-plugin.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogCompilationTimePlugin</span> &#123;</span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> startTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬ compiler çš„ hook äº‹ä»¶</span></span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">beforeRun</span>.<span class="title function_">tap</span>(<span class="string">&#x27;LogTime&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">done</span>.<span class="title function_">tap</span>(<span class="string">&#x27;LogTime&#x27;</span>, <span class="function">(<span class="params">stats</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> endTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æ„å»ºè€—æ—¶: <span class="subst">$&#123;endTime - startTime&#125;</span>ms`</span>);</span><br><span class="line">      <span class="comment">// å¯å†™å…¥æ–‡ä»¶ã€å‘é€ç›‘æ§æŠ¥å‘Šç­‰</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">LogCompilationTimePlugin</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Vite-Rollup-æ’ä»¶"><a href="#Vite-Rollup-æ’ä»¶" class="headerlink" title="Vite&#x2F;Rollup æ’ä»¶"></a>Vite&#x2F;Rollup æ’ä»¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite-custom-plugin.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">vitePluginAnalysis</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;vite-bundle-analysis&#x27;</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è½¬æ¢æ–‡ä»¶å†…å®¹</span></span><br><span class="line">    <span class="title function_">transform</span>(<span class="params">code, id</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (id.<span class="title function_">endsWith</span>(<span class="string">&#x27;.vue&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> code.<span class="title function_">replace</span>(<span class="string">&#x27;debugger&#x27;</span>, <span class="string">&#x27;// removed debugger&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”ŸæˆBundleæ—¶è§¦å‘</span></span><br><span class="line">    <span class="title function_">generateBundle</span>(<span class="params">options, bundle</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> totalSize = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> [fileName, info] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(bundle)) &#123;</span><br><span class="line">        totalSize += info.<span class="property">code</span>.<span class="property">length</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;fileName&#125;</span>: <span class="subst">$&#123;(info.code.length / <span class="number">1024</span>).toFixed(<span class="number">2</span>)&#125;</span>KB`</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æ€»å¤§å°: <span class="subst">$&#123;(totalSize / <span class="number">1024</span>).toFixed(<span class="number">2</span>)&#125;</span>KB`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">import</span> vitePluginAnalysis <span class="keyword">from</span> <span class="string">&#x27;./vite-custom-plugin&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vitePluginAnalysis</span>()]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>éšå¼è½¬æ¢</title>
      <link href="/2025/05/12/JS/%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2/"/>
      <url>/2025/05/12/JS/%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<h3 id="éšå¼è½¬æ¢"><a href="#éšå¼è½¬æ¢" class="headerlink" title="éšå¼è½¬æ¢"></a>éšå¼è½¬æ¢</h3><blockquote><p>åœ¨æŸäº›æ“ä½œä¸­ï¼ŒJavaScript è‡ªåŠ¨å°†ä¸€ç§æ•°æ®ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§æ•°æ®ç±»å‹</p></blockquote><p>ä»¥ä¸‹æ˜¯å¸¸è§åœºæ™¯</p><h4 id="å­—ç¬¦ä¸²æ‹¼æ¥"><a href="#å­—ç¬¦ä¸²æ‹¼æ¥" class="headerlink" title="å­—ç¬¦ä¸²æ‹¼æ¥"></a>å­—ç¬¦ä¸²æ‹¼æ¥</h4><blockquote><p>ç”¨ <code>+</code> æ—¶ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæ“ä½œæ•°æ˜¯å­—ç¬¦ä¸²ï¼Œå¦ä¸€ä¸ªæ“ä½œæ•°ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span> + <span class="string">&quot;2&quot;</span>); <span class="comment">// è¾“å‡º: &quot;12&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello&quot;</span> + <span class="number">3</span>); <span class="comment">// è¾“å‡º: &quot;Hello3&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">true</span> + <span class="string">&quot; world&quot;</span>); <span class="comment">// è¾“å‡º: &quot;true world&quot;</span></span><br></pre></td></tr></table></figure><h4 id="æ•°å­—è¿ç®—"><a href="#æ•°å­—è¿ç®—" class="headerlink" title="æ•°å­—è¿ç®—"></a>æ•°å­—è¿ç®—</h4><blockquote><p>æ•°å­¦è¿ç®—æ—¶ï¼Œéæ•°å­—ç±»å‹çš„å€¼ä¼šè¢«éšå¼è½¬æ¢ä¸ºæ•°å­—</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">10</span> - <span class="string">&quot;5&quot;</span>); <span class="comment">// è¾“å‡º: 5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;10&quot;</span> * <span class="number">3</span>); <span class="comment">// è¾“å‡º: 30</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;10&quot;</span> / <span class="number">2</span>); <span class="comment">// è¾“å‡º: 5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;abc&quot;</span> - <span class="number">1</span>); <span class="comment">// è¾“å‡º: NaN (æ— æ³•è½¬æ¢ä¸ºæ•°å­—)</span></span><br></pre></td></tr></table></figure><h4 id="å¸ƒå°”å€¼"><a href="#å¸ƒå°”å€¼" class="headerlink" title="å¸ƒå°”å€¼"></a>å¸ƒå°”å€¼</h4><blockquote><p>æ¡ä»¶åˆ¤æ–­ä¸­ï¼ŒJavaScript ä¼šå°†å€¼éšå¼è½¬æ¢ä¸ºå¸ƒå°”å€¼</p></blockquote><p>ä»¥ä¸‹å€¼è¢«è§†ä¸ºfalse</p><p><code>false</code> <code>0</code> <code>null</code> <code>undefined</code> <code>NaN</code> <code>&quot;&quot;</code>ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰</p><p>å…¶ä»–æ‰€æœ‰å€¼éƒ½è¢«è§†ä¸º <code>true</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&quot;&quot;</span>) &#123; <span class="comment">// ä¸º false</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;This won&#x27;t run&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;hello&quot;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Non-empty string is truthy&quot;</span>); <span class="comment">// è¾“å‡º: Non-empty string is truthy</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸"><a href="#ä¸" class="headerlink" title="&#x3D;&#x3D;ä¸&#x3D;&#x3D;&#x3D;"></a>&#x3D;&#x3D;ä¸&#x3D;&#x3D;&#x3D;</h4><p><code>==</code>ï¼ˆå®½æ¾ç›¸ç­‰ï¼‰ä¸<code>===</code>ï¼ˆä¸¥æ ¼ç›¸ç­‰ï¼‰çš„æ ¸å¿ƒåŒºåˆ«åœ¨äº<strong>æ˜¯å¦è¿›è¡Œç±»å‹è½¬æ¢</strong>ï¼š</p><ol><li><strong><code>===</code></strong>ï¼šç›´æ¥æ¯”è¾ƒ <strong>å€¼</strong> + <strong>ç±»å‹</strong> ï¼Œç±»å‹ä¸åŒç«‹å³è¿”å›<code>false</code>ã€‚ä¾‹å¦‚<code>5 === &quot;5&quot;</code>ä¸º<code>false</code>ã€‚</li><li><strong><code>==</code></strong>ï¼ˆ<code>!=</code>åŒç†ï¼‰ï¼šè‹¥ç±»å‹ä¸åŒï¼ŒæŒ‰è§„åˆ™ <strong>éšå¼è½¬æ¢</strong> åæ¯”è¾ƒï¼š</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span> == <span class="string">&quot;1&quot;</span>);<span class="comment">// true (æ•°å­—å’Œå­—ç¬¦ä¸²è¢«éšå¼è½¬æ¢)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">0</span> == <span class="literal">false</span>);<span class="comment">// true (å¸ƒå°”å€¼è¢«è½¬æ¢ä¸ºæ•°å­—)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;0&quot;</span> == <span class="literal">false</span>);<span class="comment">// true (`false`è½¬`0`ï¼Œ`&quot;0&quot;`è½¬`0`)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([] == <span class="number">0</span>);<span class="comment">// true (ç©ºæ•°ç»„â†’ç©ºå­—ç¬¦ä¸²â†’è½¬`0`)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([] == ![]);<span class="comment">// true (![]è½¬falseâ†’0ï¼Œ[]è½¬0)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span> == <span class="literal">undefined</span>); <span class="comment">// true (ç‰¹æ®Šè§„åˆ™)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">NaN</span> == <span class="title class_">NaN</span>);<span class="comment">// false (`NaN`ä¸ä»»ä½•å€¼ï¼ˆåŒ…æ‹¬è‡ªèº«ï¼‰æ¯”è¾ƒå‡ä¸º`false`)</span></span><br></pre></td></tr></table></figure><p><strong>æœ€ä½³å®è·µ</strong>ï¼š</p><ul><li>å§‹ç»ˆä½¿ç”¨<code>===</code>é¿å…éšå¼è½¬æ¢é™·é˜±ï¼Œæå‡ä»£ç å¯é¢„æµ‹æ€§ã€‚</li><li>è‹¥éœ€ç±»å‹è½¬æ¢ï¼Œåº”æ˜¾å¼è½¬æ¢ï¼ˆå¦‚<code>Number(str)</code>æˆ–<code>String(num)</code>ï¼‰è€Œéä¾èµ–<code>==</code>ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç±»å‹</title>
      <link href="/2025/05/12/JS/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
      <url>/2025/05/12/JS/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="æ•°æ®ç±»å‹-ç±»å‹åˆ¤æ–­"><a href="#æ•°æ®ç±»å‹-ç±»å‹åˆ¤æ–­" class="headerlink" title="æ•°æ®ç±»å‹+ç±»å‹åˆ¤æ–­"></a>æ•°æ®ç±»å‹+ç±»å‹åˆ¤æ–­</h3><p>JavaScriptæ•°æ®ç±»å‹åˆ†ä¸º<strong>åŸºæœ¬ç±»å‹</strong>ä¸<strong>å¼•ç”¨ç±»å‹</strong>ã€‚</p><p>åŸºæœ¬ç±»å‹åŒ…æ‹¬<code>undefined</code>ã€<code>null</code>ã€<code>boolean</code>ã€<code>number</code>ã€<code>string</code>ã€<code>symbol</code>ï¼ˆES6ï¼‰ã€<code>bigint</code>ï¼ˆES11ï¼‰ï¼›</p><p>å¼•ç”¨ç±»å‹ä¸º<code>object</code>ï¼ˆå¦‚æ•°ç»„ã€å‡½æ•°ç­‰ï¼‰ã€‚</p><p>ç±»å‹åˆ¤æ–­æ–¹æ³•å¦‚ä¸‹ï¼š</p><ol><li><strong><code>typeof</code></strong>ï¼šè¿”å›ç±»å‹å­—ç¬¦ä¸²ï¼Œä½†<code>typeof null</code>è¿”å›<code>&quot;object&quot;</code>ï¼ˆå†å²é—ç•™é—®é¢˜ï¼‰ï¼Œä¸”æ— æ³•åŒºåˆ†æ•°ç»„ä¸å¯¹è±¡ï¼ˆå‡è¿”å›<code>&quot;object&quot;</code>ï¼‰ã€‚</li><li><strong><code>instanceof</code></strong>ï¼šæ£€æµ‹å¯¹è±¡åŸå‹é“¾æ˜¯å¦åŒ…å«æ„é€ å‡½æ•°ï¼ˆå¦‚<code>[] instanceof Array</code>ä¸º<code>true</code>ï¼‰ï¼Œä½†è·¨å…¨å±€ç¯å¢ƒï¼ˆå¦‚iframeï¼‰æ—¶å¤±æ•ˆã€‚</li><li><strong><code>Object.prototype.toString.call()</code></strong>ï¼šç²¾ç¡®è¿”å›<code>[object Type]</code>æ ¼å¼ï¼ˆå¦‚æ•°ç»„è¿”å›<code>&quot;[object Array]&quot;</code>ï¼‰ï¼Œå¯è¯†åˆ«æ‰€æœ‰å†…ç½®ç±»å‹ï¼ˆåŒ…æ‹¬<code>null</code>è¿”å›<code>&quot;[object Null]&quot;</code>ï¼‰ã€‚</li><li><strong><code>Array.isArray()</code></strong>ï¼šä¸“ç”¨äºåˆ¤æ–­æ•°ç»„ï¼Œé¿å…<code>instanceof</code>çš„è·¨ç¯å¢ƒé—®é¢˜ã€‚</li></ol><p><strong>ç¤ºä¾‹å¯¹æ¯”</strong>ï¼š</p><ul><li><code>typeof 42</code> â†’ <code>&quot;number&quot;</code></li><li><code>typeof &#123;&#125;</code> â†’ <code>&quot;object&quot;</code></li><li><code>Object.prototype.toString.call(null)</code> â†’ <code>&quot;[object Null]&quot;</code></li><li><code>Array.isArray([])</code> â†’ <code>true</code></li></ul><p><strong>æ€»ç»“</strong>ï¼š</p><ul><li>åŸºæœ¬ç±»å‹ä¼˜å…ˆç”¨<code>typeof</code>ï¼ˆæ³¨æ„<code>null</code>ç‰¹ä¾‹ï¼‰ã€‚</li><li>ç²¾ç¡®ç±»å‹ç”¨<code>Object.prototype.toString.call()</code>ã€‚</li><li>æ•°ç»„åˆ¤æ–­ç”¨<code>Array.isArray()</code>ã€‚</li><li>è‡ªå®šä¹‰å¯¹è±¡éœ€ç»“åˆæ„é€ å‡½æ•°æˆ–<code>Symbol.toStringTag</code>ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å•ç‚¹ç™»å½•</title>
      <link href="/2025/05/12/JS/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/"/>
      <url>/2025/05/12/JS/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h3 id="å•ç‚¹ç™»å½•"><a href="#å•ç‚¹ç™»å½•" class="headerlink" title="å•ç‚¹ç™»å½•"></a>å•ç‚¹ç™»å½•</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><blockquote><p>SSOï¼Œæ˜¯ä¸€ç§èº«ä»½éªŒè¯æœºåˆ¶ï¼Œè¿è¡Œç”¨æˆ·é€šè¿‡ä¸€æ¬¡ç™»å½•å¯ä»¥è®¿é—®å¤šä¸ªç›¸å…³ä½†ç‹¬ç«‹çš„è½¯ä»¶ç³»ç»Ÿ</p><p>ä¸€æ—¦ç”¨æˆ·ç™»å½•ä¸€ä¸ªç³»ç»Ÿï¼Œæ‰€æœ‰ç›¸å…³ç³»ç»Ÿéƒ½å°†è¯†åˆ«è¯¥ç”¨æˆ·ä¸ºå·²è®¤è¯çŠ¶æ€</p></blockquote><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p><strong>èƒŒæ™¯</strong></p><blockquote><p>è®¤è¯ä¸­å¿ƒï¼šé¢å‘ä»¤ç‰Œ</p><p>åº”ç”¨A - åº”ç”¨Bï¼šä¸¤ä¸ªç‹¬ç«‹åº”ç”¨ï¼Œå…±äº«åŒä¸€ä¸ªè®¤è¯ä¸­å¿ƒ</p></blockquote><p><strong>æŠ€æœ¯æ ˆ</strong></p><blockquote><p>JSã€Nodejsã€OAuth 2.0åè®®</p></blockquote><p><strong>æµç¨‹</strong></p><p>å‰ç«¯éƒ¨åˆ†</p><blockquote><p><em><strong>ç”¨æˆ·è®¿é—®A</strong></em></p><p>Aæ£€æµ‹ç™»å½•çŠ¶æ€ -&gt; (æœªç™»å½•é‡å®šå‘è®¤è¯ä¸­å¿ƒ)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰æœ‰æ•ˆçš„è®¿é—®ä»¤ç‰Œ</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkLoginStatus</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;accessToken&#x27;</span>);</span><br><span class="line"> <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">     <span class="comment">// å¦‚æœæ²¡æœ‰ä»¤ç‰Œï¼Œé‡å®šå‘åˆ°è®¤è¯ä¸­å¿ƒ</span></span><br><span class="line">     <span class="title function_">redirectToAuthServer</span>();</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç”¨æˆ·å·²ç™»å½•&#x27;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">redirectToAuthServer</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">const</span> clientId = <span class="string">&#x27;your-client-id&#x27;</span>; <span class="comment">// åº”ç”¨çš„å®¢æˆ·ç«¯ID</span></span><br><span class="line"> <span class="keyword">const</span> redirectUri = <span class="built_in">encodeURIComponent</span>(<span class="string">&#x27;https://app-a.com/callback&#x27;</span>); <span class="comment">// åº”ç”¨Açš„å›è°ƒåœ°å€</span></span><br><span class="line"> <span class="keyword">const</span> authUrl = <span class="string">`https://auth-server.com/authorize?response_type=code&amp;client_id=<span class="subst">$&#123;clientId&#125;</span>&amp;redirect_uri=<span class="subst">$&#123;redirectUri&#125;</span>`</span>;</span><br><span class="line"> <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = authUrl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è®¤è¯ä¸­å¿ƒç™»å½•</p><p>è®¤è¯ä¸­å¿ƒç”Ÿæˆè®¤è¯ç  + é‡å®šå‘A</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–URLä¸­çš„æˆæƒç </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getAuthorizationCode</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">const</span> urlParams = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>);</span><br><span class="line"> <span class="keyword">return</span> urlParams.<span class="title function_">get</span>(<span class="string">&#x27;code&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Aç”¨æˆæƒç å‘è®¤è¯ä¸­å¿ƒæ¢å–è®¿é—®ä»¤ç‰Œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨æˆæƒç æ¢å–è®¿é—®ä»¤ç‰Œ</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">exchangeToken</span>(<span class="params">code</span>) &#123;</span><br><span class="line"> <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;https://auth-server.com/token&#x27;</span>, &#123;</span><br><span class="line">     <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">     <span class="attr">headers</span>: &#123;</span><br><span class="line">         <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="attr">body</span>: <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(&#123;</span><br><span class="line">         <span class="attr">grant_type</span>: <span class="string">&#x27;authorization_code&#x27;</span>,</span><br><span class="line">         <span class="attr">code</span>: code,</span><br><span class="line">         <span class="attr">client_id</span>: <span class="string">&#x27;your-client-id&#x27;</span>,</span><br><span class="line">         <span class="attr">client_secret</span>: <span class="string">&#x27;your-client-secret&#x27;</span>,</span><br><span class="line">         <span class="attr">redirect_uri</span>: <span class="string">&#x27;https://app-a.com/callback&#x27;</span></span><br><span class="line">     &#125;)</span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line"> <span class="keyword">const</span> accessToken = data.<span class="property">access_token</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// ä¿å­˜è®¿é—®ä»¤ç‰Œ</span></span><br><span class="line"> <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;accessToken&#x27;</span>, accessToken);</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç™»å½•æˆåŠŸï¼Œè®¿é—®ä»¤ç‰Œå·²ä¿å­˜&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Aä¿å­˜ä»¤ç‰Œ</p></blockquote><blockquote><p><em><strong>ç”¨æˆ·è®¿é—®B</strong></em></p><p>Bæ£€æŸ¥æ˜¯å¦å·²ç™»å½• -&gt; (æœªç™»å½•é‡å®šå‘è®¤è¯ä¸­å¿ƒ)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="comment">// é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æˆæƒç </span></span><br><span class="line">&gt;<span class="keyword">const</span> code = <span class="title function_">getAuthorizationCode</span>();</span><br><span class="line">&gt;<span class="keyword">if</span> (code) &#123;</span><br><span class="line">&gt;<span class="title function_">exchangeToken</span>(code);</span><br><span class="line">&gt;&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">&gt;<span class="title function_">checkLoginStatus</span>();</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><p>è®¤è¯ä¸­å¿ƒè¯†åˆ«å·²ç™»å½•ï¼Œç›´æ¥è¿”å›Bå¹¶é™„å¸¦æˆæƒç </p><p>Bç”¨æˆæƒç å‘è®¤è¯ä¸­å¿ƒæ¢å–è®¿é—®ä»¤ç‰Œ</p></blockquote><p>åç«¯éƒ¨åˆ†</p><blockquote><p>è®¤è¯ä¸­å¿ƒç™»å½•é¡µé¢</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç™»å½•é¡µé¢ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;ç”¨æˆ·å&quot;</span> <span class="attr">required</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;å¯†ç &quot;</span> <span class="attr">required</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>ç™»å½•<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è®¤è¯ä¸­å¿ƒæ¥æ”¶åˆ°ç™»å½•è¯·æ±‚åï¼ŒéªŒè¯ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ç”Ÿæˆæˆæƒç </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">const</span> &#123; username, password &#125; = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// éªŒè¯ç”¨æˆ·ä¿¡æ¯ï¼ˆè¿™é‡Œä»…ä½œæ¼”ç¤ºï¼‰</span></span><br><span class="line"> <span class="keyword">if</span> (username === <span class="string">&#x27;admin&#x27;</span> &amp;&amp; password === <span class="string">&#x27;123456&#x27;</span>) &#123;</span><br><span class="line">     <span class="keyword">const</span> code = <span class="title function_">generateAuthorizationCode</span>(); <span class="comment">// ç”Ÿæˆéšæœºæˆæƒç </span></span><br><span class="line">     <span class="keyword">const</span> redirectUri = <span class="string">&#x27;https://app-a.com/callback&#x27;</span>; <span class="comment">// åº”ç”¨Açš„å›è°ƒåœ°å€</span></span><br><span class="line">     res.<span class="title function_">redirect</span>(<span class="string">`<span class="subst">$&#123;redirectUri&#125;</span>?code=<span class="subst">$&#123;code&#125;</span>`</span>);</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">send</span>(<span class="string">&#x27;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#x27;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateAuthorizationCode</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substring</span>(<span class="number">2</span>, <span class="number">15</span>); <span class="comment">// éšæœºå­—ç¬¦ä¸²</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åº”ç”¨Aæˆ–åº”ç”¨Bä½¿ç”¨æˆæƒç å‘è®¤è¯ä¸­å¿ƒå…‘æ¢è®¿é—®ä»¤ç‰Œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/token&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">const</span> &#123; grant_type, code, client_id, client_secret, redirect_uri &#125; = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// éªŒè¯æˆæƒç å’Œå®¢æˆ·ç«¯ä¿¡æ¯</span></span><br><span class="line"> <span class="keyword">if</span> (grant_type === <span class="string">&#x27;authorization_code&#x27;</span> &amp;&amp; <span class="title function_">isValidCode</span>(code)) &#123;</span><br><span class="line">     <span class="keyword">const</span> accessToken = <span class="title function_">generateAccessToken</span>(); <span class="comment">// ç”Ÿæˆéšæœºè®¿é—®ä»¤ç‰Œ</span></span><br><span class="line">     res.<span class="title function_">json</span>(&#123; <span class="attr">access_token</span>: accessToken &#125;);</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;æ— æ•ˆçš„æˆæƒç æˆ–å®¢æˆ·ç«¯ä¿¡æ¯&#x27;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateAccessToken</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substring</span>(<span class="number">2</span>, <span class="number">15</span>); <span class="comment">// éšæœºå­—ç¬¦ä¸²</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isValidCode</span>(<span class="params">code</span>) &#123;</span><br><span class="line"> <span class="comment">// éªŒè¯æˆæƒç æ˜¯å¦æœ‰æ•ˆï¼ˆè¿™é‡Œä»…ä½œæ¼”ç¤ºï¼‰</span></span><br><span class="line"> <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ol><li>ç”¨æˆ·è®¿é—®åº”ç”¨Aï¼Œå‰ç«¯æ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰è®¿é—®ä»¤ç‰Œã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™é‡å®šå‘åˆ°è®¤è¯ä¸­å¿ƒã€‚</li><li>ç”¨æˆ·åœ¨è®¤è¯ä¸­å¿ƒç™»å½•æˆåŠŸåï¼Œè®¤è¯ä¸­å¿ƒç”Ÿæˆæˆæƒç å¹¶é‡å®šå‘å›åº”ç”¨Aã€‚</li><li>åº”ç”¨Aä½¿ç”¨æˆæƒç å‘è®¤è¯ä¸­å¿ƒå…‘æ¢è®¿é—®ä»¤ç‰Œï¼Œå¹¶ä¿å­˜åˆ°æœ¬åœ°ã€‚</li><li>ç”¨æˆ·è®¿é—®åº”ç”¨Bï¼Œé‡å¤ä¸Šè¿°æµç¨‹ã€‚ç”±äºç”¨æˆ·å·²åœ¨è®¤è¯ä¸­å¿ƒç™»å½•ï¼Œè®¤è¯ä¸­å¿ƒä¼šç›´æ¥è¿”å›æˆæƒç ï¼Œæ— éœ€å†æ¬¡è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åŸå‹åŸå‹é“¾</title>
      <link href="/2025/05/12/JS/%E5%8E%9F%E5%9E%8B%E5%8E%9F%E5%9E%8B%E9%93%BE/"/>
      <url>/2025/05/12/JS/%E5%8E%9F%E5%9E%8B%E5%8E%9F%E5%9E%8B%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<h3 id="åŸå‹åŸå‹é“¾"><a href="#åŸå‹åŸå‹é“¾" class="headerlink" title="åŸå‹åŸå‹é“¾"></a>åŸå‹åŸå‹é“¾</h3><h4 id="åŸå‹"><a href="#åŸå‹" class="headerlink" title="åŸå‹"></a>åŸå‹</h4><blockquote><p>æ¯ä¸ª JS å¯¹è±¡ï¼ˆé™¤ <code>null</code>ï¼‰éƒ½æœ‰ä¸€ä¸ªéšè—çš„ <code>[[Prototype]]</code> å±æ€§ï¼ŒæŒ‡å‘å®ƒçš„â€œåŸå‹å¯¹è±¡â€ï¼ˆç®€ç§°åŸå‹ï¼‰</p><p>åŸå‹å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œå®ƒåŒ…å«å¯ä»¥è¢«å…¶ä»–å¯¹è±¡å…±äº«çš„å±æ€§å’Œæ–¹æ³•</p></blockquote><p>ä½œç”¨ï¼šå­˜æ”¾ä¸€äº›å±æ€§å’Œæ–¹æ³• + åœ¨JSä¸­å®ç°ç»§æ‰¿</p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250419084957083.png" alt="image-20250419084957083" style="zoom: 50%;" /><h4 id="åŸå‹é“¾"><a href="#åŸå‹é“¾" class="headerlink" title="åŸå‹é“¾"></a>åŸå‹é“¾</h4><p><strong>å¯ä»¥é€šè¿‡å®ä¾‹å¯¹è±¡çš„ <code>__proto__</code> å±æ€§è®¿é—®åŸå‹</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">arr.<span class="title function_">reverse</span>() <span class="comment">// ç¿»è½¬</span></span><br><span class="line">arr.<span class="title function_">sort</span>()   <span class="comment">// æ’åº// è¿™äº›æ–¹æ³•éƒ½æ˜¯æŒ‚è½½åˆ°Array.prototypeä¸Šçš„ï¼Œå¯ä»¥å…±äº«ç»™æ‰€æœ‰çš„æ•°ç»„å®ä¾‹ä½¿ç”¨</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span> === arr.<span class="property">__proto__</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><strong>æ‰€æœ‰åŸå‹å¯¹è±¡çš„ç»ˆç‚¹æ˜¯null</strong></p><p>åŸå‹é“¾çš„é¡¶ç«¯é€šå¸¸æ˜¯ <code>Object.prototype</code></p><blockquote><p>å½“è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æˆ–æ–¹æ³•æ—¶ï¼ŒJS ä¼šæ²¿ç€å¯¹è±¡çš„åŸå‹é“¾é€çº§å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°è¯¥å±æ€§æˆ–åˆ°è¾¾åŸå‹é“¾çš„ç»ˆç‚¹ï¼ˆ<code>null</code>ï¼‰ã€‚</p></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250419085919620.png" alt="image-20250419085919620" style="zoom:50%;" /><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>); <span class="comment">// null</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr.<span class="property">__proto__</span><span class="comment">//æŒ‡å‘Array.prototype</span></span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span><span class="comment">//æŒ‡å‘Object.prototypeï¼ˆArray.prototypeä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥ä¹Ÿæœ‰.__proto__ï¼‰</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span><span class="comment">//æŒ‡å‘null</span></span><br></pre></td></tr></table></figure><p><strong>å±æ€§æŸ¥æ‰¾ä¼šè‡ªåŠ¨æ²¿ç€åŸå‹é“¾è¿›è¡Œ</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123; <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">greet</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// åŸå‹ä¸Šçš„æ–¹æ³•</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, my name is <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>.`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> alice = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Alice&#x27;</span>); <span class="comment">// å®ä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(alice.<span class="property">greet</span> === alice.<span class="property">__proto__</span>.<span class="property">greet</span>); <span class="comment">// true // éƒ½æŒ‡å‘åŸå‹</span></span><br></pre></td></tr></table></figure><p>å½“ä½ å†™ <code>alice.greet()</code> æ—¶</p><blockquote><p>é¦–å…ˆæ£€æŸ¥ <code>alice</code> å¯¹è±¡æœ¬èº«æ˜¯å¦æœ‰ <code>greet</code> å±æ€§</p><p>å¦‚æœæ²¡æœ‰ï¼Œåˆ™ç»§ç»­æ£€æŸ¥ <code>alice.__proto__</code>ï¼ˆå³ <code>Person.prototype</code>ï¼‰</p><p>å¦‚æœåœ¨ <code>alice.__proto__</code> ä¸Šæ‰¾åˆ°äº† <code>greet</code> æ–¹æ³•ï¼Œåˆ™è°ƒç”¨å®ƒï¼Œ*<strong>å¹¶å°† <code>this</code> ç»‘å®šåˆ° <code>alice*</code></strong></p></blockquote><p>å®é™…ä¸Šï¼Œ<code>alice.greet()</code> æ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œç­‰ä»·äº <code>alice.__proto__.greet.call(alice)</code></p><p>æ‰€ä»¥ç›´æ¥æ¨èä½¿ç”¨ <strong><code>alice.greet()</code></strong> è€Œçœç•¥ <code>__proto__</code></p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>newæ“ä½œç¬¦</title>
      <link href="/2025/05/11/JS/new%E6%93%8D%E4%BD%9C%E7%AC%A6/"/>
      <url>/2025/05/11/JS/new%E6%93%8D%E4%BD%9C%E7%AC%A6/</url>
      
        <content type="html"><![CDATA[<h2 id="new"><a href="#new" class="headerlink" title="new"></a>new</h2><h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><blockquote><p>newä¼šåˆ›å»ºç©ºçš„<em><strong>æ–°å¯¹è±¡{}</strong></em>ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè¢«ä½œä¸ºæ„é€ å‡½æ•°çš„ä¸Šä¸‹æ–‡(å°±æ˜¯this)</p></blockquote><blockquote><p>æ–°å¯¹è±¡ä¼š<em><strong>é“¾æ¥åˆ°åŸå‹</strong></em>ï¼Œå†…éƒ¨å±æ€§ <code>[[Prototype]]</code> (<code>__proto__</code> æŒ‡å‘æ„é€ å‡½æ•°çš„ <code>prototype</code> å±æ€§)</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123; <span class="comment">// æ„é€ å‡½æ•°é¦–å­—æ¯é€šå¸¸å¤§å†™ï¼Œä»¥åŒºåˆ†æ™®é€šå‡½æ•°</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">greet</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// è®¾ç½®åŸå‹ä¸Šçš„æ–¹æ³•</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, my name is <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> and I am <span class="subst">$&#123;<span class="variable language_">this</span>.age&#125;</span> years old.`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ new åˆ›å»ºå®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> alice = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Alice&#x27;</span>, <span class="number">25</span>); <span class="comment">// åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ &#123;...&#125; // alice.__proto__ -&gt; Person.prototype</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(alice.<span class="property">name</span>); <span class="comment">// è¾“å‡º &#x27;Alice&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(alice.<span class="property">age</span>);  <span class="comment">// è¾“å‡º 25</span></span><br><span class="line">alice.<span class="title function_">greet</span>();           <span class="comment">// è¾“å‡º &#x27;Hello, my name is Alice and I am 25 years old.&#x27;</span></span><br></pre></td></tr></table></figure><p><em><strong>æ³¨æ„</strong></em>ï¼šåªè¦æ„é€ å‡½æ•°å«æœ‰thisï¼Œé¿å…å¿˜è®°ä½¿ç”¨ <code>new</code> è°ƒç”¨æ„é€ å‡½æ•°ï¼Œå¦åˆ™ <code>this</code> ä¼šæŒ‡å‘å…¨å±€å¯¹è±¡ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹ä¸º <code>undefined</code>ï¼‰</p><h3 id="æ‰‹å†™"><a href="#æ‰‹å†™" class="headerlink" title="æ‰‹å†™"></a>æ‰‹å†™</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myNew</span>(<span class="params">constructor, ...args</span>) &#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå¹¶ç»§æ‰¿æ„é€ å‡½æ•°çš„ prototype</span></span><br><span class="line">    <span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(constructor.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œå¹¶å°† this ç»‘å®šåˆ°æ–°å¯¹è±¡ä¸Š</span></span><br><span class="line">    <span class="keyword">const</span> result = constructor.<span class="title function_">apply</span>(obj, args);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. å¦‚æœæ„é€ å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œå¦åˆ™è¿”å›æ–°åˆ›å»ºçš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">typeof</span> result === <span class="string">&#x27;object&#x27;</span> &amp;&amp; result !== <span class="literal">null</span>) ? result : obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">// åŸå‹ä¸Šçš„æ–¹æ³•</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, I&#x27;m <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Alice&#x27;</span>, <span class="number">25</span>);</span><br><span class="line">p1.<span class="title function_">sayHello</span>(); <span class="comment">// è¾“å‡º &quot;Hello, I&#x27;m Alice&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p2 = <span class="title function_">myNew</span>(<span class="title class_">Person</span>, <span class="string">&#x27;Bob&#x27;</span>, <span class="number">30</span>);</span><br><span class="line">p2.<span class="title function_">sayHello</span>(); <span class="comment">// è¾“å‡º &quot;Hello, I&#x27;m Bob&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é˜²æŠ–å’ŒèŠ‚æµ</title>
      <link href="/2025/05/11/JS/%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81/"/>
      <url>/2025/05/11/JS/%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<h3 id="é˜²æŠ–å’ŒèŠ‚æµ"><a href="#é˜²æŠ–å’ŒèŠ‚æµ" class="headerlink" title="é˜²æŠ–å’ŒèŠ‚æµ"></a>é˜²æŠ–å’ŒèŠ‚æµ</h3><h4 id="é˜²æŠ–"><a href="#é˜²æŠ–" class="headerlink" title="é˜²æŠ–"></a>é˜²æŠ–</h4><blockquote><p>é‡æ–°å¼€å§‹ï¼Œåªæ‰§è¡Œæœ€åä¸€æ¬¡</p></blockquote><p>æœç´¢æ¡†è¾“å…¥ã€æ–‡æœ¬ç¼–è¾‘å™¨å®æ—¶ä¿å­˜</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> @<span class="attr">keyup</span>=<span class="string">&quot;handleKeyUp($event)&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timerId = <span class="title function_">ref</span>(<span class="literal">null</span>); <span class="comment">// ä½¿ç”¨ ref æ¥å­˜å‚¨å®šæ—¶å™¨ ID</span></span><br><span class="line"><span class="keyword">const</span> handleKeyUp = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (timerId.<span class="property">value</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timerId.<span class="property">value</span>); <span class="comment">// æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    timerId.<span class="property">value</span> = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(event.<span class="property">target</span>.<span class="property">value</span>); <span class="comment">// æ‰“å°è¾“å…¥æ¡†çš„å€¼</span></span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="èŠ‚æµ"><a href="#èŠ‚æµ" class="headerlink" title="èŠ‚æµ"></a>èŠ‚æµ</h4><blockquote><p>ä¸­é—´ç¦ç”¨ï¼Œåªæ‰§è¡Œæœ€å…ˆä¸€æ¬¡</p></blockquote><p>å¿«é€Ÿç‚¹å‡»ã€é¼ æ ‡æ»‘åŠ¨ã€scrolläº‹ä»¶ã€ä¸‹æ‹‰åŠ è½½ã€è§†é¢‘æ’­æ”¾å™¨è®°å½•æ—¶é—´</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timerId = <span class="title function_">ref</span>(<span class="literal">null</span>); <span class="comment">// ä½¿ç”¨ ref æ¥å­˜å‚¨å®šæ—¶å™¨çš„ ID</span></span><br><span class="line"><span class="keyword">const</span> handleKeyUp = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (timerId.<span class="property">value</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        timerId.<span class="property">value</span> = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(event.<span class="property">target</span>.<span class="property">value</span>); <span class="comment">// æ‰“å°è¾“å…¥æ¡†çš„å€¼</span></span><br><span class="line">            timerId.<span class="property">value</span> = <span class="literal">null</span>; <span class="comment">// æ¸…ç©ºå®šæ—¶å™¨ ID</span></span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WeakMap &amp; Map</title>
      <link href="/2025/05/11/JS/WeakMap&amp;Map/"/>
      <url>/2025/05/11/JS/WeakMap&amp;Map/</url>
      
        <content type="html"><![CDATA[<h3 id="WeakMap-Map"><a href="#WeakMap-Map" class="headerlink" title="WeakMap &amp; Map"></a>WeakMap &amp; Map</h3><p>æ ¸å¿ƒåŒºåˆ«åœ¨äº<strong>é”®ç±»å‹</strong>ã€<strong>å†…å­˜ç®¡ç†</strong>åŠ<strong>å¯éå†æ€§</strong>ï¼š</p><ol><li><strong>é”®ç±»å‹é™åˆ¶</strong>ï¼šWeakMap <em><strong>ä»…æ¥å—å¯¹è±¡ä½œä¸ºé”®</strong></em>ï¼ˆéå¯¹è±¡å¦‚å­—ç¬¦ä¸²ã€Symbolä¼šæŠ¥é”™ï¼‰ï¼Œè€ŒMapæ”¯æŒä»»æ„ç±»å‹é”®å€¼ã€‚</li><li><strong>å¼±å¼•ç”¨æœºåˆ¶</strong>ï¼šWeakMapçš„é”®æ˜¯å¼±å¼•ç”¨ï¼Œè‹¥é”®å¯¹è±¡æ— å…¶ä»–å¼ºå¼•ç”¨ï¼Œåƒåœ¾å›æ”¶æ—¶è‡ªåŠ¨æ¸…é™¤å¯¹åº”æ¡ç›®ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼›Mapå¼ºå¼•ç”¨é”®ï¼Œå³ä½¿å¯¹è±¡ä¸å†ä½¿ç”¨ï¼Œä»ä¿ç•™æ¡ç›®å¯¼è‡´å†…å­˜æ— æ³•é‡Šæ”¾ã€‚</li><li><strong>å¯éå†æ€§</strong>ï¼šWeakMapä¸å¯éå†ï¼ˆæ— <code>size</code>ã€<code>keys()</code>ç­‰æ–¹æ³•ï¼‰ï¼ŒMapæ”¯æŒè¿­ä»£å™¨è®¿é—®æ‰€æœ‰æ¡ç›®ã€‚</li><li><strong>APIå·®å¼‚</strong>ï¼šWeakMapä»…æœ‰<code>get</code>ã€<code>set</code>ã€<code>has</code>ã€<code>delete</code>æ–¹æ³•ï¼ŒMapé¢å¤–æä¾›<code>clear</code>ã€<code>forEach</code>åŠè¿­ä»£æ¥å£ã€‚</li></ol><p><strong>åº”ç”¨åœºæ™¯å¯¹æ¯”</strong>ï¼š</p><ul><li><strong>WeakMap</strong>ï¼šé€‚åˆå…³è”å¯¹è±¡ä¸å…ƒæ•°æ®ä¸”æ— éœ€æ‰‹åŠ¨æ¸…ç†ï¼ˆå¦‚DOMå…ƒç´ ç»‘å®šäº‹ä»¶å¤„ç†å™¨ï¼Œå…ƒç´ ç§»é™¤åè‡ªåŠ¨é‡Šæ”¾ï¼‰ã€‚</li><li><strong>Map</strong>ï¼šéœ€é•¿æœŸç»´æŠ¤é”®å€¼å¯¹æˆ–éå†æ“ä½œçš„åœºæ™¯ï¼ˆå¦‚ç¼“å­˜æ•°æ®ã€é¢‘ç‡ç»Ÿè®¡ï¼‰ã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WeakMapï¼šé”®ä¸ºå¯¹è±¡ï¼Œè‡ªåŠ¨æ¸…ç†  </span></span><br><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();  </span><br><span class="line"><span class="keyword">let</span> obj = &#123;&#125;;  </span><br><span class="line">wm.<span class="title function_">set</span>(obj, <span class="string">&#x27;data&#x27;</span>);  </span><br><span class="line">obj = <span class="literal">null</span>; <span class="comment">// åƒåœ¾å›æ”¶åï¼Œwmä¸­å¯¹åº”æ¡ç›®è‡ªåŠ¨æ¸…é™¤  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Mapï¼šé”®ä»»æ„ç±»å‹ï¼Œéœ€æ‰‹åŠ¨ç®¡ç†  </span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();  </span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>);  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="property">size</span>); <span class="comment">// 1ï¼Œå¯è·å–å¤§å°  </span></span><br></pre></td></tr></table></figure><p><strong>å†…å­˜æ³„æ¼å¯¹æ¯”</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mapå¯¼è‡´å†…å­˜æ³„æ¼  </span></span><br><span class="line"><span class="keyword">let</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>);  </span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();  </span><br><span class="line">map.<span class="title function_">set</span>(element, <span class="string">&#x27;info&#x27;</span>);  </span><br><span class="line">element.<span class="title function_">remove</span>(); <span class="comment">// DOMç§»é™¤ï¼Œä½†mapä»ä¿ç•™å¼•ç”¨ï¼Œelementæ— æ³•è¢«å›æ”¶  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// WeakMapè‡ªåŠ¨é‡Šæ”¾  </span></span><br><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();  </span><br><span class="line">wm.<span class="title function_">set</span>(element, <span class="string">&#x27;info&#x27;</span>);  </span><br><span class="line">element.<span class="title function_">remove</span>(); <span class="comment">// æ— å…¶ä»–å¼•ç”¨æ—¶ï¼Œwmæ¡ç›®è‡ªåŠ¨æ¸…é™¤  </span></span><br></pre></td></tr></table></figure><p>WeakMapç”¨äºç®¡ç†çŸ­æœŸæˆ–ä¸´æ—¶çŠ¶æ€ï¼Œä»¥åŠé¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼é—®é¢˜ï¼Œé€‚ç”¨äºä¸´æ—¶å…³è” ç”Ÿå‘½å‘¨æœŸä¸é”®å¯¹è±¡ç»‘å®šã€ç¼“å­˜ã€æ¨¡æ‹Ÿç§æœ‰å±æ€§ çš„åœºæ™¯</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Symbol</title>
      <link href="/2025/05/11/JS/Symbol/"/>
      <url>/2025/05/11/JS/Symbol/</url>
      
        <content type="html"><![CDATA[<h3 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h3><p>Symbol æ˜¯ JavaScript ä¸­ä¸€ç§<strong>å”¯ä¸€ä¸”ä¸å¯å˜</strong>çš„åŸå§‹æ•°æ®ç±»å‹ï¼Œå…¶æ ¸å¿ƒåº”ç”¨åœºæ™¯å’Œå†…å­˜ç®¡ç†ç‰¹æ€§å¦‚ä¸‹ï¼š</p><hr><h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a><strong>ä½¿ç”¨åœºæ™¯</strong></h4><ol><li><p><strong>å”¯ä¸€å±æ€§é”®</strong><br>è§£å†³å¯¹è±¡å±æ€§åå†²çªé—®é¢˜ï¼Œç¡®ä¿ç¬¬ä¸‰æ–¹åº“æ‰©å±•å¯¹è±¡å±æ€§æ—¶äº’ä¸å½±å“ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">LOG_LEVEL</span> = <span class="title class_">Symbol</span>(<span class="string">&#x27;log&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> config = &#123; [<span class="variable constant_">LOG_LEVEL</span>]: <span class="string">&#x27;debug&#x27;</span> &#125;; <span class="comment">// é¿å…ä¸å¯èƒ½çš„ç°æœ‰å±æ€§å†²çª</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ¨¡æ‹Ÿç§æœ‰æˆå‘˜</strong><br>é€šè¿‡éæšä¸¾ç‰¹æ€§éšè—å†…éƒ¨å®ç°ï¼ˆéœ€é…åˆé—­åŒ…ï¼‰ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _counter = <span class="title class_">Symbol</span>(<span class="string">&#x27;counter&#x27;</span>);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>[_counter] = <span class="number">0</span>; <span class="comment">// å¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>[_counter]++; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ³¨ï¼šé€šè¿‡Object.getOwnPropertySymbolsä»å¯è®¿é—®ï¼Œéç»å¯¹ç§æœ‰</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å†…ç½®åè®®é©±åŠ¨</strong><br>é€šè¿‡ Well-Known Symbols å®šåˆ¶å¯¹è±¡è¡Œä¸ºï¼š</p><ul><li><p><strong>è¿­ä»£åè®®</strong>ï¼š<code>Symbol.iterator</code> å®šä¹‰å¯è¿­ä»£å¯¹è±¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> range = &#123;</span><br><span class="line">    [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]() &#123; <span class="comment">/* è¿”å›è¿­ä»£å™¨ */</span> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p><strong>ç±»å‹æ ‡ç­¾</strong>ï¼š<code>Symbol.toStringTag</code> è‡ªå®šä¹‰ <code>Object.prototype.toString</code> è¾“å‡º</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyCollection</span> &#123;</span><br><span class="line">  get [<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]() &#123; <span class="keyword">return</span> <span class="string">&#x27;MyCollection&#x27;</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">MyCollection</span>()); <span class="comment">// [object MyCollection]</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>å…ƒç¼–ç¨‹ä¸æ¡†æ¶è®¾è®¡</strong><br>åœ¨æ¡†æ¶ä¸­æ ‡è®°ç‰¹æ®Šé€»è¾‘ï¼Œå¦‚ React çš„ <code>Symbol.for(&#39;react.element&#39;)</code> æ ‡è¯†è™šæ‹Ÿ DOM å…ƒç´ ã€‚</p></li></ol><hr><h4 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a><strong>å†…å­˜ç®¡ç†</strong></h4><ol><li><p><strong>å”¯ä¸€æ€§ä¸å†…å­˜å ç”¨</strong></p><ul><li><p><strong>æ™®é€š Symbol</strong>ï¼šæ¯æ¬¡ <code>Symbol()</code> è°ƒç”¨ç”Ÿæˆå”¯ä¸€å€¼ï¼Œå³ä½¿æè¿°ç›¸åŒï¼Œå†…å­˜ç‹¬ç«‹åˆ†é…ã€‚</p></li><li><p><strong>å…¨å±€ Symbol</strong>ï¼š<code>Symbol.for(key)</code> åœ¨å…¨å±€æ³¨å†Œè¡¨ä¸­å¤ç”¨åŒä¸€å€¼ï¼Œå‡å°‘é‡å¤åˆ›å»ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s1 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;foo&#x27;</span>); <span class="comment">// åˆ›å»ºæˆ–è·å–å…¨å±€Symbol</span></span><br><span class="line"><span class="keyword">const</span> s2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">s1 === s2; <span class="comment">// trueï¼ˆå…±äº«å†…å­˜ï¼‰</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>å†…å­˜å›æ”¶</strong></p><ul><li><strong>ä½œä¸ºå±æ€§é”®</strong>ï¼šè‹¥å¯¹è±¡è¢«å›æ”¶ï¼Œå…¶ Symbol å±æ€§é”®å ç”¨çš„å†…å­˜éšå¯¹è±¡é‡Šæ”¾ã€‚</li><li><strong>å…¨å±€æ³¨å†Œè¡¨</strong>ï¼š<code>Symbol.for</code> åˆ›å»ºçš„ Symbol ä¼šæŒç»­å­˜åœ¨ï¼Œéœ€é¿å…æ»¥ç”¨å¯¼è‡´å†…å­˜ç´¯ç§¯ã€‚</li></ul></li><li><p><strong>æ½œåœ¨æ³„æ¼åœºæ™¯</strong><br>é•¿æœŸæŒæœ‰å« Symbol é”®çš„å¯¹è±¡ï¼ˆå¦‚å…¨å±€ç¼“å­˜ï¼‰å¯èƒ½å¯¼è‡´å†…å­˜æ— æ³•é‡Šæ”¾ï¼Œéœ€é€šè¿‡å¼±å¼•ç”¨ä¼˜åŒ–ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"><span class="keyword">const</span> key = <span class="title class_">Symbol</span>(<span class="string">&#x27;temp&#x27;</span>);</span><br><span class="line">wm.<span class="title function_">set</span>(key, largeData); <span class="comment">// WeakMapä¸é˜»æ­¢keyè¢«å›æ”¶</span></span><br></pre></td></tr></table></figure></li></ol><hr><h4 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a><strong>æœ€ä½³å®è·µ</strong></h4><ul><li><strong>æŒ‰éœ€é€‰æ‹©ä½œç”¨åŸŸ</strong>ï¼šä¼˜å…ˆä½¿ç”¨å±€éƒ¨ Symbolï¼Œä»…åœ¨éœ€è¦è·¨æ¨¡å—å…±äº«æ—¶ç”¨ <code>Symbol.for</code>ã€‚</li><li><strong>é¿å…å…¨å±€æ»¥ç”¨</strong>ï¼šå‡å°‘å…¨å±€æ³¨å†Œè¡¨çš„ Symbol æ•°é‡ï¼Œé˜²æ­¢å†…å­˜é©»ç•™ã€‚</li><li><strong>ç»“åˆ WeakMap</strong>ï¼šå¯¹éœ€è¦å…³è” Symbol ä¸å¤§æ•°æ®é‡çš„åœºæ™¯ï¼Œä½¿ç”¨å¼±å¼•ç”¨ç»“æ„ç®¡ç†ã€‚</li></ul><h4 id="ç¤ºä¾‹å¯¹æ¯”"><a href="#ç¤ºä¾‹å¯¹æ¯”" class="headerlink" title="ç¤ºä¾‹å¯¹æ¯”"></a><strong>ç¤ºä¾‹å¯¹æ¯”</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ™®é€šSymbolï¼ˆç‹¬ç«‹å†…å­˜ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> s1 = <span class="title class_">Symbol</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> s2 = <span class="title class_">Symbol</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">s1 === s2; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€Symbolï¼ˆå†…å­˜å¤ç”¨ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> g1 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> g2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">g1 === g2; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>Symbol é€šè¿‡å”¯ä¸€æ€§å’Œåè®®æ‰©å±•èƒ½åŠ›ï¼Œä¸ºå¤æ‚ç³»ç»Ÿè®¾è®¡æä¾›åº•å±‚æ”¯æŒï¼Œåˆç†ä½¿ç”¨å¯æå‡ä»£ç å¥å£®æ€§ï¼Œä½†éœ€å…³æ³¨å…¶å†…å­˜ç‰¹æ€§ä»¥é¿å…æ½œåœ¨é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ·±&#92;æµ…æ‹·è´</title>
      <link href="/2025/05/11/JS/%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/"/>
      <url>/2025/05/11/JS/%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/</url>
      
        <content type="html"><![CDATA[<h3 id="æ·±-æµ…æ‹·è´"><a href="#æ·±-æµ…æ‹·è´" class="headerlink" title="æ·±&#x2F;æµ…æ‹·è´"></a>æ·±&#x2F;æµ…æ‹·è´</h3><p>æ·±æµ…æ‹·è´çš„æ ¸å¿ƒåŒºåˆ«åœ¨äº<em><strong>æ˜¯å¦é€’å½’å¤åˆ¶å¯¹è±¡çš„æ‰€æœ‰å±‚çº§å¼•ç”¨ç±»å‹å±æ€§</strong></em>ï¼Œå¸¸è§å®ç°æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><hr><h4 id="æµ…æ‹·è´å®ç°"><a href="#æµ…æ‹·è´å®ç°" class="headerlink" title="æµ…æ‹·è´å®ç°"></a><strong>æµ…æ‹·è´å®ç°</strong></h4><blockquote><p>å°†åŸå§‹å¯¹è±¡æˆ–æ•°ç»„ä¸­çš„å…ƒç´ é€ä¸ªå¤åˆ¶åˆ°æ–°å¯¹è±¡æˆ–æ•°ç»„ä¸­</p><p>åªä¼š<strong>å¤åˆ¶å®ƒä»¬çš„å¼•ç”¨</strong>ï¼Œè€Œä¸ä¼šåˆ›å»ºè¿™äº›åµŒå¥—å¯¹è±¡æˆ–æ•°ç»„çš„æ–°å‰¯æœ¬ï¼ˆæ”¹å˜åŸå§‹å¯¹è±¡ä¼šåŒæ—¶å½±å“æ‹·è´å¯¹è±¡ï¼‰</p></blockquote><ol><li><p><strong><code>Object.assign()</code></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">2</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">const</span> copy = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, obj);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy); <span class="comment">// &#123; a: 1, b: &#123; c: 2 &#125; &#125;</span></span><br><span class="line">obj.<span class="property">b</span>.<span class="property">c</span> = <span class="number">3</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">b</span>.<span class="property">c</span>); <span class="comment">// è¾“å‡º: 3 (ä¿®æ”¹äº†åŸå§‹å¯¹è±¡çš„åµŒå¥—å¯¹è±¡ï¼Œå½±å“åˆ°äº†æµ…æ‹·è´)</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ‰©å±•è¿ç®—ç¬¦ï¼ˆ<code>...</code>ï¼‰</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">2</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">const</span> copy = &#123; ...obj &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy); <span class="comment">// &#123; a: 1, b: &#123; c: 2 &#125; &#125;</span></span><br><span class="line">obj.<span class="property">b</span>.<span class="property">c</span> = <span class="number">3</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">b</span>.<span class="property">c</span>); <span class="comment">// è¾“å‡º: 3 (åŒä¸Š)</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ•°ç»„æ–¹æ³•</strong><br><code>slice</code>ã€<code>concat</code>ç­‰è¿”å›æ–°æ•°ç»„ï¼Œä½†åµŒå¥—å¯¹è±¡ä»å…±äº«å¼•ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, &#123; <span class="attr">x</span>: <span class="number">2</span> &#125;];</span><br><span class="line"><span class="keyword">const</span> copy = arr.<span class="title function_">slice</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy); <span class="comment">// [1, &#123; x: 2 &#125;]</span></span><br><span class="line">arr[<span class="number">1</span>].<span class="property">x</span> = <span class="number">3</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy[<span class="number">1</span>].<span class="property">x</span>); <span class="comment">// è¾“å‡º: 3 (åŒä¸Š)</span></span><br></pre></td></tr></table></figure></li></ol><hr><h4 id="æ·±æ‹·è´å®ç°"><a href="#æ·±æ‹·è´å®ç°" class="headerlink" title="æ·±æ‹·è´å®ç°"></a><strong>æ·±æ‹·è´å®ç°</strong></h4><blockquote><p>é€’å½’åœ°å¤åˆ¶æ•´ä¸ªå¯¹è±¡åŠå…¶åµŒå¥—çš„å¯¹è±¡æˆ–æ•°ç»„ï¼Œåˆ›å»ºä¸€ä¸ª<strong>å®Œå…¨ç‹¬ç«‹çš„æ–°å¯¹è±¡æˆ–æ•°ç»„</strong></p></blockquote><h5 id="1-JSONåºåˆ—åŒ–ï¼ˆå±€é™æ€§æ˜æ˜¾ï¼‰"><a href="#1-JSONåºåˆ—åŒ–ï¼ˆå±€é™æ€§æ˜æ˜¾ï¼‰" class="headerlink" title="1. JSONåºåˆ—åŒ–ï¼ˆå±€é™æ€§æ˜æ˜¾ï¼‰"></a><strong>1. JSONåºåˆ—åŒ–ï¼ˆå±€é™æ€§æ˜æ˜¾ï¼‰</strong></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> deepCopy = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">2</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">const</span> deepCopy = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(deepCopy); <span class="comment">// &#123; a: 1, b: &#123; c: 2 &#125; &#125;</span></span><br><span class="line">obj.<span class="property">b</span>.<span class="property">c</span> = <span class="number">3</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(deepCopy.<span class="property">b</span>.<span class="property">c</span>); <span class="comment">// è¾“å‡º: 2 (æœªå—å½±å“)</span></span><br></pre></td></tr></table></figure><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>å¿½ç•¥<code>undefined</code>ã€<code>Symbol</code>ã€å‡½æ•°å±æ€§</li><li>æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆå¦‚<code>obj.self = obj</code>ï¼‰</li><li>ç ´åç‰¹æ®Šå¯¹è±¡ç±»å‹ï¼ˆå¦‚<code>Date</code>è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œ<code>RegExp</code>è½¬ä¸ºç©ºå¯¹è±¡ï¼‰</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;example&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="literal">undefined</span>,</span><br><span class="line">    <span class="attr">today</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">    <span class="attr">pattern</span>: <span class="regexp">/abc/g</span>,</span><br><span class="line">    <span class="attr">sayHello</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="property">self</span> = obj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> copiedObj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj)); <span class="comment">// å¯¹è±¡ä¸­æœ‰å¾ªç¯å¼•ç”¨ï¼ˆå³å¯¹è±¡å†…éƒ¨åŒ…å«å¯¹å…¶è‡ªèº«çš„å¼•ç”¨ï¼‰ï¼ŒJSON.stringify() ä¼šæŠ›å‡ºé”™è¯¯</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copiedObj); <span class="comment">// è¾“å‡º: &#123; name: &#x27;example&#x27; &#125; - undefinedçš„å±æ€§ï¼Œå‡½æ•° éƒ½ä¸¢å¤±äº†</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> copiedObj.<span class="property">today</span>); <span class="comment">// è¾“å‡º: string - åŸæœ¬çš„ Date å¯¹è±¡å˜æˆäº†å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copiedObj.<span class="property">pattern</span>); <span class="comment">// è¾“å‡º: undefined - æ­£åˆ™è¡¨è¾¾å¼ä¸¢å¤±äº†</span></span><br></pre></td></tr></table></figure><blockquote><p><code>JSON.stringify()</code> åªä¼šåºåˆ—åŒ–å¯¹è±¡çš„å¯æšä¸¾å±æ€§ï¼Œä»»ä½•ä¸å¯æšä¸¾çš„å±æ€§éƒ½ä¼šè¢«å¿½ç•¥ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(&#123;&#125;, &#123;</span><br><span class="line">    <span class="attr">hidden</span>: &#123;</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;This is hidden&quot;</span>,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">visible</span>: &#123;</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;This is visible&quot;</span>,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> copiedObj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copiedObj.<span class="property">hidden</span>); <span class="comment">// è¾“å‡º: undefined - éå¯æšä¸¾å±æ€§ä¸¢å¤±</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copiedObj.<span class="property">visible</span>); <span class="comment">// è¾“å‡º: &quot;This is visible&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p><code>JSON.stringify()</code> åªä¼šåºåˆ—åŒ–å¯¹è±¡è‡ªèº«çš„å±æ€§ï¼Œä¸ä¼šä¿ç•™åŸå‹é“¾ä¸Šçš„å±æ€§æˆ–æ–¹æ³•</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello, my name is &quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> copiedPerson = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(person));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copiedPerson); <span class="comment">// è¾“å‡º: &#123; name: &#x27;Alice&#x27; &#125; - åŸå‹é“¾ä¸Šçš„ sayHello æ–¹æ³•ä¸¢å¤±äº†</span></span><br></pre></td></tr></table></figure><h5 id="2-é€’å½’æ‰‹åŠ¨å®ç°"><a href="#2-é€’å½’æ‰‹åŠ¨å®ç°" class="headerlink" title="2. é€’å½’æ‰‹åŠ¨å®ç°"></a><strong>2. é€’å½’æ‰‹åŠ¨å®ç°</strong></h5><blockquote><p>åœ¨è¿™é‡Œæ”¾ä¸€ä¸ªå¯¹è±¡ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="attr">child</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;child&quot;</span>,</span><br><span class="line">        <span class="attr">sibling</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;sibling&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="property">child</span>.<span class="property">sibling</span>.<span class="property">parent</span> = obj; <span class="comment">// åˆ›å»ºå¾ªç¯å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clonedObj = <span class="title function_">deepClone</span>(obj);</span><br></pre></td></tr></table></figure><p><strong>åŸºç¡€ç‰ˆæœ¬</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">target, map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">&#x27;object&#x27;</span> || target === <span class="literal">null</span>) <span class="keyword">return</span> target;</span><br><span class="line">    <span class="keyword">if</span> (map.<span class="title function_">has</span>(target)) <span class="keyword">return</span> map.<span class="title function_">get</span>(target); <span class="comment">// è§£å†³å¾ªç¯å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cloneTarget = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(target) ? [] : &#123;&#125;;</span><br><span class="line">    map.<span class="title function_">set</span>(target, cloneTarget);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> target) &#123;</span><br><span class="line">        <span class="keyword">if</span> (target.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">            cloneTarget[key] = <span class="title function_">deepClone</span>(target[key], map); <span class="comment">// é€’å½’</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cloneTarget;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŒ–ç‰ˆæœ¬</strong>ï¼šå¤„ç†ç‰¹æ®Šå¯¹è±¡ç±»å‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getType</span> = obj =&gt; <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj).<span class="title function_">slice</span>(<span class="number">8</span>, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">target, map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) &#123;</span><br><span class="line">  <span class="comment">// åŸºæœ¬ç±»å‹ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">&#x27;object&#x27;</span> || target === <span class="literal">null</span>) <span class="keyword">return</span> target;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¤„ç†å¾ªç¯å¼•ç”¨</span></span><br><span class="line">  <span class="keyword">if</span> (map.<span class="title function_">has</span>(target)) <span class="keyword">return</span> map.<span class="title function_">get</span>(target);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¤„ç†ç‰¹æ®Šå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> type = <span class="title function_">getType</span>(target);</span><br><span class="line">  <span class="keyword">let</span> clone;</span><br><span class="line">  <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Date&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(target.<span class="title function_">getTime</span>());</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;RegExp&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RegExp</span>(target.<span class="property">source</span>, target.<span class="property">flags</span>);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Set&#x27;</span>:</span><br><span class="line">      clone = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">      target.<span class="title function_">forEach</span>(<span class="function"><span class="params">v</span> =&gt;</span> clone.<span class="title function_">add</span>(<span class="title function_">deepClone</span>(v, map)));</span><br><span class="line">      <span class="keyword">return</span> clone;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Map&#x27;</span>:</span><br><span class="line">      clone = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">      target.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, k</span>) =&gt;</span> clone.<span class="title function_">set</span>(k, <span class="title function_">deepClone</span>(v, map)));</span><br><span class="line">      <span class="keyword">return</span> clone;</span><br><span class="line">    <span class="comment">// å…¶ä»–ç±»å‹å¦‚ArrayBufferã€TypedArrayç­‰ç±»ä¼¼å¤„ç†</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      clone = <span class="keyword">new</span> target.<span class="title function_">constructor</span>(<span class="params"></span>); <span class="comment">// ä¿æŒåŸå‹é“¾</span></span><br><span class="line">      map.<span class="title function_">set</span>(target, clone);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> target) &#123;</span><br><span class="line">        <span class="keyword">if</span> (target.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">          clone[key] = <span class="title function_">deepClone</span>(target[key], map);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> clone;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“"><a href="#3-ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“" class="headerlink" title="3. ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“"></a><strong>3. ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“</strong></h5><ul><li><p><strong>Lodashçš„<code>_.cloneDeep</code></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> cloned = _.<span class="title function_">cloneDeep</span>(obj);</span><br></pre></td></tr></table></figure><p>æ”¯æŒå¤æ‚ç±»å‹ï¼ˆå¦‚<code>Buffer</code>ã€<code>Error</code>å¯¹è±¡ï¼‰åŠå¾ªç¯å¼•ç”¨ã€‚</p></li></ul><h5 id="4-æµè§ˆå™¨åŸç”ŸAPIï¼ˆç»“æ„åŒ–å…‹éš†ï¼‰"><a href="#4-æµè§ˆå™¨åŸç”ŸAPIï¼ˆç»“æ„åŒ–å…‹éš†ï¼‰" class="headerlink" title="4. æµè§ˆå™¨åŸç”ŸAPIï¼ˆç»“æ„åŒ–å…‹éš†ï¼‰"></a><strong>4. æµè§ˆå™¨åŸç”ŸAPIï¼ˆç»“æ„åŒ–å…‹éš†ï¼‰</strong></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨MessageChannel</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">structuredClone</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; port1, port2 &#125; = <span class="keyword">new</span> <span class="title class_">MessageChannel</span>();</span><br><span class="line">    port2.<span class="property">onmessage</span> = <span class="function"><span class="params">ev</span> =&gt;</span> <span class="title function_">resolve</span>(ev.<span class="property">data</span>);</span><br><span class="line">    port1.<span class="title function_">postMessage</span>(obj);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æˆ–ç›´æ¥è°ƒç”¨ï¼ˆéœ€ç¯å¢ƒæ”¯æŒï¼‰</span></span><br><span class="line"><span class="keyword">const</span> cloned = <span class="variable language_">window</span>.<span class="title function_">structuredClone</span>(obj);</span><br></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>æ”¯æŒå¾ªç¯å¼•ç”¨ã€æ›´å¤šå†…ç½®ç±»å‹ï¼ˆå¦‚<code>Blob</code>ã€<code>File</code>ï¼‰</li><li>å…¼å®¹æ€§é—®é¢˜ï¼šæ—§æµè§ˆå™¨ä¸æ”¯æŒ<code>structuredClone</code>æ–¹æ³•</li></ul><hr><h5 id="æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹å»ºè®®"><a href="#æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹å»ºè®®" class="headerlink" title="æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹å»ºè®®"></a><strong>æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹å»ºè®®</strong></h5><ul><li><strong>ç®€å•æ•°æ®</strong>ï¼šä¼˜å…ˆç”¨<code>JSON</code>æ–¹æ¡ˆï¼ˆæ³¨æ„æ•°æ®ç±»å‹é™åˆ¶ï¼‰</li><li><strong>å¤æ‚å¯¹è±¡</strong>ï¼šæ¨è<code>Lodash.cloneDeep</code>æˆ–æ‰‹åŠ¨é€’å½’å®ç°</li><li><strong>æµè§ˆå™¨ç¯å¢ƒ</strong>ï¼šä¼˜å…ˆç”¨<code>structuredClone</code>ï¼ˆå…¼å®¹æ—¶ï¼‰</li><li><strong>é«˜é¢‘æ·±æ‹·è´</strong>ï¼šå¯ç¼“å­˜å‡½æ•°æˆ–ä½¿ç”¨<code>Immutable.js</code>ç­‰ä¸å¯å˜æ•°æ®ç»“æ„ä¼˜åŒ–</li></ul><p><strong>å¾ªç¯å¼•ç”¨æµ‹è¯•</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line">obj.<span class="property">self</span> = obj;</span><br><span class="line"><span class="keyword">const</span> cloned = <span class="title function_">deepClone</span>(obj); <span class="comment">// é€’å½’å®ç°å¯æ­£ç¡®å¤„ç†</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cloned.<span class="property">self</span> === cloned); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å†…å­˜æ³„æ¼</title>
      <link href="/2025/05/11/JS/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/"/>
      <url>/2025/05/11/JS/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="å†…å­˜æ³„æ¼"><a href="#å†…å­˜æ³„æ¼" class="headerlink" title="å†…å­˜æ³„æ¼"></a>å†…å­˜æ³„æ¼</h3><blockquote><p><strong>ä¸å†ä½¿ç”¨çš„å†…å­˜æœªè¢« GC æœºåˆ¶é‡Šæ”¾</strong>ï¼Œå¯¼è‡´ <strong>å†…å­˜å ç”¨æŒç»­å¢é•¿</strong>ï¼Œæœ€ç»ˆå¯èƒ½å¼•å‘æ€§èƒ½é—®é¢˜æˆ–ç¨‹åºå´©æºƒã€‚</p><p>è¯¥é—®é¢˜åªå­˜åœ¨äºå¯åŠ¨çš„ç›¸å…³é¡µé¢è¿›ç¨‹ä¸­ï¼Œå¹¶ä¸ä¼šæ°¸ä¹…æ€§åœ°å æ®ç”µè„‘å†…å­˜</p><p>ä¸€æ—¦ç›¸å…³è¿›ç¨‹ç»“æŸï¼ˆå…³é—­æµè§ˆå™¨æ ‡ç­¾ã€é‡å¯æµè§ˆå™¨æˆ–åº”ç”¨ï¼‰æ“ä½œç³»ç»Ÿä¼šå›æ”¶è¯¥è¿›ç¨‹å ç”¨çš„æ‰€æœ‰å†…å­˜ã€‚</p></blockquote><h4 id="å¯¼è‡´æˆå› "><a href="#å¯¼è‡´æˆå› " class="headerlink" title="å¯¼è‡´æˆå› "></a>å¯¼è‡´æˆå› </h4><h5 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="headerlink" title="å…¨å±€å˜é‡"></a>å…¨å±€å˜é‡</h5><blockquote><p>æ„å¤–å‡ºç°çš„å…¨å±€å˜é‡</p><p><em><strong>å…¨å±€å˜é‡ä¸ä¼šè¢« GC å›æ”¶ï¼Œç›´åˆ°é¡µé¢å…³é—­</strong></em></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">leak</span>(<span class="params"></span>) &#123;</span><br><span class="line">    leakedData = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1000000</span>); <span class="comment">// æœªä½¿ç”¨ var/let/constï¼Œå˜é‡å˜ä¸ºå…¨å±€å˜é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼ï¼ˆ<code>&#39;use strict&#39;</code>ï¼‰é¿å…éšå¼å…¨å±€å˜é‡</li></ul><h5 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h5><blockquote><p><em><strong>é—­åŒ…å¼•ç”¨çš„å¤–éƒ¨å˜é‡ä¼šé•¿æœŸé©»ç•™å†…å­˜</strong></em></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createClosure</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> largeData = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1000000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(largeData); <span class="comment">// largeData è¢«é—­åŒ…å¼•ç”¨ï¼Œä¼šé•¿æœŸé©»ç•™å†…å­˜</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> closure = <span class="title function_">createClosure</span>();</span><br></pre></td></tr></table></figure><ul><li>æ‰‹åŠ¨è§£é™¤å¼•ç”¨ï¼ˆå¦‚ <code>closure = null</code>ï¼‰</li></ul><h5 id="å®šæ—¶å™¨-å›è°ƒå‡½æ•°"><a href="#å®šæ—¶å™¨-å›è°ƒå‡½æ•°" class="headerlink" title="å®šæ—¶å™¨&amp;å›è°ƒå‡½æ•°"></a>å®šæ—¶å™¨&amp;å›è°ƒå‡½æ•°</h5><blockquote><p><em><strong>å®šæ—¶å™¨æœªæ¸…é™¤æ—¶ï¼Œå›è°ƒå‡½æ•°åŠå…¶å¼•ç”¨å˜é‡æ— æ³•é‡Šæ”¾</strong></em></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// é•¿æœŸè¿è¡Œçš„å®šæ—¶å™¨ï¼Œå†…éƒ¨å¯èƒ½æŒæœ‰å¤–éƒ¨å˜é‡</span></span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>clearInterval(timer)</code> æˆ– <code>clearTimeout</code> åŠæ—¶æ¸…ç†</li></ul><h5 id="æœªè§£ç»‘çš„DOMäº‹ä»¶ç›‘å¬"><a href="#æœªè§£ç»‘çš„DOMäº‹ä»¶ç›‘å¬" class="headerlink" title="æœªè§£ç»‘çš„DOMäº‹ä»¶ç›‘å¬"></a>æœªè§£ç»‘çš„DOMäº‹ä»¶ç›‘å¬</h5><blockquote><p>DOM å…ƒç´ è¢«ç§»é™¤åï¼Œäº‹ä»¶ç›‘å¬å™¨ä»å¯èƒ½æŒæœ‰å¼•ç”¨</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> button = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">button.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, handleClick);</span><br><span class="line"><span class="comment">// å¦‚æœå…ƒç´ è¢«ç§»é™¤ä½†æœªè§£ç»‘äº‹ä»¶ï¼ŒhandleClick å’Œå…³è”çš„ DOM å…ƒç´ å¯èƒ½æ³„æ¼</span></span><br></pre></td></tr></table></figure><ul><li>ç§»é™¤å…ƒç´ å‰è°ƒç”¨ <code>removeEventListener</code></li></ul><h5 id="DOMå¼•ç”¨æ®‹ç•™"><a href="#DOMå¼•ç”¨æ®‹ç•™" class="headerlink" title="DOMå¼•ç”¨æ®‹ç•™"></a>DOMå¼•ç”¨æ®‹ç•™</h5><blockquote><p>JS å¯¹è±¡æŒæœ‰ DOM å¼•ç”¨æ—¶ï¼ŒDOM å…ƒç´ æ— æ³•è¢« GC å›æ”¶</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elements = &#123;</span><br><span class="line">    <span class="attr">button</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;button&#x27;</span>),</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å³ä½¿ä»é¡µé¢ç§»é™¤ buttonï¼Œelements.button ä»ä¿ç•™å¯¹ DOM çš„å¼•ç”¨</span></span><br></pre></td></tr></table></figure><ul><li>æ‰‹åŠ¨è§£é™¤å¼•ç”¨ï¼ˆå¦‚ <code>elements.button = null</code>ï¼‰</li></ul><h5 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h5><blockquote><p>æœªé™åˆ¶ç¼“å­˜å¤§å°ï¼Œæ•°æ®å †ç§¯å¯¼è‡´å†…å­˜å ç”¨ä¸Šå‡</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cache = &#123;&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addToCache</span>(<span class="params">key, data</span>) &#123;</span><br><span class="line">    cache[key] = data; <span class="comment">// ç¼“å­˜æ•°æ®æ— é™å¢é•¿</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ LRU ç¼“å­˜ç­–ç•¥æˆ–å®šæœŸæ¸…ç†</li></ul><h4 id="æ’æŸ¥æ–¹æ³•"><a href="#æ’æŸ¥æ–¹æ³•" class="headerlink" title="æ’æŸ¥æ–¹æ³•"></a>æ’æŸ¥æ–¹æ³•</h4><p>ä½¿ç”¨Chromeæµè§ˆå™¨ F12â†’Memoryé¢æ¿</p><p>é€‰ Allocations on timeline</p><p>å¤šæ¬¡å¯¹æ¯”å †å¿«ç…§</p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250419024200478.png" alt="image-20250419024200478" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åƒåœ¾å›æ”¶æœºåˆ¶</title>
      <link href="/2025/05/11/JS/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/"/>
      <url>/2025/05/11/JS/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰"><a href="#åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰" class="headerlink" title="åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰"></a>åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰</h3><h4 id="æ ¸å¿ƒæ€æƒ³"><a href="#æ ¸å¿ƒæ€æƒ³" class="headerlink" title="æ ¸å¿ƒæ€æƒ³"></a>æ ¸å¿ƒæ€æƒ³</h4><p>åƒåœ¾å›æ”¶å™¨ä¼šå®šæœŸæ£€æŸ¥å †å†…å­˜çš„å¯¹è±¡ï¼Œåˆ¤æ–­å“ªäº›å¯¹è±¡ä»ç„¶è¢«å¼•ç”¨ï¼ˆâ€œå¯è¾¾â€ï¼‰æˆ–ä¸å†è¢«å¼•ç”¨ï¼ˆâ€œä¸å¯è¾¾â€ï¼‰</p><p>å¯¹äºä¸å¯è¾¾çš„å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šå°†å…¶å ç”¨çš„å†…å­˜è¿›è¡Œå›æ”¶</p><blockquote><p>å¯è¾¾ï¼šè¯¥å¯¹è±¡å¯ä»¥é€šè¿‡<strong>ä½œç”¨åŸŸé“¾</strong>ã€<strong>å…¨å±€å¯¹è±¡</strong>æˆ–<strong>å…¶ä»–å¯¹è±¡çš„å¼•ç”¨</strong>æ¥è®¿é—®</p></blockquote><h4 id="å›æ”¶ç®—æ³•"><a href="#å›æ”¶ç®—æ³•" class="headerlink" title="å›æ”¶ç®—æ³•"></a>å›æ”¶ç®—æ³•</h4><h5 id="å¼•ç”¨è®¡æ•°ï¼ˆå·²å¾ˆå°‘ä½¿ç”¨ï¼‰"><a href="#å¼•ç”¨è®¡æ•°ï¼ˆå·²å¾ˆå°‘ä½¿ç”¨ï¼‰" class="headerlink" title="å¼•ç”¨è®¡æ•°ï¼ˆå·²å¾ˆå°‘ä½¿ç”¨ï¼‰"></a><strong>å¼•ç”¨è®¡æ•°</strong>ï¼ˆå·²å¾ˆå°‘ä½¿ç”¨ï¼‰</h5><p>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œè®°å½•æœ‰å¤šå°‘å¼•ç”¨æŒ‡å‘å®ƒ</p><p>å½“å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡ä¸å¯è¾¾ï¼Œå¯ä»¥è¢«å›æ”¶</p><p><strong>ä½†æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨é—®é¢˜</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createCycle</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> obj1 = &#123;&#125;;</span><br><span class="line">    <span class="keyword">let</span> obj2 = &#123;&#125;;</span><br><span class="line">    obj1.<span class="property">ref</span> = obj2; <span class="comment">// obj1 å¼•ç”¨ obj2</span></span><br><span class="line">    obj2.<span class="property">ref</span> = obj1; <span class="comment">// obj2 å¼•ç”¨ obj1</span></span><br><span class="line">    <span class="keyword">return</span> [obj1, obj2];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> cycle = <span class="title function_">createCycle</span>();</span><br><span class="line">cycle = <span class="literal">null</span>; <span class="comment">// å³ä½¿å¤–éƒ¨æ²¡æœ‰å¼•ç”¨ï¼Œobj1 å’Œ obj2 ä»ç„¶äº’ç›¸å¼•ç”¨</span></span><br></pre></td></tr></table></figure><h5 id="æ ‡è®°æ¸…é™¤ï¼ˆæœ€å¸¸ç”¨ï¼‰"><a href="#æ ‡è®°æ¸…é™¤ï¼ˆæœ€å¸¸ç”¨ï¼‰" class="headerlink" title="æ ‡è®°æ¸…é™¤ï¼ˆæœ€å¸¸ç”¨ï¼‰"></a>æ ‡è®°æ¸…é™¤ï¼ˆæœ€å¸¸ç”¨ï¼‰</h5><p>åƒåœ¾å›æ”¶å™¨ä»æ ¹å¯¹è±¡ï¼ˆå¦‚å…¨å±€å¯¹è±¡ï¼‰å¼€å§‹ï¼Œé€’å½’åœ°æ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡</p><p>æ ‡è®°å®Œæˆåï¼Œæœªè¢«æ ‡è®°çš„å¯¹è±¡è¢«è§†ä¸ºä¸å¯è¾¾ï¼Œå…¶å†…å­˜ä¼šè¢«å›æ”¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">name</span>: <span class="string">&quot;Alice&quot;</span> &#125;;</span><br><span class="line">obj = <span class="literal">null</span>; <span class="comment">// obj ä¸å†å¼•ç”¨å¯¹è±¡ï¼Œå¯¹è±¡å˜ä¸ºä¸å¯è¾¾</span></span><br><span class="line"><span class="comment">// åƒåœ¾å›æ”¶å™¨ä¼šåœ¨ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶å›æ”¶è¯¥å¯¹è±¡çš„å†…å­˜</span></span><br></pre></td></tr></table></figure><h5 id="åˆ†ä»£å›æ”¶ï¼ˆç°ä»£-V8-å¼•æ“å¸¸ç”¨ä¼˜åŒ–ç­–ç•¥ï¼‰"><a href="#åˆ†ä»£å›æ”¶ï¼ˆç°ä»£-V8-å¼•æ“å¸¸ç”¨ä¼˜åŒ–ç­–ç•¥ï¼‰" class="headerlink" title="åˆ†ä»£å›æ”¶ï¼ˆç°ä»£ V8 å¼•æ“å¸¸ç”¨ä¼˜åŒ–ç­–ç•¥ï¼‰"></a>åˆ†ä»£å›æ”¶ï¼ˆç°ä»£ V8 å¼•æ“å¸¸ç”¨ä¼˜åŒ–ç­–ç•¥ï¼‰</h5><p>å°†å †å†…å­˜åˆ†ä¸ºä¸åŒçš„åŒºåŸŸï¼ˆç§°ä¸ºâ€œä»£â€ï¼‰ï¼Œæ ¹æ®å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œç®¡ç†ï¼š</p><ul><li><strong>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰</strong>ï¼šå­˜å‚¨çŸ­æœŸå¯¹è±¡ï¼Œåƒåœ¾å›æ”¶é¢‘ç‡è¾ƒé«˜ã€‚</li><li><strong>è€ç”Ÿä»£ï¼ˆOld Generationï¼‰</strong>ï¼šå­˜å‚¨é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶é¢‘ç‡è¾ƒä½ã€‚</li></ul><p>æ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡å¦‚æœç»è¿‡å¤šæ¬¡åƒåœ¾å›æ”¶åä»ç„¶å­˜æ´»ï¼Œåˆ™ä¼šè¢«æ™‹å‡åˆ°è€ç”Ÿä»£ã€‚</p><h4 id="è§¦å‘æ—¶æœº"><a href="#è§¦å‘æ—¶æœº" class="headerlink" title="è§¦å‘æ—¶æœº"></a>è§¦å‘æ—¶æœº</h4><p><strong>å†…å­˜ä¸è¶³æ—¶</strong> || <strong>å‘¨æœŸæ€§å®šæ—¶</strong></p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>V8å¼•æ“</title>
      <link href="/2025/05/11/JS/V8%E5%BC%95%E6%93%8E/"/>
      <url>/2025/05/11/JS/V8%E5%BC%95%E6%93%8E/</url>
      
        <content type="html"><![CDATA[<h3 id="V8å¼•æ“"><a href="#V8å¼•æ“" class="headerlink" title="V8å¼•æ“"></a>V8å¼•æ“</h3><blockquote><p>æ˜¯ä¸€ä¸ªç”± Google å¼€å‘çš„é«˜æ€§èƒ½ JavaScript å¼•æ“</p><p>ä¸ºäº†æé«˜ Chrome æµè§ˆå™¨ä¸­çš„ JavaScript æ‰§è¡Œé€Ÿåº¦è€Œè®¾è®¡çš„</p><p>èƒ½å¤Ÿå°† JavaScript ä»£ç ç›´æ¥ç¼–è¯‘æˆåŸç”Ÿæœºå™¨ç å¹¶æ‰§è¡Œï¼Œè€Œä¸æ˜¯è§£é‡Šæ‰§è¡Œ</p></blockquote><p><em><strong>å·¥ä½œåŸç†</strong></em></p><p><strong>è§£æï¼ˆParsingï¼‰</strong>ï¼šå½“ JavaScript ä»£ç è¢«åŠ è½½æ—¶ï¼ŒV8 é¦–å…ˆå°†å…¶è§£æä¸º<strong>æŠ½è±¡è¯­æ³•æ ‘</strong>ï¼ˆASTï¼‰</p><p><strong>Ignitionï¼ˆè§£é‡Šå™¨ï¼‰</strong>ï¼šV8 ä½¿ç”¨åä¸º Ignition çš„è§£é‡Šå™¨æ¥è§£é‡Šæ‰§è¡Œ AST</p><p><strong>TurboFanï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰</strong>ï¼šé’ˆå¯¹é¢‘ç¹æ‰§è¡Œçš„ä»£ç æ®µï¼ŒIgnition ä¼šæ”¶é›†è¿è¡Œæ—¶ä¿¡æ¯ï¼Œå¹¶å°†è¿™äº›ä»£ç ä¼ é€’ç»™ TurboFan è¿›è¡Œä¼˜åŒ–ç¼–è¯‘ã€‚TurboFan èƒ½å¤Ÿç”Ÿæˆé«˜åº¦ä¼˜åŒ–çš„æœºå™¨ç ï¼Œæ˜¾è‘—æé«˜æ€§èƒ½ã€‚</p><p><strong>åƒåœ¾å›æ”¶ï¼ˆGarbage Collection, GCï¼‰</strong>ï¼šV8 å®ç°äº†é«˜æ•ˆçš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œé€šè¿‡æ ‡è®°æ¸…é™¤ã€åˆ†ä»£æ”¶é›†ç­‰ç­–ç•¥è‡ªåŠ¨å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œå‡å°‘å†…å­˜æ³„æ¼çš„é£é™©ã€‚</p><p><em><strong>ç‰¹æ€§</strong></em></p><p><strong>å³æ—¶ç¼–è¯‘ï¼ˆJIT Compilationï¼‰</strong>ï¼šä¸åŒäºä¼ ç»Ÿçš„è§£é‡Šå‹è¯­è¨€ï¼ŒV8 é‡‡ç”¨å³æ—¶ç¼–è¯‘æŠ€æœ¯ï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç ï¼Œä»¥æå‡æ‰§è¡Œæ•ˆç‡ã€‚</p><p><strong>éšè—ç±»ï¼ˆHidden Classesï¼‰</strong>ï¼šä¸ºäº†åŠ é€Ÿå¯¹è±¡å±æ€§çš„è®¿é—®é€Ÿåº¦ï¼ŒV8 åœ¨å†…éƒ¨ä½¿ç”¨<strong>éšè—ç±»æ›¿ä»£ä¼ ç»ŸåŸå‹é“¾æŸ¥æ‰¾</strong>çš„æ–¹å¼ï¼Œä½¿å¾—å±æ€§è®¿é—®æ›´åŠ é«˜æ•ˆã€‚</p><p><strong>å†…è”ç¼“å­˜ï¼ˆInline Cachingï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ç§åŸºäºç±»å‹é¢„æµ‹çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œé€šè¿‡è®°å½•æ–¹æ³•è°ƒç”¨æ—¶çš„å¯¹è±¡ç±»å‹æ¥åŠ å¿«åç»­ç›¸åŒç±»å‹çš„è°ƒç”¨é€Ÿåº¦ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ ˆ/å †å†…å­˜</title>
      <link href="/2025/05/11/JS/%E6%A0%88%E5%86%85%E5%AD%98-%E5%A0%86%E5%86%85%E5%AD%98/"/>
      <url>/2025/05/11/JS/%E6%A0%88%E5%86%85%E5%AD%98-%E5%A0%86%E5%86%85%E5%AD%98/</url>
      
        <content type="html"><![CDATA[<h3 id="æ ˆ-å †å†…å­˜"><a href="#æ ˆ-å †å†…å­˜" class="headerlink" title="æ ˆ&#x2F;å †å†…å­˜"></a>æ ˆ&#x2F;å †å†…å­˜</h3><h4 id="æ ˆå†…å­˜"><a href="#æ ˆå†…å­˜" class="headerlink" title="æ ˆå†…å­˜"></a>æ ˆå†…å­˜</h4><p>ä¸»è¦å­˜å‚¨åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ï¼ˆ <code>Number</code>ã€<code>String</code>ã€<code>Boolean</code>ã€<code>Undefined</code>ã€<code>Null</code>ã€<code>Symbol</code> å’Œ <code>BigInt</code>ï¼‰</p><p>è¿˜å­˜å‚¨å˜é‡çš„<strong>å¼•ç”¨åœ°å€</strong>ï¼ˆæŒ‡å‘å †å†…å­˜çš„å¯¹è±¡ï¼‰</p><p>å‡½æ•°è°ƒç”¨æ—¶çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¹Ÿä¼šå‹å…¥æ ˆä¸­</p><p>å†…å­˜æ˜¯è¿ç»­åˆ†é…çš„ï¼Œå¤§å°å›ºå®šï¼Œå†…å­˜çš„è®¿é—®ã€åˆ†é…ã€é‡Šæ”¾éƒ½éå¸¸å¿«</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">10</span>; <span class="comment">// åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå­˜å‚¨åœ¨æ ˆå†…å­˜ä¸­</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="string">&quot;Hello&quot;</span>; <span class="comment">// åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå­˜å‚¨åœ¨æ ˆå†…å­˜ä¸­</span></span><br><span class="line"><span class="keyword">let</span> c = <span class="literal">null</span>; <span class="comment">// åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå­˜å‚¨åœ¨æ ˆå†…å­˜ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> y = <span class="number">20</span>; <span class="comment">// å±€éƒ¨å˜é‡ï¼Œå­˜å‚¨åœ¨æ ˆå†…å­˜ä¸­</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x + y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(<span class="number">5</span>); <span class="comment">// å‡½æ•°è°ƒç”¨æ—¶ï¼Œå‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šè¢«å‹å…¥æ ˆä¸­</span></span><br></pre></td></tr></table></figure><h4 id="å †å†…å­˜"><a href="#å †å†…å­˜" class="headerlink" title="å †å†…å­˜"></a>å †å†…å­˜</h4><p>å­˜å‚¨å¤æ‚æ•°æ®ç±»å‹çš„å€¼ï¼ˆå¯¹è±¡ã€æ•°ç»„ã€å‡½æ•°ç­‰ï¼‰</p><p>è¿˜å­˜å‚¨å¯¹è±¡çš„å±æ€§ã€æ–¹æ³• &amp; æ•°ç»„çš„å…ƒç´ </p><p>å†…å­˜éè¿ç»­åˆ†é…ï¼Œå¤§å°ä¸å›ºå®šï¼Œåˆ†é…å’Œé‡Šæ”¾éƒ½æ…¢ï¼Œå› ä¸ºéœ€è¦åŠ¨æ€ç®¡ç†å†…å­˜ï¼Œè€Œä¸”éœ€è¦é€šè¿‡å¼•ç”¨åœ°å€é—´æ¥è®¿é—®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">name</span>: <span class="string">&quot;Alice&quot;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;; <span class="comment">// å¯¹è±¡å­˜å‚¨åœ¨å †å†…å­˜ä¸­</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; <span class="comment">// æ•°ç»„å­˜å‚¨åœ¨å †å†…å­˜ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ˆå†…å­˜ä¸­å­˜å‚¨çš„æ˜¯å¼•ç”¨åœ°å€</span></span><br><span class="line"><span class="keyword">let</span> refObj = obj; <span class="comment">// refObj å’Œ obj æŒ‡å‘åŒä¸€ä¸ªå †å†…å­˜åœ°å€</span></span><br><span class="line">refObj.<span class="property">age</span> = <span class="number">35</span>; <span class="comment">// ä¿®æ”¹ refObj çš„å±æ€§ä¼šå½±å“ obj</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">age</span>); <span class="comment">// è¾“å‡º: 35</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123; <span class="attr">name</span>: <span class="string">&quot;Alice&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> obj2 = obj1; <span class="comment">// å¤åˆ¶å¼•ç”¨åœ°å€</span></span><br><span class="line">obj2.<span class="property">name</span> = <span class="string">&quot;Bob&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1.<span class="property">name</span>); <span class="comment">// è¾“å‡º: Bob</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj2.<span class="property">name</span>); <span class="comment">// è¾“å‡º: Bob</span></span><br></pre></td></tr></table></figure><h4 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h4><ul><li><strong>åŸºæœ¬æ•°æ®ç±»å‹ vs å¼•ç”¨æ•°æ®ç±»å‹</strong>ï¼š<ul><li>åŸºæœ¬æ•°æ®ç±»å‹ç›´æ¥å­˜å‚¨åœ¨æ ˆå†…å­˜ä¸­ï¼Œæ“ä½œçš„æ˜¯å®é™…å€¼ã€‚</li><li><strong>å †</strong>å†…å­˜å­˜å‚¨<strong>å¼•ç”¨æ•°æ®ç±»å‹</strong>ï¼Œ<strong>æ ˆ</strong>å†…å­˜ä¸­åªå­˜å‚¨<strong>å¼•ç”¨åœ°å€</strong>ã€‚</li></ul></li><li><strong>å¼•ç”¨ä¼ é€’ vs å€¼ä¼ é€’</strong>ï¼š<ul><li><em><strong>åŸºæœ¬æ•°æ®ç±»å‹</strong></em>æ˜¯å€¼ä¼ é€’ï¼šèµ‹å€¼æˆ–ä½œä¸ºå‚æ•°ä¼ é€’æ—¶ï¼Œä¼šå¤åˆ¶ä¸€ä»½<strong>æ–°çš„å€¼</strong>ã€‚</li><li><em><strong>å¼•ç”¨æ•°æ®ç±»å‹</strong></em>æ˜¯å¼•ç”¨ä¼ é€’ï¼šèµ‹å€¼æˆ–ä½œä¸ºå‚æ•°ä¼ é€’æ—¶ï¼Œå¤åˆ¶çš„æ˜¯<strong>å¼•ç”¨åœ°å€</strong>ï¼Œ<strong>å¤šä¸ªå˜é‡å¯èƒ½æŒ‡å‘åŒä¸€ä¸ªå †å†…å­˜åœ°å€</strong>ã€‚</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é—­åŒ…</title>
      <link href="/2025/05/11/JS/%E9%97%AD%E5%8C%85/"/>
      <url>/2025/05/11/JS/%E9%97%AD%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<h3 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h3><blockquote><p><em><strong>å‡½æ•°</strong></em> ä¸å…¶ <em><strong>è¯æ³•ä½œç”¨åŸŸ</strong></em> çš„ç»“åˆ</p></blockquote><ul><li>å½“ä¸€ä¸ª <strong>å†…éƒ¨å‡½æ•°</strong> è®¿é—®å…¶å¤–éƒ¨å‡½æ•°ä½œç”¨åŸŸä¸­çš„å˜é‡æ—¶ï¼Œå³ä½¿å¤–éƒ¨å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œå†…éƒ¨å‡½æ•°ä»ç„¶ä¿ç•™å¯¹å¤–éƒ¨å˜é‡çš„å¼•ç”¨ã€‚</li><li>é—­åŒ…çš„å½¢æˆæ˜¯å› ä¸ºå‡½æ•°çš„ä½œç”¨åŸŸé“¾ï¼ˆScope Chainï¼‰åœ¨å®šä¹‰æ—¶å°±å·²ç»ç¡®å®šï¼Œè€Œéæ‰§è¡Œæ—¶ã€‚</li></ul><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><h5 id="è®¡æ•°å™¨"><a href="#è®¡æ•°å™¨" class="headerlink" title="è®¡æ•°å™¨"></a>è®¡æ•°å™¨</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createCounter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> count = <span class="number">0</span>; <span class="comment">// å½“createCounterå‡½æ•°æ‰§è¡Œåæœ¬è¯¥è¢«é”€æ¯</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">increment</span>: <span class="function">() =&gt;</span> count++, <span class="comment">// ä½†å‡½æ•°ä¿ç•™äº†å¯¹countçš„å¼•ç”¨</span></span><br><span class="line">        <span class="attr">getCount</span>: <span class="function">() =&gt;</span> count,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counter = <span class="title function_">createCounter</span>();</span><br><span class="line">counter.<span class="title function_">increment</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="title function_">getCount</span>()); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h5 id="å‡½æ•°æŸ¯é‡ŒåŒ–"><a href="#å‡½æ•°æŸ¯é‡ŒåŒ–" class="headerlink" title="å‡½æ•°æŸ¯é‡ŒåŒ–"></a>å‡½æ•°æŸ¯é‡ŒåŒ–</h5><blockquote><p>ä¸€ç§å‡½æ•°å¼ç¼–ç¨‹æŠ€æœ¯ï¼Œå®ƒå°†ä¸€ä¸ªå¤šå‚æ•°å‡½æ•°è½¬æ¢ä¸ºä¸€ç³»åˆ—å•å‚æ•°å‡½æ•°</p><p>æŸ¯é‡ŒåŒ–å¯ä»¥é€æ­¥ä¼ é€’å‚æ•°ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§ä¼ é€’æ‰€æœ‰å‚æ•°</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">add</span> = a =&gt; <span class="function"><span class="params">b</span> =&gt;</span> <span class="function"><span class="params">c</span> =&gt;</span> a + b + c;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> add5 = <span class="title function_">add</span>(<span class="number">5</span>); <span class="comment">// å›ºå®š a = 5</span></span><br><span class="line"><span class="keyword">const</span> add5and3 = <span class="title function_">add5</span>(<span class="number">3</span>); <span class="comment">// å›ºå®š b = 3</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add5and3</span>(<span class="number">2</span>)); <span class="comment">// è¾“å‡º: 10 (5 + 3 + 2)</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>add5</code> æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œå®ƒè®°ä½äº† <code>a = 5</code>ï¼Œå¹¶ä¸”å¯ä»¥åœ¨åç»­è°ƒç”¨ä¸­ä½¿ç”¨è¿™ä¸ªå€¼</p></blockquote><h4 id="æ ¸å¿ƒä½œç”¨"><a href="#æ ¸å¿ƒä½œç”¨" class="headerlink" title="æ ¸å¿ƒä½œç”¨"></a>æ ¸å¿ƒä½œç”¨</h4><ul><li><p>å°è£…ç§æœ‰å˜é‡</p></li><li><p>å»¶é•¿å˜é‡ç”Ÿå‘½å‘¨æœŸ</p></li></ul><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>é—­åŒ…æ˜¯æŒ‡ä¸€ä¸ªå‡½æ•°èƒ½å¤Ÿè®¿é—®å¹¶è®°ä½å…¶è¯æ³•ä½œç”¨åŸŸä¸­çš„å˜é‡ï¼Œå³ä½¿è¯¥å‡½æ•°åœ¨å…¶ä½œç”¨åŸŸå¤–æ‰§è¡Œã€‚</p><p>å®ƒçš„æ ¸å¿ƒåŸç†æ˜¯å‡½æ•°åœ¨å®šä¹‰æ—¶ä¼šç»‘å®šä½œç”¨åŸŸé“¾ï¼Œä½¿å¾—å†…éƒ¨å‡½æ•°å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„å˜é‡ã€‚é—­åŒ…çš„å…¸å‹åº”ç”¨åŒ…æ‹¬å°è£…ç§æœ‰å˜é‡ï¼ˆå¦‚è®¡æ•°å™¨ï¼‰ã€æ¨¡å—åŒ–å¼€å‘ã€å‡½æ•°æŸ¯é‡ŒåŒ–ç­‰ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé—­åŒ…å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå°¤å…¶æ˜¯å½“å®ƒé•¿æœŸå¼•ç”¨ä¸å†éœ€è¦çš„å¤§å¯¹è±¡æ—¶ã€‚å› æ­¤ï¼Œåœ¨ä¸éœ€è¦æ—¶åº”åŠæ—¶è§£é™¤å¼•ç”¨ï¼ˆå¦‚å°†é—­åŒ…èµ‹å€¼ä¸º <code>null</code>ï¼‰ã€‚æ­¤å¤–ï¼Œå½“é—­åŒ…ä¸å†è¢«ä»»ä½•åœ°æ–¹å¼•ç”¨æ—¶ï¼Œå…¶ä½œç”¨åŸŸé“¾æ‰ä¼šè¢«åƒåœ¾å›æ”¶ã€‚é¿å…åœ¨é¢‘ç¹è°ƒç”¨çš„å‡½æ•°ï¼ˆå¦‚å¾ªç¯ä½“ï¼‰ä¸­åˆ›å»ºé—­åŒ…ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜ç´¯ç§¯ã€‚</p><p>ä¼˜å…ˆä½¿ç”¨<code>let</code>å®šä¹‰å—çº§å˜é‡ï¼Œæˆ–åœ¨é—­åŒ…ä¸­æ˜¾å¼ä¼ é€’å˜é‡ï¼Œé¿å…æ„å¤–å…±äº«ã€‚åˆç†è®¾è®¡é—­åŒ…ç”Ÿå‘½å‘¨æœŸï¼ŒåŠæ—¶è§£é™¤æ— ç”¨å¼•ç”¨ä»¥ä¼˜åŒ–å†…å­˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>äº‹ä»¶å¾ªç¯</title>
      <link href="/2025/05/11/JS/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/"/>
      <url>/2025/05/11/JS/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/</url>
      
        <content type="html"><![CDATA[<h3 id="äº‹ä»¶å¾ªç¯"><a href="#äº‹ä»¶å¾ªç¯" class="headerlink" title="äº‹ä»¶å¾ªç¯"></a>äº‹ä»¶å¾ªç¯</h3><blockquote><p>JSæ˜¯å•çº¿ç¨‹è¯­è¨€ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡</p></blockquote><p>å¦‚æœä¸€ä¸ªä»»åŠ¡è€—æ—¶è¿‡é•¿ï¼ˆç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å–ï¼‰ï¼Œä¼šé˜»å¡åç»­ä»£ç çš„è¿›è¡Œ</p><p><strong>åŒæ­¥ä»»åŠ¡</strong>ï¼šç«‹åˆ»æ”¾å…¥JSå¼•æ“ï¼ˆJSä¸»çº¿ç¨‹ï¼‰æ‰§è¡Œï¼ŒåŸåœ°ç­‰å¾…ç»“æœ</p><p><strong>å¼‚æ­¥ä»»åŠ¡</strong>ï¼šå…ˆæ”¾å…¥å®¿ä¸»ç¯å¢ƒï¼ˆæµè§ˆå™¨&#x2F;Nodeï¼‰ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œåœ¨å°†æ¥æ‰§è¡Œ</p><h4 id="æ‰§è¡Œè¿‡ç¨‹"><a href="#æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h4><blockquote><p>è¿‡ç¨‹ä¸­ä¸€å…±æœ‰ä¸‰å—ç¯å¢ƒï¼š<strong>æ‰§è¡Œæ ˆ</strong>ã€<strong>å®¿ä¸»ç¯å¢ƒ</strong>ã€<strong>ä»»åŠ¡é˜Ÿåˆ—</strong></p></blockquote><p>æŒ‰ä»£ç ä¸Šä¸‹æ–‡é¡ºåº</p><p>å°†åŒæ­¥ä»»åŠ¡å‹å…¥æ‰§è¡Œæ ˆ</p><p>å°†å¼‚æ­¥ä»»åŠ¡å‹å…¥å®¿ä¸»ç¯å¢ƒ</p><p>åœ¨å®¿ä¸»ç¯å¢ƒä¸­æ‰§è¡Œæ—¶æœºåˆ°æ¥æ—¶ï¼ˆæ¯”å¦‚å®šæ—¶å™¨åˆ°æœŸï¼‰ï¼Œå°†å®¿ä¸»ç¯å¢ƒä¸­å¼‚æ­¥ä»»åŠ¡ï¼ˆæ¯”å¦‚å®šæ—¶å™¨ï¼‰çš„<strong>å›è°ƒå‡½æ•°</strong>æ¨é€ç»™ä»»åŠ¡é˜Ÿåˆ—</p><p>æ­¤æ—¶æ‰§è¡Œæ ˆä¼šå»çœ‹ä»»åŠ¡é˜Ÿåˆ—æœ‰æ²¡æœ‰å¼‚æ­¥ä»»åŠ¡éœ€è¦æ‰§è¡Œï¼Œå¦‚æœæœ‰åˆ™å°†å¼‚æ­¥ä»»åŠ¡æ¨é€åˆ°æ‰§è¡Œæ ˆä¸­æ‰§è¡Œ</p><blockquote><p>æ‰§è¡Œæ ˆåœ¨åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œåä¼šåå¤åœ°å»ä»»åŠ¡é˜Ÿåˆ—çœ‹æœ‰æ²¡æœ‰éœ€è¦æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡</p><p>è¿™ä¸ªåå¤æŸ¥æ‰¾çš„è¿‡ç¨‹å°±å«äº‹ä»¶å¾ªç¯</p></blockquote><h4 id="å®ä»»åŠ¡-å¾®ä»»åŠ¡"><a href="#å®ä»»åŠ¡-å¾®ä»»åŠ¡" class="headerlink" title="å®ä»»åŠ¡&#x2F;å¾®ä»»åŠ¡"></a>å®ä»»åŠ¡&#x2F;å¾®ä»»åŠ¡</h4><blockquote><p>JSå°† <strong>å¼‚æ­¥ä»»åŠ¡</strong> åˆ†ä¸ºå®ä»»åŠ¡å’Œå¾®ä»»åŠ¡</p></blockquote><p><strong>å®ä»»åŠ¡</strong> ç”± <strong>å®¿ä¸»</strong> å‘èµ·</p><blockquote><p>script (ä»£ç å—)</p><p>setTimeout &#x2F; setInterval å®šæ—¶å™¨</p></blockquote><p><strong>å¾®ä»»åŠ¡</strong> ç”± <strong>JSå¼•æ“</strong> å‘èµ·</p><blockquote><p>promise (<strong>promiseå†…éƒ¨æ˜¯åŒæ­¥</strong>ï¼Œthen&#x2F;catchæ˜¯å›è°ƒå¼‚æ­¥)</p><p>Async&#x2F;Await</p><p>procsee.nextTick (node)</p><p>Object.observe</p></blockquote><p><strong>æ‰§è¡Œé¡ºåº</strong></p><blockquote><p>å…ˆçœ‹æ‰§è¡Œæ ˆï¼ˆåŒæ­¥ä»»åŠ¡ï¼‰â†’ å†çœ‹å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆJSç›¸å…³ï¼‰â†’ æœ€åçœ‹å®ä»»åŠ¡é˜Ÿåˆ—</p></blockquote><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250419103641540.png" alt="image-20250419103641540"></p><blockquote><p>æ‰§è¡Œå®Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œä¼šå†æ¬¡æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡</p></blockquote><h4 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">4</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">6</span>)</span><br></pre></td></tr></table></figure><blockquote><p>ğŸ‘†æ‰“å°ï¼š135642</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="number">3</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><blockquote><p>ğŸ‘†æ‰“å°ï¼š24531  ï¼ˆpromiseå¾®ä»»åŠ¡çœ‹.thençš„ä½ç½®è€Œä¸æ˜¯çœ‹resolve()ï¼‰</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Proxy</title>
      <link href="/2025/05/11/JS/Proxy/"/>
      <url>/2025/05/11/JS/Proxy/</url>
      
        <content type="html"><![CDATA[<h3 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h3><blockquote><p>å…è®¸ä½ åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡æ¥æ‹¦æˆªå¹¶è‡ªå®šä¹‰åŸºæœ¬æ“ä½œï¼ˆå±æ€§æŸ¥æ‰¾ã€èµ‹å€¼ã€æšä¸¾ã€å‡½æ•°è°ƒç”¨ç­‰ï¼‰</p></blockquote><h4 id="æ€ä¹ˆç”¨"><a href="#æ€ä¹ˆç”¨" class="headerlink" title="æ€ä¹ˆç”¨"></a>æ€ä¹ˆç”¨</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, handler);</span><br></pre></td></tr></table></figure><ul><li><code>target</code>: è¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡ã€‚</li><li><code>handler</code>: ä¸€ä¸ªåŒ…å« get&#x2F;set ç­‰æ‹¦æˆªæ–¹æ³•çš„å¯¹è±¡ã€‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> target = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> handler = &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">obj, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop <span class="keyword">in</span> obj) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Getting <span class="subst">$&#123;prop&#125;</span>: <span class="subst">$&#123;obj[prop]&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> obj[prop];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;prop&#125;</span> å±æ€§ä¸å­˜åœ¨`</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">obj, prop, value</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Setting <span class="subst">$&#123;prop&#125;</span> to <span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">        obj[prop] = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong><code>get</code></strong>(target, property, receiver)ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„<code>è¯»å–</code>æ“ä½œã€‚</li><li><strong><code>set</code></strong>(target, property, value, receiver)ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„<code>è®¾ç½®</code>æ“ä½œã€‚</li><li><strong><code>has</code></strong>(target, propKey)ï¼šæ‹¦æˆª <code>propKey in proxy</code> çš„æ“ä½œã€‚</li><li><strong><code>deleteProperty</code></strong>(target, propKey)ï¼šæ‹¦æˆª <code>delete proxy[propKey]</code> çš„æ“ä½œã€‚</li><li><strong><code>apply</code></strong>(target, thisArg, argumentsList)ï¼šæ‹¦æˆª<code>å‡½æ•°è°ƒç”¨</code>ã€‚</li><li><strong><code>construct</code></strong>(target, argumentsList, newTarget)ï¼šæ‹¦æˆª <code>new</code> æ“ä½œç¬¦ã€‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy.<span class="property">name</span> = <span class="string">&quot;Alice&quot;</span>; <span class="comment">// è¾“å‡º: Setting name to Alice</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(proxy.<span class="property">name</span>); <span class="comment">// è¾“å‡º: Getting name: Alice</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(proxy.<span class="property">age</span>); <span class="comment">// è¾“å‡º: age å±æ€§ä¸å­˜åœ¨</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p><strong>æ•°æ®éªŒè¯</strong></p><blockquote><p>å¯ä»¥åœ¨ <code>set</code> æ‹¦æˆªå™¨ä¸­æ·»åŠ éªŒè¯é€»è¾‘ï¼Œç¡®ä¿åªæœ‰ç¬¦åˆç‰¹å®šæ¡ä»¶çš„æ•°æ®æ‰èƒ½è¢«è®¾ç½®åˆ°å¯¹è±¡ä¸­ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> validator = &#123;</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">obj, prop, value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop === <span class="string">&#x27;age&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Number</span>.<span class="title function_">isInteger</span>(value)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;The age is not an integer&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (value &gt; <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RangeError</span>(<span class="string">&#x27;The age seems invalid&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        obj[prop] = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> <span class="title class_">Proxy</span>(&#123;&#125;, validator);</span><br><span class="line">person.<span class="property">age</span> = <span class="number">100</span>; <span class="comment">// æ­£å¸¸</span></span><br><span class="line">person.<span class="property">age</span> = <span class="string">&#x27;young&#x27;</span>; <span class="comment">// æŠ›å‡º TypeError</span></span><br></pre></td></tr></table></figure><p><strong>æ—¥å¿—è®°å½•</strong></p><blockquote><p>å¯ä»¥ä½¿ç”¨ <code>get</code> å’Œ <code>set</code> æ‹¦æˆªå™¨è®°å½•å¯¹å¯¹è±¡çš„è®¿é—®å’Œä¿®æ”¹æƒ…å†µã€‚</p></blockquote><p><strong>æ€§èƒ½ç›‘æ§</strong></p><blockquote><p>é€šè¿‡ä»£ç†å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ï¼Œå¯ä»¥è®°å½•æ¯æ¬¡è°ƒç”¨çš„æ—¶é—´æ¶ˆè€—ï¼Œç”¨äºæ€§èƒ½åˆ†æã€‚</p></blockquote><p><strong>ç§æœ‰å±æ€§ç®¡ç†</strong></p><blockquote><p>é€šè¿‡ä»£ç†éšè—æˆ–ä¿æŠ¤å¯¹è±¡çš„æŸäº›å±æ€§ï¼Œä½¿å…¶ä¸èƒ½è¢«å¤–éƒ¨ç›´æ¥è®¿é—®æˆ–ä¿®æ”¹ã€‚</p></blockquote><p><strong>æ’¤é”€å¯¹è±¡å¼•ç”¨</strong></p><blockquote><p>ä½¿ç”¨ <code>Proxy.revocable()</code> æ–¹æ³•å¯ä»¥å®‰å…¨åœ°æ’¤é”€å¯¹æŸä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;proxy, revoke&#125; = <span class="title class_">Proxy</span>.<span class="title function_">revocable</span>(&#123;&#125;, &#123;&#125;);</span><br><span class="line">proxy.<span class="property">name</span> = <span class="string">&quot;Alice&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(proxy.<span class="property">name</span>); <span class="comment">// è¾“å‡º: Alice</span></span><br><span class="line"><span class="title function_">revoke</span>(); <span class="comment">// æ’¤é”€å¯¹ name çš„å¼•ç”¨</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(proxy.<span class="property">name</span>); <span class="comment">// æŠ›å‡º TypeError é”™è¯¯</span></span><br></pre></td></tr></table></figure><h4 id="æ‰‹å†™Proxyå®ç°æ•°ç»„å“åº”å¼"><a href="#æ‰‹å†™Proxyå®ç°æ•°ç»„å“åº”å¼" class="headerlink" title="æ‰‹å†™Proxyå®ç°æ•°ç»„å“åº”å¼"></a>æ‰‹å†™Proxyå®ç°æ•°ç»„å“åº”å¼</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">reactiveArray</span>(<span class="params">refArr, onChange</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> hander = &#123;</span><br><span class="line">        <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">            target[prop] = value</span><br><span class="line">            <span class="keyword">if</span> (prop != <span class="string">&#x27;length&#x27;</span>) &#123;</span><br><span class="line">                <span class="title function_">onChange</span>(target)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">deleteProperty</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">            <span class="keyword">delete</span> target[prop]</span><br><span class="line">            <span class="title function_">onChange</span>(target.<span class="title function_">slice</span>())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(refArr, hander)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myArray = <span class="title function_">reactiveArray</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="function">(<span class="params">newArr</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ•°ç»„å‘ç”Ÿå˜åŒ–äº†&#x27;</span>, newArr)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">myArray.<span class="title function_">push</span>(<span class="number">4</span>) <span class="comment">// æ•°ç»„å‘ç”Ÿå˜åŒ–äº† [1, 2, 3, 4]</span></span><br><span class="line">myArray[<span class="number">0</span>] = <span class="number">5</span> <span class="comment">// æ•°ç»„å‘ç”Ÿå˜åŒ–äº† [5, 2, 3, 4]</span></span><br><span class="line">myArray.<span class="title function_">pop</span>() <span class="comment">// æ•°ç»„å‘ç”Ÿå˜åŒ–äº† [5, 2, 3]</span></span><br><span class="line">myArray.<span class="title function_">pop</span>() <span class="comment">// æ•°ç»„å‘ç”Ÿå˜åŒ–äº† [5, 2]</span></span><br><span class="line">myArray.<span class="title function_">pop</span>() <span class="comment">// æ•°ç»„å‘ç”Ÿå˜åŒ–äº† [5]</span></span><br><span class="line">myArray.<span class="title function_">pop</span>() <span class="comment">// æ•°ç»„å‘ç”Ÿå˜åŒ–äº† [ç©º]</span></span><br><span class="line">myArray.<span class="title function_">pop</span>()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Promise å»¶å±•</title>
      <link href="/2025/05/11/JS/Promise%20%E5%BB%B6%E5%B1%95/"/>
      <url>/2025/05/11/JS/Promise%20%E5%BB%B6%E5%B1%95/</url>
      
        <content type="html"><![CDATA[<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><h4 id="ä»€ä¹ˆæ˜¯promise"><a href="#ä»€ä¹ˆæ˜¯promise" class="headerlink" title="ä»€ä¹ˆæ˜¯promise"></a>ä»€ä¹ˆæ˜¯promise</h4><p>ä½œä¸º<strong>å¼‚æ­¥å‡½æ•°</strong>ï¼Œæœ‰å››ç§çŠ¶æ€</p><p>Pending è¿›è¡Œä¸­ï¼ˆ<em><strong>Pending</strong></em>ï¼‰ç”¨ <code>new Promise()</code> åˆ›å»ºå¯¹è±¡</p><p>Fulfilled æˆåŠŸï¼ˆ<em><strong>Resolved</strong></em>ï¼‰ç”¨ <code>.then()</code> å¤„ç†æˆåŠŸçš„ç»“æœ</p><p>Rejected å¤±è´¥ ï¼ˆ<em><strong>Rejected</strong></em>ï¼‰ç”¨ <code>.catch()</code> å¤„ç†å¤±è´¥</p><p>Finally ç»“æŸ ï¼ˆï¼‰ç”¨ <code>.finally()</code> ç»“æŸ</p><h5 id="æ€ä¹ˆç”¨"><a href="#æ€ä¹ˆç”¨" class="headerlink" title="æ€ä¹ˆç”¨"></a>æ€ä¹ˆç”¨</h5><p>å¼‚æ­¥å‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> step_1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//Promiseå¯¹è±¡</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;å¥¶èŒ¶&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">step_2</span> = (<span class="params">tea</span>) =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//å‡½æ•°</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(tea + <span class="string">&quot;+çç &quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">step_3</span> = (<span class="params">tea</span>) =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//å‡½æ•°</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(tea + <span class="string">&quot;+å¥¶ç›–&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>é“¾å¼è°ƒç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">step_1</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">tea</span> =&gt;</span> <span class="title function_">step_2</span>(tea))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">tea</span> =&gt;</span> <span class="title function_">step_3</span>(tea))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">tea</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æœ€ç»ˆå¥¶èŒ¶ï¼š&quot;</span>, tea);</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¤±è´¥ï¼š&quot;</span>, error);</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ç»“æŸå¹¶æ¸…ç†&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3såæ‰“å°</span></span><br><span class="line">æœ€ç»ˆå¥¶èŒ¶ï¼šå¥¶èŒ¶+çç +å¥¶ç›–</span><br><span class="line">ç»“æŸå¹¶æ¸…ç†</span><br></pre></td></tr></table></figure><p>æ™®é€šå‡½æ•°çš„<strong>å›è°ƒåœ°ç‹±</strong></p><blockquote><p>æ¯æ¬¡å›è°ƒéƒ½è¦åˆ¤æ–­error</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">step_1</span>(<span class="function">(<span class="params">error, tea</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¤±è´¥ï¼š&quot;</span>, error);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">step_1</span>(tea, <span class="function">(<span class="params">error, tea</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¤±è´¥ï¼š&quot;</span>, error);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">step_1</span>(tea, <span class="function">(<span class="params">error, tea</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¤±è´¥ï¼š&quot;</span>, error);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æœ€ç»ˆå¥¶èŒ¶ï¼š&quot;</span>, tea);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h5><p><strong>ç½‘ç»œè¯·æ±‚</strong></p><blockquote><p>fetchè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> headers = &#123;</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        ...options.<span class="property">headers</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fetch</span>(url)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> error; <span class="comment">// æˆ–ç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetchData</span>(<span class="string">&quot;https://api.example.com/data1&quot;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ•°æ®åŠ è½½æˆåŠŸ:&quot;</span>, data))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;æ•°æ®åŠ è½½å¤±è´¥:&quot;</span>, error));</span><br><span class="line"><span class="title function_">fetchData</span>(<span class="string">&quot;https://api.example.com/data2&quot;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ•°æ®åŠ è½½æˆåŠŸ:&quot;</span>, data))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;æ•°æ®åŠ è½½å¤±è´¥:&quot;</span>, error));</span><br></pre></td></tr></table></figure><p><strong>ç»Ÿä¸€é”™è¯¯å¤„ç†</strong></p><blockquote><p>å›è°ƒå‡½æ•°ä¸­éœ€è¦æ‰‹åŠ¨æ£€æŸ¥æ¯ä¸ªæ­¥éª¤çš„é”™è¯¯ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">random</span>() &gt; <span class="number">0.5</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="string">&quot;æˆåŠŸ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(<span class="string">&quot;å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;æ•è·é”™è¯¯:&quot;</span>, error));</span><br></pre></td></tr></table></figure><p><strong>çŠ¶æ€ç®¡ç†</strong></p><blockquote><p>å¼‚æ­¥æ“ä½œæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ã€<code>fulfilled</code>ï¼ˆå·²å®Œæˆï¼‰ã€<code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;å®Œæˆ&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(promise); <span class="comment">// è¾“å‡º: Promise &#123; &lt;pending&gt; &#125;</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(promise), <span class="number">1500</span>); <span class="comment">// è¾“å‡º: Promise &#123; &lt;fulfilled&gt;: &quot;å®Œæˆ&quot; &#125;</span></span><br></pre></td></tr></table></figure><p><strong>é“¾å¼è°ƒç”¨</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">step1</span>()</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">result1</span> =&gt;</span> <span class="title function_">step2</span>(result1))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">result2</span> =&gt;</span> <span class="title function_">step3</span>(result2))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">finalResult</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(finalResult))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(error));</span><br></pre></td></tr></table></figure><h4 id="æ‰‹å†™promise"><a href="#æ‰‹å†™promise" class="headerlink" title="æ‰‹å†™promise()"></a>æ‰‹å†™promise()</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyPromise</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">executor</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;pending&#x27;</span>; <span class="comment">// Promiseçš„çŠ¶æ€ï¼š&#x27;pending&#x27;, &#x27;fulfilled&#x27;, &#x27;rejected&#x27;</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">undefined</span>; <span class="comment">// æˆåŠŸæ—¶çš„å€¼</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">undefined</span>; <span class="comment">// å¤±è´¥æ—¶çš„åŸå› </span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span> = []; <span class="comment">// å­˜å‚¨æˆåŠŸå›è°ƒ</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span> = []; <span class="comment">// å­˜å‚¨å¤±è´¥å›è°ƒ</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">reason</span> = reason;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title function_">executor</span>(resolve, reject);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">        onFulfilled = <span class="keyword">typeof</span> onFulfilled === <span class="string">&#x27;function&#x27;</span> ? onFulfilled : <span class="function"><span class="params">value</span> =&gt;</span> value;</span><br><span class="line">        onRejected = <span class="keyword">typeof</span> onRejected === <span class="string">&#x27;function&#x27;</span> ? onRejected : <span class="function"><span class="params">reason</span> =&gt;</span> &#123; <span class="keyword">throw</span> reason &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> promise2 = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;fulfilled&#x27;</span>) &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">let</span> x = <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                        <span class="title function_">resolvePromise</span>(promise2, x, resolve, reject);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                        <span class="title function_">reject</span>(error);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;rejected&#x27;</span>) &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">let</span> x = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                        <span class="title function_">resolvePromise</span>(promise2, x, resolve, reject);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                        <span class="title function_">reject</span>(error);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">let</span> x = <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                            <span class="title function_">resolvePromise</span>(promise2, x, resolve, reject);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(error);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">let</span> x = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                            <span class="title function_">resolvePromise</span>(promise2, x, resolve, reject);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(error);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> promise2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">null</span>, onRejected);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾…åŠ©å‡½æ•°ï¼Œå¤„ç†promiseé“¾ä¸­çš„å€¼ä¼ é€’</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Chaining cycle detected for promise&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> called;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (x !== <span class="literal">null</span> &amp;&amp; (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> x === <span class="string">&#x27;function&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> then = x.<span class="property">then</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                then.<span class="title function_">call</span>(x, <span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (called) <span class="keyword">return</span>;</span><br><span class="line">                    called = <span class="literal">true</span>;</span><br><span class="line">                    <span class="title function_">resolvePromise</span>(promise2, y, resolve, reject);</span><br><span class="line">                &#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (called) <span class="keyword">return</span>;</span><br><span class="line">                    called = <span class="literal">true</span>;</span><br><span class="line">                    <span class="title function_">reject</span>(err);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="keyword">if</span> (called) <span class="keyword">return</span>;</span><br><span class="line">            called = <span class="literal">true</span>;</span><br><span class="line">            <span class="title function_">reject</span>(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä»€ä¹ˆæ˜¯promise-all"><a href="#ä»€ä¹ˆæ˜¯promise-all" class="headerlink" title="ä»€ä¹ˆæ˜¯promise.all()"></a>ä»€ä¹ˆæ˜¯promise.all()</h4><blockquote><p>ç­‰å¾…æ‰€æœ‰å…‘ç°ï¼ˆæˆ–ç¬¬ä¸€ä¸ªæ‹’ç»ï¼‰çš„ç»“æœ</p></blockquote><h5 id="æ€ä¹ˆç”¨-1"><a href="#æ€ä¹ˆç”¨-1" class="headerlink" title="æ€ä¹ˆç”¨"></a>æ€ä¹ˆç”¨</h5><p>ä¾‹å­1</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> step_1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//Promiseå¯¹è±¡</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;å¥¶èŒ¶&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">step_2</span> = (<span class="params">tea</span>) =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//å‡½æ•°</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(tea + <span class="string">&quot;+çç &quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">step_3</span> = (<span class="params">tea</span>) =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//å‡½æ•°</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(tea + <span class="string">&quot;+å¥¶ç›–&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> step_4 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//Promiseå¯¹è±¡</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;æœ€ç»ˆæ”¶æ‹¾&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([step_1, step_4]).<span class="title function_">then</span>(<span class="function">(<span class="params">allstep</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(allstep);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;å¥¶èŒ¶&quot;</span>, <span class="string">&quot;æœ€ç»ˆæ”¶æ‹¾&quot;</span>] <span class="comment">//1ç§’åæ‰“å°</span></span><br></pre></td></tr></table></figure><p>ä¾‹å­2</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">step_1</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">tea</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">        <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(tea),<span class="comment">// step_1 çš„ç»“æœ</span></span><br><span class="line">        <span class="title function_">step_2</span>(tea),         <span class="comment">// step_2 çš„ç»“æœ</span></span><br><span class="line">        <span class="title function_">step_3</span>(tea),         <span class="comment">// step_3 çš„ç»“æœ</span></span><br><span class="line">        step_4               <span class="comment">// step_4 çš„ç»“æœ</span></span><br><span class="line">    ]);</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">results</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(results); <span class="comment">// è¾“å‡ºæ‰€æœ‰ç»“æœ</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;å¥¶èŒ¶&quot;</span>, <span class="string">&quot;å¥¶èŒ¶+çç &quot;</span>, <span class="string">&quot;å¥¶èŒ¶+å¥¶ç›–&quot;</span>, <span class="string">&quot;æœ€ç»ˆæ”¶æ‹¾&quot;</span>] <span class="comment">//2ç§’åæ‰“å°</span></span><br></pre></td></tr></table></figure><p>ä¾‹å­3</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promises = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    promises.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">`Promise <span class="subst">$&#123;i&#125;</span> å®Œæˆ`</span>), <span class="number">1000</span>);</span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>(promises).<span class="title function_">then</span>(<span class="function"><span class="params">results</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(results);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="string">&quot;Promise 0 å®Œæˆ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 1 å®Œæˆ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 2 å®Œæˆ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 3 å®Œæˆ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 4 å®Œæˆ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 5 å®Œæˆ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 6 å®Œæˆ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 7 å®Œæˆ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 8 å®Œæˆ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 9 å®Œæˆ&quot;</span></span><br><span class="line">] <span class="comment">//1ç§’åæ‰“å°</span></span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨åœºæ™¯-1"><a href="#ä½¿ç”¨åœºæ™¯-1" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a><strong>ä½¿ç”¨åœºæ™¯</strong></h5><blockquote><p>å¸¸ç”¨äºæ•°æ®èšåˆã€èµ„æºåŠ è½½ã€å¹¶å‘ä»»åŠ¡ç­‰åœºæ™¯</p></blockquote><p><strong>å¹¶è¡Œç½‘ç»œè¯·æ±‚</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request1 = <span class="title function_">fetch</span>(<span class="string">&quot;https://api.example.com/data1&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>());</span><br><span class="line"><span class="keyword">const</span> request2 = <span class="title function_">fetch</span>(<span class="string">&quot;https://api.example.com/data2&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([request1, request2])</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">[data1, data2]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¯·æ±‚1ç»“æœ:&quot;</span>, data1);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¯·æ±‚2ç»“æœ:&quot;</span>, data2);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;è¯·æ±‚å¤±è´¥:&quot;</span>, error));</span><br></pre></td></tr></table></figure><p><strong>æ•°æ®èšåˆ</strong></p><blockquote><p><code>Promise.all</code> è‡ªåŠ¨æ”¶é›†æ‰€æœ‰ç»“æœä¸ºä¸€ä¸ªæ•°ç»„ï¼Œæ–¹ä¾¿åç»­å¤„ç†ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getUser</span> = (<span class="params"></span>) =&gt; <span class="title function_">fetch</span>(<span class="string">&quot;/user&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>());</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getOrders</span> = (<span class="params"></span>) =&gt; <span class="title function_">fetch</span>(<span class="string">&quot;/orders&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([<span class="title function_">getUser</span>(), <span class="title function_">getOrders</span>()])</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">[user, orders]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ç”¨æˆ·ä¿¡æ¯:&quot;</span>, user);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è®¢å•åˆ—è¡¨:&quot;</span>, orders);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;æ•°æ®åŠ è½½å¤±è´¥:&quot;</span>, error));</span><br></pre></td></tr></table></figure><p><strong>å¿«é€Ÿå¤±è´¥</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> task1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>), <span class="number">1000</span>));</span><br><span class="line"><span class="keyword">const</span> task2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_, reject</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">reject</span>(<span class="string">&quot;å‡ºé”™äº†&quot;</span>), <span class="number">500</span>));</span><br><span class="line"><span class="keyword">const</span> task3 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">3</span>), <span class="number">1000</span>));</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([task1, task2, task3])</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">results</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ‰€æœ‰ä»»åŠ¡å®Œæˆ:&quot;</span>, results))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;ä»»åŠ¡å¤±è´¥:&quot;</span>, error)); <span class="comment">// è¾“å‡º: ä»»åŠ¡å¤±è´¥: å‡ºé”™äº†</span></span><br></pre></td></tr></table></figure><p><strong>ç»Ÿä¸€å¤„ç†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡</strong></p><blockquote><p>é¿å…å¤šæ¬¡è°ƒç”¨ <code>.then()</code> æˆ–æ‰‹åŠ¨åˆå¹¶ç»“æœã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tasks = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;ä»»åŠ¡1å®Œæˆ&quot;</span>), <span class="number">1000</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;ä»»åŠ¡2å®Œæˆ&quot;</span>), <span class="number">1000</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;ä»»åŠ¡3å®Œæˆ&quot;</span>), <span class="number">1000</span>))</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>(tasks)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">results</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ‰€æœ‰ä»»åŠ¡ç»“æœ:&quot;</span>, results))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;ä»»åŠ¡å¤±è´¥:&quot;</span>, error));</span><br><span class="line"><span class="comment">// è¾“å‡º: æ‰€æœ‰ä»»åŠ¡ç»“æœ: [&quot;ä»»åŠ¡1å®Œæˆ&quot;, &quot;ä»»åŠ¡2å®Œæˆ&quot;, &quot;ä»»åŠ¡3å®Œæˆ&quot;]</span></span><br></pre></td></tr></table></figure><h4 id="æ‰‹å†™promise-all"><a href="#æ‰‹å†™promise-all" class="headerlink" title="æ‰‹å†™promise.all()"></a>æ‰‹å†™promise.all()</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myPromiseAll</span>(<span class="params">promises</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promises)) &#123; <span class="comment">// æ˜¯æ•°ç»„</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">// æ¯ä¸ªå…ƒç´ éƒ½è½¬æ¢ä¸º Promise</span></span><br><span class="line">            <span class="keyword">let</span> count = <span class="number">0</span> <span class="comment">// è®°å½•å·²å®Œæˆçš„ä»»åŠ¡æ•°é‡</span></span><br><span class="line">            <span class="keyword">const</span> results = []</span><br><span class="line"></span><br><span class="line">            promises.<span class="title function_">forEach</span>(<span class="function">(<span class="params">promise, index</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise)</span><br><span class="line">                    .<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">                    results[index] = value <span class="comment">// æ ¹æ®ç´¢å¼•å­˜</span></span><br><span class="line">                    count ++</span><br><span class="line">                    <span class="keyword">if</span> (count === promises.<span class="property">length</span>) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(results)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                    .<span class="title function_">catch</span>(reject)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;ä¼ å…¥çš„å‚æ•°ä¸æ˜¯æ•°ç»„&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">myPromiseAll</span>([</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>), <span class="number">3000</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">2</span>), <span class="number">2000</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">3</span>), <span class="number">1000</span>)),</span><br><span class="line">])</span><br><span class="line">    .<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">error</span>)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>GO?VO?AO?</title>
      <link href="/2025/04/03/JS/GO_VO_AO/"/>
      <url>/2025/04/03/JS/GO_VO_AO/</url>
      
        <content type="html"><![CDATA[<h1 id="GO-VO-AO"><a href="#GO-VO-AO" class="headerlink" title="GO?VO?AO?"></a>GO?VO?AO?</h1><p>æˆ‘ç”¨ <strong>ã€Œå‰§åœºæ¼”å‡ºã€</strong> æ¥æ¯”å–»è¿™äº›æ¦‚å¿µ</p><h2 id="GO-ï¼ˆGlobal-Objectï¼‰"><a href="#GO-ï¼ˆGlobal-Objectï¼‰" class="headerlink" title="GO ï¼ˆGlobal Objectï¼‰"></a>GO ï¼ˆGlobal Objectï¼‰</h2><p><strong>å…¨å±€ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆå°±æ˜¯å…¨å±€å˜é‡ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var globalProp = &quot;å‰§åœºç¯å…‰&quot;;  // ğŸ¯ æ”¾å…¥GO</span><br><span class="line">function stageManager() &#123; /*...*/ &#125;  // ğŸ¯ æ”¾å…¥GO</span><br></pre></td></tr></table></figure><p><strong>é¢„ç¼–è¯‘é˜¶æ®µ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GO = &#123;</span><br><span class="line">  globalProp: undefined,  // å…ˆæ‘†ä¸Šé“å…·æ ‡ç­¾</span><br><span class="line">  stageManager: function()&#123;...&#125;  // å¯¼æ¼”å‰§æœ¬æå‰æŒ‚å¥½</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œé˜¶æ®µ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GO = &#123;</span><br><span class="line">  globalProp: &quot;å‰§åœºç¯å…‰&quot;,  // é“å…·å°±ä½</span><br><span class="line">  stageManager: function()&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="VO-ï¼ˆVariable-Objectï¼‰"><a href="#VO-ï¼ˆVariable-Objectï¼‰" class="headerlink" title="VO ï¼ˆVariable Objectï¼‰"></a>VO ï¼ˆVariable Objectï¼‰</h2><p><strong>å˜é‡å¯¹è±¡</strong></p><p><strong>æ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡éƒ½æœ‰</strong></p><p><strong>ä¸Šä¸‹æ–‡åˆ›å»ºåˆ°é”€æ¯</strong></p><h2 id="AO-ï¼ˆActivation-Objectï¼‰"><a href="#AO-ï¼ˆActivation-Objectï¼‰" class="headerlink" title="AO ï¼ˆActivation Objectï¼‰"></a>AO ï¼ˆActivation Objectï¼‰</h2><p><strong>æ´»åŠ¨å¯¹è±¡</strong></p><p><strong>å‡½æ•°è°ƒç”¨æ—¶ä¸´æ—¶åˆ›å»ºï¼Œè°ƒç”¨ç»“æŸé”€æ¯</strong></p><h2 id="ç”¨ä¸€ä¸ªé¢è¯•é¢˜ä¾‹å­æ¥ç†è§£"><a href="#ç”¨ä¸€ä¸ªé¢è¯•é¢˜ä¾‹å­æ¥ç†è§£" class="headerlink" title="ç”¨ä¸€ä¸ªé¢è¯•é¢˜ä¾‹å­æ¥ç†è§£"></a>ç”¨ä¸€ä¸ªé¢è¯•é¢˜ä¾‹å­æ¥ç†è§£</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var a = 1;</span><br><span class="line">function test() &#123;</span><br><span class="line">    console.log(a);  // ğŸ¤” è¾“å‡ºä»€ä¹ˆï¼Ÿ</span><br><span class="line">    var a = 2;</span><br><span class="line">&#125;</span><br><span class="line">test();</span><br></pre></td></tr></table></figure><blockquote><p><strong>1.å…¨å±€GOï¼ˆåˆå§‹ï¼‰: { a: undefined, test: function }</strong></p><p><strong>2.</strong><code>var a = 1;</code>GO : { a: 1, test: function }</p><p><strong>3.</strong><code>test();</code>åˆ›å»ºAO : { a: undefined }</p><p><strong>4.</strong><code>console.log(a)</code> : AOä½äºä½œç”¨åŸŸæœ€é¡¶å±‚ï¼Œ{ a: undefined } ï¼Œè¾“å‡º <code>undefined</code></p><p><strong>5.</strong><code>var a = 2;</code>: AO : { a: 2 }</p><p><strong>6.è°ƒç”¨å‡½æ•°ç»“æŸï¼ŒAOæ•°æ®é”€æ¯ï¼ŒGO : { a: 1, test: function }</strong></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>éŸ³è§†é¢‘åŸºç¡€</title>
      <link href="/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80/"/>
      <url>/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<blockquote><p>éŸ³è§†é¢‘ï¼ŒéŸ³é¢‘å’Œè§†é¢‘å¹¶ä¸æ˜¯åœ¨ä¸€èµ·å¤„ç†çš„ï¼Œè€Œæ˜¯åˆ†å¼€å¤„ç†è‡³æœ€ååˆæˆçš„éŸ³è§†é¢‘</p></blockquote><blockquote><p>å¼€æºè„šæœ¬ <a href="https://github.com/Momo707577045/media-source-extract">media-source-extract</a> å¯ä»¥æ— å·®åˆ«æå–ç½‘é¡µæ˜¾ç¤ºçš„æ‰€æœ‰media</p><p>mediaä¸‹è½½åä¸ºéŸ³é¢‘è§†é¢‘åŒæ–‡ä»¶</p><p>é…åˆ <a href="https://mkvtoolnix.download/downloads.html#windows">mkvtoolnix</a> æ··æµå™¨å¯åˆæˆä¸ºåŸè§†é¢‘ï¼Œæ„Ÿå…´è¶£å¯ä»¥å°è¯•ä¸€ä¸‹</p></blockquote><h3 id="å½•åˆ¶åŸç†"><a href="#å½•åˆ¶åŸç†" class="headerlink" title="å½•åˆ¶åŸç†"></a>å½•åˆ¶åŸç†</h3><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjQ3NDU2ODAyNDljNmMwOWZlOGI0NTM5NWExZDY1Y2FfN1JibXYwaTByQmxjdTVmeDdHajJVOVVYRXhLMGRMcWZfVG9rZW46UDhDMWJ0VUNWb1ZTVDB4WkpJWmNHMEpDbjVyXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h3 id="æ’­æ”¾åŸç†"><a href="#æ’­æ”¾åŸç†" class="headerlink" title="æ’­æ”¾åŸç†"></a>æ’­æ”¾åŸç†</h3><blockquote><p><strong>è§£å°è£…</strong>(åˆ†ç¦»éŸ³è§†é¢‘) â†’ <strong>è§£ç </strong>(H.264&#x2F;AAC â†’ RGB&#x2F;PCM) â†’ <strong>åŒæ­¥</strong>(DTS&#x2F;PTS æ§åˆ¶æ’­æ”¾é¡ºåº) â†’ <strong>æ¸²æŸ“</strong></p></blockquote><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=YmY3ZTM1ZTAwY2VhNjBhMmM2NTg3YWIyMzQ0ZTkwYTJfbmtiYkY2NUg0Wk5JRDZ4ajFNZmEzSXNVN1ZMek1VTmdfVG9rZW46T3M2SWI5TlJFb200eFR4UGF6VGNxVFlrbnlmXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h3 id="ä½æ·±ï¼ˆå•ä½-bitï¼‰"><a href="#ä½æ·±ï¼ˆå•ä½-bitï¼‰" class="headerlink" title="ä½æ·±ï¼ˆå•ä½ | bitï¼‰"></a>ä½æ·±ï¼ˆå•ä½ | bitï¼‰</h3><blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>CSSçš„é¢œè‰²é€šå¸¸åŸºäºæ¯é€šé“8bitçš„RGBAæ¨¡å‹ ğŸ‘‰ rgba(255,255,255,0.5)ï¼Œæ•´ä½“é¢œè‰²æ·±åº¦ä¸º32ä½</p></blockquote><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=YzRiZDA3ZWQ0NWI0MmVmZDFhZTE5MmM1OTgyZTI1YjRfTkpycDl0UllDbFFmMDJKUzlIQXhzaGJrUEIwSXZvNzVfVG9rZW46UjB3RmJEdFE5bzZZOUN4ekRuNWM3aDNVbkpnXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h3 id="å¸§ç‡ï¼ˆå•ä½-fpsï¼‰"><a href="#å¸§ç‡ï¼ˆå•ä½-fpsï¼‰" class="headerlink" title="å¸§ç‡ï¼ˆå•ä½ | fpsï¼‰"></a>å¸§ç‡ï¼ˆå•ä½ | fpsï¼‰</h3><p>å¸§ç‡å³ FPS <strong>æ¯ç§’æœ‰å¤šå°‘å¸§ç”»é¢</strong></p><ul><li><strong>å¸§ç‡â†‘ æµç•…â†‘ æ€§èƒ½éœ€æ±‚â†‘</strong></li></ul><p>äººçœ¼å¯¹å›¾åƒçš„æš‚ç•™æ—¶é—´ä¸º 1&#x2F;24 ç§’ï¼Œå› æ­¤ 24fps è¢«è®¤ä¸ºæ˜¯è¿ç»­çš„</p><blockquote><p>ç”µå½±å¸§ç‡ä¸€èˆ¬æ˜¯ 24fps</p><p>ç”µè§†å‰§ä¸€èˆ¬æ˜¯ 25fps</p><p>ç›‘æ§è¡Œä¸šå¸¸ç”¨ 25fps</p><p>éŸ³è§†é¢‘é€šè¯å¸¸ç”¨ 15fps</p></blockquote><h3 id="ç ç‡ï¼ˆå•ä½-Mbpsï¼‰"><a href="#ç ç‡ï¼ˆå•ä½-Mbpsï¼‰" class="headerlink" title="ç ç‡ï¼ˆå•ä½ | Mbpsï¼‰"></a>ç ç‡ï¼ˆå•ä½ | Mbpsï¼‰</h3><p>è§†é¢‘æ–‡ä»¶åœ¨ <strong>å•ä½æ—¶é—´å†…ä½¿ç”¨çš„æ•°æ®æµé‡</strong> ã€‚æ¯”å¦‚1Mbpsã€‚</p><p>ç ç‡ &#x3D; åˆ†è¾¨ç‡ Ã— å¸§ç‡ Ã— æ¯”ç‰¹æ·±åº¦ Ã— å‹ç¼©ç‡</p><ul><li><strong>ç ç‡â†‘ åˆ†è¾¨ç‡â†‘ æ¸…æ™°â†‘</strong> ï¼ˆå¤§å¤šæ•°æƒ…å†µï¼‰</li></ul><blockquote><p>ä½†æ¨¡ç³Šçš„è§†é¢‘æ–‡ä»¶å¤§å°(ç ç‡)ä¹Ÿå¯ä»¥å¾ˆå¤§ï¼Œåˆ†è¾¨ç‡å°çš„è§†é¢‘æ–‡ä»¶å¯èƒ½ä¹Ÿæ¯”åˆ†è¾¨ç‡å¤§çš„è§†é¢‘æ–‡ä»¶æ¸…æ™°ã€‚</p></blockquote><p>å¯¹äºåŒä¸€ä¸ªåŸå§‹å›¾åƒæºçš„æ—¶å€™ï¼ŒåŒæ ·çš„ç¼–ç ç®—æ³•ï¼Œåˆ™ç ç‡è¶Šé«˜ï¼Œå›¾åƒçš„å¤±çœŸå°±ä¼šè¶Šå°ï¼Œè§†é¢‘ç”»é¢å°±ä¼šè¶Šæ¸…æ™°</p><ul><li>é«˜åˆ†è¾¨ç‡ä½ç ç‡ï¼šç”»è´¨æ¨¡ç³Šï¼ˆå¦‚ 4K 5Mbpsï¼‰ã€‚</li><li>ä½åˆ†è¾¨ç‡é«˜ç ç‡ï¼šç”»è´¨é”åˆ©ä½†æ–‡ä»¶å¤§ï¼ˆå¦‚ 720p 20Mbpsï¼‰ã€‚</li></ul><h2 id="è§†é¢‘åŸºç¡€"><a href="#è§†é¢‘åŸºç¡€" class="headerlink" title="è§†é¢‘åŸºç¡€"></a>è§†é¢‘åŸºç¡€</h2><h3 id="é¢œè‰²æ¸²æŸ“"><a href="#é¢œè‰²æ¸²æŸ“" class="headerlink" title="é¢œè‰²æ¸²æŸ“"></a>é¢œè‰²æ¸²æŸ“</h3><h4 id="RGB-BGR"><a href="#RGB-BGR" class="headerlink" title="RGB &amp; BGR"></a>RGB &amp; BGR</h4><blockquote><p>è¯¥é¢œè‰²ç¼–ç çš„åŸç†æ˜¯æ§åˆ¶ <strong>ä¸‰è‰²çš„æ˜æš—</strong> æ¥ <strong>ç»„åˆå½¢æˆ</strong> è‚‰çœ¼å¯è§çš„æ‰€æœ‰é¢œè‰²</p><p>RGB &#x2F; BGR åŒºåˆ«åœ¨äºé¢œè‰²æ’åˆ—ï¼Œçœ‹é¦–å­—æ¯å³å¯ï¼ˆRed | Green | Blueï¼‰</p></blockquote><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=MzNjYzEwZTBkYjAxNWE3NTlkYmUxNzcyMjAwNjg3MDdfV0FLcnNvNzB3RXVTVjJNQ1ByVFRmQnVEQXhSVDNFSTBfVG9rZW46WEdmWmJSZkhWb0NIMDh4czRYWmN1WXlRbndjXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h4 id="YUV"><a href="#YUV" class="headerlink" title="YUV"></a>YUV</h4><blockquote><p>ä¸åŒäºä¹‹å‰çš„ä¸‰è‰²ç³»ç»Ÿï¼ŒYUVé‡‡ç”¨ <strong>äº®åº¦</strong>(Y)<strong>+è‰²åº¦</strong>(UV) ç»„åˆå½¢æˆå®Œæ•´çš„å½©è‰²å›¾åƒ</p></blockquote><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=NmU2OTRhODQ2MGMxNTdiYjI0MGQwNWJlZDNlOTcxZWRfcXg2TTJQbHZuV1JOV2VOWEFldDFOQTRFZ1BFaFd6T2dfVG9rZW46R21oQ2JhQ1M5b2I2clB4OVhZcWNlTFlQbjdkXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><blockquote><p>æˆ‘ä»¬ä»ç„¶è¦å°†æ¯ä¸€ç§å‚é‡ï¼ˆY &#x2F; UVï¼‰æ‹†è§£æˆç±»ä¼¼åƒç´ å—çš„å½¢å¼</p><p>ä½†å¾ˆå¤šæƒ…å†µä¸‹ï¼Œäº®åº¦å—(Y) ä¸ è‰²åº¦å—(UV) å¹¶ä¸æ˜¯ 1:1 çš„å…³ç³»</p><p>æ•°é‡ï¼šäº®åº¦å‚é‡(Y) â‰¥ è‰²åº¦å‚é‡(UV)</p><p>&gt; psï¼šä¸‹å›¾ä¸­  é»‘ç‚¹è¡¨ç¤ºäº®åº¦(Y)  ç©ºå¿ƒåœ†è¡¨ç¤ºè‰²åº¦(UV)</p></blockquote><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=NWU3OWNhYWI2YWM2YWY5OWE2ZmFhNDM4MGMyOWViYzlfTDE1bFBRVkV2Y2drM21hOG5DNkluek1YREV5NU51a09fVG9rZW46RkNET2J5ZXNtb3hTSzh4TXh5dGNtZm4zblpnXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h5 id="444ï¼ˆä¸“ä¸šè§†é¢‘ç¼–è¾‘ï¼‰"><a href="#444ï¼ˆä¸“ä¸šè§†é¢‘ç¼–è¾‘ï¼‰" class="headerlink" title="444ï¼ˆä¸“ä¸šè§†é¢‘ç¼–è¾‘ï¼‰"></a>444ï¼ˆä¸“ä¸šè§†é¢‘ç¼–è¾‘ï¼‰</h5><blockquote><p>å†…éƒ¨çš„æ•°æ®å­˜å‚¨æ˜¯è¿™æ ·çš„ï¼ŒY(ç´«) U(æ©™) V(ç»¿)</p><p><strong>Y0</strong> + <strong>U0</strong> + <strong>V0</strong> &#x3D; <strong>å±å¹•ä¸Šçš„ç¬¬ä¸€ä¸ªå½©è‰²åƒç´ ç‚¹</strong></p></blockquote><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=OGRkYmUyOTE5ZmMyMjM4MzI0MTA0NDQ2OTZlNzA3MmNfVEZmVjdETVdEZFBOYzh5ODlNWlRqT21waXh6M1dCamJfVG9rZW46SXk4N2JEeUFkb3pLNEJ4dUFBYWNKUTEwbm9mXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h5 id="422ï¼ˆæ‘„åƒæœºè¾“å‡ºï¼‰"><a href="#422ï¼ˆæ‘„åƒæœºè¾“å‡ºï¼‰" class="headerlink" title="422ï¼ˆæ‘„åƒæœºè¾“å‡ºï¼‰"></a>422ï¼ˆæ‘„åƒæœºè¾“å‡ºï¼‰</h5><blockquote><p>4ï¼š2ï¼š2 ä»£è¡¨ 2Ã—Y å…±ç”¨ 1Ã—U 1Ã—V</p><p>æ‰€ä»¥ <strong>Y0</strong> + <strong>Y4</strong> + <strong>U0</strong> + <strong>V0</strong> &#x3D; <strong>å±å¹•ä¸Šçš„ç¬¬ä¸€ä¸ªå½©è‰²åƒç´ ç‚¹</strong></p></blockquote><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=MDljYWMyZDkyODM1N2YxMDJmNWY2Y2Y1ZDBmY2I2MWFfcWFseXdOMEtNZUZBVmhNbGpSMEFTR2NsV0VTdVI0VFFfVG9rZW46UTMyM2JsRzBYb09WTVd4NXEwMGNyNm9vbkJiXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h5 id="420ï¼ˆæœ€å¸¸è§-ç½‘ç»œä¼ è¾“ï¼‰"><a href="#420ï¼ˆæœ€å¸¸è§-ç½‘ç»œä¼ è¾“ï¼‰" class="headerlink" title="420ï¼ˆæœ€å¸¸è§ | ç½‘ç»œä¼ è¾“ï¼‰"></a>420ï¼ˆæœ€å¸¸è§ | ç½‘ç»œä¼ è¾“ï¼‰</h5><blockquote><p><strong>Y0</strong> + <strong>Y1</strong> + <strong>Y4</strong> + <strong>Y5</strong> + <strong>U0</strong> + <strong>V0</strong> &#x3D; <strong>å±å¹•ä¸Šçš„ç¬¬ä¸€ä¸ªå½©è‰²åƒç´ ç‚¹</strong></p><p>æ³¨æ„ <strong>Y</strong> çš„é€‰å–æ˜¯ <strong>2x2</strong> åŒºåŸŸï¼Œå¹¶ä¸æ˜¯ 1x4 | 4x1</p></blockquote><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=YTFmMTQxODQ1MzNhOTAyN2ViOWVlNzcyMDA5N2VjNjRfVDFTYzVNZVVCVDExRVNUNFRQUXRBTWxvV0tUMWRoaDBfVG9rZW46VWJZQmJiempsb21pb1Z4TUJ1YWN5dGwzbnViXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h6 id="420-NV12"><a href="#420-NV12" class="headerlink" title="420 NV12"></a>420 NV12</h6><blockquote><p>å’Œä¸Šé¢çš„åŒºåˆ«åœ¨äº UV çš„æ’åˆ—æ–¹å¼ä¸åŒ</p></blockquote><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=OWVmMDdkMWY4MDIyZDJhZjliY2Q5NDI3YjM1ODk1MWJfQ202S3plS01YR203bnlzOWV3NDZYb05QeExrSktJaUJfVG9rZW46QTBVSmJ3Vk9JbzRQMm54SmtNbWNjd0labk5oXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h6 id="420-æ•°æ®æ ¼å¼å‚è€ƒ"><a href="#420-æ•°æ®æ ¼å¼å‚è€ƒ" class="headerlink" title="420 æ•°æ®æ ¼å¼å‚è€ƒ"></a>420 æ•°æ®æ ¼å¼å‚è€ƒ</h6><blockquote><p>æ’åˆ—ç»„åˆçš„å…­ç§æ•°æ®æ ¼å¼</p><ul><li>è®°å¿†æ–¹å¼ï¼šç¬¬ä¸€åˆ—ä»ä¸Šè‡³ä¸‹<ul><li>YUVï¼š<em><strong>I</strong></em>420</li><li><em><strong>YV</strong></em>Uï¼š<em><strong>YV</strong></em>12</li><li>Y<em><strong>UU</strong></em>ï¼šNV<em><strong>12</strong></em></li><li>Y<em><strong>VV</strong></em>ï¼šNV<em><strong>21</strong></em></li></ul></li></ul></blockquote><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=MjRlNTljNmMzMjg0YzI0OGQ4Mjg2ZmM4M2M4ZGZmNjBfQnhTYXFSTDJrdXZjTHNhMUdSRDNVdEZ1dHpGdHlleVJfVG9rZW46RVNna2JOOEQxb2g0TFR4ZUhIa2NJaVFVbjFlXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h4 id="RGB-YUV-è½¬æ¢"><a href="#RGB-YUV-è½¬æ¢" class="headerlink" title="RGB &#x2F; YUV è½¬æ¢"></a>RGB &#x2F; YUV è½¬æ¢</h4><blockquote><p>é€šå¸¸æƒ…å†µä¸‹RGBå’ŒYUVç›´æ¥çš„ç›¸äº’è½¬æ¢éƒ½æ˜¯è°ƒç”¨æ¥å£å®ç°ï¼Œæ¯”å¦‚ Ffmpeg çš„ swscale æˆ–è€ libyuv ç­‰åº“</p></blockquote><p>ä¸»è¦è½¬æ¢æ ‡å‡†æ˜¯ <strong>BT601</strong> å’Œ <strong>BT709</strong></p><ul><li>8bitä½æ·±çš„æƒ…å†µä¸‹<ul><li>TV rangeæ˜¯ 16-235(Y)ã€16-240(U&#x2F;V)ï¼Œä¹Ÿå«Limited Range</li><li>PC rangeæ˜¯ 0-255(Y)ã€0-255(U&#x2F;V)ï¼Œä¹Ÿå«Full Range</li><li>RGBæ²¡æœ‰rangeä¹‹åˆ†ï¼Œå…¨æ˜¯0-255</li></ul></li></ul><p>BT601 TV Rangeè½¬æ¢å…¬å¼</p><ul><li>YUV(256 çº§åˆ«)å¯ä»¥ä»8ä½ RGB ç›´æ¥è®¡ç®—:<ul><li>Y &#x3D; 0.299<em>R + 0.587</em>G + 0.114*B:</li><li>U &#x3D; -0.169<em>R - 0.331</em>G + 0.5*B;</li><li>V &#x3D; 0.5<em>R - 0.419</em>G - 0.081*B;</li></ul></li><li>åè¿‡æ¥ï¼ŒRGB ä¹Ÿå¯ä»¥ç›´æ¥ä»YUV(256çº§åˆ«)è®¡ç®—<ul><li>R&#x3D;Y+ 1.402(Y-128)</li><li>G&#x3D;Y-0.34414(U-128)-0.71414(U-128)</li><li>B&#x3D;Y+ 1.772(V-128)</li></ul></li></ul><blockquote><p>âš  æ³¨æ„ï¼šä»YUV è½¬åˆ° RGB å¦‚æœå€¼å°äº0è¦å–0ï¼Œå¦‚æœå¤§äº255è¦å–255</p></blockquote><h3 id="å¸§"><a href="#å¸§" class="headerlink" title="å¸§"></a>å¸§</h3><h4 id="Iå¸§-å…³é”®å¸§-Intra-coded-frame"><a href="#Iå¸§-å…³é”®å¸§-Intra-coded-frame" class="headerlink" title="Iå¸§ | å…³é”®å¸§ (Intra coded frame)"></a>Iå¸§ | å…³é”®å¸§ (Intra coded frame)</h4><blockquote><p>ç±»ä¼¼äºæˆªå›¾ï¼Œ<strong>ç‹¬ç«‹è§£ç </strong></p></blockquote><ul><li><strong>ä¸éœ€è¦å‚è€ƒå…¶ä»–ç”»é¢</strong> è€Œç”Ÿæˆï¼Œè§£ç æ—¶ä»…é è‡ªå·±å°±é‡æ„å®Œæ•´å›¾åƒ</li><li>ä½œä¸ºPå¸§å’ŒBå¸§çš„å‚è€ƒå¸§(å…¶è´¨é‡ç›´æ¥å½±å“åˆ°åŒç»„ä¸­ä»¥åå„çš„è´¨é‡)</li><li>ä½œä¸ºå¸§ç»„GOPçš„åŸºç¡€å¸§(ç¬¬ä¸€å¸§)ï¼Œåœ¨ä¸€ç»„ä¸­åªæœ‰ä¸€ä¸ªIå¸§;</li><li>å›¾åƒé‡‡ç”¨ <strong>å¸§å†…ç¼–ç </strong> æ–¹å¼</li><li>å›¾åƒæ˜¯ <strong>å‘¨æœŸæ€§å‡ºç°</strong> åœ¨å›¾åƒåºåˆ—ä¸­çš„ï¼Œå‡ºç°é¢‘ç‡å¯ç”±ç¼–ç å™¨é€‰æ‹©</li><li>æ‰€å æ•°æ®çš„ä¿¡æ¯é‡æ¯”è¾ƒå¤§</li><li>Iå¸§ä¸éœ€è¦è€ƒè™‘è¿åŠ¨çŸ¢é‡</li></ul><h4 id="På¸§-å‰å‘é¢„æµ‹å¸§-Predicted-frame"><a href="#På¸§-å‰å‘é¢„æµ‹å¸§-Predicted-frame" class="headerlink" title="På¸§ | å‰å‘é¢„æµ‹å¸§ (Predicted frame)"></a>På¸§ | å‰å‘é¢„æµ‹å¸§ (Predicted frame)</h4><blockquote><p>ç±»ä¼¼è§†é¢‘ï¼Œ<strong>ä¾é ä¸Šä¸€å¸§çš„æ•°æ®ï¼Œè¿ç»­è§£ç </strong></p></blockquote><ul><li>åˆ©ç”¨ç©ºé—´å’Œæ—¶é—´ä¸Šçš„ç›¸å…³æ€§è§£ç </li><li>éœ€è¦å‚è€ƒå‰é¢æœ€é è¿‘å®ƒçš„ Iå¸§ || På¸§ æ¥è§£ç </li></ul><h4 id="Bå¸§-åŒå‘é¢„æµ‹å¸§-Bi-directional-predicted-frame"><a href="#Bå¸§-åŒå‘é¢„æµ‹å¸§-Bi-directional-predicted-frame" class="headerlink" title="Bå¸§ | åŒå‘é¢„æµ‹å¸§ (Bi-directional predicted frame)"></a>Bå¸§ | åŒå‘é¢„æµ‹å¸§ (Bi-directional predicted frame)</h4><blockquote><p><strong>ä¾é å‰åå¸§è§£ç </strong></p></blockquote><ul><li>é‡‡ç”¨åŒå‘æ—¶é—´é¢„æµ‹ï¼Œå¤§å¤§æé«˜å‹ç¼©å€æ•°</li></ul><h4 id="è§£ç é¡ºåºï¼ˆIPBï¼‰"><a href="#è§£ç é¡ºåºï¼ˆIPBï¼‰" class="headerlink" title="è§£ç é¡ºåºï¼ˆIPBï¼‰"></a>è§£ç é¡ºåºï¼ˆIPBï¼‰</h4><p><strong>å…ˆè§£å‡ºIå¸§ï¼Œå†è§£å‡ºPå¸§ï¼Œè¿›è€Œè§£å‡ºBå¸§</strong></p><h4 id="æ˜¾ç¤ºé¡ºåºï¼ˆIBPï¼‰"><a href="#æ˜¾ç¤ºé¡ºåºï¼ˆIBPï¼‰" class="headerlink" title="æ˜¾ç¤ºé¡ºåºï¼ˆIBPï¼‰"></a>æ˜¾ç¤ºé¡ºåºï¼ˆIBPï¼‰</h4><p><strong>å…ˆæ˜¾ç¤ºIå¸§ï¼Œå†æ˜¾ç¤ºBå¸§ï¼Œè¿›è€Œæ˜¾ç¤ºPå¸§</strong></p><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=MWVhNmY3MzRiMzlhNTQxYjNjZTgwZmM1OWY0OTkyNThfYmE2bXpydUpldTdpM082UnB6MlVhNGhJUEU0SHFOZlhfVG9rZW46WU1TNWJEY2NPbzh2eEt4SHBBVWNPTnRIbkpmXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h4 id="å‹ç¼©"><a href="#å‹ç¼©" class="headerlink" title="å‹ç¼©"></a>å‹ç¼©</h4><h5 id="è§†é¢‘å‹ç¼©ç¼–ç æ ‡å‡†"><a href="#è§†é¢‘å‹ç¼©ç¼–ç æ ‡å‡†" class="headerlink" title="è§†é¢‘å‹ç¼©ç¼–ç æ ‡å‡†"></a>è§†é¢‘å‹ç¼©ç¼–ç æ ‡å‡†</h5><h6 id="H-264ï¼ˆAVCï¼‰"><a href="#H-264ï¼ˆAVCï¼‰" class="headerlink" title="H.264ï¼ˆAVCï¼‰"></a>H.264ï¼ˆAVCï¼‰</h6><blockquote><p>æ‰‹æœºæ‹çš„1080pè§†é¢‘å¾ˆå¯èƒ½æ˜¯H.264ç¼–ç </p></blockquote><ul><li><strong>å…¼å®¹æ€§æœ€å¥½</strong>ï¼ˆå‡ ä¹æ‰€æœ‰è®¾å¤‡&#x2F;å¹³å°éƒ½æ”¯æŒï¼‰ï¼Œç”Ÿæ€æˆç†Ÿ</li><li>ä»˜è´¹ï¼Œå‹ç¼©æ•ˆç‡è¾ƒä½ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶ä½“ç§¯å¤§ï¼Œä¸”ä¸æ”¯æŒâ‰¥4Kçš„åˆ†è¾¨ç‡</li></ul><h6 id="H-265ï¼ˆHEVCï¼‰"><a href="#H-265ï¼ˆHEVCï¼‰" class="headerlink" title="H.265ï¼ˆHEVCï¼‰"></a>H.265ï¼ˆHEVCï¼‰</h6><blockquote><p>4Kè“å…‰ã€é«˜ç«¯ç”µè§†ã€è‹¹æœè®¾å¤‡ï¼ˆiPhoneé»˜è®¤æ‹æ‘„4Kè§†é¢‘ç”¨HEVCï¼‰</p></blockquote><ul><li><strong>å‹ç¼©æ•ˆç‡</strong>æ¯”H.264<strong>é«˜</strong>çº¦50%ï¼ˆç›¸åŒç”»è´¨ä¸‹æ–‡ä»¶ä½“ç§¯å°ä¸€åŠï¼‰ï¼Œæ”¯æŒ4K&#x2F;8K</li><li>ä¸“åˆ©è´¹æ›´é«˜ï¼Œç¡¬ä»¶è¦æ±‚é«˜ï¼ˆéœ€æ”¯æŒHEVCçš„è§£ç å™¨ï¼‰ï¼Œéƒ¨åˆ†è®¾å¤‡ä¸æ”¯æŒ</li></ul><h6 id="VP9"><a href="#VP9" class="headerlink" title="VP9"></a>VP9</h6><blockquote><p>YouTubeçš„4Kï¼Œä½†å¦‚æœè®¾å¤‡ä¸æ”¯æŒç¡¬ä»¶è§£ç VP9ï¼Œå¯èƒ½ä¼šå¡é¡¿</p></blockquote><ul><li><strong>å…è´¹</strong>ï¼Œå‹ç¼©æ•ˆç‡æ¥è¿‘H.265ï¼Œè¾ƒä½</li><li>ç¡¬ä»¶è§£ç æ”¯æŒè¾ƒå¼±ï¼Œä¾èµ–CPUè®¡ç®—ï¼Œç¼–ç é€Ÿåº¦æ…¢</li></ul><h6 id="AV1"><a href="#AV1" class="headerlink" title="AV1"></a>AV1</h6><blockquote><p>æœªæ¥å‡ å¹´çš„æµåª’ä½“ç¼–ç è¶‹åŠ¿</p></blockquote><ul><li><strong>å…è´¹</strong>ï¼Œ<strong>å‹ç¼©æ•ˆç‡</strong>æ¯”H.265&#x2F;VP9<strong>æ›´é«˜</strong>ï¼ˆèŠ‚çœ30%å¸¦å®½ï¼‰</li><li>ç¡¬ä»¶æ”¯æŒå°šæœªæ™®åŠï¼ˆNVIDIA RTX 40ç³»ã€AMD RX 7000ç³»ï¼‰ï¼Œç¼–ç é€Ÿåº¦ææ…¢</li></ul><h2 id="éŸ³é¢‘åŸºç¡€"><a href="#éŸ³é¢‘åŸºç¡€" class="headerlink" title="éŸ³é¢‘åŸºç¡€"></a>éŸ³é¢‘åŸºç¡€</h2><h3 id="å£°é¢‘"><a href="#å£°é¢‘" class="headerlink" title="å£°é¢‘"></a>å£°é¢‘</h3><blockquote><p>å£°éŸ³çš„é¢‘ç‡æ˜¯å‘¨æœŸçš„å€’æ•°ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯å£°éŸ³åœ¨1ç§’é’Ÿå†…çš„å‘¨æœŸæ•°ï¼Œå•ä½æ˜¯èµ«å…¹(Hz)ã€å¹²èµ«(kHz)</p><p>1000Hzï¼Œè¡¨ç¤ºæ¯ç§’æŒ¯åŠ¨1000æ¬¡</p></blockquote><p>å£°éŸ³æŒ‰é¢‘ç‡å¯ä½œå¦‚ä¸‹åˆ’åˆ†:</p><table><thead><tr><th>æ¬¡å£°</th><th>0~20Hz</th></tr></thead><tbody><tr><td>äººè€³</td><td>20Hz~20KHz</td></tr><tr><td>è¶…å£°</td><td>20KHz~1GHz</td></tr><tr><td>ç‰¹è¶…å£°</td><td>1GHz~10THZ</td></tr></tbody></table><h3 id="æ•°å­—éŸ³é¢‘"><a href="#æ•°å­—éŸ³é¢‘" class="headerlink" title="æ•°å­—éŸ³é¢‘"></a>æ•°å­—éŸ³é¢‘</h3><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmI4MmIwMGY0Y2I2OTU3MmRjMjE3ZjcxNGQxMjM3ODdfNkxHeU5SNnRERHpMOG15YjNvOFpmSDF6OHRLNmZJTTBfVG9rZW46VVljOWI1aTlsb0lGT2h4d2N5RGN3TzNBbjhjXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h4 id="é‡‡æ ·é¢‘ç‡"><a href="#é‡‡æ ·é¢‘ç‡" class="headerlink" title="é‡‡æ ·é¢‘ç‡"></a>é‡‡æ ·é¢‘ç‡</h4><blockquote><p>æ¦‚å¿µï¼š<strong>æ¯ç§’é’Ÿé‡‡æ ·çš„ç‚¹çš„ä¸ªæ•°</strong></p></blockquote><p>è¦ä»é‡‡æ ·ä¸­å®Œå…¨æ¢å¤åŸå§‹ä¿¡å·æ³¢å½¢é‡‡æ ·é¢‘ç‡å¿…é¡»è‡³å°‘æ˜¯ä¿¡å·ä¸­æœ€é«˜é¢‘ç‡çš„ä¸¤å€ï¼ˆNyguisté‡‡æ ·å®šå¾‹ï¼‰</p><blockquote><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªéŸ³é¢‘ä¿¡å·ï¼Œå…¶æœ€é«˜é¢‘ç‡ä¸º20kHzï¼ˆäººç±»å¬è§‰èŒƒå›´å†…çš„ä¸Šé™ï¼‰</p><p>æ ¹æ®å¥ˆå¥æ–¯ç‰¹é‡‡æ ·å®šå¾‹ï¼Œä¸ºäº†å‡†ç¡®åœ°æ•æ‰è¿™ä¸ªä¿¡å·è€Œä¸å¤±çœŸï¼Œåˆ™éœ€è¦è‡³å°‘ä»¥40kHzçš„é¢‘ç‡å¯¹è¯¥ä¿¡å·è¿›è¡Œé‡‡æ ·</p><p>è¿™æ ·ç»è¿‡æ•°å­—åŒ–å¤„ç†ä¹‹åï¼Œäººè€³å¬åˆ°çš„å£°éŸ³è´¨é‡ä¸ä¼šè¢«é™ä½</p></blockquote><p>å¸¸ç”¨çš„é‡‡æ ·é¢‘ç‡æœ‰</p><table><thead><tr><th>22000(22kHz)</th><th>æ— çº¿å¹¿æ’­</th></tr></thead><tbody><tr><td>44100(44.1kHz)</td><td>CDéŸ³è´¨</td></tr><tr><td>48000(48kHz)</td><td>æ•°å­—ç”µè§†ï¼ŒDVD</td></tr><tr><td>96000(96kHz)</td><td>è“å…‰ï¼Œé«˜æ¸…DVD</td></tr><tr><td>192000(192kHz)</td><td>è“å…‰ï¼Œé«˜æ¸…DVD</td></tr></tbody></table><h4 id="é‡‡æ ·é‡åŒ–"><a href="#é‡‡æ ·é‡åŒ–" class="headerlink" title="é‡‡æ ·é‡åŒ–"></a>é‡‡æ ·é‡åŒ–</h4><p>é‡‡æ ·æ˜¯åœ¨ç¦»æ•£çš„æ—¶é—´ç‚¹ä¸Šè¿›è¡Œçš„ï¼Œè€Œé‡‡æ ·å€¼æœ¬èº«åœ¨è®¡ç®—æœºä¸­ä¹Ÿæ˜¯ç¦»æ•£çš„</p><p><strong>é‡‡æ ·å€¼çš„ç²¾åº¦å–å†³äºå®ƒç”¨å¤šå°‘ä½æ¥è¡¨ç¤º</strong>ï¼Œè¿™å°±æ˜¯é‡åŒ–</p><p>ä¾‹å¦‚8ä½é‡åŒ–å¯ä»¥è¡¨ç¤º256ä¸ªä¸åŒå€¼ï¼Œè€ŒCDè´¨é‡çš„16ä½é‡åŒ–å¯ä»¥è¡¨ç¤º65536ä¸ªå€¼ï¼ŒèŒƒå›´ä¸º [-32768ï¼Œ32767]</p><p>ä¸‹å›¾æ˜¯ä¸€ä¸ª3ä½é‡åŒ–çš„ç¤ºæ„å›¾</p><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=NTg0OTI5YWEzOGE2MzE1YmUyMzg3ZmNmNmY2Y2MwMzdfQ3ozQVNXM0c1QlJZeDV3S1ZaV1ZDTDl0eVl4OVF3S2JfVG9rZW46UUhjVmJodGNSb2l2aEN4a1JVcmNpbHNybk9jXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><p>å¯ä»¥çœ‹å‡º3ä½é‡åŒ–åªèƒ½è¡¨ç¤º8ä¸ªå€¼:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.75`ï¼Œ`0.5`ï¼Œ`0.25`ï¼Œ`0`ï¼Œ`-0.25`ï¼Œ`-0.5`ï¼Œ`-0.75`ï¼Œ`-1</span><br></pre></td></tr></table></figure><p>é‡åŒ–ä½æ•°è¶Šå°‘ï¼Œæ³¢å½¢å°±è¶Šéš¾è¾¨è®¤ï¼Œè¿˜åŸåçš„å£°éŸ³è´¨é‡ä¹Ÿå°±è¶Šå·®(å¯èƒ½é™¤äº†ä¸€ç‰‡å—¡å—¡å£°ä¹‹å¤–ä»€ä¹ˆéƒ½æ²¡æœ‰)</p><h4 id="é‡‡æ ·ç²¾åº¦"><a href="#é‡‡æ ·ç²¾åº¦" class="headerlink" title="é‡‡æ ·ç²¾åº¦"></a>é‡‡æ ·ç²¾åº¦</h4><p>ä¹Ÿå«<strong>é‡‡æ ·æ·±åº¦</strong>ï¼šæŒ‡æ¯ä¸ª â€˜æ ·æœ¬ç‚¹â€™ çš„å¤§å°</p><ul><li>å¸¸ç”¨å¤§å°ï¼š8bitï¼Œ16bitï¼Œ24bit</li><li>é€šé“æ•°ï¼šå•å£°é“ï¼ŒåŒå£°é“ï¼Œå››å£°é“ï¼Œ5.1å£°é“</li><li>æ¯”ç‰¹ç‡ï¼šæ¯ç§’ä¼ è¾“çš„bitæ•°ï¼Œå•ä½ bps (Bit PerSecond) é—´æ¥è¡¡é‡å£°éŸ³è´¨é‡çš„ä¸€ä¸ªæ ‡å‡†<ul><li>æ²¡æœ‰å‹ç¼©çš„éŸ³é¢‘æ•°æ®çš„æ¯”ç‰¹ç‡ &#x3D; é‡‡æ ·é¢‘ç‡ Ã— é‡‡æ ·ç²¾åº¦ Ã— é€šé“æ•°</li></ul></li></ul><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=NGQ2MDI2ZDU0Zjg2NjM5OGRlM2ZmMmQxOTQxZWY3MzRfWXRIY3ljZDkwSmpucU9Zb3B4V08xb0FocEMxdXBoakxfVG9rZW46RmkzNGJKcjQ5b1pqdzJ4Q0h6N2NQYWhPblhnXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h3 id="ç ç‡"><a href="#ç ç‡" class="headerlink" title="ç ç‡"></a>ç ç‡</h3><p>ç ç‡ &#x3D; éŸ³é¢‘æ–‡ä»¶å¤§å° &#x2F; æ—¶é•¿</p><p>ç ç‡â†‘ éŸ³è´¨â†‘ å‹ç¼©åæ•°æ®é‡â†‘ å‹ç¼©æ•ˆç‡â†“</p><p>å‹ç¼©åçš„éŸ³é¢‘æ•°æ®çš„æ¯”ç‰¹ç‡å¸¸è§çš„ç ç‡</p><table><thead><tr><th>96kbps</th><th>FMè´¨é‡</th></tr></thead><tbody><tr><td>128-160kbps</td><td>ä¸€èˆ¬è´¨é‡éŸ³é¢‘</td></tr><tr><td>192kbps</td><td>CDè´¨é‡</td></tr><tr><td>256-320Kbps</td><td>é«˜è´¨é‡éŸ³é¢‘</td></tr></tbody></table><h3 id="å¸§-1"><a href="#å¸§-1" class="headerlink" title="å¸§"></a>å¸§</h3><blockquote><p>ç±»ä¼¼äºè§†é¢‘çš„å¸§ï¼Œä»£è¡¨æ¯æ¬¡ç¼–ç çš„é‡‡æ ·å•å…ƒæ•°</p><p>æ¯”å¦‚MP3é€šå¸¸æ˜¯1152ä¸ªé‡‡æ ·ç‚¹ä½œä¸ºä¸€ä¸ªç¼–ç å•å…ƒï¼ŒAACé€šå¸¸æ˜¯1024ä¸ªé‡‡æ ·ç‚¹ä½œä¸ºä¸€ä¸ªç¼–ç å•å…ƒã€‚</p></blockquote><h4 id="å¸§é•¿"><a href="#å¸§é•¿" class="headerlink" title="å¸§é•¿"></a>å¸§é•¿</h4><ul><li>å¯ä»¥æŒ‡<strong>æ¯å¸§æ’­æ”¾æŒç»­çš„æ—¶é—´</strong><ul><li>å¸§é•¿(ç§’) &#x3D; æ¯å¸§é‡‡æ ·ç‚¹æ•° &#x2F; é‡‡æ ·é¢‘ç‡(HZ)</li><li><blockquote><ul><li>æ¯”å¦‚ï¼šMP3 48kï¼Œ1152ä¸ªé‡‡æ ·ç‚¹ï¼Œæ¯å¸§åˆ™ä¸º 24æ¯«ç§’ï¼ˆ1152&#x2F;48000&#x3D;0.024ç§’&#x3D;24æ¯«ç§’ï¼‰</li></ul></blockquote></li></ul></li><li>ä¹Ÿå¯ä»¥æŒ‡<strong>å‹ç¼©åæ¯å¸§çš„æ•°æ®é•¿åº¦</strong></li></ul><h4 id="å­˜å‚¨"><a href="#å­˜å‚¨" class="headerlink" title="å­˜å‚¨"></a>å­˜å‚¨</h4><h5 id="äº¤é”™æ¨¡å¼"><a href="#äº¤é”™æ¨¡å¼" class="headerlink" title="äº¤é”™æ¨¡å¼"></a>äº¤é”™æ¨¡å¼</h5><p>ä»¥è¿ç»­å¸§çš„æ–¹å¼å­˜æ”¾ï¼Œå³é¦–å…ˆè®°å½•å¸§1çš„å·¦å£°é“æ ·æœ¬å’Œå³å£°é“æ ·æœ¬ï¼Œå†å¼€å§‹å¸§2çš„è®°å½•</p><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=ODJiNmQ0ZDA5MjUxMmQxNjRmM2MwNTI1OWJmMDFkN2RfeG5lNjN5Qzg5RkFiWklqNE9ubmMzUnFyYm9aWHVZYkZfVG9rZW46V2FwbWJiS0t2bzBkaEl4VXZNV2NzMXFxbkZoXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h5 id="éäº¤é”™æ¨¡å¼"><a href="#éäº¤é”™æ¨¡å¼" class="headerlink" title="éäº¤é”™æ¨¡å¼"></a>éäº¤é”™æ¨¡å¼</h5><p>é¦–å…ˆè®°å½•çš„æ˜¯ä¸€ä¸ªå‘¨æœŸå†…æ‰€æœ‰å¸§çš„å·¦å£°é“æ ·æœ¬ï¼Œå†è®°å½•æ‰€æœ‰å³å£°é“æ ·æœ¬</p><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=ODg5YWU4MmQ1MWU1ZjBkNjI2ZmRiNTExMzU3N2Q5YmNfUmNUb3Z6aWI3a3FXWWRyaDRJU1QxTVYyb25zYTFXVDdfVG9rZW46QXFkeWIySnpqb1hBbGd4T0dVSWNDVEVHbkZnXzE3NTU3OTkxNzA6MTc1NTgwMjc3MF9WNA" alt="img"></p><h4 id="å‹ç¼©-1"><a href="#å‹ç¼©-1" class="headerlink" title="å‹ç¼©"></a>å‹ç¼©</h4><h5 id="å‹ç¼©åŸç†"><a href="#å‹ç¼©åŸç†" class="headerlink" title="å‹ç¼©åŸç†"></a>å‹ç¼©åŸç†</h5><p>æ•°å­—éŸ³é¢‘ä¿¡å·å¦‚æœä¸åŠ å‹ç¼©åœ°ç›´æ¥è¿›è¡Œä¼ é€ï¼Œå°†ä¼šå ç”¨æå¤§çš„å¸¦å®½</p><blockquote><p>ä¾‹å¦‚ï¼Œä¸€å¥—åŒå£°é“æ•°å­—éŸ³é¢‘è‹¥å–æ ·é¢‘ç‡ä¸º44.1KHzï¼Œæ¯æ ·å€¼æŒ‰16bité‡åŒ–</p><p>åˆ™å…¶ç ç‡ä¸ºï¼š2Â·44.1kHz*Â·*16bit&#x3D;1.411Mbit&#x2F;s</p><p>- é˜¿é‡Œäº‘æœåŠ¡å™¨å¸¦å®½å¤§äº5Måï¼Œæ¯Mä»·æ ¼æ˜¯100å…ƒ&#x2F;æœˆ) -</p></blockquote><p>æ•°å­—éŸ³é¢‘å‹ç¼©ç¼–ç é‡‡å–<strong>å»é™¤</strong>å£°éŸ³ä¿¡å·ä¸­<strong>å†—ä½™ä¿¡å·</strong>çš„æ–¹æ³•æ¥å®ç°</p><blockquote><p>å†—ä½™ä¿¡å·ï¼šåŒ…å«äººè€³å¬è§‰èŒƒå›´å¤–çš„éŸ³é¢‘ä¿¡å·ã€è¢«æ©è”½æ‰çš„éŸ³é¢‘ä¿¡å·ã€å½“ä¸€ä¸ªå¼ºéŸ³ä¿¡å·ä¸ä¸ªå¼±éŸ³ä¿¡å·åŒæ—¶å­˜åœ¨æ—¶ï¼Œå¼±éŸ³ä¿¡å·è¢«å¼ºéŸ³ä¿¡å·æ‰€æ©è”½å°±å¯ä»¥è§†ä¸ºå†—ä½™ä¿¡å·è€Œä¸ç”¨ä¼ é€ï¼ˆè¿™ä¹Ÿæ˜¯ MP3&#x2F;<strong>AAC</strong> å‹ç¼©çš„æ ¸å¿ƒåŸç†ï¼‰</p></blockquote><h2 id="éŸ³è§†é¢‘"><a href="#éŸ³è§†é¢‘" class="headerlink" title="éŸ³è§†é¢‘"></a>éŸ³è§†é¢‘</h2><h3 id="éŸ³è§†é¢‘åŒæ­¥"><a href="#éŸ³è§†é¢‘åŒæ­¥" class="headerlink" title="éŸ³è§†é¢‘åŒæ­¥"></a>éŸ³è§†é¢‘åŒæ­¥</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p><strong>DTS</strong> (Decoding Time Stamp)</p><ul><li>è§£ç æ—¶é—´æˆ³ï¼Œå‘Šè¯‰æ’­æ”¾å™¨è¯¥åœ¨ä»€ä¹ˆæ—¶å€™<strong>è§£ç </strong>è¿™ä¸€å¸§çš„æ•°æ®</li></ul><p><strong>PTS</strong> (Presentation Time Stamp)</p><ul><li>æ˜¾ç¤ºæ—¶é—´æˆ³ï¼Œå‘Šè¯‰æ’­æ”¾å™¨è¯¥åœ¨ä»€ä¹ˆæ—¶å€™<strong>æ˜¾ç¤º</strong>è¿™ä¸€å¸§çš„æ•°æ®</li></ul><blockquote><p>B å¸§çš„è§£ç é¡ºåºä¸æ˜¾ç¤ºé¡ºåºä¸åŒï¼ˆéœ€å…ˆè§£ç  I&#x2F;P&#x2F;Bï¼Œä½†æ˜¾ç¤ºé¡ºåºä¸º I&#x2F;B&#x2F;Pï¼‰</p></blockquote><h4 id="æ–¹å¼"><a href="#æ–¹å¼" class="headerlink" title="æ–¹å¼"></a>æ–¹å¼</h4><p>Audio Masterï¼šä»¥éŸ³é¢‘ä¸ºåŸºå‡†è°ƒæ•´è§†é¢‘æ’­æ”¾é€Ÿåº¦ï¼ˆé€‚åˆç›´æ’­&#x2F;ä¼šè®®ï¼‰</p><p>Video Masterï¼šä»¥è§†é¢‘ä¸ºåŸºå‡†è°ƒæ•´éŸ³é¢‘æ’­æ”¾é€Ÿåº¦</p><p>External Clock Masterï¼šä»¥å¤–éƒ¨æ—¶é’Ÿä¸ºåŸºå‡†è°ƒæ•´éŸ³è§†é¢‘æ’­æ”¾é€Ÿåº¦</p><blockquote><p>ä¸€èˆ¬æƒ…å†µä¸‹ Audio Master &gt; External Clock Master &gt; Video Master</p></blockquote><h3 id="å¸¸è§è§†é¢‘å°è£…æ ¼å¼"><a href="#å¸¸è§è§†é¢‘å°è£…æ ¼å¼" class="headerlink" title="å¸¸è§è§†é¢‘å°è£…æ ¼å¼"></a>å¸¸è§è§†é¢‘å°è£…æ ¼å¼</h3><p>AVIã€<strong>MKV</strong>ã€MPEã€MPGã€MPEGã€<strong>MP4</strong>ã€<em>WMV</em>ã€MOVã€3GPã€M2Vã€M1Vã€M4Vã€OGMã€RMã€RMSã€RMMã€<em>RMVB</em>ã€IFOã€SWFã€<strong>FLV</strong>ã€<em>F4V</em>ã€ASFã€PMFã€XMBã€DIVXã€PARTã€DATã€VOBã€M2TSã€<em>TS</em>ã€PS</p><blockquote><p><strong>H264</strong>(å‹ç¼©) <strong>+ AAC</strong>(éŸ³é¢‘å‹ç¼©) å°è£…ä¸º <strong>FLV</strong> æˆ– <strong>MP4</strong> æ˜¯å½“ä¸‹æœ€ä¸ºæµè¡Œçš„æ¨¡å¼</p></blockquote><blockquote><p>å¦å¤–</p><p><strong>MP3</strong> æ˜¯ä¸€ç§<strong>éŸ³é¢‘å®¹å™¨æ ¼å¼</strong>ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ç§<strong>éŸ³é¢‘å‹ç¼©æ ‡å‡†</strong></p><p><strong>MP4</strong> æ˜¯ä¸€ç§<strong>éŸ³è§†é¢‘å®¹å™¨æ ¼å¼</strong>ï¼Œä½†ä¸ä½œä¸ºæŸç§å‹ç¼©æ ‡å‡†</p><p>äºŒè€…å…·æœ‰ä¸€å®šå·®åˆ«</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ¢ç´¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>FFmpegå®æˆ˜</title>
      <link href="/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/FFmpeg%E5%AE%9E%E6%88%98/"/>
      <url>/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/FFmpeg%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<h1 id="FFmpegå®æˆ˜"><a href="#FFmpegå®æˆ˜" class="headerlink" title="FFmpegå®æˆ˜"></a>FFmpegå®æˆ˜</h1><p>ffmpeg</p><blockquote><p>Hyper fast Audio and Video encoder  è¶…å¿«éŸ³è§†é¢‘ç¼–ç å™¨ (ç±»ä¼¼å‰ªè¾‘)</p></blockquote><p>ffplay:</p><blockquote><p>Simple media player  ç®€å•åª’ä½“æ’­æ”¾å™¨</p></blockquote><p>ffprobe:</p><blockquote><p>Simple multimedia streams analyzer  ç®€å•å¤šåª’ä½“æµåˆ†æå™¨</p></blockquote><h3 id="å¤„ç†æµç¨‹"><a href="#å¤„ç†æµç¨‹" class="headerlink" title="å¤„ç†æµç¨‹"></a>å¤„ç†æµç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i test 1920x1080.mp4 -acodec copy -vcodec libx264-s 1280x720 test 1280x720.flv</span><br></pre></td></tr></table></figure><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120001356595.png" alt="image-20250120001356595"></p><h3 id="ffmpegå‘½ä»¤"><a href="#ffmpegå‘½ä»¤" class="headerlink" title="ffmpegå‘½ä»¤"></a>ffmpegå‘½ä»¤</h3><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120002226077.png" alt="image-20250120002226077"></p><p><strong>å¤ç”¨å™¨å’Œè§£å¤ç”¨å™¨çš„åŒºåˆ«</strong></p><ul><li><strong>å¤ç”¨å™¨ï¼ˆMultiplexer, MUXï¼‰</strong>ï¼šï¼ˆEï¼‰<ul><li><strong>åŠŸèƒ½</strong>ï¼šå°†å¤šä¸ªä¿¡å·æˆ–æ•°æ®æµåˆå¹¶æˆä¸€ä¸ªå•ä¸€çš„ä¿¡å·æˆ–æ•°æ®æµè¿›è¡Œä¼ è¾“ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šåœ¨æ•°æ®ä¼ è¾“ä¸­ï¼Œå¤ç”¨å™¨å¸¸ç”¨äºå°†å¤šä¸ªä½é€Ÿä¿¡å·åˆå¹¶ä¸ºä¸€ä¸ªé«˜é€Ÿä¿¡å·ï¼Œä»¥ä¾¿åœ¨å•ä¸€é€šé“ä¸Šä¼ è¾“ï¼Œä»è€Œæé«˜ä¼ è¾“æ•ˆç‡ã€‚</li></ul></li><li><strong>è§£å¤ç”¨å™¨ï¼ˆDemultiplexer, DEMUXï¼‰</strong>ï¼šï¼ˆDï¼‰<ul><li><strong>åŠŸèƒ½</strong>ï¼šå°†å•ä¸ªåˆå¹¶åçš„ä¿¡å·æˆ–æ•°æ®æµåˆ†è§£å›åŸå§‹çš„å¤šä¸ªä¿¡å·æˆ–æ•°æ®æµã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šåœ¨æ•°æ®æ¥æ”¶ç«¯ï¼Œè§£å¤ç”¨å™¨è´Ÿè´£å°†ä¼ è¾“è¿‡æ¥çš„åˆå¹¶ä¿¡å·è¿˜åŸä¸ºåŸå§‹çš„å¤šä¸ªä¿¡å·ï¼Œä»¥ä¾¿å„ä¸ªä¿¡å·èƒ½å¤Ÿè¢«æ­£ç¡®åœ°è¯†åˆ«å’Œå¤„ç†ã€‚</li></ul></li></ul><p><strong>ffmpeg-codecs</strong></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120004617680.png" alt="image-20250120004617680" style="zoom:67%;" /><p>è§£ç æ”¯æŒDecoding supported<br>ç¼–ç æ”¯æŒEncoding supported<br>è§†é¢‘ç¼–è§£ç å™¨Video codec<br>éŸ³é¢‘ç¼–è§£ç å™¨Audio codec<br>å‰¯æ ‡é¢˜ç¼–è§£ç å™¨Subtitle codec<br>ä»…å¸§å†…ç¼–è§£ç å™¨Intra frame-only codec<br>æœ‰æŸå‹ç¼©Lossy compression<br>æ— æŸå‹ç¼©Lossless compression</p><p><strong>ffmpeg-decoders</strong></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120005217655.png" alt="image-20250120005217655" style="zoom:67%;" /><p><strong>ffmpeg-encoders</strong></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120005623578.png" alt="image-20250120005623578" style="zoom:67%;" /><p><strong>ffmpeg-bsfs</strong></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120005835812.png" alt="image-20250120005835812" style="zoom:67%;" /><p><strong>ffmpeg-protocols</strong></p><p>æ³¨æ„è¾“å‡ºæ¬¡æ•°æ•°ï¼Œåˆ†æœ‰inputå’Œoutput</p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120005749175.png" alt="image-20250120005749175" style="zoom:67%;" /><p><strong>ffmpeg-pix_fmts</strong></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120010202742.png" alt="image-20250120010202742" style="zoom:67%;" /><p>æ›´å¤šçš„çœ‹è§†é¢‘æŠŠ</p><h4 id="æŸ¥çœ‹å…·ä½“åˆ†ç±»æ‰€æ”¯æŒçš„å‚æ•°"><a href="#æŸ¥çœ‹å…·ä½“åˆ†ç±»æ‰€æ”¯æŒçš„å‚æ•°" class="headerlink" title="æŸ¥çœ‹å…·ä½“åˆ†ç±»æ‰€æ”¯æŒçš„å‚æ•°"></a>æŸ¥çœ‹å…·ä½“åˆ†ç±»æ‰€æ”¯æŒçš„å‚æ•°</h4><p>è¯­æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmepg -h type=name</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -h muxer=flv</span><br><span class="line">ffmpeg -h filter=atempo (atempoè°ƒæ•´éŸ³é¢‘æ’­æ”¾é€Ÿç‡)</span><br><span class="line">ffmpeg -h encoder=libx264</span><br></pre></td></tr></table></figure><h3 id="ffplayå‘½ä»¤"><a href="#ffplayå‘½ä»¤" class="headerlink" title="ffplayå‘½ä»¤"></a>ffplayå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ã€Šæ˜æœ«ä¸‡é‡Œè¡Œ-ä¸æ»¡ç©—åŒè¡Œçš„åå¹´ã€‹.mp4</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffplay æ–‡ä»¶å</span><br></pre></td></tr></table></figure><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250124235101515.png" alt="image-20250124235101515" style="zoom:67%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffplay -volume 1 ã€Šæ˜æœ«ä¸‡é‡Œè¡Œ-ä¸æ»¡ç©—åŒè¡Œçš„åå¹´ã€‹.mp4</span><br></pre></td></tr></table></figure><p>åŸºç¡€é€‰é¡¹</p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250125001351564.png" alt="image-20250125001351564" style="zoom:50%;" /><p>é«˜çº§é€‰é¡¹</p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250125002712288.png" alt="image-20250125002712288" style="zoom:67%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250125003240368.png" alt="image-20250125003240368" style="zoom:67%;" />]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ¢ç´¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£Hot100</title>
      <link href="/2025/04/03/%E8%B5%84%E6%BA%90/%E5%8A%9B%E6%89%A3Hot100/"/>
      <url>/2025/04/03/%E8%B5%84%E6%BA%90/%E5%8A%9B%E6%89%A3Hot100/</url>
      
        <content type="html"><![CDATA[<h1 id="åŠ›æ‰£Hot100"><a href="#åŠ›æ‰£Hot100" class="headerlink" title="åŠ›æ‰£Hot100"></a>åŠ›æ‰£Hot100</h1><h2 id="1-ä¸¤æ•°ä¹‹å’Œ"><a href="#1-ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="1.ä¸¤æ•°ä¹‹å’Œ"></a>1.ä¸¤æ•°ä¹‹å’Œ</h2><h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> twoSum = <span class="keyword">function</span>(<span class="params">nums, target</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();<span class="comment">// åˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ç”¨äºå­˜å‚¨å·²éå†çš„æ•°å­—åŠå…¶ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nums.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> now = nums[i];</span><br><span class="line">        <span class="keyword">const</span> oth = target - now;<span class="comment">// ç›®æ ‡å€¼çš„è¡¥æ•°</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (map.<span class="title function_">has</span>(oth)) &#123;<span class="comment">// æ£€æŸ¥å“ˆå¸Œè¡¨</span></span><br><span class="line">            <span class="keyword">return</span> [map.<span class="title function_">get</span>(oth), i];<span class="comment">//è¿”å›å½“å‰ç´¢å¼•å’Œè¡¥æ•°çš„ç´¢å¼•</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        map.<span class="title function_">set</span>(now, i);<span class="comment">// å°†å½“å‰æ•°å­—åŠå…¶ç´¢å¼•å­˜å…¥å“ˆå¸Œè¡¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="forEach"><a href="#forEach" class="headerlink" title="forEach"></a>forEach</h3><blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="title function_">forEach</span>(<span class="function">(<span class="params">element, index, array</span>) =&gt;</span> &#123; <span class="comment">/* â€¦ */</span> &#125;)</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> twoSum = <span class="keyword">function</span>(<span class="params">nums, target</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    <span class="keyword">let</span> res;</span><br><span class="line"></span><br><span class="line">    nums.<span class="title function_">forEach</span>(<span class="function">(<span class="params">now, i</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> oth = target - now;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (map.<span class="title function_">has</span>(oth)) &#123;</span><br><span class="line">            res = [map.<span class="title function_">get</span>(oth), i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        map.<span class="title function_">set</span>(now, i);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (res) &#123; <span class="keyword">return</span> result; &#125; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="3-æ— é‡å¤å­—ç¬¦æœ€é•¿å­—ä¸²"><a href="#3-æ— é‡å¤å­—ç¬¦æœ€é•¿å­—ä¸²" class="headerlink" title="3.æ— é‡å¤å­—ç¬¦æœ€é•¿å­—ä¸²"></a>3.æ— é‡å¤å­—ç¬¦æœ€é•¿å­—ä¸²</h2><blockquote><p>const map &#x3D; new Set()</p><p>åŒæŒ‡é’ˆ</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lengthOfLongestSubstring = <span class="keyword">function</span>(<span class="params">s</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> ans = <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> l = <span class="number">0</span></span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> r=<span class="number">0</span>; r&lt;s.<span class="property">length</span>; r++)&#123;</span><br><span class="line">        <span class="keyword">let</span> c=s[r]</span><br><span class="line">        <span class="keyword">while</span>(map.<span class="title function_">has</span>(c))&#123;</span><br><span class="line">            map.<span class="title function_">delete</span>(s[l])</span><br><span class="line">            l++</span><br><span class="line">        &#125;</span><br><span class="line">        map.<span class="title function_">add</span>(c)</span><br><span class="line">        <span class="keyword">if</span>(ans&lt;r-l+<span class="number">1</span>)&#123;</span><br><span class="line">            ans=r-l+<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="17-ç”µè¯å·ç "><a href="#17-ç”µè¯å·ç " class="headerlink" title="17.ç”µè¯å·ç "></a>17.ç”µè¯å·ç </h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> letterCombinations = <span class="keyword">function</span>(<span class="params">digits</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (digits.<span class="property">length</span> == <span class="number">0</span>) <span class="keyword">return</span> [];</span><br><span class="line">    <span class="keyword">const</span> res = [];</span><br><span class="line">    <span class="keyword">const</span> map = &#123; <span class="string">&#x27;2&#x27;</span>: <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;3&#x27;</span>: <span class="string">&#x27;def&#x27;</span>, <span class="string">&#x27;4&#x27;</span>: <span class="string">&#x27;ghi&#x27;</span>, <span class="string">&#x27;5&#x27;</span>: <span class="string">&#x27;jkl&#x27;</span>, <span class="string">&#x27;6&#x27;</span>: <span class="string">&#x27;mno&#x27;</span>, <span class="string">&#x27;7&#x27;</span>: <span class="string">&#x27;pqrs&#x27;</span>, <span class="string">&#x27;8&#x27;</span>: <span class="string">&#x27;tuv&#x27;</span>, <span class="string">&#x27;9&#x27;</span>: <span class="string">&#x27;wxyz&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">dfs</span> = (<span class="params">now, i</span>) =&gt; &#123;        <span class="comment">// nowæ˜¯å½“å‰å­—ç¬¦ä¸²ï¼Œiæ˜¯æ‰«æçš„æŒ‡é’ˆ</span></span><br><span class="line">        <span class="keyword">if</span> (i &gt; digits.<span class="property">length</span> - <span class="number">1</span>) &#123; <span class="comment">// æŒ‡é’ˆè¶Šç•Œï¼Œé€’å½’å‡ºå£</span></span><br><span class="line">            res.<span class="title function_">push</span>(now);           <span class="comment">// å°†è§£æ¨å…¥res</span></span><br><span class="line">            <span class="keyword">return</span>;                  <span class="comment">// ç»“æŸå½“å‰é€’å½’åˆ†æ”¯</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> strs = map[digits[i]]; <span class="comment">// å½“å‰æ•°å­—å¯¹åº”çš„å­—æ¯</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> str <span class="keyword">of</span> strs) &#123;    <span class="comment">// é€‰ä¸­str</span></span><br><span class="line">            <span class="title function_">dfs</span>(now + str, i + <span class="number">1</span>);   <span class="comment">// now + str åˆå¹¶å­—ç¬¦ä¸²å¹¶ä¼ é€’</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">dfs</span>(<span class="string">&#x27;&#x27;</span>, <span class="number">0</span>); <span class="comment">// é€’å½’çš„å…¥å£ï¼Œåˆå§‹å­—ç¬¦ä¸²ä¸º&#x27;&#x27;ï¼Œä»æŒ‰çš„ç¬¬ä¸€ä¸ªæ•°å¼€å§‹</span></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="20-æ‹¬å·æ ˆ"><a href="#20-æ‹¬å·æ ˆ" class="headerlink" title="20.æ‹¬å·æ ˆ"></a>20.æ‹¬å·æ ˆ</h2><blockquote><p>å…¥æ ˆå³æ‹¬å·</p><p>([)]</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isValid = <span class="keyword">function</span>(<span class="params">s</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (s.<span class="property">length</span> % <span class="number">2</span>) &#123; <span class="comment">// s é•¿åº¦å¿…é¡»æ˜¯å¶æ•°</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> map = &#123;<span class="string">&#x27;(&#x27;</span>: <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;[&#x27;</span>: <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>: <span class="string">&#x27;&#125;&#x27;</span>&#125;;</span><br><span class="line">    <span class="keyword">const</span> strs = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> str <span class="keyword">of</span> s) &#123;</span><br><span class="line">        <span class="keyword">if</span> (map[str]) &#123; <span class="comment">// str æ˜¯å·¦æ‹¬å·</span></span><br><span class="line">            strs.<span class="title function_">push</span>(map[str]); <span class="comment">// å…¥æ ˆå³æ‹¬å·</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strs.<span class="property">length</span> === <span class="number">0</span> || strs.<span class="title function_">pop</span>() !== str) &#123; <span class="comment">// str æ˜¯å³æ‹¬å·</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// æ²¡æœ‰å·¦æ‹¬å·ï¼Œæˆ–è€…å·¦æ‹¬å·ç±»å‹ä¸å¯¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> strs.<span class="property">length</span> === <span class="number">0</span>; <span class="comment">// æ‰€æœ‰å·¦æ‹¬å·å¿…é¡»åŒ¹é…å®Œæ¯•</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="22-æ‹¬å·ç”Ÿæˆ"><a href="#22-æ‹¬å·ç”Ÿæˆ" class="headerlink" title="22.æ‹¬å·ç”Ÿæˆ"></a>22.æ‹¬å·ç”Ÿæˆ</h2><blockquote><p><strong>dfs</strong> (<em>å¡«å…¥æ‹¬å·æ•°</em>ï¼Œ<em>å·¦æ‹¬å·æ•°</em>)</p><p>æ³¨æ„å¡«å…¥å³æ‹¬å·çš„åˆ¤æ–­é€»è¾‘</p></blockquote><blockquote><p><strong><code>join()</code></strong> å°†ä¸€ä¸ªæ•°ç»„çš„æ‰€æœ‰å…ƒç´  <strong>è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">join() </span><br><span class="line">join(ç¬¦å·)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(array.<span class="title function_">join</span>());<span class="comment">//é€—å·åˆ†</span></span><br><span class="line"><span class="comment">// &quot;A,B,C&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(array.<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>));<span class="comment">//ä¸åˆ†</span></span><br><span class="line"><span class="comment">// &quot;ABC&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(array.<span class="title function_">join</span>(<span class="string">&quot;-&quot;</span>));<span class="comment">//-åˆ†</span></span><br><span class="line"><span class="comment">// &quot;A-B-C&quot;</span></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> generateParenthesis = <span class="keyword">function</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> res = []</span><br><span class="line">    <span class="keyword">const</span> max = <span class="number">2</span>*n</span><br><span class="line">    <span class="keyword">const</span> path = <span class="title class_">Array</span>(max)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> dfs = (<span class="function">(<span class="params">sum,l</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sum===max)&#123;<span class="comment">//å¡«æ»¡äº†</span></span><br><span class="line">            res.<span class="title function_">push</span>(path.<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(l&lt;n)&#123;<span class="comment">//å¡«&#x27;(&#x27;</span></span><br><span class="line">            path[sum]=<span class="string">&#x27;(&#x27;</span></span><br><span class="line">            <span class="title function_">dfs</span>(sum+<span class="number">1</span>,l+<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(sum-l&lt;l)&#123;<span class="comment">//å¡«&#x27;)&#x27;</span></span><br><span class="line">            path[sum]=<span class="string">&#x27;)&#x27;</span></span><br><span class="line">            <span class="title function_">dfs</span>(sum+<span class="number">1</span>,l)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">dfs</span>(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="46-å…¨æ’åˆ—"><a href="#46-å…¨æ’åˆ—" class="headerlink" title="46.å…¨æ’åˆ—"></a>46.å…¨æ’åˆ—</h2><blockquote><p><em><strong>array.slice (start, end)</strong></em></p><p>è‹¥çœç•¥åˆ™ä¸º 0-end</p></blockquote><blockquote><p><strong>JavaScript</strong> ä¸­æ•°ç»„æ˜¯<strong>å¼•ç”¨ç±»å‹</strong></p><p><strong>.slics</strong> æ˜¯ä¸€ä¸ª <strong>æµ…æ‹·è´</strong> æ“ä½œ</p><p>åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„å‰¯æœ¬ï¼Œå¹¶å°†è¿™ä¸ªå‰¯æœ¬åŠ å…¥åˆ°ç»“æœ</p><p>æœ¬é¢˜å¦‚æœå†™ <code>res.push(path)</code>ï¼šæ˜¯å°† <code>path</code> çš„<strong>å¼•ç”¨</strong>ï¼ˆè€Œä¸æ˜¯å‰¯æœ¬ï¼‰push åˆ° res ä¸­</p><ol><li><p>åˆå§‹çŠ¶æ€ï¼š<code>path = []</code>, <code>res = []</code>ã€‚</p></li><li><p>ç¬¬ä¸€æ¬¡é€’å½’ï¼š</p><ul><li>é€‰æ‹© <code>1</code>ï¼Œæ›´æ–° <code>path = [1]</code>ã€‚</li></ul></li><li><p>ç¬¬äºŒæ¬¡é€’å½’ï¼š</p><ul><li><p>é€‰æ‹© <code>2</code>ï¼Œæ›´æ–° <code>path = [1, 2]</code>ã€‚</p></li><li><p>å½“å‰è·¯å¾„é•¿åº¦ç­‰äºæ•°ç»„é•¿åº¦ï¼Œæ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.push(path)</span><br></pre></td></tr></table></figure><ul><li>æ­¤æ—¶ï¼Œ<code>res = [[1, 2]]</code>ï¼Œä½† <code>res[0]</code> æ˜¯å¯¹ <code>path</code> çš„å¼•ç”¨ã€‚</li></ul></li></ul></li><li><p>å›æº¯ï¼š</p><ul><li>æ’¤é”€é€‰æ‹© <code>2</code>ï¼Œæ›´æ–° <code>path = [1]</code>ã€‚</li><li>æ’¤é”€é€‰æ‹© <code>1</code>ï¼Œæ›´æ–° <code>path = []</code>ã€‚</li></ul></li><li><p>æœ€ç»ˆçŠ¶æ€ï¼š</p><ul><li><code>path = []</code>ï¼Œè€Œ <code>res</code> ä¸­å­˜å‚¨çš„æ˜¯å¯¹ <code>path</code> çš„å¼•ç”¨ã€‚</li><li>å› æ­¤ï¼Œ<code>res = [[], []]</code>ã€‚</li></ul></li></ol></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">permute</span> = (<span class="params">nums</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = [];</span><br><span class="line">    <span class="keyword">const</span> isused = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">dfs</span> = (<span class="params">path</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (path.<span class="property">length</span> == nums.<span class="property">length</span>) &#123; <span class="comment">// é€‰å¤Ÿäº†</span></span><br><span class="line">            res.<span class="title function_">push</span>(path.<span class="title function_">slice</span>()); <span class="comment">// æ‹·è´ä¸€ä»½pathï¼ŒåŠ å…¥è§£é›†res</span></span><br><span class="line">            <span class="keyword">return</span>;                 <span class="comment">// ç»“æŸå½“å‰é€’å½’åˆ†æ”¯</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> num <span class="keyword">of</span> nums) &#123; <span class="comment">// foræšä¸¾å‡ºæ¯ä¸ªå¯é€‰çš„é€‰é¡¹</span></span><br><span class="line">            <span class="comment">// if (path.includes(num)) continue; // ä¸è¡Œï¼æŸ¥æ‰¾æ˜¯O(n)</span></span><br><span class="line">            <span class="keyword">if</span> (isused[num]) <span class="keyword">continue</span>; <span class="comment">// ä½¿ç”¨è¿‡çš„ï¼Œè·³è¿‡</span></span><br><span class="line">            path.<span class="title function_">push</span>(num);         <span class="comment">// é€‰æ‹©å½“å‰çš„æ•°ï¼ŒåŠ å…¥path</span></span><br><span class="line">            isused[num] = <span class="literal">true</span>;       <span class="comment">// è®°å½•ä¸€ä¸‹ ä½¿ç”¨äº†</span></span><br><span class="line">            <span class="title function_">dfs</span>(path);              <span class="comment">// åŸºäºé€‰äº†å½“å‰çš„æ•°ï¼Œé€’å½’</span></span><br><span class="line">            path.<span class="title function_">pop</span>();             <span class="comment">// ä¸Šä¸€å¥çš„é€’å½’ç»“æŸï¼Œå›æº¯ï¼Œå°†æœ€åé€‰çš„æ•°popå‡ºæ¥</span></span><br><span class="line">            isused[num] = <span class="literal">false</span>;      <span class="comment">// æ’¤é”€è¿™ä¸ªè®°å½•</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">dfs</span>([]); <span class="comment">// é€’å½’çš„å…¥å£ï¼Œç©ºpathä¼ è¿›å»</span></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="70-çˆ¬æ¥¼æ¢¯"><a href="#70-çˆ¬æ¥¼æ¢¯" class="headerlink" title="70.çˆ¬æ¥¼æ¢¯"></a>70.çˆ¬æ¥¼æ¢¯</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> climbStairs = <span class="keyword">function</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sqrt_5 = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">const</span> fib_n = <span class="title class_">Math</span>.<span class="title function_">pow</span>((<span class="number">1</span> + sqrt_5) / <span class="number">2</span>, n + <span class="number">1</span>) - <span class="title class_">Math</span>.<span class="title function_">pow</span>((<span class="number">1</span> - sqrt_5) / <span class="number">2</span>,n + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">round</span>(fib_n / sqrt_5);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="78-å­é›†"><a href="#78-å­é›†" class="headerlink" title="78.å­é›†"></a>78.å­é›†</h2><blockquote><p>éå†æ ‘</p><p>dfsé‡Œçš„ä¸¤ç§çŠ¶æ€</p><p>ä¸é€‰ &#x2F; é€‰</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subsets = <span class="keyword">function</span>(<span class="params">nums</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> n = nums.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">const</span> ans = []</span><br><span class="line">    <span class="keyword">const</span> path = []</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dfs</span>(<span class="params">i</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i === n) &#123; <span class="comment">// å­é›†æ„é€ å®Œæ¯•</span></span><br><span class="line">            ans.<span class="title function_">push</span>(path.<span class="title function_">slice</span>()); <span class="comment">// å¤åˆ¶ path</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸é€‰ nums[i]</span></span><br><span class="line">        <span class="title function_">dfs</span>(i + <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é€‰ nums[i]</span></span><br><span class="line">        path.<span class="title function_">push</span>(nums[i]);</span><br><span class="line">        <span class="title function_">dfs</span>(i + <span class="number">1</span>);</span><br><span class="line">        path.<span class="title function_">pop</span>(); <span class="comment">// æ¢å¤ç°åœº</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">dfs</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="94-äºŒå‰æ ‘ä¸­åºéå†"><a href="#94-äºŒå‰æ ‘ä¸­åºéå†" class="headerlink" title="94.äºŒå‰æ ‘ä¸­åºéå†"></a>94.äºŒå‰æ ‘ä¸­åºéå†</h2><blockquote><p>å…ˆé€’å½’å·¦å­æ ‘ï¼Œå†è®¿é—®æ ¹èŠ‚ç‚¹ï¼Œæ¥ç€é€’å½’å³å­æ ‘</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inorderTraversal = <span class="keyword">function</span> (<span class="params">root</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> ans = [];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">dfs</span> = root =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">dfs</span>(root.<span class="property">left</span>);</span><br><span class="line">        ans.<span class="title function_">push</span>(root.<span class="property">val</span>);</span><br><span class="line">        <span class="title function_">dfs</span>(root.<span class="property">right</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">dfs</span>(root);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="101-å¯¹ç§°äºŒå‰æ ‘"><a href="#101-å¯¹ç§°äºŒå‰æ ‘" class="headerlink" title="101.å¯¹ç§°äºŒå‰æ ‘"></a>101.å¯¹ç§°äºŒå‰æ ‘</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isSymmetric = <span class="keyword">function</span>(<span class="params">root</span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">isSameTree</span>(<span class="params">p, q</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p === <span class="literal">null</span> || q === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> p === q;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p.<span class="property">val</span> === q.<span class="property">val</span> &amp;&amp; <span class="title function_">isSameTree</span>(p.<span class="property">left</span>, q.<span class="property">right</span>) &amp;&amp; <span class="title function_">isSameTree</span>(p.<span class="property">right</span>, q.<span class="property">left</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isSameTree</span>(root.<span class="property">left</span>, root.<span class="property">right</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="104-äºŒå‰æ ‘æœ€å¤§æ·±åº¦"><a href="#104-äºŒå‰æ ‘æœ€å¤§æ·±åº¦" class="headerlink" title="104.äºŒå‰æ ‘æœ€å¤§æ·±åº¦"></a>104.äºŒå‰æ ‘æœ€å¤§æ·±åº¦</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> maxDepth = <span class="keyword">function</span>(<span class="params">root</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> ans = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> dfs = (<span class="function">(<span class="params">root,deep</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (deep&gt;ans)ans=deep</span><br><span class="line">        <span class="keyword">if</span> (!root) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">dfs</span>(root.<span class="property">left</span>,deep+<span class="number">1</span>);</span><br><span class="line">        <span class="title function_">dfs</span>(root.<span class="property">right</span>,deep+<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">dfs</span>(root, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="136-åªå‡ºç°ä¸€æ¬¡çš„æ•°"><a href="#136-åªå‡ºç°ä¸€æ¬¡çš„æ•°" class="headerlink" title="136.åªå‡ºç°ä¸€æ¬¡çš„æ•°"></a>136.åªå‡ºç°ä¸€æ¬¡çš„æ•°</h2><blockquote><p>å¼‚æˆ– <code>^</code></p><p><code>aâŠ•0 = a</code></p><p><code>aâŠ•a = 0</code></p><p>æ»¡è¶³äº¤æ¢å¾‹å’Œç»“åˆå¾‹ï¼š<code>aâŠ•bâŠ•a</code> &#x3D; (aâŠ•a)âŠ•b &#x3D; 0âŠ•b &#x3D; <code>b</code></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> singleNumber = <span class="keyword">function</span>(<span class="params">nums</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> ans = <span class="number">0</span></span><br><span class="line">    nums.<span class="title function_">forEach</span>(<span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">        ans ^= num</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="148-æ’åºé“¾è¡¨ï¼ˆ-ï¼‰"><a href="#148-æ’åºé“¾è¡¨ï¼ˆ-ï¼‰" class="headerlink" title="148.æ’åºé“¾è¡¨ï¼ˆ?ï¼‰"></a>148.æ’åºé“¾è¡¨ï¼ˆ?ï¼‰</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 876. é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹ï¼ˆå¿«æ…¢æŒ‡é’ˆï¼‰</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">middleNode</span>(<span class="params">head</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> pre = head, slow = head, fast = head;</span><br><span class="line">    <span class="keyword">while</span> (fast &amp;&amp; fast.<span class="property">next</span>) &#123;</span><br><span class="line">        pre = slow; <span class="comment">// è®°å½• slow çš„å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        slow = slow.<span class="property">next</span>;</span><br><span class="line">        fast = fast.<span class="property">next</span>.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pre.<span class="property">next</span> = <span class="literal">null</span>; <span class="comment">// æ–­å¼€ slow çš„å‰ä¸€ä¸ªèŠ‚ç‚¹å’Œ slow çš„è¿æ¥</span></span><br><span class="line">    <span class="keyword">return</span> slow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ï¼ˆåŒæŒ‡é’ˆï¼‰</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mergeTwoLists</span>(<span class="params">list1, list2</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dummy = <span class="keyword">new</span> <span class="title class_">ListNode</span>(); <span class="comment">// ç”¨å“¨å…µèŠ‚ç‚¹ç®€åŒ–ä»£ç é€»è¾‘</span></span><br><span class="line">    <span class="keyword">let</span> cur = dummy; <span class="comment">// cur æŒ‡å‘æ–°é“¾è¡¨çš„æœ«å°¾</span></span><br><span class="line">    <span class="keyword">while</span> (list1 &amp;&amp; list2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (list1.<span class="property">val</span> &lt; list2.<span class="property">val</span>) &#123;</span><br><span class="line">            cur.<span class="property">next</span> = list1; <span class="comment">// æŠŠ list1 åŠ åˆ°æ–°é“¾è¡¨ä¸­</span></span><br><span class="line">            list1 = list1.<span class="property">next</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// æ³¨ï¼šç›¸ç­‰çš„æƒ…å†µåŠ å“ªä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¯ä»¥çš„</span></span><br><span class="line">            cur.<span class="property">next</span> = list2; <span class="comment">// æŠŠ list2 åŠ åˆ°æ–°é“¾è¡¨ä¸­</span></span><br><span class="line">            list2 = list2.<span class="property">next</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cur = cur.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cur.<span class="property">next</span> = list1 ?? list2; <span class="comment">// æ‹¼æ¥å‰©ä½™é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">return</span> dummy.<span class="property">next</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sortList = <span class="keyword">function</span>(<span class="params">head</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœé“¾è¡¨ä¸ºç©ºæˆ–è€…åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ— éœ€æ’åº</span></span><br><span class="line">    <span class="keyword">if</span> (head === <span class="literal">null</span> || head.<span class="property">next</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°ä¸­é—´èŠ‚ç‚¹ï¼Œå¹¶æ–­å¼€ head2 ä¸å…¶å‰ä¸€ä¸ªèŠ‚ç‚¹çš„è¿æ¥</span></span><br><span class="line">    <span class="comment">// æ¯”å¦‚ head=[4,2,1,3]ï¼Œé‚£ä¹ˆ middleNode è°ƒç”¨ç»“æŸå head=[4,2] head2=[1,3]</span></span><br><span class="line">    <span class="keyword">let</span> head2 = <span class="title function_">middleNode</span>(head);</span><br><span class="line">    <span class="comment">// åˆ†æ²»</span></span><br><span class="line">    head = <span class="title function_">sortList</span>(head);</span><br><span class="line">    head2 = <span class="title function_">sortList</span>(head2);</span><br><span class="line">    <span class="comment">// åˆå¹¶</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">mergeTwoLists</span>(head, head2);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="153-æ—‹è½¬æ’åºæœ€å°å€¼"><a href="#153-æ—‹è½¬æ’åºæœ€å°å€¼" class="headerlink" title="153.æ—‹è½¬æ’åºæœ€å°å€¼"></a>153.æ—‹è½¬æ’åºæœ€å°å€¼</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="160-ç›¸äº¤é“¾è¡¨"><a href="#160-ç›¸äº¤é“¾è¡¨" class="headerlink" title="160.ç›¸äº¤é“¾è¡¨"></a>160.ç›¸äº¤é“¾è¡¨</h2><blockquote><p>åˆå§‹åŒ–ä¸¤ä¸ªæŒ‡é’ˆ p&#x3D;headA, q&#x3D;headBã€‚ä¸æ–­å¾ªç¯ï¼Œç›´åˆ° p&#x3D;qã€‚</p><p>æ¯æ¬¡å¾ªç¯ï¼Œp å’Œ q å„å‘åèµ°ä¸€æ­¥ã€‚</p><p>å¦‚æœ p ä¸æ˜¯ç©ºèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ›´æ–° p ä¸º p.nextï¼Œå¦åˆ™æ›´æ–° p ä¸º headBï¼›</p><p>å¦‚æœ q ä¸æ˜¯ç©ºèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ›´æ–° q ä¸º q.nextï¼Œå¦åˆ™æ›´æ–° q ä¸º headAã€‚</p><p>å¾ªç¯ç»“æŸæ—¶ï¼Œå¦‚æœä¸¤æ¡é“¾è¡¨ç›¸äº¤ï¼Œé‚£ä¹ˆæ­¤æ—¶ p å’Œ q éƒ½åœ¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹å¤„ï¼Œè¿”å› pï¼›</p><p>å¦‚æœä¸¤æ¡é“¾è¡¨ä¸ç›¸äº¤ï¼Œé‚£ä¹ˆ p å’Œ q éƒ½èµ°åˆ°ç©ºèŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è¿”å› pï¼Œå³ç©ºèŠ‚ç‚¹ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getIntersectionNode = <span class="keyword">function</span>(<span class="params">headA, headB</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> p = headA, q = headB;</span><br><span class="line">    <span class="keyword">while</span> (p !== q) &#123;</span><br><span class="line">        p = p ? p.<span class="property">next</span> : headB;</span><br><span class="line">        q = q ? q.<span class="property">next</span> : headA;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="226-ç¿»è½¬äºŒå‰æ ‘"><a href="#226-ç¿»è½¬äºŒå‰æ ‘" class="headerlink" title="226.ç¿»è½¬äºŒå‰æ ‘"></a>226.ç¿»è½¬äºŒå‰æ ‘</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> invertTree = <span class="keyword">function</span>(<span class="params">root</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (root === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> left = <span class="title function_">invertTree</span>(root.<span class="property">left</span>); <span class="comment">// ç¿»è½¬å·¦å­æ ‘</span></span><br><span class="line">    <span class="keyword">const</span> right = <span class="title function_">invertTree</span>(root.<span class="property">right</span>); <span class="comment">// ç¿»è½¬å³å­æ ‘</span></span><br><span class="line">    root.<span class="property">left</span> = right; <span class="comment">// äº¤æ¢å·¦å³å„¿å­</span></span><br><span class="line">    root.<span class="property">right</span> = left;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="283-ç§»åŠ¨é›¶"><a href="#283-ç§»åŠ¨é›¶" class="headerlink" title="283.ç§»åŠ¨é›¶"></a>283.ç§»åŠ¨é›¶</h2><blockquote><p>å¿«æ…¢åŒæŒ‡é’ˆ</p><p><strong>è§£æ„èµ‹å€¼</strong>äº¤æ¢å˜é‡å€¼ <code>[a, b] = [b, a];</code></p><p>å¿«æŒ‡é’ˆä½é0 &#x3D;&gt; äº¤æ¢</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> moveZeroes = <span class="keyword">function</span>(<span class="params">nums</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> i0 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nums.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[i] !== <span class="number">0</span>) &#123;<span class="comment">//å¿«æŒ‡é’ˆä½!=0</span></span><br><span class="line">            [nums[i], nums[i0]] = [nums[i0], nums[i]];</span><br><span class="line">            i0++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="543-äºŒå‰æ ‘ç›´å¾„"><a href="#543-äºŒå‰æ ‘ç›´å¾„" class="headerlink" title="543.äºŒå‰æ ‘ç›´å¾„"></a>543.äºŒå‰æ ‘ç›´å¾„</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> diameterOfBinaryTree = <span class="keyword">function</span>(<span class="params">root</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> ans = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">depth</span>(<span class="params">rootNode</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!rootNode) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> L = <span class="title function_">depth</span>(rootNode.<span class="property">left</span>);</span><br><span class="line">        <span class="keyword">let</span> R = <span class="title function_">depth</span>(rootNode.<span class="property">right</span>);</span><br><span class="line"></span><br><span class="line">        ans = <span class="title class_">Math</span>.<span class="title function_">max</span>(ans, L + R + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">max</span>(L, R) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">depth</span>(root);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ans - <span class="number">1</span>;</span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> èµ„æº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯æ¨¡å—åŒ–è§„èŒƒ</title>
      <link href="/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
      <url>/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰ç«¯æ¨¡å—åŒ–è§„èŒƒ"><a href="#å‰ç«¯æ¨¡å—åŒ–è§„èŒƒ" class="headerlink" title="å‰ç«¯æ¨¡å—åŒ–è§„èŒƒ"></a>å‰ç«¯æ¨¡å—åŒ–è§„èŒƒ</h1><p>é€šå¸¸æ¥è¯´ï¼Œ<strong>ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œåªå‘å¤–æš´éœ²ç‰¹å®šçš„å˜é‡å’Œå‡½æ•°</strong>ã€‚ç›®å‰æµè¡Œçš„jsæ¨¡å—åŒ–è§„èŒƒæœ‰CommonJSã€AMDã€CMDã€UMDä»¥åŠES6çš„æ¨¡å—ç³»ç»Ÿã€‚</p><p><em><strong>AMD</strong></em>  &#x2F;  <em><strong>CMD</strong></em>  &#x2F; <em><strong>CommonJs</strong></em> æ˜¯JSæ¨¡å—åŒ–å¼€å‘çš„æ ‡å‡†è§„èŒƒï¼Œç›®å‰å¯¹åº”çš„å®ç°æ˜¯</p><p><em><strong>RequireJs</strong></em> &#x2F; <em><strong>SeaJs</strong></em> &#x2F; <em><strong>nodeJs</strong></em></p><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><h3 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a><strong>CommonJS</strong></h3><blockquote><p>CommonJSç”¨<em><strong>åŒæ­¥</strong></em>çš„æ–¹å¼åŠ è½½æ¨¡å—ã€‚<strong>åœ¨æœåŠ¡ç«¯ï¼Œæ¨¡å—æ–‡ä»¶éƒ½å­˜æ”¾åœ¨æœ¬åœ°ç£ç›˜ï¼Œè¯»å–éå¸¸å¿«ï¼Œæ‰€ä»¥è¿™æ ·åšä¸ä¼šæœ‰é—®é¢˜ã€‚ä½†æ˜¯åœ¨æµè§ˆå™¨ç«¯ï¼Œé™äºç½‘ç»œåŸå› ï¼Œæ›´åˆç†çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨å¼‚æ­¥åŠ è½½ã€‚</strong></p><p><em><strong>NodeJS</strong></em> æ˜¯ CommonJS è§„èŒƒçš„ä¸»è¦å®è·µè€…</p></blockquote><p>æœ‰4ä¸ªé‡è¦çš„ç¯å¢ƒå˜é‡ä¸ºæ¨¡å—åŒ–å®ç°æä¾›æ”¯æŒ</p><p> <code>module</code> </p><p> <code>exports</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰æ¨¡å—math.js</span></span><br><span class="line"><span class="keyword">var</span> total = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éœ€è¦å‘å¤–æš´éœ²çš„å‡½æ•°ã€å˜é‡</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">add</span>: add,</span><br><span class="line">    <span class="attr">total</span>: total</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <code>require</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** å¿…é¡»åŠ ./è·¯å¾„ï¼Œä¸åŠ çš„è¯åªä¼šå»node_modulesæ–‡ä»¶æ‰¾ **/</span></span><br><span class="line"><span class="comment">// å¼•ç”¨è‡ªå®šä¹‰çš„æ¨¡å—æ—¶ï¼Œå‚æ•°åŒ…å«è·¯å¾„ï¼Œå¯çœç•¥.js</span></span><br><span class="line"><span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">&#x27;./math&#x27;</span>);</span><br><span class="line">math.<span class="title function_">add</span>(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•ç”¨æ ¸å¿ƒæ¨¡å—æ—¶ï¼Œä¸éœ€è¦å¸¦è·¯å¾„</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line">http.<span class="title function_">createService</span>(...).<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p> <code>global</code></p><h3 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h3><blockquote><p><strong>æµè§ˆå™¨ä¼˜å…ˆ , å¼‚æ­¥åŠ è½½</strong></p><p><strong>é¢„åŠ è½½</strong></p><p>æ‰€æœ‰ä¾èµ–è¿™ä¸ªæ¨¡å—çš„è¯­å¥ï¼Œéƒ½å®šä¹‰åœ¨ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­ï¼Œç­‰åˆ°åŠ è½½å®Œæˆä¹‹åï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°æ‰ä¼šè¿è¡Œã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/** ç½‘é¡µä¸­å¼•å…¥require.jsåŠmain.js **/</span><br><span class="line">&lt;script src=&quot;js/require.js&quot; data-main=&quot;js/main&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">/** main.js å…¥å£æ–‡ä»¶/ä¸»æ¨¡å— **/</span><br><span class="line">// é¦–å…ˆç”¨config()æŒ‡å®šå„æ¨¡å—è·¯å¾„å’Œå¼•ç”¨å</span><br><span class="line">require.config(&#123;</span><br><span class="line">  baseUrl: &quot;js/lib&quot;,</span><br><span class="line">  paths: &#123;</span><br><span class="line">    &quot;jquery&quot;: &quot;jquery.min&quot;,  //å®é™…è·¯å¾„ä¸ºjs/lib/jquery.min.js</span><br><span class="line">    &quot;underscore&quot;: &quot;underscore.min&quot;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">// æ‰§è¡ŒåŸºæœ¬æ“ä½œ</span><br><span class="line">require([&quot;jquery&quot;,&quot;underscore&quot;],function($,_)&#123;</span><br><span class="line">  // some code here</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// å®šä¹‰math.jsæ¨¡å—</span><br><span class="line">define(function () &#123;</span><br><span class="line">    var basicNum = 0;</span><br><span class="line">    var add = function (x, y) &#123;</span><br><span class="line">        return x + y;</span><br><span class="line">    &#125;;</span><br><span class="line">    return &#123;</span><br><span class="line">        add: add,</span><br><span class="line">        basicNum :basicNum</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// å®šä¹‰ä¸€ä¸ªä¾èµ–underscore.jsçš„æ¨¡å—</span><br><span class="line">define([&#x27;underscore&#x27;],function(_)&#123;</span><br><span class="line">  var classify = function(list)&#123;</span><br><span class="line">    _.countBy(list,function(num)&#123;</span><br><span class="line">      return num &gt; 30 ? &#x27;old&#x27; : &#x27;young&#x27;;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;;</span><br><span class="line">  return &#123;</span><br><span class="line">    classify :classify</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// å¼•ç”¨æ¨¡å—ï¼Œå°†æ¨¡å—æ”¾åœ¨[]å†…</span><br><span class="line">require([&#x27;jquery&#x27;, &#x27;math&#x27;],function($, math)&#123;</span><br><span class="line">  var sum = math.add(10,20);</span><br><span class="line">  $(&quot;#sum&quot;).html(sum);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><blockquote><p><strong>å¼‚æ­¥åŠ è½½</strong></p><p><strong>æ‡’åŠ è½½</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/** AMDå†™æ³• **/</span><br><span class="line">define([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;], function(a, b, c, d, e, f) &#123; </span><br><span class="line">     // ç­‰äºåœ¨æœ€å‰é¢å£°æ˜å¹¶åˆå§‹åŒ–äº†è¦ç”¨åˆ°çš„æ‰€æœ‰æ¨¡å—</span><br><span class="line">    a.doSomething();</span><br><span class="line">    if (false) &#123;</span><br><span class="line">        // å³ä¾¿æ²¡ç”¨åˆ°æŸä¸ªæ¨¡å— bï¼Œä½† b è¿˜æ˜¯æå‰æ‰§è¡Œäº†</span><br><span class="line">        b.doSomething()</span><br><span class="line">    &#125; </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">/** CMDå†™æ³• **/</span><br><span class="line">define(function(require, exports, module) &#123;</span><br><span class="line">    var a = require(&#x27;./a&#x27;); //åœ¨éœ€è¦æ—¶ç”³æ˜</span><br><span class="line">    a.doSomething();</span><br><span class="line">    if (false) &#123;</span><br><span class="line">        var b = require(&#x27;./b&#x27;);</span><br><span class="line">        b.doSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">/** sea.js **/</span><br><span class="line">// å®šä¹‰æ¨¡å— math.js</span><br><span class="line">define(function(require, exports, module) &#123;</span><br><span class="line">    var $ = require(&#x27;jquery.js&#x27;);</span><br><span class="line">    var add = function(a,b)&#123;</span><br><span class="line">        return a+b;</span><br><span class="line">    &#125;</span><br><span class="line">    exports.add = add;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// åŠ è½½æ¨¡å—</span><br><span class="line">seajs.use([&#x27;math.js&#x27;], function(math)&#123;</span><br><span class="line">    var sum = math.add(1+2);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="UMD"><a href="#UMD" class="headerlink" title="UMD"></a>UMD</h3><blockquote><p>UMDæ˜¯AMDå’ŒCommonJSçš„ä¸€ä¸ªç³…åˆã€‚AMDæ˜¯æµè§ˆå™¨ä¼˜å…ˆï¼Œå¼‚æ­¥åŠ è½½ï¼›CommonJSæ˜¯æœåŠ¡å™¨ä¼˜å…ˆï¼ŒåŒæ­¥åŠ è½½ã€‚</p></blockquote><blockquote><p>å…ˆåˆ¤æ–­æ˜¯å¦æ”¯æŒnode.jsçš„æ¨¡å—ï¼Œå­˜åœ¨å°±ä½¿ç”¨node.jsï¼›å†åˆ¤æ–­æ˜¯å¦æ”¯æŒAMDï¼ˆdefineæ˜¯å¦å­˜åœ¨ï¼‰ï¼Œå­˜åœ¨åˆ™ä½¿ç”¨AMDçš„æ–¹å¼åŠ è½½ã€‚è¿™å°±æ˜¯æ‰€è°“çš„UMD</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">((root, factory) =&gt; &#123;</span><br><span class="line">  if (typeof define === &#x27;function&#x27; &amp;&amp; define.amd) &#123;</span><br><span class="line">    //AMD</span><br><span class="line">    define([&#x27;jquery&#x27;], factory);</span><br><span class="line">  &#125; else if (typeof exports === &#x27;object&#x27;) &#123;</span><br><span class="line">    //CommonJS</span><br><span class="line">    var $ = requie(&#x27;jquery&#x27;);</span><br><span class="line">    module.exports = factory($);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    //éƒ½ä¸æ˜¯ï¼Œæµè§ˆå™¨å…¨å±€å®šä¹‰</span><br><span class="line">    root.testModule = factory(root.jQuery);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(this, ($) =&gt; &#123;</span><br><span class="line">  //do something...  è¿™é‡Œæ˜¯çœŸæ­£çš„å‡½æ•°ä½“</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="ES6-Module"><a href="#ES6-Module" class="headerlink" title="ES6 Module"></a>ES6 Module</h3><p>æ¨¡å—åŠŸèƒ½ä¸»è¦ç”±ä¸¤ä¸ªå‘½ä»¤æ„æˆï¼š</p><p><code>export</code> è§„å®šæ¨¡å—çš„å¯¹å¤–æ¥å£</p><p><code>import</code> è¾“å…¥å…¶ä»–æ¨¡å—æä¾›çš„åŠŸèƒ½</p><p>ç‰¹å¾</p><blockquote><ul><li>ä¸¥æ ¼æ¨¡å¼ï¼šES6 çš„æ¨¡å—è‡ªåŠ¨é‡‡ç”¨ä¸¥æ ¼æ¨¡å¼</li><li><code>import</code> read-onlyç‰¹æ€§ï¼š <code>import</code>çš„å±æ€§æ˜¯åªè¯»çš„ï¼Œä¸èƒ½èµ‹å€¼ï¼Œç±»ä¼¼äº<code>const</code>çš„ç‰¹æ€§</li><li><code>export/import</code>æå‡ï¼š <code>import/export</code>å¿…é¡»ä½äºæ¨¡å—é¡¶çº§ï¼Œä¸èƒ½ä½äºä½œç”¨åŸŸå†…ï¼›å…¶æ¬¡å¯¹äºæ¨¡å—å†…çš„<code>import/export</code>ä¼šæå‡åˆ°æ¨¡å—é¡¶éƒ¨ï¼Œè¿™æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆçš„</li></ul></blockquote><h2 id="æ€»ç»“-åŒºåˆ«"><a href="#æ€»ç»“-åŒºåˆ«" class="headerlink" title="æ€»ç»“&#x2F;åŒºåˆ«"></a>æ€»ç»“&#x2F;åŒºåˆ«</h2><p><em><strong>CommonJs</strong></em>ä¸»è¦é’ˆå¯¹<strong>æœåŠ¡ç«¯</strong></p><blockquote><p>æœåŠ¡å™¨ç«¯ä¸€èˆ¬é‡‡ç”¨ <strong>åŒæ­¥åŠ è½½</strong> æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦æŸä¸ªæ¨¡å—ï¼ŒæœåŠ¡å™¨ç«¯ä¾¿åœä¸‹æ¥ï¼Œç­‰å¾…å®ƒåŠ è½½å†æ‰§è¡Œã€‚</p></blockquote><p><em><strong>AMD&#x2F;CMD</strong></em>ä¸»è¦é’ˆå¯¹<strong>æµè§ˆå™¨ç«¯</strong></p><blockquote><p>è€Œæµè§ˆå™¨ç«¯è¦ä¿è¯æ•ˆç‡ï¼Œéœ€è¦é‡‡ç”¨ <strong>å¼‚æ­¥åŠ è½½</strong> ï¼Œè¿™å°±éœ€è¦ä¸€ä¸ªé¢„å¤„ç†ï¼Œæå‰å°†æ‰€éœ€è¦çš„æ¨¡å—æ–‡ä»¶å¹¶è¡ŒåŠ è½½å¥½ã€‚</p></blockquote><blockquote><p><em><strong>AMD&#x2F;CMD</strong></em> éƒ½æ˜¯ <strong>å¹¶è¡ŒåŠ è½½</strong> jsæ–‡ä»¶</p></blockquote><p><em><strong>AMD</strong></em>æ˜¯<strong>é¢„åŠ è½½</strong>ï¼Œåœ¨å¹¶è¡ŒåŠ è½½jsæ–‡ä»¶åŒæ—¶ï¼Œè¿˜ä¼šè§£ææ‰§è¡Œè¯¥æ¨¡å—ï¼ˆå› ä¸ºè¿˜éœ€è¦æ‰§è¡Œï¼Œæ‰€ä»¥åœ¨åŠ è½½æŸä¸ªæ¨¡å—å‰ï¼Œè¿™ä¸ªæ¨¡å—çš„ä¾èµ–æ¨¡å—éœ€è¦å…ˆåŠ è½½å®Œæˆï¼‰</p><blockquote><p>åŠ è½½å¿«é€Ÿï¼Œå°¤å…¶é‡åˆ°å¤šä¸ªå¤§æ–‡ä»¶ï¼Œå› ä¸ºå¹¶è¡Œè§£æï¼Œæ‰€ä»¥åŒä¸€æ—¶é—´å¯ä»¥è§£æå¤šä¸ªæ–‡ä»¶</p><p>åŠ è½½é¡ºåºä¸ä¸€å®šï¼Œå¯èƒ½ä¼šä¸ºç¨‹åºåŸ‹ä¸‹å¤§å‘</p></blockquote><p><em><strong>CMD</strong></em>æ˜¯<strong>æ‡’åŠ è½½</strong>ï¼Œè™½ç„¶ä¼šä¸€å¼€å§‹å°±å¹¶è¡ŒåŠ è½½jsæ–‡ä»¶ï¼Œä½†æ˜¯ä¸ä¼šæ‰§è¡Œï¼Œè€Œæ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰æ‰§è¡Œã€‚</p><blockquote><p>æ¯ä¸ªJSæ–‡ä»¶çš„æ‰§è¡Œé¡ºåºåœ¨ä»£ç ä¸­æ˜¯æœ‰ä½“ç°çš„ï¼Œæ˜¯å¯æ§çš„</p><p>å¤šæ–‡ä»¶åŠ è½½é€Ÿåº¦å åŠ </p></blockquote><p>JSæ˜¯å•çº¿ç¨‹ï¼Œæ‰€æœ‰JSæ–‡ä»¶æ‰§è¡Œæ—¶é—´å åŠ åœ¨AMDå’ŒCMDä¸­æ˜¯ä¸€æ ·çš„ã€‚</p><p>ä½†CMDæ˜¯æ‡’åŠ è½½ï¼Œæ²¡æ³•åˆ©ç”¨ç©ºé—²æ—¶é—´ï¼Œè€ŒAMDæ˜¯æ–‡ä»¶åŠ è½½å¥½å°±æ‰§è¡Œï¼Œå¾€å¾€å¯ä»¥åˆ©ç”¨ä¸€äº›ç©ºé—²æ—¶é—´ã€‚</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://zhuanlan.zhihu.com/p/467991875">å‰ç«¯æ¨¡å—åŒ–â€”â€”å½»åº•ææ‡‚AMDã€CMDã€UMDã€ESMå’ŒCommonJS - çŸ¥ä¹</a></p><p><a href="https://blog.csdn.net/u014445339/article/details/55517770">ã€æ–°æ‰‹å…¥é—¨ æœ€ç²¾ç‚¼æ€»ç»“ã€‘AMD&#x2F;CMD&#x2F;CommonJsåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ_amdä¸cmd-CSDNåšå®¢</a></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ¢ç´¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>nrmä½¿ç”¨</title>
      <link href="/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/nrm%E4%BD%BF%E7%94%A8/"/>
      <url>/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/nrm%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="nrm"><a href="#nrm" class="headerlink" title="nrm"></a>nrm</h1><p>nrmï¼ˆnpm registry managerï¼‰æ˜¯npmçš„é•œåƒç®¡ç†å·¥å…·</p><p>èƒ½å¸®åŠ©ä½ åœ¨åŠ è½½å›½å¤–çš„èµ„æºå¤ªæ…¢æ—¶å¿«é€Ÿåˆ‡æ¢npmæº</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p><code>npm install -g nrm</code>ï¼Œå…¨å±€å®‰è£…nrm</p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="æŸ¥çœ‹æ‰€æœ‰æº"><a href="#æŸ¥çœ‹æ‰€æœ‰æº" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰æº"></a>æŸ¥çœ‹æ‰€æœ‰æº</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm ls</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºç±»ä¼¼ä»¥ä¸‹ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* npm ---------- https://registry.npmjs.org/</span><br><span class="line">  yarn --------- https://registry.yarnpkg.com/</span><br><span class="line">  tencent ------ https://mirrors.tencent.com/npm/</span><br><span class="line">  cnpm --------- https://r.cnpmjs.org/</span><br><span class="line">  taobao ------- https://registry.npmmirror.com/</span><br><span class="line">  npmMirror ---- https://skimdb.npmjs.com/registry/</span><br><span class="line">  huawei ------- https://repo.huaweicloud.com/repository/npm/</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>*</code> å·è¡¨ç¤ºå½“å‰ä½¿ç”¨çš„æºã€‚</p><h3 id="åˆ‡æ¢æº"><a href="#åˆ‡æ¢æº" class="headerlink" title="åˆ‡æ¢æº"></a>åˆ‡æ¢æº</h3><p>ç›¸æ¯” <code>npm config set registry https://registry.yarnpkg.com/</code></p><p>æˆ‘ä»¬åªè¦ <code>nrm use yarn</code> å°±ğŸ†—äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm use &lt;registry&gt;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ‡æ¢æºä¹‹åï¼Œæˆ‘ä»¬å®‰è£…ä¾èµ–ä»ä½¿ç”¨ <code>npm install &lt;package&gt;</code> çš„æ–¹å¼æ¥è¿›è¡Œå®‰è£…</p></blockquote><h3 id="æ·»åŠ æº"><a href="#æ·»åŠ æº" class="headerlink" title="æ·»åŠ æº"></a>æ·»åŠ æº</h3><p>å¯¹äºä¼ä¸šå†…éƒ¨å®šåˆ¶çš„ç§æœ‰æº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm add &lt;registry&gt; &lt;url&gt;</span><br></pre></td></tr></table></figure><blockquote><p><code>&lt;registry&gt;</code> æºåç§°</p><p><code>&lt;url&gt;</code> æºåœ°å€</p></blockquote><h3 id="åˆ é™¤æº"><a href="#åˆ é™¤æº" class="headerlink" title="åˆ é™¤æº"></a>åˆ é™¤æº</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm del &lt;registry&gt;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•æºçš„å“åº”æ—¶é—´"><a href="#æµ‹è¯•æºçš„å“åº”æ—¶é—´" class="headerlink" title="æµ‹è¯•æºçš„å“åº”æ—¶é—´"></a>æµ‹è¯•æºçš„å“åº”æ—¶é—´</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm test &lt;registry&gt;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://juejin.cn/post/6931597891182002183">nrm ä½¿ç”¨è¯¦è§£nrmï¼ˆNPM registry managerï¼‰æ˜¯ npm çš„é•œåƒæºç®¡ç†å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¿«é€Ÿåˆ‡æ¢ np - æ˜é‡‘</a></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ¢ç´¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue3æ–‡æ¡£ç²¾ç‚¼</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Vue3%E8%BF%9B%E9%98%B6API/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Vue3%E8%BF%9B%E9%98%B6API/</url>
      
        <content type="html"><![CDATA[<h1 id="æˆ‘çš„-Vue3-æ–‡æ¡£"><a href="#æˆ‘çš„-Vue3-æ–‡æ¡£" class="headerlink" title="æˆ‘çš„ Vue3 æ–‡æ¡£"></a>æˆ‘çš„ Vue3 æ–‡æ¡£</h1><h2 id="å†…ç½®æ ‡ç­¾"><a href="#å†…ç½®æ ‡ç­¾" class="headerlink" title="å†…ç½®æ ‡ç­¾"></a>å†…ç½®æ ‡ç­¾</h2><h3 id="component"><a href="#component" class="headerlink" title="component"></a>component</h3><blockquote><p>åŠ¨æ€ç»„ä»¶</p><p>æ ¹æ® currentTabComponent çš„å€¼åˆ¤æ–­æ˜¯å¦è¦æ¸²æŸ“ç»„ä»¶</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;component v-bind:is=&quot;currentTabComponent&quot;&gt;&lt;/component&gt;</span><br></pre></td></tr></table></figure><h3 id="keep-alive"><a href="#keep-alive" class="headerlink" title="keep-alive"></a>keep-alive</h3><blockquote><p>æ¯æ¬¡åˆ‡æ¢æ–°æ ‡ç­¾çš„æ—¶å€™ï¼ŒVue éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ <code>currentTabComponent</code> å®ä¾‹ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- å¤±æ´»çš„ç»„ä»¶å°†ä¼šè¢«ç¼“å­˜ï¼--&gt;</span><br><span class="line">&lt;keep-alive&gt;</span><br><span class="line">  &lt;component v-bind:is=&quot;currentTabComponent&quot;&gt;&lt;/component&gt;</span><br><span class="line">&lt;/keep-alive&gt;</span><br></pre></td></tr></table></figure><h3 id="slotâ­"><a href="#slotâ­" class="headerlink" title="slotâ­"></a>slotâ­</h3><blockquote><p>å­ç»„ä»¶çš„å ä½ç¬¦</p></blockquote><blockquote><p>åœ¨çˆ¶ç»„ä»¶å¼•ç”¨çš„<Button>ä¸­ <strong>å†™å…¥çš„å†…å®¹</strong></p><p>ä¼šè¢« <strong>æ’è¿›å­ç»„ä»¶<slot>å†…</strong> å¹¶æ¸²æŸ“å›çˆ¶ç»„ä»¶</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- çˆ¶ç»„ä»¶ --&gt;</span><br><span class="line">&lt;Button&gt;</span><br><span class="line">  &lt;div&gt;è¿™æ˜¯é»˜è®¤æ’æ§½çš„å†…å®¹&lt;/div&gt;</span><br><span class="line">&lt;/Button&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- å­ç»„ä»¶ --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;å­ç»„ä»¶å†…å®¹&lt;/div&gt;</span><br><span class="line">&lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>æ¸²æŸ“ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;div&gt;å­ç»„ä»¶å†…å®¹&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;è¿™æ˜¯é»˜è®¤æ’æ§½çš„å†…å®¹&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h4 id="é»˜è®¤æ’æ§½"><a href="#é»˜è®¤æ’æ§½" class="headerlink" title="é»˜è®¤æ’æ§½"></a>é»˜è®¤æ’æ§½</h4><blockquote><p>å½“å­ç»„ä»¶åªéœ€è¦ä¸€ä¸ªæ’æ§½ï¼Œå¹¶ä¸”ä¸éœ€è¦åŒºåˆ†ä¸åŒéƒ¨åˆ†çš„å†…å®¹æ—¶ï¼Œé»˜è®¤æ’æ§½æ˜¯æœ€ä½³é€‰æ‹©</p></blockquote><p>çˆ¶ç»„ä»¶</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Button</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/button.vue&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">&lt;Button&gt; &lt;!--å¼•ç”¨å­ç»„ä»¶--&gt;</span><br><span class="line">        &lt;div&gt;æ’æ§½å†…å®¹ï¼ŒæŠŠè¿™è¡Œdivæ’åˆ°å­ç»„ä»¶çš„&quot;&lt;slot&gt;&quot;é‡Œ&lt;/div&gt;</span><br><span class="line">    &lt;/Button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>å­ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;å­ç»„ä»¶å†…å®¹&lt;/div&gt;</span><br><span class="line">&lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>æ¸²æŸ“ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;div&gt;å­ç»„ä»¶å†…å®¹&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;æ’æ§½å†…å®¹ï¼ŒæŠŠè¿™è¡Œdivæ’åˆ°å­ç»„ä»¶çš„&quot;&lt;slot&gt;&quot;é‡Œ&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h4 id="å…·åæ’æ§½"><a href="#å…·åæ’æ§½" class="headerlink" title="å…·åæ’æ§½"></a>å…·åæ’æ§½</h4><p>çˆ¶ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">&lt;Button&gt; &lt;!--å¼•ç”¨å­ç»„ä»¶--&gt;</span><br><span class="line">        &lt;template #header&gt; &lt;!--æ’ç»™header--&gt;</span><br><span class="line">        &lt;div&gt;æ’æ§½å†…å®¹1&lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">        &lt;template v-slot:footer&gt; &lt;!--æ’ç»™footer--&gt;</span><br><span class="line">        &lt;div&gt;æ’æ§½å†…å®¹2&lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">    &lt;/Button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>å­ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;slot name=&quot;header&quot;&gt;&lt;/slot&gt;</span><br><span class="line">&lt;div&gt;å­ç»„ä»¶å†…å®¹&lt;/div&gt;</span><br><span class="line">&lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>æ¸²æŸ“ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;div&gt;æ’æ§½å†…å®¹1&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;å­ç»„ä»¶å†…å®¹&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;æ’æ§½å†…å®¹2&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h4 id="æ¡ä»¶æ’æ§½"><a href="#æ¡ä»¶æ’æ§½" class="headerlink" title="æ¡ä»¶æ’æ§½"></a>æ¡ä»¶æ’æ§½</h4><p>çˆ¶ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">&lt;Button&gt; &lt;!--å¼•ç”¨å­ç»„ä»¶--&gt;</span><br><span class="line">        &lt;template #header&gt; &lt;!--æ’ç»™header--&gt;</span><br><span class="line">        &lt;div&gt;æ’æ§½å†…å®¹1&lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">        &lt;template v-slot:footer&gt; &lt;!--æ’ç»™footer--&gt;</span><br><span class="line">        &lt;div&gt;æ’æ§½å†…å®¹2&lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">    &lt;/Button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>å­ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div v-if=&quot;$slots.header&quot;&gt;</span><br><span class="line">&lt;div&gt;æ ‡é¢˜&lt;/div&gt;</span><br><span class="line">&lt;slot name=&quot;header&quot;&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div v-if=&quot;$slots.footer&quot;&gt;</span><br><span class="line">&lt;div&gt;è„šæ³¨&lt;/div&gt;</span><br><span class="line">&lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>æ¸²æŸ“ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div&gt;æ ‡é¢˜&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;æ’æ§½å†…å®¹1&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div&gt;è„šæ³¨&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;æ’æ§½å†…å®¹2&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h3 id="transition"><a href="#transition" class="headerlink" title="transition"></a>transition</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h3 id="transition-group"><a href="#transition-group" class="headerlink" title="transition-group"></a>transition-group</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h2><h3 id="definePropsâ­"><a href="#definePropsâ­" class="headerlink" title="definePropsâ­"></a>definePropsâ­</h3><blockquote><p>å­è·å–çˆ¶çš„ä¼ å€¼</p></blockquote><p><strong>å­ç»„ä»¶</strong></p><blockquote><p>æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Props</span> &#123;</span><br><span class="line"><span class="attr">tag</span>?: <span class="built_in">string</span></span><br><span class="line"><span class="attr">type</span>?: <span class="string">&#x27;primary&#x27;</span> | <span class="string">&#x27;success&#x27;</span> | <span class="string">&#x27;warning&#x27;</span> | <span class="string">&#x27;danger&#x27;</span> | <span class="string">&#x27;info&#x27;</span></span><br><span class="line"><span class="attr">useThrottle</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = defineProps&lt;<span class="title class_">Props</span>&gt;()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;component</span><br><span class="line">:is=&quot;props.tag || &#x27;button&#x27;&quot;</span><br><span class="line">ref=&quot;_ref&quot;</span><br><span class="line">:type=&quot;props.nativeType || &#x27;button&#x27;&quot;</span><br><span class="line">@click=&quot;</span><br><span class="line">           (e: MouseEvent) =&gt;</span><br><span class="line">           props.useThrottle !== false ? handleBtneCLickThrottle(e) : handleBtnClick(e)&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/component&gt;</span><br></pre></td></tr></table></figure><p><strong>çˆ¶ç»„ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;vr-... tag=&quot;a&quot; type=&quot;primary&quot; :use-throttle=&quot;true&quot; /&gt;</span><br></pre></td></tr></table></figure><h3 id="withDefaults"><a href="#withDefaults" class="headerlink" title="withDefaults"></a>withDefaults</h3><blockquote><p>ç»™ <code>defineProps</code> ç»‘å®š<strong>é»˜è®¤å€¼</strong></p></blockquote><blockquote><p>æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> ...<span class="title class_">Props</span>&#123;</span><br><span class="line">    <span class="attr">tag</span>?: <span class="built_in">string</span> | <span class="title class_">Component</span></span><br><span class="line">    <span class="attr">size</span>?: <span class="string">&#x27;default&#x27;</span> | <span class="string">&#x27;large&#x27;</span> | <span class="string">&#x27;small&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">withDefaults</span>(defineProps&lt;...<span class="title class_">Props</span>&gt;(),&#123;</span><br><span class="line">    <span class="attr">tag</span>?: <span class="string">&quot;button&quot;</span></span><br><span class="line">    <span class="attr">size</span>?: <span class="keyword">default</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Emits"><a href="#Emits" class="headerlink" title="Emits"></a>Emits</h2><h3 id="defineEmits"><a href="#defineEmits" class="headerlink" title="defineEmits"></a>defineEmits</h3><blockquote><p>å­å‘çˆ¶å‘å°„äº‹ä»¶</p></blockquote><blockquote><p>æ¥å£ (å‡½æ•°ç­¾åç±»å‹)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ...<span class="title class_">Emits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&#x27;click&#x27;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p><strong>å­ç»„ä»¶</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emits = defineEmits&lt;...<span class="title class_">Emits</span>&gt;()</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handle...<span class="title class_">Click</span> = <span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">MouseEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">emits</span>(<span class="string">&#x27;click&#x27;</span>, e)<span class="comment">//å‘å°„&#x27;click&#x27;äº‹ä»¶ | çˆ¶ç»„ä»¶é€šè¿‡@clickå“åº”åˆ°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;component @click=&quot;(e: MouseEvent) =&gt; handle...Click(e)&quot;&gt;</span><br></pre></td></tr></table></figure><p><strong>çˆ¶ç»„ä»¶</strong> ç”¨æˆ·ä½¿ç”¨ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;vr-... @click=&quot;Click&quot; /&gt;</span><br><span class="line">//å½“æ¥æ”¶åˆ°å­ç»„ä»¶å‘å°„è¿‡æ¥çš„äº‹ä»¶ä¹‹åï¼Œè§¦å‘çˆ¶ç»„ä»¶è‡ªå·±çš„&#x27;Click&#x27;å‡½æ•°</span><br></pre></td></tr></table></figure><blockquote><p>1.ç‚¹å‡»å å­ç»„ä»¶çš„ <code>@click</code> è¢«è§¦å‘ï¼Œå°†ä¸€ä¸ª <code>MouseEvent</code> ç±»å‹äº‹ä»¶ä¼ å…¥ <code>handle...Click</code> å‡½æ•°</p><p>2.<code>emits(&#39;click&#39;, e)</code> å‘çˆ¶ç»„ä»¶å‘å°„ <code>&#39;click&#39;</code> äº‹ä»¶</p><p>3.çˆ¶ç»„ä»¶é€šè¿‡@click å“åº”åˆ° <code>&#39;click&#39;</code> äº‹ä»¶, å¼€å§‹æ‰§è¡Œçˆ¶ç»„ä»¶ä¸­è‡ªå®šä¹‰çš„ <code>Click</code> äº‹ä»¶</p></blockquote><h2 id="Slots"><a href="#Slots" class="headerlink" title="Slots"></a>Slots</h2><h3 id="defineSlots"><a href="#defineSlots" class="headerlink" title="defineSlots"></a>defineSlots</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> slots = <span class="title function_">defineSlots</span>()</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> iconStyle = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line"><span class="attr">marginRight</span>: slots.<span class="property">default</span> ? <span class="string">&#x27;6px&#x27;</span> : <span class="string">&#x27;0px&#x27;</span>,</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><blockquote><p>æ£€æµ‹ç»„ä»¶æ˜¯å¦æœ‰<slot>é»˜è®¤æ’æ§½, æœ‰åˆ™æ’å…¥æ ·å¼ <code>marginRight: 6px</code></p></blockquote><h2 id="Expose"><a href="#Expose" class="headerlink" title="Expose"></a>Expose</h2><h3 id="defineExporse"><a href="#defineExporse" class="headerlink" title="defineExporse"></a>defineExporse</h3><blockquote><p>æš´éœ²ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€å’Œæ–¹æ³•ï¼Œä¾›çˆ¶ç»„ä»¶é€šè¿‡ ref è®¿é—®</p><blockquote><p>åœ¨ <code>&lt;script setup&gt;</code> ä¸­ï¼Œå¦‚æœä¸ä½¿ç”¨ <code>defineExpose</code>ï¼Œçˆ¶ç»„ä»¶æ— æ³•é€šè¿‡ <code>ref</code> è®¿é—®å­ç»„ä»¶çš„ä»»ä½•å†…éƒ¨çŠ¶æ€æˆ–æ–¹æ³•</p></blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">defineExpose&lt;<span class="title class_">ButtonInstance</span>&gt;(&#123;</span><br><span class="line"><span class="attr">ref</span>: _ref,</span><br><span class="line">disabled,</span><br><span class="line">size,</span><br><span class="line"><span class="keyword">type</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>çˆ¶ç»„ä»¶å¯ä»¥é€šè¿‡ <code>ref</code> è®¿é—®è¿™äº›æš´éœ²çš„å±æ€§ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;VrButton ref=&quot;buttonRef&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const buttonRef = ref(null)</span><br><span class="line"></span><br><span class="line">const checkButtonState = () =&gt; &#123;</span><br><span class="line">console.log(&#x27;æŒ‰é’®æ˜¯å¦ç¦ç”¨:&#x27;, buttonRef.value.disabled)</span><br><span class="line">console.log(&#x27;æŒ‰é’®ç±»å‹:&#x27;, buttonRef.value.type)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="ä¸“ä¸šåè¯"><a href="#ä¸“ä¸šåè¯" class="headerlink" title="ä¸“ä¸šåè¯"></a>ä¸“ä¸šåè¯</h2><h3 id="å·¥å…·é“¾"><a href="#å·¥å…·é“¾" class="headerlink" title="å·¥å…·é“¾"></a>å·¥å…·é“¾</h3><h4 id="æ„å»ºå·¥å…·"><a href="#æ„å»ºå·¥å…·" class="headerlink" title="æ„å»ºå·¥å…·"></a>æ„å»ºå·¥å…·</h4><ul><li><p><strong>Vite</strong> æˆ– <strong>Webpack</strong>:</p><blockquote><p>è¿™äº›æ˜¯æ¨¡å—æ‰“åŒ…å·¥å…·</p><p>è´Ÿè´£å°†ä½ çš„ Vue é¡¹ç›®ä¸­çš„å„ç§**<em>èµ„æº</em><strong>ï¼ˆå¦‚ JavaScriptã€CSSã€å›¾ç‰‡ç­‰ï¼‰</strong><em>æ‰“åŒ…æˆæµè§ˆå™¨å¯ä»¥ç†è§£çš„å½¢å¼</em>**ã€‚</p><p>Vite ä½œä¸ºæ–°ä¸€ä»£çš„æ„å»ºå·¥å…·ï¼Œä»¥å…¶å¿«é€Ÿçš„å†·å¯åŠ¨å’Œçƒ­æ›´æ–°ç‰¹æ€§è€Œå—åˆ°æ¬¢è¿ã€‚</p></blockquote></li></ul><h4 id="ç¼–è¯‘å™¨"><a href="#ç¼–è¯‘å™¨" class="headerlink" title="ç¼–è¯‘å™¨"></a>ç¼–è¯‘å™¨</h4><ul><li><p><strong>Vue ç¼–è¯‘å™¨</strong>:</p><blockquote><p>Vue**<em>å•æ–‡ä»¶ç»„ä»¶</em><strong>ï¼ˆSFC, Single File Componentsï¼‰éœ€è¦</strong><em>è¢«ç¼–è¯‘ä¸ºæ™®é€š JavaScript</em>**æ‰èƒ½åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚Vue æä¾›äº†ä¸€ä¸ªç¼–è¯‘å™¨æ¥å®Œæˆè¿™é¡¹å·¥ä½œï¼Œå®ƒå¯ä»¥åœ¨æ„å»ºæ—¶ï¼ˆé€šè¿‡æ„å»ºå·¥å…·é…ç½®ï¼‰æˆ–è¿è¡Œæ—¶è¿›è¡Œç¼–è¯‘ã€‚</p></blockquote></li></ul><h4 id="Linter-å’Œ-Formatter"><a href="#Linter-å’Œ-Formatter" class="headerlink" title="Linter å’Œ Formatter"></a>Linter å’Œ Formatter</h4><ul><li><p><strong>ESLint</strong>, <strong>Prettier</strong>:</p><blockquote><p>è¿™äº›å·¥å…·å¸®åŠ©**<em>ä¿æŒä»£ç é£æ ¼çš„ä¸€è‡´æ€§</em><strong>å’Œ</strong><em>æ•è·æ½œåœ¨çš„é”™è¯¯</em>**ã€‚</p><p>ESLint æ˜¯ä¸€ä¸ªæµè¡Œçš„ JavaScript linterï¼Œå¯ä»¥å¸®åŠ©ä½ **<em>å‘ç°</em><strong>ä»£ç ä¸­çš„</strong><em>é—®é¢˜</em>**ï¼›</p><p>Prettier åˆ™æ˜¯ä¸€ä¸ªä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œèƒ½å¤Ÿ**<em>è‡ªåŠ¨æ ¼å¼åŒ–</em>**ä½ çš„ä»£ç ä»¥ç¬¦åˆé¢„å®šä¹‰çš„é£æ ¼æŒ‡å—ã€‚</p></blockquote></li></ul><h4 id="çŠ¶æ€ç®¡ç†"><a href="#çŠ¶æ€ç®¡ç†" class="headerlink" title="çŠ¶æ€ç®¡ç†"></a>çŠ¶æ€ç®¡ç†</h4><ul><li><p><strong>Vuex, Pinia</strong>:</p><blockquote><p>Vuex æ˜¯ Vue.js çš„çŠ¶æ€ç®¡ç†æ¨¡å¼+åº“ã€‚</p><p>å®ƒå……å½“åº”ç”¨ä¸­**<em>æ‰€æœ‰ç»„ä»¶çš„é›†ä¸­å­˜å‚¨</em>**ï¼Œç¡®ä¿çŠ¶æ€ä»¥ä¸€ç§å¯é¢„æµ‹çš„æ–¹å¼å‘ç”Ÿå˜åŒ–ã€‚</p></blockquote></li></ul><h4 id="è·¯ç”±ç®¡ç†"><a href="#è·¯ç”±ç®¡ç†" class="headerlink" title="è·¯ç”±ç®¡ç†"></a>è·¯ç”±ç®¡ç†</h4><ul><li><p><strong>Vue Router</strong>:</p><blockquote><p>å®˜æ–¹çš„è·¯ç”±ç®¡ç†å™¨ï¼Œä¸ Vue.js æ ¸å¿ƒæ·±åº¦é›†æˆã€‚</p><p>ç”¨äºå®ç° SPAï¼ˆå•é¡µé¢åº”ç”¨ï¼‰ä¸­çš„**<em>å¯¼èˆª</em>**åŠŸèƒ½ã€‚</p></blockquote></li></ul><h4 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><ul><li><p><strong>Jest</strong>, <strong>Mocha</strong>, <strong>Vue Test Utils</strong>:</p><blockquote><p>ä½¿ç”¨è¿™äº›å·¥å…·å¯ä»¥å¯¹ Vue ç»„ä»¶è¿›è¡Œ**<em>å•å…ƒæµ‹è¯•</em>**ï¼Œç¡®ä¿å„ä¸ªéƒ¨åˆ†æŒ‰é¢„æœŸå·¥ä½œã€‚</p><p>Vue Test Utils æ˜¯ç”± Vue å®˜æ–¹æä¾›çš„ä¸€ä¸ªæµ‹è¯•å®ç”¨åº“ï¼Œç®€åŒ–äº† Vue ç»„ä»¶çš„æµ‹è¯•è¿‡ç¨‹ã€‚</p></blockquote></li></ul><h4 id="å¼€å‘æœåŠ¡å™¨"><a href="#å¼€å‘æœåŠ¡å™¨" class="headerlink" title="å¼€å‘æœåŠ¡å™¨"></a>å¼€å‘æœåŠ¡å™¨</h4><ul><li><p><strong>å†…ç½®å¼€å‘æœåŠ¡å™¨</strong>:</p><blockquote><p>Vite å’Œ Webpack éƒ½æä¾›äº†å†…ç½®çš„å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒ**<em>çƒ­é‡è½½</em>**ï¼ˆHMR, Hot Module Replacementï¼‰</p><p>è¿™æ„å‘³ç€å½“ä½ ä¿®æ”¹ä»£ç æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºæœ€æ–°çš„æ›´æ”¹ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°æ•´ä¸ªé¡µé¢ã€‚</p></blockquote></li></ul><h4 id="CSS-é¢„å¤„ç†å™¨"><a href="#CSS-é¢„å¤„ç†å™¨" class="headerlink" title="CSS é¢„å¤„ç†å™¨"></a>CSS é¢„å¤„ç†å™¨</h4><ul><li><p><strong>Sass</strong>, <strong>Less</strong>, <strong>Stylus</strong>:</p><blockquote><p>æµè¡Œçš„ CSS é¢„å¤„ç†å™¨ï¼Œå…è®¸ä½ **<em>ç”¨æ›´å¼ºå¤§çš„è¯­æ³•ç¼–å†™æ ·å¼</em>**ï¼Œå¹¶ä¸”é€šè¿‡æ„å»ºå·¥å…·é›†æˆåˆ° Vue é¡¹ç›®ä¸­ã€‚</p></blockquote></li></ul><h3 id="SSR"><a href="#SSR" class="headerlink" title="SSR"></a>SSR</h3><h4 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h4><p>æœåŠ¡ç«¯æ¸²æŸ“ (Server-Side Rendering)</p><p>ç›¸å¯¹ä¼ ç»Ÿå®¢æˆ·ç«¯æ¸²æŸ“(CSR, Client-Side Rendering)çš„ <strong>ä¼˜åŠ¿</strong></p><ol><li><strong>æ›´å¥½çš„ SEO</strong>ï¼šæœåŠ¡å™¨ç«¯ç›´æ¥è¿”å›å®Œæ•´çš„ HTMLï¼Œæœç´¢å¼•æ“å¯ä»¥è½»æ¾æŠ“å–é¡µé¢å†…å®¹ã€‚</li><li><strong>æ›´å¿«çš„é¦–å±åŠ è½½</strong>ï¼šç”¨æˆ·å¯ä»¥ç›´æ¥çœ‹åˆ°æ¸²æŸ“å¥½çš„ HTMLï¼Œæ— éœ€ç­‰å¾… JavaScript åŠ è½½å®Œæˆã€‚</li><li><strong>æ›´ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒ</strong>ï¼šæ— è®ºç”¨æˆ·çš„è®¾å¤‡æ€§èƒ½å¦‚ä½•ï¼Œéƒ½å¯ä»¥å¿«é€Ÿçœ‹åˆ°é¡µé¢å†…å®¹ã€‚</li></ol><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><blockquote><p>æ ¸å¿ƒæ€æƒ³: åœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆ HTMLï¼Œå¹¶å°†å…¶å‘é€åˆ°å®¢æˆ·ç«¯</p></blockquote><table><thead><tr><th><strong><em>å®Œæ•´æµç¨‹</em></strong></th></tr></thead><tbody><tr><td>ç”¨æˆ·è®¿é—®ä¸€ä¸ª URLï¼Œ<strong>è¯·æ±‚</strong> â†’ <strong>æœåŠ¡å™¨</strong></td></tr><tr><td>æœåŠ¡å™¨ render HTMLï¼Œ<strong>å®Œæ•´çš„ HTML å­—ç¬¦ä¸²</strong> â†’ <strong>å®¢æˆ·ç«¯</strong></td></tr><tr><td>ç”¨æˆ·ç«‹å³å¯ä»¥çœ‹åˆ°é¡µé¢å†…å®¹ï¼ˆæ­¤æ—¶é¡µé¢é™æ€ï¼Œæ— æ³•å“åº”ç”¨æˆ·çš„äº¤äº’ï¼‰</td></tr><tr><td>æµè§ˆå™¨ç»§ç»­åŠ è½½ Vue åº”ç”¨çš„å®¢æˆ·ç«¯ JS æ–‡ä»¶(é€šå¸¸æ˜¯ <code>client-bundle.js</code>), è¿™ä¸ªæ–‡ä»¶åŒ…å«äº† Vue çš„è¿è¡Œæ—¶ä»£ç ä»¥åŠåº”ç”¨çš„é€»è¾‘</td></tr><tr><td><strong>Hydration æ°´åˆé˜¶æ®µä¸€</strong>ï¼šå®¢æˆ·ç«¯ JS è§£æ HTMLï¼Œå°†ç°æœ‰çš„ <strong>DOM</strong> èŠ‚ç‚¹ **åŒ¹é… Vue ç»„ä»¶æ¨¡æ¿ **</td></tr><tr><td><strong>Hydration æ°´åˆé˜¶æ®µäºŒ</strong>ï¼šVue åœ¨åŒ¹é…çš„ <strong>DOM</strong> èŠ‚ç‚¹ä¸Š <strong>ç»‘å®šäº‹ä»¶ç›‘å¬å™¨</strong>ï¼ˆå¦‚ <code>click</code>ã€<code>input</code> ç­‰ï¼‰ï¼Œä½¿é¡µé¢èƒ½å¤Ÿå“åº”ç”¨æˆ·çš„æ“ä½œã€‚</td></tr><tr><td>Vue é‡æ–° <strong>åˆå§‹åŒ–ç»„ä»¶</strong> çš„ <strong>çŠ¶æ€</strong>ï¼ˆå¦‚ <code>data</code>ã€<code>computed</code>ã€<code>methods</code> ç­‰ï¼‰ï¼Œå¹¶å°†å…¶ä¸ DOM å…³è”èµ·æ¥ã€‚å¦‚æœæœåŠ¡ç«¯å·²ç»é¢„å–äº†æ•°æ®ï¼ˆå¦‚é€šè¿‡ Vuex æˆ– Piniaï¼‰ï¼Œè¿™äº›æ•°æ®ä¼šè¢«åŒæ­¥åˆ°å®¢æˆ·ç«¯ï¼Œç¡®ä¿çŠ¶æ€ä¸€è‡´æ€§ã€‚</td></tr><tr><td>é¡µé¢ä¸Šçš„æ¯ä¸ªå…ƒç´ ä»æ­¤éƒ½è¢« Vue æ¥ç®¡ï¼Œç”¨æˆ·å¯ä»¥ä¸é¡µé¢è¿›è¡Œäº¤äº’</td></tr></tbody></table><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ol><li><strong>é«˜æ•ˆåˆ©ç”¨ç°æœ‰ DOM</strong><ul><li>Hydration ä¸ä¼šé‡æ–°åˆ›å»º DOM èŠ‚ç‚¹ï¼Œè€Œæ˜¯ç›´æ¥å¤ç”¨æœåŠ¡å™¨ç”Ÿæˆçš„ HTMLã€‚</li><li>è¿™æ ·å¯ä»¥é¿å…é‡å¤æ¸²æŸ“ï¼Œæå‡æ€§èƒ½ã€‚</li></ul></li><li><strong>ä¾èµ–äºä¸€è‡´çš„ HTML ç»“æ„</strong><ul><li>æœåŠ¡ç«¯ç”Ÿæˆçš„ HTML å¿…é¡»ä¸å®¢æˆ·ç«¯çš„ç»„ä»¶æ¨¡æ¿å®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™ Hydration ä¼šå¤±è´¥ã€‚</li><li>å¦‚æœæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„ HTML ä¸ä¸€è‡´ï¼ŒVue ä¼šæŠ›å‡ºè­¦å‘Šæˆ–é”™è¯¯ã€‚</li></ul></li><li><strong>æ¸è¿›å¼å¢å¼º</strong><ul><li>Hydration æ˜¯ä¸€ç§æ¸è¿›å¼å¢å¼ºçš„æŠ€æœ¯ï¼šå³ä½¿ JavaScript åŠ è½½å¤±è´¥ï¼Œç”¨æˆ·ä»ç„¶å¯ä»¥çœ‹åˆ°é™æ€é¡µé¢å†…å®¹ï¼ˆè™½ç„¶æ²¡æœ‰äº¤äº’æ€§ï¼‰ã€‚</li></ul></li></ol><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4>]]></content>
      
      
      <categories>
          
          <category> ç»„ä»¶åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PostCSS</title>
      <link href="/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/PostCSS/"/>
      <url>/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/PostCSS/</url>
      
        <content type="html"><![CDATA[<h1 id="PostCSS"><a href="#PostCSS" class="headerlink" title="PostCSS"></a>PostCSS</h1><p><a href="https://www.postcss.com.cn/">PostCSSä¸­æ–‡ç½‘</a></p><blockquote><p>å¤„ç†CSSä»£ç çš„å·¥å…·ï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„æ’ä»¶æ¥å®ç°æœ€æ–°çš„CSSç‰¹æ€§</p></blockquote><h2 id="æ’ä»¶ä»‹ç»"><a href="#æ’ä»¶ä»‹ç»" class="headerlink" title="æ’ä»¶ä»‹ç»"></a>æ’ä»¶ä»‹ç»</h2><h3 id="Autoprefixer"><a href="#Autoprefixer" class="headerlink" title="Autoprefixer"></a>Autoprefixer</h3><blockquote><p>å…¼å®¹å„ç§æµè§ˆå™¨ç‰¹æœ‰çš„å‰ç¼€</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">box-sizing: border-box;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-webkit-box-sizing</span><br><span class="line">-moz-box-sizing</span><br></pre></td></tr></table></figure><h3 id="PostCSS-Preset-Env"><a href="#PostCSS-Preset-Env" class="headerlink" title="PostCSS-Preset-Env"></a>PostCSS-Preset-Env</h3><blockquote><p>ä½¿ç”¨æœ€æ–°çš„CSSç‰¹æ€§ï¼Œè½¬ç§»ä¸ºä¸»æµæµè§ˆå™¨æ”¯æŒçš„ç‰ˆæœ¬</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#000000</span>;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">        <span class="attribute">background</span>: <span class="number">#000000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="number">#000000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Autoprefixer-1"><a href="#Autoprefixer-1" class="headerlink" title="Autoprefixer"></a>Autoprefixer</h3><blockquote><p>å…¼å®¹å„ç§æµè§ˆå™¨ç‰¹æœ‰çš„å‰ç¼€</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">box-sizing: border-box;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-webkit-box-sizing</span><br><span class="line">-moz-box-sizing</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ¢ç´¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vueæ’ä»¶å¼€å‘</title>
      <link href="/2025/04/03/%E5%A4%A7%E5%89%8D%E7%AB%AF/Vue%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
      <url>/2025/04/03/%E5%A4%A7%E5%89%8D%E7%AB%AF/Vue%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="Plugins-å¼€å‘"><a href="#Plugins-å¼€å‘" class="headerlink" title="Plugins å¼€å‘"></a>Plugins å¼€å‘</h1><p><a href="https://cn.vuejs.org/guide/reusability/plugins.html">æ’ä»¶ | Vue.js</a></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Vue3ä¸­ï¼Œä¸€ä¸ªæ’ä»¶é€šå¸¸æ˜¯ä¸€ä¸ªå¯¹è±¡</p><p>é€šå¸¸æˆ‘ä»¬å¼€å‘çš„æ’ä»¶é€šè¿‡å…¨å±€å¯¼å‡º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> myPlugin</span><br></pre></td></tr></table></figure><p>ä»è€Œåœ¨é¡¹ç›®çš„å…¥å£æ–‡ä»¶ä¸­ä½¿ç”¨</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(myPlugin)</span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€å¼€å‘"><a href="#åŸºç¡€å¼€å‘" class="headerlink" title="åŸºç¡€å¼€å‘"></a>åŸºç¡€å¼€å‘</h2><h3 id="plugins"><a href="#plugins" class="headerlink" title="plugins&#x2F;"></a>plugins&#x2F;</h3><h4 id="MyButton-vue"><a href="#MyButton-vue" class="headerlink" title="MyButton.vue"></a>MyButton.vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;button&gt;æˆ‘çš„æŒ‰é’®&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="index-ts"><a href="#index-ts" class="headerlink" title="index.ts"></a>index.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">MyButton</span> <span class="keyword">from</span> <span class="string">&#x27;./MyButton.vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="attr">install</span>:<span class="function">(<span class="params">app,options</span>)=&gt;</span>&#123;</span><br><span class="line">        app.<span class="title function_">component</span>(<span class="string">&#x27;myButton&#x27;</span>, <span class="title class_">MyButton</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="main-js"><a href="#main-js" class="headerlink" title="main.js"></a>main.js</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">MyButton</span> <span class="keyword">from</span> <span class="string">&#x27;./plugins/MyButton.ts&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">create</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(<span class="title class_">MyButton</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Views"><a href="#Views" class="headerlink" title="Views&#x2F;"></a>Views&#x2F;</h3><h4 id="Helloworld-vue"><a href="#Helloworld-vue" class="headerlink" title="Helloworld.vue"></a>Helloworld.vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&quot;home&quot;&gt;</span><br><span class="line">        &lt;myButton&gt;&lt;/myButton&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h2 id="å¤šæ’ä»¶å¼€å‘"><a href="#å¤šæ’ä»¶å¼€å‘" class="headerlink" title="å¤šæ’ä»¶å¼€å‘"></a>å¤šæ’ä»¶å¼€å‘</h2><h3 id="components"><a href="#components" class="headerlink" title="components&#x2F;"></a>components&#x2F;</h3><h4 id="Button"><a href="#Button" class="headerlink" title="Button&#x2F;"></a>Button&#x2F;</h4><h5 id="MyButton-vue-1"><a href="#MyButton-vue-1" class="headerlink" title="MyButton.vue"></a>MyButton.vue</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;button&gt;æˆ‘çš„æŒ‰é’®&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h5 id="MyButtonGroup-vue"><a href="#MyButtonGroup-vue" class="headerlink" title="MyButtonGroup.vue"></a>MyButtonGroup.vue</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;er-button-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="index-ts-1"><a href="#index-ts-1" class="headerlink" title="index.ts"></a>index.ts</h5><blockquote><p>å¯¼å‡º <code>MyButton</code> å’Œ <code>MyButtonGroup</code> ç»„ä»¶</p><p>ä½¿ç”¨ <code>withInstall</code> å‡½æ•°ä¸ºå®ƒä»¬æ·»åŠ å®‰è£…æ–¹æ³•</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Button</span> <span class="keyword">from</span> <span class="string">&quot;./MyButton.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ButtonGroup</span> <span class="keyword">from</span> <span class="string">&quot;./MyButtonGroup.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@tyche/utils&quot;</span>; <span class="comment">//åœ¨ install.ts é‡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErButton</span> = <span class="title function_">withInstall</span>(<span class="title class_">Button</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErButtonGroup</span> = <span class="title function_">withInstall</span>(<span class="title class_">ButtonGroup</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="utils"><a href="#utils" class="headerlink" title="utils&#x2F;"></a>utils&#x2F;</h3><h4 id="install-ts"><a href="#install-ts" class="headerlink" title="install.ts"></a>install.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">App</span>, <span class="title class_">Plugin</span>, <span class="title class_">Directive</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="comment">//Appï¼ˆVue åº”ç”¨å®ä¾‹ï¼‰ã€Pluginï¼ˆæ’ä»¶æ¥å£ï¼‰ã€Directiveï¼ˆè‡ªå®šä¹‰æŒ‡ä»¤ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> &#123; noop &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="comment">//ç©ºå‡½æ•°ï¼Œé€šå¸¸ç”¨äºå ä½ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt; = T &amp; <span class="title class_">Plugin</span>;<span class="comment">//å°†ä»»æ„ç±»å‹ T ä¸ Plugin æ¥å£åˆå¹¶</span></span><br><span class="line"><span class="comment">//ä»»ä½•å®ç°äº†è¿™ä¸ªç±»å‹çš„å¯¹è±¡ä¸ä»…å…·æœ‰åŸå§‹ç±»å‹ T çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line"><span class="comment">//è¿˜éœ€è¦å®ç° Plugin æ¥å£ä¸­çš„ install æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withInstall = &lt;T&gt;<span class="function">(<span class="params"><span class="attr">component</span>: T</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//ğŸ‘‡å°†ä¼ å…¥çš„ç»„ä»¶è½¬æ¢ä¸º SFCWithInstall&lt;T&gt; ç±»å‹ï¼Œå¹¶ä¸ºå…¶æ·»åŠ  install æ–¹æ³•</span></span><br><span class="line">    (component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;).<span class="property">install</span> = <span class="function">(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt;</span> &#123;<span class="comment">//ä¸ºcomponentæ·»åŠ installæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªappåº”ç”¨å®ä¾‹</span></span><br><span class="line">        <span class="keyword">const</span> name = (component <span class="keyword">as</span> <span class="built_in">any</span>)?.<span class="property">name</span> || <span class="string">&quot;UnnamedComponent&quot;</span>;<span class="comment">//è·å–ç»„ä»¶çš„åç§°ã€‚å¦‚æœç»„ä»¶æ²¡æœ‰å®šä¹‰ name å±æ€§ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ &quot;UnnamedComponent&quot;</span></span><br><span class="line">        app.<span class="title function_">component</span>(name, component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;);<span class="comment">//ä½¿ç”¨åº”ç”¨å®ä¾‹çš„æ–¹æ³• .component() å…¨å±€æ³¨å†Œè¯¥ç»„ä»¶åï¼Œå°±å¯ä»¥åœ¨åº”ç”¨çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ã€‚</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;;<span class="comment">//è¿”å›ç»è¿‡æ‰©å±•åçš„ç»„ä»¶å¯¹è±¡</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="style-ts"><a href="#style-ts" class="headerlink" title="style.ts"></a>style.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isNumber, isString &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; debugWarn &#125; <span class="keyword">from</span> <span class="string">&quot;./error&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SCOPE</span> = <span class="string">&quot;utils/style&quot;</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isStringNumber = (<span class="attr">val</span>: <span class="built_in">string</span>): <span class="function"><span class="params">boolean</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isString</span>(val)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> !<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="title class_">Number</span>(val));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">addUnit</span>(<span class="params"><span class="attr">value</span>?: <span class="built_in">string</span> | <span class="built_in">number</span>, defaultUnit = <span class="string">&quot;px&quot;</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!value) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isNumber</span>(value) || <span class="title function_">isStringNumber</span>(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;value&#125;</span><span class="subst">$&#123;defaultUnit&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isString</span>(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">debugWarn</span>(<span class="variable constant_">SCOPE</span>, <span class="string">&quot;binding value must be a string or number&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="error-ts"><a href="#error-ts" class="headerlink" title="error.ts"></a>error.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isString &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ErUIError</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">message</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(message);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;ErUIError&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">throwError</span>(<span class="params"><span class="attr">scope</span>: <span class="built_in">string</span>, <span class="attr">msg</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ErUIError</span>(<span class="string">`[<span class="subst">$&#123;scope&#125;</span>] <span class="subst">$&#123;msg&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debugWarn</span>(<span class="params"><span class="attr">error</span>: <span class="title class_">Error</span></span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debugWarn</span>(<span class="params"><span class="attr">scope</span>: <span class="built_in">string</span>, <span class="attr">msg</span>: <span class="built_in">string</span></span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debugWarn</span>(<span class="params"><span class="attr">scope</span>: <span class="built_in">string</span> | <span class="title class_">Error</span>, <span class="attr">msg</span>?: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&quot;production&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> err = <span class="title function_">isString</span>(scope) ? <span class="keyword">new</span> <span class="title class_">ErUIError</span>(<span class="string">`[<span class="subst">$&#123;scope&#125;</span>] <span class="subst">$&#123;msg&#125;</span>`</span>) : scope;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">warn</span>(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="index-ts-2"><a href="#index-ts-2" class="headerlink" title="index.ts"></a>index.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./install&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isFunction &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">RenderVnode</span> = <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">vNode</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: [<span class="title class_">String</span>, <span class="title class_">Object</span>, <span class="title class_">Function</span>],</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> (<span class="title function_">isFunction</span>(props.<span class="property">vNode</span>) ? props.<span class="title function_">vNode</span>() : props.<span class="property">vNode</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> typeIconMap = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">  [<span class="string">&quot;info&quot;</span>, <span class="string">&quot;circle-info&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;success&quot;</span>, <span class="string">&quot;check-circle&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;warning&quot;</span>, <span class="string">&quot;circle-exclamation&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;danger&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./install&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./error&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./style&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="core"><a href="#core" class="headerlink" title="core&#x2F;"></a>core&#x2F;</h3><h4 id="componens-ts"><a href="#componens-ts" class="headerlink" title="componens.ts"></a>componens.ts</h4><blockquote><p>é›†åˆæ‰€æœ‰éœ€è¦å…¨å±€æ³¨å†Œçš„ç»„ä»¶ï¼Œå¹¶å°†å…¶ä½œä¸ºä¸€ä¸ªæ’ä»¶æ•°ç»„å¯¼å‡º</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    <span class="title class_">ErButton</span>,</span><br><span class="line">    <span class="title class_">ErButtonGroup</span>,</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;@tyche/components&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Plugin</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">    <span class="title class_">ErButton</span>,</span><br><span class="line">    <span class="title class_">ErButtonGroup</span>,</span><br><span class="line">    ...</span><br><span class="line">] <span class="keyword">as</span> <span class="title class_">Plugin</span>[]</span><br></pre></td></tr></table></figure><h4 id="makeInstaller-ts"><a href="#makeInstaller-ts" class="headerlink" title="makeInstaller.ts"></a>makeInstaller.ts</h4><blockquote><p>åˆ›å»ºä¸€ä¸ªé€šç”¨çš„å®‰è£…å™¨ï¼Œç”¨äºæ‰¹é‡å®‰è£…ç»„ä»¶</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">App</span>, <span class="title class_">Plugin</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">INSTALLED_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@tyche/constants&quot;</span>;<span class="comment">//æ ‡è®°åº”ç”¨æ˜¯å¦å·²ç»å®‰è£…è¿‡ç»„ä»¶åº“</span></span><br><span class="line"><span class="keyword">import</span> &#123; each, get, set &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="comment">//éå†/è·å–/è®¾ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¼ å…¥ç»„ä»¶</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">makeInstaller</span>(<span class="params"><span class="attr">components</span>: <span class="title class_">Plugin</span>[]</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">install</span> = (<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">get</span>(app, <span class="variable constant_">INSTALLED_KEY</span>)) <span class="keyword">return</span>;<span class="comment">//app å¯¹è±¡ä¸­å­˜åœ¨ INSTALLED_KEY å±æ€§ï¼Œè¯´æ˜ç»„ä»¶åº“å·²ç»å®‰è£…è¿‡ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="title function_">set</span>(app, <span class="variable constant_">INSTALLED_KEY</span>, <span class="literal">true</span>);<span class="comment">//ä½¿ç”¨ set å°† INSTALLED_KEY è®¾ç½®ä¸º trueï¼Œæ ‡è®°è¯¥åº”ç”¨å·²ç»å®‰è£…äº†ç»„ä»¶åº“</span></span><br><span class="line"></span><br><span class="line">        <span class="title function_">each</span>(components, <span class="function">(<span class="params">c</span>) =&gt;</span> &#123;<span class="comment">//éå†ä¼ å…¥çš„ components æ•°ç»„</span></span><br><span class="line">            app.<span class="title function_">use</span>(c);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> install;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨:ä»¥ä¸‹æ˜¯constants&#x2F;index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">INSTALLED_KEY</span> = <span class="title class_">Symbol</span>(<span class="string">&quot;INSTALLED_KEY&quot;</span>);</span><br></pre></td></tr></table></figure></blockquote><h4 id="index-ts-3"><a href="#index-ts-3" class="headerlink" title="index.ts"></a>index.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; library &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/fontawesome-svg-core&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fas &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/free-solid-svg-icons&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> makeInstaller <span class="keyword">from</span> <span class="string">&#x27;./makeInstaller&#x27;</span></span><br><span class="line"><span class="keyword">import</span> components <span class="keyword">from</span> <span class="string">&#x27;./components&#x27;</span></span><br><span class="line"><span class="keyword">import</span> printLogo <span class="keyword">from</span> <span class="string">&quot;./pringLogo&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@tyche/theme/index.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">printLogo</span>();</span><br><span class="line"></span><br><span class="line">library.<span class="title function_">add</span>(fas);</span><br><span class="line"><span class="keyword">const</span> installer = <span class="title function_">makeInstaller</span>(components);<span class="comment">//é€šç”¨çš„å®‰è£…å™¨ï¼Œç”¨æ¥æ‰¹é‡å®‰è£…ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;@tyche/components&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> installer</span><br></pre></td></tr></table></figure><h3 id="docs"><a href="#docs" class="headerlink" title="docs&#x2F;"></a>docs&#x2F;</h3><h4 id="components-1"><a href="#components-1" class="headerlink" title="components"></a>components</h4><h5 id="button-md"><a href="#button-md" class="headerlink" title="button.md"></a>button.md</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: Button</span><br><span class="line">description: Button ç»„ä»¶æ–‡æ¡£</span><br><span class="line"></span><br><span class="line">next:</span><br><span class="line">  link: /components/collapse</span><br><span class="line">  text: Collapse æŠ˜å é¢æ¿</span><br><span class="line"></span><br><span class="line">prev:</span><br><span class="line">  link: /get-started</span><br><span class="line"><span class="section">  text: å¿«é€Ÿå¼€å§‹</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line"><span class="section"># Button æŒ‰é’®</span></span><br><span class="line"></span><br><span class="line">å¸¸ç”¨çš„æ“ä½œæŒ‰é’®ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">## åŸºç¡€ç”¨æ³•</span></span><br><span class="line"></span><br><span class="line">ä½¿ç”¨ <span class="code">`type`</span>ã€<span class="code">`plain`</span>ã€ <span class="code">`round`</span>å’Œ <span class="code">`circle`</span>æ¥å®šä¹‰æŒ‰é’®çš„æ ·å¼ã€‚</span><br><span class="line"></span><br><span class="line">::: preview</span><br><span class="line">demo-preview=../demo/button/Basic.vue</span><br><span class="line">:::</span><br></pre></td></tr></table></figure><h4 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h4><h5 id="button"><a href="#button" class="headerlink" title="button"></a>button</h5><h6 id="Basic-vue"><a href="#Basic-vue" class="headerlink" title="Basic.vue"></a>Basic.vue</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    &lt;er-button&gt;Default&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;primary&quot;&gt;Primary&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;success&quot;&gt;Success&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;info&quot;&gt;Info&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;warning&quot;&gt;Warning&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;danger&quot;&gt;Danger&lt;/er-button&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    &lt;er-button plain&gt;Plain&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;primary&quot; plain&gt;Primary&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;success&quot; plain&gt;Success&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;info&quot; plain&gt;Info&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;warning&quot; plain&gt;Warning&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;danger&quot; plain&gt;Danger&lt;/er-button&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    &lt;er-button round&gt;Round&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;primary&quot; round&gt;Primary&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;success&quot; round&gt;Success&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;info&quot; round&gt;Info&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;warning&quot; round&gt;Warning&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;danger&quot; round&gt;Danger&lt;/er-button&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    &lt;er-button icon=&quot;search&quot; circle /&gt;</span><br><span class="line">    &lt;er-button type=&quot;primary&quot; icon=&quot;edit&quot; circle /&gt;</span><br><span class="line">    &lt;er-button type=&quot;success&quot; icon=&quot;check&quot; circle /&gt;</span><br><span class="line">    &lt;er-button type=&quot;info&quot; icon=&quot;message&quot; circle /&gt;</span><br><span class="line">    &lt;er-button type=&quot;warning&quot; icon=&quot;star&quot; circle /&gt;</span><br><span class="line">    &lt;er-button type=&quot;danger&quot; icon=&quot;trash&quot; circle /&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>npmå‘å¸ƒ</title>
      <link href="/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84npm/"/>
      <url>/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84npm/</url>
      
        <content type="html"><![CDATA[<h1 id="npmå‘å¸ƒ"><a href="#npmå‘å¸ƒ" class="headerlink" title="npmå‘å¸ƒ"></a>npmå‘å¸ƒ</h1><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>ä¸‹è½½nrm</p><blockquote><p>è¯¦æƒ…è§æ–‡ç« </p></blockquote><p>æ‰“å¼€npmå®˜ç½‘ <a href="https://www.npmjs.com/">npm | Home</a></p><blockquote><p>æˆ‘ä»¬éœ€è¦å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·</p></blockquote><h2 id="ä¸»æµç¨‹"><a href="#ä¸»æµç¨‹" class="headerlink" title="ä¸»æµç¨‹"></a>ä¸»æµç¨‹</h2><p>è½¬æ¢npmæº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm use npm</span><br></pre></td></tr></table></figure><p>è¿æ¥npmè´¦å·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm login</span><br></pre></td></tr></table></figure><p>ç¡®è®¤è´¦å·ç™»å½•çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm whoami</span><br></pre></td></tr></table></figure><p>cdåˆ°ä½ éœ€è¦å‘å¸ƒçš„åŒ…&#x2F;æ„å»ºäº§ç‰©</p><blockquote><p>æ¯”å¦‚è¯´æˆ‘çš„ç»„ä»¶åº“é¡¹ç›®äº§ç‰©ä½äºpackages\core</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd .\packages\core\</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œå…ˆç¡®è®¤æˆ‘ä»¬å³å°†å‘å¸ƒçš„åŒ…</p><blockquote><p>packages\core\package.json</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;veyra&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä½¿ç”¨ Vue3 + Ts æ„å»ºçš„ç»„ä»¶åº“&quot;</span><span class="punctuation">,</span></span><br><span class="line">...</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><em><strong>åç§°</strong></em></p><blockquote><p>ä¸èƒ½å’Œä»–äººå·²å‘å¸ƒè¿‡çš„åŒ…åé‡å</p></blockquote><p><em><strong>ç‰ˆæœ¬</strong></em></p><blockquote><p>å¦‚æœæ˜¯åˆæ¬¡å‘å¸ƒ â€œversionâ€: â€œ1.0.0â€ å³å¯</p><p>è‹¥æ˜¯è‡ªå·±å·²å‘å¸ƒè¿‡çš„åŒ…è¦æ›´æ–°ç‰ˆæœ¬ (å¦‚â€1.0.1â€)</p><p>è¯¦æƒ…è¯·çœ‹åˆ°æ–‡ç« æœ€åâ€œå…³äºç‰ˆæœ¬å·â€</p></blockquote><p>åœ¨ç¡®è®¤æ— è¯¯åï¼Œæ‰§è¡Œå‘åŒ…å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm publish</span><br></pre></td></tr></table></figure><h2 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h2><p>ç°åœ¨ä½ å·²ç»æŒæ¡äº†æœ€åŸå§‹çš„å‘åŒ…æµç¨‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨æ›´ä¼˜é›…çš„æ‰‹æ®µ</p><p>åœ¨å«æœ‰åŒ…çš„ç›®å½•ä¸­ä¸‹è½½</p><h3 id="rimraf"><a href="#rimraf" class="headerlink" title="rimraf"></a>rimraf</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add rimraf --save-dev</span><br></pre></td></tr></table></figure><blockquote><p>è¿™æ˜¯ç”¨æ¥åœ¨æ¯æ¬¡æ‰“åŒ…å‰removeæˆ‘ä»¬çš„distæ–‡ä»¶å¤¹çš„</p><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ¸…ç†æ‰ä¸Šæ¬¡æ‰“åŒ…çš„æ®‹ä½™äº§ç‰©</p></blockquote><p>åœ¨ç›¸åº”çš„package.jsonä¸­æ·»åŠ è„šæœ¬å‘½ä»¤,å¹¶å°†cleanæ”¾åœ¨buildå‘½ä»¤å‰</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;clean vite build ...&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;clean&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rimraf dist&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬å°è¯•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm build</span><br></pre></td></tr></table></figure><p>å°±ä¼šå…ˆæŠŠä¸Šä¸€æ¬¡çš„æ„å»ºäº§ç‰©(distæ–‡ä»¶å¤¹)åˆ äº†ï¼Œå†é‡æ–°ç”Ÿæˆäº†</p><h3 id="release-it"><a href="#release-it" class="headerlink" title="release-it"></a>release-it</h3><blockquote><p>ä¸€ä¸ªäº¤äº’å¼çš„å‘½ä»¤è¡Œå·¥å…·</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add release-it --save-dev</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œæ·»åŠ è„šæœ¬å‘½ä»¤</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;release&quot;</span><span class="punctuation">:</span> <span class="string">&quot;release-it&quot;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><p><code>release-it</code> åœ¨å‘å¸ƒè¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œ <code>git push</code> å’Œ <code>git push --tags</code>ï¼Œå¦‚æœæœ¬åœ°åˆ†æ”¯æœªè®¾ç½®ä¸Šæ¸¸åˆ†æ”¯ï¼ˆupstreamï¼‰ï¼Œè¿™äº›æ“ä½œä¼šå¤±è´¥ã€‚</p><p>æ‰€ä»¥é¦–å…ˆåœ¨æ ¹ç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;åµŒå…¥release-it&quot;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --set-upstream origin main</span><br></pre></td></tr></table></figure><p>cdè¿›ä½ åŒ…çš„ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd .\packages\core\</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run release</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å³å¯æ ¹æ®éœ€æ±‚é€‰æ‹©ç›¸åº”çš„ç‰ˆæœ¬å·ç­‰é…ç½®</p><h1 id="å…³äºç‰ˆæœ¬å·"><a href="#å…³äºç‰ˆæœ¬å·" class="headerlink" title="å…³äºç‰ˆæœ¬å·"></a>å…³äºç‰ˆæœ¬å·</h1><p>ä»¥ä¸‹æ˜¯ç‰ˆæœ¬å·çš„ç»„æˆéƒ¨åˆ†ï¼Œä»¥åŠå„éƒ¨åˆ†å¢åŠ çš„ä¾æ®</p><p><strong>ä¸»ç‰ˆæœ¬å·ï¼ˆMajor Versionï¼‰</strong>ï¼š</p><blockquote><p>å‘ç”Ÿäº†é‡å¤§æ›´æ”¹ï¼Œæˆ–æ˜¯åšå‡ºäº†ä¸å…¼å®¹çš„APIä¿®æ”¹</p><p>æ„å‘³ç€ç”¨æˆ·éœ€è¦å¯¹ä»£ç è¿›è¡Œç›¸åº”çš„ä¿®æ”¹</p></blockquote><p><strong>æ¬¡ç‰ˆæœ¬å·ï¼ˆMinor Versionï¼‰</strong>ï¼š</p><blockquote><p>æ·»åŠ äº†å‘ä¸‹å…¼å®¹çš„æ–°åŠŸèƒ½ï¼Œä½†ç°æœ‰çš„APIä¿æŒä¸å˜</p><p>æ„å‘³ç€ç”¨æˆ·ä¸éœ€è¦ä¿®æ”¹ä»£ç </p></blockquote><p><strong>ä¿®è®¢ç‰ˆæœ¬å·ï¼ˆRevision Numberï¼‰</strong>ï¼š</p><blockquote><p>ä¿®å¤äº†ä¸€äº›é—®é¢˜ï¼Œä½†æ²¡æœ‰å¼•å…¥æ–°çš„åŠŸèƒ½</p><p>æ„å‘³ç€ç”¨æˆ·å¯ä»¥è·å¾—æ›´ç¨³å®šçš„ä½“éªŒ</p></blockquote><p><strong>ç¼–è¯‘ç‰ˆæœ¬å·ï¼ˆBuild Numberï¼‰</strong>ï¼š</p><blockquote><p>è¡¨ç¤ºè½¯ä»¶çš„ç¼–è¯‘ç‰ˆæœ¬ï¼Œé€šå¸¸ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­è‡ªåŠ¨ç”Ÿæˆï¼Œä¸è¿›è¡Œäººä¸ºæ§åˆ¶ã€‚</p></blockquote><p><strong>é¢„å‘å¸ƒç‰ˆæœ¬æ ‡è¯†ç¬¦</strong></p><blockquote><p>å¯ä»¥é™„åŠ ä¸€ä¸ªé¢„å‘å¸ƒç‰ˆæœ¬æ ‡è¯†ç¬¦(å¦‚<code>alpha</code>ï¼Œ<code>beta</code>ç­‰)æ¥æ ‡è¯†å¼€å‘ä¸­çš„ç‰ˆæœ¬ï¼Œé€šå¸¸ç”¨äºæµ‹è¯•é˜¶æ®µã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ¢ç´¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç»„ä»¶åº“å…¨æ–‡ä»¶è§£æ„</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/%E7%BB%84%E4%BB%B6%E5%BA%93%E9%A1%B9%E7%9B%AE%E5%85%A8%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%84/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/%E7%BB%84%E4%BB%B6%E5%BA%93%E9%A1%B9%E7%9B%AE%E5%85%A8%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br></pre></td><td class="code"><pre><span class="line">è¿™æ˜¯ä¸€ä¸ªç»„ä»¶åº“é¡¹ç›®ï¼ŒæŠ€æœ¯æ ˆï¼šVue 3 + TypeScript + Viteï¼Œæµ‹è¯•å·¥å…·ï¼šVitest + Storybookï¼Œæ‰“åŒ…å·¥å…·ï¼šRollup + Vue-Test-Utilsï¼Œé¡¹ç›®éƒ¨ç½²ï¼šVitePressç«™ç‚¹ç”Ÿæˆ + GitHubPagesé¡µé¢æ‰˜ç®¡ + github actions CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²</span><br><span class="line"></span><br><span class="line">Veyra</span><br><span class="line">â”œâ”€ .nvmrc</span><br><span class="line">â”œâ”€ env.d.ts</span><br><span class="line">â”œâ”€ libs</span><br><span class="line">â”‚  â”œâ”€ README.md</span><br><span class="line">â”‚  â”œâ”€ vite-plugins</span><br><span class="line">â”‚  â”‚  â”œâ”€ hooksPlugin.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ package.json</span><br><span class="line">â”‚  â”‚  â””â”€ vite.config.ts</span><br><span class="line">â”‚  â””â”€ vitepress-preview-component</span><br><span class="line">â”‚     â”œâ”€ container</span><br><span class="line">â”‚     â”‚  â”œâ”€ ant-design-ui</span><br><span class="line">â”‚     â”‚  â”‚  â”œâ”€ ant-design.scss</span><br><span class="line">â”‚     â”‚  â”‚  â””â”€ AntDesign.vue</span><br><span class="line">â”‚     â”‚  â”œâ”€ element-plus</span><br><span class="line">â”‚     â”‚  â”‚  â”œâ”€ element-plus.scss</span><br><span class="line">â”‚     â”‚  â”‚  â””â”€ ElementPlus.vue</span><br><span class="line">â”‚     â”‚  â””â”€ naive-ui</span><br><span class="line">â”‚     â”‚     â”œâ”€ naive-ui.scss</span><br><span class="line">â”‚     â”‚     â””â”€ NaiveUI.vue</span><br><span class="line">â”‚     â”œâ”€ hooks</span><br><span class="line">â”‚     â”‚  â”œâ”€ use-codecopy.ts</span><br><span class="line">â”‚     â”‚  â”œâ”€ use-codefold.ts</span><br><span class="line">â”‚     â”‚  â””â”€ use-namespaces.ts</span><br><span class="line">â”‚     â”œâ”€ icons</span><br><span class="line">â”‚     â”‚  â”œâ”€ code-close.vue</span><br><span class="line">â”‚     â”‚  â”œâ”€ code-copy.vue</span><br><span class="line">â”‚     â”‚  â”œâ”€ code-open.vue</span><br><span class="line">â”‚     â”‚  â””â”€ copy-success.vue</span><br><span class="line">â”‚     â”œâ”€ index.ts</span><br><span class="line">â”‚     â”œâ”€ messages</span><br><span class="line">â”‚     â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚     â”‚  â”œâ”€ message-notice.scss</span><br><span class="line">â”‚     â”‚  â””â”€ message-notice.vue</span><br><span class="line">â”‚     â”œâ”€ package.json</span><br><span class="line">â”‚     â”œâ”€ styles</span><br><span class="line">â”‚     â”‚  â””â”€ various.scss</span><br><span class="line">â”‚     â”œâ”€ tsconfig.json</span><br><span class="line">â”‚     â”œâ”€ types.d.ts</span><br><span class="line">â”‚     â””â”€ vite.config.ts</span><br><span class="line">â”œâ”€ package.json</span><br><span class="line">â”œâ”€ packages</span><br><span class="line">â”‚  â”œâ”€ components</span><br><span class="line">â”‚  â”‚  â”œâ”€ Alert</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Alert.test.tsx</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Alert.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ Button</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Button.test.tsx</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Button.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ ButtonGroup.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ constants.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ Collapse</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Collapse.test.tsx</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Collapse.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ CollapseItem.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ constants.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ transitionEvents.ts</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ ConfigProvider</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ ConfigProvider.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ constants.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ hooks.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ Dropdown</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ constants.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Dropdown.test.tsx</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Dropdown.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ DropdownItem.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ Form</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ constants.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Form.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ FormItem.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ hooks.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ Icon</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Icon.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ index.test.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ Input</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Input.test.tsx</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Input.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ Loading</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ directive.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Loading.test.tsx</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Loading.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ service.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ Message</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Message.test.tsx</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Message.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ methods.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ MessageBox</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ MessageBox.test.tsx</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ MessageBox.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ methods.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ Notification</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ methods.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Notification.test.tsx</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Notification.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ Overlay</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Overlay.vue</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ package.json</span><br><span class="line">â”‚  â”‚  â”œâ”€ Popconfirm</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Popconfirm.test.tsx</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Popconfirm.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ Select</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ constants.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Option.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Select.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ types.ts</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ useKeyMap.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ Switch</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Switch.test.tsx</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Switch.vue</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ types.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ Tooltip</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ style.css</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Tooltip.test.tsx</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ Tooltip.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ types.ts</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ useEventsToTiggerNode.ts</span><br><span class="line">â”‚  â”‚  â””â”€ Upload</span><br><span class="line">â”‚  â”‚     â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚     â”œâ”€ types.ts</span><br><span class="line">â”‚  â”‚     â”œâ”€ Upload.vue</span><br><span class="line">â”‚  â”‚     â””â”€ UploadList.vue</span><br><span class="line">â”‚  â”œâ”€ constants</span><br><span class="line">â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ key.ts</span><br><span class="line">â”‚  â”‚  â””â”€ package.json</span><br><span class="line">â”‚  â”œâ”€ core</span><br><span class="line">â”‚  â”‚  â”œâ”€ build</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ vite.es.config.ts</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ vite.umd.config.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ componens.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ makeInstaller.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ package.json</span><br><span class="line">â”‚  â”‚  â””â”€ pringLogo.ts</span><br><span class="line">â”‚  â”œâ”€ docs</span><br><span class="line">â”‚  â”‚  â”œâ”€ .vitepress</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ config.ts</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ theme</span><br><span class="line">â”‚  â”‚  â”‚     â””â”€ index.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ components</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ alert.md</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ button.md</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ collapse.md</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ dropdown.md</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ form.md</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ loading.md</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ message.md</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ messagebox.md</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ notification.md</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ popconfirm.md</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ tooltip.md</span><br><span class="line">â”‚  â”‚  â”œâ”€ demo</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ alert</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Basic.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Close.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Desc.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ IconDesc.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ ShowIcon.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ TextCenter.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â””â”€ Theme.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ button</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Basic.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Disabled.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Group.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Icon.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Loading.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Size.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Tag.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â””â”€ Throttle.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ collapse</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Accordion.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Basic.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ CustomTitle.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â””â”€ Disabled.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ dropdown</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Basic.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Command.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Disabled.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ HideOnClick.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ InstanceMethod.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Size.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ SplitButton.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â””â”€ Trigger.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ form</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Basic.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ CustomValidate.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Position.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â””â”€ Validate.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ loading</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Basic.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Custom.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â””â”€ Fullscreen.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ message</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Basic.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Center.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Closeable.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Test.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â””â”€ Type.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ messagebox</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Alert.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Center.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Confirm.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Custom.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Prompt.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â””â”€ VNode.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ notification</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Basic.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Closeable.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â””â”€ Type.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ popconfirm</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Basic.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Callback.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â””â”€ Custom.vue</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ tooltip</span><br><span class="line">â”‚  â”‚  â”‚     â”œâ”€ Basic.vue</span><br><span class="line">â”‚  â”‚  â”‚     â”œâ”€ Disabled.vue</span><br><span class="line">â”‚  â”‚  â”‚     â””â”€ Slot.vue</span><br><span class="line">â”‚  â”‚  â”œâ”€ get-started.md</span><br><span class="line">â”‚  â”‚  â”œâ”€ index.md</span><br><span class="line">â”‚  â”‚  â””â”€ package.json</span><br><span class="line">â”‚  â”œâ”€ hooks</span><br><span class="line">â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ package.json</span><br><span class="line">â”‚  â”‚  â”œâ”€ useClickOutside.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ useDisabledStyle.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ useEventListener.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ useFocusController.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ useId.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ useLocale.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ useOffset.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ useProp.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ useZIndex.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ vite.config.ts</span><br><span class="line">â”‚  â”‚  â””â”€ __test__</span><br><span class="line">â”‚  â”‚     â”œâ”€ index.test.tsx</span><br><span class="line">â”‚  â”‚     â”œâ”€ useClickOutset.test.tsx</span><br><span class="line">â”‚  â”‚     â””â”€ useEventListener.test.tsx</span><br><span class="line">â”‚  â”œâ”€ locale</span><br><span class="line">â”‚  â”‚  â”œâ”€ index.ts</span><br><span class="line">â”‚  â”‚  â”œâ”€ lang</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ en.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ ja.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ ko.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ zh-cn.ts</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ zh-tw.ts</span><br><span class="line">â”‚  â”‚  â””â”€ package.json</span><br><span class="line">â”‚  â”œâ”€ play</span><br><span class="line">â”‚  â”‚  â”œâ”€ .storybook</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ main.js</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ preview.js</span><br><span class="line">â”‚  â”‚  â”œâ”€ index.html</span><br><span class="line">â”‚  â”‚  â”œâ”€ package.json</span><br><span class="line">â”‚  â”‚  â”œâ”€ public</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ vite.svg</span><br><span class="line">â”‚  â”‚  â”œâ”€ README.md</span><br><span class="line">â”‚  â”‚  â”œâ”€ src</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ App.vue</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ main.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ stories</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Alert.stories.tsx</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â”œâ”€ Button.stories.ts</span><br><span class="line">â”‚  â”‚  â”‚  â”‚  â””â”€ Collapse.stories.ts</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ vite-env.d.ts</span><br><span class="line">â”‚  â”‚  â””â”€ vite.config.ts</span><br><span class="line">â”‚  â”œâ”€ README.md</span><br><span class="line">â”‚  â”œâ”€ theme</span><br><span class="line">â”‚  â”‚  â”œâ”€ index.css</span><br><span class="line">â”‚  â”‚  â”œâ”€ package.json</span><br><span class="line">â”‚  â”‚  â””â”€ reset.css</span><br><span class="line">â”‚  â””â”€ utils</span><br><span class="line">â”‚     â”œâ”€ error.ts</span><br><span class="line">â”‚     â”œâ”€ index.ts</span><br><span class="line">â”‚     â”œâ”€ install.ts</span><br><span class="line">â”‚     â”œâ”€ package.json</span><br><span class="line">â”‚     â”œâ”€ style.ts</span><br><span class="line">â”‚     â””â”€ __tests__</span><br><span class="line">â”‚        â”œâ”€ error.test.tsx</span><br><span class="line">â”‚        â”œâ”€ index.test.tsx</span><br><span class="line">â”‚        â””â”€ install.test.tsx</span><br><span class="line">â”œâ”€ pnpm-lock.yaml</span><br><span class="line">â”œâ”€ pnpm-workspace.yaml</span><br><span class="line">â”œâ”€ postcss.config.cjs</span><br><span class="line">â”œâ”€ tsconfig.build.json</span><br><span class="line">â”œâ”€ tsconfig.json</span><br><span class="line">â”œâ”€ tsconfig.node.json</span><br><span class="line">â”œâ”€ vitest.config.ts</span><br><span class="line">â””â”€ vitest.setup.ts</span><br></pre></td></tr></table></figure><h1 id="é¡¹ç›®è§£æ„"><a href="#é¡¹ç›®è§£æ„" class="headerlink" title="é¡¹ç›®è§£æ„"></a>é¡¹ç›®è§£æ„</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctrl+i</span><br><span class="line">alt+shift+5</span><br></pre></td></tr></table></figure><h1 id="â”œâ”€-nvmrc"><a href="#â”œâ”€-nvmrc" class="headerlink" title="â”œâ”€ .nvmrc"></a>â”œâ”€ .<em><del>nvmrc</del></em></h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v18.17.0</span><br></pre></td></tr></table></figure><p>æ§åˆ¶nodejsç‰ˆæœ¬çš„</p><h1 id="â”œâ”€-env-d-ts"><a href="#â”œâ”€-env-d-ts" class="headerlink" title="â”œâ”€ env.d.ts"></a>â”œâ”€ <em><del>env.d.ts</del></em></h1><blockquote><p>ç”¨æ¥åŒºåˆ†ä¸åŒçš„è¿è¡Œç¯å¢ƒï¼šç”Ÿäº§ï¼ˆproductionï¼‰ã€å¼€å‘ï¼ˆdevelopmentï¼‰å’Œæµ‹è¯•ï¼ˆtestï¼‰</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">PROD</span>: <span class="built_in">boolean</span>; <span class="comment">//ç”Ÿäº§</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">DEV</span>: <span class="built_in">boolean</span>; <span class="comment">//å¼€å‘</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">TEST</span>: <span class="built_in">boolean</span>; <span class="comment">//æµ‹è¯•</span></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨é¡¹ç›®çš„æ„å»ºè„šæœ¬æˆ–é…ç½®æ–‡ä»¶ä¸­ï¼Œä¼šä¾æ®è¿™äº›å˜é‡æ¥å†³å®šæ˜¯å¦å¯ç”¨æŸäº›è°ƒè¯•å·¥å…·ã€æ—¥å¿—è®°å½•æˆ–è€…ä¼˜åŒ–æªæ–½ã€‚</p></blockquote><ol><li><strong>ç”Ÿäº§ç¯å¢ƒ (Production)</strong>:<ul><li><strong>æƒ…æ™¯</strong>: å½“ä½ æ„å»ºå¹¶éƒ¨ç½²ä½ çš„åº”ç”¨åˆ°ç”Ÿäº§æœåŠ¡å™¨ä¸Šæ—¶ï¼ˆä¾‹å¦‚é€šè¿‡ CI&#x2F;CD æµç¨‹è‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pages æˆ–è€…å…¶ä»–ä»»ä½•ç”Ÿäº§ç¯å¢ƒï¼‰ã€‚å‡è®¾ä½ åœ¨ Vite é…ç½®æ–‡ä»¶ä¸­ä¸ºç”Ÿäº§ç¯å¢ƒè®¾ç½®äº† <code>PROD=true</code>ã€‚</li><li><strong>æ“ä½œ</strong>: æ‰§è¡Œæ„å»ºå‘½ä»¤å¦‚ <code>npm run build</code> åï¼Œå†å°†ç”Ÿæˆçš„é™æ€èµ„æºéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</li><li><strong>ç»“æœ</strong>: åœ¨å¯åŠ¨æˆ–åŠ è½½åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¯¥å‡½æ•°è¢«æ‰§è¡Œï¼Œé‚£ä¹ˆå°†ä¼šçœ‹åˆ°é‚£ä¸ªå¸¦æœ‰æ¸å˜è‰²æ•ˆæœçš„ASCIIè‰ºæœ¯logoå‡ºç°åœ¨æœåŠ¡å™¨æ—¥å¿—æˆ–è€…æµè§ˆå™¨æ§åˆ¶å°ä¸­ã€‚</li></ul></li><li><strong>å¼€å‘æ¨¡å¼ (Development)</strong>:<ul><li><strong>æƒ…æ™¯</strong>: å½“ä½ åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­è¿è¡Œä½ çš„Vue 3 + TypeScripté¡¹ç›®æ—¶ï¼Œæ¯”å¦‚ä½¿ç”¨ <code>npm run serve</code> æˆ–è€…ç±»ä¼¼çš„å‘½ä»¤å¯åŠ¨ä¸€ä¸ªçƒ­é‡è½½çš„å¼€å‘æœåŠ¡å™¨ã€‚</li><li><strong>æ“ä½œ</strong>: ç›´æ¥åœ¨ç»ˆç«¯æ‰§è¡Œ <code>npm run serve</code> æˆ–è€…é…ç½®å¥½çš„å¼€å‘æ¨¡å¼å¯åŠ¨è„šæœ¬ã€‚</li><li><strong>ç»“æœ</strong>: åœ¨æ§åˆ¶å°ä¸­ä½ ä¼šçœ‹åˆ°ç®€å•çš„æç¤ºæ¶ˆæ¯ <code>[EricUI]:dev mode...</code>ï¼Œè¿™è¡¨æ˜ç°åœ¨æ­£å¤„äºå¼€å‘æ¨¡å¼ä¸‹ï¼Œå¹¶ä¸”å¯ä»¥å¿«é€Ÿè¯†åˆ«å‡ºå½“å‰çš„å·¥ä½œçŠ¶æ€ã€‚</li></ul></li><li><strong>æµ‹è¯•ç¯å¢ƒ (Testing)</strong>:<ul><li><strong>æƒ…æ™¯</strong>: è¿è¡Œå•å…ƒæµ‹è¯•æˆ–é›†æˆæµ‹è¯•æ—¶ï¼ˆä¾‹å¦‚ä½¿ç”¨ Vitestï¼‰ï¼Œé€šå¸¸ä¸ä¼šè®¾ç½® <code>PROD</code> æˆ– <code>DEV</code> å˜é‡ä¸º trueã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ—¢ä¸æ»¡è¶³ç”Ÿäº§ç¯å¢ƒä¹Ÿä¸æ»¡è¶³å¼€å‘æ¨¡å¼çš„æ¡ä»¶ã€‚</li><li><strong>æ“ä½œ</strong>: æ‰§è¡Œæµ‹è¯•å‘½ä»¤å¦‚ <code>npm test</code> æˆ– <code>vitest</code>ã€‚</li><li><strong>ç»“æœ</strong>: æ§åˆ¶å°ä¸Šä¸ä¼šæ˜¾ç¤ºä¸Šè¿°çš„ASCIIè‰ºæœ¯logoæˆ–å¼€å‘æ¨¡å¼çš„æ¶ˆæ¯ï¼Œä»¥é¿å…å¹²æ‰°æµ‹è¯•è¾“å‡ºã€‚</li></ul></li></ol><h1 id="â”œâ”€-libs"><a href="#â”œâ”€-libs" class="headerlink" title="â”œâ”€ libs"></a>â”œâ”€ <em><del>libs</del></em></h1><blockquote><p>è¾…åŠ©åº“&amp;å·¥å…·</p></blockquote><h2 id="â”œâ”€-vite-plugins"><a href="#â”œâ”€-vite-plugins" class="headerlink" title="â”œâ”€ vite-plugins"></a>â”œâ”€ vite-plugins</h2><blockquote><p>è‡ªå®šä¹‰viteæ’ä»¶</p></blockquote><h3 id="â”œâ”€-hooksPlugin-ts"><a href="#â”œâ”€-hooksPlugin-ts" class="headerlink" title="â”œâ”€ hooksPlugin.ts"></a>â”œâ”€ hooksPlugin.ts</h3><h3 id="â”œâ”€-index-ts"><a href="#â”œâ”€-index-ts" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h3><h3 id="â”œâ”€-package-json"><a href="#â”œâ”€-package-json" class="headerlink" title="â”œâ”€ package.json"></a>â”œâ”€ package.json</h3><h3 id="â””â”€-vite-config-ts"><a href="#â””â”€-vite-config-ts" class="headerlink" title="â””â”€ vite.config.ts"></a>â””â”€ vite.config.ts</h3><h2 id="â””â”€-vitepress-preview-component"><a href="#â””â”€-vitepress-preview-component" class="headerlink" title="â””â”€ vitepress-preview-component"></a>â””â”€ vitepress-preview-component</h2><blockquote><p>vitepressç»„ä»¶é¢„è§ˆæ’ä»¶</p></blockquote><h3 id="â”œâ”€-container"><a href="#â”œâ”€-container" class="headerlink" title="â”œâ”€ container"></a>â”œâ”€ container</h3><p>â”‚     â”‚  â”œâ”€ ant-design-ui<br>â”‚     â”‚  â”‚  â”œâ”€ ant-design.scss<br>â”‚     â”‚  â”‚  â””â”€ AntDesign.vue<br>â”‚     â”‚  â”œâ”€ element-plus<br>â”‚     â”‚  â”‚  â”œâ”€ element-plus.scss<br>â”‚     â”‚  â”‚  â””â”€ ElementPlus.vue<br>â”‚     â”‚  â””â”€ naive-ui<br>â”‚     â”‚     â”œâ”€ naive-ui.scss<br>â”‚     â”‚     â””â”€ NaiveUI.vue</p><p>â”‚     â”œâ”€ hooks<br>â”‚     â”‚  â”œâ”€ use-codecopy.ts<br>â”‚     â”‚  â”œâ”€ use-codefold.ts<br>â”‚     â”‚  â””â”€ use-namespaces.ts</p><p>â”‚     â”œâ”€ icons<br>â”‚     â”‚  â”œâ”€ code-close.vue<br>â”‚     â”‚  â”œâ”€ code-copy.vue<br>â”‚     â”‚  â”œâ”€ code-open.vue<br>â”‚     â”‚  â””â”€ copy-success.vue</p><p>â”‚     â”œâ”€ index.ts</p><p>â”‚     â”œâ”€ messages<br>â”‚     â”‚  â”œâ”€ index.ts<br>â”‚     â”‚  â”œâ”€ message-notice.scss<br>â”‚     â”‚  â””â”€ message-notice.vue</p><p>â”‚     â”œâ”€ package.json<br>â”‚     â”œâ”€ styles<br>â”‚     â”‚  â””â”€ various.scss</p><p>â”‚     â”œâ”€ tsconfig.json</p><p>â”‚     â”œâ”€ types.d.ts</p><p>â”‚     â””â”€ vite.config.ts</p><h1 id="â”œâ”€-packages"><a href="#â”œâ”€-packages" class="headerlink" title="â”œâ”€ packages"></a>â”œâ”€ <em><del>packages</del></em></h1><blockquote><p>é¡¹ç›®åˆ†åŒ…</p></blockquote><h2 id="â”œâ”€-components"><a href="#â”œâ”€-components" class="headerlink" title="â”œâ”€ components"></a>â”œâ”€ <em><del>components</del></em></h2><blockquote><p>æ‰€æœ‰çš„ç»„ä»¶é€»è¾‘</p></blockquote><h3 id="â”œâ”€-Alert"><a href="#â”œâ”€-Alert" class="headerlink" title="â”œâ”€ Alert"></a>â”œâ”€ Alert</h3><blockquote><p>æç¤º</p></blockquote><h4 id="â€“APIâ€“"><a href="#â€“APIâ€“" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><table><thead><tr><th>Name</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody><tr><td>title</td><td>Alert æ ‡é¢˜</td><td><code>string</code></td><td>â€”</td></tr><tr><td>type</td><td>Alert ç±»å‹</td><td><code>enum</code>Â -Â <code>&#39;success&#39;| &#39;warning&#39;| &#39;danger&#39;| &#39;info&#39;</code></td><td>info</td></tr><tr><td>description</td><td>æè¿°æ€§æ–‡æœ¬</td><td><code>string</code></td><td>â€”</td></tr><tr><td>closable</td><td>æ˜¯å¦å¯ä»¥å…³é—­</td><td><code>boolean</code></td><td>true</td></tr><tr><td>center</td><td>æ–‡å­—æ˜¯å¦å±…ä¸­</td><td><code>boolean</code></td><td>false</td></tr><tr><td>show-icon</td><td>æ˜¯å¦å±•ç¤ºå›¾æ ‡</td><td><code>boolean</code></td><td>false</td></tr><tr><td>effect</td><td>ä¸»é¢˜æ ·å¼</td><td><code>enum</code>Â -Â <code>&#39;light&#39;| &#39;dark&#39;\</code></td><td>light</td></tr></tbody></table><table><thead><tr><th>Name</th><th>Description</th><th>Type</th></tr></thead><tbody><tr><td>close</td><td>å…³é—­ Alert æ—¶è§¦å‘çš„äº‹ä»¶</td><td><code>(event: MouseEvent)=&gt; void</code></td></tr></tbody></table><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>default</td><td>é»˜è®¤æ’æ§½ï¼Œç”¨äºè®¾ç½® Alert çš„å†…å®¹æè¿°</td></tr><tr><td>title</td><td>æ ‡é¢˜çš„å†…å®¹</td></tr></tbody></table><table><thead><tr><th>Name</th><th>Description</th><th>Type</th></tr></thead><tbody><tr><td>open</td><td>æ‰“å¼€ Alert</td><td><code>() =&gt; void</code></td></tr><tr><td>close</td><td>å…³é—­ Alert</td><td><code>() =&gt; void</code></td></tr></tbody></table><h4 id="â”œâ”€-Alert-test-tsx"><a href="#â”œâ”€-Alert-test-tsx" class="headerlink" title="â”œâ”€ Alert.test.tsx"></a>â”œâ”€ Alert.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, expect, vi &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">AlertType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Alert</span> <span class="keyword">from</span> <span class="string">&quot;./Alert.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Icon</span> <span class="keyword">from</span> <span class="string">&quot;../Icon/Icon.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Alert.vue&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> title = <span class="string">&quot;Test Alert&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> desc = <span class="string">&quot;This is a test description&quot;</span>;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should render the alert with default props&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        title,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: desc,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">global</span>: &#123;</span><br><span class="line">        <span class="attr">stubs</span>: [<span class="string">&quot;ErIcon&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(title);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(desc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// close icon</span></span><br><span class="line">    <span class="keyword">const</span> iconElement = wrapper.<span class="title function_">findComponent</span>(<span class="title class_">Icon</span>);</span><br><span class="line">    <span class="title function_">expect</span>(iconElement.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(iconElement.<span class="title function_">attributes</span>(<span class="string">&quot;icon&quot;</span>)).<span class="title function_">toBe</span>(<span class="string">&quot;xmark&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> wrapper2 = <span class="title function_">mount</span>(<span class="function">() =&gt;</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">Alert</span> <span class="attr">title</span>=<span class="string">&#123;title&#125;</span> <span class="attr">description</span>=<span class="string">&#123;desc&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Alert</span>&gt;</span></span></span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper2.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(title);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper2.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(desc);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it.<span class="title function_">each</span>([</span><br><span class="line">    [<span class="string">&quot;info&quot;</span>, <span class="string">&quot;circle-info&quot;</span>],</span><br><span class="line">    [<span class="string">&quot;success&quot;</span>, <span class="string">&quot;check-circle&quot;</span>],</span><br><span class="line">    [<span class="string">&quot;warning&quot;</span>, <span class="string">&quot;circle-exclamation&quot;</span>],</span><br><span class="line">    [<span class="string">&quot;danger&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">    [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">    [<span class="string">&quot;non-compliance&quot;</span>, <span class="string">&quot;circle-info&quot;</span>], <span class="comment">// ä¸ç¬¦åˆ type å®šä¹‰çš„</span></span><br><span class="line">  ])(<span class="string">&quot;should has the correct icon when props type is %s&quot;</span>, <span class="function">(<span class="params"><span class="keyword">type</span>, iconName</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        title,</span><br><span class="line">        <span class="attr">closable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">showIcon</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="keyword">type</span> <span class="keyword">as</span> <span class="title class_">AlertType</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: desc,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">global</span>: &#123;</span><br><span class="line">        <span class="attr">stubs</span>: [<span class="string">&quot;ErIcon&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> iconElement = wrapper.<span class="title function_">findComponent</span>(<span class="title class_">Icon</span>);</span><br><span class="line">    <span class="title function_">expect</span>(iconElement.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(iconElement.<span class="title function_">attributes</span>(<span class="string">&quot;icon&quot;</span>)).<span class="title function_">toBe</span>(iconName);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should emit close event when close icon is clicked&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> onClose = vi.<span class="title function_">fn</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        title,</span><br><span class="line">        <span class="attr">closable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">showIcon</span>: <span class="literal">false</span>,</span><br><span class="line">        onClose,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: desc,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">global</span>: &#123;</span><br><span class="line">        <span class="attr">stubs</span>: [<span class="string">&quot;ErIcon&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    wrapper.<span class="title function_">findComponent</span>(<span class="title class_">Icon</span>).<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onClose).<span class="title function_">toHaveBeenCalled</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should allow custom content via slots&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;test title&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: desc,</span><br><span class="line">        title,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(desc);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(title);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="property">not</span>.<span class="title function_">toContain</span>(<span class="string">&quot;test title&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should support centering text&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        title,</span><br><span class="line">        <span class="attr">description</span>: desc,</span><br><span class="line">        <span class="attr">center</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//class</span></span><br><span class="line">    <span class="keyword">const</span> rootNode = wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-alert&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(rootNode.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;text-center&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should not render close icon when closable is false&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; <span class="attr">closable</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-alert__close&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBe</span>(<span class="literal">false</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should toggle visibility when open and close methods are called&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; title, <span class="attr">closable</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="property">vm</span>.<span class="title function_">close</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-alert&quot;</span>).<span class="title function_">attributes</span>().<span class="property">style</span>).<span class="title function_">toBe</span>(<span class="string">&quot;display: none;&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="property">vm</span>.<span class="title function_">open</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-alert&quot;</span>).<span class="title function_">attributes</span>().<span class="property">style</span>).<span class="title function_">toBe</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Alert-vue"><a href="#â”œâ”€-Alert-vue" class="headerlink" title="â”œâ”€ Alert.vue"></a>â”œâ”€ Alert.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; AlertProps, AlertEmits, AlertInstance &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; ref, useSlots, computed &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; typeIconMap &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErAlert&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;AlertProps&gt;(), &#123;</span><br><span class="line">  effect: &quot;light&quot;,</span><br><span class="line">  type: &quot;info&quot;,</span><br><span class="line">  closable: true,</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;AlertEmits&gt;();</span><br><span class="line">const slots = useSlots();</span><br><span class="line"></span><br><span class="line">const visible = ref(true);</span><br><span class="line"></span><br><span class="line">const iconName = computed(() =&gt; typeIconMap.get(props.type) ?? &quot;circle-info&quot;);</span><br><span class="line">const withDescription = computed(() =&gt; props.description || slots.default);</span><br><span class="line"></span><br><span class="line">function close() &#123;</span><br><span class="line">  visible.value = false;</span><br><span class="line">  emits(&quot;close&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function open() &#123;</span><br><span class="line">  visible.value = true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defineExpose&lt;AlertInstance&gt;(&#123;</span><br><span class="line">  open,</span><br><span class="line">  close,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition name=&quot;er-alert-fade&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&quot;visible&quot;</span><br><span class="line">      class=&quot;er-alert&quot;</span><br><span class="line">      role=&quot;alert&quot;</span><br><span class="line">      :class=&quot;&#123;</span><br><span class="line">        [`er-alert__$&#123;type&#125;`]: type,</span><br><span class="line">        [`er-alert__$&#123;effect&#125;`]: effect,</span><br><span class="line">        &#x27;text-center&#x27;: center,</span><br><span class="line">      &#125;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;er-icon</span><br><span class="line">        v-if=&quot;showIcon&quot;</span><br><span class="line">        class=&quot;er-alert__icon&quot;</span><br><span class="line">        :class=&quot;&#123; &#x27;big-icon&#x27;: withDescription &#125;&quot;</span><br><span class="line">        :icon=&quot;iconName&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;div class=&quot;er-alert__content&quot;&gt;</span><br><span class="line">        &lt;span</span><br><span class="line">          class=&quot;er-alert__title&quot;</span><br><span class="line">          :class=&quot;&#123; &#x27;with-desc&#x27;: withDescription &#125;&quot;</span><br><span class="line">          :style=&quot;&#123; display: center &amp;&amp; !showIcon ? &#x27;flow&#x27; : &#x27;inline&#x27; &#125;&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;slot name=&quot;title&quot;&gt;&#123;&#123; title &#125;&#125;&lt;/slot&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">        &lt;p class=&quot;er-alert__description&quot;&gt;</span><br><span class="line">          &lt;slot&gt;&#123;&#123; description &#125;&#125;&lt;/slot&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;div class=&quot;er-alert__close&quot; v-if=&quot;closable&quot;&gt;</span><br><span class="line">          &lt;er-icon @click.stop=&quot;close&quot; icon=&quot;xmark&quot; /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-index-ts-1"><a href="#â”œâ”€-index-ts-1" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Alert</span> <span class="keyword">from</span> <span class="string">&quot;./Alert.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErAlert</span> = <span class="title function_">withInstall</span>(<span class="title class_">Alert</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css"><a href="#â”œâ”€-style-css" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-alert</span> &#123;</span><br><span class="line">  <span class="attr">--er-alert-padding</span>: <span class="number">8px</span> <span class="number">16px</span>;</span><br><span class="line">  <span class="attr">--er-alert-border-radius-base</span>: <span class="built_in">var</span>(--er-border-radius-base);</span><br><span class="line">  <span class="attr">--er-alert-bg-color</span>: <span class="built_in">var</span>(--er-color-white);</span><br><span class="line">  <span class="attr">--er-alert-title-font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attr">--er-alert-title-font-size-with-desc</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attr">--er-alert-desc-font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attr">--er-alert-text-color</span>: <span class="built_in">var</span>(--er-text-color-primary);</span><br><span class="line">  <span class="attr">--er-alert-top-margin</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attr">--er-alert-icon-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attr">--er-alert-icon-margin</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attr">--er-alert-big-icon-size</span>: <span class="number">28px</span>;</span><br><span class="line">  <span class="attr">--er-alert-big-icon-margin</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-alert</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="built_in">var</span>(--er-alert-padding);</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-alert-border-radius-base);</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-alert-bg-color);</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="built_in">var</span>(--er-alert-top-margin);</span><br><span class="line">  <span class="selector-class">.er-alert__icon</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-alert-text-color);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-alert-icon-size);</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">var</span>(--er-alert-icon-size);</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="built_in">var</span>(--er-alert-icon-margin);</span><br><span class="line">    &amp;<span class="selector-class">.big-icon</span>&#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-alert-big-icon-size);</span><br><span class="line">      <span class="attribute">width</span>: <span class="built_in">var</span>(--er-alert-big-icon-size);</span><br><span class="line">      <span class="attribute">margin-right</span>: <span class="built_in">var</span>(--er-alert-big-icon-margin);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-alert__content</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>:  <span class="built_in">var</span>(--er-alert-text-color);</span><br><span class="line">    <span class="attribute">vertical-align</span>: text-top;</span><br><span class="line">    <span class="selector-class">.er-alert__title</span>&#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-alert-title-font-size);</span><br><span class="line">      <span class="attribute">line-height</span>: <span class="number">24px</span>;</span><br><span class="line">      &amp;<span class="selector-class">.with-desc</span> &#123;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-alert-title-font-size-with-desc);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="selector-class">.er-alert__description</span>&#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-alert-desc-font-size);</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.er-alert__close</span> &#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-alert-close-font-size);</span><br><span class="line">      <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">      <span class="attribute">position</span>: absolute;</span><br><span class="line">      <span class="attribute">top</span>: <span class="number">12px</span>;</span><br><span class="line">      <span class="attribute">right</span>: <span class="number">15px</span>;</span><br><span class="line">      <span class="attribute">cursor</span>: pointer;</span><br><span class="line">      :<span class="built_in">deep</span>(.er-icon) &#123;</span><br><span class="line">        <span class="attribute">vertical-align</span>: top;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.er-alert__light</span> &#123;</span><br><span class="line">      <span class="selector-class">.er-alert__close</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="built_in">var</span>(--er-text-color-placeholder);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.er-alert__dark</span> &#123;</span><br><span class="line">      <span class="selector-class">.er-alert__close</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-white);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.text-center</span> &#123;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="selector-tag">span</span>,<span class="selector-tag">p</span> &#123;</span><br><span class="line">      <span class="attribute">text-align</span>: center;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-alert-fade-enter-from</span>,</span><br><span class="line"><span class="selector-class">.er-alert-fade-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@each</span> $val in success,warning,info,danger &#123; </span><br><span class="line">  <span class="selector-class">.er-alert__</span>$(val)<span class="selector-class">.er-alert__light</span> &#123;</span><br><span class="line">    <span class="attr">--er-alert-text-color</span>: <span class="built_in">var</span>(--er-color-$(val));</span><br><span class="line">    <span class="attr">--er-alert-bg-color</span>: <span class="built_in">var</span>(--er-color-$(val)-light-<span class="number">9</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-alert__</span>$(val)<span class="selector-class">.er-alert__dark</span> &#123;</span><br><span class="line">    <span class="attr">--er-alert-text-color</span>: <span class="built_in">var</span>(--er-color-white);</span><br><span class="line">    <span class="attr">--er-alert-bg-color</span>: <span class="built_in">var</span>(--er-color-$(val));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts"><a href="#â””â”€-types-ts" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">AlertType</span> = <span class="string">&quot;success&quot;</span> | <span class="string">&quot;info&quot;</span> | <span class="string">&quot;warning&quot;</span> | <span class="string">&quot;danger&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AlertProps</span> &#123;</span><br><span class="line">  <span class="attr">title</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">type</span>?: <span class="title class_">AlertType</span>;</span><br><span class="line">  <span class="attr">description</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">effect</span>?: <span class="string">&quot;light&quot;</span> | <span class="string">&quot;dark&quot;</span>;</span><br><span class="line">  <span class="attr">closable</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">center</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">showIcon</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AlertEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;close&quot;</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AlertInstance</span> &#123;</span><br><span class="line">  <span class="title function_">open</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">close</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Button"><a href="#â”œâ”€-Button" class="headerlink" title="â”œâ”€ Button"></a>â”œâ”€ Button</h3><h4 id="â€“APIâ€“-1"><a href="#â€“APIâ€“-1" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-Button-test-tsx"><a href="#â”œâ”€-Button-test-tsx" class="headerlink" title="â”œâ”€ Button.test.tsx"></a>â”œâ”€ Button.test.tsx</h4><blockquote><p>å•ç»„ä»¶æµ‹è¯•</p></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, expect &#125; <span class="keyword">from</span> <span class="string">&#x27;vitest&#x27;</span> <span class="comment">//vitest æ˜¯æµ‹è¯•æ¡†æ¶ï¼Œæä¾› describeï¼ˆå®šä¹‰æµ‹è¯•å¥—ä»¶ï¼‰ã€itï¼ˆå®šä¹‰å•ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰ã€expectï¼ˆæ–­è¨€å·¥å…·ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/test-utils&#x27;</span> <span class="comment">//Vue çš„æµ‹è¯•å·¥å…·åº“ï¼Œmount å‡½æ•°ç”¨äºæŒ‚è½½ Vue ç»„ä»¶ä»¥ä¾¿æµ‹è¯•</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Button</span> <span class="keyword">from</span> <span class="string">&#x27;./Button.vue&#x27;</span> <span class="comment">//å¼•å…¥éœ€è¦æµ‹è¯•çš„ Button.vue ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ButtonProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span> <span class="comment">//å¼•å…¥ç»„ä»¶çš„ props ç±»å‹å®šä¹‰ï¼Œç¡®ä¿ props çš„ç±»å‹æ­£ç¡®</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;Button.vue&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// type å±æ€§çš„ç±»åæµ‹è¯•</span></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;type å±æ€§è¢«è®¾ç½®æ—¶ï¼Œç»„ä»¶æ·»åŠ äº†å¯¹åº”çš„ç±»åï¼ˆå¦‚ er-button--primaryï¼‰&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> types = [<span class="string">&#x27;primary&#x27;</span>, <span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;warning&#x27;</span>, <span class="string">&#x27;danger&#x27;</span>, <span class="string">&#x27;info&#x27;</span>] <span class="comment">//åŒ…å«æ‰€æœ‰å¯èƒ½çš„ type å€¼</span></span><br><span class="line">types.<span class="title function_">forEach</span>(<span class="function">(<span class="params"><span class="keyword">type</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//éå†æ¯ä¸ªtypeç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Button</span>, &#123;</span><br><span class="line"><span class="comment">//é€šè¿‡ mount æŒ‚è½½ Button ç»„ä»¶ï¼Œå¹¶ä¼ é€’å½“å‰ type å€¼ä½œä¸º props</span></span><br><span class="line"><span class="attr">props</span>: &#123; <span class="attr">type</span>: <span class="keyword">type</span> <span class="keyword">as</span> <span class="title class_">ButtonProps</span>[<span class="string">&#x27;type&#x27;</span>] &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">`er-button--<span class="subst">$&#123;<span class="keyword">type</span>&#125;</span>`</span>) <span class="comment">//æ–­è¨€ç±»åæ˜¯å¦åŒ…å« er-button--$&#123;type&#125;</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// size å±æ€§çš„ç±»åæµ‹è¯•</span></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;size å±æ€§è¢«è®¾ç½®æ—¶ï¼Œç»„ä»¶æ·»åŠ äº†å¯¹åº”çš„ç±»åï¼ˆå¦‚ er-button--largeï¼‰&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> sizes = [<span class="string">&#x27;large&#x27;</span>, <span class="string">&#x27;default&#x27;</span>, <span class="string">&#x27;small&#x27;</span>]</span><br><span class="line">sizes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">size</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Button</span>, &#123;</span><br><span class="line"><span class="attr">props</span>: &#123; <span class="attr">size</span>: size <span class="keyword">as</span> <span class="title class_">ButtonProps</span>[<span class="string">&#x27;size&#x27;</span>] &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">`er-button--<span class="subst">$&#123;size&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// plainã€round ç­‰å¸ƒå°”å±æ€§çš„ç±»åæµ‹è¯•</span></span><br><span class="line">it.<span class="title function_">each</span>([</span><br><span class="line"><span class="comment">//ä¸€ä¸ªå‚æ•°åŒ–æµ‹è¯•ï¼Œé€šè¿‡æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹ï¼ˆ[prop, className]ï¼‰ç”Ÿæˆå¤šä¸ªæµ‹è¯•ç”¨ä¾‹</span></span><br><span class="line">[<span class="string">&#x27;plain&#x27;</span>, <span class="string">&#x27;is-plain&#x27;</span>],</span><br><span class="line">[<span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;is-round&#x27;</span>],</span><br><span class="line">[<span class="string">&#x27;circle&#x27;</span>, <span class="string">&#x27;is-circle&#x27;</span>],</span><br><span class="line">[<span class="string">&#x27;disabled&#x27;</span>, <span class="string">&#x27;is-disabled&#x27;</span>],</span><br><span class="line">[<span class="string">&#x27;loading&#x27;</span>, <span class="string">&#x27;is-loading&#x27;</span>],</span><br><span class="line">])(</span><br><span class="line"><span class="string">&#x27;å½“ propï¼ˆå¦‚ plainï¼‰è¢«è®¾ç½®ä¸º true æ—¶ï¼Œç»„ä»¶æ·»åŠ äº†å¯¹åº”çš„ç±»åï¼ˆå¦‚ is-plainï¼‰&#x27;</span>,</span><br><span class="line"><span class="function">(<span class="params">prop, className</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Button</span>, &#123;</span><br><span class="line"><span class="comment">//æŒ‚è½½ç»„ä»¶</span></span><br><span class="line"><span class="attr">props</span>: &#123; [prop]: <span class="literal">true</span> &#125;, <span class="comment">//è®¾ç½® props[prop] = true</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(className) <span class="comment">//æ–­è¨€ç±»åæ˜¯å¦åŒ…å« className</span></span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// nativeType å±æ€§çš„ type å±æ€§æµ‹è¯•</span></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;å½“ tag æ˜¯ button æ—¶ï¼Œç»„ä»¶çš„ type å±æ€§ç­‰äº nativeTypeï¼ˆå¦‚ submitï¼‰&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Button</span>, &#123;</span><br><span class="line"><span class="attr">props</span>: &#123; <span class="attr">tag</span>: <span class="string">&#x27;button&#x27;</span>, <span class="attr">nativeType</span>: <span class="string">&#x27;submit&#x27;</span> &#125;, <span class="comment">//è®¾ç½® tag ä¸º buttonï¼ŒnativeType ä¸º submit</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">tagName</span>).<span class="title function_">toBe</span>(<span class="string">&#x27;BUTTON&#x27;</span>) <span class="comment">//æ ‡ç­¾åæ˜¯å¦ä¸º BUTTON</span></span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">type</span>).<span class="title function_">toBe</span>(<span class="string">&#x27;submit&#x27;</span>) <span class="comment">//type å±æ€§æ˜¯å¦ä¸º submit</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// tag å±æ€§çš„æ ‡ç­¾åæµ‹è¯•</span></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;å½“ tag è¢«è®¾ç½®ä¸º a æ—¶ï¼Œç»„ä»¶çš„æ ¹å…ƒç´ ä¸º &lt;a&gt; æ ‡ç­¾&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Button</span>, &#123;</span><br><span class="line"><span class="attr">props</span>: &#123; <span class="attr">tag</span>: <span class="string">&#x27;a&#x27;</span> &#125;, <span class="comment">//æŒ‚è½½ç»„ä»¶å¹¶è®¾ç½® tag ä¸º a</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">tagName</span>.<span class="title function_">toLowerCase</span>()).<span class="title function_">toBe</span>(<span class="string">&#x27;a&#x27;</span>) <span class="comment">//æ–­è¨€æ ‡ç­¾åæ˜¯å¦ä¸º aï¼ˆå°å†™ï¼‰</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// click äº‹ä»¶æµ‹è¯•</span></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;ç‚¹å‡»æŒ‰é’®æ—¶è§¦å‘ click äº‹ä»¶&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Button</span>)</span><br><span class="line"><span class="keyword">await</span> wrapper.<span class="title function_">trigger</span>(<span class="string">&#x27;click&#x27;</span>) <span class="comment">//ä½¿ç”¨ trigger(&#x27;click&#x27;) æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶ï¼ˆéœ€ await ç¡®ä¿å¼‚æ­¥å®Œæˆï¼‰</span></span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>().<span class="property">click</span>).<span class="title function_">toHaveLength</span>(<span class="number">1</span>) <span class="comment">//æ–­è¨€ emitted().click æ˜¯å¦æœ‰ 1 æ¬¡è§¦å‘</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Button-vue"><a href="#â”œâ”€-Button-vue" class="headerlink" title="â”œâ”€ Button.vue"></a>â”œâ”€ Button.vue</h4><blockquote><p>ç»„ä»¶å®ç°</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, computed, inject &#125; from &quot;vue&quot;;//å“åº”å¼,è®¡ç®—,ä¸Šä¸‹æ–‡ä¾èµ–é¡¹æ³¨å…¥</span><br><span class="line">import type &#123; ButtonProps, ButtonEmits, ButtonInstance &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; BUTTON_GROUP_CTX_KEY &#125; from &quot;./constants&quot;;//æ ‡è¯†æŒ‰é’®ç»„ä¸Šä¸‹æ–‡</span><br><span class="line">import &#123; throttle &#125; from &quot;lodash-es&quot;;//èŠ‚æµäº‹ä»¶å¤„ç†</span><br><span class="line">import TyIcon from &quot;../Icon/Icon.vue&quot;;//è‡ªå®šä¹‰çš„å›¾æ ‡ç»„ä»¶TyIcon</span><br><span class="line">defineOptions(&#123;//å®šä¹‰ç»„ä»¶çš„åç§°ä¸º ErButton</span><br><span class="line">  name: &quot;ErButton&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;ButtonProps&gt;(), &#123;//å®šä¹‰ç»„ä»¶çš„props+è®¾ç½®é»˜è®¤å€¼</span><br><span class="line">  tag: &quot;button&quot;,//HTML æ ‡ç­¾å</span><br><span class="line">  nativeType: &quot;button&quot;,//åŸç”ŸæŒ‰é’®ç±»å‹</span><br><span class="line">  useThrottle: true,//å¯ç”¨èŠ‚æµ</span><br><span class="line">  throttleDuration: 500,//èŠ‚æµæŒç»­æ—¶é—´</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;ButtonEmits&gt;();//äº‹ä»¶å‘å°„å™¨</span><br><span class="line">const slots = defineSlots();//æ’æ§½ï¼Œç”¨äºåŠ¨æ€æ¸²æŸ“å†…å®¹</span><br><span class="line">const buttonGroupCtx = inject(BUTTON_GROUP_CTX_KEY, void 0);//æ³¨å…¥æŒ‰é’®ç»„ä¸Šä¸‹æ–‡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œç”¨äºç»§æ‰¿æŒ‰é’®ç»„çš„é…ç½®ï¼ˆå¦‚ sizeã€type ç­‰ï¼‰</span><br><span class="line"></span><br><span class="line">const _ref = ref&lt;HTMLButtonElement&gt;();</span><br><span class="line">//è®¡ç®—å±æ€§ sizeï¼Œä¼˜å…ˆä½¿ç”¨æŒ‰é’®ç»„ä¸Šä¸‹æ–‡ä¸­çš„ sizeï¼Œå…¶æ¬¡ä½¿ç”¨ props.sizeï¼Œæœ€åä¸ºç©ºå­—ç¬¦ä¸²</span><br><span class="line">const size = computed(() =&gt; buttonGroupCtx?.size ?? props.size ?? &quot;&quot;);</span><br><span class="line">//è®¡ç®—å±æ€§ typeï¼Œä¼˜å…ˆä½¿ç”¨æŒ‰é’®ç»„ä¸Šä¸‹æ–‡ä¸­çš„ typeï¼Œå…¶æ¬¡ä½¿ç”¨ props.typeï¼Œæœ€åä¸ºç©ºå­—ç¬¦ä¸²</span><br><span class="line">const type = computed(() =&gt; buttonGroupCtx?.type ?? props.type ?? &quot;&quot;);</span><br><span class="line">//å®šä¹‰è®¡ç®—å±æ€§ disabledï¼Œä¼˜å…ˆä½¿ç”¨ props.disabledï¼Œå…¶æ¬¡ä½¿ç”¨æŒ‰é’®ç»„ä¸Šä¸‹æ–‡ä¸­çš„ disabledï¼Œæœ€åä¸º false</span><br><span class="line">const disabled = computed(() =&gt; props.disabled || buttonGroupCtx?.disabled || false);</span><br><span class="line">//è®¡ç®—å±æ€§ iconStyleï¼Œå½“æŒ‰é’®æœ‰é»˜è®¤æ’æ§½å†…å®¹æ—¶ï¼Œå›¾æ ‡å³ä¾§æ·»åŠ  6px çš„é—´è·ï¼Œå¦åˆ™ä¸æ·»åŠ é—´è·</span><br><span class="line">const iconStyle = computed(() =&gt; (&#123;marginRight: slots.default ? &quot;6px&quot; : &quot;0px&quot;,&#125;));</span><br><span class="line"></span><br><span class="line">//è§¦å‘ click äº‹ä»¶å¹¶å°†äº‹ä»¶å¯¹è±¡ä¼ é€’ç»™çˆ¶ç»„ä»¶</span><br><span class="line">const handleBtnClick = (e: MouseEvent) =&gt; &#123;</span><br><span class="line">  emits(&quot;click&quot;, e);</span><br><span class="line">&#125;;</span><br><span class="line">//ä½¿ç”¨ throttle å¯¹ handleBtnClick è¿›è¡ŒèŠ‚æµï¼Œé™åˆ¶ç‚¹å‡»äº‹ä»¶çš„è§¦å‘é¢‘ç‡</span><br><span class="line">const handlBtneCLickThrottle = throttle(handleBtnClick, props.throttleDuration);</span><br><span class="line"></span><br><span class="line">//æš´éœ²ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€å’Œæ–¹æ³•ï¼Œä¾›çˆ¶ç»„ä»¶é€šè¿‡ ref è®¿é—®</span><br><span class="line">defineExpose&lt;ButtonInstance&gt;(&#123;</span><br><span class="line">  ref: _ref,</span><br><span class="line">  disabled,</span><br><span class="line">  size,</span><br><span class="line">  type,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;component</span><br><span class="line">    :is=&quot;tag&quot;//åŠ¨æ€å†³å®šç»„ä»¶çš„æ ¹æ ‡ç­¾ç±»å‹ï¼ˆbutton/aï¼‰</span><br><span class="line">    ref=&quot;_ref&quot;//ä¸ºç»„ä»¶å®ä¾‹ç»‘å®šä¸€ä¸ªå¼•ç”¨`ref`ï¼ˆå¯é€šè¿‡Â `this.$refs._ref`Â è·å–åˆ°è¯¥æŒ‰é’®çš„ DOM å…ƒç´ ï¼‰</span><br><span class="line">    class=&quot;er-button&quot;</span><br><span class="line">    :class=&quot;&#123;//ä½¿ç”¨å¯¹è±¡è¯­æ³•åŠ¨æ€ç»‘å®šç±»å</span><br><span class="line">      [`er-button--$&#123;type&#125;`]: type, //å½“Â `type`Â å­˜åœ¨æ—¶ï¼ˆå¦‚Â `primary`ã€`success`ï¼‰ï¼Œæ·»åŠ ç±»åÂ `er-button--primary`</span><br><span class="line">      [`er-button--$&#123;size&#125;`]: size, //å½“Â `size`Â å­˜åœ¨æ—¶ï¼ˆå¦‚Â `large`ã€`small`ï¼‰ï¼Œæ·»åŠ ç±»åÂ `er-button--large`</span><br><span class="line">      &#x27;is-plain&#x27;: plain, //å½“Â plainÂ ä¸ºÂ trueÂ æ—¶ï¼Œæ·»åŠ ç±»åÂ `is-plain`</span><br><span class="line">      &#x27;is-round&#x27;: round, //å½“ round ä¸º true æ—¶ï¼Œæ·»åŠ ç±»å `is-round`</span><br><span class="line">      &#x27;is-circle&#x27;: circle,</span><br><span class="line">      &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">      &#x27;is-loading&#x27;: loading,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">    :disabled=&quot;disabled || loading ? true : void 0&quot; //`disabled`Â ä¸ºÂ `true`ï¼Œåˆ™æ¸²æŸ“ä¸ºÂ `&lt;button disabled&gt;`æŒ‰é’®è¢«ç¦ç”¨</span><br><span class="line">    :type=&quot;tag === &#x27;button&#x27; ? nativeType : void 0&quot;</span><br><span class="line">    :autofocus=&quot;autofocus&quot; //å½“Â `autofocus`Â ä¸ºÂ `true`Â æ—¶ï¼ŒæŒ‰é’®è‡ªåŠ¨è·å¾—ç„¦ç‚¹</span><br><span class="line">    @click=&quot;</span><br><span class="line">      (e: MouseEvent) =&gt;</span><br><span class="line">        useThrottle ? handlBtneCLickThrottle(e) : handleBtnClick(e)</span><br><span class="line">    &quot; //å½“Â `useThrottle`Â ä¸ºÂ `true`Â æ—¶ï¼Œè°ƒç”¨é˜²æŠ–çš„Â `handlBtneCLickThrottle`Â æ–¹æ³•ï¼›å¦åˆ™è°ƒç”¨æ™®é€šç‚¹å‡»äº‹ä»¶Â `handleBtnClick`</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;template v-if=&quot;loading&quot;&gt;//æ¡ä»¶æ’æ§½</span><br><span class="line">      &lt;slot name=&quot;loading&quot;&gt;//é»˜è®¤ || æ¥æ”¶ç”¨æˆ·ä¼ æ¥çš„&lt;er-icon&gt;æ ‡ç­¾</span><br><span class="line">        &lt;er-icon//é»˜è®¤æä¾›spinneråŠ è½½å›¾æ ‡</span><br><span class="line">          class=&quot;loading-icon&quot;</span><br><span class="line">          :icon=&quot;loadingIcon ?? &#x27;spinner&#x27;&quot;//ä¸æ˜¯åº“ä¸­çš„Iconå°±é»˜è®¤å›¾æ ‡ä¸ºspinner</span><br><span class="line">          :style=&quot;iconStyle&quot;//é»˜è®¤styleï¼Œç”¨æˆ·å¯æ”¹</span><br><span class="line">          size=&quot;1x&quot;//é”å®šçš„å¤§å°</span><br><span class="line">          spin//</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;er-icon</span><br><span class="line">      :icon=&quot;icon&quot;</span><br><span class="line">      size=&quot;1x&quot;</span><br><span class="line">      :style=&quot;iconStyle&quot;</span><br><span class="line">      v-if=&quot;icon &amp;&amp; !loading&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/component&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-ButtonGroup-vue"><a href="#â”œâ”€-ButtonGroup-vue" class="headerlink" title="â”œâ”€ ButtonGroup.vue"></a>â”œâ”€ ButtonGroup.vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; ButtonGroupProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; provide, reactive, toRef &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; BUTTON_GROUP_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErButtonGroup&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const props = defineProps&lt;ButtonGroupProps&gt;();</span><br><span class="line"></span><br><span class="line">provide(</span><br><span class="line">  BUTTON_GROUP_CTX_KEY,</span><br><span class="line">  reactive(&#123;</span><br><span class="line">    size: toRef(props, &quot;size&quot;),</span><br><span class="line">    type: toRef(props, &quot;type&quot;),</span><br><span class="line">    disabled: toRef(props, &quot;disabled&quot;),</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;er-button-group&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-constants-ts"><a href="#â”œâ”€-constants-ts" class="headerlink" title="â”œâ”€ constants.ts"></a>â”œâ”€ constants.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ButtonGroupContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨å…¥é”®ï¼ˆInjection Keyï¼‰ï¼ˆBUTTON_GROUP_CTX_KEYï¼‰</span></span><br><span class="line"><span class="comment">//ä¸»è¦ä½œç”¨æ˜¯ä¸ºæŒ‰é’®ç»„ç»„ä»¶ï¼ˆ`ButtonGroup`ï¼‰æä¾›ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ï¼Œä½¿å¾—æŒ‰é’®ç»„ä¸­çš„å­æŒ‰é’®å¯ä»¥è®¿é—®çˆ¶çº§æŒ‰é’®ç»„çš„ç›¸å…³ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">BUTTON_GROUP_CTX_KEY</span>: </span><br><span class="line"><span class="title class_">InjectionKey</span>&lt;<span class="title class_">ButtonGroupContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;buttonGroupContext&quot;</span>);<span class="comment">//åŸå§‹æ•°æ®ç±»å‹ï¼Œç”¨äºåˆ›å»ºå”¯ä¸€çš„æ ‡è¯†ç¬¦</span></span><br></pre></td></tr></table></figure><p>ä¸¾ä¸ªä¾‹å­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çˆ¶ç»„ä»¶</span></span><br><span class="line"><span class="comment">//ä¼šä½¿ç”¨ `provide` æ–¹æ³•å°†æŸäº›æ•°æ®æˆ–æ–¹æ³•æä¾›ç»™å­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> &#123; provide &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>; </span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">BUTTON_GROUP_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constants&quot;</span>; </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; </span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123; </span><br><span class="line"><span class="keyword">const</span> buttonGroupContext = &#123; <span class="attr">size</span>: <span class="string">&quot;large&quot;</span>, <span class="attr">type</span>: <span class="string">&quot;primary&quot;</span>, &#125;; </span><br><span class="line"><span class="title function_">provide</span>(<span class="variable constant_">BUTTON_GROUP_CTX_KEY</span>, buttonGroupContext); <span class="comment">// æä¾›ä¸Šä¸‹æ–‡ </span></span><br><span class="line"><span class="keyword">return</span> &#123;&#125;; </span><br><span class="line">&#125;, </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å­ç»„ä»¶</span></span><br><span class="line"><span class="comment">//å¯ä»¥é€šè¿‡ `inject` æ–¹æ³•è·å–çˆ¶ç»„ä»¶æä¾›çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">BUTTON_GROUP_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constants&quot;</span>; </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123; </span><br><span class="line"><span class="keyword">const</span> buttonGroupContext = <span class="title function_">inject</span>(<span class="variable constant_">BUTTON_GROUP_CTX_KEY</span>); <span class="comment">// æ³¨å…¥ä¸Šä¸‹æ–‡ </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buttonGroupContext); <span class="comment">// è¾“å‡º &#123; size: &quot;large&quot;, type: &quot;primary&quot; &#125; </span></span><br><span class="line"><span class="keyword">return</span> &#123;&#125;; </span><br><span class="line">&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-index-ts-2"><a href="#â”œâ”€-index-ts-2" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote><p>ç”¨ <code>withInstall</code> æ–¹æ³•å°†ç»„ä»¶æ³¨å†Œä¸ºå…¨å±€ç»„ä»¶</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Button</span> <span class="keyword">from</span> <span class="string">&quot;./Button.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ButtonGroup</span> <span class="keyword">from</span> <span class="string">&quot;./ButtonGroup.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@tyche/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErButton</span> = <span class="title function_">withInstall</span>(<span class="title class_">Button</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErButtonGroup</span> = <span class="title function_">withInstall</span>(<span class="title class_">ButtonGroup</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-1"><a href="#â”œâ”€-style-css-1" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-1"><a href="#â””â”€-types-ts-1" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Component</span>, <span class="keyword">type</span> <span class="title class_">ComputedRef</span>, <span class="keyword">type</span> <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ButtonType</span> = <span class="string">&#x27;primary&#x27;</span> | <span class="string">&#x27;success&#x27;</span> | <span class="string">&#x27;warning&#x27;</span> | <span class="string">&#x27;danger&#x27;</span> | <span class="string">&#x27;info&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NativeType</span> = <span class="string">&#x27;button&#x27;</span> | <span class="string">&#x27;submit&#x27;</span> | <span class="string">&#x27;reset&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ButtonSize</span> = <span class="string">&#x27;default&#x27;</span> | <span class="string">&#x27;large&#x27;</span> | <span class="string">&#x27;small&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonProps</span> &#123;</span><br><span class="line"><span class="attr">tag</span>?: <span class="built_in">string</span> | <span class="title class_">Component</span></span><br><span class="line"><span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line"><span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line"><span class="attr">plain</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">round</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">circle</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">autofocus</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">nativeType</span>?: <span class="title class_">NativeType</span></span><br><span class="line"><span class="attr">icon</span>?: <span class="built_in">string</span></span><br><span class="line"><span class="attr">loading</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">loadingIcon</span>?: <span class="built_in">string</span></span><br><span class="line"><span class="attr">useThrottle</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">throttleDuration</span>?: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonGroupProps</span> &#123;</span><br><span class="line"><span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line"><span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line"><span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonGroupContext</span> &#123;</span><br><span class="line"><span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line"><span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line"><span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonEmits</span> &#123;</span><br><span class="line">(<span class="attr">e</span>: <span class="string">&#x27;click&#x27;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonInstance</span> &#123;</span><br><span class="line"><span class="attr">ref</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">HTMLButtonElement</span> | <span class="built_in">void</span>&gt;</span><br><span class="line"><span class="attr">disabled</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">boolean</span>&gt;</span><br><span class="line"><span class="attr">size</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line"><span class="attr">type</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Collapse"><a href="#â”œâ”€-Collapse" class="headerlink" title="â”œâ”€ Collapse"></a>â”œâ”€ Collapse</h3><blockquote><p>æŠ˜å é¢æ¿</p></blockquote><h4 id="â€“APIâ€“-2"><a href="#â€“APIâ€“-2" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-Collapse-test-tsx"><a href="#â”œâ”€-Collapse-test-tsx" class="headerlink" title="â”œâ”€ Collapse.test.tsx"></a>â”œâ”€ Collapse.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; beforeAll, describe, expect, test, vi &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DOMWrapper</span>, mount, <span class="keyword">type</span> <span class="title class_">VueWrapper</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> transitionEvents <span class="keyword">from</span> <span class="string">&quot;./transitionEvents&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Collapse</span> <span class="keyword">from</span> <span class="string">&quot;./Collapse.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CollapseItem</span> <span class="keyword">from</span> <span class="string">&quot;./CollapseItem.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> onChange = vi.<span class="title function_">fn</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">wrapper</span>: <span class="title class_">VueWrapper</span>,</span><br><span class="line">  <span class="attr">headers</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;[],</span><br><span class="line">  <span class="attr">contents</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;[];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">firstHeader</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;,</span><br><span class="line">  <span class="attr">secondHeader</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;,</span><br><span class="line">  <span class="attr">disabledHeader</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;,</span><br><span class="line">  <span class="attr">firstContent</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;,</span><br><span class="line">  <span class="attr">secondContent</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;,</span><br><span class="line">  <span class="attr">disabledContent</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Collapse.vue&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">beforeAll</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    wrapper = <span class="title function_">mount</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Collapse</span> <span class="attr">modelValue</span>=<span class="string">&#123;[</span>&quot;<span class="attr">a</span>&quot;]&#125; &#123;<span class="attr">...</span>&#123; <span class="attr">onChange</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title a&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content a</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;b&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title b&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content b</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;c&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title c&quot;</span> <span class="attr">disabled</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content c</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Collapse</span>&gt;</span></span></span><br><span class="line">      ),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">global</span>: &#123;</span><br><span class="line">          <span class="attr">stubs</span>: [<span class="string">&quot;ErIcon&quot;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">attachTo</span>: <span class="variable language_">document</span>.<span class="property">body</span>, <span class="comment">// æœ€æ–°ç‰ˆæœ¬ jsdom æ›´æ–°ç¼“å­˜ bug</span></span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    headers = wrapper.<span class="title function_">findAll</span>(<span class="string">&quot;.er-collapse-item__header&quot;</span>);</span><br><span class="line">    contents = wrapper.<span class="title function_">findAll</span>(<span class="string">&quot;.er-collapse-item__wapper&quot;</span>);</span><br><span class="line"></span><br><span class="line">    firstHeader = headers[<span class="number">0</span>];</span><br><span class="line">    secondHeader = headers[<span class="number">1</span>];</span><br><span class="line">    disabledHeader = headers[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    firstContent = contents[<span class="number">0</span>];</span><br><span class="line">    secondContent = contents[<span class="number">1</span>];</span><br><span class="line">    disabledContent = contents[<span class="number">2</span>];</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;æµ‹è¯•åŸºç¡€ç»“æ„ä»¥åŠå¯¹åº”æ–‡æœ¬&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// lenght</span></span><br><span class="line">    <span class="title function_">expect</span>(headers.<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="title function_">expect</span>(contents.<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// title</span></span><br><span class="line">    <span class="title function_">expect</span>(firstHeader.<span class="title function_">text</span>()).<span class="title function_">toBe</span>(<span class="string">&quot;title a&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// content</span></span><br><span class="line">    <span class="title function_">expect</span>(firstHeader.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(firstContent.<span class="title function_">isVisible</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(secondHeader.<span class="title function_">classes</span>()).<span class="property">not</span>.<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(secondContent.<span class="title function_">isVisible</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(firstContent.<span class="title function_">text</span>()).<span class="title function_">toBe</span>(<span class="string">&quot;content a&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(secondContent.<span class="title function_">text</span>()).<span class="title function_">toBe</span>(<span class="string">&quot;content b&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;ç‚¹å‡»æ ‡é¢˜å±•å¼€/å…³é—­å†…å®¹&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// events</span></span><br><span class="line">    <span class="keyword">await</span> firstHeader.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(firstContent.<span class="title function_">isVisible</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="keyword">await</span> secondHeader.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(secondHeader.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(secondHeader.<span class="title function_">isVisible</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(firstHeader.<span class="title function_">classes</span>()).<span class="property">not</span>.<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(firstContent.<span class="title function_">isVisible</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;å‘é€æ­£ç¡®çš„äº‹ä»¶&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(onChange).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onChange).<span class="title function_">toHaveBeenCalledWith</span>([]);</span><br><span class="line">    <span class="title function_">expect</span>(onChange).<span class="title function_">toHaveBeenLastCalledWith</span>([<span class="string">&quot;b&quot;</span>]);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;disabled å†…å®¹&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// disabled</span></span><br><span class="line">    <span class="title function_">expect</span>(disabledHeader.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-disabled&quot;</span>);</span><br><span class="line">    onChange.<span class="title function_">mockClear</span>();</span><br><span class="line">    <span class="keyword">await</span> disabledHeader.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(disabledContent.<span class="title function_">isVisible</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onChange).<span class="property">not</span>.<span class="title function_">toHaveBeenCalled</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;modelValue å˜æ›´&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    wrapper.<span class="title function_">setValue</span>([<span class="string">&quot;b&quot;</span>], <span class="string">&quot;modelValue&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="property">vm</span>.$nextTick();</span><br><span class="line">    <span class="title function_">expect</span>(secondHeader.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(firstHeader.<span class="title function_">classes</span>()).<span class="property">not</span>.<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;æ‰‹é£ç´æ¨¡å¼&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    wrapper = <span class="title function_">mount</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Collapse</span> <span class="attr">accordion</span> <span class="attr">modelValue</span>=<span class="string">&#123;[</span>&quot;<span class="attr">a</span>&quot;]&#125; &#123;<span class="attr">...</span>&#123; <span class="attr">onChange</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title a&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content a</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;b&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title b&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content b</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Collapse</span>&gt;</span></span></span><br><span class="line">      ),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">global</span>: &#123;</span><br><span class="line">          <span class="attr">stubs</span>: [<span class="string">&quot;ErIcon&quot;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">attachTo</span>: <span class="variable language_">document</span>.<span class="property">body</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    headers = wrapper.<span class="title function_">findAll</span>(<span class="string">&quot;.er-collapse-item__header&quot;</span>);</span><br><span class="line">    contents = wrapper.<span class="title function_">findAll</span>(<span class="string">&quot;.er-collapse-item__wapper&quot;</span>);</span><br><span class="line"></span><br><span class="line">    firstHeader = headers[<span class="number">0</span>];</span><br><span class="line">    secondHeader = headers[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    firstContent = contents[<span class="number">0</span>];</span><br><span class="line">    secondContent = contents[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">await</span> firstHeader.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> secondHeader.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onChange).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onChange).<span class="title function_">toHaveBeenCalledWith</span>([<span class="string">&quot;b&quot;</span>]);</span><br><span class="line">    <span class="title function_">expect</span>(firstHeader.<span class="title function_">classes</span>()).<span class="property">not</span>.<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(secondHeader.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;æ‰‹é£ç´æ¨¡å¼ é”™è¯¯å¤„ç†&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> warn = vi.<span class="title function_">spyOn</span>(<span class="variable language_">console</span>, <span class="string">&quot;warn&quot;</span>).<span class="title function_">mockImplementation</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">    <span class="title function_">mount</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Collapse</span> <span class="attr">accordion</span> <span class="attr">modelValue</span>=<span class="string">&#123;[</span>&quot;<span class="attr">a</span>&quot;, &quot;<span class="attr">b</span>&quot;]&#125; &#123;<span class="attr">...</span>&#123; <span class="attr">onChange</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title a&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content a</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;b&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title b&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content b</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;c&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title c&quot;</span> <span class="attr">disabled</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content c</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Collapse</span>&gt;</span></span></span><br><span class="line">      ),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">global</span>: &#123;</span><br><span class="line">          <span class="attr">stubs</span>: [<span class="string">&quot;ErIcon&quot;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">    <span class="title function_">expect</span>(warn.<span class="property">mock</span>.<span class="property">calls</span>).<span class="title function_">toMatchInlineSnapshot</span>(</span><br><span class="line">      <span class="string">`</span></span><br><span class="line"><span class="string">        [</span></span><br><span class="line"><span class="string">          [</span></span><br><span class="line"><span class="string">            [ErUIError: [ErCollapse] accordion mode should only have one active item],</span></span><br><span class="line"><span class="string">          ],</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      `</span></span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Collapse/transitionEvents.ts&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;beforeEnter&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    transitionEvents.<span class="title function_">beforeEnter</span>(wrapper.<span class="property">element</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">height</span>).<span class="title function_">toBe</span>(<span class="string">&quot;0px&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">overflow</span>).<span class="title function_">toBe</span>(<span class="string">&quot;hidden&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;enter&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    transitionEvents.<span class="title function_">enter</span>(wrapper.<span class="property">element</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">height</span>).<span class="title function_">toBe</span>(</span><br><span class="line">      <span class="string">`<span class="subst">$&#123;wrapper.element.scrollHeight&#125;</span>px`</span></span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;afterEnter&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    transitionEvents.<span class="title function_">afterEnter</span>(wrapper.<span class="property">element</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">height</span>).<span class="title function_">toBe</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">overflow</span>).<span class="title function_">toBe</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;beforeLeave&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    transitionEvents.<span class="title function_">beforeLeave</span>(wrapper.<span class="property">element</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">height</span>).<span class="title function_">toBe</span>(</span><br><span class="line">      <span class="string">`<span class="subst">$&#123;wrapper.element.scrollHeight&#125;</span>px`</span></span><br><span class="line">    );</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">overflow</span>).<span class="title function_">toBe</span>(<span class="string">&quot;hidden&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;leave&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    transitionEvents.<span class="title function_">leave</span>(wrapper.<span class="property">element</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">height</span>).<span class="title function_">toBe</span>(<span class="string">&quot;0px&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;afterLeave&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    transitionEvents.<span class="title function_">afterLeave</span>(wrapper.<span class="property">element</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">height</span>).<span class="title function_">toBe</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">overflow</span>).<span class="title function_">toBe</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Collapse-vue"><a href="#â”œâ”€-Collapse-vue" class="headerlink" title="â”œâ”€ Collapse.vue"></a>â”œâ”€ Collapse.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, provide, watch &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; each &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import type &#123;</span><br><span class="line">  CollapseItemName,</span><br><span class="line">  CollapseProps,</span><br><span class="line">  CollapseEmits,</span><br><span class="line">&#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; debugWarn &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import &#123; COLLAPSE_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line"></span><br><span class="line">const COMPONENT_NAME = &quot;ErCollapse&quot; as const;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: COMPONENT_NAME,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const props = defineProps&lt;CollapseProps&gt;();</span><br><span class="line">const emits = defineEmits&lt;CollapseEmits&gt;();</span><br><span class="line">const activeNames = ref&lt;CollapseItemName[]&gt;(props.modelValue);</span><br><span class="line"></span><br><span class="line">if (props.accordion &amp;&amp; activeNames.value.length &gt; 1) &#123;</span><br><span class="line">  debugWarn(COMPONENT_NAME, &quot;accordion mode should only have one active item&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleItemClick(item: CollapseItemName) &#123;</span><br><span class="line">  let _activeNames = [...activeNames.value];</span><br><span class="line">  // æ‰‹é£ç´æ¨¡å¼</span><br><span class="line">  if (props.accordion) &#123;</span><br><span class="line">    _activeNames = [_activeNames[0] === item ? &quot;&quot; : item];</span><br><span class="line">    updateActiveNames(_activeNames);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const index = _activeNames.indexOf(item);</span><br><span class="line">  if (index &gt; -1) &#123;</span><br><span class="line">    // å­˜åœ¨ï¼Œåˆ é™¤æ•°ç»„ä¸­çš„ä¸€é¡¹</span><br><span class="line">    _activeNames.splice(index, 1);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // ä¸å­˜åœ¨ï¼Œæ’å…¥å¯¹åº” name</span><br><span class="line">    _activeNames.push(item);</span><br><span class="line">  &#125;</span><br><span class="line">  updateActiveNames(_activeNames);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function updateActiveNames(val: CollapseItemName[]) &#123;</span><br><span class="line">  activeNames.value = val;</span><br><span class="line">  each([&quot;update:modelValue&quot;, &quot;change&quot;], (e) =&gt;</span><br><span class="line">    emits(e as &quot;update:modelValue&quot; &amp; &quot;change&quot;, val)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.modelValue,</span><br><span class="line">  (val) =&gt; updateActiveNames(val)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">provide(COLLAPSE_CTX_KEY, &#123;</span><br><span class="line">  activeNames,</span><br><span class="line">  handleItemClick,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;er-collapse&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-CollapseItem-vue"><a href="#â”œâ”€-CollapseItem-vue" class="headerlink" title="â”œâ”€ CollapseItem.vue"></a>â”œâ”€ CollapseItem.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; type CollapseItemProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; inject, computed &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; COLLAPSE_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line">import transitionEvents from &quot;./transitionEvents&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErCollapseItem&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const props = defineProps&lt;CollapseItemProps&gt;();</span><br><span class="line"></span><br><span class="line">const ctx = inject(COLLAPSE_CTX_KEY);</span><br><span class="line"></span><br><span class="line">const isActive = computed(() =&gt; ctx?.activeNames.value?.includes(props.name));</span><br><span class="line"></span><br><span class="line">function handleClick() &#123;</span><br><span class="line">  if (props.disabled) return;</span><br><span class="line">  ctx?.handleItemClick(props.name);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;er-collapse-item&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;er-collapse-item__header&quot;</span><br><span class="line">      :id=&quot;`item-header-$&#123;name&#125;`&quot;</span><br><span class="line">      :class=&quot;&#123;</span><br><span class="line">        &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">        &#x27;is-active&#x27;: isActive,</span><br><span class="line">      &#125;&quot;</span><br><span class="line">      @click=&quot;handleClick&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;span class=&quot;er-collapse-item__title&quot;&gt;</span><br><span class="line">        &lt;slot name=&quot;title&quot;&gt;</span><br><span class="line">          &#123;&#123; title &#125;&#125;</span><br><span class="line">        &lt;/slot&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      &lt;er-icon icon=&quot;angle-right&quot; class=&quot;header-angle&quot; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;transition name=&quot;slide&quot; v-on=&quot;transitionEvents&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;er-collapse-item__wapper&quot; v-show=&quot;isActive&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;er-collapse-item__content&quot; :id=&quot;`item-content-$&#123;name&#125;`&quot;&gt;</span><br><span class="line">          &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-constants-ts-1"><a href="#â”œâ”€-constants-ts-1" class="headerlink" title="â”œâ”€ constants.ts"></a>â”œâ”€ constants.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">CollapseContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">COLLAPSE_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">CollapseContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;collapseContext&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-index-ts-3"><a href="#â”œâ”€-index-ts-3" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Collapse</span> <span class="keyword">from</span> <span class="string">&quot;./Collapse.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CollapseItem</span> <span class="keyword">from</span> <span class="string">&quot;./CollapseItem.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErCollapse</span> = <span class="title function_">withInstall</span>(<span class="title class_">Collapse</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErCollapseItem</span> = <span class="title function_">withInstall</span>(<span class="title class_">CollapseItem</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-2"><a href="#â”œâ”€-style-css-2" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-collapse</span> &#123;</span><br><span class="line">  <span class="attr">--er-collapse-border-color</span>: <span class="built_in">var</span>(--er-border-color-light);</span><br><span class="line">  <span class="attr">--er-collapse-header-height</span>: <span class="number">48px</span>;</span><br><span class="line">  <span class="attr">--er-collapse-header-bg-color</span>: <span class="built_in">var</span>(--er-fill-color-blank);</span><br><span class="line">  <span class="attr">--er-collapse-header-text-color</span>: <span class="built_in">var</span>(--er-text-color-primary);</span><br><span class="line">  <span class="attr">--er-collapse-header-font-size</span>: <span class="number">13px</span>;</span><br><span class="line">  <span class="attr">--er-collapse-content-bg-color</span>: <span class="built_in">var</span>(--er-fill-color-blank);</span><br><span class="line">  <span class="attr">--er-collapse-content-font-size</span>: <span class="number">13px</span>;</span><br><span class="line">  <span class="attr">--er-collapse-content-text-color</span>: <span class="built_in">var</span>(--er-text-color-primary);</span><br><span class="line">  <span class="attr">--er-collapse-disabled-text-color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">  <span class="attr">--er-collapse-disabled-border-color</span>: <span class="built_in">var</span>(--er-border-color-lighter);</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-collapse-border-color);</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-collapse-border-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-collapse-item__header</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">height</span>: <span class="built_in">var</span>(--er-collapse-header-height);</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="built_in">var</span>(--er-collapse-header-height);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-collapse-header-bg-color);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--er-collapse-header-text-color);</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-collapse-header-font-size);</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">  <span class="attribute">transition</span>: border-bottom-color <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-collapse-border-color);</span><br><span class="line">  &amp;<span class="selector-class">.is-disabled</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-collapse-disabled-text-color);</span><br><span class="line">    <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    <span class="attribute">background-image</span>: none;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-active</span> &#123;</span><br><span class="line">    <span class="attribute">border-bottom-color</span>: transparent;</span><br><span class="line">    <span class="selector-class">.header-angle</span> &#123;</span><br><span class="line">      <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">90deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.header-angle</span> &#123;</span><br><span class="line">    <span class="attribute">transition</span>: transform <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-collapse-item__content</span> &#123;</span><br><span class="line">  <span class="attribute">will-change</span>: height;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-collapse-content-bg-color);</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-collapse-content-font-size);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--er-collapse-content-text-color);</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-collapse-border-color);</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">25px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.slide-enter-active</span>,</span><br><span class="line"><span class="selector-class">.slide-leave-active</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: height <span class="built_in">var</span>(--er-transition-duration) ease-in-out;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-transitionEvents-ts"><a href="#â”œâ”€-transitionEvents-ts" class="headerlink" title="â”œâ”€ transitionEvents.ts"></a>â”œâ”€ transitionEvents.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">_setHeightZero</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;0px&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setHeightScroll</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt;</span><br><span class="line">  (el.<span class="property">style</span>.<span class="property">height</span> = <span class="string">`<span class="subst">$&#123;el.scrollHeight&#125;</span>px`</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setHeightEmpty</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setOverflowHidden</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&quot;hidden&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setOverflowEmpty</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">transitionEvents</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="function">(<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt;</span> <span class="built_in">void</span>&gt; = &#123;</span><br><span class="line">  <span class="title function_">beforeEnter</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightZero</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowHidden</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">enter</span>: <span class="function">(<span class="params">el</span>) =&gt;</span> <span class="title function_">_setHeightScroll</span>(el),</span><br><span class="line">  <span class="title function_">afterEnter</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightEmpty</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowEmpty</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeLeave</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightScroll</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowHidden</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">leave</span>: <span class="function">(<span class="params">el</span>) =&gt;</span> <span class="title function_">_setHeightZero</span>(el),</span><br><span class="line">  <span class="title function_">afterLeave</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightEmpty</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowEmpty</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> transitionEvents;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-2"><a href="#â””â”€-types-ts-2" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CollapseItemName</span> = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseProps</span> &#123;</span><br><span class="line">  <span class="attr">modelValue</span>: <span class="title class_">CollapseItemName</span>[];</span><br><span class="line">  <span class="attr">accordion</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseItemProps</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="title class_">CollapseItemName</span>;</span><br><span class="line">  <span class="attr">title</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseContext</span> &#123;</span><br><span class="line">  <span class="attr">activeNames</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">CollapseItemName</span>[]&gt;;</span><br><span class="line">  <span class="title function_">handleItemClick</span>(<span class="attr">name</span>: <span class="title class_">CollapseItemName</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;update:modelValue&quot;</span>, <span class="attr">value</span>: <span class="title class_">CollapseItemName</span>[]): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;change&quot;</span>, <span class="attr">value</span>: <span class="title class_">CollapseItemName</span>[]): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-ConfigProvider"><a href="#â”œâ”€-ConfigProvider" class="headerlink" title="â”œâ”€ ConfigProvider"></a>â”œâ”€ ConfigProvider</h3><blockquote><p>å…¨å±€é…ç½®ç»„ä»¶ï¼Œç”¨äºè®¾ç½®ç»„ä»¶åº“çš„å…¨å±€å±æ€§</p></blockquote><h4 id="â€“APIâ€“-3"><a href="#â€“APIâ€“-3" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-ConfigProvider-vue"><a href="#â”œâ”€-ConfigProvider-vue" class="headerlink" title="â”œâ”€ ConfigProvider.vue"></a>â”œâ”€ ConfigProvider.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; ConfigProviderProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; provideGlobalConfig &#125; from &quot;./hooks&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErConfigProvider&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const props = defineProps&lt;ConfigProviderProps&gt;();</span><br><span class="line">const config = provideGlobalConfig(props);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;slot name=&quot;default&quot; :config=&quot;config&quot;&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-constants-ts-2"><a href="#â”œâ”€-constants-ts-2" class="headerlink" title="â”œâ”€ constants.ts"></a>â”œâ”€ constants.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ConfigProviderProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span>, <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ConfigProviderContext</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">ConfigProviderProps</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">configProviderContextKey</span>: <span class="title class_">InjectionKey</span>&lt;</span><br><span class="line">  <span class="title class_">Ref</span>&lt;<span class="title class_">ConfigProviderContext</span>&gt;</span><br><span class="line">&gt; = <span class="title class_">Symbol</span>()</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-hooks-ts"><a href="#â”œâ”€-hooks-ts" class="headerlink" title="â”œâ”€ hooks.ts"></a>â”œâ”€ hooks.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  ref,</span><br><span class="line">  getCurrentInstance,</span><br><span class="line">  inject,</span><br><span class="line">  computed,</span><br><span class="line">  provide,</span><br><span class="line">  unref,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">MaybeRef</span>, <span class="title class_">Ref</span>, <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  configProviderContextKey,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">ConfigProviderContext</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./constants&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createI18n, i18nSymbol &#125; <span class="keyword">from</span> <span class="string">&quot;vue3-i18n&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">TranslatePair</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/locale&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">English</span> <span class="keyword">from</span> <span class="string">&quot;@eric-ui/locale/lang/en&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; merge &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; debugWarn &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> globalConfig = ref&lt;<span class="title class_">ConfigProviderContext</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> useGlobalConfig&lt;</span><br><span class="line">  K <span class="keyword">extends</span> keyof <span class="title class_">ConfigProviderContext</span>,</span><br><span class="line">  D <span class="keyword">extends</span> <span class="title class_">ConfigProviderContext</span>[K],</span><br><span class="line">&gt;(<span class="attr">key</span>: K, <span class="attr">defaultVal</span>?: D): <span class="title class_">Ref</span>&lt;<span class="title class_">Exclude</span>&lt;<span class="title class_">ConfigProviderContext</span>[K], <span class="built_in">void</span>&gt;&gt;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useGlobalConfig</span>(<span class="params"></span>): <span class="title class_">Ref</span>&lt;<span class="title class_">ConfigProviderContext</span>&gt;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useGlobalConfig</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">key</span>?: keyof <span class="title class_">ConfigProviderContext</span>,</span></span><br><span class="line"><span class="params">  defaultVal = <span class="built_in">void</span> <span class="number">0</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> config = <span class="title function_">getCurrentInstance</span>()</span><br><span class="line">    ? <span class="title function_">inject</span>(configProviderContextKey, globalConfig)</span><br><span class="line">    : globalConfig;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> key ? <span class="title function_">computed</span>(<span class="function">() =&gt;</span> config.<span class="property">value</span>?.[key] ?? defaultVal) : config;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_createI18n</span> = (<span class="params"><span class="attr">opts</span>?: <span class="title class_">ConfigProviderContext</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">mergeMsg</span> = (<span class="params"><span class="attr">msg</span>: <span class="title class_">TranslatePair</span></span>) =&gt;</span><br><span class="line">    <span class="title function_">merge</span>(msg, opts?.<span class="property">extendsI18nMsg</span> ?? &#123;&#125;);</span><br><span class="line">  <span class="keyword">if</span> (!opts?.<span class="property">locale</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createI18n</span>(&#123;</span><br><span class="line">      <span class="attr">locale</span>: <span class="string">&quot;en&quot;</span>,</span><br><span class="line">      <span class="attr">messages</span>: <span class="title function_">mergeMsg</span>(&#123;</span><br><span class="line">        <span class="attr">en</span>: <span class="title class_">English</span>.<span class="property">el</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createI18n</span>(&#123;</span><br><span class="line">    <span class="attr">locale</span>: opts.<span class="property">locale</span>?.<span class="property">name</span> || <span class="string">&quot;en&quot;</span>,</span><br><span class="line">    <span class="attr">messages</span>: <span class="title function_">mergeMsg</span>(&#123;</span><br><span class="line">      [opts.<span class="property">locale</span>?.<span class="property">name</span> || <span class="string">&quot;en&quot;</span>]: opts.<span class="property">locale</span>?.<span class="property">el</span> || &#123;&#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">provideGlobalConfig</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">config</span>: <span class="title class_">MaybeRef</span>&lt;<span class="title class_">ConfigProviderContext</span>&gt; = &#123; locale: English &#125;,</span></span><br><span class="line"><span class="params">  <span class="attr">app</span>?: <span class="title class_">App</span>,</span></span><br><span class="line"><span class="params">  <span class="variable language_">global</span> = <span class="literal">false</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">getCurrentInstance</span>();</span><br><span class="line">  <span class="keyword">const</span> oldConfig = instance ? <span class="title function_">useGlobalConfig</span>() : <span class="built_in">void</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> provideFn = app?.<span class="property">provide</span> ?? (instance ? provide : <span class="built_in">void</span> <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!provideFn) &#123;</span><br><span class="line">    <span class="title function_">debugWarn</span>(</span><br><span class="line">      <span class="string">&quot;provideGlobalConfig&quot;</span>,</span><br><span class="line">      <span class="string">&quot;provideGlobalConfig() can only be used inside setup()&quot;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> context = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> cfg = <span class="title function_">unref</span>(config);</span><br><span class="line">    <span class="keyword">if</span> (!oldConfig?.<span class="property">value</span>) <span class="keyword">return</span> cfg;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(oldConfig.<span class="property">value</span>, cfg);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> i18n = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">_createI18n</span>(context.<span class="property">value</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">provideFn</span>(configProviderContextKey, context);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">provideFn</span>(i18nSymbol, i18n.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (app) app.<span class="title function_">use</span>(i18n.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">global</span> || !globalConfig.<span class="property">value</span>) globalConfig.<span class="property">value</span> = context.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-index-ts-4"><a href="#â”œâ”€-index-ts-4" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ConfigProvider</span> <span class="keyword">from</span> <span class="string">&quot;./ConfigProvider.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;withInstall&#125; <span class="keyword">from</span> <span class="string">&#x27;@eric-ui/utils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErConfigProvider</span> = <span class="title function_">withInstall</span>(<span class="title class_">ConfigProvider</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./hooks&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-3"><a href="#â””â”€-types-ts-3" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Language</span>, <span class="title class_">TranslatePair</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/locale&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ConfigProviderProps</span> &#123;</span><br><span class="line">  <span class="attr">locale</span>?: <span class="title class_">Language</span>;</span><br><span class="line">  <span class="attr">extendsI18nMsg</span>?: <span class="title class_">TranslatePair</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Dropdown"><a href="#â”œâ”€-Dropdown" class="headerlink" title="â”œâ”€ Dropdown"></a>â”œâ”€ Dropdown</h3><blockquote><p>ä¸‹æ‹‰èœå•</p></blockquote><h4 id="â€“APIâ€“-4"><a href="#â€“APIâ€“-4" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-constants-ts-3"><a href="#â”œâ”€-constants-ts-3" class="headerlink" title="â”œâ”€ constants.ts"></a>â”œâ”€ constants.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">DropdownContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">DROPDOWN_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">DropdownContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;dropdownContext&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Dropdown-test-tsx"><a href="#â”œâ”€-Dropdown-test-tsx" class="headerlink" title="â”œâ”€ Dropdown.test.tsx"></a>â”œâ”€ Dropdown.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, test, expect, vi, beforeEach &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ErDropdown</span>, <span class="title class_">ErDropdownItem</span> &#125; <span class="keyword">from</span> <span class="string">&quot;.&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">DropdownItemProps</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Dropdown</span> <span class="keyword">from</span> <span class="string">&quot;./Dropdown.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">DropdownItem</span> <span class="keyword">from</span> <span class="string">&quot;./DropdownItem.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line">vi.<span class="title function_">mock</span>(<span class="string">&quot;@popperjs/core&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Dropdown/index.ts&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æµ‹è¯• withInstall å‡½æ•°æ˜¯å¦è¢«æ­£ç¡®åº”ç”¨</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should be exported with withInstall()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErDropdown</span>.<span class="property">install</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErDropdownItem</span>.<span class="property">install</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æµ‹è¯• Dropdown ç»„ä»¶æ˜¯å¦è¢«æ­£ç¡®å¯¼å‡º</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should be exported Dropdown component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErDropdown</span>).<span class="title function_">toBe</span>(<span class="title class_">Dropdown</span>);</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErDropdownItem</span>).<span class="title function_">toBe</span>(<span class="title class_">DropdownItem</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯é€‰ï¼šæµ‹è¯• withInstall æ˜¯å¦å¢å¼ºäº† Tooltip ç»„ä»¶çš„åŠŸèƒ½</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;should enhance Dropdown component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> enhancedDropdown = <span class="title function_">withInstall</span>(<span class="title class_">Dropdown</span>);</span><br><span class="line">    <span class="title function_">expect</span>(enhancedDropdown).<span class="title function_">toBe</span>(<span class="title class_">ErDropdown</span>);</span><br><span class="line">    <span class="comment">// è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šæµ‹è¯•ï¼Œç¡®ä¿ withInstall å¢å¼ºäº†ç»„ä»¶çš„ç‰¹å®šåŠŸèƒ½</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯é€‰ï¼šå¦‚æœä½ çš„ withInstall å‡½æ•°æœ‰ç‰¹å®šçš„è¡Œä¸ºæˆ–å±æ€§ï¼Œç¡®ä¿å®ƒä»¬è¢«æ­£ç¡®åº”ç”¨</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;should apply specific enhancements&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> enhancedDropdown = <span class="title function_">withInstall</span>(<span class="title class_">Dropdown</span>);</span><br><span class="line">    <span class="comment">// ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ withInstall å¢åŠ äº†ä¸€ä¸ªç‰¹å®šçš„æ–¹æ³•æˆ–å±æ€§</span></span><br><span class="line">    <span class="title function_">expect</span>(enhancedDropdown).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;install&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Dropdown.vue&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    vi.<span class="title function_">useFakeTimers</span>();</span><br><span class="line">    vi.<span class="title function_">clearAllMocks</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should render slots correctly&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">items</span>: <span class="title class_">DropdownItemProps</span>[] = [</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&quot;Item 1&quot;</span>, <span class="attr">command</span>: <span class="string">&quot;item1&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&quot;Item 2&quot;</span>, <span class="attr">command</span>: <span class="string">&quot;item2&quot;</span> &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Dropdown</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">trigger</span>: <span class="string">&quot;click&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;trigger&quot;</span>&gt;</span>Default slot content<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>,</span><br><span class="line">        <span class="attr">dropdown</span>: <span class="function">() =&gt;</span> items.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">DropdownItem</span> &#123;<span class="attr">...item</span>&#125; /&gt;</span></span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;Default slot content&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-dropdown&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should emit command event when item is clicked&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">items</span>: <span class="title class_">DropdownItemProps</span>[] = [</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&quot;Item 1&quot;</span>, <span class="attr">disabled</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&quot;Item 2&quot;</span>, <span class="attr">command</span>: <span class="string">&quot;item2&quot;</span>, <span class="attr">divided</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">const</span> onCommand = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Dropdown</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">trigger</span>: <span class="string">&quot;click&quot;</span>,</span><br><span class="line">        onCommand,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;trigger&quot;</span>&gt;</span>Default slot content<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>,</span><br><span class="line">        <span class="attr">dropdown</span>: <span class="function">() =&gt;</span> items.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">DropdownItem</span> &#123;<span class="attr">...item</span>&#125; /&gt;</span></span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> triggerArea = wrapper.<span class="title function_">find</span>(<span class="string">&quot;#trigger&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(triggerArea.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-dropdown__menu&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">findAll</span>(<span class="string">&quot;li&quot;</span>).<span class="title function_">at</span>(<span class="number">0</span>)?.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onCommand).<span class="title function_">toBeCalledTimes</span>(<span class="number">0</span>); <span class="comment">// disabled</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">findAll</span>(<span class="string">&quot;li&quot;</span>).<span class="title function_">at</span>(<span class="number">2</span>)?.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onCommand).<span class="title function_">toBeCalled</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onCommand).<span class="title function_">toBeCalledWith</span>(<span class="string">&quot;item2&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should toggle visibility when split btn is clicked&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">items</span>: <span class="title class_">DropdownItemProps</span>[] = [</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&quot;Item 1&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&quot;Item 2&quot;</span>, <span class="attr">command</span>: <span class="string">&quot;item2&quot;</span> &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">const</span> onClick = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Dropdown</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">trigger</span>: <span class="string">&quot;click&quot;</span>,</span><br><span class="line">        <span class="attr">splitButton</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">items</span>: items,</span><br><span class="line">        onClick,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;trigger&quot;</span>&gt;</span>Default slot content<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> triggerArea = wrapper.<span class="title function_">find</span>(<span class="string">&quot;#trigger&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(triggerArea.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-dropdown__menu&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onClick).<span class="title function_">toBeCalled</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Dropdown-vue"><a href="#â”œâ”€-Dropdown-vue" class="headerlink" title="â”œâ”€ Dropdown.vue"></a>â”œâ”€ Dropdown.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, computed, provide &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; omit, isNil &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import type &#123;</span><br><span class="line">  DropdownProps,</span><br><span class="line">  DropdownEmits,</span><br><span class="line">  DropdownInstance,</span><br><span class="line">  DropdownItemProps,</span><br><span class="line">  DropdownContext,</span><br><span class="line">&#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; useId, useDisabledStyle &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; DROPDOWN_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line">import type &#123; TooltipInstance &#125; from &quot;../Tooltip/types&quot;;</span><br><span class="line"></span><br><span class="line">import &#123; type ButtonInstance, ErButton, ErButtonGroup &#125; from &quot;../Button&quot;;</span><br><span class="line">import DropdownItem from &quot;./DropdownItem.vue&quot;;</span><br><span class="line">import Tooltip from &quot;../Tooltip/Tooltip.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErDropdown&quot;,</span><br><span class="line">  inheritAttrs: false,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;DropdownProps&gt;(), &#123;</span><br><span class="line">  hideOnClick: true,</span><br><span class="line">  items: () =&gt; [] as DropdownItemProps[],</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;DropdownEmits&gt;();</span><br><span class="line">const slots = defineSlots();</span><br><span class="line"></span><br><span class="line">const tooltipRef = ref&lt;TooltipInstance&gt;();</span><br><span class="line">const triggerRef = ref&lt;ButtonInstance&gt;();</span><br><span class="line"></span><br><span class="line">const tooltipProps = computed(() =&gt;</span><br><span class="line">  omit(props, [&quot;items&quot;, &quot;hideAfterClick&quot;, &quot;size&quot;, &quot;type&quot;, &quot;splitButton&quot;])</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">function handleItemClick(e: DropdownItemProps) &#123;</span><br><span class="line">  props.hideOnClick &amp;&amp; tooltipRef.value?.hide();</span><br><span class="line">  !isNil(e.command) &amp;&amp; emits(&quot;command&quot;, e.command);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">!TEST &amp;&amp; useDisabledStyle();</span><br><span class="line">defineExpose&lt;DropdownInstance&gt;(&#123;</span><br><span class="line">  open: () =&gt; tooltipRef.value?.show(),</span><br><span class="line">  close: () =&gt; tooltipRef.value?.hide(),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">provide&lt;DropdownContext&gt;(DROPDOWN_CTX_KEY, &#123;</span><br><span class="line">  handleItemClick,</span><br><span class="line">  size: computed(() =&gt; props.size),</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;er-dropdown&quot;</span><br><span class="line">    :id=&quot;`dropdown-$&#123;useId().value&#125;`&quot;</span><br><span class="line">    :class=&quot;&#123; &#x27;is-disabled&#x27;: props.disabled &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;tooltip</span><br><span class="line">      ref=&quot;tooltipRef&quot;</span><br><span class="line">      v-bind=&quot;tooltipProps&quot;</span><br><span class="line">      :virtual-triggering=&quot;splitButton&quot;</span><br><span class="line">      :virtual-ref=&quot;triggerRef&quot;</span><br><span class="line">      @visible-change=&quot;$emit(&#x27;visible-change&#x27;, $event)&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;er-button-group</span><br><span class="line">        :type=&quot;type&quot;</span><br><span class="line">        :size=&quot;size&quot;</span><br><span class="line">        :disabled=&quot;disabled&quot;</span><br><span class="line">        v-if=&quot;splitButton&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;er-button @click=&quot;$emit(&#x27;click&#x27;, $event)&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;default&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/er-button&gt;</span><br><span class="line">        &lt;er-button ref=&quot;triggerRef&quot; icon=&quot;angle-down&quot; /&gt;</span><br><span class="line">      &lt;/er-button-group&gt;</span><br><span class="line">      &lt;slot v-else name=&quot;default&quot;&gt;&lt;/slot&gt;</span><br><span class="line"></span><br><span class="line">      &lt;template #content&gt;</span><br><span class="line">        &lt;ul class=&quot;er-dropdown__menu&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;dropdown&quot;&gt;</span><br><span class="line">            &lt;template</span><br><span class="line">              v-for=&quot;item in items&quot;</span><br><span class="line">              :key=&quot;item.command ?? useId().value&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;dropdown-item v-bind=&quot;item&quot; /&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/slot&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/tooltip&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line"></span><br><span class="line">:deep(.er-button-group) &#123;</span><br><span class="line">  &amp; &gt; :last-child &#123;</span><br><span class="line">    padding: 5px 7px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-DropdownItem-vue"><a href="#â”œâ”€-DropdownItem-vue" class="headerlink" title="â”œâ”€ DropdownItem.vue"></a>â”œâ”€ DropdownItem.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; type DropdownItemProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; DROPDOWN_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line">import &#123; useId &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; inject, computed &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErDropdownItem&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;DropdownItemProps&gt;(), &#123;</span><br><span class="line">  divided: false,</span><br><span class="line">  disabled: false,</span><br><span class="line">  command: useId().value,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const ctx = inject(DROPDOWN_CTX_KEY);</span><br><span class="line">const size = computed(() =&gt; ctx?.size.value);</span><br><span class="line"></span><br><span class="line">function handleClick() &#123;</span><br><span class="line">  if (props.disabled) return;</span><br><span class="line">  ctx?.handleItemClick(props);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;li v-if=&quot;divided&quot; role=&quot;separator&quot; class=&quot;divided-placeholder&quot;&gt;&lt;/li&gt;</span><br><span class="line">  &lt;li</span><br><span class="line">    :id=&quot;`dropdown-item-$&#123;command ?? useId().value&#125;`&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      &#x27;er-dropdown__item&#x27;: true,</span><br><span class="line">      [&#x27;er-dropdown__item--&#x27; + size]: size,</span><br><span class="line">      &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">      &#x27;is-divided&#x27;: divided,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">    @click=&quot;handleClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;slot&gt;</span><br><span class="line">      &#123;&#123; label &#125;&#125;</span><br><span class="line">    &lt;/slot&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-index-ts-5"><a href="#â”œâ”€-index-ts-5" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Dropdown</span> <span class="keyword">from</span> <span class="string">&quot;./Dropdown.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">DropdownItem</span> <span class="keyword">from</span> <span class="string">&quot;./DropdownItem.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErDropdown</span> = <span class="title function_">withInstall</span>(<span class="title class_">Dropdown</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErDropdownItem</span> = <span class="title function_">withInstall</span>(<span class="title class_">DropdownItem</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-3"><a href="#â”œâ”€-style-css-3" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-dropdown</span> <span class="selector-class">.er-dropdown__menu</span> &#123;</span><br><span class="line">  <span class="attr">--er-dropdown-menuItem-hover-fill</span>: <span class="built_in">var</span>(--er-color-primary-light-<span class="number">9</span>);</span><br><span class="line">  <span class="attr">--er-dropdown-menuItem-hover-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">  <span class="attr">--er-dropdown-menuItem-disabled-color</span>: <span class="built_in">var</span>(--er-border-color-lighter);</span><br><span class="line">  <span class="attr">--er-dropdown-menuItem-divided-color</span>: <span class="built_in">var</span>(--er-border-color-lighter);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-dropdown</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="selector-class">.er-tooltip</span> &#123;</span><br><span class="line">    <span class="attr">--er-popover-padding</span>: <span class="number">5px</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-disabled</span>&gt;*&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-text-color-placeholder) <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: not-allowed <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-dropdown__menu</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-type</span>: none;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="selector-class">.er-dropdown__item</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">22px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">outline</span>: none;</span><br><span class="line">    &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-dropdown-menuItem-hover-fill);</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-dropdown-menuItem-hover-color);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.is-disabled</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-dropdown-menuItem-disabled-color);</span><br><span class="line">      <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">      <span class="attribute">background-image</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.er-dropdown__item--large</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">7px</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">22px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-dropdown__item--small</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">2px</span> <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.divided-placeholder</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">6px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-dropdown-menuItem-divided-color);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-4"><a href="#â””â”€-types-ts-4" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">VNode</span>, <span class="title class_">ComputedRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">TooltipProps</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../Tooltip/types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ButtonType</span>, <span class="title class_">ButtonSize</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../Button/types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">DropdownCommand</span> = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownItemProps</span> &#123;</span><br><span class="line">  <span class="attr">command</span>?: <span class="title class_">DropdownCommand</span>;</span><br><span class="line">  <span class="attr">label</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">divided</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownProps</span> <span class="keyword">extends</span> <span class="title class_">TooltipProps</span> &#123;</span><br><span class="line">  <span class="attr">type</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">  <span class="attr">size</span>?: <span class="title class_">ButtonSize</span>;</span><br><span class="line">  <span class="attr">items</span>?: <span class="title class_">DropdownItemProps</span>[];</span><br><span class="line">  <span class="attr">hideOnClick</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">splitButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;visible-change&quot;</span>, <span class="attr">value</span>: <span class="built_in">boolean</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;command&quot;</span>, <span class="attr">value</span>: <span class="title class_">DropdownCommand</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;click&quot;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownInstance</span> &#123;</span><br><span class="line">  <span class="title function_">open</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">close</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownContext</span> &#123;</span><br><span class="line">  <span class="title function_">handleItemClick</span>(<span class="attr">item</span>: <span class="title class_">DropdownItemProps</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="attr">size</span>: <span class="title class_">ComputedRef</span>&lt;<span class="title class_">ButtonSize</span> | <span class="built_in">void</span>&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Form"><a href="#â”œâ”€-Form" class="headerlink" title="â”œâ”€ Form"></a>â”œâ”€ Form</h3><blockquote><p>è¡¨å•ï¼Œç”¨äºæ”¶é›†ç”¨æˆ·è¾“å…¥</p></blockquote><h4 id="â€“APIâ€“-5"><a href="#â€“APIâ€“-5" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-constants-ts-4"><a href="#â”œâ”€-constants-ts-4" class="headerlink" title="â”œâ”€ constants.ts"></a>â”œâ”€ constants.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">FormContext</span>, <span class="title class_">FormItemContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">FORM_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">FormContext</span>&gt; = <span class="title class_">Symbol</span>(<span class="string">&quot;formContext&quot;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">FORM_ITEM_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">FormItemContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;formItemContext&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Form-vue"><a href="#â”œâ”€-Form-vue" class="headerlink" title="â”œâ”€ Form.vue"></a>â”œâ”€ Form.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; provide, reactive, toRefs &#125; from &quot;vue&quot;;</span><br><span class="line">import type &#123;</span><br><span class="line">  FormProps,</span><br><span class="line">  FormEmits,</span><br><span class="line">  FormItemContext,</span><br><span class="line">  FormContext,</span><br><span class="line">  FormInstance,</span><br><span class="line">  FormValidateCallback,</span><br><span class="line">&#125; from &quot;./types&quot;;</span><br><span class="line">import type &#123; ValidateFieldsError &#125; from &quot;async-validator&quot;;</span><br><span class="line">import &#123; FORM_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line">import &#123; each, filter, includes, size &#125; from &quot;lodash-es&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123; name: &quot;ErForm&quot; &#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;FormProps&gt;(), &#123;</span><br><span class="line">  showMessage: true,</span><br><span class="line">  hideRequiredAsterisk: false,</span><br><span class="line">  requiredAsteriskPosition: &quot;left&quot;,</span><br><span class="line">  labelPosition: &quot;right&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;FormEmits&gt;();</span><br><span class="line">const fields: FormItemContext[] = [];</span><br><span class="line"></span><br><span class="line">const addField: FormContext[&quot;addField&quot;] = function (field) &#123;</span><br><span class="line">  if (!field.prop) return;</span><br><span class="line">  fields.push(field);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const removeField: FormContext[&quot;removeField&quot;] = function (field) &#123;</span><br><span class="line">  if (!field.prop) return;</span><br><span class="line">  fields.splice(fields.indexOf(field), 1);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const validate: FormInstance[&quot;validate&quot;] = async function (</span><br><span class="line">  callback?: FormValidateCallback</span><br><span class="line">) &#123;</span><br><span class="line">  return validateField([], callback);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const validateField: FormInstance[&quot;validateField&quot;] = async function (</span><br><span class="line">  keys: string[] = [],</span><br><span class="line">  callback?: FormValidateCallback</span><br><span class="line">) &#123;</span><br><span class="line">  const filterArr = size(keys)</span><br><span class="line">    ? filter(fields, (field) =&gt; includes(keys, field.prop))</span><br><span class="line">    : fields;</span><br><span class="line"></span><br><span class="line">  try &#123;</span><br><span class="line">    const result = await doValidateField(filterArr);</span><br><span class="line">    if (result === true) &#123;</span><br><span class="line">      callback?.(result);</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    if (e instanceof Error) throw e;</span><br><span class="line">    const invalidFields = e as ValidateFieldsError;</span><br><span class="line"></span><br><span class="line">    callback?.(false, invalidFields);</span><br><span class="line">    return Promise.reject(invalidFields);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const resetFields: FormInstance[&quot;resetFields&quot;] = function (</span><br><span class="line">  keys: string[] = []</span><br><span class="line">) &#123;</span><br><span class="line">  each(filterFields(fields, keys), (field) =&gt; field.resetField());</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const clearValidate: FormInstance[&quot;clearValidate&quot;] = function (</span><br><span class="line">  keys: string[] = []</span><br><span class="line">) &#123;</span><br><span class="line">  each(filterFields(fields, keys), (field) =&gt; field.clearValidate());</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function filterFields(fields: FormItemContext[], props: string[]) &#123;</span><br><span class="line">  return size(props)</span><br><span class="line">    ? filter(fields, (field) =&gt; includes(props, field.prop))</span><br><span class="line">    : fields;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function doValidateField(fields: FormItemContext[] = []) &#123;</span><br><span class="line">  let validationErrors: ValidateFieldsError = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  for (const field of fields) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      await field.validate(&quot;&quot;);</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">      validationErrors = &#123;</span><br><span class="line">        ...validationErrors,</span><br><span class="line">        ...(e as ValidateFieldsError),</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  if (!size(Object.keys(validationErrors))) return true;</span><br><span class="line">  return Promise.reject(validationErrors);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const formCtx: FormContext = reactive(&#123;</span><br><span class="line">  ...toRefs(props),</span><br><span class="line">  emits,</span><br><span class="line">  addField,</span><br><span class="line">  removeField,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">provide&lt;FormContext&gt;(FORM_CTX_KEY, formCtx);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;FormInstance&gt;(&#123;</span><br><span class="line">  validate,</span><br><span class="line">  validateField,</span><br><span class="line">  resetFields,</span><br><span class="line">  clearValidate,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form class=&quot;er-form&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-FormItem-vue"><a href="#â”œâ”€-FormItem-vue" class="headerlink" title="â”œâ”€ FormItem.vue"></a>â”œâ”€ FormItem.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;</span><br><span class="line">  type Ref,</span><br><span class="line">  computed,</span><br><span class="line">  provide,</span><br><span class="line">  inject,</span><br><span class="line">  onMounted,</span><br><span class="line">  onUnmounted,</span><br><span class="line">  ref,</span><br><span class="line">  nextTick,</span><br><span class="line">  watch,</span><br><span class="line">  reactive,</span><br><span class="line">  watchEffect,</span><br><span class="line">  toRefs,</span><br><span class="line">  useSlots,</span><br><span class="line">&#125; from &quot;vue&quot;;</span><br><span class="line">import Schema, &#123; type RuleItem &#125; from &quot;async-validator&quot;;</span><br><span class="line">import type &#123;</span><br><span class="line">  FormItemContext,</span><br><span class="line">  FormItemProps,</span><br><span class="line">  FormValidateFailuer,</span><br><span class="line">  FormValidateCallback,</span><br><span class="line">  ValidateStatus,</span><br><span class="line">  FormItemInstance,</span><br><span class="line">  FormItemRule,</span><br><span class="line">&#125; from &quot;./types&quot;;</span><br><span class="line">import &#123;</span><br><span class="line">  isNil,</span><br><span class="line">  get,</span><br><span class="line">  size,</span><br><span class="line">  filter,</span><br><span class="line">  some,</span><br><span class="line">  isString,</span><br><span class="line">  isNumber,</span><br><span class="line">  endsWith,</span><br><span class="line">  keys,</span><br><span class="line">  includes,</span><br><span class="line">  map,</span><br><span class="line">  cloneDeep,</span><br><span class="line">  isArray,</span><br><span class="line">&#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123; useId &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; FORM_CTX_KEY, FORM_ITEM_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123; name: &quot;ErFormItem&quot; &#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;FormItemProps&gt;(), &#123;</span><br><span class="line">  showMessage: true,</span><br><span class="line">  required: void 0,</span><br><span class="line">&#125;);</span><br><span class="line">const slots = useSlots();</span><br><span class="line">const ctx = inject(FORM_CTX_KEY);</span><br><span class="line"></span><br><span class="line">const labelId = useId().value;</span><br><span class="line"></span><br><span class="line">const validateStatus: Ref&lt;ValidateStatus&gt; = ref(&quot;init&quot;);</span><br><span class="line">const errMsg = ref(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">const inputIds = ref&lt;string[]&gt;([]);</span><br><span class="line"></span><br><span class="line">const getValByProp = (target: Record&lt;string, any&gt; | void) =&gt; &#123;</span><br><span class="line">  if (target &amp;&amp; props.prop &amp;&amp; !isNil(get(target, props.prop))) &#123;</span><br><span class="line">    return get(target, props.prop);</span><br><span class="line">  &#125;</span><br><span class="line">  return null;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const hasLabel = computed(() =&gt; !!(props.label || slots.label));</span><br><span class="line">const labelFor = computed(</span><br><span class="line">  () =&gt; props.for || (inputIds.value.length ? inputIds.value[0] : &quot;&quot;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const currentLabel = computed(</span><br><span class="line">  () =&gt; `$&#123;props.label ?? &quot;&quot;&#125;$&#123;ctx?.labelSuffix ?? &quot;&quot;&#125;`</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const innerVal = computed(() =&gt; &#123;</span><br><span class="line">  const model = ctx?.model;</span><br><span class="line">  return getValByProp(model);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const itemRules = computed(() =&gt; &#123;</span><br><span class="line">  const &#123; required &#125; = props;</span><br><span class="line"></span><br><span class="line">  const rules: FormItemRule[] = [];</span><br><span class="line">  if (props.rules) &#123;</span><br><span class="line">    rules.push(...props.rules);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const formRules = ctx?.rules;</span><br><span class="line">  if (formRules &amp;&amp; props.prop) &#123;</span><br><span class="line">    const _rules = getValByProp(formRules);</span><br><span class="line">    if (_rules) &#123;</span><br><span class="line">      rules.push(..._rules);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (!isNil(required)) &#123;</span><br><span class="line">    const requiredRules = filter(</span><br><span class="line">      map(rules, (rule, i) =&gt; [rule, i]),</span><br><span class="line">      (item: [FormItemRule, number]) =&gt; includes(keys(item[0]), &quot;required&quot;)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    if (size(requiredRules)) &#123;</span><br><span class="line">      for (const item of requiredRules) &#123;</span><br><span class="line">        const [rule, i] = item as [FormItemRule, number];</span><br><span class="line">        if (rule.required === required) continue;</span><br><span class="line">        rules[i] = &#123; ...rule, required &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      rules.push(&#123; required &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return rules;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const validateEnabled = computed(() =&gt; size(itemRules.value) &gt; 0);</span><br><span class="line">const isRequired = computed(</span><br><span class="line">  () =&gt;</span><br><span class="line">    !ctx?.hideRequiredAsterisk &amp;&amp;</span><br><span class="line">    (some(itemRules.value, &quot;required&quot;) || props?.required)</span><br><span class="line">);</span><br><span class="line">const isDisabled = computed(() =&gt; ctx?.disabled || props?.disabled);</span><br><span class="line">const propString = computed(() =&gt; &#123;</span><br><span class="line">  if (!props.prop) return &quot;&quot;;</span><br><span class="line">  return isString(props.prop) ? props.prop : props.prop.join(&quot;.&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const normalizeLabelWidth = computed(() =&gt; &#123;</span><br><span class="line">  const _normalizeStyle = (val: number | string) =&gt; &#123;</span><br><span class="line">    if (isNumber(val)) return `$&#123;val&#125;px`;</span><br><span class="line">    return endsWith(val, &quot;px&quot;) ? val : `$&#123;val&#125;px`;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  if (props.labelWidth) return _normalizeStyle(props.labelWidth);</span><br><span class="line">  if (ctx?.labelWidth) return _normalizeStyle(ctx.labelWidth);</span><br><span class="line">  return &quot;150px&quot;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">let initialVal: any = null;</span><br><span class="line">let isResetting = false;</span><br><span class="line"></span><br><span class="line">function getTriggeredRules(trigger?: string) &#123;</span><br><span class="line">  const rules = itemRules.value;</span><br><span class="line">  if (rules) &#123;</span><br><span class="line">    return filter(rules, (r) =&gt; &#123;</span><br><span class="line">      if (!r.trigger || !trigger) return true;</span><br><span class="line">      if (isArray(r.trigger)) &#123;</span><br><span class="line">        return r.trigger.includes(trigger);</span><br><span class="line">      &#125;</span><br><span class="line">      return r.trigger === trigger;</span><br><span class="line">    &#125;).map((&#123; trigger, ...rule &#125;) =&gt; rule as RuleItem);</span><br><span class="line">  &#125;</span><br><span class="line">  return [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function doValidate(rules: any[]) &#123;</span><br><span class="line">  const modelName = propString.value;</span><br><span class="line">  const validator = new Schema(&#123; [modelName]: rules &#125;);</span><br><span class="line">  return validator</span><br><span class="line">    .validate(&#123; [modelName]: innerVal.value &#125;, &#123; firstFields: true &#125;)</span><br><span class="line">    .then(() =&gt; &#123;</span><br><span class="line">      validateStatus.value = &quot;success&quot;;</span><br><span class="line">      ctx?.emits(&quot;validate&quot;, props, true, &quot;&quot;);</span><br><span class="line">      return true;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch((err: FormValidateFailuer) =&gt; &#123;</span><br><span class="line">      const &#123; errors &#125; = err;</span><br><span class="line">      validateStatus.value = &quot;error&quot;;</span><br><span class="line">      errMsg.value = errors &amp;&amp; size(errors) &gt; 0 ? errors[0].message ?? &quot;&quot; : &quot;&quot;;</span><br><span class="line">      ctx?.emits(&quot;validate&quot;, props, false, errMsg.value);</span><br><span class="line">      return Promise.reject(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const validate: FormItemInstance[&quot;validate&quot;] = async function (</span><br><span class="line">  trigger: string,</span><br><span class="line">  callback?: FormValidateCallback</span><br><span class="line">) &#123;</span><br><span class="line">  if (isResetting || !props.prop || isDisabled.value) return false;</span><br><span class="line"></span><br><span class="line">  if (!validateEnabled.value) &#123;</span><br><span class="line">    callback?.(false);</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const rules = getTriggeredRules(trigger);</span><br><span class="line">  if (!size(rules)) &#123;</span><br><span class="line">    callback?.(true);</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  validateStatus.value = &quot;validating&quot;;</span><br><span class="line"></span><br><span class="line">  return doValidate(rules)</span><br><span class="line">    .then(() =&gt; &#123;</span><br><span class="line">      callback?.(true);</span><br><span class="line">      return true;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch((err: FormValidateFailuer) =&gt; &#123;</span><br><span class="line">      const &#123; fields &#125; = err;</span><br><span class="line">      callback?.(false, fields);</span><br><span class="line">      return Promise.reject(fields);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">const resetField: FormItemInstance[&quot;resetField&quot;] = function () &#123;</span><br><span class="line">  const model = ctx?.model;</span><br><span class="line">  if (model &amp;&amp; propString.value &amp;&amp; !isNil(get(model, propString.value))) &#123;</span><br><span class="line">    isResetting = true;</span><br><span class="line">    model[propString.value] = cloneDeep(initialVal);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  nextTick(() =&gt; clearValidate());</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const clearValidate: FormItemInstance[&quot;clearValidate&quot;] = function () &#123;</span><br><span class="line">  validateStatus.value = &quot;init&quot;;</span><br><span class="line">  errMsg.value = &quot;&quot;;</span><br><span class="line">  isResetting = false;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const addInputId: FormItemContext[&quot;addInputId&quot;] = function (id) &#123;</span><br><span class="line">  if (!includes(inputIds.value, id)) inputIds.value.push(id);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const removeInputId: FormItemContext[&quot;removeInputId&quot;] = function (id) &#123;</span><br><span class="line">  inputIds.value = filter(inputIds.value, (i) =&gt; i != id);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const formItemCtx: FormItemContext = reactive(&#123;</span><br><span class="line">  ...toRefs(props),</span><br><span class="line">  disabled: isDisabled.value,</span><br><span class="line">  validate,</span><br><span class="line">  resetField,</span><br><span class="line">  clearValidate,</span><br><span class="line">  addInputId,</span><br><span class="line">  removeInputId,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  if (props.prop) &#123;</span><br><span class="line">    ctx?.addField(formItemCtx);</span><br><span class="line">    initialVal = innerVal.value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">onUnmounted(() =&gt; &#123;</span><br><span class="line">  if (props.prop) &#123;</span><br><span class="line">    ctx?.removeField(formItemCtx);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">watchEffect(() =&gt; (formItemCtx.disabled = isDisabled.value));</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.error,</span><br><span class="line">  (val) =&gt; &#123;</span><br><span class="line">    errMsg.value = val || &quot;&quot;;</span><br><span class="line">    validateStatus.value = val ? &quot;error&quot; : &quot;init&quot;;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; immediate: true &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">provide&lt;FormItemContext&gt;(FORM_ITEM_CTX_KEY, formItemCtx);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;FormItemInstance&gt;(&#123;</span><br><span class="line">  validateMessage: errMsg,</span><br><span class="line">  validateStatus,</span><br><span class="line">  validate,</span><br><span class="line">  resetField,</span><br><span class="line">  clearValidate,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;er-form-item&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      &#x27;is-error&#x27;: validateStatus === &#x27;error&#x27;,</span><br><span class="line">      &#x27;is-disabled&#x27;: isDisabled,</span><br><span class="line">      &#x27;is-required&#x27;: isRequired,</span><br><span class="line">      &#x27;asterisk-left&#x27;: ctx?.requiredAsteriskPosition === &#x27;left&#x27;,</span><br><span class="line">      &#x27;asterisk-right&#x27;: ctx?.requiredAsteriskPosition === &#x27;right&#x27;,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;component</span><br><span class="line">      v-if=&quot;hasLabel&quot;</span><br><span class="line">      class=&quot;er-form-item__label&quot;</span><br><span class="line">      :class=&quot;`position-$&#123;ctx?.labelPosition ?? &#x27;right&#x27;&#125;`&quot;</span><br><span class="line">      :is=&quot;labelFor ? &#x27;label&#x27; : &#x27;div&#x27;&quot;</span><br><span class="line">      :id=&quot;labelId&quot;</span><br><span class="line">      :for=&quot;labelFor&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;slot name=&quot;label&quot; :label=&quot;currentLabel&quot;&gt;</span><br><span class="line">        &#123;&#123; currentLabel &#125;&#125;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/component&gt;</span><br><span class="line">    &lt;div class=&quot;er-form-item__content&quot;&gt;</span><br><span class="line">      &lt;slot :validate=&quot;validate&quot;&gt;&lt;/slot&gt;</span><br><span class="line">      &lt;div class=&quot;er-form-item__error-msg&quot; v-if=&quot;validateStatus === &#x27;error&#x27;&quot;&gt;</span><br><span class="line">        &lt;template v-if=&quot;ctx?.showMessage &amp;&amp; showMessage&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;error&quot; :error=&quot;errMsg&quot;&gt;&#123;&#123; errMsg &#125;&#125;&lt;/slot&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line"></span><br><span class="line">.er-form-item &#123;</span><br><span class="line">  --er-form-label-width: v-bind(normalizeLabelWidth) !important;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-hooks-ts-1"><a href="#â”œâ”€-hooks-ts-1" class="headerlink" title="â”œâ”€ hooks.ts"></a>â”œâ”€ hooks.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  computed,</span><br><span class="line">  inject,</span><br><span class="line">  unref,</span><br><span class="line">  ref,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">MaybeRef</span>,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">WatchStopHandle</span>,</span><br><span class="line">  onMounted,</span><br><span class="line">  watch,</span><br><span class="line">  toRef,</span><br><span class="line">  onUnmounted,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">FormItemContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FORM_CTX_KEY</span>, <span class="variable constant_">FORM_ITEM_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constants&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useProp, useId &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/hooks&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useFormItem</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> form = <span class="title function_">inject</span>(<span class="variable constant_">FORM_CTX_KEY</span>, <span class="built_in">void</span> <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> formItem = <span class="title function_">inject</span>(<span class="variable constant_">FORM_ITEM_CTX_KEY</span>, <span class="built_in">void</span> <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> &#123; form, formItem &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useFormDisabled</span>(<span class="params"><span class="attr">fallback</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">boolean</span> | <span class="built_in">void</span>&gt;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> disabled = useProp&lt;<span class="built_in">boolean</span>&gt;(<span class="string">&quot;disabled&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> form = <span class="title function_">inject</span>(<span class="variable constant_">FORM_CTX_KEY</span>, <span class="built_in">void</span> <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> formItem = <span class="title function_">inject</span>(<span class="variable constant_">FORM_ITEM_CTX_KEY</span>, <span class="built_in">void</span> <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">computed</span>(</span><br><span class="line">    <span class="function">() =&gt;</span></span><br><span class="line">      disabled.<span class="property">value</span> ||</span><br><span class="line">      <span class="title function_">unref</span>(fallback) ||</span><br><span class="line">      form?.<span class="property">disabled</span> ||</span><br><span class="line">      formItem?.<span class="property">disabled</span> ||</span><br><span class="line">      <span class="literal">false</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UseFormItemInputCommonProps</span> <span class="keyword">extends</span> <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="attr">id</span>?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useFormItemInputId</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">props</span>: <span class="title class_">UseFormItemInputCommonProps</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">formItemContext</span>?: <span class="title class_">FormItemContext</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputId = ref&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">unwatch</span>: <span class="title class_">WatchStopHandle</span> | <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    unwatch = <span class="title function_">watch</span>(</span><br><span class="line">      <span class="title function_">toRef</span>(<span class="function">() =&gt;</span> props.<span class="property">id</span>),</span><br><span class="line">      <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> newId = id ?? <span class="title function_">useId</span>().<span class="property">value</span>;</span><br><span class="line">        <span class="keyword">if</span> (newId !== inputId.<span class="property">value</span>) &#123;</span><br><span class="line">          inputId.<span class="property">value</span> &amp;&amp; formItemContext?.<span class="title function_">removeInputId</span>(inputId.<span class="property">value</span>);</span><br><span class="line">          formItemContext?.<span class="title function_">addInputId</span>(newId);</span><br><span class="line">          inputId.<span class="property">value</span> = newId;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">immediate</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    unwatch &amp;&amp; <span class="title function_">unwatch</span>();</span><br><span class="line">    inputId.<span class="property">value</span> &amp;&amp; formItemContext?.<span class="title function_">removeInputId</span>(inputId.<span class="property">value</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    inputId,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-index-ts-6"><a href="#â”œâ”€-index-ts-6" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Form</span> <span class="keyword">from</span> <span class="string">&quot;./Form.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">FormItem</span> <span class="keyword">from</span> <span class="string">&quot;./FormItem.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErForm</span> = <span class="title function_">withInstall</span>(<span class="title class_">Form</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErFormItem</span> = <span class="title function_">withInstall</span>(<span class="title class_">FormItem</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./hooks&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-4"><a href="#â”œâ”€-style-css-4" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-form-item</span> &#123;</span><br><span class="line">  <span class="attr">--er-form-label-width</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attr">--er-form-label-font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">  <span class="attr">--er-form-content-font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-form-item</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">18px</span>;</span><br><span class="line">  &amp;<span class="selector-pseudo">:has</span>(&gt; <span class="selector-class">.position-top</span>)&#123;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-form-item__label</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">32px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">var</span>(--er-form-label-width);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">display</span>: inline-flex;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-form-label-font-size);    </span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">    &amp;<span class="selector-class">.position-right</span> &#123;</span><br><span class="line">      <span class="attribute">padding-left</span>: <span class="number">12px</span>;</span><br><span class="line">      <span class="attribute">justify-content</span>: flex-end;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.position-left</span> &#123;</span><br><span class="line">      <span class="attribute">padding-right</span>: <span class="number">12px</span>;</span><br><span class="line">      <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.position-top</span> &#123;</span><br><span class="line">      <span class="attribute">padding-bottom</span>: <span class="number">12px</span>;</span><br><span class="line">      <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-form-item__content</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">32px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-form-content-font-size);</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-form-item__error-msg</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.is-error</span> &#123;</span><br><span class="line">    :<span class="built_in">deep</span>(.er-input__wrapper)&#123;</span><br><span class="line">      <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-color-danger) inset;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.is-required</span><span class="selector-class">.asterisk-right</span> &gt; <span class="selector-class">.er-form-item__label</span><span class="selector-pseudo">::after</span>&#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">4px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.is-required</span><span class="selector-class">.asterisk-left</span> &gt; <span class="selector-class">.er-form-item__label</span><span class="selector-pseudo">::before</span>&#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">4px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.is-disabled</span> &gt; <span class="selector-class">.er-form-item__label</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">    <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    &amp;<span class="selector-pseudo">::before</span>,&amp;<span class="selector-pseudo">::after</span>&#123;</span><br><span class="line">      <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.is-disabled</span> &gt; <span class="selector-class">.er-form-item__content</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">    <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-5"><a href="#â””â”€-types-ts-5" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;</span><br><span class="line">  <span class="title class_">RuleItem</span>,</span><br><span class="line">  <span class="title class_">ValidateError</span>,</span><br><span class="line">  <span class="title class_">ValidateFieldsError</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;async-validator&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormItemRule</span> <span class="keyword">extends</span> <span class="title class_">RuleItem</span> &#123;</span><br><span class="line">  <span class="attr">trigger</span>?: <span class="built_in">string</span> | <span class="built_in">string</span>[];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">FormRules</span> = <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">FormItemRule</span>[]&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">FormValidateResult</span> = <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">FormValidateCallback</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">isValid</span>: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">invalidFields</span>?: <span class="title class_">ValidateFieldsError</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ValidateStatus</span> = <span class="string">&quot;success&quot;</span> | <span class="string">&quot;error&quot;</span> | <span class="string">&quot;init&quot;</span> | <span class="string">&quot;validating&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormValidateFailuer</span> &#123;</span><br><span class="line">  <span class="attr">errors</span>?: <span class="title class_">ValidateError</span>[];</span><br><span class="line">  <span class="attr">fields</span>: <span class="title class_">ValidateFieldsError</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormProps</span> &#123;</span><br><span class="line">  <span class="attr">model</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;;</span><br><span class="line">  <span class="attr">rules</span>?: <span class="title class_">FormRules</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">labelWidth</span>?: <span class="built_in">number</span> | <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">labelPosition</span>?: <span class="string">&quot;left&quot;</span> | <span class="string">&quot;right&quot;</span> | <span class="string">&quot;top&quot;</span>;</span><br><span class="line">  <span class="attr">labelSuffix</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">showMessage</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">hideRequiredAsterisk</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">requiredAsteriskPosition</span>?: <span class="string">&quot;left&quot;</span> | <span class="string">&quot;right&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormEmits</span> &#123;</span><br><span class="line">  (</span><br><span class="line">    <span class="attr">event</span>: <span class="string">&quot;validate&quot;</span>,</span><br><span class="line">    <span class="attr">prop</span>: <span class="title class_">FormItemProps</span>,</span><br><span class="line">    <span class="attr">isValid</span>: <span class="built_in">boolean</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="built_in">string</span></span><br><span class="line">  ): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormItemProps</span> &#123;</span><br><span class="line">  <span class="attr">prop</span>?: <span class="built_in">string</span> | <span class="built_in">string</span>[];</span><br><span class="line">  <span class="attr">label</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">for</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">labelWidth</span>?: <span class="built_in">number</span> | <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">required</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">showMessage</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">error</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">rules</span>?: <span class="title class_">FormItemRule</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormInstance</span> &#123;</span><br><span class="line">  <span class="title function_">validate</span>(<span class="attr">callback</span>?: <span class="title class_">FormValidateCallback</span>): <span class="title class_">FormValidateResult</span>;</span><br><span class="line">  <span class="title function_">validateField</span>(</span><br><span class="line">    <span class="attr">keys</span>?: <span class="built_in">string</span>[],</span><br><span class="line">    <span class="attr">callback</span>?: <span class="title class_">FormValidateCallback</span></span><br><span class="line">  ): <span class="title class_">FormValidateResult</span>;</span><br><span class="line">  <span class="title function_">resetFields</span>(<span class="attr">keys</span>?: <span class="built_in">string</span>[]): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">clearValidate</span>(<span class="attr">keys</span>?: <span class="built_in">string</span>[]): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormItemInstance</span> &#123;</span><br><span class="line">  <span class="attr">validateStatus</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">ValidateStatus</span>&gt;;</span><br><span class="line">  <span class="attr">validateMessage</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">  <span class="title function_">validate</span>(</span><br><span class="line">    <span class="attr">trigger</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">callback</span>?: <span class="title class_">FormValidateCallback</span></span><br><span class="line">  ): <span class="title class_">FormValidateResult</span>;</span><br><span class="line">  <span class="title function_">resetField</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">clearValidate</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormContext</span> <span class="keyword">extends</span> <span class="title class_">FormProps</span> &#123;</span><br><span class="line">  <span class="attr">emits</span>: <span class="title class_">FormEmits</span>;</span><br><span class="line">  <span class="title function_">addField</span>(<span class="attr">field</span>: <span class="title class_">FormItemContext</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">removeField</span>(<span class="attr">field</span>: <span class="title class_">FormItemContext</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormItemContext</span> <span class="keyword">extends</span> <span class="title class_">FormItemProps</span> &#123;</span><br><span class="line">  <span class="title function_">validate</span>(</span><br><span class="line">    <span class="attr">trigger</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">callback</span>?: <span class="title class_">FormValidateCallback</span></span><br><span class="line">  ): <span class="title class_">FormValidateResult</span>;</span><br><span class="line">  <span class="title function_">resetField</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">clearValidate</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">addInputId</span>(<span class="attr">id</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">removeInputId</span>(<span class="attr">id</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Icon"><a href="#â”œâ”€-Icon" class="headerlink" title="â”œâ”€ Icon"></a>â”œâ”€ Icon</h3><blockquote><p>å›¾æ ‡ç»„ä»¶</p></blockquote><h4 id="â”œâ”€-Icon-vue"><a href="#â”œâ”€-Icon-vue" class="headerlink" title="â”œâ”€ Icon.vue"></a>â”œâ”€ Icon.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; type IconProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; FontAwesomeIcon &#125; from &quot;@fortawesome/vue-fontawesome&quot;;</span><br><span class="line">import &#123; omit &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123; computed &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErIcon&quot;,</span><br><span class="line">  inheritAttrs: false,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const props = defineProps&lt;IconProps&gt;();</span><br><span class="line"></span><br><span class="line">const filterProps = computed(() =&gt; omit(props, [&quot;type&quot;, &quot;color&quot;]));</span><br><span class="line">const customStyles = computed(() =&gt; (&#123; color: props.color ?? void 0 &#125;));</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;i</span><br><span class="line">    class=&quot;er-icon&quot;</span><br><span class="line">    :class=&quot;&#123; [`er-icon--$&#123;type&#125;`]: type &#125;&quot;</span><br><span class="line">    :style=&quot;customStyles&quot;</span><br><span class="line">    v-bind=&quot;$attrs&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;font-awesome-icon v-bind=&quot;filterProps&quot; /&gt;</span><br><span class="line">  &lt;/i&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-index-ts-7"><a href="#â”œâ”€-index-ts-7" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Icon</span> <span class="keyword">from</span> <span class="string">&quot;./Icon.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErIcon</span> = <span class="title function_">withInstall</span>(<span class="title class_">Icon</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-5"><a href="#â”œâ”€-style-css-5" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-icon</span> &#123;</span><br><span class="line">  <span class="attr">--er-icon-color</span>: inherit;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">fill</span>: currentColor;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--er-icon-color);</span><br><span class="line">  <span class="attribute">font-size</span>: inherit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@each</span> $val in primary, info, success, warning, danger &#123;</span><br><span class="line">  <span class="selector-class">.er-icon--</span>$(val) &#123;</span><br><span class="line">    <span class="attr">--er-icon-color</span>: <span class="built_in">var</span>(--er-color-$(val));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-6"><a href="#â””â”€-types-ts-6" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">IconDefinition</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/fontawesome-svg-core&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IconProps</span> &#123;</span><br><span class="line">  <span class="attr">border</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">fixedWidth</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">flip</span>?: <span class="string">&quot;horizontal&quot;</span> | <span class="string">&quot;vertical&quot;</span> | <span class="string">&quot;both&quot;</span>;</span><br><span class="line">  <span class="attr">icon</span>: <span class="built_in">object</span> | <span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt; | <span class="built_in">string</span> | <span class="title class_">IconDefinition</span>;</span><br><span class="line">  <span class="attr">mask</span>?: <span class="built_in">object</span> | <span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt; | <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">listItem</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">pull</span>?: <span class="string">&quot;right&quot;</span> | <span class="string">&quot;left&quot;</span>;</span><br><span class="line">  <span class="attr">pulse</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">rotation</span>?: <span class="number">90</span> | <span class="number">180</span> | <span class="number">270</span> | <span class="string">&quot;90&quot;</span> | <span class="string">&quot;180&quot;</span> | <span class="string">&quot;270&quot;</span>;</span><br><span class="line">  <span class="attr">swapOpacity</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">size</span>?:</span><br><span class="line">    | <span class="string">&quot;2xs&quot;</span></span><br><span class="line">    | <span class="string">&quot;xs&quot;</span></span><br><span class="line">    | <span class="string">&quot;sm&quot;</span></span><br><span class="line">    | <span class="string">&quot;lg&quot;</span></span><br><span class="line">    | <span class="string">&quot;xl&quot;</span></span><br><span class="line">    | <span class="string">&quot;2xl&quot;</span></span><br><span class="line">    | <span class="string">&quot;1x&quot;</span></span><br><span class="line">    | <span class="string">&quot;2x&quot;</span></span><br><span class="line">    | <span class="string">&quot;3x&quot;</span></span><br><span class="line">    | <span class="string">&quot;4x&quot;</span></span><br><span class="line">    | <span class="string">&quot;5x&quot;</span></span><br><span class="line">    | <span class="string">&quot;6x&quot;</span></span><br><span class="line">    | <span class="string">&quot;7x&quot;</span></span><br><span class="line">    | <span class="string">&quot;8x&quot;</span></span><br><span class="line">    | <span class="string">&quot;9x&quot;</span></span><br><span class="line">    | <span class="string">&quot;10x&quot;</span>;</span><br><span class="line">  <span class="attr">spin</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">transform</span>?: <span class="built_in">object</span> | <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">symbol</span>?: <span class="built_in">boolean</span> | <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">title</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">inverse</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">bounce</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">shake</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">beat</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">fade</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">beatFade</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">spinPulse</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">spinReverse</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">type</span>?: <span class="string">&quot;primary&quot;</span> | <span class="string">&quot;success&quot;</span> | <span class="string">&quot;warning&quot;</span> | <span class="string">&quot;danger&quot;</span> | <span class="string">&quot;info&quot;</span>;</span><br><span class="line">  <span class="attr">color</span>?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Input"><a href="#â”œâ”€-Input" class="headerlink" title="â”œâ”€ Input"></a>â”œâ”€ Input</h3><blockquote><p>è¾“å…¥æ¡†ç»„ä»¶, æ¥æ”¶ç”¨æˆ·è¾“å…¥</p></blockquote><h4 id="â€“APIâ€“-6"><a href="#â€“APIâ€“-6" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-index-ts-8"><a href="#â”œâ”€-index-ts-8" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Input</span> <span class="keyword">from</span> <span class="string">&quot;./Input.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErInput</span> = <span class="title function_">withInstall</span>(<span class="title class_">Input</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Input-test-tsx"><a href="#â”œâ”€-Input-test-tsx" class="headerlink" title="â”œâ”€ Input.test.tsx"></a>â”œâ”€ Input.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, expect, test &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Input</span> <span class="keyword">from</span> <span class="string">&quot;./Input.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Input.vue&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;render&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Input</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">size</span>: <span class="string">&quot;small&quot;</span>,</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">prepend</span>: <span class="string">&quot;prepend&quot;</span>,</span><br><span class="line">        <span class="attr">prefix</span>: <span class="string">&quot;prefix&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// é’ˆå¯¹åŠ¨æ€ class çš„æµ‹è¯•</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;er-input&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;er-input--small&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;er-input--text&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-prefix&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-prepend&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­£ç¡®çš„æ ‡ç­¾å’ŒèŠ‚ç‚¹</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;input&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">get</span>(<span class="string">&quot;input&quot;</span>).<span class="title function_">attributes</span>(<span class="string">&quot;type&quot;</span>)).<span class="title function_">toBe</span>(<span class="string">&quot;text&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é’ˆå¯¹ slots çš„æµ‹è¯•</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__prepend&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">get</span>(<span class="string">&quot;.er-input__prepend&quot;</span>).<span class="title function_">text</span>()).<span class="title function_">toBe</span>(<span class="string">&quot;prepend&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__prefix&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">get</span>(<span class="string">&quot;.er-input__prefix&quot;</span>).<span class="title function_">text</span>()).<span class="title function_">toBe</span>(<span class="string">&quot;prefix&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é’ˆå¯¹ v-if çš„æµ‹è¯•</span></span><br><span class="line">    <span class="keyword">const</span> wrapper2 = <span class="title function_">mount</span>(<span class="title class_">Input</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;textarea&quot;</span>,</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper2.<span class="title function_">find</span>(<span class="string">&quot;textarea&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;v-model&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">wrapper</span>: <span class="built_in">any</span> = <span class="title function_">mount</span>(<span class="title class_">Input</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">        <span class="string">&quot;onUpdate:modelValue&quot;</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> wrapper.<span class="title function_">setProps</span>(&#123; <span class="attr">modelValue</span>: e &#125;),</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> input = wrapper.<span class="title function_">get</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹å€¼</span></span><br><span class="line">    <span class="title function_">expect</span>(input.<span class="property">element</span>.<span class="property">value</span>).<span class="title function_">toBe</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ›´æ–°å€¼</span></span><br><span class="line">    <span class="comment">// setValue ä¼šè§¦å‘ input å’Œ change äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">await</span> input.<span class="title function_">setValue</span>(<span class="string">&quot;test2&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">props</span>(<span class="string">&quot;modelValue&quot;</span>)).<span class="title function_">toBe</span>(<span class="string">&quot;test2&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(input.<span class="property">element</span>.<span class="property">value</span>).<span class="title function_">toBe</span>(<span class="string">&quot;test2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;change&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> inputEvent = wrapper.<span class="title function_">emitted</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> changeEvent = wrapper.<span class="title function_">emitted</span>(<span class="string">&quot;change&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(inputEvent![<span class="number">0</span>]).<span class="title function_">toEqual</span>([<span class="string">&quot;test2&quot;</span>]);</span><br><span class="line">    <span class="title function_">expect</span>(changeEvent![<span class="number">0</span>]).<span class="title function_">toEqual</span>([<span class="string">&quot;test2&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// v-model å¼‚æ­¥æ›´æ–°</span></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">setProps</span>(&#123; <span class="attr">modelValue</span>: <span class="string">&quot;test3&quot;</span> &#125;);</span><br><span class="line">    <span class="title function_">expect</span>(input.<span class="property">element</span>.<span class="property">value</span>).<span class="title function_">toBe</span>(<span class="string">&quot;test3&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;clearable&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Input</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">        <span class="attr">clearable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">global</span>: &#123;</span><br><span class="line">        <span class="attr">stubs</span>: [<span class="string">&quot;Icon&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸åº”è¯¥å‡ºç° Icon åŒºåŸŸ</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__clear&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> input = wrapper.<span class="title function_">get</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> input.<span class="title function_">trigger</span>(<span class="string">&quot;focus&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;focus&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‡ºç° Icon åŒºåŸŸ</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__clear&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç‚¹å‡» Icon åŒºåŸŸï¼Œè§¦å‘ clear äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">get</span>(<span class="string">&quot;.er-input__clear&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;clear&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;change&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> inputEvent = wrapper.<span class="title function_">emitted</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> changeEvent = wrapper.<span class="title function_">emitted</span>(<span class="string">&quot;change&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(inputEvent![<span class="number">0</span>]).<span class="title function_">toEqual</span>([<span class="string">&quot;&quot;</span>]);</span><br><span class="line">    <span class="title function_">expect</span>(changeEvent![<span class="number">0</span>]).<span class="title function_">toEqual</span>([<span class="string">&quot;&quot;</span>]);</span><br><span class="line">    <span class="title function_">expect</span>(input.<span class="property">element</span>.<span class="property">value</span>).<span class="title function_">toBe</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> input.<span class="title function_">trigger</span>(<span class="string">&quot;blur&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;blur&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;toggle password&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Input</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;password&quot;</span>,</span><br><span class="line">        <span class="attr">showPassword</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">global</span>: &#123;</span><br><span class="line">        <span class="attr">stubs</span>: [<span class="string">&quot;Icon&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸åº”è¯¥å‡ºç° Icon åŒºåŸŸ</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__password&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="keyword">const</span> input = wrapper.<span class="title function_">get</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(input.<span class="property">element</span>.<span class="property">type</span>).<span class="title function_">toBe</span>(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> input.<span class="title function_">setValue</span>(<span class="string">&quot;123&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> eyeIcon = wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__password&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(eyeIcon.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(eyeIcon.<span class="title function_">attributes</span>(<span class="string">&quot;icon&quot;</span>)).<span class="title function_">toBe</span>(<span class="string">&quot;eye-slash&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç‚¹å‡» åˆ‡æ¢</span></span><br><span class="line">    <span class="keyword">await</span> eyeIcon.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(input.<span class="property">element</span>.<span class="property">type</span>).<span class="title function_">toBe</span>(<span class="string">&quot;text&quot;</span>);</span><br><span class="line">    <span class="comment">// ç¼“å­˜ Icon</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__password&quot;</span>).<span class="title function_">attributes</span>(<span class="string">&quot;icon&quot;</span>)).<span class="title function_">toBe</span>(<span class="string">&quot;eye&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Input-vue"><a href="#â”œâ”€-Input-vue" class="headerlink" title="â”œâ”€ Input.vue"></a>â”œâ”€ Input.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; computed, ref, watch, useAttrs, shallowRef, nextTick &#125; from &quot;vue&quot;;</span><br><span class="line">import type &#123; InputProps, InputEmits, InputInstance &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; useFormItem, useFormDisabled, useFormItemInputId &#125; from &quot;../Form&quot;;</span><br><span class="line">import &#123; debugWarn &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import &#123; useFocusController &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; each, noop &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import Icon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErInput&quot;,</span><br><span class="line">  inheritAttrs: false,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;InputProps&gt;(), &#123;</span><br><span class="line">  type: &quot;text&quot;,</span><br><span class="line">  autocomplete: &quot;off&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;InputEmits&gt;();</span><br><span class="line"></span><br><span class="line">const innerValue = ref(props.modelValue);</span><br><span class="line">const passwordVisible = ref(false);</span><br><span class="line"></span><br><span class="line">const inputRef = shallowRef&lt;HTMLInputElement&gt;();</span><br><span class="line">const textareaRef = shallowRef&lt;HTMLTextAreaElement&gt;();</span><br><span class="line"></span><br><span class="line">const showClear = computed(</span><br><span class="line">  () =&gt;</span><br><span class="line">    props.clearable &amp;&amp;</span><br><span class="line">    !!innerValue.value &amp;&amp;</span><br><span class="line">    !isDisabled.value &amp;&amp;</span><br><span class="line">    isFocused.value</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const showPasswordArea = computed(</span><br><span class="line">  () =&gt;</span><br><span class="line">    props.type === &quot;password&quot; &amp;&amp;</span><br><span class="line">    props.showPassword &amp;&amp;</span><br><span class="line">    !isDisabled.value &amp;&amp;</span><br><span class="line">    !!innerValue.value</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const _ref = computed(() =&gt; inputRef.value || textareaRef.value);</span><br><span class="line"></span><br><span class="line">const attrs = useAttrs();</span><br><span class="line">const isDisabled = useFormDisabled();</span><br><span class="line">const &#123; formItem &#125; = useFormItem();</span><br><span class="line">const &#123; inputId &#125; = useFormItemInputId(props, formItem);</span><br><span class="line">const &#123; wrapperRef, isFocused, handleFocus, handleBlur &#125; = useFocusController(</span><br><span class="line">  _ref,</span><br><span class="line">  &#123;</span><br><span class="line">    afterBlur() &#123;</span><br><span class="line">      formItem?.validate(&quot;blur&quot;).catch((err) =&gt; debugWarn(err));</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const clear: InputInstance[&quot;clear&quot;] = function () &#123;</span><br><span class="line">  innerValue.value = &quot;&quot;;</span><br><span class="line">  each([&quot;update:modelValue&quot;, &quot;input&quot;, &quot;change&quot;], (e) =&gt; emits(e as any, &quot;&quot;));</span><br><span class="line">  emits(&quot;clear&quot;);</span><br><span class="line">  formItem?.clearValidate();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const focus: InputInstance[&quot;focus&quot;] = async function () &#123;</span><br><span class="line">  await nextTick();</span><br><span class="line">  _ref.value?.focus();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const blur: InputInstance[&quot;blur&quot;] = function () &#123;</span><br><span class="line">  _ref.value?.blur();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const select: InputInstance[&quot;select&quot;] = function () &#123;</span><br><span class="line">  _ref.value?.select();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function handleInput() &#123;</span><br><span class="line">  emits(&quot;update:modelValue&quot;, innerValue.value);</span><br><span class="line">  emits(&quot;input&quot;, innerValue.value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleChange() &#123;</span><br><span class="line">  emits(&quot;change&quot;, innerValue.value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function togglePasswordVisible() &#123;</span><br><span class="line">  passwordVisible.value = !passwordVisible.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.modelValue,</span><br><span class="line">  (newValue) =&gt; &#123;</span><br><span class="line">    innerValue.value = newValue;</span><br><span class="line">    formItem?.validate(&quot;change&quot;).catch((err) =&gt; debugWarn(err));</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;InputInstance&gt;(&#123;</span><br><span class="line">  ref: _ref,</span><br><span class="line">  focus,</span><br><span class="line">  blur,</span><br><span class="line">  select,</span><br><span class="line">  clear,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;er-input&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      [`er-input--$&#123;type&#125;`]: type,</span><br><span class="line">      [`er-input--$&#123;size&#125;`]: size,</span><br><span class="line">      &#x27;is-disabled&#x27;: isDisabled,</span><br><span class="line">      &#x27;is-prepend&#x27;: $slots.prepend,</span><br><span class="line">      &#x27;is-append&#x27;: $slots.append,</span><br><span class="line">      &#x27;is-prefix&#x27;: $slots.prefix,</span><br><span class="line">      &#x27;is-suffix&#x27;: $slots.suffix,</span><br><span class="line">      &#x27;is-focus&#x27;: isFocused,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- input --&gt;</span><br><span class="line">    &lt;template v-if=&quot;type !== &#x27;textarea&#x27;&quot;&gt;</span><br><span class="line">      &lt;!-- prepend slot --&gt;</span><br><span class="line">      &lt;div v-if=&quot;$slots.prepend&quot; class=&quot;er-input__prepend&quot;&gt;</span><br><span class="line">        &lt;slot name=&quot;prepend&quot;&gt;&lt;/slot&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;er-input__wrapper&quot; ref=&quot;wrapperRef&quot;&gt;</span><br><span class="line">        &lt;!-- prefix slot --&gt;</span><br><span class="line">        &lt;span v-if=&quot;$slots.prefix&quot; class=&quot;er-input__prefix&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;prefix&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          class=&quot;er-input__inner&quot;</span><br><span class="line">          ref=&quot;inputRef&quot;</span><br><span class="line">          :id=&quot;inputId&quot;</span><br><span class="line">          :type=&quot;showPassword ? (passwordVisible ? &#x27;text&#x27; : &#x27;password&#x27;) : type&quot;</span><br><span class="line">          :disabled=&quot;isDisabled&quot;</span><br><span class="line">          :readonly=&quot;readonly&quot;</span><br><span class="line">          :autocomplete=&quot;autocomplete&quot;</span><br><span class="line">          :placeholder=&quot;placeholder&quot;</span><br><span class="line">          :autofocus=&quot;autofocus&quot;</span><br><span class="line">          :form=&quot;form&quot;</span><br><span class="line">          v-model=&quot;innerValue&quot;</span><br><span class="line">          v-bind=&quot;attrs&quot;</span><br><span class="line">          @input=&quot;handleInput&quot;</span><br><span class="line">          @change=&quot;handleChange&quot;</span><br><span class="line">          @focus=&quot;handleFocus&quot;</span><br><span class="line">          @blur=&quot;handleBlur&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;!-- suffix slot --&gt;</span><br><span class="line">        &lt;span</span><br><span class="line">          v-if=&quot;$slots.suffix || showClear || showPasswordArea&quot;</span><br><span class="line">          class=&quot;er-input__suffix&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;slot name=&quot;suffix&quot;&gt;&lt;/slot&gt;</span><br><span class="line">          &lt;Icon</span><br><span class="line">            icon=&quot;circle-xmark&quot;</span><br><span class="line">            v-if=&quot;showClear&quot;</span><br><span class="line">            class=&quot;er-input__clear&quot;</span><br><span class="line">            @click=&quot;clear&quot;</span><br><span class="line">            @mousedown.prevent=&quot;noop&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Icon</span><br><span class="line">            icon=&quot;eye&quot;</span><br><span class="line">            v-if=&quot;showPasswordArea &amp;&amp; passwordVisible&quot;</span><br><span class="line">            class=&quot;er-input__password&quot;</span><br><span class="line">            @click=&quot;togglePasswordVisible&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Icon</span><br><span class="line">            icon=&quot;eye-slash&quot;</span><br><span class="line">            v-if=&quot;showPasswordArea &amp;&amp; !passwordVisible&quot;</span><br><span class="line">            class=&quot;er-input__password&quot;</span><br><span class="line">            @click=&quot;togglePasswordVisible&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- append slot --&gt;</span><br><span class="line">      &lt;div v-if=&quot;$slots.append&quot; class=&quot;er-input__append&quot;&gt;</span><br><span class="line">        &lt;slot name=&quot;append&quot;&gt;&lt;/slot&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- textarea --&gt;</span><br><span class="line">    &lt;template v-else&gt;</span><br><span class="line">      &lt;textarea</span><br><span class="line">        class=&quot;er-textarea__wrapper&quot;</span><br><span class="line">        ref=&quot;textareaRef&quot;</span><br><span class="line">        :id=&quot;inputId&quot;</span><br><span class="line">        :disabled=&quot;isDisabled&quot;</span><br><span class="line">        :readonly=&quot;readonly&quot;</span><br><span class="line">        :autocomplete=&quot;autocomplete&quot;</span><br><span class="line">        :placeholder=&quot;placeholder&quot;</span><br><span class="line">        :autofocus=&quot;autofocus&quot;</span><br><span class="line">        :form=&quot;form&quot;</span><br><span class="line">        v-model=&quot;innerValue&quot;</span><br><span class="line">        v-bind=&quot;attrs&quot;</span><br><span class="line">        @input=&quot;handleInput&quot;</span><br><span class="line">        @change=&quot;handleChange&quot;</span><br><span class="line">        @focus=&quot;handleFocus&quot;</span><br><span class="line">        @blur=&quot;handleBlur&quot;</span><br><span class="line">      &gt;&lt;/textarea&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-6"><a href="#â”œâ”€-style-css-6" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-input</span> &#123;</span><br><span class="line">  <span class="attr">--er-input-text-color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">  <span class="attr">--er-input-border</span>: <span class="built_in">var</span>(--er-border);</span><br><span class="line">  <span class="attr">--er-input-hover-border</span>: <span class="built_in">var</span>(--er-border-color-hover);</span><br><span class="line">  <span class="attr">--er-input-focus-border</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">  <span class="attr">--er-input-transparent-border</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> transparent inset;</span><br><span class="line">  <span class="attr">--er-input-border-color</span>: <span class="built_in">var</span>(--er-border-color);</span><br><span class="line">  <span class="attr">--er-input-border-radius</span>: <span class="built_in">var</span>(--er-border-radius-base);</span><br><span class="line">  <span class="attr">--er-input-bg-color</span>: <span class="built_in">var</span>(--er-fill-color-blank);</span><br><span class="line">  <span class="attr">--er-input-icon-color</span>: <span class="built_in">var</span>(--er-text-color-placeholder);</span><br><span class="line">  <span class="attr">--er-input-placeholder-color</span>: <span class="built_in">var</span>(--er-text-color-placeholder);</span><br><span class="line">  <span class="attr">--er-input-hover-border-color</span>: <span class="built_in">var</span>(--er-border-color-hover);</span><br><span class="line">  <span class="attr">--er-input-clear-hover-color</span>: <span class="built_in">var</span>(--er-text-color-secondary);</span><br><span class="line">  <span class="attr">--er-input-focus-border-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-input</span> &#123;</span><br><span class="line">  <span class="attr">--er-input-height</span>: <span class="built_in">var</span>(--er-component-size);</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="built_in">var</span>(--er-input-height);</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">  &amp;<span class="selector-class">.is-disabled</span> &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    <span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-disabled-bg-color);</span><br><span class="line">      <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-disabled-border-color) inset;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.er-input__inner</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">      -webkit-<span class="selector-tag">text</span>-<span class="attribute">fill</span>-<span class="attribute">color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">      <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.er-textarea__inner</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-disabled-bg-color);</span><br><span class="line">      <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-disabled-border-color) inset;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">      -webkit-<span class="selector-tag">text</span>-<span class="attribute">fill</span>-<span class="attribute">color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">      <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-prepend</span> &#123;</span><br><span class="line">    &gt;<span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">      <span class="attribute">border-top-left-radius</span>: <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">border-bottom-left-radius</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-append</span> &#123;</span><br><span class="line">    &gt;<span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">      <span class="attribute">border-top-right-radius</span>: <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">border-bottom-right-radius</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-focus</span> <span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-input-focus-border-color) inset<span class="meta">!important</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-input--large</span> &#123;</span><br><span class="line">  <span class="attr">--er-input-height</span>: <span class="built_in">var</span>(--er-component-size-large);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1px</span> <span class="number">15px</span>;</span><br><span class="line">    <span class="selector-class">.er-input__inner</span> &#123;</span><br><span class="line">      <span class="attr">--er-input-inner-height</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--er-input-height, <span class="number">40px</span>) - <span class="number">2px</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input--small</span> &#123;</span><br><span class="line">  <span class="attr">--er-input-height</span>: <span class="built_in">var</span>(--er-component-size-small);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1px</span> <span class="number">7px</span>;</span><br><span class="line">    <span class="selector-class">.er-input__inner</span> &#123;</span><br><span class="line">      <span class="attr">--er-input-inner-height</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--er-input-height, <span class="number">24px</span>) - <span class="number">2px</span>);</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__prefix</span>, <span class="selector-class">.er-input__suffix</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  <span class="attribute">flex-shrink</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: nowrap;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-icon-color, <span class="built_in">var</span>(--er-text-color-placeholder));</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__prefix</span> &#123;</span><br><span class="line">  &gt;<span class="selector-pseudo">:first-child</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  &gt;<span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">8px</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__suffix</span> &#123;</span><br><span class="line">  &gt;<span class="selector-pseudo">:first-child</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">8px</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  &gt;<span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__prepend</span>, <span class="selector-class">.er-input__append</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-fill-color-light);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-info);</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-input-border-radius);</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__prepend</span> &#123;</span><br><span class="line">  <span class="attribute">border-right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-top-right-radius</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-bottom-right-radius</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">1px</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">var</span>(--er-input-border-color) inset,<span class="number">0</span> <span class="number">1px</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">var</span>(--er-input-border-color) inset,<span class="number">0</span> -<span class="number">1px</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">var</span>(--er-input-border-color) inset;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__append</span> &#123;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-top-left-radius</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-bottom-left-radius</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">1px</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">var</span>(--er-input-border-color) inset,<span class="number">0</span> -<span class="number">1px</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">var</span>(--er-input-border-color) inset,-<span class="number">1px</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">var</span>(--er-input-border-color) inset;</span><br><span class="line">  &amp; &gt;<span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">border-top-left-radius</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border-bottom-left-radius</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-input--textarea</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">vertical-align</span>: bottom;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-textarea__wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">resize</span>: vertical;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">11px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.5</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: inherit;</span><br><span class="line">  <span class="attribute">font-family</span>: inherit;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-text-color, <span class="built_in">var</span>(--er-text-color-regular));</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-input-bg-color, <span class="built_in">var</span>(--er-fill-color-blank));</span><br><span class="line">  <span class="attribute">background-image</span>: none;</span><br><span class="line">  -webkit-<span class="attribute">appearance</span>: none;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-input-border-color, <span class="built_in">var</span>(--er-border-color)) inset;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-input-border-radius, <span class="built_in">var</span>(--er-border-radius-base));</span><br><span class="line">  <span class="attribute">transition</span>: <span class="built_in">var</span>(--er-transition-box-shadow);</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  &amp;<span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">    <span class="attribute">outline</span>: none;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-input-focus-border-color) inset;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-pseudo">::placeholder</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-placeholder-color);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">flex-grow</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">1px</span> <span class="number">11px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-input-bg-color, <span class="built_in">var</span>(--er-fill-color-blank));</span><br><span class="line">  <span class="attribute">background-image</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-input-border-radius, <span class="built_in">var</span>(--er-border-radius-base));</span><br><span class="line">  <span class="attribute">transition</span>: <span class="built_in">var</span>(--er-transition-box-shadow);</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-input-border-color, <span class="built_in">var</span>(--er-border-color)) inset;</span><br><span class="line">  &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-input-hover-border-color) inset;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-focus</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-input-focus-border-color) inset;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-input__inner</span> &#123;</span><br><span class="line">    <span class="attr">--er-input-inner-height</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--er-input-height, <span class="number">32px</span>) - <span class="number">2px</span>);</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">flex-grow</span>: <span class="number">1</span>;</span><br><span class="line">    -webkit-<span class="attribute">appearance</span>: none;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-text-color, <span class="built_in">var</span>(--er-text-color-regular));</span><br><span class="line">    <span class="attribute">font-size</span>: inherit;</span><br><span class="line">    <span class="attribute">height</span>: <span class="built_in">var</span>(--er-input-inner-height);</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="built_in">var</span>(--er-input-inner-height);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">outline</span>: none;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">background</span>: none;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    &amp;<span class="selector-pseudo">::placeholder</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-placeholder-color);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="selector-class">.er-icon</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: inherit;</span><br><span class="line">    <span class="attribute">line-height</span>: inherit;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">8px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-input__clear</span>, <span class="selector-class">.er-input__password</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-icon-color);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">     <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-clear-hover-color);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-7"><a href="#â””â”€-types-ts-7" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">InputProps</span> &#123;</span><br><span class="line">  <span class="attr">id</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">modelValue</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">type</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">size</span>?: <span class="string">&quot;large&quot;</span> | <span class="string">&quot;small&quot;</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">clearable</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">showPassword</span>?: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">placeholder</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">readonly</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">autocomplete</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">autofocus</span>?: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">form</span>?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">InputEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;update:modelValue&quot;</span>, <span class="attr">value</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;input&quot;</span>, <span class="attr">value</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// ä¿®æ”¹å€¼ä¸” å¤±å»ç„¦ç‚¹ æ‰è§¦å‘&#x27;change&#x27;</span></span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;change&quot;</span>, <span class="attr">value</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;focus&quot;</span>, <span class="attr">value</span>: <span class="title class_">FocusEvent</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;blur&quot;</span>, <span class="attr">value</span>: <span class="title class_">FocusEvent</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;clear&quot;</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">InputInstance</span> &#123;</span><br><span class="line">  <span class="attr">ref</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">HTMLInputElement</span> | <span class="title class_">HTMLTextAreaElement</span> | <span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="title function_">focus</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="title function_">blur</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">select</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">clear</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Loading"><a href="#â”œâ”€-Loading" class="headerlink" title="â”œâ”€ Loading"></a>â”œâ”€ Loading</h3><blockquote><p>æ˜¾ç¤ºåŠ è½½çŠ¶æ€</p></blockquote><h4 id="â€“APIâ€“-7"><a href="#â€“APIâ€“-7" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-directive-ts"><a href="#â”œâ”€-directive-ts" class="headerlink" title="â”œâ”€ directive.ts"></a>â”œâ”€ directive.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Directive</span>, <span class="keyword">type</span> <span class="title class_">DirectiveBinding</span>, <span class="keyword">type</span> <span class="title class_">MaybeRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">LoadingOptions</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">LoadingInstance</span>, <span class="title class_">Loading</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./service&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">INSTANCE_KEY</span> = <span class="title class_">Symbol</span>(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ElementLoading</span> <span class="keyword">extends</span> <span class="title class_">HTMLElement</span> &#123;</span><br><span class="line">  [<span class="variable constant_">INSTANCE_KEY</span>]?: &#123;</span><br><span class="line">    <span class="attr">instance</span>: <span class="title class_">LoadingInstance</span>;</span><br><span class="line">    <span class="attr">options</span>: <span class="title class_">LoadingOptions</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">el</span>: <span class="title class_">ElementLoading</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">binding</span>: <span class="title class_">DirectiveBinding</span>&lt;<span class="built_in">boolean</span>&gt;</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> getProp = &lt;K <span class="keyword">extends</span> keyof <span class="title class_">LoadingOptions</span>&gt;<span class="function">(<span class="params"><span class="attr">name</span>: K</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> el.<span class="title function_">getAttribute</span>(<span class="string">`er-loading-<span class="subst">$&#123;name&#125;</span>`</span>) <span class="keyword">as</span> <span class="title class_">MaybeRef</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getModifier = &lt;K <span class="keyword">extends</span> keyof <span class="title class_">LoadingOptions</span>&gt;<span class="function">(<span class="params"><span class="attr">name</span>: K</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> binding.<span class="property">modifiers</span>[name];</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fullscreen = <span class="title function_">getModifier</span>(<span class="string">&quot;fullscreen&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">options</span>: <span class="title class_">LoadingOptions</span> = &#123;</span><br><span class="line">    <span class="attr">text</span>: <span class="title function_">getProp</span>(<span class="string">&quot;text&quot;</span>),</span><br><span class="line">    <span class="attr">spinner</span>: <span class="title function_">getProp</span>(<span class="string">&quot;spinner&quot;</span>),</span><br><span class="line">    <span class="attr">background</span>: <span class="title function_">getProp</span>(<span class="string">&quot;background&quot;</span>),</span><br><span class="line">    <span class="attr">target</span>: fullscreen ? <span class="built_in">void</span> <span class="number">0</span> : el,</span><br><span class="line">    <span class="attr">body</span>: <span class="title function_">getModifier</span>(<span class="string">&quot;body&quot;</span>),</span><br><span class="line">    <span class="attr">lock</span>: <span class="title function_">getModifier</span>(<span class="string">&quot;lock&quot;</span>),</span><br><span class="line">    fullscreen,</span><br><span class="line">  &#125;;</span><br><span class="line">  el[<span class="variable constant_">INSTANCE_KEY</span>] = &#123;</span><br><span class="line">    options,</span><br><span class="line">    <span class="attr">instance</span>: <span class="title class_">Loading</span>(options),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">vLoading</span>: <span class="title class_">Directive</span>&lt;<span class="title class_">ElementLoading</span>, <span class="built_in">boolean</span>&gt; = &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (binding.<span class="property">value</span>) <span class="title function_">createInstance</span>(el, binding);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">updated</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (binding.<span class="property">oldValue</span> === binding.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (binding.<span class="property">value</span> &amp;&amp; !binding.<span class="property">oldValue</span>) &#123;</span><br><span class="line">      <span class="title function_">createInstance</span>(el, binding);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    el[<span class="variable constant_">INSTANCE_KEY</span>]?.<span class="property">instance</span>?.<span class="title function_">close</span>();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">unmounted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    el[<span class="variable constant_">INSTANCE_KEY</span>]?.<span class="property">instance</span>.<span class="title function_">close</span>();</span><br><span class="line">    el[<span class="variable constant_">INSTANCE_KEY</span>] = <span class="built_in">void</span> <span class="number">0</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-index-ts-9"><a href="#â”œâ”€-index-ts-9" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; vLoading &#125; <span class="keyword">from</span> <span class="string">&quot;./directive&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Loading</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./service&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErLoading</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&#x27;ErLoading&#x27;</span>,</span><br><span class="line">  <span class="title function_">install</span>(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) &#123;</span><br><span class="line">    app.<span class="title function_">directive</span>(<span class="string">&quot;loading&quot;</span>, vLoading);</span><br><span class="line">    app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$loading</span> = <span class="title class_">Loading</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">directive</span>: vLoading,</span><br><span class="line">  <span class="attr">service</span>: <span class="title class_">Loading</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ErLoading</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  vLoading,</span><br><span class="line">  vLoading <span class="keyword">as</span> <span class="title class_">ErLoadingDirective</span>,</span><br><span class="line">  <span class="title class_">Loading</span> <span class="keyword">as</span> <span class="title class_">ErLoadingService</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Loading-test-tsx"><a href="#â”œâ”€-Loading-test-tsx" class="headerlink" title="â”œâ”€ Loading.test.tsx"></a>â”œâ”€ Loading.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, expect &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; nextTick &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Loading</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./service&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">rAF</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">requestAnimationFrame</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="title function_">res</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">nextTick</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Loading&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should creat Loading instance&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> instance = <span class="title class_">Loading</span>();</span><br><span class="line">    <span class="title function_">expect</span>(instance).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should render mask&#x27;</span>,<span class="title function_">async</span>()=&gt;&#123;</span><br><span class="line">    <span class="title class_">Loading</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.er-loading__mask&#x27;</span>)).<span class="title function_">toBeTruthy</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should close Loading and remove it from DOM&#x27;</span>,<span class="title function_">async</span>()=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> instance = <span class="title class_">Loading</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.er-loading&#x27;</span>)).<span class="title function_">toBeTruthy</span>()</span><br><span class="line">    instance.<span class="title function_">close</span>()</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.er-loading&#x27;</span>)).<span class="title function_">toBeFalsy</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Loading-vue"><a href="#â”œâ”€-Loading-vue" class="headerlink" title="â”œâ”€ Loading.vue"></a>â”œâ”€ Loading.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; LoadingOptions &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; computed, type Ref &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; isString &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErLoading&quot;,</span><br><span class="line">  inheritAttrs: false,</span><br><span class="line">&#125;);</span><br><span class="line">const props = defineProps&lt;LoadingOptions&gt;();</span><br><span class="line"></span><br><span class="line">const iconName = computed(() =&gt; &#123;</span><br><span class="line">  if (isString(props.spinner)) &#123;</span><br><span class="line">    return props.spinner;</span><br><span class="line">  &#125;</span><br><span class="line">  return &quot;spinner&quot;; // &#x27;circle-notch&#x27; ä¹Ÿå¾ˆå¥½çœ‹</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition name=&quot;fade-in-linear&quot; @after-leave=&quot;onAfterLeave&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&quot;(props.visible as Ref).value&quot;</span><br><span class="line">      class=&quot;er-loading er-loading__mask&quot;</span><br><span class="line">      :class=&quot;&#123; &#x27;is-fullscreen&#x27;: fullscreen &#125;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div class=&quot;er-loading__spinner&quot;&gt;</span><br><span class="line">        &lt;er-icon v-if=&quot;props.spinner !== false&quot; :icon=&quot;iconName&quot; spin /&gt;</span><br><span class="line">        &lt;p v-if=&quot;text&quot; class=&quot;er-loading-text&quot;&gt;&#123;&#123; text &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">.er-loading &#123;</span><br><span class="line">  --er-loading-bg-color: v-bind(background) !important;</span><br><span class="line">  --er-loading-z-index: v-bind(zIndex) !important;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-service-ts"><a href="#â”œâ”€-service-ts" class="headerlink" title="â”œâ”€ service.ts"></a>â”œâ”€ service.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">LoadingOptions</span>, <span class="title class_">LoadingOptionsResolved</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, createApp, reactive, nextTick &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useZIndex &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/hooks&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">LoadingComp</span> <span class="keyword">from</span> <span class="string">&quot;./Loading.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; delay, isNil, isString &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">RELATIVE_CLASS</span> = <span class="string">&quot;er-loading-parent--relative&quot;</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">HIDDEN_CLASS</span> = <span class="string">&quot;er-loading-parent--hiden&quot;</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">LOADING_NUMB_KEY</span> = <span class="string">&quot;er-loading-numb&quot;</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">instanceMap</span>: <span class="title class_">Map</span>&lt;<span class="title class_">HTMLElement</span>, <span class="title class_">LoadingInstance</span>&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; nextZIndex &#125; = <span class="title function_">useZIndex</span>(<span class="number">30000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createLoadingComponent</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">LoadingOptionsResolved</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> afterLeaveFlag = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleAfterLeave</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!afterLeaveFlag.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="title function_">destroy</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> data = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    ...options,</span><br><span class="line">    <span class="attr">onAfterLeave</span>: handleAfterLeave,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">setText</span> = (<span class="params"><span class="attr">text</span>: <span class="built_in">string</span></span>) =&gt; (data.<span class="property">text</span> = text);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">destroy</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> target = data.<span class="property">parent</span>;</span><br><span class="line">    <span class="title function_">subtLoadingNumb</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">getLoadingNumb</span>(target)) <span class="keyword">return</span>;</span><br><span class="line">    <span class="title function_">delay</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">removeRelativeClass</span>(target);</span><br><span class="line">      <span class="title function_">removeHiddenClass</span>(target);</span><br><span class="line">    &#125;, <span class="number">1</span>);</span><br><span class="line">    instanceMap.<span class="title function_">delete</span>(target ?? <span class="variable language_">document</span>.<span class="property">body</span>);</span><br><span class="line">    vm.<span class="property">$el</span>?.<span class="property">parentNode</span>?.<span class="title function_">removeChild</span>(vm.<span class="property">$el</span>);</span><br><span class="line">    app.<span class="title function_">unmount</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">afterLeaveTimer</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">close</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">beforeClose</span> &amp;&amp; !options.<span class="title function_">beforeClose</span>()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    afterLeaveFlag.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(afterLeaveTimer);</span><br><span class="line">    afterLeaveTimer = <span class="title function_">delay</span>(handleAfterLeave, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">    visible.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">    options.<span class="property">closed</span>?.();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">LoadingComp</span>, &#123;</span><br><span class="line">    ...data,</span><br><span class="line">    <span class="attr">zIndex</span>: data.<span class="property">fullscreen</span> ? <span class="title function_">nextZIndex</span>() : <span class="built_in">void</span> <span class="number">0</span>,</span><br><span class="line">    visible,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> vm = app.<span class="title function_">mount</span>(<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">$el</span>(): <span class="title class_">HTMLElement</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> vm.<span class="property">$el</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    vm,</span><br><span class="line">    close,</span><br><span class="line">    visible,</span><br><span class="line">    setText,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolveOptions</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">LoadingOptions</span></span>): <span class="title class_">LoadingOptionsResolved</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">target</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isString</span>(options.<span class="property">target</span>)) &#123;</span><br><span class="line">    target = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(options.<span class="property">target</span>) ?? <span class="variable language_">document</span>.<span class="property">body</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    target = options.<span class="property">target</span> || <span class="variable language_">document</span>.<span class="property">body</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">parent</span>: target === <span class="variable language_">document</span>.<span class="property">body</span> || options.<span class="property">body</span> ? <span class="variable language_">document</span>.<span class="property">body</span> : target,</span><br><span class="line">    <span class="attr">background</span>: options.<span class="property">background</span> ?? <span class="string">&quot;rgba(0, 0, 0, 0.5)&quot;</span>,</span><br><span class="line">    <span class="attr">spinner</span>: options.<span class="property">spinner</span>,</span><br><span class="line">    <span class="attr">text</span>: options.<span class="property">text</span>,</span><br><span class="line">    <span class="attr">fullscreen</span>: target === <span class="variable language_">document</span>.<span class="property">body</span> &amp;&amp; (options.<span class="property">fullscreen</span> ?? <span class="literal">true</span>),</span><br><span class="line">    <span class="attr">lock</span>: options.<span class="property">lock</span> ?? <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">visible</span>: options.<span class="property">visible</span> ?? <span class="literal">true</span>,</span><br><span class="line">    target,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addRelativeClass</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  target.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="variable constant_">RELATIVE_CLASS</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">removeRelativeClass</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  target.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="variable constant_">RELATIVE_CLASS</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addHiddenClass</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  target.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="variable constant_">HIDDEN_CLASS</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">removeHiddenClass</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  target.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="variable constant_">HIDDEN_CLASS</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getLoadingNumb</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> target.<span class="title function_">getAttribute</span>(<span class="variable constant_">LOADING_NUMB_KEY</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">removeLoadingNumb</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  target.<span class="title function_">removeAttribute</span>(<span class="variable constant_">LOADING_NUMB_KEY</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addLoadingNumb</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> numb = <span class="title function_">getLoadingNumb</span>(target) ?? <span class="string">&quot;0&quot;</span>;</span><br><span class="line">  target.<span class="title function_">setAttribute</span>(<span class="variable constant_">LOADING_NUMB_KEY</span>, <span class="string">`<span class="subst">$&#123;<span class="built_in">Number</span>.<span class="built_in">parseInt</span>(numb) + <span class="number">1</span>&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">subtLoadingNumb</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> numb = <span class="title function_">getLoadingNumb</span>(target);</span><br><span class="line">  <span class="keyword">if</span> (numb) &#123;</span><br><span class="line">    <span class="keyword">const</span> newNumb = <span class="title class_">Number</span>.<span class="built_in">parseInt</span>(numb) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (newNumb === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="title function_">removeLoadingNumb</span>(target);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      target.<span class="title function_">setAttribute</span>(<span class="variable constant_">LOADING_NUMB_KEY</span>, <span class="string">`<span class="subst">$&#123;newNumb&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addClass</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">options</span>: <span class="title class_">LoadingOptions</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">parent</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (options.<span class="property">lock</span>) &#123;</span><br><span class="line">    <span class="title function_">addHiddenClass</span>(parent);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">removeHiddenClass</span>(parent);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addRelativeClass</span>(parent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">fullscreenInstance</span>: <span class="title class_">LoadingInstance</span> | <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">LoadingInstance</span> = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> createLoadingComponent&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">Loading</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">LoadingOptions</span> = &#123;&#125;</span>): <span class="title class_">LoadingInstance</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> resolved = <span class="title function_">resolveOptions</span>(options);</span><br><span class="line">  <span class="keyword">const</span> target = resolved.<span class="property">parent</span> ?? <span class="variable language_">document</span>.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (resolved.<span class="property">fullscreen</span> &amp;&amp; !<span class="title function_">isNil</span>(fullscreenInstance)) &#123;</span><br><span class="line">    <span class="keyword">return</span> fullscreenInstance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addLoadingNumb</span>(resolved?.<span class="property">parent</span>);</span><br><span class="line">  <span class="keyword">if</span> (instanceMap.<span class="title function_">has</span>(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> instanceMap.<span class="title function_">get</span>(target)!;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">createLoadingComponent</span>(&#123;</span><br><span class="line">    ...resolved,</span><br><span class="line">    <span class="attr">closed</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolved.<span class="property">closed</span>?.();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (resolved.<span class="property">fullscreen</span>) &#123;</span><br><span class="line">        fullscreenInstance = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addClass</span>(options, resolved?.<span class="property">parent</span>);</span><br><span class="line"></span><br><span class="line">  resolved.<span class="property">parent</span>?.<span class="title function_">appendChild</span>(instance.<span class="property">$el</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> (instance.<span class="property">visible</span>.<span class="property">value</span> = !!resolved.<span class="property">visible</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (resolved.<span class="property">fullscreen</span>) &#123;</span><br><span class="line">    fullscreenInstance = instance;</span><br><span class="line">  &#125;</span><br><span class="line">  instanceMap.<span class="title function_">set</span>(target, instance);</span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-7"><a href="#â”œâ”€-style-css-7" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-loading</span> &#123;</span><br><span class="line">  <span class="attr">--er-loading-icon-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">  <span class="attr">--er-loading-mask-margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attr">--er-loading-mask-size</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attr">--er-loading-icon-size</span>: <span class="number">42px</span>;</span><br><span class="line">  <span class="attr">--er-loading-font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attr">--er-loading-z-index</span>: <span class="number">20000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-loading</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  &amp;<span class="selector-class">.er-loading__mask</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="built_in">var</span>(--er-loading-mask-margin);</span><br><span class="line">    <span class="attribute">top</span>: <span class="built_in">var</span>(--er-loading-mask-margin);</span><br><span class="line">    <span class="attribute">right</span>: <span class="built_in">var</span>(--er-loading-mask-margin);</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="built_in">var</span>(--er-loading-mask-margin);</span><br><span class="line">    <span class="attribute">left</span>: <span class="built_in">var</span>(--er-loading-mask-margin);</span><br><span class="line">    <span class="attribute">height</span>: <span class="built_in">var</span>(--er-loading-mask-size);</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">var</span>(--er-loading-mask-size);</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="built_in">var</span>(--er-loading-z-index);</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--er-loading-bg-color);</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    &amp;<span class="selector-class">.is-fullscreen</span> &#123;</span><br><span class="line">      <span class="attribute">position</span>: fixed;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-loading__spinner</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-loading-icon-color);</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="selector-class">.er-loading-text</span> &#123;</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">3px</span> <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-loading-font-size);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">i</span> &#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-loading-icon-size);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fade-in-linear-enter-from</span>,</span><br><span class="line"><span class="selector-class">.fade-in-linear-leave-to</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-loading-parent--relative</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-loading-parent--hiden</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-8"><a href="#â””â”€-types-ts-8" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">MaybeRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">LoadingOptionsResolved</span> &#123;</span><br><span class="line">  <span class="attr">parent</span>?: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="attr">target</span>?: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="attr">visible</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">  <span class="attr">background</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">  <span class="attr">spinner</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">boolean</span> | <span class="built_in">string</span>&gt;;</span><br><span class="line">  <span class="attr">text</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">  <span class="attr">fullscreen</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">  <span class="attr">lock</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">  beforeClose?(): <span class="built_in">boolean</span>;</span><br><span class="line">  closed?(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">LoadingOptions</span> = <span class="title class_">Partial</span>&lt;</span><br><span class="line">  <span class="title class_">Omit</span>&lt;<span class="title class_">LoadingOptionsResolved</span>, <span class="string">&quot;parent&quot;</span> | <span class="string">&quot;target&quot;</span>&gt; &amp; &#123;</span><br><span class="line">    <span class="attr">target</span>: <span class="title class_">HTMLElement</span> | <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">body</span>: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">zIndex</span>?: <span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">onAfterLeave</span>(): <span class="built_in">void</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&gt;;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Message"><a href="#â”œâ”€-Message" class="headerlink" title="â”œâ”€ Message"></a>â”œâ”€ Message</h3><blockquote><p>é¡¶éƒ¨æ¶ˆæ¯å¼¹å‡ºæ¡†</p></blockquote><h4 id="â€“APIâ€“-8"><a href="#â€“APIâ€“-8" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-index-ts-10"><a href="#â”œâ”€-index-ts-10" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Message</span> <span class="keyword">from</span> <span class="string">&quot;./methods&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstallFunction &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErMessage</span> = <span class="title function_">withInstallFunction</span>(<span class="title class_">Message</span>, <span class="string">&quot;$message&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Message-test-tsx"><a href="#â”œâ”€-Message-test-tsx" class="headerlink" title="â”œâ”€ Message.test.tsx"></a>â”œâ”€ Message.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, test, expect &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; nextTick &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; message, closeAll &#125; <span class="keyword">from</span> <span class="string">&quot;./methods&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">rAF</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">requestAnimationFrame</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="title function_">res</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">nextTick</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTopValue</span>(<span class="params"><span class="attr">element</span>: <span class="title class_">Element</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> styles = <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(element);</span><br><span class="line">  <span class="keyword">const</span> topValue = styles.<span class="title function_">getPropertyValue</span>(<span class="string">&quot;top&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Number</span>.<span class="built_in">parseFloat</span>(topValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;createMessage&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;è°ƒç”¨æ–¹æ³•åº”è¯¥åˆ›å»ºå¯¹åº”çš„ Message ç»„ä»¶&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="title function_">message</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-message&quot;</span>)).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    handler.<span class="title function_">close</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-message&quot;</span>)).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;å¤šæ¬¡è°ƒç”¨åº”è¯¥åˆ›å»ºå¤šä¸ªå®ä¾‹&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="title function_">message</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span> &#125;);</span><br><span class="line">    <span class="title function_">message</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg2&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.er-message&quot;</span>).<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="title function_">closeAll</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.er-message&quot;</span>).<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;åˆ›å»ºå¤šä¸ªå®ä¾‹åº”è¯¥è®¾ç½®æ­£ç¡®çš„ offset&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="title function_">message</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span>, <span class="attr">offset</span>: <span class="number">100</span> &#125;);</span><br><span class="line">    <span class="title function_">message</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg2&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span>, <span class="attr">offset</span>: <span class="number">50</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="keyword">const</span> elements = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.er-message&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(elements.<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// https://github.com/jsdom/jsdom/issues/1590</span></span><br><span class="line">    <span class="comment">// jsdom ä¸­è·å–heightçš„æ•°å€¼éƒ½ä¸º 0</span></span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">getTopValue</span>(elements[<span class="number">0</span>])).<span class="title function_">toBe</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">getTopValue</span>(elements[<span class="number">1</span>])).<span class="title function_">toBe</span>(<span class="number">150</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Message-vue"><a href="#â”œâ”€-Message-vue" class="headerlink" title="â”œâ”€ Message.vue"></a>â”œâ”€ Message.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; MessageProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; computed, onMounted, ref, watch &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; getLastBottomOffset &#125; from &quot;./methods&quot;;</span><br><span class="line">import &#123; delay, bind &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123; useEventListener, useOffset &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; RenderVnode, typeIconMap &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErMessage&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const props = withDefaults(defineProps&lt;MessageProps&gt;(), &#123;</span><br><span class="line">  type: &quot;info&quot;,</span><br><span class="line">  duration: 3000,</span><br><span class="line">  offset: 10,</span><br><span class="line">  transitionName: &quot;fade-up&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const visible = ref(false);</span><br><span class="line">const messageRef = ref&lt;HTMLDivElement&gt;();</span><br><span class="line"></span><br><span class="line">const iconName = computed(() =&gt; typeIconMap.get(props.type) ?? &quot;circle-info&quot;);</span><br><span class="line"></span><br><span class="line">// div çš„é«˜åº¦</span><br><span class="line">const boxHeight = ref(0);</span><br><span class="line"></span><br><span class="line">const &#123; topOffset, bottomOffset &#125; = useOffset(&#123;</span><br><span class="line">  getLastBottomOffset: bind(getLastBottomOffset, props),</span><br><span class="line">  offset: props.offset,</span><br><span class="line">  boxHeight,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const cssStyle = computed(() =&gt; (&#123;</span><br><span class="line">  top: topOffset.value + &quot;px&quot;,</span><br><span class="line">  zIndex: props.zIndex,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">let timer: number;</span><br><span class="line">function startTimmer() &#123;</span><br><span class="line">  if (props.duration === 0) return;</span><br><span class="line">  timer = delay(close, props.duration);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function clearTimer() &#123;</span><br><span class="line">  clearTimeout(timer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function close() &#123;</span><br><span class="line">  visible.value = false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  visible.value = true;</span><br><span class="line">  startTimmer();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">useEventListener(document, &quot;keydown&quot;, (e: Event) =&gt; &#123;</span><br><span class="line">  const &#123; code &#125; = e as KeyboardEvent;</span><br><span class="line">  if (code === &quot;Escape&quot;) &#123;</span><br><span class="line">    close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">watch(visible, (val) =&gt; &#123;</span><br><span class="line">  if (!val) boxHeight.value = -props.offset; // é€€å‡ºåŠ¨ç”»æ›´æµç•…</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">defineExpose(&#123;</span><br><span class="line">  bottomOffset,</span><br><span class="line">  close,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Transition</span><br><span class="line">    :name=&quot;transitionName&quot;</span><br><span class="line">    @enter=&quot;boxHeight = messageRef!.getBoundingClientRect().height&quot;</span><br><span class="line">    @after-leave=&quot;!visible &amp;&amp; onDestory()&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      ref=&quot;messageRef&quot;</span><br><span class="line">      class=&quot;er-message&quot;</span><br><span class="line">      :class=&quot;&#123;</span><br><span class="line">        [`er-message--$&#123;type&#125;`]: type,</span><br><span class="line">        &#x27;is-close&#x27;: showClose,</span><br><span class="line">        &#x27;text-center&#x27;: center,</span><br><span class="line">      &#125;&quot;</span><br><span class="line">      :style=&quot;cssStyle&quot;</span><br><span class="line">      v-show=&quot;visible&quot;</span><br><span class="line">      role=&quot;alert&quot;</span><br><span class="line">      @mouseenter=&quot;clearTimer&quot;</span><br><span class="line">      @mouseleave=&quot;startTimmer&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;er-icon class=&quot;er-message__icon&quot; :icon=&quot;iconName&quot; /&gt;</span><br><span class="line">      &lt;div class=&quot;er-message__content&quot;&gt;</span><br><span class="line">        &lt;slot&gt;</span><br><span class="line">          &lt;render-vnode v-if=&quot;message&quot; :vNode=&quot;message&quot; /&gt;</span><br><span class="line">        &lt;/slot&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;er-message__close&quot; v-if=&quot;showClose&quot;&gt;</span><br><span class="line">        &lt;er-icon icon=&quot;xmark&quot; @click.stop=&quot;close&quot; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/Transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-methods-ts"><a href="#â”œâ”€-methods-ts" class="headerlink" title="â”œâ”€ methods.ts"></a>â”œâ”€ methods.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;</span><br><span class="line">  <span class="title class_">CreateMessageProps</span>,</span><br><span class="line">  <span class="title class_">MessageInstance</span>,</span><br><span class="line">  <span class="title class_">MessageFn</span>,</span><br><span class="line">  <span class="title class_">Message</span>,</span><br><span class="line">  <span class="title class_">MessageParams</span>,</span><br><span class="line">  <span class="title class_">MessageHandler</span>,</span><br><span class="line">  <span class="title class_">MessageProps</span>,</span><br><span class="line">  messageType,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; messageTypes &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render, h, shallowReactive, isVNode &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; findIndex, get, each, set, isString &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useZIndex, useId &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/hooks&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MessageConstructor</span> <span class="keyword">from</span> <span class="string">&quot;./Message.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">instances</span>: <span class="title class_">MessageInstance</span>[] = <span class="title function_">shallowReactive</span>([]);</span><br><span class="line"><span class="keyword">const</span> &#123; nextZIndex &#125; = <span class="title function_">useZIndex</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> messageDefaults = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">  <span class="attr">duration</span>: <span class="number">3000</span>,</span><br><span class="line">  <span class="attr">offset</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">transitionName</span>: <span class="string">&quot;fade-up&quot;</span>,</span><br><span class="line">&#125; <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeOptions</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageParams</span></span>): <span class="title class_">CreateMessageProps</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result =</span><br><span class="line">    !options || <span class="title function_">isVNode</span>(options) || <span class="title function_">isString</span>(options)</span><br><span class="line">      ? &#123;</span><br><span class="line">          <span class="attr">message</span>: options,</span><br><span class="line">        &#125;</span><br><span class="line">      : options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; ...messageDefaults, ...result &#125; <span class="keyword">as</span> <span class="title class_">CreateMessageProps</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createMessage</span>(<span class="params"><span class="attr">props</span>: <span class="title class_">CreateMessageProps</span></span>): <span class="title class_">MessageInstance</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> id = <span class="title function_">useId</span>().<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">destory</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> idx = <span class="title function_">findIndex</span>(instances, &#123; id &#125;);</span><br><span class="line">    <span class="keyword">if</span> (idx === -<span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    instances.<span class="title function_">splice</span>(idx, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="literal">null</span>, container);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> _props = &#123;</span><br><span class="line">    ...props,</span><br><span class="line">    id,</span><br><span class="line">    <span class="attr">zIndex</span>: <span class="title function_">nextZIndex</span>(),</span><br><span class="line">    <span class="attr">onDestory</span>: destory,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> vnode = <span class="title function_">h</span>(<span class="title class_">MessageConstructor</span>, _props);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(vnode, container);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(container.<span class="property">firstElementChild</span>!);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> vm = vnode.<span class="property">component</span>!;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">handler</span>: <span class="title class_">MessageHandler</span> = &#123;</span><br><span class="line">    <span class="attr">close</span>: <span class="function">() =&gt;</span> vm.<span class="property">exposed</span>!.<span class="title function_">close</span>(),</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">instance</span>: <span class="title class_">MessageInstance</span> = &#123;</span><br><span class="line">    <span class="attr">props</span>: _props,</span><br><span class="line">    id,</span><br><span class="line">    vm,</span><br><span class="line">    vnode,</span><br><span class="line">    handler,</span><br><span class="line">  &#125;;</span><br><span class="line">  instances.<span class="title function_">push</span>(instance);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">message</span>: <span class="title class_">MessageFn</span> &amp; <span class="title class_">Partial</span>&lt;<span class="title class_">Message</span>&gt; = <span class="keyword">function</span> (<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> normalized = <span class="title function_">normalizeOptions</span>(options);</span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">createMessage</span>(normalized);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> instance.<span class="property">handler</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getLastBottomOffset</span>(<span class="params"><span class="attr">this</span>: <span class="title class_">MessageProps</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> idx = <span class="title function_">findIndex</span>(instances, &#123; <span class="attr">id</span>: <span class="variable language_">this</span>.<span class="property">id</span> &#125;);</span><br><span class="line">  <span class="keyword">if</span> (idx &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">get</span>(instances, [idx - <span class="number">1</span>, <span class="string">&quot;vm&quot;</span>, <span class="string">&quot;exposed&quot;</span>, <span class="string">&quot;bottomOffset&quot;</span>, <span class="string">&quot;value&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">closeAll</span>(<span class="params"><span class="attr">type</span>?: messageType</span>) &#123;</span><br><span class="line">  <span class="title function_">each</span>(instances, <span class="function">(<span class="params">instance</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">type</span>) &#123;</span><br><span class="line">      instance.<span class="property">props</span>.<span class="property">type</span> === <span class="keyword">type</span> &amp;&amp; instance.<span class="property">handler</span>.<span class="title function_">close</span>();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    instance.<span class="property">handler</span>.<span class="title function_">close</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">each</span>(messageTypes, <span class="function">(<span class="params"><span class="keyword">type</span></span>) =&gt;</span></span><br><span class="line">  <span class="title function_">set</span>(message, <span class="keyword">type</span>, <span class="function">(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageParams</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> normalized = <span class="title function_">normalizeOptions</span>(options);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">message</span>(&#123; ...normalized, <span class="keyword">type</span> &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">message.<span class="property">closeAll</span> = closeAll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> message <span class="keyword">as</span> <span class="title class_">Message</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-8"><a href="#â”œâ”€-style-css-8" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-message</span> &#123;</span><br><span class="line">  <span class="attr">--er-message-bg-color</span>: <span class="built_in">var</span>(--er-color-info-light-<span class="number">9</span>);</span><br><span class="line">  <span class="attr">--er-message-border-color</span>: <span class="built_in">var</span>(--er-border-color-lighter);</span><br><span class="line">  <span class="attr">--er-message-padding</span>: <span class="number">15px</span> <span class="number">19px</span>;</span><br><span class="line">  <span class="attr">--er-message-close-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attr">--er-message-close-icon-color</span>: <span class="built_in">var</span>(--er-text-color-placeholder);</span><br><span class="line">  <span class="attr">--er-message-close-hover-color</span>: <span class="built_in">var</span>(--er-text-color-secondary);</span><br><span class="line">  <span class="attr">--er-message-icon-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attr">--er-message-icon-margin</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-message</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: fit-content;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">32px</span>);</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-border-radius-base);</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="built_in">var</span>(--er-border-width);</span><br><span class="line">  <span class="attribute">border-style</span>: <span class="built_in">var</span>(--er-border-style);</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="built_in">var</span>(--er-message-border-color);</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-message-bg-color);</span><br><span class="line">  <span class="attribute">padding</span>: <span class="built_in">var</span>(--er-message-padding);</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">transition</span>: top <span class="built_in">var</span>(--er-transition-duration), opacity <span class="built_in">var</span>(--er-transition-duration),</span><br><span class="line">    transform <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  <span class="selector-class">.er-message__icon</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-message-text-color);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-message-icon-size);</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">var</span>(--er-message-icon-size);</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="built_in">var</span>(--er-message-icon-margin);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-message__content</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-message-text-color);</span><br><span class="line">    <span class="attribute">overflow-wrap</span>: break-word;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-close</span> <span class="selector-class">.er-message__content</span> &#123;</span><br><span class="line">    <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.text-center</span> &#123;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-message__close</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-message__close</span> <span class="selector-class">.er-icon</span> &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@each</span> $val in info, success, warning, danger &#123;</span><br><span class="line">  <span class="selector-class">.er-message--</span>$(val) &#123;</span><br><span class="line">    <span class="attr">--er-message-bg-color</span>: <span class="built_in">var</span>(--er-color-$(val)-light-<span class="number">9</span>);</span><br><span class="line">    <span class="attr">--er-message-border-color</span>: <span class="built_in">var</span>(--er-color-$(val)-light-<span class="number">8</span>);</span><br><span class="line">    <span class="attr">--er-message-text-color</span>: <span class="built_in">var</span>(--er-color-$(val));</span><br><span class="line">    <span class="selector-class">.er-message__close</span> &#123;</span><br><span class="line">      <span class="attr">--er-icon-color</span>: <span class="built_in">var</span>(--er-color-$(val));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-message--error</span> &#123;</span><br><span class="line">  <span class="attr">--er-message-bg-color</span>: <span class="built_in">var</span>(--er-color-danger-light-<span class="number">9</span>);</span><br><span class="line">  <span class="attr">--er-message-border-color</span>: <span class="built_in">var</span>(--er-color-danger-light-<span class="number">8</span>);</span><br><span class="line">  <span class="attr">--er-message-text-color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">  <span class="selector-class">.er-message__close</span> &#123;</span><br><span class="line">    <span class="attr">--er-icon-color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-message</span><span class="selector-class">.fade-up-enter-from</span>,</span><br><span class="line"><span class="selector-class">.er-message</span><span class="selector-class">.fade-up-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">100%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-9"><a href="#â””â”€-types-ts-9" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">VNode</span>, <span class="title class_">ComponentInternalInstance</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> messageTypes = [</span><br><span class="line">  <span class="string">&quot;info&quot;</span>,</span><br><span class="line">  <span class="string">&quot;success&quot;</span>,</span><br><span class="line">  <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">  <span class="string">&quot;danger&quot;</span>,</span><br><span class="line">  <span class="string">&quot;error&quot;</span>,</span><br><span class="line">] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> messageType = (<span class="keyword">typeof</span> messageTypes)[<span class="built_in">number</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageHandler</span> &#123;</span><br><span class="line">  <span class="title function_">close</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageFn</span> = &#123;</span><br><span class="line">  (<span class="attr">props</span>: <span class="title class_">MessageParams</span>): <span class="title class_">MessageHandler</span>;</span><br><span class="line">  <span class="title function_">closeAll</span>(<span class="attr">type</span>?: messageType): <span class="built_in">void</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageTypeFn</span> = <span class="function">(<span class="params"><span class="attr">props</span>: <span class="title class_">MessageParams</span></span>) =&gt;</span> <span class="title class_">MessageHandler</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Message</span> <span class="keyword">extends</span> <span class="title class_">MessageFn</span> &#123;</span><br><span class="line">  <span class="attr">success</span>: <span class="title class_">MessageTypeFn</span>;</span><br><span class="line">  <span class="attr">warning</span>: <span class="title class_">MessageTypeFn</span>;</span><br><span class="line">  <span class="attr">info</span>: <span class="title class_">MessageTypeFn</span>;</span><br><span class="line">  <span class="attr">danger</span>: <span class="title class_">MessageTypeFn</span>;</span><br><span class="line">  <span class="attr">error</span>: <span class="title class_">MessageTypeFn</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageProps</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">message</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span> | (<span class="function">() =&gt;</span> <span class="title class_">VNode</span>);</span><br><span class="line">  <span class="attr">duration</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">showClose</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">center</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">type</span>?: messageType;</span><br><span class="line">  <span class="attr">offset</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">zIndex</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">transitionName</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">onDestory</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageOptions</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">Omit</span>&lt;<span class="title class_">MessageProps</span>, <span class="string">&quot;id&quot;</span>&gt;&gt;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageParams</span> = <span class="built_in">string</span> | <span class="title class_">VNode</span> | <span class="title class_">MessageOptions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageInstance</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">vnode</span>: <span class="title class_">VNode</span>;</span><br><span class="line">  <span class="attr">props</span>: <span class="title class_">MessageProps</span>;</span><br><span class="line">  <span class="attr">vm</span>: <span class="title class_">ComponentInternalInstance</span>;</span><br><span class="line">  <span class="attr">handler</span>: <span class="title class_">MessageHandler</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CreateMessageProps</span> = <span class="title class_">Omit</span>&lt;</span><br><span class="line">  <span class="title class_">MessageProps</span>,</span><br><span class="line">  <span class="string">&quot;onDestory&quot;</span> | <span class="string">&quot;id&quot;</span> | <span class="string">&quot;zIndex&quot;</span></span><br><span class="line">&gt;;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-MessageBox"><a href="#â”œâ”€-MessageBox" class="headerlink" title="â”œâ”€ MessageBox"></a>â”œâ”€ MessageBox</h3><blockquote><p>ä¸­å¿ƒå¼¹å‡ºæ¡†</p></blockquote><h4 id="â€“APIâ€“-9"><a href="#â€“APIâ€“-9" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-index-ts-11"><a href="#â”œâ”€-index-ts-11" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">MessageBox</span> <span class="keyword">from</span> <span class="string">&quot;./methods&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; set &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErMessageBox</span> = <span class="title class_">MessageBox</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">set</span>(<span class="title class_">ErMessageBox</span>, <span class="string">&quot;install&quot;</span>, <span class="function">(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt;</span> &#123;</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$msgbox</span> = <span class="title class_">MessageBox</span>;</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$messageBox</span> = <span class="title class_">MessageBox</span>;</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$alert</span> = <span class="title class_">MessageBox</span>.<span class="property">alert</span>;</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$confirm</span> = <span class="title class_">MessageBox</span>.<span class="property">confirm</span>;</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$prompt</span> = <span class="title class_">MessageBox</span>.<span class="property">prompt</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ErMessageBox</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-MessageBox-test-tsx"><a href="#â”œâ”€-MessageBox-test-tsx" class="headerlink" title="â”œâ”€ MessageBox.test.tsx"></a>â”œâ”€ MessageBox.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, expect, vi &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; nextTick &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">MessageBoxType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MessageBox</span> <span class="keyword">from</span> <span class="string">&quot;./methods&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">rAF</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">requestAnimationFrame</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="title function_">res</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">nextTick</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;MessageBox Component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;renders correctly&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> props = &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Test Title&quot;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;Test Message&quot;</span>,</span><br><span class="line">      <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">closeOnClickModal</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">confirmButtonText</span>: <span class="string">&quot;Confirm&quot;</span>,</span><br><span class="line">      <span class="attr">cancelButtonText</span>: <span class="string">&quot;Cancel&quot;</span>,</span><br><span class="line">      <span class="attr">showConfirmButton</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">MessageBox</span>(props);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="keyword">const</span> header = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-message-box__header&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> title = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-message-box__title&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> message = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-message-box__message&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(title).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(header).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(message).<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title class_">MessageBox</span>.<span class="title function_">close</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;closes on close button click&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> props = &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Test Title&quot;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;Test Message&quot;</span>,</span><br><span class="line">      <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> doAction = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="title class_">MessageBox</span>(props).<span class="title function_">catch</span>(<span class="function">(<span class="params">action</span>) =&gt;</span> <span class="title function_">doAction</span>(action));</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> closeBtn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span><br><span class="line">      <span class="string">&quot;.er-message-box__header-btn&quot;</span></span><br><span class="line">    ) <span class="keyword">as</span> <span class="title class_">HTMLButtonElement</span>;</span><br><span class="line">    closeBtn.<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(doAction).<span class="title function_">toHaveBeenCalledWith</span>(<span class="string">&quot;close&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;triggers confirm action on confirm button click&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> props = &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Test Title&quot;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;Test Message&quot;</span>,</span><br><span class="line">      <span class="attr">showConfirmButton</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">showCancelButton</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> doAction = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="title class_">MessageBox</span>(props)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">action</span>) =&gt;</span> <span class="title function_">doAction</span>(action))</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmBtn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span><br><span class="line">      <span class="string">&quot;.er-message-box__footer-btn&quot;</span></span><br><span class="line">    ) <span class="keyword">as</span> <span class="title class_">HTMLButtonElement</span>;</span><br><span class="line">    confirmBtn.<span class="title function_">click</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(doAction).<span class="title function_">toBeCalledWith</span>(<span class="string">&#x27;confirm&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;triggers cancel action on cancel button click&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> props = &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Test Title&quot;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;Test Message&quot;</span>,</span><br><span class="line">      <span class="attr">showConfirmButton</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">showCancelButton</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> doAction = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="title class_">MessageBox</span>(props).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title function_">doAction</span>(err));</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cancelBtn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span><br><span class="line">      <span class="string">&quot;.er-message-box__cancel-btn&quot;</span></span><br><span class="line">    ) <span class="keyword">as</span> <span class="title class_">HTMLButtonElement</span>;</span><br><span class="line">    cancelBtn.<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(doAction).<span class="title function_">toHaveBeenCalledWith</span>(<span class="string">&quot;cancel&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;handles input in prompt mode&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> props = &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Test Title&quot;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;Test Message&quot;</span>,</span><br><span class="line">      <span class="attr">boxType</span>: <span class="string">&quot;prompt&quot;</span> <span class="keyword">as</span> <span class="title class_">MessageBoxType</span>,</span><br><span class="line">      <span class="attr">showInput</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> doAction = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="title class_">MessageBox</span>(props).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="title function_">doAction</span>(res));</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;input&quot;</span>) <span class="keyword">as</span> <span class="title class_">HTMLInputElement</span>;</span><br><span class="line">    input.<span class="property">value</span> = <span class="string">&quot;Test Input&quot;</span>;</span><br><span class="line">    input.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&quot;input&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmBtn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span><br><span class="line">      <span class="string">&quot;.er-message-box__confirm-btn&quot;</span></span><br><span class="line">    ) <span class="keyword">as</span> <span class="title class_">HTMLButtonElement</span>;</span><br><span class="line">    confirmBtn.<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(doAction).<span class="title function_">toHaveBeenCalledWith</span>(&#123;</span><br><span class="line">      <span class="attr">value</span>: <span class="string">&quot;Test Input&quot;</span>,</span><br><span class="line">      <span class="attr">action</span>: <span class="string">&quot;confirm&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-MessageBox-vue"><a href="#â”œâ”€-MessageBox-vue" class="headerlink" title="â”œâ”€ MessageBox.vue"></a>â”œâ”€ MessageBox.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, reactive, computed, watch, nextTick, type Ref &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; isFunction, isNil &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import type &#123; MessageBoxProps, MessageBoxAction &#125; from &quot;./types&quot;;</span><br><span class="line">import type &#123; InputInstance &#125; from &quot;../Input/types&quot;;</span><br><span class="line"></span><br><span class="line">import ErOverlay from &quot;../Overlay/Overlay.vue&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line">import ErButton from &quot;../Button/Button.vue&quot;;</span><br><span class="line">import ErInput from &quot;../Input/Input.vue&quot;;</span><br><span class="line"></span><br><span class="line">import &#123; useId, useZIndex &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; typeIconMap &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123; name: &quot;ErMessageBox&quot;, inheritAttrs: false &#125;);</span><br><span class="line"></span><br><span class="line">const props = withDefaults(defineProps&lt;MessageBoxProps&gt;(), &#123;</span><br><span class="line">  lockScroll: true,</span><br><span class="line">  showClose: true,</span><br><span class="line">  closeOnClickModal: true,</span><br><span class="line">  confirmButtonType: &quot;primary&quot;,</span><br><span class="line">  roundButton: false,</span><br><span class="line">  boxType: &quot;&quot;,</span><br><span class="line">  inputValue: &quot;&quot;,</span><br><span class="line">  inputPlaceholder:&#x27;Please input...&#x27;,</span><br><span class="line">  confirmButtonText: &quot;Ok&quot;,</span><br><span class="line">  cancelButtonText: &quot;Cancel&quot;,</span><br><span class="line">  showConfirmButton: true,</span><br><span class="line">&#125;);</span><br><span class="line">const &#123; doAction &#125; = props;</span><br><span class="line"></span><br><span class="line">const headerRef = ref&lt;HTMLElement&gt;();</span><br><span class="line">const inputRef = ref&lt;InputInstance&gt;();</span><br><span class="line"></span><br><span class="line">const inputId = useId();</span><br><span class="line">const &#123; nextZIndex &#125; = useZIndex();</span><br><span class="line"></span><br><span class="line">const state = reactive(&#123;</span><br><span class="line">  ...props,</span><br><span class="line">  zIndex: nextZIndex(),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const hasMessage = computed(() =&gt; !!state.message);</span><br><span class="line">const iconComponent = computed(</span><br><span class="line">  () =&gt; state.icon ?? typeIconMap.get(state.type ?? &quot;&quot;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.visible?.value,</span><br><span class="line">  (val) =&gt; &#123;</span><br><span class="line">    if (val) state.zIndex = nextZIndex();</span><br><span class="line"></span><br><span class="line">    if (props.boxType !== &quot;prompt&quot;) return;</span><br><span class="line"></span><br><span class="line">    if (!val) return;</span><br><span class="line"></span><br><span class="line">    nextTick(() =&gt; &#123;</span><br><span class="line">      inputRef.value &amp;&amp; inputRef.value.focus();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">function handleWrapperClick() &#123;</span><br><span class="line">  props.closeOnClickModal &amp;&amp; handleAction(&quot;close&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleInputEnter(e: KeyboardEvent) &#123;</span><br><span class="line">  if (state.inputType === &quot;textarea&quot;) return;</span><br><span class="line">  e.preventDefault();</span><br><span class="line">  return handleAction(&quot;confirm&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleAction(action: MessageBoxAction) &#123;</span><br><span class="line">  isFunction(props.beforeClose)</span><br><span class="line">    ? props.beforeClose(action, state, () =&gt; doAction(action, state.inputValue))</span><br><span class="line">    : doAction(action, state.inputValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleClose() &#123;</span><br><span class="line">  handleAction(&quot;close&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition name=&quot;fade-in-linear&quot; @after-leave=&quot;destroy&quot;&gt;</span><br><span class="line">    &lt;er-overlay v-show=&quot;(visible as Ref).value&quot; :z-index=&quot;state.zIndex&quot; mask&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        role=&quot;dialog&quot;</span><br><span class="line">        class=&quot;er-overlay-message-box&quot;</span><br><span class="line">        @click=&quot;handleWrapperClick&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          ref=&quot;rootRef&quot;</span><br><span class="line">          :class=&quot;[</span><br><span class="line">            &#x27;er-message-box&#x27;,</span><br><span class="line">            &#123;</span><br><span class="line">              &#x27;is-center&#x27;: state.center,</span><br><span class="line">            &#125;,</span><br><span class="line">          ]&quot;</span><br><span class="line">          @click.stop</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;div</span><br><span class="line">            v-if=&quot;!isNil(state.title)&quot;</span><br><span class="line">            ref=&quot;headerRef&quot;</span><br><span class="line">            class=&quot;er-message-box__header&quot;</span><br><span class="line">            :class=&quot;&#123; &#x27;show-close&#x27;: state.showClose &#125;&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;div class=&quot;er-message-box__title&quot;&gt;</span><br><span class="line">              &lt;er-icon</span><br><span class="line">                v-if=&quot;iconComponent &amp;&amp; state.center&quot;</span><br><span class="line">                :class=&quot;&#123;</span><br><span class="line">                  [`er-icon-$&#123;state.type&#125;`]: state.type,</span><br><span class="line">                &#125;&quot;</span><br><span class="line">                :icon=&quot;iconComponent&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">              &#123;&#123; state.title &#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;button</span><br><span class="line">              v-if=&quot;showClose&quot;</span><br><span class="line">              class=&quot;er-message-box__header-btn&quot;</span><br><span class="line">              @click.stop=&quot;handleClose&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;er-icon icon=&quot;xmark&quot; /&gt;</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class=&quot;er-message-box__content&quot;&gt;</span><br><span class="line">            &lt;er-icon</span><br><span class="line">              v-if=&quot;iconComponent &amp;&amp; !state.center &amp;&amp; hasMessage&quot;</span><br><span class="line">              :class=&quot;&#123;</span><br><span class="line">                [`er-icon-$&#123;state.type&#125;`]: state.type,</span><br><span class="line">              &#125;&quot;</span><br><span class="line">              :icon=&quot;iconComponent&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;div v-if=&quot;hasMessage&quot; class=&quot;er-message-box__message&quot;&gt;</span><br><span class="line">              &lt;slot&gt;</span><br><span class="line">                &lt;component</span><br><span class="line">                  :is=&quot;state.showInput ? &#x27;label&#x27; : &#x27;p&#x27;&quot;</span><br><span class="line">                  :for=&quot;state.showInput ? inputId : void 0&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                  &#123;&#123; state.message &#125;&#125;</span><br><span class="line">                &lt;/component&gt;</span><br><span class="line">              &lt;/slot&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div v-show=&quot;state.showInput&quot; class=&quot;er-message-box__input&quot;&gt;</span><br><span class="line">            &lt;er-input</span><br><span class="line">              v-model=&quot;state.inputValue&quot;</span><br><span class="line">              ref=&quot;inputRef&quot;</span><br><span class="line">              :placeholder=&quot;state.inputPlaceholder&quot;</span><br><span class="line">              :type=&quot;state.inputType&quot;</span><br><span class="line">              @keyup.enter=&quot;handleInputEnter&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class=&quot;er-message-box__footer&quot;&gt;</span><br><span class="line">            &lt;er-button</span><br><span class="line">              v-if=&quot;state.showCancelButton&quot;</span><br><span class="line">              class=&quot;er-message-box__footer-btn er-message-box__cancel-btn&quot;</span><br><span class="line">              :type=&quot;state.cancelButtonType&quot;</span><br><span class="line">              :round=&quot;state.roundButton&quot;</span><br><span class="line">              :loading=&quot;state.cancelButtonLoading&quot;</span><br><span class="line">              @click=&quot;handleAction(&#x27;cancel&#x27;)&quot;</span><br><span class="line">              @keydown.prevent.enter=&quot;handleAction(&#x27;cancel&#x27;)&quot;</span><br><span class="line">              &gt;&#123;&#123; state.cancelButtonText &#125;&#125;&lt;/er-button</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;er-button</span><br><span class="line">              v-show=&quot;state.showConfirmButton&quot;</span><br><span class="line">              class=&quot;er-message-box__footer-btn er-message-box__confirm-btn&quot;</span><br><span class="line">              :type=&quot;state.confirmButtonType ?? &#x27;primary&#x27;&quot;</span><br><span class="line">              :round=&quot;state.roundButton&quot;</span><br><span class="line">              :loading=&quot;state.confirmButtonLoading&quot;</span><br><span class="line">              @click=&quot;handleAction(&#x27;confirm&#x27;)&quot;</span><br><span class="line">              @keydown.prevent.enter=&quot;handleAction(&#x27;confirm&#x27;)&quot;</span><br><span class="line">              &gt;&#123;&#123; state.confirmButtonText &#125;&#125;&lt;/er-button</span><br><span class="line">            &gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/er-overlay&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-methods-ts-1"><a href="#â”œâ”€-methods-ts-1" class="headerlink" title="â”œâ”€ methods.ts"></a>â”œâ”€ methods.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  createVNode,</span><br><span class="line">  isVNode,</span><br><span class="line">  ref,</span><br><span class="line">  render,</span><br><span class="line">  nextTick,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">ComponentPublicInstance</span>,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">VNode</span>,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">VNodeProps</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;</span><br><span class="line">  <span class="title class_">MessageBoxAction</span>,</span><br><span class="line">  <span class="title class_">MessageBoxOptions</span>,</span><br><span class="line">  <span class="title class_">MessageBoxData</span>,</span><br><span class="line">  <span class="title class_">MessageBoxCallback</span>,</span><br><span class="line">  <span class="title class_">MessageBoxProps</span>,</span><br><span class="line">  <span class="title class_">IErMessageBox</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MessageBoxConstructor</span> <span class="keyword">from</span> <span class="string">&quot;./MessageBox.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  assign,</span><br><span class="line">  each,</span><br><span class="line">  isFunction,</span><br><span class="line">  isObject,</span><br><span class="line">  isString,</span><br><span class="line">  isUndefined,</span><br><span class="line">  set,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> messageInstanceMap = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;</span><br><span class="line">  <span class="title class_">ComponentPublicInstance</span>&lt;&#123; <span class="attr">doClose</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125;&gt;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span>;</span><br><span class="line">    <span class="attr">callback</span>: <span class="title class_">MessageBoxCallback</span> | <span class="built_in">void</span>;</span><br><span class="line">    <span class="attr">resolve</span>: <span class="function">(<span class="params"><span class="attr">res</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">    <span class="attr">reject</span>: <span class="function">(<span class="params"><span class="attr">res</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initInstance</span>(<span class="params"><span class="attr">props</span>: <span class="title class_">MessageBoxProps</span>, <span class="attr">container</span>: <span class="title class_">HTMLElement</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> isVNodeMsg = <span class="title function_">isFunction</span>(props?.<span class="property">message</span>) || <span class="title function_">isVNode</span>(props?.<span class="property">message</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">genDefaultSlot</span> = (<span class="params"><span class="attr">message</span>: <span class="title class_">VNode</span> | (() =&gt; VNode)</span>) =&gt;</span><br><span class="line">    <span class="title function_">isFunction</span>(message) ? message : <span class="function">() =&gt;</span> message;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> vnode = <span class="title function_">createVNode</span>(</span><br><span class="line">    <span class="title class_">MessageBoxConstructor</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      ...props,</span><br><span class="line">      visible,</span><br><span class="line">    &#125; <span class="keyword">as</span> <span class="title class_">VNodeProps</span>,</span><br><span class="line">    isVNodeMsg ? &#123; <span class="attr">default</span>: <span class="title function_">genDefaultSlot</span>(props.<span class="property">message</span> <span class="keyword">as</span> <span class="title class_">VNode</span>) &#125; : <span class="built_in">void</span> <span class="number">0</span></span><br><span class="line">  );</span><br><span class="line">  <span class="title function_">render</span>(vnode, container);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(container.<span class="property">firstElementChild</span>!);</span><br><span class="line">  <span class="keyword">return</span> vnode.<span class="property">component</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">genContainer</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showMessage</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> container = <span class="title function_">genContainer</span>();</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">props</span>: <span class="title class_">MessageBoxProps</span> = &#123;</span><br><span class="line">    ...options,</span><br><span class="line">    <span class="attr">doClose</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      vm.<span class="property">visible</span>.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">doAction</span>: <span class="function">(<span class="params"><span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>, <span class="attr">inputVal</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> currentMsg = messageInstanceMap.<span class="title function_">get</span>(vm);</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">resolve</span>:</span><br><span class="line">        | <span class="title class_">MessageBoxAction</span></span><br><span class="line">        | &#123; <span class="attr">value</span>: <span class="built_in">string</span>; <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> vm.<span class="title function_">doClose</span>());</span><br><span class="line">      <span class="keyword">if</span> (options.<span class="property">showInput</span>) &#123;</span><br><span class="line">        resolve = &#123; <span class="attr">value</span>: inputVal, <span class="attr">action</span>: action &#125;;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resolve = action;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (options.<span class="property">callback</span>) &#123;</span><br><span class="line">        options.<span class="title function_">callback</span>(resolve);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (action === <span class="string">&quot;cancel&quot;</span> || action === <span class="string">&quot;close&quot;</span>) &#123;</span><br><span class="line">        currentMsg?.<span class="title function_">reject</span>(action);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      currentMsg?.<span class="title function_">resolve</span>(resolve);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">destroy</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">render</span>(<span class="literal">null</span>, container);</span><br><span class="line">      messageInstanceMap.<span class="title function_">delete</span>(vm);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">initInstance</span>(props <span class="keyword">as</span> <span class="title class_">MessageBoxProps</span>, container);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> vm = instance?.<span class="property">proxy</span> <span class="keyword">as</span> <span class="title class_">ComponentPublicInstance</span>&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line"></span><br><span class="line">  vm.<span class="property">visible</span>.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> vm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">MessageBox</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span></span>): <span class="title class_">Promise</span>&lt;<span class="title class_">MessageBoxData</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MessageBox</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span> | <span class="built_in">string</span> | <span class="title class_">VNode</span></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">callback</span>: <span class="title class_">MessageBoxCallback</span> | <span class="built_in">void</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isString</span>(options) || <span class="title function_">isVNode</span>(options)) &#123;</span><br><span class="line">    options = &#123;</span><br><span class="line">      <span class="attr">message</span>: options,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    callback = options.<span class="property">callback</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="title function_">showMessage</span>(options);</span><br><span class="line">    messageInstanceMap.<span class="title function_">set</span>(vm, &#123; options, callback, resolve, reject &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MESSAGE_BOX_VARIANTS</span> = [<span class="string">&quot;alert&quot;</span>, <span class="string">&quot;confirm&quot;</span>, <span class="string">&quot;prompt&quot;</span>] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">MESSAGE_BOX_DEFAULT_OPTS</span>: <span class="title class_">Record</span>&lt;</span><br><span class="line">  (<span class="keyword">typeof</span> <span class="variable constant_">MESSAGE_BOX_VARIANTS</span>)[<span class="built_in">number</span>],</span><br><span class="line">  <span class="title class_">Partial</span>&lt;<span class="title class_">MessageBoxOptions</span>&gt;</span><br><span class="line">&gt; = &#123;</span><br><span class="line">  <span class="attr">alert</span>: &#123; <span class="attr">closeOnClickModal</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  <span class="attr">confirm</span>: &#123; <span class="attr">showCancelButton</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  <span class="attr">prompt</span>: &#123; <span class="attr">showCancelButton</span>: <span class="literal">true</span>, <span class="attr">showInput</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">each</span>(<span class="variable constant_">MESSAGE_BOX_VARIANTS</span>, <span class="function">(<span class="params"><span class="keyword">type</span></span>) =&gt;</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="title class_">MessageBox</span>, <span class="keyword">type</span>, <span class="title function_">messageBoxFactory</span>(<span class="keyword">type</span>))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">messageBoxFactory</span>(<span class="params"><span class="attr">boxType</span>: (<span class="keyword">typeof</span> MESSAGE_BOX_VARIANTS)[<span class="built_in">number</span>]</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">message</span>: <span class="built_in">string</span> | <span class="title class_">VNode</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">title</span>: <span class="built_in">string</span> | <span class="title class_">MessageBoxOptions</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span></span></span></span><br><span class="line"><span class="params"><span class="function">  </span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> titleOrOpts = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isObject</span>(title)) &#123;</span><br><span class="line">      options = title <span class="keyword">as</span> <span class="title class_">MessageBoxOptions</span>;</span><br><span class="line">      titleOrOpts = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isUndefined</span>(title)) &#123;</span><br><span class="line">      titleOrOpts = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      titleOrOpts = title <span class="keyword">as</span> <span class="built_in">string</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">MessageBox</span>(</span><br><span class="line">      <span class="title function_">assign</span>(</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">title</span>: titleOrOpts,</span><br><span class="line">          message,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          boxType,</span><br><span class="line">          ...<span class="variable constant_">MESSAGE_BOX_DEFAULT_OPTS</span>[boxType],</span><br><span class="line">        &#125;,</span><br><span class="line">        options</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">set</span>(<span class="title class_">MessageBox</span>, <span class="string">&quot;close&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  messageInstanceMap.<span class="title function_">forEach</span>(<span class="function">(<span class="params">_, vm</span>) =&gt;</span> &#123;</span><br><span class="line">    vm.<span class="title function_">doClose</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  messageInstanceMap.<span class="title function_">clear</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MessageBox</span> <span class="keyword">as</span> <span class="title class_">IErMessageBox</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-9"><a href="#â”œâ”€-style-css-9" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-message-box</span> &#123;</span><br><span class="line">  <span class="attr">--er-message-box-title-color</span>: <span class="built_in">var</span>(--er-text-color-primary);</span><br><span class="line">  <span class="attr">--er-message-box-width</span>: <span class="number">420px</span>;</span><br><span class="line">  <span class="attr">--er-message-box-border-radius</span>: <span class="built_in">var</span>(--er-border-radius-base);</span><br><span class="line">  <span class="attr">--er-message-box-font-size</span>: <span class="built_in">var</span>(--er-font-size-large);</span><br><span class="line">  <span class="attr">--er-message-box-content-font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">  <span class="attr">--er-message-box-content-color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">  <span class="attr">--er-message-box-padding-primary</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attr">--er-message-box-font-line-height</span>: <span class="built_in">var</span>(--er-font-size-medium);</span><br><span class="line">  <span class="attr">--er-message-box-close-size</span>: <span class="built_in">var</span>(--er-message-close-size, <span class="number">16px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-overlay-message-box</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: auto;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-message-box</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">position</span>: relative; </span><br><span class="line">  <span class="attribute">max-width</span>: <span class="built_in">var</span>(--er-message-box-width);</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="built_in">var</span>(--er-message-box-padding-primary);</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-bg-color);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-message-box-border-radius);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-message-box-font-size);</span><br><span class="line">  <span class="attribute">text-align</span>: left;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">backface-visibility</span>: hidden;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">overflow-wrap</span>: break-word;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">    <span class="attribute">outline</span>: none <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;<span class="selector-class">.is-center</span> &#123;</span><br><span class="line">    <span class="selector-class">.er-message-box__title</span> &#123;</span><br><span class="line">      <span class="attribute">display</span>: flex;</span><br><span class="line">      <span class="attribute">align-items</span>: center;</span><br><span class="line">      <span class="attribute">justify-content</span>: center;</span><br><span class="line">      <span class="attribute">gap</span>: <span class="number">6px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.er-message-box__footer</span>,<span class="selector-class">.er-message-box__content</span> &#123;</span><br><span class="line">      <span class="attribute">justify-content</span>: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  :<span class="built_in">deep</span>(.er-icon)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">@each</span> $val in info, success, warning, danger &#123;</span><br><span class="line">      &amp;<span class="selector-class">.er-icon-</span>$(val) &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-$(val))<span class="meta">!important</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.er-icon-error</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-danger)<span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-message-box__header</span> &#123;</span><br><span class="line">    <span class="attribute">padding-bottom</span>: <span class="built_in">var</span>(--er-message-box-padding-primary);</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.er-message-box__title</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-message-box-title-color);</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-message-box-font-size);</span><br><span class="line">      <span class="attribute">line-height</span>: <span class="built_in">var</span>(--er-message-box-font-line-height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.er-message-box__header-btn</span> &#123;</span><br><span class="line">      <span class="attribute">position</span>: absolute;</span><br><span class="line">      <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">border</span>: none;</span><br><span class="line">      <span class="attribute">outline</span>: none;</span><br><span class="line">      <span class="attribute">background</span>: transparent;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-message-box-close-size);</span><br><span class="line">      <span class="attribute">cursor</span>: pointer;</span><br><span class="line"></span><br><span class="line">      <span class="selector-tag">i</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-info);</span><br><span class="line">        <span class="attribute">font-size</span>: inherit; </span><br><span class="line">      &#125;</span><br><span class="line">      &amp;<span class="selector-pseudo">:focus</span>,</span><br><span class="line">      &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">        <span class="selector-tag">i</span> &#123;</span><br><span class="line">          <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-class">.show-close</span> &#123;</span><br><span class="line">      <span class="attribute">padding-right</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--er-message-box-padding-primary) + <span class="built_in">var</span>(--er-message-box-close-size));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-message-box__content</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-message-box-content-font-size);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-message-box-content-color);</span><br><span class="line">    <span class="selector-class">.er-message-box__message</span> &#123;</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">      &amp; <span class="selector-tag">p</span> &#123;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">line-height</span>: <span class="built_in">var</span>(--er-message-box-font-line-height);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-message-box__input</span> &#123;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">12px</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-message-box__footer</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">    <span class="attribute">justify-content</span>: flex-end;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="built_in">var</span>(--er-message-box-padding-primary);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.fade-in-linear-enter-active</span> &#123;</span><br><span class="line">  <span class="selector-class">.er-overlay-message-box</span> &#123;</span><br><span class="line">    <span class="attribute">animation</span>: msgbox-fade-in <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.fade-in-linear-leave-active</span> &#123;</span><br><span class="line">  <span class="selector-class">.er-overlay-message-box</span> &#123;</span><br><span class="line">    <span class="attribute">animation</span>: msgbox-fade-in <span class="built_in">var</span>(--er-transition-duration) reverse;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> msgbox-fade-in &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, -<span class="number">20px</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-10"><a href="#â””â”€-types-ts-10" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Ref</span>, <span class="keyword">type</span> <span class="title class_">VNode</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> messageType &#125; <span class="keyword">from</span> <span class="string">&quot;../Message/types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">ButtonType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../Button/types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxAction</span> = <span class="string">&quot;confirm&quot;</span> | <span class="string">&quot;cancel&quot;</span> | <span class="string">&quot;close&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxType</span> = <span class="string">&quot;&quot;</span> | <span class="string">&quot;prompt&quot;</span> | <span class="string">&quot;alert&quot;</span> | <span class="string">&quot;confirm&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxCallback</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span> | &#123; value: <span class="built_in">string</span>; action: MessageBoxAction &#125;</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxInputData</span> = &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxData</span> = <span class="title class_">MessageBoxInputData</span> &amp; <span class="title class_">MessageBoxAction</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageBoxOptions</span> &#123;</span><br><span class="line">  <span class="attr">title</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">message</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span> | (<span class="function">() =&gt;</span> <span class="title class_">VNode</span>);</span><br><span class="line">  <span class="attr">type</span>?: messageType;</span><br><span class="line">  <span class="attr">boxType</span>?: <span class="title class_">MessageBoxType</span>;</span><br><span class="line">  <span class="attr">icon</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">callback</span>?: <span class="title class_">MessageBoxCallback</span>;</span><br><span class="line">  <span class="attr">showClose</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">showInput</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">showCancelButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">showConfirmButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">cancelButtonText</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">confirmButtonText</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">cancelButtonLoading</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">confirmButtonLoading</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">cancelButtonDisabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">confirmButtonDisabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">cancelButtonType</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">  <span class="attr">confirmButtonType</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">  <span class="attr">roundButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">center</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">lockScroll</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">closeOnClickModal</span>?: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">inputPlaceholder</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">inputValue</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">inputType</span>?: <span class="string">&quot;text&quot;</span> | <span class="string">&quot;textarea&quot;</span> | <span class="string">&quot;password&quot;</span> | <span class="string">&quot;number&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">buttonSize</span>?: <span class="string">&quot;default&quot;</span> | <span class="string">&quot;small&quot;</span> | <span class="string">&quot;large&quot;</span>;</span><br><span class="line">  <span class="attr">beforeClose</span>?: <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">instance</span>: <span class="title class_">MessageBoxOptions</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">done</span>: () =&gt; <span class="built_in">void</span></span></span></span><br><span class="line"><span class="params"><span class="function">  </span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageBoxProps</span> <span class="keyword">extends</span> <span class="title class_">MessageBoxOptions</span> &#123;</span><br><span class="line">  <span class="attr">visible</span>?: <span class="title class_">Ref</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">  <span class="title function_">doClose</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">doAction</span>(<span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>, <span class="attr">inputVal</span>?: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">destroy</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxShortcutMethod</span> = (<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">message</span>: <span class="title class_">MessageBoxOptions</span>[<span class="string">&quot;message&quot;</span>],</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">title</span>: <span class="title class_">MessageBoxOptions</span>[<span class="string">&quot;title&quot;</span>],</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">options</span>?: <span class="title class_">MessageBoxOptions</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="title class_">MessageBoxData</span>&gt;) &amp;</span><br><span class="line">  (<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">message</span>: <span class="title class_">MessageBoxOptions</span>[<span class="string">&quot;message&quot;</span>],</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">options</span>?: <span class="title class_">MessageBoxOptions</span></span></span></span><br><span class="line"><span class="params"><span class="function">  </span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="title class_">MessageBoxData</span>&gt;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IErMessageBox</span> &#123;</span><br><span class="line">  (<span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span> | <span class="built_in">string</span> | <span class="title class_">VNode</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="attr">alert</span>: <span class="title class_">MessageBoxShortcutMethod</span>;</span><br><span class="line">  <span class="attr">confirm</span>: <span class="title class_">MessageBoxShortcutMethod</span>;</span><br><span class="line">  <span class="attr">prompt</span>: <span class="title class_">MessageBoxShortcutMethod</span>;</span><br><span class="line">  <span class="title function_">close</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Notification"><a href="#â”œâ”€-Notification" class="headerlink" title="â”œâ”€ Notification"></a>â”œâ”€ Notification</h3><blockquote><p>è§’è½å¼¹å‡ºé€šçŸ¥æ¡†</p></blockquote><h4 id="â€“APIâ€“-10"><a href="#â€“APIâ€“-10" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-index-ts-12"><a href="#â”œâ”€-index-ts-12" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Notification</span> <span class="keyword">from</span> <span class="string">&quot;./methods&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstallFunction &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErNotification</span> = <span class="title function_">withInstallFunction</span>(</span><br><span class="line">  <span class="title class_">Notification</span>,</span><br><span class="line">  <span class="string">&quot;$notify&quot;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-methods-ts-2"><a href="#â”œâ”€-methods-ts-2" class="headerlink" title="â”œâ”€ methods.ts"></a>â”œâ”€ methods.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;</span><br><span class="line">  <span class="title class_">CreateNotificationProps</span>,</span><br><span class="line">  <span class="title class_">NotificationInstance</span>,</span><br><span class="line">  <span class="title class_">NotificationFn</span>,</span><br><span class="line">  <span class="title class_">Notification</span>,</span><br><span class="line">  <span class="title class_">NotificationParams</span>,</span><br><span class="line">  <span class="title class_">NotificationHandler</span>,</span><br><span class="line">  <span class="title class_">NotificationProps</span>,</span><br><span class="line">  notificationType,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; notificationTypes, notificationPosition &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; shallowReactive, isVNode, render, h &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; each, findIndex, isString, set, get &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useZIndex, useId &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/hooks&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NotificationConstructor</span> <span class="keyword">from</span> <span class="string">&quot;./Notification.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; nextZIndex &#125; = <span class="title function_">useZIndex</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> notificationDefaults = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">  <span class="attr">position</span>: <span class="string">&quot;top-right&quot;</span>,</span><br><span class="line">  <span class="attr">duration</span>: <span class="number">3000</span>,</span><br><span class="line">  <span class="attr">offset</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">transitionName</span>: <span class="string">&quot;fade&quot;</span>,</span><br><span class="line">  <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line">&#125; <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">instancesMap</span>: <span class="title class_">Map</span>&lt;<span class="title class_">NotificationProps</span>[<span class="string">&quot;position&quot;</span>], <span class="title class_">NotificationInstance</span>[]&gt; =</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="title function_">each</span>(notificationPosition, <span class="function">(<span class="params">key</span>) =&gt;</span> instancesMap.<span class="title function_">set</span>(key, <span class="title function_">shallowReactive</span>([])));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getInstancesByPosition = (</span><br><span class="line">  <span class="attr">position</span>: <span class="title class_">NotificationProps</span>[<span class="string">&quot;position&quot;</span>]</span><br><span class="line">): <span class="title class_">NotificationInstance</span>[] =&gt; instancesMap.<span class="title function_">get</span>(position)!;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeOptions</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">options</span>: <span class="title class_">NotificationParams</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">CreateNotificationProps</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result =</span><br><span class="line">    !options || <span class="title function_">isVNode</span>(options) || <span class="title function_">isString</span>(options)</span><br><span class="line">      ? &#123; <span class="attr">message</span>: options &#125;</span><br><span class="line">      : options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; ...notificationDefaults, ...result &#125; <span class="keyword">as</span> <span class="title class_">CreateNotificationProps</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createNotification</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">props</span>: <span class="title class_">CreateNotificationProps</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">NotificationInstance</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> id = <span class="title function_">useId</span>().<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> instances = <span class="title function_">getInstancesByPosition</span>(props.<span class="property">position</span> || <span class="string">&quot;top-right&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">destory</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> idx = <span class="title function_">findIndex</span>(instances, &#123; id &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (idx === -<span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    instances.<span class="title function_">splice</span>(idx, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="literal">null</span>, container);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> _props = &#123;</span><br><span class="line">    ...props,</span><br><span class="line">    id,</span><br><span class="line">    <span class="attr">zIndex</span>: <span class="title function_">nextZIndex</span>(),</span><br><span class="line">    <span class="attr">onDestory</span>: destory,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> vnode = <span class="title function_">h</span>(<span class="title class_">NotificationConstructor</span>, _props);</span><br><span class="line">  <span class="title function_">render</span>(vnode, container);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(container.<span class="property">firstElementChild</span>!);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> vm = vnode.<span class="property">component</span>!;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">handler</span>: <span class="title class_">NotificationHandler</span> = &#123;</span><br><span class="line">    <span class="attr">close</span>: <span class="function">() =&gt;</span> vm.<span class="property">exposed</span>?.<span class="title function_">close</span>(),</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">instance</span>: <span class="title class_">NotificationInstance</span> = &#123;</span><br><span class="line">    <span class="attr">props</span>: _props,</span><br><span class="line">    id,</span><br><span class="line">    vm,</span><br><span class="line">    vnode,</span><br><span class="line">    handler,</span><br><span class="line">  &#125;;</span><br><span class="line">  instances.<span class="title function_">push</span>(instance);</span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">notification</span>: <span class="title class_">NotificationFn</span> &amp; <span class="title class_">Partial</span>&lt;<span class="title class_">Notification</span>&gt; = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  options = &#123;&#125;</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> normalized = <span class="title function_">normalizeOptions</span>(options);</span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">createNotification</span>(normalized);</span><br><span class="line">  <span class="keyword">return</span> instance.<span class="property">handler</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">closeAll</span>(<span class="params"><span class="attr">type</span>?: notificationType</span>) &#123;</span><br><span class="line">  instancesMap.<span class="title function_">forEach</span>(<span class="function">(<span class="params">instances</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">each</span>(instances, <span class="function">(<span class="params">instance</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">type</span>) &#123;</span><br><span class="line">        instance.<span class="property">props</span>.<span class="property">type</span> === <span class="keyword">type</span> &amp;&amp; instance.<span class="property">handler</span>.<span class="title function_">close</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      instance.<span class="property">handler</span>.<span class="title function_">close</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getLastBottomOffset</span>(<span class="params"><span class="attr">this</span>: <span class="title class_">NotificationProps</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> instances = <span class="title function_">getInstancesByPosition</span>(<span class="variable language_">this</span>.<span class="property">position</span> || <span class="string">&quot;top-right&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> idx = <span class="title function_">findIndex</span>(instances, &#123; <span class="attr">id</span>: <span class="variable language_">this</span>.<span class="property">id</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (idx &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">get</span>(instances, [idx - <span class="number">1</span>, <span class="string">&quot;vm&quot;</span>, <span class="string">&quot;exposed&quot;</span>, <span class="string">&quot;bottomOffset&quot;</span>, <span class="string">&quot;value&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">each</span>(notificationTypes, <span class="function">(<span class="params"><span class="keyword">type</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">set</span>(notification, <span class="keyword">type</span>, <span class="function">(<span class="params"><span class="attr">options</span>: <span class="title class_">NotificationParams</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> normalized = <span class="title function_">normalizeOptions</span>(options);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">notification</span>(&#123; ...normalized, <span class="keyword">type</span> &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">notification.<span class="property">closeAll</span> = closeAll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> notification <span class="keyword">as</span> <span class="title class_">Notification</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Notification-test-tsx"><a href="#â”œâ”€-Notification-test-tsx" class="headerlink" title="â”œâ”€ Notification.test.tsx"></a>â”œâ”€ Notification.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, test, expect &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; nextTick &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; notification, closeAll &#125; <span class="keyword">from</span> <span class="string">&quot;./methods&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">rAF</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">requestAnimationFrame</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="title function_">res</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">nextTick</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTopValue</span>(<span class="params"><span class="attr">element</span>: <span class="title class_">Element</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> styles = <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(element);</span><br><span class="line">  <span class="keyword">const</span> topValue = styles.<span class="title function_">getPropertyValue</span>(<span class="string">&quot;top&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Number</span>.<span class="built_in">parseFloat</span>(topValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;createMessage&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;call notification()&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="title function_">notification</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-notification&quot;</span>)).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    handler.<span class="title function_">close</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-notification&quot;</span>)).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&#x27;call notification() more times&#x27;</span>,<span class="title function_">async</span>()=&gt; &#123;</span><br><span class="line">    <span class="title function_">notification</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span> &#125;);</span><br><span class="line">    <span class="title function_">notification</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.er-notification&quot;</span>).<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">2</span>);</span><br><span class="line">    notification.<span class="title function_">closeAll</span>()</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.er-notification&quot;</span>).<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&#x27;offset&#x27;</span>,<span class="title function_">async</span>()=&gt;&#123;</span><br><span class="line">    <span class="title function_">notification</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span>,<span class="attr">offset</span>:<span class="number">100</span> &#125;);</span><br><span class="line">    <span class="title function_">notification</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span>,<span class="attr">offset</span>:<span class="number">50</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>()</span><br><span class="line">    <span class="keyword">const</span> elements = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.er-notification&quot;</span>)</span><br><span class="line">    <span class="title function_">expect</span>(elements.<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">getTopValue</span>(elements[<span class="number">0</span>])).<span class="title function_">toBe</span>(<span class="number">100</span>)</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">getTopValue</span>(elements[<span class="number">1</span>])).<span class="title function_">toBe</span>(<span class="number">150</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Notification-vue"><a href="#â”œâ”€-Notification-vue" class="headerlink" title="â”œâ”€ Notification.vue"></a>â”œâ”€ Notification.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; NotificationProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; ref, computed, onMounted &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; getLastBottomOffset &#125; from &quot;./methods&quot;;</span><br><span class="line">import &#123; bind, delay, isString &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123; RenderVnode, typeIconMap &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import &#123; useOffset &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line"></span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line"></span><br><span class="line">const props = withDefaults(defineProps&lt;NotificationProps&gt;(), &#123;</span><br><span class="line">  type: &quot;info&quot;,</span><br><span class="line">  duration: 3000,</span><br><span class="line">  offset: 20,</span><br><span class="line">  transitionName: &quot;fade&quot;,</span><br><span class="line">  showClose: true,</span><br><span class="line">&#125;);</span><br><span class="line">const visible = ref(false);</span><br><span class="line">const notifyRef = ref&lt;HTMLDivElement&gt;();</span><br><span class="line"></span><br><span class="line">// è¿™ä¸ª div çš„é«˜åº¦</span><br><span class="line">const boxHeight = ref(0);</span><br><span class="line"></span><br><span class="line">const &#123; topOffset, bottomOffset &#125; = useOffset(&#123;</span><br><span class="line">  getLastBottomOffset: bind(getLastBottomOffset, props),</span><br><span class="line">  offset: props.offset,</span><br><span class="line">  boxHeight,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const iconName = computed(() =&gt; &#123;</span><br><span class="line">  if (isString(props.icon)) return props.icon;</span><br><span class="line">  return typeIconMap.get(props.type);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const horizontalClass = computed(() =&gt;</span><br><span class="line">  props.position.endsWith(&quot;right&quot;) ? &quot;right&quot; : &quot;left&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const verticalProperty = computed(() =&gt;</span><br><span class="line">  props.position.startsWith(&quot;top&quot;) ? &quot;top&quot; : &quot;bottom&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const cssStyle = computed(() =&gt; (&#123;</span><br><span class="line">  [verticalProperty.value]: topOffset.value + &quot;px&quot;,</span><br><span class="line">  zIndex: props.zIndex,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">let timer: number;</span><br><span class="line"></span><br><span class="line">function startTimer() &#123;</span><br><span class="line">  if (props.duration === 0) return;</span><br><span class="line">  timer = delay(close, props.duration);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function clearTimer() &#123;</span><br><span class="line">  clearTimeout(timer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function close() &#123;</span><br><span class="line">  visible.value = false;</span><br><span class="line">  props?.onClose?.();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  visible.value = true;</span><br><span class="line">  startTimer();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">defineExpose(&#123;</span><br><span class="line">  close,</span><br><span class="line">  bottomOffset,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition</span><br><span class="line">    :name=&quot;`er-notification-$&#123;transitionName&#125;`&quot;</span><br><span class="line">    @after-leave=&quot;!visible &amp;&amp; onDestory()&quot;</span><br><span class="line">    @enter=&quot;boxHeight = notifyRef!.getBoundingClientRect().height&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      ref=&quot;notifyRef&quot;</span><br><span class="line">      class=&quot;er-notification&quot;</span><br><span class="line">      :class=&quot;&#123;</span><br><span class="line">        [`er-notification--$&#123;type&#125;`]: type,</span><br><span class="line">        &#x27;show-close&#x27;: showClose,</span><br><span class="line">        [horizontalClass]: true,</span><br><span class="line">      &#125;&quot;</span><br><span class="line">      :style=&quot;cssStyle&quot;</span><br><span class="line">      v-show=&quot;visible&quot;</span><br><span class="line">      role=&quot;alert&quot;</span><br><span class="line">      @click=&quot;onClick&quot;</span><br><span class="line">      @mouseenter=&quot;clearTimer&quot;</span><br><span class="line">      @mouseleave=&quot;startTimer&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;er-icon v-if=&quot;iconName&quot; :icon=&quot;iconName&quot; class=&quot;er-notification__icon&quot; /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class=&quot;er-notification__text&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;er-notification__title&quot;&gt;&#123;&#123; title &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;er-notification__content&quot;&gt;</span><br><span class="line">          &lt;slot&gt;</span><br><span class="line">            &lt;render-vnode v-if=&quot;message&quot; :vNode=&quot;message&quot; /&gt;</span><br><span class="line">          &lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;er-notification__close&quot; v-if=&quot;showClose&quot;&gt;</span><br><span class="line">        &lt;er-icon icon=&quot;xmark&quot; @click.stop=&quot;close&quot; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-10"><a href="#â”œâ”€-style-css-10" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-notification</span> &#123;</span><br><span class="line">  <span class="attr">--er-notification-width</span>: <span class="number">330px</span>;</span><br><span class="line">  <span class="attr">--er-notification-padding</span>: <span class="number">14px</span> <span class="number">26px</span> <span class="number">14px</span> <span class="number">13px</span>;</span><br><span class="line">  <span class="attr">--er-notification-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attr">--er-notification-shadow</span>: <span class="built_in">var</span>(--er-box-shadow-light);</span><br><span class="line">  <span class="attr">--er-notification-border-color</span>: <span class="built_in">var</span>(--er-border-color-lighter);</span><br><span class="line">  <span class="attr">--er-notification-icon-size</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attr">--er-notification-close-font-size</span>: <span class="built_in">var</span>(--er-message-close-size, <span class="number">16px</span>);</span><br><span class="line">  <span class="attr">--er-notification-content-font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">  <span class="attr">--er-notification-content-color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">  <span class="attr">--er-notification-title-font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attr">--er-notification-title-color</span>: <span class="built_in">var</span>(--er-text-color-primary);</span><br><span class="line">  <span class="attr">--er-notification-close-color</span>: <span class="built_in">var</span>(--er-text-color-secondary);</span><br><span class="line">  <span class="attr">--er-notification-close-hover-color</span>: <span class="built_in">var</span>(--er-text-color-regular)</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-notification</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">var</span>(--er-notification-width);</span><br><span class="line">  <span class="attribute">padding</span>: <span class="built_in">var</span>(--er-notification-padding);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-notification-radius);</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-notification-border-color);</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-bg-color-overlay);</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--er-notification-shadow);</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="built_in">var</span>(--er-transition-duration),transform <span class="built_in">var</span>(--er-transition-duration),right <span class="built_in">var</span>(--er-transition-duration),top .<span class="number">4s</span>,bottom <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  <span class="attribute">overflow-wrap</span>: anywhere;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">9999</span>;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-notification__text</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-notification__icon</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="built_in">var</span>(--er-notification-icon-size);</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">var</span>(--er-notification-icon-size);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-notification-icon-size);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-notification-icon-color);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-notification__title</span> &#123;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-notification-title-font-size);</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="built_in">var</span>(--er-notification-icon-size);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-notification-title-color);</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-notification__content</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-notification-content-font-size);</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">24px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">6px</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-notification-content-color);</span><br><span class="line">    <span class="attribute">text-align</span>: justify</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-notification__close</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">18px</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-notification-close-color);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-notification-close-font-size)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@each</span> $val in info,success,warning,danger &#123; </span><br><span class="line">  <span class="selector-class">.er-notification--</span>$(val) &#123;</span><br><span class="line">    <span class="attr">--er-notification-icon-color</span>: <span class="built_in">var</span>(--er-color-$(val));</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--el-notification-icon-color);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-notification--error</span> &#123;</span><br><span class="line">  <span class="attr">--er-notification-icon-color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--el-notification-icon-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-notification-fade-enter-from</span> &#123;</span><br><span class="line">  &amp;<span class="selector-class">.right</span>&#123;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">100%</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.left</span>&#123;</span><br><span class="line">    <span class="attribute">left</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">100%</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-notification-fade-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-11"><a href="#â””â”€-types-ts-11" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">VNode</span>, <span class="title class_">ComponentInternalInstance</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> notificationTypes = [</span><br><span class="line">  <span class="string">&quot;info&quot;</span>,</span><br><span class="line">  <span class="string">&quot;success&quot;</span>,</span><br><span class="line">  <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">  <span class="string">&quot;danger&quot;</span>,</span><br><span class="line">] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> notificationType = (<span class="keyword">typeof</span> notificationTypes)[<span class="built_in">number</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> notificationPosition = [</span><br><span class="line">  <span class="string">&quot;top-right&quot;</span>,</span><br><span class="line">  <span class="string">&quot;top-left&quot;</span>,</span><br><span class="line">  <span class="string">&quot;bottom-right&quot;</span>,</span><br><span class="line">  <span class="string">&quot;bottom-left&quot;</span>,</span><br><span class="line">] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NotificationPosition</span> = (<span class="keyword">typeof</span> notificationPosition)[<span class="built_in">number</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">NotificationProps</span> &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">zIndex</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">position</span>: <span class="title class_">NotificationPosition</span>;</span><br><span class="line">  <span class="attr">type</span>?: <span class="string">&quot;success&quot;</span> | <span class="string">&quot;info&quot;</span> | <span class="string">&quot;warning&quot;</span> | <span class="string">&quot;danger&quot;</span> | <span class="string">&quot;error&quot;</span>;</span><br><span class="line">  <span class="attr">message</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span>;</span><br><span class="line">  <span class="attr">duration</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">showClose</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">offset</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">transitionName</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">icon</span>?: <span class="built_in">string</span>;</span><br><span class="line">  onClick?(): <span class="built_in">void</span>;</span><br><span class="line">  onClose?(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">onDestory</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">NotificationInstance</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">vnode</span>: <span class="title class_">VNode</span>;</span><br><span class="line">  <span class="attr">vm</span>: <span class="title class_">ComponentInternalInstance</span>;</span><br><span class="line">  <span class="attr">props</span>: <span class="title class_">NotificationProps</span>;</span><br><span class="line">  <span class="attr">handler</span>: <span class="title class_">NotificationHandler</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CreateNotificationProps</span> = <span class="title class_">Omit</span>&lt;</span><br><span class="line">  <span class="title class_">NotificationProps</span>,</span><br><span class="line">  <span class="string">&quot;onDestory&quot;</span> | <span class="string">&quot;id&quot;</span> | <span class="string">&quot;zIndex&quot;</span></span><br><span class="line">&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">NotificationHandler</span> &#123;</span><br><span class="line">  <span class="title function_">close</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NotificationOptions</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">Omit</span>&lt;<span class="title class_">NotificationProps</span>, <span class="string">&quot;id&quot;</span>&gt;&gt;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NotificationParams</span> = <span class="built_in">string</span> | <span class="title class_">VNode</span> | <span class="title class_">NotificationOptions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NotificationFn</span> = &#123;</span><br><span class="line">  (<span class="attr">props</span>: <span class="title class_">NotificationParams</span>): <span class="title class_">NotificationHandler</span>;</span><br><span class="line">  <span class="title function_">closeAll</span>(<span class="attr">type</span>?: notificationType): <span class="built_in">void</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NotificationTypeFn</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">props</span>: <span class="title class_">NotificationParams</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="title class_">NotificationHandler</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Notification</span> <span class="keyword">extends</span> <span class="title class_">NotificationFn</span> &#123;</span><br><span class="line">  <span class="attr">success</span>: <span class="title class_">NotificationTypeFn</span>;</span><br><span class="line">  <span class="attr">warning</span>: <span class="title class_">NotificationTypeFn</span>;</span><br><span class="line">  <span class="attr">info</span>: <span class="title class_">NotificationTypeFn</span>;</span><br><span class="line">  <span class="attr">danger</span>: <span class="title class_">NotificationTypeFn</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Overlay"><a href="#â”œâ”€-Overlay" class="headerlink" title="â”œâ”€ Overlay"></a>â”œâ”€ Overlay</h3><blockquote><p>é®ç½©å±‚ç»„ä»¶ï¼Œç”¨äºè¦†ç›–é¡µé¢å†…å®¹</p></blockquote><h4 id="â€“APIâ€“-11"><a href="#â€“APIâ€“-11" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-Overlay-vue"><a href="#â”œâ”€-Overlay-vue" class="headerlink" title="â”œâ”€ Overlay.vue"></a>â”œâ”€ Overlay.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; OverlayProps, OverlayEmits &#125; from &quot;./types&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123; name: &quot;ErOverlay&quot; &#125;);</span><br><span class="line">withDefaults(defineProps&lt;OverlayProps&gt;(), &#123;</span><br><span class="line">  mask: true,</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;OverlayEmits&gt;();</span><br><span class="line"></span><br><span class="line">function onMaskClick(e: MouseEvent) &#123;</span><br><span class="line">  emits(&quot;click&quot;, e);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    v-if=&quot;mask&quot;</span><br><span class="line">    class=&quot;er-overlay&quot;</span><br><span class="line">    :class=&quot;overlayClass&quot;</span><br><span class="line">    :style=&quot;&#123; zIndex: zIndex &#125;&quot;</span><br><span class="line">    @click=&quot;onMaskClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    v-else</span><br><span class="line">    :class=&quot;overlayClass&quot;</span><br><span class="line">    :style=&quot;&#123;</span><br><span class="line">      zIndex: zIndex,</span><br><span class="line">      position: &#x27;fixed&#x27;,</span><br><span class="line">      top: 0,</span><br><span class="line">      left: 0,</span><br><span class="line">      right: 0,</span><br><span class="line">      bottom: 0,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.er-overlay &#123;</span><br><span class="line">  position: fixed;</span><br><span class="line">  top: 0;</span><br><span class="line">  left: 0;</span><br><span class="line">  right: 0;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  height: 100%;</span><br><span class="line">  background-color: rgba(0, 0, 0, 0.5);</span><br><span class="line">  overflow: auto;</span><br><span class="line">  z-index: 2000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-12"><a href="#â””â”€-types-ts-12" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">OverlayProps</span> &#123;</span><br><span class="line">  <span class="attr">mask</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">zIndex</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">overlayClass</span>?: <span class="built_in">string</span> | <span class="built_in">string</span>[] | <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">boolean</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">OverlayEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;click&quot;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Popconfirm"><a href="#â”œâ”€-Popconfirm" class="headerlink" title="â”œâ”€ Popconfirm"></a>â”œâ”€ Popconfirm</h3><blockquote><p>æ°”æ³¡ç¡®è®¤æ¡†</p></blockquote><h4 id="â€“APIâ€“-12"><a href="#â€“APIâ€“-12" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-index-ts-13"><a href="#â”œâ”€-index-ts-13" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Popconfirm</span> <span class="keyword">from</span> <span class="string">&quot;./Popconfirm.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErPopconfirm</span> = <span class="title function_">withInstall</span>(<span class="title class_">Popconfirm</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Popconfirm-test-tsx"><a href="#â”œâ”€-Popconfirm-test-tsx" class="headerlink" title="â”œâ”€ Popconfirm.test.tsx"></a>â”œâ”€ Popconfirm.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, test, expect, vi, beforeEach &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; each, get &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">PopconfirmProps</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ErPopconfirm</span> &#125; <span class="keyword">from</span> <span class="string">&quot;.&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Popconfirm</span> <span class="keyword">from</span> <span class="string">&quot;./Popconfirm.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> onConfirm = vi.<span class="title function_">fn</span>();</span><br><span class="line"><span class="keyword">const</span> onCancel = vi.<span class="title function_">fn</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Popconfirm/index.ts&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æµ‹è¯• withInstall å‡½æ•°æ˜¯å¦è¢«æ­£ç¡®åº”ç”¨</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should be exported with withInstall()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErPopconfirm</span>.<span class="property">install</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æµ‹è¯• Popconfirm ç»„ä»¶æ˜¯å¦è¢«æ­£ç¡®å¯¼å‡º</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should be exported Popconfirm component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErPopconfirm</span>).<span class="title function_">toBe</span>(<span class="title class_">Popconfirm</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯é€‰ï¼šæµ‹è¯• withInstall æ˜¯å¦å¢å¼ºäº† Popconfirm ç»„ä»¶çš„åŠŸèƒ½</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;should enhance Popconfirm component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> enhancedPopconfirm = <span class="title function_">withInstall</span>(<span class="title class_">Popconfirm</span>);</span><br><span class="line">    <span class="title function_">expect</span>(enhancedPopconfirm).<span class="title function_">toBe</span>(<span class="title class_">ErPopconfirm</span>);</span><br><span class="line">    <span class="comment">// è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šæµ‹è¯•ï¼Œç¡®ä¿ withInstall å¢å¼ºäº†ç»„ä»¶çš„ç‰¹å®šåŠŸèƒ½</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯é€‰ï¼šå¦‚æœä½ çš„ withInstall å‡½æ•°æœ‰ç‰¹å®šçš„è¡Œä¸ºæˆ–å±æ€§ï¼Œç¡®ä¿å®ƒä»¬è¢«æ­£ç¡®åº”ç”¨</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;should apply specific enhancements&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span>  enhancedPopconfirm  = <span class="title function_">withInstall</span>(<span class="title class_">Popconfirm</span>);</span><br><span class="line">    <span class="comment">// ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ withInstall å¢åŠ äº†ä¸€ä¸ªç‰¹å®šçš„æ–¹æ³•æˆ–å±æ€§</span></span><br><span class="line">    <span class="title function_">expect</span>(enhancedPopconfirm).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;install&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•ç»„ä»¶æ˜¯å¦èƒ½å¤Ÿæ¥æ”¶æ‰€æœ‰ props</span></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Popconfirm.vue&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> props = &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;Test Title&quot;</span>,</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&quot;Confirm&quot;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&quot;Cancel&quot;</span>,</span><br><span class="line">    <span class="attr">confirmButtonType</span>: <span class="string">&quot;primary&quot;</span>,</span><br><span class="line">    <span class="attr">cancelButtonType</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&quot;check-circle&quot;</span>,</span><br><span class="line">    <span class="attr">iconColor</span>: <span class="string">&quot;green&quot;</span>,</span><br><span class="line">    <span class="attr">hideIcon</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">hideAfter</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="number">200</span>,</span><br><span class="line">  &#125; <span class="keyword">as</span> <span class="title class_">PopconfirmProps</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    vi.<span class="title function_">useFakeTimers</span>();</span><br><span class="line">    vi.<span class="title function_">clearAllMocks</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should accept all props&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Popconfirm</span>, &#123;</span><br><span class="line">      props,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥ props æ˜¯å¦è¢«æ­£ç¡®è®¾ç½®</span></span><br><span class="line">    <span class="title function_">each</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(props), <span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">get</span>(wrapper.<span class="title function_">props</span>(), key)).<span class="title function_">toBe</span>(<span class="title function_">get</span>(props, key));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æµ‹è¯•æ’æ§½å†…å®¹</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should renders slot content correctly&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> slotContent = <span class="string">&quot;Slot Content&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Popconfirm</span>, &#123;</span><br><span class="line">      props,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: slotContent,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(slotContent);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;popconfirm emits&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="function">() =&gt;</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;outside&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Popconfirm</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">title</span>=<span class="string">&quot;Test Title&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">hideIcon</span>=<span class="string">&#123;true&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onConfirm</span>=<span class="string">&#123;onConfirm&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onCancel</span>=<span class="string">&#123;onCancel&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;trigger&quot;</span>&gt;</span>trigger<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Popconfirm</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    ));</span><br><span class="line">    <span class="keyword">const</span> triggerArea = wrapper.<span class="title function_">find</span>(<span class="string">&quot;#trigger&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(triggerArea.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼¹å‡ºå±‚æ˜¯å¦å‡ºç°</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-popconfirm&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="keyword">const</span> confirmButton = wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-popconfirm__confirm&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(confirmButton.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">    confirmButton.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-popconfirm&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onConfirm).<span class="title function_">toBeCalled</span>();</span><br><span class="line"></span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-popconfirm&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="keyword">const</span> cancelButton = wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-popconfirm__cancel&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(cancelButton.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    cancelButton.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-popconfirm&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onCancel).<span class="title function_">toBeCalled</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Popconfirm-vue"><a href="#â”œâ”€-Popconfirm-vue" class="headerlink" title="â”œâ”€ Popconfirm.vue"></a>â”œâ”€ Popconfirm.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; ref, computed &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; addUnit &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import type &#123; PopconfirmProps, PopconfirmEmits &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; useLocale &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import type &#123; TooltipInstance &#125; from &quot;../Tooltip&quot;;</span><br><span class="line"></span><br><span class="line">import ErButton from &quot;../Button/Button.vue&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line">import ErTooltip from &quot;../Tooltip/Tooltip.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErPopconfirm&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const props = withDefaults(defineProps&lt;PopconfirmProps&gt;(), &#123;</span><br><span class="line">  title: &quot;&quot;,</span><br><span class="line">  confirmButtonType: &quot;primary&quot;,</span><br><span class="line">  icon: &quot;question-circle&quot;,</span><br><span class="line">  iconColor: &quot;#f90&quot;,</span><br><span class="line">  hideAfter: 200,</span><br><span class="line">  width: 150,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const emits = defineEmits&lt;PopconfirmEmits&gt;();</span><br><span class="line">const tooltipRef = ref&lt;TooltipInstance&gt;();</span><br><span class="line">const style = computed(() =&gt; (&#123; width: addUnit(props.width) &#125;));</span><br><span class="line"></span><br><span class="line">const &#123; t &#125; = useLocale();</span><br><span class="line"></span><br><span class="line">function hidePopper() &#123;</span><br><span class="line">  tooltipRef.value?.hide();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function confirm(e: MouseEvent) &#123;</span><br><span class="line">  emits(&quot;confirm&quot;, e);</span><br><span class="line">  hidePopper();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function cancel(e: MouseEvent) &#123;</span><br><span class="line">  emits(&quot;cancel&quot;, e);</span><br><span class="line">  hidePopper();</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;er-tooltip ref=&quot;tooltipRef&quot; trigger=&quot;click&quot; :hide-timeout=&quot;hideAfter&quot;&gt;</span><br><span class="line">    &lt;template #content&gt;</span><br><span class="line">      &lt;div class=&quot;er-popconfirm&quot; :style=&quot;style&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;er-popconfirm__main&quot;&gt;</span><br><span class="line">          &lt;er-icon v-if=&quot;!hideIcon &amp;&amp; icon&quot; :icon=&quot;icon&quot; :color=&quot;iconColor&quot; /&gt;</span><br><span class="line">          &#123;&#123; title &#125;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;er-popconfirm__action&quot;&gt;</span><br><span class="line">          &lt;er-button</span><br><span class="line">            size=&quot;small&quot;</span><br><span class="line">            class=&quot;er-popconfirm__cancel&quot;</span><br><span class="line">            :type=&quot;cancelButtonType&quot;</span><br><span class="line">            @click=&quot;cancel&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &#123;&#123; cancelButtonText || t(&quot;popconfirm.cancelButtonText&quot;) &#125;&#125;</span><br><span class="line">          &lt;/er-button&gt;</span><br><span class="line">          &lt;er-button</span><br><span class="line">            size=&quot;small&quot;</span><br><span class="line">            class=&quot;er-popconfirm__confirm&quot;</span><br><span class="line">            :type=&quot;confirmButtonType&quot;</span><br><span class="line">            @click=&quot;confirm&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &#123;&#123; confirmButtonText || t(&quot;popconfirm.confirmButtonText&quot;) &#125;&#125;</span><br><span class="line">          &lt;/er-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;template v-if=&quot;$slots.default&quot; #default&gt;</span><br><span class="line">      &lt;slot name=&quot;default&quot;&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;template v-if=&quot;$slots.reference&quot; #default&gt;</span><br><span class="line">      &lt;slot name=&quot;reference&quot;&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/er-tooltip&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-11"><a href="#â”œâ”€-style-css-11" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-popconfirm</span> &#123;</span><br><span class="line">  <span class="selector-class">.er-popconfirm__main</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="selector-tag">i</span> &#123;</span><br><span class="line">      <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-popconfirm__action</span> &#123;</span><br><span class="line">    <span class="attribute">text-align</span>: right;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">8px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-13"><a href="#â””â”€-types-ts-13" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ButtonType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../Button&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">PopconfirmProps</span> &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">confirmButtonText</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">cancelButtonText</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">confirmButtonType</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">  <span class="attr">cancelButtonType</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">  <span class="attr">icon</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">iconColor</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">hideIcon</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">hideAfter</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">width</span>?: <span class="built_in">number</span> | <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">PopconfirmEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;confirm&quot;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;cancel&quot;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Select"><a href="#â”œâ”€-Select" class="headerlink" title="â”œâ”€ Select"></a>â”œâ”€ Select</h3><blockquote><p>ä¸‹æ‹‰é€‰æ‹©æ¡†ç»„ä»¶ï¼Œç”¨äºä»ä¸€ç»„é€‰é¡¹ä¸­é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªå€¼</p></blockquote><h4 id="â€“APIâ€“-13"><a href="#â€“APIâ€“-13" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-constants-ts-5"><a href="#â”œâ”€-constants-ts-5" class="headerlink" title="â”œâ”€ constants.ts"></a>â”œâ”€ constants.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">SelectContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">SELECT_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">SelectContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;selectContext&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">POPPER_OPTIONS</span>: <span class="built_in">any</span> = &#123;</span><br><span class="line">  <span class="attr">modifiers</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;offset&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">offset</span>: [<span class="number">0</span>, <span class="number">9</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;sameWidth&quot;</span>,</span><br><span class="line">      <span class="attr">enabled</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">fn</span>: <span class="function">(<span class="params">&#123; state &#125;: &#123; state: <span class="built_in">any</span> &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        state.<span class="property">styles</span>.<span class="property">popper</span>.<span class="property">width</span> = <span class="string">`<span class="subst">$&#123;state.rects.reference.width&#125;</span>px`</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">phase</span>: <span class="string">&quot;beforeWrite&quot;</span>,</span><br><span class="line">      <span class="attr">requires</span>: [<span class="string">&quot;computeStyles&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125; <span class="keyword">as</span> <span class="keyword">const</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-index-ts-14"><a href="#â”œâ”€-index-ts-14" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Select</span> <span class="keyword">from</span> <span class="string">&quot;./Select.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Option</span> <span class="keyword">from</span> <span class="string">&quot;./Option.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErSelect</span> = <span class="title function_">withInstall</span>(<span class="title class_">Select</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErOption</span> = <span class="title function_">withInstall</span>(<span class="title class_">Option</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Option-vue"><a href="#â”œâ”€-Option-vue" class="headerlink" title="â”œâ”€ Option.vue"></a>â”œâ”€ Option.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; SelectOptionProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; SELECT_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line">import &#123; get, eq, every &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123; computed, inject &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; RenderVnode &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErOption&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;SelectOptionProps&gt;(), &#123;</span><br><span class="line">  disabled: false,</span><br><span class="line">&#125;);</span><br><span class="line">const ctx = inject(SELECT_CTX_KEY);</span><br><span class="line">const selected = computed(</span><br><span class="line">  () =&gt; ctx?.selectStates?.selectedOption?.value === props.value</span><br><span class="line">);</span><br><span class="line">const isHighlighted = computed(() =&gt;</span><br><span class="line">  every([&quot;label&quot;, &quot;value&quot;], (key) =&gt;</span><br><span class="line">    eq(get(ctx, [&quot;highlightedLine&quot;, &quot;value&quot;, key]), get(props, key))</span><br><span class="line">  )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">function handleClick() &#123;</span><br><span class="line">  if (props.disabled) return;</span><br><span class="line">  ctx?.handleSelect(props);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;li</span><br><span class="line">    class=&quot;er-select__menu-item&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">      &#x27;is-selected&#x27;: selected,</span><br><span class="line">      &#x27;is-highlighted&#x27;: isHighlighted,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">    :id=&quot;`select-item-$&#123;value&#125;`&quot;</span><br><span class="line">    @click.stop=&quot;handleClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;slot&gt;</span><br><span class="line">      &lt;render-vnode</span><br><span class="line">        :vNode=&quot;ctx?.renderLabel ? ctx?.renderLabel(props) : label&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/slot&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Select-vue"><a href="#â”œâ”€-Select-vue" class="headerlink" title="â”œâ”€ Select.vue"></a>â”œâ”€ Select.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;</span><br><span class="line">  assign,</span><br><span class="line">  find,</span><br><span class="line">  get,</span><br><span class="line">  each,</span><br><span class="line">  noop,</span><br><span class="line">  isFunction,</span><br><span class="line">  filter,</span><br><span class="line">  isNil,</span><br><span class="line">  isBoolean,</span><br><span class="line">  includes,</span><br><span class="line">  map,</span><br><span class="line">  size,</span><br><span class="line">  eq,</span><br><span class="line">  debounce,</span><br><span class="line">&#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123;</span><br><span class="line">  ref,</span><br><span class="line">  reactive,</span><br><span class="line">  computed,</span><br><span class="line">  onMounted,</span><br><span class="line">  provide,</span><br><span class="line">  useSlots,</span><br><span class="line">  watch,</span><br><span class="line">  h,</span><br><span class="line">  nextTick,</span><br><span class="line">  type Ref,</span><br><span class="line">  type VNode,</span><br><span class="line">&#125; from &quot;vue&quot;;</span><br><span class="line">import type &#123;</span><br><span class="line">  SelectProps,</span><br><span class="line">  SelectEmits,</span><br><span class="line">  SelectOptionProps,</span><br><span class="line">  SelectContext,</span><br><span class="line">  SelectInstance,</span><br><span class="line">  SelectStates,</span><br><span class="line">&#125; from &quot;./types&quot;;</span><br><span class="line">import type &#123; TooltipInstance &#125; from &quot;../Tooltip/types&quot;;</span><br><span class="line">import type &#123; InputInstance &#125; from &quot;../Input/types&quot;;</span><br><span class="line">import &#123; RenderVnode, debugWarn &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import &#123; useFocusController, useClickOutside &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; SELECT_CTX_KEY, POPPER_OPTIONS &#125; from &quot;./constants&quot;;</span><br><span class="line">import &#123; useFormItem, useFormDisabled, useFormItemInputId &#125; from &quot;../Form&quot;;</span><br><span class="line"></span><br><span class="line">import useKeyMap from &quot;./useKeyMap&quot;;</span><br><span class="line">import ErTooltip from &quot;../Tooltip/Tooltip.vue&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line">import ErInput from &quot;../Input/Input.vue&quot;;</span><br><span class="line">import ErOption from &quot;./Option.vue&quot;;</span><br><span class="line"></span><br><span class="line">const COMPONENT_NAME = &quot;ErSelect&quot; as const;</span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: COMPONENT_NAME,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;SelectProps&gt;(), &#123;</span><br><span class="line">  options: () =&gt; [],</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;SelectEmits&gt;();</span><br><span class="line"></span><br><span class="line">const initialOption = findOption(props.modelValue);</span><br><span class="line"></span><br><span class="line">const selectRef = ref&lt;HTMLElement&gt;();</span><br><span class="line">const tooltipRef = ref&lt;TooltipInstance&gt;();</span><br><span class="line">const inputRef = ref&lt;InputInstance&gt;();</span><br><span class="line"></span><br><span class="line">const isDropdownVisible = ref(false);</span><br><span class="line">const filteredOptions = ref(props.options ?? []);</span><br><span class="line">const filteredChilds: Ref&lt;Map&lt;VNode, SelectOptionProps&gt;&gt; = ref(new Map());</span><br><span class="line"></span><br><span class="line">const selectStates = reactive&lt;SelectStates&gt;(&#123;</span><br><span class="line">  inputValue: initialOption?.label ?? &quot;&quot;,</span><br><span class="line">  selectedOption: initialOption,</span><br><span class="line">  mouseHover: false,</span><br><span class="line">  loading: false,</span><br><span class="line">  highlightedIndex: -1,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const slots = useSlots();</span><br><span class="line">const isDisabled = useFormDisabled();</span><br><span class="line">const &#123; formItem &#125; = useFormItem();</span><br><span class="line">const &#123; inputId &#125; = useFormItemInputId(props, formItem);</span><br><span class="line">const &#123;</span><br><span class="line">  wrapperRef: inputWrapperRef,</span><br><span class="line">  isFocused,</span><br><span class="line">  handleBlur,</span><br><span class="line">  handleFocus,</span><br><span class="line">&#125; = useFocusController(inputRef);</span><br><span class="line"></span><br><span class="line">useClickOutside(selectRef, (e) =&gt; handleClickOutsie(e));</span><br><span class="line"></span><br><span class="line">const highlightedLine = computed(() =&gt; &#123;</span><br><span class="line">  let result: SelectOptionProps | void;</span><br><span class="line">  if (hasChildren.value) &#123;</span><br><span class="line">    const node = [...filteredChilds.value][selectStates.highlightedIndex]?.[0];</span><br><span class="line">    result = filteredChilds.value.get(node);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    result = filteredOptions.value[selectStates.highlightedIndex];</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const children = computed(() =&gt;</span><br><span class="line">  filter(slots?.default?.(), (child) =&gt; eq(child.type, ErOption))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const hasChildren = computed(() =&gt; size(children.value) &gt; 0);</span><br><span class="line">const childrenOptsions = computed(() =&gt; &#123;</span><br><span class="line">  if (!hasChildren.value) return [];</span><br><span class="line">  return map(children.value, (item) =&gt; (&#123;</span><br><span class="line">    vNode: h(item),</span><br><span class="line">    props: assign(item.props, &#123;</span><br><span class="line">      disabled:</span><br><span class="line">        item.props?.disabled === true ||</span><br><span class="line">        (!isNil(item.props?.disabled) &amp;&amp; !isBoolean(item.props?.disabled)),</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const filterPlaceholder = computed(() =&gt; &#123;</span><br><span class="line">  return props.filterable &amp;&amp;</span><br><span class="line">    selectStates.selectedOption &amp;&amp;</span><br><span class="line">    isDropdownVisible.value</span><br><span class="line">    ? selectStates.selectedOption.label</span><br><span class="line">    : props.placeholder;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const timeout = computed(() =&gt; (props.remote ? 300 : 0));</span><br><span class="line"></span><br><span class="line">const hasData = computed(</span><br><span class="line">  () =&gt;</span><br><span class="line">    (hasChildren.value &amp;&amp; filteredChilds.value.size &gt; 0) ||</span><br><span class="line">    (!hasChildren.value &amp;&amp; size(filteredOptions.value) &gt; 0)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const isNoData = computed(() =&gt; &#123;</span><br><span class="line">  if (!props.filterable) return false;</span><br><span class="line">  if (!hasData.value) return true;</span><br><span class="line">  return false;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const lastIndex = computed(() =&gt;</span><br><span class="line">  hasChildren.value</span><br><span class="line">    ? filteredChilds.value.size - 1</span><br><span class="line">    : size(filteredOptions.value) - 1</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const showClear = computed(</span><br><span class="line">  () =&gt;</span><br><span class="line">    props.clearable &amp;&amp; selectStates.mouseHover &amp;&amp; selectStates.inputValue !== &quot;&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const handleFilterDebounce = debounce(handleFilter, timeout.value);</span><br><span class="line"></span><br><span class="line">const keyMap = useKeyMap(&#123;</span><br><span class="line">  isDropdownVisible,</span><br><span class="line">  controlVisible,</span><br><span class="line">  selectStates,</span><br><span class="line">  highlightedLine,</span><br><span class="line">  handleSelect,</span><br><span class="line">  hasData,</span><br><span class="line">  lastIndex,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const focus: SelectInstance[&quot;focus&quot;] = function () &#123;</span><br><span class="line">  inputRef.value?.focus();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const blur: SelectInstance[&quot;blur&quot;] = function () &#123;</span><br><span class="line">  handleClickOutsie();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function setFilteredChilds(opts: typeof childrenOptsions.value) &#123;</span><br><span class="line">  filteredChilds.value.clear();</span><br><span class="line">  each(opts, (item) =&gt; &#123;</span><br><span class="line">    filteredChilds.value.set(item.vNode, item.props as SelectOptionProps);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function renderLabel(opt: SelectOptionProps): VNode | string &#123;</span><br><span class="line">  if (isFunction(props.renderLabel)) &#123;</span><br><span class="line">    return props.renderLabel(opt);</span><br><span class="line">  &#125;</span><br><span class="line">  return opt.label;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function controlVisible(visible: boolean) &#123;</span><br><span class="line">  if (!tooltipRef.value) return;</span><br><span class="line">  get(tooltipRef, [&quot;value&quot;, visible ? &quot;show&quot; : &quot;hide&quot;])?.();</span><br><span class="line">  props.filterable &amp;&amp; controlInputVal(visible);</span><br><span class="line">  isDropdownVisible.value = visible;</span><br><span class="line">  emits(&quot;visible-change&quot;, visible);</span><br><span class="line"></span><br><span class="line">  selectStates.highlightedIndex = -1;</span><br><span class="line">&#125;</span><br><span class="line">function controlInputVal(visible: boolean) &#123;</span><br><span class="line">  if (!props.filterable) return;</span><br><span class="line">  if (visible) &#123;</span><br><span class="line">    if (selectStates.selectedOption) selectStates.inputValue = &quot;&quot;;</span><br><span class="line">    handleFilterDebounce();</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    selectStates.inputValue = selectStates.selectedOption?.label || &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">function toggleVisible() &#123;</span><br><span class="line">  if (isDisabled.value) return;</span><br><span class="line">  controlVisible(!isDropdownVisible.value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function findOption(value: string) &#123;</span><br><span class="line">  return find(props.options, (option) =&gt; option.value === value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleClickOutsie(e?: Event) &#123;</span><br><span class="line">  if (isFocused.value) &#123;</span><br><span class="line">    nextTick(() =&gt; handleBlur(new FocusEvent(&quot;focus&quot;, e)));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleSelect(o: SelectOptionProps) &#123;</span><br><span class="line">  if (o.disabled) return;</span><br><span class="line"></span><br><span class="line">  selectStates.inputValue = o.label;</span><br><span class="line">  selectStates.selectedOption = o;</span><br><span class="line">  each([&quot;change&quot;, &quot;update:modelValue&quot;], (k) =&gt; emits(k as any, o.value));</span><br><span class="line">  controlVisible(false);</span><br><span class="line">  inputRef.value?.focus();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function setSelected() &#123;</span><br><span class="line">  const option = findOption(props.modelValue);</span><br><span class="line">  if (!option) return;</span><br><span class="line">  selectStates.inputValue = option.label;</span><br><span class="line">  selectStates.selectedOption = option;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleClear() &#123;</span><br><span class="line">  inputRef.value?.clear();</span><br><span class="line">  selectStates.inputValue = &quot;&quot;;</span><br><span class="line">  selectStates.selectedOption = null;</span><br><span class="line"></span><br><span class="line">  emits(&quot;clear&quot;);</span><br><span class="line">  each([&quot;change&quot;, &quot;update:modelValue&quot;], (k) =&gt; emits(k as any, &quot;&quot;));</span><br><span class="line">  formItem?.clearValidate();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function callRemoteMethod(method: Function, search: string) &#123;</span><br><span class="line">  if (!method || !isFunction(method)) return;</span><br><span class="line"></span><br><span class="line">  selectStates.loading = true;</span><br><span class="line">  let result;</span><br><span class="line">  try &#123;</span><br><span class="line">    result = await method(search);</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    debugWarn(error as Error);</span><br><span class="line">    debugWarn(COMPONENT_NAME, &quot;callRemoteMethod error&quot;);</span><br><span class="line">    result = [];</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    selectStates.loading = false;</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function genFilterOptions(search: string) &#123;</span><br><span class="line">  if (!props.filterable) return;</span><br><span class="line"></span><br><span class="line">  if (props.remote &amp;&amp; props.remoteMethod &amp;&amp; isFunction(props.remoteMethod)) &#123;</span><br><span class="line">    filteredOptions.value = await callRemoteMethod(props.remoteMethod, search);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (props.filterMethod &amp;&amp; isFunction(props.filterMethod)) &#123;</span><br><span class="line">    filteredOptions.value = props.filterMethod(search);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  filteredOptions.value = filter(props.options, (opt) =&gt;</span><br><span class="line">    includes(opt.label, search)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function genFilterChilds(search: string) &#123;</span><br><span class="line">  if (!props.filterable) return;</span><br><span class="line"></span><br><span class="line">  if (props.remote &amp;&amp; props.remoteMethod &amp;&amp; isFunction(props.remoteMethod)) &#123;</span><br><span class="line">    await callRemoteMethod(props.remoteMethod, search);</span><br><span class="line">    setFilteredChilds(childrenOptsions.value);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  if (props.filterMethod &amp;&amp; isFunction(props.filterMethod)) &#123;</span><br><span class="line">    const options = map(props.filterMethod(search), &quot;value&quot;);</span><br><span class="line">    setFilteredChilds(</span><br><span class="line">      filter(childrenOptsions.value, (item) =&gt;</span><br><span class="line">        includes(options, get(item, [&quot;props&quot;, &quot;value&quot;]))</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  setFilteredChilds(</span><br><span class="line">    filter(childrenOptsions.value, (item) =&gt;</span><br><span class="line">      includes(get(item, [&quot;props&quot;, &quot;label&quot;]), search)</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleFilter() &#123;</span><br><span class="line">  const searchKey = selectStates.inputValue;</span><br><span class="line">  selectStates.highlightedIndex = -1;</span><br><span class="line"></span><br><span class="line">  if (hasChildren.value) &#123;</span><br><span class="line">    genFilterChilds(searchKey);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  genFilterOptions(searchKey);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleKeyDown(e: KeyboardEvent) &#123;</span><br><span class="line">  keyMap.has(e.key) &amp;&amp; keyMap.get(e.key)?.(e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.options,</span><br><span class="line">  (newOpts) =&gt; &#123;</span><br><span class="line">    filteredOptions.value = newOpts ?? [];</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; childrenOptsions.value,</span><br><span class="line">  (newOpts) =&gt; setFilteredChilds(newOpts),</span><br><span class="line">  &#123; immediate: true &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.modelValue,</span><br><span class="line">  (newVal, oldVal) =&gt; &#123;</span><br><span class="line">    if (newVal !== oldVal) &#123;</span><br><span class="line">      formItem?.validate(&quot;change&quot;).catch((err) =&gt; debugWarn(err));</span><br><span class="line">    &#125;</span><br><span class="line">    setSelected();</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  setSelected();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">provide&lt;SelectContext&gt;(SELECT_CTX_KEY, &#123;</span><br><span class="line">  handleSelect,</span><br><span class="line">  selectStates,</span><br><span class="line">  renderLabel,</span><br><span class="line">  highlightedLine,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;SelectInstance&gt;(&#123;</span><br><span class="line">  focus,</span><br><span class="line">  blur,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    ref=&quot;selectRef&quot;</span><br><span class="line">    class=&quot;er-select&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      &#x27;is-disabled&#x27;: isDisabled,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">    @click.stop=&quot;toggleVisible&quot;</span><br><span class="line">    @mouseenter=&quot;selectStates.mouseHover = true&quot;</span><br><span class="line">    @mouseleave=&quot;selectStates.mouseHover = false&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;er-tooltip</span><br><span class="line">      ref=&quot;tooltipRef&quot;</span><br><span class="line">      placement=&quot;bottom-start&quot;</span><br><span class="line">      :popper-options=&quot;POPPER_OPTIONS&quot;</span><br><span class="line">      @click-outside=&quot;controlVisible(false)&quot;</span><br><span class="line">      manual</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template #default&gt;</span><br><span class="line">        &lt;div ref=&quot;inputWrapperRef&quot;&gt;</span><br><span class="line">          &lt;er-input</span><br><span class="line">            ref=&quot;inputRef&quot;</span><br><span class="line">            v-model=&quot;selectStates.inputValue&quot;</span><br><span class="line">            :id=&quot;inputId&quot;</span><br><span class="line">            :disabled=&quot;isDisabled&quot;</span><br><span class="line">            :placeholder=&quot;filterable ? filterPlaceholder : placeholder&quot;</span><br><span class="line">            :readonly=&quot;!filterable || !isDropdownVisible&quot;</span><br><span class="line">            @focus=&quot;handleFocus&quot;</span><br><span class="line">            @blur=&quot;handleBlur&quot;</span><br><span class="line">            @input=&quot;handleFilterDebounce&quot;</span><br><span class="line">            @keydown=&quot;handleKeyDown&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;template #suffix&gt;</span><br><span class="line">              &lt;er-icon</span><br><span class="line">                v-if=&quot;showClear&quot;</span><br><span class="line">                icon=&quot;circle-xmark&quot;</span><br><span class="line">                class=&quot;er-input__clear&quot;</span><br><span class="line">                @click.stop=&quot;handleClear&quot;</span><br><span class="line">                @mousedown.prevent=&quot;noop&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">              &lt;er-icon</span><br><span class="line">                v-else</span><br><span class="line">                class=&quot;header-angle&quot;</span><br><span class="line">                icon=&quot;angle-down&quot;</span><br><span class="line">                :class=&quot;&#123; &#x27;is-active&#x27;: isDropdownVisible &#125;&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/er-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">      &lt;template #content&gt;</span><br><span class="line">        &lt;div class=&quot;er-select__loading&quot; v-if=&quot;selectStates.loading&quot;&gt;</span><br><span class="line">          &lt;er-icon icon=&quot;spinner&quot; spin /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;er-select__nodata&quot; v-else-if=&quot;filterable &amp;&amp; isNoData&quot;&gt;</span><br><span class="line">          No data</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;ul class=&quot;er-select__menu&quot; v-else&gt;</span><br><span class="line">          &lt;template v-if=&quot;!hasChildren&quot;&gt;</span><br><span class="line">            &lt;er-option</span><br><span class="line">              v-for=&quot;item in filteredOptions&quot;</span><br><span class="line">              :key=&quot;item.value&quot;</span><br><span class="line">              v-bind=&quot;item&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">          &lt;template v-else&gt;</span><br><span class="line">            &lt;template</span><br><span class="line">              v-for=&quot;[vNode, _props] in filteredChilds&quot;</span><br><span class="line">              :key=&quot;_props.value&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;render-vnode :vNode=&quot;vNode&quot; /&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/er-tooltip&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-12"><a href="#â”œâ”€-style-css-12" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-select</span> &#123;</span><br><span class="line">  <span class="attr">--er-select-item-hover-bg-color</span>: <span class="built_in">var</span>(--er-fill-color-light);</span><br><span class="line">  <span class="attr">--er-select-item-font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">  <span class="attr">--er-select-item-font-color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">  <span class="attr">--er-select-item-selected-font-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">  <span class="attr">--er-select-item-disabled-font-color</span>: <span class="built_in">var</span>(--er-text-color-placeholder);</span><br><span class="line">  <span class="attr">--er-select-input-focus-border-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-select</span>&#123;</span><br><span class="line"> <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">32px</span>;</span><br><span class="line">  :<span class="built_in">deep</span>(.er-tooltip__popper) &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  :<span class="built_in">deep</span>(.er-input)&#123;</span><br><span class="line">    <span class="selector-class">.header-angle</span> &#123;</span><br><span class="line">      <span class="attribute">transition</span>: transform <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">      &amp;<span class="selector-class">.is-active</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">180deg</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-select__nodata</span>, <span class="selector-class">.er-select__loading</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-text-color-secondary);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-select-font-size);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-select__menu</span> &#123;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">6px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-select__menu-item</span> &#123; </span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-select-item-font-size);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">32px</span> <span class="number">0</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-select-item-font-color);</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">34px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">34px</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-select-item-hover-bg-color);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.is-selected</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-select-item-selected-font-color);</span><br><span class="line">      <span class="attribute">font-weight</span>: <span class="number">700</span>;    </span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.is-highlighted</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-select-item-hover-bg-color);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.is-disabled</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-select-item-disabled-font-color);</span><br><span class="line">      <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">      &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">        <span class="attribute">background-color</span>: transparent;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  :<span class="built_in">deep</span>(.er-input__inner) &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-types-ts"><a href="#â”œâ”€-types-ts" class="headerlink" title="â”œâ”€ types.ts"></a>â”œâ”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">VNode</span>, <span class="title class_">ComputedRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">RenderLabelFunc</span> = <span class="function">(<span class="params"><span class="attr">option</span>: <span class="title class_">SelectOptionProps</span></span>) =&gt;</span> <span class="title class_">VNode</span> | <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CustomFilterFunc</span> = <span class="function">(<span class="params"><span class="attr">value</span>: <span class="built_in">string</span></span>) =&gt;</span> <span class="title class_">SelectOptionProps</span>[];</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CustomFilterRemoteFunc</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">value</span>: <span class="built_in">string</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="title class_">SelectOptionProps</span>[] | <span class="built_in">void</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SelectOptionProps</span> &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">label</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SelectProps</span> &#123;</span><br><span class="line">  <span class="attr">modelValue</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">id</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">options</span>?: <span class="title class_">SelectOptionProps</span>[];</span><br><span class="line">  <span class="attr">placeholder</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">clearable</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">renderLabel</span>?: <span class="title class_">RenderLabelFunc</span>;</span><br><span class="line">  <span class="attr">filterable</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">filterMethod</span>?: <span class="title class_">CustomFilterFunc</span>;</span><br><span class="line">  <span class="attr">remote</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">remoteMethod</span>?: <span class="title class_">CustomFilterRemoteFunc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SelectStates</span> &#123;</span><br><span class="line">  <span class="attr">inputValue</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">selectedOption</span>: <span class="title class_">SelectOptionProps</span> | <span class="built_in">void</span> | <span class="literal">null</span>;</span><br><span class="line">  <span class="attr">mouseHover</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">loading</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">highlightedIndex</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SelectEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;update:modelValue&quot;</span>, <span class="attr">value</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;change&quot;</span>, <span class="attr">value</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;visible-change&quot;</span>, <span class="attr">vlaue</span>: <span class="built_in">boolean</span>): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;clear&quot;</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;focus&quot;</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;blur&quot;</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SelectContext</span> &#123;</span><br><span class="line">  <span class="attr">selectStates</span>: <span class="title class_">SelectStates</span>;</span><br><span class="line">  <span class="attr">renderLabel</span>?: <span class="title class_">RenderLabelFunc</span>;</span><br><span class="line">  <span class="attr">highlightedLine</span>?: <span class="title class_">ComputedRef</span>&lt;<span class="title class_">SelectOptionProps</span> | <span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="title function_">handleSelect</span>(<span class="attr">item</span>: <span class="title class_">SelectOptionProps</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SelectInstance</span> &#123;</span><br><span class="line">  <span class="title function_">focus</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">blur</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-useKeyMap-ts"><a href="#â””â”€-useKeyMap-ts" class="headerlink" title="â””â”€ useKeyMap.ts"></a>â””â”€ useKeyMap.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Ref</span>, <span class="title class_">ComputedRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">SelectOptionProps</span>, <span class="title class_">SelectStates</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">KeyMapParams</span> &#123;</span><br><span class="line">  <span class="attr">isDropdownVisible</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">  <span class="attr">highlightedLine</span>: <span class="title class_">ComputedRef</span>&lt;<span class="title class_">SelectOptionProps</span> | <span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="attr">hasData</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">  <span class="attr">lastIndex</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line">  <span class="attr">selectStates</span>: <span class="title class_">SelectStates</span>;</span><br><span class="line">  <span class="title function_">controlVisible</span>(<span class="attr">visible</span>: <span class="built_in">boolean</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">handleSelect</span>(<span class="attr">option</span>: <span class="title class_">SelectOptionProps</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useKeyMap</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  isDropdownVisible,</span></span><br><span class="line"><span class="params">  controlVisible,</span></span><br><span class="line"><span class="params">  selectStates,</span></span><br><span class="line"><span class="params">  highlightedLine,</span></span><br><span class="line"><span class="params">  handleSelect,</span></span><br><span class="line"><span class="params">  hasData,</span></span><br><span class="line"><span class="params">  lastIndex,</span></span><br><span class="line"><span class="params">&#125;: <span class="title class_">KeyMapParams</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">keyMap</span>: <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">Function</span>&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">  keyMap.<span class="title function_">set</span>(<span class="string">&quot;Enter&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isDropdownVisible.<span class="property">value</span>) &#123;</span><br><span class="line">      <span class="title function_">controlVisible</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (selectStates.<span class="property">highlightedIndex</span> &gt;= <span class="number">0</span> &amp;&amp; highlightedLine.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="title function_">handleSelect</span>(highlightedLine.<span class="property">value</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">controlVisible</span>(<span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  keyMap.<span class="title function_">set</span>(</span><br><span class="line">    <span class="string">&quot;Escape&quot;</span>,</span><br><span class="line">    <span class="function">() =&gt;</span> isDropdownVisible.<span class="property">value</span> &amp;&amp; <span class="title function_">controlVisible</span>(!isDropdownVisible.<span class="property">value</span>)</span><br><span class="line">  );</span><br><span class="line">  keyMap.<span class="title function_">set</span>(<span class="string">&quot;ArrowUp&quot;</span>, <span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">KeyboardEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="keyword">if</span> (!hasData.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      selectStates.<span class="property">highlightedIndex</span> === -<span class="number">1</span> ||</span><br><span class="line">      selectStates.<span class="property">highlightedIndex</span> === <span class="number">0</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      selectStates.<span class="property">highlightedIndex</span> = lastIndex.<span class="property">value</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    selectStates.<span class="property">highlightedIndex</span>--;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  keyMap.<span class="title function_">set</span>(<span class="string">&quot;ArrowDown&quot;</span>, <span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">KeyboardEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="keyword">if</span> (!hasData.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      selectStates.<span class="property">highlightedIndex</span> === -<span class="number">1</span> ||</span><br><span class="line">      selectStates.<span class="property">highlightedIndex</span> === lastIndex.<span class="property">value</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      selectStates.<span class="property">highlightedIndex</span> = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    selectStates.<span class="property">highlightedIndex</span>++;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> keyMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Switch"><a href="#â”œâ”€-Switch" class="headerlink" title="â”œâ”€ Switch"></a>â”œâ”€ Switch</h3><blockquote><p>å¼€å…³ç»„ä»¶ï¼Œç”¨äºåœ¨ä¸¤ç§çŠ¶æ€ä¹‹é—´åˆ‡æ¢</p></blockquote><h4 id="â€“APIâ€“-14"><a href="#â€“APIâ€“-14" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-index-ts-15"><a href="#â”œâ”€-index-ts-15" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Switch</span> <span class="keyword">from</span> <span class="string">&quot;./Switch.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErSwitch</span> = <span class="title function_">withInstall</span>(<span class="title class_">Switch</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-13"><a href="#â”œâ”€-style-css-13" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-switch</span> &#123;</span><br><span class="line">  <span class="attr">--er-switch-on-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">  <span class="attr">--er-switch-off-color</span>: <span class="built_in">var</span>(--er-border-color);</span><br><span class="line">  <span class="attr">--er-switch-on-border-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">  <span class="attr">--er-switch-off-border-color</span>: <span class="built_in">var</span>(--er-border-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-switch</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="selector-class">.er-switch__input</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    &amp;<span class="selector-pseudo">:focus-visible</span>&#123;</span><br><span class="line">      &amp; ~ <span class="selector-class">.er-switch__core</span>&#123;</span><br><span class="line">        <span class="attribute">outline</span>: <span class="number">2px</span> solid <span class="built_in">var</span>(--er-switch-on-color);</span><br><span class="line">        <span class="attribute">outline-offset</span>: <span class="number">1px</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-disabled</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: .<span class="number">6</span>;</span><br><span class="line">    <span class="selector-class">.er-switch__core</span> &#123;</span><br><span class="line">      <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-checked</span>&#123;</span><br><span class="line">    <span class="selector-class">.er-switch__core</span>&#123;</span><br><span class="line">      <span class="attribute">border-color</span>: <span class="built_in">var</span>(--er-switch-on-border-color);</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-switch-on-color);</span><br><span class="line">      <span class="selector-class">.er-switch__core-action</span>&#123;</span><br><span class="line">        <span class="attribute">left</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">17px</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="selector-class">.er-switch__core-inner</span> &#123;</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">18px</span> <span class="number">0</span> <span class="number">4px</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-switch--large</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="selector-class">.er-switch__core</span> &#123;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">24px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="selector-class">.er-switch__core-action</span> &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">20px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-checked</span> &#123;</span><br><span class="line">    <span class="selector-class">.er-switch__core</span> <span class="selector-class">.er-switch__core-action</span> &#123;</span><br><span class="line">      <span class="attribute">left</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">21px</span>);</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-switch-on-color);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-switch--small</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="selector-class">.er-switch__core</span> &#123;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="selector-class">.er-switch__core-action</span> &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">12px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">12px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-checked</span> &#123;</span><br><span class="line">    <span class="selector-class">.er-switch__core</span> <span class="selector-class">.er-switch-core-action</span> &#123;</span><br><span class="line">      <span class="attribute">left</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">13px</span>);</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-switch-on-color);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-switch__core</span>&#123;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="built_in">var</span>(--er-switch-off-border-color);</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--er-switch-off-color);</span><br><span class="line">  <span class="attribute">transition</span>: border-color <span class="built_in">var</span>(--er-transition-duration),background-color <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  <span class="selector-class">.er-switch__core-action</span>&#123;</span><br><span class="line">     <span class="attribute">position</span>: absolute;</span><br><span class="line">     <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-border-radius-circle);</span><br><span class="line">     <span class="attribute">left</span>: <span class="number">1px</span>;</span><br><span class="line">     <span class="attribute">width</span>: <span class="number">16px</span>;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">16px</span>;</span><br><span class="line">     <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-color-white);</span><br><span class="line">     <span class="attribute">transition</span>: all <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-switch__core-inner</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">0</span> <span class="number">18px</span>;</span><br><span class="line">    <span class="selector-class">.er-switch__core-inner-text</span>&#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-white);</span><br><span class="line">      <span class="attribute">user-select</span>: none;</span><br><span class="line">      <span class="attribute">overflow</span>: hidden;</span><br><span class="line">      <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">      <span class="attribute">white-space</span>: nowrap;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Switch-test-tsx"><a href="#â”œâ”€-Switch-test-tsx" class="headerlink" title="â”œâ”€ Switch.test.tsx"></a>â”œâ”€ Switch.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, expect &#125; <span class="keyword">from</span> <span class="string">&#x27;vitest&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/test-utils&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Switch</span> <span class="keyword">from</span> <span class="string">&#x27;./Switch.vue&#x27;</span>; <span class="comment">// ç¡®ä¿è¿™æ˜¯ä½ çš„ Switch ç»„ä»¶çš„è·¯å¾„</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;Switch.vue&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should render correctly with default props&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Switch</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&#x27;.er-switch&#x27;</span>)).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should handle click event and toggle the checked state&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Switch</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">trigger</span>(<span class="string">&#x27;click&#x27;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()[<span class="string">&#x27;update:modelValue&#x27;</span>][<span class="number">0</span>]).<span class="title function_">toEqual</span>([<span class="literal">true</span>]);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()[<span class="string">&#x27;change&#x27;</span>][<span class="number">0</span>]).<span class="title function_">toEqual</span>([<span class="literal">true</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">trigger</span>(<span class="string">&#x27;click&#x27;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()[<span class="string">&#x27;update:modelValue&#x27;</span>][<span class="number">1</span>]).<span class="title function_">toEqual</span>([<span class="literal">false</span>]);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()[<span class="string">&#x27;change&#x27;</span>][<span class="number">1</span>]).<span class="title function_">toEqual</span>([<span class="literal">false</span>]);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should not toggle when disabled&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Switch</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">disabled</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">trigger</span>(<span class="string">&#x27;click&#x27;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="property">not</span>.<span class="title function_">toHaveProperty</span>(<span class="string">&#x27;update:modelValue&#x27;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="property">not</span>.<span class="title function_">toHaveProperty</span>(<span class="string">&#x27;change&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Switch-vue"><a href="#â”œâ”€-Switch-vue" class="headerlink" title="â”œâ”€ Switch.vue"></a>â”œâ”€ Switch.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, computed, onMounted, watch &#125; from &quot;vue&quot;;</span><br><span class="line">import type &#123; SwitchEmits, SwitchProps, SwitchInstance &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; debugWarn &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import &#123; useFormItem, useFormDisabled, useFormItemInputId &#125; from &quot;../Form&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123; name: &quot;ErSwitch&quot;, inheritAttrs: false &#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;SwitchProps&gt;(), &#123;</span><br><span class="line">  activeValue: true,</span><br><span class="line">  inactiveValue: false,</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;SwitchEmits&gt;();</span><br><span class="line">const isDisabled = useFormDisabled();</span><br><span class="line">const &#123; formItem &#125; = useFormItem();</span><br><span class="line">const &#123; inputId &#125; = useFormItemInputId(props, formItem);</span><br><span class="line"></span><br><span class="line">const innerValue = ref(props.modelValue);</span><br><span class="line">const inputRef = ref&lt;HTMLInputElement | null&gt;(null);</span><br><span class="line">const checked = computed(() =&gt; innerValue.value === props.activeValue);</span><br><span class="line"></span><br><span class="line">const focus: SwitchInstance[&quot;focus&quot;] = function () &#123;</span><br><span class="line">  inputRef.value?.focus();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function handleChange() &#123;</span><br><span class="line">  if (isDisabled.value) return;</span><br><span class="line"></span><br><span class="line">  const newVal = checked.value ? props.inactiveValue : props.activeValue;</span><br><span class="line"></span><br><span class="line">  innerValue.value = newVal;</span><br><span class="line">  emits(&quot;update:modelValue&quot;, newVal);</span><br><span class="line">  emits(&quot;change&quot;, newVal);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  inputRef.value!.checked = checked.value;</span><br><span class="line">&#125;);</span><br><span class="line">watch(checked, (val) =&gt; &#123;</span><br><span class="line">  inputRef.value!.checked = val;</span><br><span class="line">  formItem?.validate(&quot;change&quot;).catch((err) =&gt; debugWarn(err));</span><br><span class="line">&#125;);</span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.modelValue,</span><br><span class="line">  (val) =&gt; (innerValue.value = val)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;SwitchInstance&gt;(&#123;</span><br><span class="line">  focus,</span><br><span class="line">  checked,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;er-switch&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      [`er-switch--$&#123;size&#125;`]: size,</span><br><span class="line">      &#x27;is-disabled&#x27;: isDisabled,</span><br><span class="line">      &#x27;is-checked&#x27;: checked,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">    @click=&quot;handleChange&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;input</span><br><span class="line">      class=&quot;er-switch__input&quot;</span><br><span class="line">      type=&quot;checkbox&quot;</span><br><span class="line">      role=&quot;switch&quot;</span><br><span class="line">      ref=&quot;inputRef&quot;</span><br><span class="line">      :id=&quot;inputId&quot;</span><br><span class="line">      :name=&quot;name&quot;</span><br><span class="line">      :disabled=&quot;isDisabled&quot;</span><br><span class="line">      :checked=&quot;checked&quot;</span><br><span class="line">      @keydown.enter=&quot;handleChange&quot;</span><br><span class="line">      @blur=&quot;formItem?.validate(&#x27;blur&#x27;).catch((err) =&gt; debugWarn(err))&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;div class=&quot;er-switch__core&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;er-switch__core-inner&quot;&gt;</span><br><span class="line">        &lt;span</span><br><span class="line">          v-if=&quot;activeText || inactiveText&quot;</span><br><span class="line">          class=&quot;er-switch__core-inner-text&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;&#123; checked ? activeText : inactiveText &#125;&#125;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;er-switch__core-action&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-types-ts-14"><a href="#â””â”€-types-ts-14" class="headerlink" title="â””â”€ types.ts"></a>â””â”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ComputedRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">SwitchValueType</span> = <span class="built_in">boolean</span> | <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SwitchProps</span> &#123;</span><br><span class="line">  <span class="attr">modelValue</span>: <span class="title class_">SwitchValueType</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">activeText</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">inactiveText</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">activeValue</span>?: <span class="title class_">SwitchValueType</span>;</span><br><span class="line">  <span class="attr">inactiveValue</span>?: <span class="title class_">SwitchValueType</span>;</span><br><span class="line">  <span class="attr">name</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">id</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">size</span>?: <span class="string">&quot;small&quot;</span> | <span class="string">&quot;large&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SwitchEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;update:modelValue&quot;</span>, <span class="attr">value</span>: <span class="title class_">SwitchValueType</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;change&quot;</span>, <span class="attr">value</span>: <span class="title class_">SwitchValueType</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SwitchInstance</span> &#123;</span><br><span class="line">  <span class="title function_">focus</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="attr">checked</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Tooltip"><a href="#â”œâ”€-Tooltip" class="headerlink" title="â”œâ”€ Tooltip"></a>â”œâ”€ Tooltip</h3><blockquote><p>hoveræ–‡å­—æç¤º, æ˜¾ç¤ºé¢å¤–çš„ä¿¡æ¯</p></blockquote><h4 id="â€“APIâ€“-15"><a href="#â€“APIâ€“-15" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-index-ts-16"><a href="#â”œâ”€-index-ts-16" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Tooltip</span> <span class="keyword">from</span> <span class="string">&quot;./Tooltip.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErTooltip</span> = <span class="title function_">withInstall</span>(<span class="title class_">Tooltip</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-style-css-14"><a href="#â”œâ”€-style-css-14" class="headerlink" title="â”œâ”€ style.css"></a>â”œâ”€ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-tooltip</span> &#123;</span><br><span class="line">  <span class="attr">--er-popover-bg-color</span>: <span class="built_in">var</span>(--er-bg-color-overlay);</span><br><span class="line">  <span class="attr">--er-popover-font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">  <span class="attr">--er-popover-border-color</span>: <span class="built_in">var</span>(--er-border-color-lighter);</span><br><span class="line">  <span class="attr">--er-popover-padding</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attr">--er-popover-border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-tooltip</span> &#123;</span><br><span class="line">  <span class="selector-class">.fade-enter-active</span>,</span><br><span class="line">  <span class="selector-class">.fade-leave-active</span> &#123;</span><br><span class="line">    <span class="attribute">transition</span>: opacity <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.fade-enter-from</span>,</span><br><span class="line">  <span class="selector-class">.fade-leave-to</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-tooltip__popper</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--er-popover-bg-color);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-popover-border-radius);</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="built_in">var</span>(--er-popover-padding);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.4</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: justify;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-popover-font-size);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--er-box-shadow-light);</span><br><span class="line">    <span class="attribute">word-break</span>: break-all;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">1000</span>;</span><br><span class="line">    <span class="selector-id">#arrow</span>,</span><br><span class="line">    <span class="selector-id">#arrow</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">      <span class="attribute">position</span>: absolute;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">8px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">8px</span>;</span><br><span class="line">      <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">      <span class="attribute">background</span>: <span class="built_in">var</span>(--er-popover-bg-color);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#arrow</span> &#123;</span><br><span class="line">      <span class="attribute">visibility</span>: hidden;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#arrow</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">      <span class="attribute">visibility</span>: visible;</span><br><span class="line">      <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;top&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span> &#123;</span><br><span class="line">      <span class="attribute">bottom</span>: -<span class="number">5px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;bottom&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span> &#123;</span><br><span class="line">      <span class="attribute">top</span>: -<span class="number">5px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;left&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span> &#123;</span><br><span class="line">      <span class="attribute">right</span>: -<span class="number">5px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;right&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span> &#123;</span><br><span class="line">      <span class="attribute">left</span>: -<span class="number">5px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;top&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">      <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">      <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;bottom&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">      <span class="attribute">border-left</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">      <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;left&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">      <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">      <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;right&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">      <span class="attribute">border-left</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">      <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Tooltip-test-tsx"><a href="#â”œâ”€-Tooltip-test-tsx" class="headerlink" title="â”œâ”€ Tooltip.test.tsx"></a>â”œâ”€ Tooltip.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, test,it, expect, vi, beforeEach &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ErTooltip</span> &#125; <span class="keyword">from</span> <span class="string">&quot;.&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Tooltip</span> <span class="keyword">from</span> <span class="string">&quot;./Tooltip.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line">vi.<span class="title function_">mock</span>(<span class="string">&quot;@popperjs/core&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> onVisibleChange = vi.<span class="title function_">fn</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Tooltip/index.ts&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æµ‹è¯• withInstall å‡½æ•°æ˜¯å¦è¢«æ­£ç¡®åº”ç”¨</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should be exported with withInstall()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErTooltip</span>.<span class="property">install</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æµ‹è¯• Tooltip ç»„ä»¶æ˜¯å¦è¢«æ­£ç¡®å¯¼å‡º</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should be exported Tooltip component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErTooltip</span>).<span class="title function_">toBe</span>(<span class="title class_">Tooltip</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯é€‰ï¼šæµ‹è¯• withInstall æ˜¯å¦å¢å¼ºäº† Tooltip ç»„ä»¶çš„åŠŸèƒ½</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;should enhance Tooltip component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> enhancedTooltip = <span class="title function_">withInstall</span>(<span class="title class_">Tooltip</span>);</span><br><span class="line">    <span class="title function_">expect</span>(enhancedTooltip).<span class="title function_">toBe</span>(<span class="title class_">ErTooltip</span>);</span><br><span class="line">    <span class="comment">// è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šæµ‹è¯•ï¼Œç¡®ä¿ withInstall å¢å¼ºäº†ç»„ä»¶çš„ç‰¹å®šåŠŸèƒ½</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯é€‰ï¼šå¦‚æœä½ çš„ withInstall å‡½æ•°æœ‰ç‰¹å®šçš„è¡Œä¸ºæˆ–å±æ€§ï¼Œç¡®ä¿å®ƒä»¬è¢«æ­£ç¡®åº”ç”¨</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;should apply specific enhancements&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> enhancedTooltip = <span class="title function_">withInstall</span>(<span class="title class_">Tooltip</span>);</span><br><span class="line">    <span class="comment">// ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ withInstall å¢åŠ äº†ä¸€ä¸ªç‰¹å®šçš„æ–¹æ³•æˆ–å±æ€§</span></span><br><span class="line">    <span class="title function_">expect</span>(enhancedTooltip).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;install&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Tooltip.vue&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    vi.<span class="title function_">useFakeTimers</span>();</span><br><span class="line">    vi.<span class="title function_">clearAllMocks</span>()</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;basic tooltip&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;outside&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Tooltip</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">content</span>=<span class="string">&quot;hello tooltip&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">trigger</span>=<span class="string">&quot;click&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;<span class="attr">...</span>&#123; <span class="attr">onVisibleChange</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;trigger&quot;</span>&gt;</span>trigger<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Tooltip</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      ),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">attachTo</span>: <span class="variable language_">document</span>.<span class="property">body</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">const</span> triggerArea = wrapper.<span class="title function_">find</span>(<span class="string">&quot;#trigger&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(triggerArea.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼¹å‡ºå±‚æ˜¯å¦å‡ºç°</span></span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">get</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">text</span>()).<span class="title function_">toBe</span>(<span class="string">&quot;hello tooltip&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onVisibleChange).<span class="title function_">toHaveBeenCalledWith</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†æ¬¡ç‚¹å‡»</span></span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onVisibleChange).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…åŠ¨ç”»</span></span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line"></span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="comment">// åŒºåŸŸå¤–ç‚¹å‡»å…³é—­ tooltip</span></span><br><span class="line">    wrapper.<span class="title function_">get</span>(<span class="string">&quot;#outside&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onVisibleChange).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨é”€æµç¨‹</span></span><br><span class="line">    wrapper.<span class="title function_">unmount</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;tooltip with hover trigger&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶ä»–è®¾ç½®</span></span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Tooltip</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; <span class="attr">trigger</span>: <span class="string">&quot;hover&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;test&quot;</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// æµ‹è¯•æ‚¬åœæ˜¾ç¤º</span></span><br><span class="line">    wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__trigger&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;mouseenter&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="comment">// æµ‹è¯•æ‚¬å¤–éšè—</span></span><br><span class="line">    wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;mouseleave&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å³é”®èœå•è§¦å‘çš„æµ‹è¯•</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;tooltip with contextmenu trigger&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶ä»–è®¾ç½®</span></span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Tooltip</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; <span class="attr">trigger</span>: <span class="string">&quot;contextmenu&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;test&quot;</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// æµ‹è¯•å³é”®èœå•æ˜¾ç¤º</span></span><br><span class="line">    wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__trigger&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;contextmenu&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="comment">// æµ‹è¯•å³é”®èœå•éšè—ï¼ˆå¯ä»¥æ¨¡æ‹Ÿç‚¹å‡»å¤–éƒ¨åŒºåŸŸï¼‰</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ‰‹åŠ¨æ¨¡å¼çš„æµ‹è¯•</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;tooltip with manual trigger&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶ä»–è®¾ç½®</span></span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Tooltip</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; <span class="attr">manual</span>: <span class="literal">true</span>, <span class="attr">content</span>: <span class="string">&quot;test&quot;</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// æµ‹è¯•æ‰‹åŠ¨è§¦å‘æ˜¾ç¤ºå’Œéšè—</span></span><br><span class="line">    wrapper.<span class="property">vm</span>.<span class="title function_">show</span>(); <span class="comment">// å‡è®¾ show æ–¹æ³•å¯ä»¥é€šè¿‡æŸç§æ–¹å¼è®¿é—®</span></span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    wrapper.<span class="property">vm</span>.<span class="title function_">hide</span>();</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¦ç”¨çŠ¶æ€çš„æµ‹è¯•</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;disabled tooltip&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶ä»–è®¾ç½®</span></span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Tooltip</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; <span class="attr">disabled</span>: <span class="literal">true</span>, <span class="attr">content</span>: <span class="string">&quot;test&quot;</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// æµ‹è¯•ç¦ç”¨çŠ¶æ€ä¸‹ç‚¹å‡»ä¸ä¼šè§¦å‘æ˜¾ç¤º</span></span><br><span class="line">    wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__trigger&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è™šæ‹Ÿè§¦å‘èŠ‚ç‚¹çš„æµ‹è¯•</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;tooltip with virtual trigger node&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶ä»–è®¾ç½®</span></span><br><span class="line">    <span class="keyword">const</span> virtualRef = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Tooltip</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; virtualRef, <span class="attr">virtualTriggering</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// æµ‹è¯•è™šæ‹ŸèŠ‚ç‚¹çš„äº‹ä»¶è§¦å‘</span></span><br><span class="line">    virtualRef.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&quot;mouseenter&quot;</span>));</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Tooltip-vue"><a href="#â”œâ”€-Tooltip-vue" class="headerlink" title="â”œâ”€ Tooltip.vue"></a>â”œâ”€ Tooltip.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; createPopper, type Instance &#125; from &quot;@popperjs/core&quot;;</span><br><span class="line">import &#123; ref, watch, watchEffect, onUnmounted, computed, type Ref &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; bind, debounce, type DebouncedFunc &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123; useClickOutside &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line"></span><br><span class="line">import type &#123; TooltipProps, TooltipEmits, TooltipInstance &#125; from &quot;./types&quot;;</span><br><span class="line">import type &#123; ButtonInstance &#125; from &quot;../Button&quot;;</span><br><span class="line"></span><br><span class="line">import useEvenstToTiggerNode from &quot;./useEventsToTiggerNode&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErTooltip&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">interface _TooltipProps extends TooltipProps &#123;</span><br><span class="line">  virtualRef?: HTMLElement | ButtonInstance | void;</span><br><span class="line">  virtualTriggering?: boolean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const props = withDefaults(defineProps&lt;_TooltipProps&gt;(), &#123;</span><br><span class="line">  placement: &quot;bottom&quot;,</span><br><span class="line">  trigger: &quot;hover&quot;,</span><br><span class="line">  transition: &quot;fade&quot;,</span><br><span class="line">  showTimeout: 0,</span><br><span class="line">  hideTimeout: 200,</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;TooltipEmits&gt;();</span><br><span class="line">const visible = ref(false);</span><br><span class="line"></span><br><span class="line">const events: Ref&lt;Record&lt;string, EventListener&gt;&gt; = ref(&#123;&#125;);</span><br><span class="line">const outerEvents: Ref&lt;Record&lt;string, EventListener&gt;&gt; = ref(&#123;&#125;);</span><br><span class="line">const dropdownEvents: Ref&lt;Record&lt;string, EventListener&gt;&gt; = ref(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">const containerNode = ref&lt;HTMLElement&gt;();</span><br><span class="line">const popperNode = ref&lt;HTMLElement&gt;();</span><br><span class="line">const _triggerNode = ref&lt;HTMLElement&gt;();</span><br><span class="line"></span><br><span class="line">const triggerNode = computed(() =&gt; &#123;</span><br><span class="line">  if (props.virtualTriggering)</span><br><span class="line">    return (</span><br><span class="line">      // @tips any ä¸ºäº† fix ä¸€ä¸ªåˆå§‹è®¾è®¡ä¸Šçš„å°å¤±è¯¯ ï¼ˆåç»­é‡æ„ &quot;è™šæ‹Ÿç›®æ ‡èŠ‚ç‚¹&quot; æ—¶è§£å†³ï¼‰</span><br><span class="line">      ((props.virtualRef as ButtonInstance)?.ref as any) ??</span><br><span class="line">      (props.virtualRef as HTMLElement) ??</span><br><span class="line">      _triggerNode.value</span><br><span class="line">    );</span><br><span class="line">  return _triggerNode.value as HTMLElement;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const popperOptions = computed(() =&gt; (&#123;</span><br><span class="line">  placement: props.placement,</span><br><span class="line">  modifiers: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &quot;offset&quot;,</span><br><span class="line">      options: &#123;</span><br><span class="line">        offset: [0, 9],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  ...props.popperOptions,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">const openDelay = computed(() =&gt;</span><br><span class="line">  props.trigger === &quot;hover&quot; ? props.showTimeout : 0</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const closeDelay = computed(() =&gt;</span><br><span class="line">  props.trigger === &quot;hover&quot; ? props.hideTimeout : 0</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const triggerStrategyMap: Map&lt;string, () =&gt; void&gt; = new Map();</span><br><span class="line">triggerStrategyMap.set(&quot;hover&quot;, () =&gt; &#123;</span><br><span class="line">  events.value[&quot;mouseenter&quot;] = openFinal;</span><br><span class="line">  outerEvents.value[&quot;mouseleave&quot;] = closeFinal;</span><br><span class="line">  dropdownEvents.value[&quot;mouseenter&quot;] = openFinal;</span><br><span class="line">&#125;);</span><br><span class="line">triggerStrategyMap.set(&quot;click&quot;, () =&gt; &#123;</span><br><span class="line">  events.value[&quot;click&quot;] = togglePopper;</span><br><span class="line">&#125;);</span><br><span class="line">triggerStrategyMap.set(&quot;contextmenu&quot;, () =&gt; &#123;</span><br><span class="line">  events.value[&quot;contextmenu&quot;] = (e) =&gt; &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    openFinal();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">let openDebounce: DebouncedFunc&lt;() =&gt; void&gt; | void;</span><br><span class="line">let closeDebounce: DebouncedFunc&lt;() =&gt; void&gt; | void;</span><br><span class="line"></span><br><span class="line">function openFinal() &#123;</span><br><span class="line">  closeDebounce?.cancel();</span><br><span class="line">  openDebounce?.();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function closeFinal() &#123;</span><br><span class="line">  openDebounce?.cancel();</span><br><span class="line">  closeDebounce?.();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function togglePopper() &#123;</span><br><span class="line">  visible.value ? closeFinal() : openFinal();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function setVisible(val: boolean) &#123;</span><br><span class="line">  if (props.disabled) return;</span><br><span class="line">  visible.value = val;</span><br><span class="line">  emits(&quot;visible-change&quot;, val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function attachEvents() &#123;</span><br><span class="line">  if (props.disabled || props.manual) return;</span><br><span class="line">  triggerStrategyMap.get(props.trigger)?.();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let popperInstance: null | Instance;</span><br><span class="line">function destroyPopperInstance() &#123;</span><br><span class="line">  popperInstance?.destroy();</span><br><span class="line">  popperInstance = null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function resetEvents() &#123;</span><br><span class="line">  events.value = &#123;&#125;;</span><br><span class="line">  outerEvents.value = &#123;&#125;;</span><br><span class="line">  dropdownEvents.value = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  attachEvents();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (!props.manual) &#123;</span><br><span class="line">  attachEvents();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const show: TooltipInstance[&quot;show&quot;] = openFinal;</span><br><span class="line"></span><br><span class="line">const hide: TooltipInstance[&quot;hide&quot;] = function () &#123;</span><br><span class="line">  openDebounce?.cancel();</span><br><span class="line">  setVisible(false);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">useClickOutside(containerNode, () =&gt; &#123;</span><br><span class="line">  emits(&quot;click-outside&quot;);</span><br><span class="line">  if (props.trigger === &quot;hover&quot; || props.manual) return;</span><br><span class="line">  visible.value &amp;&amp; closeFinal();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  visible,</span><br><span class="line">  (val) =&gt; &#123;</span><br><span class="line">    if (!val) return;</span><br><span class="line"></span><br><span class="line">    if (triggerNode.value &amp;&amp; popperNode.value) &#123;</span><br><span class="line">      popperInstance = createPopper(</span><br><span class="line">        triggerNode.value,</span><br><span class="line">        popperNode.value,</span><br><span class="line">        popperOptions.value</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; flush: &quot;post&quot; &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.manual,</span><br><span class="line">  (isManual) =&gt; &#123;</span><br><span class="line">    if (isManual) &#123;</span><br><span class="line">      events.value = &#123;&#125;;</span><br><span class="line">      outerEvents.value = &#123;&#125;;</span><br><span class="line">      dropdownEvents.value = &#123;&#125;;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    attachEvents();</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.trigger,</span><br><span class="line">  (newTrigger, oldTrigger) =&gt; &#123;</span><br><span class="line">    if (newTrigger === oldTrigger) return;</span><br><span class="line">    resetEvents();</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.disabled,</span><br><span class="line">  (val, oldVal) =&gt; &#123;</span><br><span class="line">    if (val === oldVal) return;</span><br><span class="line">    openDebounce?.cancel();</span><br><span class="line">    visible.value = false;</span><br><span class="line">    emits(&quot;visible-change&quot;, false);</span><br><span class="line">    resetEvents();</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watchEffect(() =&gt; &#123;</span><br><span class="line">  openDebounce = debounce(bind(setVisible, null, true), openDelay.value);</span><br><span class="line">  closeDebounce = debounce(bind(setVisible, null, false), closeDelay.value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">useEvenstToTiggerNode(props, triggerNode, events, () =&gt; &#123;</span><br><span class="line">  openDebounce?.cancel();</span><br><span class="line">  setVisible(false);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">onUnmounted(() =&gt; &#123;</span><br><span class="line">  destroyPopperInstance();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;TooltipInstance&gt;(&#123;</span><br><span class="line">  show,</span><br><span class="line">  hide,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;er-tooltip&quot; ref=&quot;containerNode&quot; v-on=&quot;outerEvents&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;er-tooltip__trigger&quot;</span><br><span class="line">      ref=&quot;_triggerNode&quot;</span><br><span class="line">      v-on=&quot;events&quot;</span><br><span class="line">      v-if=&quot;!virtualTriggering&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;slot name=&quot;default&quot; v-else&gt;&lt;/slot&gt;</span><br><span class="line"></span><br><span class="line">    &lt;transition :name=&quot;transition&quot; @after-leave=&quot;destroyPopperInstance&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;er-tooltip__popper&quot;</span><br><span class="line">        ref=&quot;popperNode&quot;</span><br><span class="line">        v-on=&quot;dropdownEvents&quot;</span><br><span class="line">        v-if=&quot;visible&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;slot name=&quot;content&quot;&gt;</span><br><span class="line">          &#123;&#123; content &#125;&#125;</span><br><span class="line">        &lt;/slot&gt;</span><br><span class="line">        &lt;div id=&quot;arrow&quot; data-popper-arrow&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-types-ts-1"><a href="#â”œâ”€-types-ts-1" class="headerlink" title="â”œâ”€ types.ts"></a>â”œâ”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Placement</span>, <span class="title class_">Options</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@popperjs/core&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">TooltipProps</span> &#123;</span><br><span class="line">  <span class="attr">content</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">trigger</span>?: <span class="string">&quot;hover&quot;</span> | <span class="string">&quot;click&quot;</span> | <span class="string">&quot;contextmenu&quot;</span>;</span><br><span class="line">  <span class="attr">placement</span>?: <span class="title class_">Placement</span>;</span><br><span class="line">  <span class="attr">manual</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">popperOptions</span>?: <span class="title class_">Partial</span>&lt;<span class="title class_">Options</span>&gt;;</span><br><span class="line">  <span class="attr">transition</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">showTimeout</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">hideTimeout</span>?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">TooltipEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;visible-change&quot;</span>, <span class="attr">value</span>: <span class="built_in">boolean</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;click-outside&quot;</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">TooltipInstance</span> &#123;</span><br><span class="line">  <span class="title function_">show</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">hide</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-useEventsToTiggerNode-ts"><a href="#â””â”€-useEventsToTiggerNode-ts" class="headerlink" title="â””â”€ useEventsToTiggerNode.ts"></a>â””â”€ useEventsToTiggerNode.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; each, isElement &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; onMounted, onUnmounted, watch &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ComputedRef</span>, <span class="title class_">Ref</span>, <span class="title class_">WatchStopHandle</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">TooltipProps</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useEvenstToTiggerNode</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">props</span>: <span class="title class_">TooltipProps</span> &amp; &#123; virtualTriggering?: <span class="built_in">boolean</span> &#125;,</span></span><br><span class="line"><span class="params">  <span class="attr">triggerNode</span>: <span class="title class_">ComputedRef</span>&lt;<span class="title class_">HTMLElement</span> | <span class="literal">undefined</span>&gt;,</span></span><br><span class="line"><span class="params">  <span class="attr">events</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">EventListener</span>&gt;&gt;,</span></span><br><span class="line"><span class="params">  <span class="attr">closeMethod</span>: () =&gt; <span class="built_in">void</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">watchEventsStopHandle</span>: <span class="title class_">WatchStopHandle</span> | <span class="built_in">void</span>;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">watchTriggerNodeStopHandle</span>: <span class="title class_">WatchStopHandle</span> | <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> _eventHandleMap = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">_bindEventToVirtualTiggerNode</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> el = triggerNode.<span class="property">value</span>;</span><br><span class="line">    <span class="title function_">isElement</span>(el) &amp;&amp;</span><br><span class="line">      <span class="title function_">each</span>(events.<span class="property">value</span>, <span class="function">(<span class="params">fn, event</span>) =&gt;</span> &#123;</span><br><span class="line">        _eventHandleMap.<span class="title function_">set</span>(event, fn);</span><br><span class="line">        el?.<span class="title function_">addEventListener</span>(event <span class="keyword">as</span> keyof <span class="title class_">HTMLElementEventMap</span>, fn);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">_unbindEventToVirtualTiggerNode</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> el = triggerNode.<span class="property">value</span>;</span><br><span class="line">    <span class="title function_">isElement</span>(el) &amp;&amp;</span><br><span class="line">      <span class="title function_">each</span>(</span><br><span class="line">        [<span class="string">&quot;mouseenter&quot;</span>, <span class="string">&quot;click&quot;</span>, <span class="string">&quot;contextmenu&quot;</span>],</span><br><span class="line">        <span class="function">(<span class="params">key</span>) =&gt;</span></span><br><span class="line">          _eventHandleMap.<span class="title function_">has</span>(key) &amp;&amp;</span><br><span class="line">          el?.<span class="title function_">removeEventListener</span>(key, _eventHandleMap.<span class="title function_">get</span>(key))</span><br><span class="line">      );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    watchTriggerNodeStopHandle = <span class="title function_">watch</span>(</span><br><span class="line">      triggerNode,</span><br><span class="line">      <span class="function">() =&gt;</span> props.<span class="property">virtualTriggering</span> &amp;&amp; <span class="title function_">_bindEventToVirtualTiggerNode</span>(),</span><br><span class="line">      &#123; <span class="attr">immediate</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    watchEventsStopHandle = <span class="title function_">watch</span>(</span><br><span class="line">      events,</span><br><span class="line">      <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!props.<span class="property">virtualTriggering</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="title function_">_unbindEventToVirtualTiggerNode</span>();</span><br><span class="line">        <span class="title function_">_bindEventToVirtualTiggerNode</span>();</span><br><span class="line">        <span class="title function_">closeMethod</span>();</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    watchTriggerNodeStopHandle?.();</span><br><span class="line">    watchEventsStopHandle?.();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useEvenstToTiggerNode;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-Upload"><a href="#â”œâ”€-Upload" class="headerlink" title="â”œâ”€ Upload"></a>â”œâ”€ Upload</h3><blockquote><p>ä¸Šä¼ ç»„ä»¶ï¼Œç”¨äºä¸Šä¼ æ–‡ä»¶</p></blockquote><h4 id="â€“APIâ€“-16"><a href="#â€“APIâ€“-16" class="headerlink" title="â€“APIâ€“"></a>â€“APIâ€“</h4><h4 id="â”œâ”€-index-ts-17"><a href="#â”œâ”€-index-ts-17" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Upload</span> <span class="keyword">from</span> <span class="string">&quot;./Upload.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErUpload</span> = <span class="title function_">withInstall</span>(<span class="title class_">Upload</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-types-ts-2"><a href="#â”œâ”€-types-ts-2" class="headerlink" title="â”œâ”€ types.ts"></a>â”œâ”€ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">UploadFileStatus</span> = <span class="string">&quot;ready&quot;</span> | <span class="string">&quot;uploading&quot;</span> | <span class="string">&quot;success&quot;</span> | <span class="string">&quot;error&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">UploadFile</span> &#123;</span><br><span class="line">  <span class="attr">uid</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">size</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">status</span>?: <span class="title class_">UploadFileStatus</span>;</span><br><span class="line">  <span class="attr">percent</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">raw</span>?: <span class="title class_">File</span>;</span><br><span class="line">  <span class="attr">response</span>?: <span class="built_in">any</span>;</span><br><span class="line">  <span class="attr">error</span>?: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">UploadProps</span> &#123;</span><br><span class="line">  <span class="attr">action</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">defaultFileList</span>?: <span class="title class_">UploadFile</span>[];</span><br><span class="line">  beforeUpload?(<span class="attr">file</span>: <span class="title class_">File</span>): <span class="built_in">boolean</span> | <span class="title class_">Promise</span>&lt;<span class="title class_">File</span>&gt;;</span><br><span class="line">  onChange?(<span class="attr">file</span>: <span class="title class_">File</span>): <span class="built_in">void</span>;</span><br><span class="line">  onProgress?(<span class="attr">percentage</span>: <span class="built_in">number</span>, <span class="attr">file</span>: <span class="title class_">File</span>): <span class="built_in">void</span>;</span><br><span class="line">  onSuccess?(<span class="attr">data</span>: <span class="built_in">any</span>, <span class="attr">file</span>: <span class="title class_">File</span>): <span class="built_in">void</span>;</span><br><span class="line">  onError?(<span class="attr">err</span>: <span class="built_in">any</span>, <span class="attr">file</span>: <span class="title class_">File</span>): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  onRemove?(<span class="attr">file</span>: <span class="title class_">UploadFile</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">UploadListProps</span> &#123;</span><br><span class="line">  <span class="attr">fileList</span>: <span class="title class_">UploadFile</span>[];</span><br><span class="line">  onRemove?(<span class="attr">file</span>: <span class="title class_">UploadFile</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-Upload-vue"><a href="#â”œâ”€-Upload-vue" class="headerlink" title="â”œâ”€ Upload.vue"></a>â”œâ”€ Upload.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; UploadProps, UploadFile &#125; from &quot;./types&quot;;</span><br><span class="line">import ErButton from &quot;../Button/Button.vue&quot;;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; cloneDeep, each, isFunction &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import axios, &#123; type AxiosProgressEvent &#125; from &quot;axios&quot;;</span><br><span class="line">import &#123; useId &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import UploadList from &quot;./UploadList.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErUpload&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const props = defineProps&lt;UploadProps&gt;();</span><br><span class="line"></span><br><span class="line">const fileInputRef = ref&lt;HTMLInputElement&gt;();</span><br><span class="line">const fileList = ref&lt;UploadFile[]&gt;(props.defaultFileList ?? []);</span><br><span class="line"></span><br><span class="line">function setFileListItem(item: UploadFile) &#123;</span><br><span class="line">  const index = fileList.value.findIndex((file) =&gt; file.uid === item.uid);</span><br><span class="line">  if (index !== -1) &#123;</span><br><span class="line">    fileList.value.splice(index, 1, cloneDeep(item));</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    fileList.value.unshift(cloneDeep(item));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleClick() &#123;</span><br><span class="line">  fileInputRef.value?.click();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleFileChange(e: Event) &#123;</span><br><span class="line">  const files = (e.target as HTMLInputElement)?.files;</span><br><span class="line">  if (!files) return;</span><br><span class="line">  uploadFiles(files);</span><br><span class="line">  if (fileInputRef.value) &#123;</span><br><span class="line">    fileInputRef.value.value = &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function uploadFiles(files: FileList) &#123;</span><br><span class="line">  const postFiles = Array.from(files);</span><br><span class="line">  each(postFiles, (file) =&gt; &#123;</span><br><span class="line">    if (!props?.beforeUpload) &#123;</span><br><span class="line">      post(file);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      const result = props.beforeUpload(file);</span><br><span class="line">      if (result &amp;&amp; result instanceof Promise) &#123;</span><br><span class="line">        result.then((processFile) =&gt; &#123;</span><br><span class="line">          post(processFile);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; else if (result !== false) &#123;</span><br><span class="line">        post(file);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function post(file: File) &#123;</span><br><span class="line">  const _file: UploadFile = &#123;</span><br><span class="line">    uid: useId().value + &quot;_upload-file_&quot; + Date.now(),</span><br><span class="line">    status: &quot;ready&quot;,</span><br><span class="line">    name: file.name,</span><br><span class="line">    size: file.size,</span><br><span class="line">    percent: 0,</span><br><span class="line">    raw: file,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  setFileListItem(_file);</span><br><span class="line"></span><br><span class="line">  const formData = new FormData();</span><br><span class="line">  formData.append(file.name, file);</span><br><span class="line">  axios</span><br><span class="line">    .postForm(props.action, formData, &#123;</span><br><span class="line">      headers: &#123;</span><br><span class="line">        &quot;Content-Type&quot;: &quot;multipart/form-data&quot;,</span><br><span class="line">      &#125;,</span><br><span class="line">      onUploadProgress: (e: AxiosProgressEvent) =&gt; &#123;</span><br><span class="line">        let percent = Math.round((e.loaded * 100) / e.total!) || 0;</span><br><span class="line"></span><br><span class="line">        _file.percent = percent;</span><br><span class="line">        if (percent &lt; 100) &#123;</span><br><span class="line">          _file.status = &quot;uploading&quot;;</span><br><span class="line">          setFileListItem(_file);</span><br><span class="line">        &#125;</span><br><span class="line">        isFunction(props.onProgress) &amp;&amp; props.onProgress(percent, file);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    .then((resp: any) =&gt; &#123;</span><br><span class="line">      _file.status = &quot;success&quot;;</span><br><span class="line">      _file.response = resp.data;</span><br><span class="line">      isFunction(props.onSuccess) &amp;&amp; props.onSuccess(resp.data, file);</span><br><span class="line">      setFileListItem(_file);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch((err) =&gt; &#123;</span><br><span class="line">      _file.status = &quot;error&quot;;</span><br><span class="line">      isFunction(props.onError) &amp;&amp; props.onError(err, file);</span><br><span class="line">      setFileListItem(_file);</span><br><span class="line">    &#125;)</span><br><span class="line">    .finally(() =&gt; &#123;</span><br><span class="line">      isFunction(props.onChange) &amp;&amp; props.onChange(file);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleRemove(file: UploadFile) &#123;</span><br><span class="line">  fileList.value = fileList.value.filter((item) =&gt; item.uid !== file.uid);</span><br><span class="line">  isFunction(props.onRemove) &amp;&amp; props.onRemove(file);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;er-upload&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;er-upload__content&quot; @click=&quot;handleClick&quot;&gt;</span><br><span class="line">      &lt;slot&gt;</span><br><span class="line">        &lt;er-button type=&quot;primary&quot;&gt;Upload File&lt;/er-button&gt;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;input</span><br><span class="line">      ref=&quot;fileInputRef&quot;</span><br><span class="line">      class=&quot;er-file-input&quot;</span><br><span class="line">      type=&quot;file&quot;</span><br><span class="line">      @change=&quot;handleFileChange&quot;</span><br><span class="line">      style=&quot;display: none&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;upload-list :file-list=&quot;fileList&quot; :on-remove=&quot;handleRemove&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="â””â”€-UploadList-vue"><a href="#â””â”€-UploadList-vue" class="headerlink" title="â””â”€ UploadList.vue"></a>â””â”€ UploadList.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; UploadListProps &#125; from &quot;./types&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErUploadList&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">defineProps&lt;UploadListProps&gt;();</span><br><span class="line"></span><br><span class="line">const statusIconMap = new Map([</span><br><span class="line">  [&quot;success&quot;, &quot;check-circle&quot;],</span><br><span class="line">  [&quot;error&quot;, &quot;times-circle&quot;],</span><br><span class="line">  [&quot;uploading&quot;, &quot;spinner&quot;],</span><br><span class="line">]);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;ul class=&quot;er-upload-list&quot;&gt;</span><br><span class="line">    &lt;li v-for=&quot;item in fileList&quot; :key=&quot;item.uid&quot; class=&quot;er-upload-list__item&quot;&gt;</span><br><span class="line">      &lt;span class=&quot;file-name&quot; :class=&quot;&#123; [`file-name-$&#123;item.status&#125;`]: true &#125;&quot;&gt;</span><br><span class="line">        &lt;er-icon icon=&quot;file-alt&quot; /&gt;</span><br><span class="line">        &#123;&#123; item.name &#125;&#125;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      &lt;span</span><br><span class="line">        class=&quot;file-status&quot;</span><br><span class="line">        :class=&quot;&#123; [`file-status-$&#123;item.status&#125;`]: true &#125;&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;er-icon</span><br><span class="line">          :icon=&quot;statusIconMap.get(item.status || &#x27;&#x27;) ?? &#x27;&#x27;&quot;</span><br><span class="line">          :spin=&quot;item.status === &#x27;uploading&#x27;&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      &lt;span class=&quot;file-action&quot;&gt;</span><br><span class="line">        &lt;er-icon icon=&quot;times&quot; @click=&quot;onRemove?.(item)&quot; /&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.er-upload-list &#123;</span><br><span class="line">  margin: 0;</span><br><span class="line">  padding: 0;</span><br><span class="line">  list-style-type: none;</span><br><span class="line">  .er-upload-list__item &#123;</span><br><span class="line">    transition: all 0.5s cubic-bezier(0.55, 0, 0.1, 1);</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    line-height: 1.8;</span><br><span class="line">    margin-top: 5px;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">    min-width: 200px;</span><br><span class="line">    position: relative;</span><br><span class="line">    &amp;:first-child &#123;</span><br><span class="line">      margin-top: 10px;</span><br><span class="line">    &#125;</span><br><span class="line">    .file-name &#123;</span><br><span class="line">      margin-left: 5px;</span><br><span class="line">      margin-right: 40px;</span><br><span class="line">      color: var(--er-text-color-regular);</span><br><span class="line">      svg &#123;</span><br><span class="line">        margin-right: 5px;</span><br><span class="line">        color: var(--er-text-color-regular);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .file-name-error &#123;</span><br><span class="line">      color: var(--er-color-danger);</span><br><span class="line">    &#125;</span><br><span class="line">    .file-status-success &#123;</span><br><span class="line">      color: var(--er-color-success);</span><br><span class="line">    &#125;</span><br><span class="line">    .file-status-error &#123;</span><br><span class="line">      color: var(--er-color-danger);</span><br><span class="line">    &#125;</span><br><span class="line">    .file-status &#123;</span><br><span class="line">      display: block;</span><br><span class="line">      position: absolute;</span><br><span class="line">      right: 5px;</span><br><span class="line">      top: 0;</span><br><span class="line">      line-height: inherit;</span><br><span class="line">    &#125;</span><br><span class="line">    .file-action &#123;</span><br><span class="line">      display: none;</span><br><span class="line">      position: absolute;</span><br><span class="line">      right: 7px;</span><br><span class="line">      top: 0;</span><br><span class="line">      line-height: inherit;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;:hover &#123;</span><br><span class="line">      background-color: var(--er-fill-color-light);</span><br><span class="line">      .file-status &#123;</span><br><span class="line">        display: none;</span><br><span class="line">      &#125;</span><br><span class="line">      .file-action &#123;</span><br><span class="line">        display: block;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-index-test-ts"><a href="#â”œâ”€-index-test-ts" class="headerlink" title="â”œâ”€ index.test.ts"></a>â”œâ”€ index.test.ts</h3><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Plugin</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; describe, it, expect &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">ErAlert</span>,</span><br><span class="line">  <span class="title class_">ErButton</span>,</span><br><span class="line">  <span class="title class_">ErButtonGroup</span>,</span><br><span class="line">  <span class="title class_">ErCollapse</span>,</span><br><span class="line">  <span class="title class_">ErCollapseItem</span>,</span><br><span class="line">  <span class="title class_">ErDropdown</span>,</span><br><span class="line">  <span class="title class_">ErDropdownItem</span>,</span><br><span class="line">  <span class="title class_">ErForm</span>,</span><br><span class="line">  <span class="title class_">ErFormItem</span>,</span><br><span class="line">  <span class="title class_">ErIcon</span>,</span><br><span class="line">  <span class="title class_">ErInput</span>,</span><br><span class="line">  <span class="title class_">ErLoading</span>,</span><br><span class="line">  <span class="title class_">ErLoadingDirective</span>,</span><br><span class="line">  <span class="title class_">ErLoadingService</span>,</span><br><span class="line">  <span class="title class_">ErMessage</span>,</span><br><span class="line">  <span class="title class_">ErMessageBox</span>,</span><br><span class="line">  <span class="title class_">ErNotification</span>,</span><br><span class="line">  <span class="title class_">ErOption</span>,</span><br><span class="line">  <span class="title class_">ErPopconfirm</span>,</span><br><span class="line">  <span class="title class_">ErSelect</span>,</span><br><span class="line">  <span class="title class_">ErSwitch</span>,</span><br><span class="line">  <span class="title class_">ErTooltip</span>,</span><br><span class="line">  <span class="title class_">ErUpload</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./index&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; map, get &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> components = [</span><br><span class="line">  <span class="title class_">ErButton</span>,</span><br><span class="line">  <span class="title class_">ErButtonGroup</span>,</span><br><span class="line">  <span class="title class_">ErCollapse</span>,</span><br><span class="line">  <span class="title class_">ErCollapseItem</span>,</span><br><span class="line">  <span class="title class_">ErIcon</span>,</span><br><span class="line">  <span class="title class_">ErDropdown</span>,</span><br><span class="line">  <span class="title class_">ErDropdownItem</span>,</span><br><span class="line">  <span class="title class_">ErTooltip</span>,</span><br><span class="line">  <span class="title class_">ErMessage</span>,</span><br><span class="line">  <span class="title class_">ErInput</span>,</span><br><span class="line">  <span class="title class_">ErSwitch</span>,</span><br><span class="line">  <span class="title class_">ErSelect</span>,</span><br><span class="line">  <span class="title class_">ErOption</span>,</span><br><span class="line">  <span class="title class_">ErForm</span>,</span><br><span class="line">  <span class="title class_">ErFormItem</span>,</span><br><span class="line">  <span class="title class_">ErAlert</span>,</span><br><span class="line">  <span class="title class_">ErNotification</span>,</span><br><span class="line">  <span class="title class_">ErLoading</span>,</span><br><span class="line">  <span class="title class_">ErUpload</span>,</span><br><span class="line">  <span class="title class_">ErPopconfirm</span>,</span><br><span class="line">  <span class="title class_">ErMessageBox</span>,</span><br><span class="line">] <span class="keyword">as</span> <span class="title class_">Plugin</span>[];</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;components/index.ts&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it.<span class="title function_">each</span>(<span class="title function_">map</span>(components, <span class="function">(<span class="params">c</span>) =&gt;</span> [<span class="title function_">get</span>(c, <span class="string">&quot;name&quot;</span>) ?? <span class="string">&quot;&quot;</span>, c]))(<span class="string">&quot;%s should be exported&quot;</span>, <span class="function">(<span class="params">_, component</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(component).<span class="title function_">toBeDefined</span>();</span><br><span class="line">    <span class="title function_">expect</span>(component.<span class="property">install</span>).<span class="title function_">toBeDefined</span>()</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;ErLoadingService and ErLoadingDirective should be exported&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErLoadingService</span>).<span class="title function_">toBeDefined</span>()</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErLoadingDirective</span>).<span class="title function_">toBeDefined</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-index-ts-18"><a href="#â”œâ”€-index-ts-18" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h3><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./ConfigProvider&#x27;</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Icon&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Button&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Collapse&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Dropdown&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Message&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Tooltip&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Input&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Switch&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Select&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Form&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Alert&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Notification&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Loading&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Upload&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Popconfirm&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./MessageBox&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="â””â”€-package-json"><a href="#â””â”€-package-json" class="headerlink" title="â””â”€ package.json"></a>â””â”€ package.json</h3><p><strong>é¡¹ç›®ä¾èµ–</strong></p><blockquote><p>æ— </p></blockquote><p><strong>å¼€å‘ä¾èµ–</strong></p><blockquote><ul><li><code>axios</code>ï¼šHTTP å®¢æˆ·ç«¯ï¼ˆç”¨äºæµ‹è¯•æˆ–ç¤ºä¾‹ï¼‰ã€‚</li></ul></blockquote><h2 id="â”œâ”€-constants"><a href="#â”œâ”€-constants" class="headerlink" title="â”œâ”€ constants"></a>â”œâ”€ <em><del>constants</del></em></h2><blockquote><p>å¸¸é‡ç³»ç»Ÿ</p></blockquote><h3 id="â”œâ”€-index-ts-19"><a href="#â”œâ”€-index-ts-19" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h3><h3 id="â”œâ”€-key-ts"><a href="#â”œâ”€-key-ts" class="headerlink" title="â”œâ”€ key.ts"></a>â”œâ”€ key.ts</h3><h3 id="â””â”€-package-json-1"><a href="#â””â”€-package-json-1" class="headerlink" title="â””â”€ package.json"></a>â””â”€ package.json</h3><p><strong>é¡¹ç›®ä¾èµ–</strong></p><blockquote><p>ç©ºåŒ…</p></blockquote><p><strong>å¼€å‘ä¾èµ–</strong></p><blockquote><p><code>axios</code>ï¼šHTTP å®¢æˆ·ç«¯ï¼ˆç”¨äºæµ‹è¯•æˆ–ç¤ºä¾‹ï¼‰ã€‚</p></blockquote><h2 id="â”œâ”€-core"><a href="#â”œâ”€-core" class="headerlink" title="â”œâ”€ core"></a>â”œâ”€ core</h2><blockquote><p>æ ¸å¿ƒåŒ…æ‰˜ç®¡æ¨¡å¼</p><p>npmåŒ…çš„å…¥å£ï¼ŒåŒæ—¶ä½œä¸º components çš„å”¯ä¸€å‡ºå£</p><p>è´Ÿè´£èšåˆæ‰€æœ‰å­æ¨¡å—ï¼ˆå¦‚ <code>components</code>, <code>hooks</code>, <code>theme</code>, <code>utils</code> ç­‰ï¼‰çš„åŠŸèƒ½ï¼Œå¹¶æä¾›ç»™å¤–éƒ¨ä½¿ç”¨</p></blockquote><h3 id="â”œâ”€-build"><a href="#â”œâ”€-build" class="headerlink" title="â”œâ”€ build"></a>â”œâ”€ build</h3><blockquote><p>æ„å»ºå…¥å£</p><p>æ”¾viteçš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶</p></blockquote><h4 id="â”œâ”€-vite-es-config-ts"><a href="#â”œâ”€-vite-es-config-ts" class="headerlink" title="â”œâ”€ vite.es.config.ts"></a>â”œâ”€ vite.es.config.ts</h4><blockquote><p>ES Module æ„å»º</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; readdirSync, readdir &#125; <span class="keyword">from</span> <span class="string">&quot;fs&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defer, delay, filter, map, includes &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; visualizer &#125; <span class="keyword">from</span> <span class="string">&quot;rollup-plugin-visualizer&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hooksPlugin <span class="keyword">as</span> hooks &#125; <span class="keyword">from</span> <span class="string">&quot;@tyche/vite-plugins&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> shell <span class="keyword">from</span> <span class="string">&quot;shelljs&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> dts <span class="keyword">from</span> <span class="string">&quot;vite-plugin-dts&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> terser <span class="keyword">from</span> <span class="string">&quot;@rollup/plugin-terser&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TRY_MOVE_STYLES_DELAY</span> = <span class="number">750</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isProd = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> isDev = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;development&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> isTest = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;test&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDirectoriesSync</span>(<span class="params"><span class="attr">basePath</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = <span class="title function_">readdirSync</span>(basePath, &#123; <span class="attr">withFileTypes</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">map</span>(</span><br><span class="line">    <span class="title function_">filter</span>(entries, <span class="function">(<span class="params">entry</span>) =&gt;</span> entry.<span class="title function_">isDirectory</span>()),</span><br><span class="line">    <span class="function">(<span class="params">entry</span>) =&gt;</span> entry.<span class="property">name</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">moveStyles</span>(<span class="params"></span>) &#123; <span class="comment">//åœ¨æ„å»ºå®Œæˆåï¼Œå°† dist/es/theme ç›®å½•ç§»åŠ¨åˆ° dist ç›®å½•</span></span><br><span class="line">  <span class="title function_">readdir</span>(<span class="string">&quot;./dist/es/theme&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="title function_">delay</span>(moveStyles, <span class="variable constant_">TRY_MOVE_STYLES_DELAY</span>);</span><br><span class="line">    <span class="title function_">defer</span>(<span class="function">() =&gt;</span> shell.<span class="title function_">mv</span>(<span class="string">&quot;./dist/es/theme&quot;</span>, <span class="string">&quot;./dist&quot;</span>));<span class="comment">//ä½¿ç”¨ shell.mv å‘½ä»¤æ‰§è¡Œç§»åŠ¨æ“ä½œï¼Œé€šè¿‡ defer å’Œ delay å¤„ç†å¼‚æ­¥æ“ä½œ</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>(),<span class="comment">//æ”¯æŒ Vue 3 çš„å•æ–‡ä»¶ç»„ä»¶</span></span><br><span class="line">    <span class="title function_">visualizer</span>(&#123;<span class="comment">//ç”Ÿæˆæ„å»ºæ€§èƒ½åˆ†ææŠ¥å‘Šï¼ˆdist/stats.es.html</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;dist/stats.es.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">dts</span>(&#123;<span class="comment">//ç”Ÿæˆ TypeScript ç±»å‹å®šä¹‰æ–‡ä»¶ï¼ˆdist/types/core/index.d.tsï¼‰</span></span><br><span class="line">      <span class="attr">tsconfigPath</span>: <span class="string">&quot;../../tsconfig.build.json&quot;</span>,</span><br><span class="line">      <span class="attr">outDir</span>: <span class="string">&quot;dist/types&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">terser</span>(&#123;<span class="comment">//å‹ç¼©ä»£ç ï¼ˆä»…ç”Ÿäº§ç¯å¢ƒå¯ç”¨ï¼‰</span></span><br><span class="line">      <span class="attr">compress</span>: &#123;</span><br><span class="line">        <span class="attr">sequences</span>: isProd,</span><br><span class="line">        <span class="attr">arguments</span>: isProd,</span><br><span class="line">        <span class="attr">drop_console</span>: isProd &amp;&amp; [<span class="string">&quot;log&quot;</span>],</span><br><span class="line">        <span class="attr">drop_debugger</span>: isProd,</span><br><span class="line">        <span class="attr">passes</span>: isProd ? <span class="number">4</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">global_defs</span>: &#123;</span><br><span class="line">          <span class="string">&quot;@DEV&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isDev),</span><br><span class="line">          <span class="string">&quot;@PROD&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isProd),</span><br><span class="line">          <span class="string">&quot;@TEST&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isTest),</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">format</span>: &#123;</span><br><span class="line">        <span class="attr">semicolons</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">shorthand</span>: isProd,</span><br><span class="line">        <span class="attr">braces</span>: !isProd,</span><br><span class="line">        <span class="attr">beautify</span>: !isProd,</span><br><span class="line">        <span class="attr">comments</span>: !isProd,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">mangle</span>: &#123;</span><br><span class="line">        <span class="attr">toplevel</span>: isProd,</span><br><span class="line">        <span class="attr">eval</span>: isProd,</span><br><span class="line">        <span class="attr">keep_classnames</span>: isDev,</span><br><span class="line">        <span class="attr">keep_fnames</span>: isDev,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">hooks</span>(&#123;<span class="comment">//è‡ªå®šä¹‰æ„å»ºé’©å­ï¼Œå¦‚æ¸…ç†æ–‡ä»¶å’Œç§»åŠ¨ CSS æ–‡ä»¶</span></span><br><span class="line">      <span class="attr">rmFiles</span>: [</span><br><span class="line">        <span class="string">&quot;./dist/es&quot;</span>,</span><br><span class="line">        <span class="string">&quot;./dist/theme&quot;</span>,</span><br><span class="line">        <span class="string">&quot;./dist/types&quot;</span>,</span><br><span class="line">        <span class="string">&quot;./dist/stats.es.html&quot;</span>,</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">afterBuild</span>: moveStyles,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">outDir</span>: <span class="string">&quot;dist/es&quot;</span>,<span class="comment">//è¾“å‡ºç›®å½•ä¸º dist/es</span></span><br><span class="line">    <span class="attr">minify</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">cssCodeSplit</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">sourcemap</span>: !isProd,</span><br><span class="line">    <span class="attr">lib</span>: &#123;<span class="comment">//é…ç½®åº“çš„</span></span><br><span class="line">      <span class="attr">entry</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../index.ts&quot;</span>),<span class="comment">//å…¥å£æ–‡ä»¶</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;EricUI&quot;</span>,<span class="comment">//åç§°</span></span><br><span class="line">      <span class="attr">fileName</span>: <span class="string">&quot;index&quot;</span>,<span class="comment">//æ–‡ä»¶å</span></span><br><span class="line">      <span class="attr">formats</span>: [<span class="string">&quot;es&quot;</span>],<span class="comment">//æ ¼å¼</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">      <span class="attr">external</span>: [<span class="comment">//å£°æ˜å¤–éƒ¨ä¾èµ–ï¼Œé¿å…æ‰“åŒ…åˆ°æœ€ç»ˆè¾“å‡ºä¸­ã€‚</span></span><br><span class="line">        <span class="string">&quot;vue&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@fortawesome/fontawesome-svg-core&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@fortawesome/free-solid-svg-icons&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@fortawesome/vue-fontawesome&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@popperjs/core&quot;</span>,</span><br><span class="line">        <span class="string">&quot;async-validator&quot;</span>,</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">assetFileNames</span>: <span class="function">(<span class="params">chunkInfo</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (chunkInfo.<span class="property">name</span> === <span class="string">&quot;style.css&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;index.css&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (</span><br><span class="line">            chunkInfo.<span class="property">type</span> === <span class="string">&quot;asset&quot;</span> &amp;&amp;</span><br><span class="line">            <span class="regexp">/\.(css)$/i</span>.<span class="title function_">test</span>(chunkInfo.<span class="property">name</span> <span class="keyword">as</span> <span class="built_in">string</span>)</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;theme/[name].[ext]&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> chunkInfo.<span class="property">name</span> <span class="keyword">as</span> <span class="built_in">string</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">manualChunks</span>(<span class="params">id</span>) &#123;<span class="comment">//æ‰‹åŠ¨åˆ†å—ç­–ç•¥</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">includes</span>(id, <span class="string">&quot;node_modules&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;vendor&quot;</span>;<span class="comment">//ç¬¬ä¸‰æ–¹åº“</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">includes</span>(id, <span class="string">&quot;/packages/hooks&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;hooks&quot;</span>;<span class="comment">//è‡ªå®šä¹‰é’©å­</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">includes</span>(id, <span class="string">&quot;/packages/utils&quot;</span>) || <span class="title function_">includes</span>(id, <span class="string">&quot;plugin-vue:export-helper&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;utils&quot;</span>;<span class="comment">//å·¥å…·å‡½æ•°</span></span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="title function_">getDirectoriesSync</span>(<span class="string">&quot;../components&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">//ç»„ä»¶ç›®å½•ï¼ˆå¦‚ components/xxxï¼‰ â†’ å¯¹åº”ç»„ä»¶åç§°çš„åˆ†å—</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">includes</span>(id, <span class="string">`/packages/components/<span class="subst">$&#123;item&#125;</span>`</span>)) <span class="keyword">return</span> item;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â””â”€-vite-umd-config-ts"><a href="#â””â”€-vite-umd-config-ts" class="headerlink" title="â””â”€ vite.umd.config.ts"></a>â””â”€ vite.umd.config.ts</h4><blockquote><p>UMD æ„å»º</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; readFile &#125; <span class="keyword">from</span> <span class="string">&quot;fs&quot;</span>;<span class="comment">//åŒæ­¥è¯»å–ï¼ˆæ–‡ä»¶ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defer, delay &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; visualizer &#125; <span class="keyword">from</span> <span class="string">&quot;rollup-plugin-visualizer&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hooksPlugin <span class="keyword">as</span> hooks &#125; <span class="keyword">from</span> <span class="string">&quot;@tyche/vite-plugins&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> shell <span class="keyword">from</span> <span class="string">&quot;shelljs&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> compression <span class="keyword">from</span> <span class="string">&quot;vite-plugin-compression&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> terser <span class="keyword">from</span> <span class="string">&quot;@rollup/plugin-terser&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TRY_MOVE_STYLES_DELAY</span> = <span class="number">750</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isProd = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> isDev = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;development&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> isTest = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;test&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">moveStyles</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">readFile</span>(<span class="string">&quot;./dist/umd/index.css.gz&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="title function_">delay</span>(moveStyles, <span class="variable constant_">TRY_MOVE_STYLES_DELAY</span>);</span><br><span class="line">    <span class="title function_">defer</span>(<span class="function">() =&gt;</span> shell.<span class="title function_">cp</span>(<span class="string">&quot;./dist/umd/index.css&quot;</span>, <span class="string">&quot;./dist/index.css&quot;</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>(),</span><br><span class="line">    <span class="title function_">compression</span>(&#123;</span><br><span class="line">      <span class="attr">filter</span>: <span class="regexp">/.(cjs|css)$/i</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">visualizer</span>(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;dist/stats.umd.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">terser</span>(&#123;</span><br><span class="line">      <span class="attr">compress</span>: &#123;</span><br><span class="line">        <span class="attr">drop_console</span>: [<span class="string">&quot;log&quot;</span>],</span><br><span class="line">        <span class="attr">drop_debugger</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">passes</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">global_defs</span>: &#123;</span><br><span class="line">          <span class="string">&quot;@DEV&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isDev),</span><br><span class="line">          <span class="string">&quot;@PROD&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isProd),</span><br><span class="line">          <span class="string">&quot;@TEST&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isTest),</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">hooks</span>(&#123;</span><br><span class="line">      <span class="attr">rmFiles</span>: [<span class="string">&quot;./dist/umd&quot;</span>, <span class="string">&quot;./dist/index.css&quot;</span>, <span class="string">&quot;./dist/stats.umd.html&quot;</span>],</span><br><span class="line">      <span class="attr">afterBuild</span>: moveStyles,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">outDir</span>: <span class="string">&quot;dist/umd&quot;</span>,</span><br><span class="line">    <span class="attr">lib</span>: &#123;</span><br><span class="line">      <span class="attr">entry</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../index.ts&quot;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;EricUI&quot;</span>,</span><br><span class="line">      <span class="attr">fileName</span>: <span class="string">&quot;index&quot;</span>,</span><br><span class="line">      <span class="attr">formats</span>: [<span class="string">&quot;umd&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">      <span class="attr">external</span>: [<span class="string">&quot;vue&quot;</span>],</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">exports</span>: <span class="string">&quot;named&quot;</span>,</span><br><span class="line">        <span class="attr">globals</span>: &#123;</span><br><span class="line">          <span class="attr">vue</span>: <span class="string">&quot;Vue&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">assetFileNames</span>: <span class="function">(<span class="params">chunkInfo</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (chunkInfo.<span class="property">name</span> === <span class="string">&quot;style.css&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;index.css&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> chunkInfo.<span class="property">name</span> <span class="keyword">as</span> <span class="built_in">string</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-componens-ts"><a href="#â”œâ”€-componens-ts" class="headerlink" title="â”œâ”€ componens.ts"></a>â”œâ”€ <em><del>componens.ts</del></em></h3><blockquote><p>é›†ä¸­å¯¼å‡ºç»„ä»¶</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ErButton</span>, <span class="title class_">ErButtonGroup</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@tyche/components&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Plugin</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [<span class="title class_">ErButton</span>, <span class="title class_">ErButtonGroup</span>] <span class="keyword">as</span> <span class="title class_">Plugin</span>[]</span><br></pre></td></tr></table></figure><blockquote><p>å°†ç»„ä»¶æ³¨å†Œä¸º Vue æ’ä»¶ï¼Œç”¨æˆ·é€šè¿‡ <code>app.use(Tyche)</code> å¯ä»¥ä¸€æ¬¡æ€§å®‰è£…æ‰€æœ‰ç»„ä»¶ã€‚</p></blockquote><h3 id="â”œâ”€-index-ts-20"><a href="#â”œâ”€-index-ts-20" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h3><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; library &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/fontawesome-svg-core&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fas &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/free-solid-svg-icons&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; makeInstaller &#125; <span class="keyword">from</span> <span class="string">&#x27;@tyche/utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> components <span class="keyword">from</span> <span class="string">&#x27;./components&#x27;</span></span><br><span class="line"><span class="keyword">import</span> printLogo <span class="keyword">from</span> <span class="string">&quot;./pringLogo&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@tyche/theme/index.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">printLogo</span>();</span><br><span class="line"></span><br><span class="line">library.<span class="title function_">add</span>(fas);</span><br><span class="line"><span class="keyword">const</span> installer = <span class="title function_">makeInstaller</span>(components);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;@tyche/components&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> installer</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-makeInstaller-ts"><a href="#â”œâ”€-makeInstaller-ts" class="headerlink" title="â”œâ”€ makeInstaller.ts"></a>â”œâ”€ <em><del>makeInstaller.ts</del></em></h3><blockquote><p>å…¨å±€æ³¨å†Œ+æ„å»ºé…ç½®</p><p><strong>æ’ä»¶å®‰è£…å™¨</strong>ï¼šå°†ç»„ä»¶é›†åˆè½¬æ¢ä¸º Vue æ’ä»¶ï¼Œå¹¶æ”¯æŒå…¨å±€é…ç½®ï¼ˆå¦‚ä¸»é¢˜ã€å›½é™…åŒ–ï¼‰</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">makeInstaller</span>(<span class="params"><span class="attr">components</span>: <span class="title class_">Plugin</span>[]</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">install</span> = (<span class="params"><span class="attr">app</span>: <span class="title class_">App</span>, <span class="attr">options</span>?: <span class="title class_">ConfigProviderProps</span></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">get</span>(app, <span class="variable constant_">INSTALLED_KEY</span>)) <span class="keyword">return</span>;</span><br><span class="line">        <span class="title function_">set</span>(app, <span class="variable constant_">INSTALLED_KEY</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="title function_">each</span>(components, <span class="function">(<span class="params">c</span>) =&gt;</span> app.<span class="title function_">use</span>(c));</span><br><span class="line">        <span class="keyword">if</span> (options) <span class="title function_">provideGlobalConfig</span>(options, app, <span class="literal">true</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> install;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>é˜²æ­¢é‡å¤å®‰è£…æ’ä»¶ã€‚</li><li>é€šè¿‡ <code>app.use</code> æ³¨å†Œæ‰€æœ‰ç»„ä»¶ã€‚</li><li>æ”¯æŒå…¨å±€é…ç½®ï¼ˆå¦‚é€šè¿‡ <code>provideGlobalConfig</code> æä¾›ä¸»é¢˜æˆ–é»˜è®¤é€‰é¡¹ï¼‰ã€‚</li></ul></blockquote><h3 id="â”œâ”€-package-json-1"><a href="#â”œâ”€-package-json-1" class="headerlink" title="â”œâ”€ package.json"></a>â”œâ”€ <em><del>package.json</del></em></h3><p><strong>é¡¹ç›®ä¾èµ–</strong></p><blockquote><ul><li><code>@fortawesome/fontawesome-svg-core</code></li><li><code>@fortawesome/free-solid-svg-icons</code></li><li><code>@fortawesome/vue-fontawesome</code></li><li><code>@popperjs/core</code></li><li><code>async-validator</code></li></ul></blockquote><p><strong>å¼€å‘ä¾èµ–</strong></p><blockquote><ul><li><code>@rollup/plugin-terser</code>ï¼šRollup å‹ç¼©æ’ä»¶</li><li><code>rollup-plugin-visualizer</code>ï¼šæ‰“åŒ…åˆ†ææ’ä»¶</li><li><code>vite-plugin-compression</code>ï¼šæ–‡ä»¶å‹ç¼©æ’ä»¶</li></ul></blockquote><p><strong>é¡¹ç›®å…ƒæ•°æ®ä¸ä¾èµ–ç®¡ç†</strong>ï¼šå®šä¹‰æ„å»ºç›®æ ‡ã€å…¥å£æ–‡ä»¶ã€ä¾èµ–å…³ç³»ç­‰</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tyche&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä½¿ç”¨ Vue3 + Ts æ„å»ºçš„ç»„ä»¶åº“&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;module&quot;</span><span class="punctuation">,</span><span class="comment">//æŒ‡å®šä½¿ç”¨ ES æ¨¡å—</span></span><br><span class="line">    <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;dist&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sideEffects&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;./dist/index.css&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;./dist/theme/*.css&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/umd/index.umd.cjs&quot;</span><span class="punctuation">,</span><span class="comment">//CommonJS æ ¼å¼çš„å…¥å£æ–‡ä»¶</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/es/index.js&quot;</span><span class="punctuation">,</span><span class="comment">//ESM æ ¼å¼çš„å…¥å£æ–‡ä»¶</span></span><br><span class="line">    <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/types/core/index.d.ts&quot;</span><span class="punctuation">,</span><span class="comment">//TypeScript ç±»å‹å®šä¹‰æ–‡ä»¶çš„ä½ç½®</span></span><br><span class="line">    <span class="attr">&quot;exports&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//å®šä¹‰æ¨¡å—å¯¼å‡ºè·¯å¾„</span></span><br><span class="line">        <span class="attr">&quot;.&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//åˆ†åˆ«æŒ‡å‘ä¸åŒç¯å¢ƒçš„å…¥å£æ–‡ä»¶</span></span><br><span class="line">            <span class="attr">&quot;import&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/es/index.js&quot;</span><span class="punctuation">,</span> <span class="comment">//ESM å…¥å£</span></span><br><span class="line">            <span class="attr">&quot;require&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/umd/index.umd.cjs&quot;</span><span class="punctuation">,</span> <span class="comment">//CommonJS å…¥å£</span></span><br><span class="line">            <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/types/core/index.d.ts&quot;</span> <span class="comment">//TypeScript ç±»å‹å®šä¹‰</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;./dist/&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//é¢å¤–æŒ‡å®šäº†å¯¹ dist ç›®å½•ä¸‹èµ„æºçš„å¯¼å…¥è§„åˆ™</span></span><br><span class="line">            <span class="attr">&quot;import&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;require&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;run-p build-es build-umd&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build:watch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;run-p build-es:watch build-umd:watch&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build-es&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build --config build/vite.es.config.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build-umd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build --config build/vite.umd.config.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build-es:watch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build --watch --config build/vite.es.config.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build-umd:watch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build --watch --config build/vite.umd.config.ts&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;keywords&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Breezli&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span><span class="punctuation">,</span><span class="comment">//è®¸å¯è¯ç±»å‹ä¸º ISCï¼Œä¸€ä¸ªç®€åŒ–çš„å¼€æºè®¸å¯è¯</span></span><br><span class="line">    <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//å¼€å‘ç¯å¢ƒ</span></span><br><span class="line">        <span class="attr">&quot;@rollup/plugin-terser&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.4.4&quot;</span><span class="punctuation">,</span><span class="comment">//Rollup æ’ä»¶ï¼Œç”¨äºå‹ç¼©ä»£ç </span></span><br><span class="line">        <span class="attr">&quot;rollup-plugin-visualizer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.12.0&quot;</span><span class="punctuation">,</span><span class="comment">//æä¾›æ„å»ºç»“æœçš„å¯è§†åŒ–åˆ†æ</span></span><br><span class="line">        <span class="attr">&quot;terser&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.31.0&quot;</span><span class="punctuation">,</span><span class="comment">//JavaScript è§£æå™¨å’Œå‹ç¼©å·¥å…·</span></span><br><span class="line">        <span class="attr">&quot;vite-plugin-compression&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.5.1&quot;</span><span class="comment">//Vite æ’ä»¶ï¼Œç”¨äºå‹ç¼©èµ„æºæ–‡ä»¶</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;@fortawesome/fontawesome-svg-core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.5.1&quot;</span><span class="punctuation">,</span><span class="comment">//FontAwesome å›¾æ ‡é›†</span></span><br><span class="line">        <span class="attr">&quot;@fortawesome/free-solid-svg-icons&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.5.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;@fortawesome/vue-fontawesome&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;@popperjs/core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.11.8&quot;</span><span class="punctuation">,</span><span class="comment">//Popper.js æ ¸å¿ƒåº“ï¼Œé€šå¸¸ç”¨äºå®šä½æç¤ºæ¡†ã€èœå•ç­‰å…ƒç´ </span></span><br><span class="line">        <span class="attr">&quot;async-validator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.2.5&quot;</span><span class="comment">//å¼‚æ­¥è¡¨å•éªŒè¯åº“</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;peerDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.4.27&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>&#x2F;&#x2F;&#x2F; <em>è¡¥å……ï¼špeerDependencies</em> &#x2F;&#x2F;&#x2F;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ helloWorld</span><br><span class="line">â”‚   â””â”€â”€ node_modules</span><br><span class="line">â”‚       â”œâ”€â”€ packageA</span><br><span class="line">â”‚       â”œâ”€â”€ plugin1</span><br><span class="line">â”‚       â”‚   â””â”€â”€ nodule_modules</span><br><span class="line">â”‚       â”‚       â””â”€â”€ packageA</span><br><span class="line">â”‚       â””â”€â”€ plugin2</span><br><span class="line">â”‚       â”‚   â””â”€â”€ nodule_modules</span><br><span class="line">â”‚       â”‚       â””â”€â”€ packageA</span><br></pre></td></tr></table></figure><blockquote><p>packageA æ ¸å¿ƒä¾èµ–åº“è¢«é‡å¤ä¸‹è½½</p></blockquote><p>æ­¤æ—¶æˆ‘ä»¬åº”è¯¥åœ¨</p><p><strong><code>plugin1 /package.json</code></strong>  <em>&amp;</em>  <strong><code>plugin2 /package.json</code></strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;peerDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;packageA&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong><code>/package.json</code></strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;packageA&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç»“æ„å°±å˜æˆäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ helloWorld</span><br><span class="line">â”‚   â””â”€â”€ node_modules</span><br><span class="line">â”‚       â”œâ”€â”€ packageA</span><br><span class="line">â”‚       â”œâ”€â”€ plugin1</span><br><span class="line">â”‚       â””â”€â”€ plugin2</span><br></pre></td></tr></table></figure><blockquote><p>é€šå¸¸ç”¨äºåº“æˆ–æ’ä»¶ï¼Œè¿™äº›åº“æˆ–æ’ä»¶ä¸ç›´æ¥åŒ…å«åœ¨æœ€ç»ˆåº”ç”¨ä¸­ï¼Œä½†éœ€è¦ä¸å…¶ä»–åŒ…ååŒå·¥ä½œ</p><p>å½“ä½ å®‰è£…ä¸€ä¸ªåŒ…æ—¶ï¼Œå¦‚æœè¯¥åŒ…æœ‰peerDependenciesï¼Œnpmæˆ–yarnä¼šæ£€æŸ¥è¿™äº›ä¾èµ–æ˜¯å¦å·²ç»å®‰è£…åœ¨é¡¹ç›®ä¸­ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå®ƒä¼šç»™å‡ºè­¦å‘Šï¼Œä½†ä¸ä¼šé»˜è®¤å®‰è£…å®ƒä»¬</p></blockquote><h3 id="â””â”€-pringLogo-ts"><a href="#â””â”€-pringLogo-ts" class="headerlink" title="â””â”€ pringLogo.ts"></a>â””â”€ <em><del>pringLogo.ts</del></em></h3><blockquote><p><strong>æ„å»ºæ—¶è¾“å‡º Logo å’Œæç¤ºä¿¡æ¯</strong>ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒæ„å»ºæ—¶æ‰“å°å½©è‰² Logoï¼Œåœ¨å¼€å‘ç¯å¢ƒæç¤ºå½“å‰æ¨¡å¼ã€‚</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable constant_">PROD</span>) &#123; <span class="comment">// é¡¹ç›®æ­£åœ¨`ç”Ÿäº§ç¯å¢ƒ`ä¸­è¿è¡Œ</span></span><br><span class="line">    <span class="keyword">const</span> logo = <span class="string">`...`</span>; <span class="comment">// å½©è‰²æ¸å˜çš„ EricUI Logo æ–‡å­—</span></span><br><span class="line">    <span class="keyword">const</span> rainbowGradient = <span class="string">`...`</span>; <span class="comment">// CSS æ ·å¼</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`%c<span class="subst">$&#123;logo&#125;</span>`</span>, rainbowGradient);</span><br><span class="line">      <span class="comment">//%c æ˜¯å ä½ç¬¦ï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥çš„ä¸€ä¸ªå‚æ•° (rainbowGradient) åº”è¯¥è¢«è§£é‡Šä¸ºCSSæ ·å¼ã€‚</span></span><br><span class="line">      <span class="comment">//$&#123;logo&#125; æ˜¯å®é™…è¦æ‰“å°åˆ°æ§åˆ¶å°çš„æ–‡å­—å†…å®¹ï¼ˆå³é‚£ä¸ªASCIIè‰ºæœ¯é£æ ¼çš„logoï¼‰ã€‚</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable constant_">DEV</span>) &#123; <span class="comment">// é¡¹ç›®å¤„äº`å¼€å‘æ¨¡å¼`ä¸‹</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[EricUI]:dev mode...&quot;</span>); <span class="comment">// ç®€å•åœ°å‘æ§åˆ¶å°è¾“å‡ºä¸€æ¡ &quot;[EricUI]:dev mode...&quot;ã€‚æœ‰åŠ©äºå¼€å‘è€…å¿«é€Ÿè¯†åˆ«é¡¹ç›®çš„å½“å‰çŠ¶æ€æ˜¯å¤„äºå¼€å‘é˜¶æ®µ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="â”œâ”€-docs"><a href="#â”œâ”€-docs" class="headerlink" title="â”œâ”€ docs"></a>â”œâ”€ <em><del>docs</del></em></h2><blockquote><p>ç»„ä»¶åº“é¡¹ç›®æ–‡æ¡£ï¼Œvitepressç«™ç‚¹</p></blockquote><h3 id="â”œâ”€-vitepress"><a href="#â”œâ”€-vitepress" class="headerlink" title="â”œâ”€ .vitepress"></a>â”œâ”€ .vitepress</h3><h4 id="â”œâ”€-config-ts"><a href="#â”œâ”€-config-ts" class="headerlink" title="â”œâ”€ config.ts"></a>â”œâ”€ config.ts</h4><h4 id="â””â”€-theme"><a href="#â””â”€-theme" class="headerlink" title="â””â”€ theme"></a>â””â”€ theme</h4><h5 id="â””â”€-index-ts"><a href="#â””â”€-index-ts" class="headerlink" title="â””â”€ index.ts"></a>â””â”€ index.ts</h5><h3 id="â”œâ”€-components-1"><a href="#â”œâ”€-components-1" class="headerlink" title="â”œâ”€ components"></a>â”œâ”€ components</h3><h4 id="â”œâ”€-alert-md"><a href="#â”œâ”€-alert-md" class="headerlink" title="â”œâ”€ alert.md"></a>â”œâ”€ alert.md</h4><h4 id="â”œâ”€-button-md"><a href="#â”œâ”€-button-md" class="headerlink" title="â”œâ”€ button.md"></a>â”œâ”€ button.md</h4><h4 id="â”œâ”€-collapse-md"><a href="#â”œâ”€-collapse-md" class="headerlink" title="â”œâ”€ collapse.md"></a>â”œâ”€ collapse.md</h4><h4 id="â”œâ”€-dropdown-md"><a href="#â”œâ”€-dropdown-md" class="headerlink" title="â”œâ”€ dropdown.md"></a>â”œâ”€ dropdown.md</h4><h4 id="â”œâ”€-form-md"><a href="#â”œâ”€-form-md" class="headerlink" title="â”œâ”€ form.md"></a>â”œâ”€ form.md</h4><h4 id="â”œâ”€-loading-md"><a href="#â”œâ”€-loading-md" class="headerlink" title="â”œâ”€ loading.md"></a>â”œâ”€ loading.md</h4><h4 id="â”œâ”€-message-md"><a href="#â”œâ”€-message-md" class="headerlink" title="â”œâ”€ message.md"></a>â”œâ”€ message.md</h4><h4 id="â”œâ”€-messagebox-md"><a href="#â”œâ”€-messagebox-md" class="headerlink" title="â”œâ”€ messagebox.md"></a>â”œâ”€ messagebox.md</h4><h4 id="â”œâ”€-notification-md"><a href="#â”œâ”€-notification-md" class="headerlink" title="â”œâ”€ notification.md"></a>â”œâ”€ notification.md</h4><h4 id="â”œâ”€-popconfirm-md"><a href="#â”œâ”€-popconfirm-md" class="headerlink" title="â”œâ”€ popconfirm.md"></a>â”œâ”€ popconfirm.md</h4><h4 id="â””â”€-tooltip-md"><a href="#â””â”€-tooltip-md" class="headerlink" title="â””â”€ tooltip.md"></a>â””â”€ tooltip.md</h4><h3 id="â”œâ”€-demo"><a href="#â”œâ”€-demo" class="headerlink" title="â”œâ”€ demo"></a>â”œâ”€ demo</h3><h4 id="â”œâ”€-alert"><a href="#â”œâ”€-alert" class="headerlink" title="â”œâ”€ alert"></a>â”œâ”€ alert</h4><p>â”œâ”€ Basic.vue<br>â”œâ”€ Close.vue<br>â”œâ”€ Desc.vue<br>â”œâ”€ IconDesc.vue<br>â”œâ”€ ShowIcon.vue<br>â”œâ”€ TextCenter.vue<br>â””â”€ Theme.vue</p><h4 id="â”œâ”€-button"><a href="#â”œâ”€-button" class="headerlink" title="â”œâ”€ button"></a>â”œâ”€ button</h4><p>â”œâ”€ Basic.vue<br>â”œâ”€ Disabled.vue<br>â”œâ”€ Group.vue<br>â”œâ”€ Icon.vue<br>â”œâ”€ Loading.vue<br>â”œâ”€ Size.vue<br>â”œâ”€ Tag.vue<br>â””â”€ Throttle.vue</p><h4 id="â”œâ”€-collapse"><a href="#â”œâ”€-collapse" class="headerlink" title="â”œâ”€ collapse"></a>â”œâ”€ collapse</h4><p>â”œâ”€ Accordion.vue<br>â”œâ”€ Basic.vue<br>â”œâ”€ CustomTitle.vue<br>â””â”€ Disabled.vue</p><h4 id="â”‚-â”‚-â”‚-â”œâ”€-dropdown"><a href="#â”‚-â”‚-â”‚-â”œâ”€-dropdown" class="headerlink" title="â”‚  â”‚  â”‚  â”œâ”€ dropdown"></a>â”‚  â”‚  â”‚  â”œâ”€ dropdown</h4><p>â”œâ”€ Basic.vue<br>â”œâ”€ Command.vue<br>â”œâ”€ Disabled.vue<br>â”œâ”€ HideOnClick.vue<br>â”œâ”€ InstanceMethod.vue<br>â”œâ”€ Size.vue<br>â”œâ”€ SplitButton.vue<br>â””â”€ Trigger.vue</p><h4 id="â”œâ”€-form"><a href="#â”œâ”€-form" class="headerlink" title="â”œâ”€ form"></a>â”œâ”€ form</h4><p>â”œâ”€ Basic.vue<br>â”œâ”€ CustomValidate.vue<br>â”œâ”€ Position.vue<br>â””â”€ Validate.vue</p><h4 id="â”œâ”€-loading"><a href="#â”œâ”€-loading" class="headerlink" title="â”œâ”€ loading"></a>â”œâ”€ loading</h4><p>â”œâ”€ Basic.vue<br>â”œâ”€ Custom.vue<br>â””â”€ Fullscreen.vue</p><h4 id="â”œâ”€-message"><a href="#â”œâ”€-message" class="headerlink" title="â”œâ”€ message"></a>â”œâ”€ message</h4><p>â”œâ”€ Basic.vue<br>â”œâ”€ Center.vue<br>â”œâ”€ Closeable.vue<br>â”œâ”€ Test.vue<br>â””â”€ Type.vue</p><h4 id="â”œâ”€-messagebox"><a href="#â”œâ”€-messagebox" class="headerlink" title="â”œâ”€ messagebox"></a>â”œâ”€ messagebox</h4><p>â”œâ”€ Alert.vue<br>â”œâ”€ Center.vue<br>â”œâ”€ Confirm.vue<br>â”œâ”€ Custom.vue<br>â”œâ”€ Prompt.vue<br>â””â”€ VNode.vue</p><h4 id="â”œâ”€-notification"><a href="#â”œâ”€-notification" class="headerlink" title="â”œâ”€ notification"></a>â”œâ”€ notification</h4><p>â”œâ”€ Basic.vue<br>â”œâ”€ Closeable.vue<br>â””â”€ Type.vue</p><h4 id="â”œâ”€-popconfirm"><a href="#â”œâ”€-popconfirm" class="headerlink" title="â”œâ”€ popconfirm"></a>â”œâ”€ popconfirm</h4><p>â”œâ”€ Basic.vue<br>â”œâ”€ Callback.vue<br>â””â”€ Custom.vue</p><h4 id="â””â”€-tooltip"><a href="#â””â”€-tooltip" class="headerlink" title="â””â”€ tooltip"></a>â””â”€ tooltip</h4><p>â”œâ”€ Basic.vue<br>â”œâ”€ Disabled.vue<br>â””â”€ Slot.vue</p><h3 id="â”œâ”€-get-started-md"><a href="#â”œâ”€-get-started-md" class="headerlink" title="â”œâ”€ get-started.md"></a>â”œâ”€ get-started.md</h3><h3 id="â”œâ”€-index-md"><a href="#â”œâ”€-index-md" class="headerlink" title="â”œâ”€ index.md"></a>â”œâ”€ index.md</h3><h3 id="â””â”€-package-json-2"><a href="#â””â”€-package-json-2" class="headerlink" title="â””â”€ package.json"></a>â””â”€ package.json</h3><p><strong>ä¾èµ–ï¼ˆdependenciesï¼‰</strong></p><blockquote><p><strong>æ— </strong>ï¼ˆé€šè¿‡æ ¹ç›®å½•ç»§æ‰¿ï¼‰ã€‚</p></blockquote><p><strong>å¼€å‘ä¾èµ–ï¼ˆdevDependenciesï¼‰</strong></p><blockquote><ul><li><code>@vitepress-demo-preview/component</code>ï¼šVitePress ç»„ä»¶é¢„è§ˆæ’ä»¶</li><li><code>@vitepress-demo-preview/plugin</code>ï¼šVitePress æ’ä»¶</li><li><code>vitepress</code>ï¼šæ–‡æ¡£æ¡†æ¶</li></ul></blockquote><h2 id="â”œâ”€-hooks"><a href="#â”œâ”€-hooks" class="headerlink" title="â”œâ”€ hooks"></a>â”œâ”€ <em><del>hooks</del></em></h2><blockquote><p>é’©å­å‡½æ•°, è‡ªå®šä¹‰çš„ Vue ç»„åˆå¼ API</p><p>é€»è¾‘å¤ç”¨, ç”¨äºå¤„ç†å„ç§åŠŸèƒ½éœ€æ±‚</p></blockquote><h3 id="â”œâ”€-index-ts-21"><a href="#â”œâ”€-index-ts-21" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h3><blockquote><p><code>hooks</code> çš„å…¥å£æ–‡ä»¶ï¼Œå¯¼å‡ºæ‰€æœ‰ API</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useClickOutside <span class="keyword">from</span> <span class="string">&quot;./useClickOutside&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useEventListener <span class="keyword">from</span> <span class="string">&quot;./useEventListener&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useFocusController <span class="keyword">from</span> <span class="string">&quot;./useFocusController&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useZIndex <span class="keyword">from</span> <span class="string">&quot;./useZIndex&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useProp <span class="keyword">from</span> <span class="string">&quot;./useProp&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useDisabledStyle <span class="keyword">from</span> <span class="string">&quot;./useDisabledStyle&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useId <span class="keyword">from</span> <span class="string">&quot;./useId&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useLocale <span class="keyword">from</span> <span class="string">&quot;./useLocale&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useOffset <span class="keyword">from</span> <span class="string">&quot;./useOffset&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  useClickOutside,</span><br><span class="line">  useEventListener,</span><br><span class="line">  useZIndex,</span><br><span class="line">  useProp,</span><br><span class="line">  useFocusController,</span><br><span class="line">  useDisabledStyle,</span><br><span class="line">  useLocale,</span><br><span class="line">  useOffset,</span><br><span class="line">  useId,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-package-json-2"><a href="#â”œâ”€-package-json-2" class="headerlink" title="â”œâ”€ package.json"></a>â”œâ”€ package.json</h3><p><strong>ä¾èµ–</strong></p><blockquote><p>æ— </p></blockquote><p><strong>peerDependenciesï¼ˆå¿…é¡»ç”±ç”¨æˆ·å®‰è£…ï¼‰</strong></p><blockquote><ul><li><code>vue</code>ï¼šVue 3 æ ¸å¿ƒåº“</li><li><code>lodash-es</code>ï¼šLodash çš„ ES æ¨¡å—ç‰ˆæœ¬</li></ul></blockquote><h3 id="â”œâ”€-useClickOutside-ts"><a href="#â”œâ”€-useClickOutside-ts" class="headerlink" title="â”œâ”€ useClickOutside.ts"></a>â”œâ”€ useClickOutside.ts</h3><blockquote><p>ç›‘å¬ç”¨æˆ·æ˜¯å¦ç‚¹å‡»äº†æŸä¸ª DOM å…ƒç´ ä¹‹å¤–çš„åŒºåŸŸ</p></blockquote><blockquote><p>å®ç° <strong>ä¸‹æ‹‰èœå•</strong>ã€<strong>å¼¹çª—</strong> ç­‰éœ€è¦ç‚¹å‡»å¤–éƒ¨å…³é—­çš„åŠŸèƒ½</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> useEventListener <span class="keyword">from</span> <span class="string">&#x27;./useEventListener&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useClickOutside</span> (<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">elementRef</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">HTMLElement</span> | <span class="built_in">void</span>&gt;,</span></span><br><span class="line"><span class="params">  <span class="attr">callback</span>: (e: MouseEvent) =&gt; <span class="built_in">void</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">useEventListener</span>(<span class="variable language_">document</span>, <span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">Event</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (elementRef.<span class="property">value</span> &amp;&amp; e.<span class="property">target</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!elementRef.<span class="property">value</span>.<span class="title function_">contains</span>(e.<span class="property">target</span> <span class="keyword">as</span> <span class="title class_">HTMLElement</span>)) &#123;</span><br><span class="line">        <span class="title function_">callback</span>(e <span class="keyword">as</span> <span class="title class_">MouseEvent</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-useDisabledStyle-ts"><a href="#â”œâ”€-useDisabledStyle-ts" class="headerlink" title="â”œâ”€ useDisabledStyle.ts"></a>â”œâ”€ useDisabledStyle.ts</h3><blockquote><p>åŠ¨æ€æ§åˆ¶ç»„ä»¶çš„ç¦ç”¨æ ·å¼</p></blockquote><blockquote><p>å¯ä»¥æ ¹æ® <code>disabled</code> å±æ€§åŠ¨æ€æ·»åŠ æˆ–ç§»é™¤æ ·å¼ç±»</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; each, isFunction, cloneDeep, assign &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; watchEffect, useSlots, getCurrentInstance, <span class="keyword">type</span> <span class="title class_">VNode</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_dfs</span> = (<span class="params"><span class="attr">nodes</span>: <span class="title class_">VNode</span>[], <span class="attr">cb</span>: (node: VNode) =&gt; <span class="built_in">void</span></span>) =&gt;</span><br><span class="line">  <span class="title function_">each</span>(nodes, <span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">isFunction</span>(cb) &amp;&amp; <span class="title function_">cb</span>(node);</span><br><span class="line">    node.<span class="property">children</span> &amp;&amp; <span class="title function_">_dfs</span>(node.<span class="property">children</span> <span class="keyword">as</span> <span class="title class_">VNode</span>[], cb);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useDisabledStyle</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> nodePropsMap = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">getCurrentInstance</span>()!;</span><br><span class="line">  <span class="keyword">const</span> children = <span class="title function_">useSlots</span>()?.<span class="property">default</span>?.();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!instance.<span class="property">props</span>?.<span class="property">disabled</span>) &#123;</span><br><span class="line">      <span class="title function_">_dfs</span>(children ?? [], <span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!nodePropsMap.<span class="title function_">has</span>(node)) <span class="keyword">return</span>;</span><br><span class="line">        node.<span class="property">props</span> = nodePropsMap.<span class="title function_">get</span>(node);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">_dfs</span>(children ?? [], <span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!node?.<span class="property">props</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      nodePropsMap.<span class="title function_">set</span>(node, <span class="title function_">cloneDeep</span>(node.<span class="property">props</span>));</span><br><span class="line">      node.<span class="property">props</span> = <span class="title function_">assign</span>(node?.<span class="property">props</span>, &#123;</span><br><span class="line">        <span class="attr">style</span>: &#123;</span><br><span class="line">          <span class="attr">cursor</span>: <span class="string">&quot;not-allowed&quot;</span>,</span><br><span class="line">          <span class="attr">color</span>: <span class="string">&quot;var(--er-text-color-placeholder)&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useDisabledStyle;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-useEventListener-ts"><a href="#â”œâ”€-useEventListener-ts" class="headerlink" title="â”œâ”€ useEventListener.ts"></a>â”œâ”€ useEventListener.ts</h3><blockquote><p>å°è£…äº†ä¸€ä¸ªé€šç”¨çš„ <strong>äº‹ä»¶ç›‘å¬å™¨</strong></p></blockquote><blockquote><p>æ”¯æŒåœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…</p><p>è‡ªåŠ¨ç»‘å®šå’Œè§£ç»‘äº‹ä»¶</p><p>é¿å…å†…å­˜æ³„æ¼</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  onMounted,</span><br><span class="line">  onBeforeUnmount,</span><br><span class="line">  watch,</span><br><span class="line">  isRef,</span><br><span class="line">  unref,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">MaybeRef</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useEventListener</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">target</span>: <span class="title class_">MaybeRef</span>&lt;<span class="title class_">EventTarget</span> | <span class="title class_">HTMLElement</span> | <span class="built_in">void</span>&gt;,</span></span><br><span class="line"><span class="params">  <span class="attr">event</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">handler</span>: (e: Event) =&gt; <span class="built_in">any</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isRef</span>(target)) &#123;</span><br><span class="line">    <span class="title function_">watch</span>(target, <span class="function">(<span class="params">val, oldVal</span>) =&gt;</span> &#123;</span><br><span class="line">      oldVal?.<span class="title function_">removeEventListener</span>(event, handler);</span><br><span class="line">      val?.<span class="title function_">addEventListener</span>(event, handler);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> target?.<span class="title function_">addEventListener</span>(event, handler));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> <span class="title function_">unref</span>(target)?.<span class="title function_">removeEventListener</span>(event, handler));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-useFocusController-ts"><a href="#â”œâ”€-useFocusController-ts" class="headerlink" title="â”œâ”€ useFocusController.ts"></a>â”œâ”€ useFocusController.ts</h3><blockquote><p>å¯¹ç„¦ç‚¹çš„ç®¡ç†åŠŸèƒ½</p></blockquote><blockquote><p>èšç„¦æŸä¸ªå…ƒç´ æˆ–åœ¨å¤šä¸ªå…ƒç´ ä¹‹é—´åˆ‡æ¢ç„¦ç‚¹</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isFunction &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getCurrentInstance, ref, <span class="keyword">type</span> <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useEventListener <span class="keyword">from</span> <span class="string">&quot;./useEventListener&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UseFocusControllerOptions</span> &#123;</span><br><span class="line">  afterFocus?(): <span class="built_in">void</span>;</span><br><span class="line">  beforeBlur?(<span class="attr">event</span>: <span class="title class_">FocusEvent</span>): <span class="built_in">boolean</span> | <span class="built_in">void</span>;</span><br><span class="line">  afterBlur?(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> useFocusController&lt;T <span class="keyword">extends</span> <span class="title class_">HTMLElement</span> | &#123; <span class="title function_">focus</span>(): <span class="built_in">void</span> &#125;&gt;(</span><br><span class="line">  <span class="attr">target</span>: <span class="title class_">Ref</span>&lt;T | <span class="built_in">void</span>&gt;,</span><br><span class="line">  &#123; afterFocus, beforeBlur, afterBlur &#125;: <span class="title class_">UseFocusControllerOptions</span> = &#123;&#125;</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">getCurrentInstance</span>()!;</span><br><span class="line">  <span class="keyword">const</span> &#123; emit &#125; = instance;</span><br><span class="line">  <span class="keyword">const</span> wrapperRef = ref&lt;<span class="title class_">HTMLElement</span>&gt;();</span><br><span class="line">  <span class="keyword">const</span> isFocused = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleFocus</span> = (<span class="params"><span class="attr">event</span>: <span class="title class_">FocusEvent</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (isFocused.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line">    isFocused.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="title function_">emit</span>(<span class="string">&quot;focus&quot;</span>, event);</span><br><span class="line">    afterFocus?.();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleBlur</span> = (<span class="params"><span class="attr">event</span>: <span class="title class_">FocusEvent</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> cancelBlur = <span class="title function_">isFunction</span>(beforeBlur) ? <span class="title function_">beforeBlur</span>(event) : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      cancelBlur ||</span><br><span class="line">      (event.<span class="property">relatedTarget</span> &amp;&amp;</span><br><span class="line">        wrapperRef.<span class="property">value</span>?.<span class="title function_">contains</span>(event.<span class="property">relatedTarget</span> <span class="keyword">as</span> <span class="title class_">Node</span>))</span><br><span class="line">    )</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    isFocused.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="title function_">emit</span>(<span class="string">&quot;blur&quot;</span>, event);</span><br><span class="line">    afterBlur?.();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    target.<span class="property">value</span>?.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEventListener</span>(wrapperRef, <span class="string">&quot;click&quot;</span>, handleClick);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    wrapperRef,</span><br><span class="line">    isFocused,</span><br><span class="line">    handleFocus,</span><br><span class="line">    handleBlur,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useFocusController;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-useId-ts"><a href="#â”œâ”€-useId-ts" class="headerlink" title="â”œâ”€ useId.ts"></a>â”œâ”€ useId.ts</h3><blockquote><p>ç”Ÿæˆå”¯ä¸€çš„ ID</p></blockquote><blockquote><p>é€šå¸¸ç”¨äºç»„ä»¶å†…éƒ¨éœ€è¦å”¯ä¸€æ ‡è¯†ç¬¦çš„åœºæ™¯</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Ref</span>, computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultIdInjection = &#123;</span><br><span class="line">  <span class="attr">prefix</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10000</span>),</span><br><span class="line">  <span class="attr">current</span>: <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useId</span>(<span class="params"><span class="attr">namespace</span>: <span class="built_in">string</span> = <span class="string">&quot;er&quot;</span></span>): <span class="title class_">Ref</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> idRef = <span class="title function_">computed</span>(</span><br><span class="line">    <span class="function">() =&gt;</span></span><br><span class="line">      <span class="string">`<span class="subst">$&#123;namespace&#125;</span>-id-<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        defaultIdInjection.prefix</span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;</span>-<span class="subst">$&#123;defaultIdInjection.current++&#125;</span>`</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> idRef;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useId;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-useLocale-ts"><a href="#â”œâ”€-useLocale-ts" class="headerlink" title="â”œâ”€ useLocale.ts"></a>â”œâ”€ useLocale.ts</h3><blockquote><p>æä¾›å›½é™…åŒ–ï¼ˆi18nï¼‰æ”¯æŒ</p></blockquote><blockquote><p>åŠ¨æ€è·å–å½“å‰è¯­è¨€ç¯å¢ƒä¸‹çš„æ–‡æœ¬å†…å®¹</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; inject, <span class="keyword">type</span> <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; omit &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createI18n, i18nSymbol, <span class="keyword">type</span> I18nInstance &#125; <span class="keyword">from</span> <span class="string">&quot;vue3-i18n&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Language</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/locale&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">English</span> <span class="keyword">from</span> <span class="string">&quot;@eric-ui/locale/lang/en&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useLocale</span>(<span class="params"><span class="attr">localeOverrides</span>?: <span class="title class_">Ref</span>&lt;<span class="title class_">Language</span>&gt;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!localeOverrides) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">omit</span>(</span><br><span class="line">      &lt;I18nInstance&gt;(</span><br><span class="line">        <span class="title function_">inject</span>(</span><br><span class="line">          i18nSymbol,</span><br><span class="line">          <span class="title function_">createI18n</span>(&#123; <span class="attr">locale</span>: <span class="title class_">English</span>.<span class="property">name</span>, <span class="attr">messages</span>: &#123; <span class="attr">en</span>: <span class="title class_">English</span>.<span class="property">el</span> &#125; &#125;)</span><br><span class="line">        )</span><br><span class="line">      ),</span><br><span class="line">      <span class="string">&quot;install&quot;</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">omit</span>(</span><br><span class="line">    <span class="title function_">createI18n</span>(&#123;</span><br><span class="line">      <span class="attr">locale</span>: localeOverrides.<span class="property">value</span>.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">messages</span>: &#123;</span><br><span class="line">        <span class="attr">en</span>: <span class="title class_">English</span>.<span class="property">el</span>,</span><br><span class="line">        [localeOverrides.<span class="property">value</span>.<span class="property">name</span>]: localeOverrides.<span class="property">value</span>.<span class="property">el</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="string">&quot;install&quot;</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useLocale;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-useOffset-ts"><a href="#â”œâ”€-useOffset-ts" class="headerlink" title="â”œâ”€ useOffset.ts"></a>â”œâ”€ useOffset.ts</h3><blockquote><p>è®¡ç®—æŸä¸ª DOM å…ƒç´ ç›¸å¯¹äºè§†å£æˆ–å…¶ä»–çˆ¶çº§å…ƒç´ çš„åç§»é‡</p></blockquote><blockquote><p>å®ç° <strong>æ‚¬æµ®å±‚</strong>ã€**å¼¹å‡ºæ¡† **ç­‰éœ€è¦ç²¾ç¡®å®šä½çš„åŠŸèƒ½</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Ref</span>, computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> useOffsetOptions &#123;</span><br><span class="line">  <span class="comment">// id: string;</span></span><br><span class="line">  <span class="attr">offset</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">boxHeight</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line">  <span class="attr">getLastBottomOffset</span>: <span class="function">() =&gt;</span> <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> useOffsetResult &#123;</span><br><span class="line">  <span class="attr">topOffset</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line">  <span class="attr">bottomOffset</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useOffset</span>(<span class="params"><span class="attr">opts</span>: useOffsetOptions</span>): useOffsetResult &#123;</span><br><span class="line">  <span class="comment">// ä¸Šä¸€ä¸ªå®ä¾‹æœ€ä¸‹é¢çš„åæ ‡ï¼Œç¬¬ä¸€ä¸ªæ˜¯0</span></span><br><span class="line">  <span class="keyword">const</span> lastBottomOffset = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> opts.<span class="title function_">getLastBottomOffset</span>());</span><br><span class="line">  <span class="comment">// æœ¬å…ƒç´ åº”è¯¥çš„ top</span></span><br><span class="line">  <span class="keyword">const</span> topOffset = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> opts.<span class="property">offset</span> + lastBottomOffset.<span class="property">value</span>);</span><br><span class="line">  <span class="comment">// ä¸ºä¸‹ä¸€ä¸ªå®ä¾‹é¢„ç•™çš„åº•éƒ¨ offset</span></span><br><span class="line">  <span class="keyword">const</span> bottomOffset = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> topOffset.<span class="property">value</span> + opts.<span class="property">boxHeight</span>.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    topOffset,</span><br><span class="line">    bottomOffset,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useOffset;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-useProp-ts"><a href="#â”œâ”€-useProp-ts" class="headerlink" title="â”œâ”€ useProp.ts"></a>â”œâ”€ useProp.ts</h3><blockquote><p>å°è£…äº†å¯¹ç»„ä»¶ <code>props</code> çš„å¤„ç†é€»è¾‘</p></blockquote><blockquote><p>æä¾›æ›´å®‰å…¨çš„é»˜è®¤å€¼å’Œç±»å‹æ£€æŸ¥</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; computed, getCurrentInstance, <span class="keyword">type</span> <span class="title class_">ComputedRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> useProp&lt;T&gt;(<span class="attr">propName</span>: <span class="built_in">string</span>): <span class="title class_">ComputedRef</span>&lt;T | <span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">getCurrentInstance</span>();</span><br><span class="line">  <span class="keyword">if</span> (!instance) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;useProp must be used within a component&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">computed</span>(<span class="function">() =&gt;</span> (instance?.<span class="property">proxy</span>?.<span class="property">$props</span> <span class="keyword">as</span> <span class="built_in">any</span>)?.[propName] <span class="keyword">as</span> T);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-useZIndex-ts"><a href="#â”œâ”€-useZIndex-ts" class="headerlink" title="â”œâ”€ useZIndex.ts"></a>â”œâ”€ useZIndex.ts</h3><blockquote><p>ç®¡ç†å¼¹çª—çš„ <code>z-index</code>å±‚çº§,ç¡®ä¿ç»„ä»¶çš„å±‚çº§å…³ç³»æ­£ç¡®</p></blockquote><blockquote><p>å¦‚ <strong>å¼¹çª—</strong>ã€**åŠ è½½é®ç½© **ç­‰</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; computed, ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> zIndex = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useZIndex</span>(<span class="params">initialValue = <span class="number">2000</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> _initialValue = <span class="title function_">ref</span>(initialValue);</span><br><span class="line">  <span class="keyword">const</span> currentZindex = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> zIndex.<span class="property">value</span> + _initialValue.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">nextZIndex</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    zIndex.<span class="property">value</span>++;</span><br><span class="line">    <span class="keyword">return</span> currentZindex.<span class="property">value</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">initialValue</span>: _initialValue,</span><br><span class="line">    currentZindex,</span><br><span class="line">    nextZIndex,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-vite-config-ts"><a href="#â”œâ”€-vite-config-ts" class="headerlink" title="â”œâ”€ vite.config.ts"></a>â”œâ”€ vite.config.ts</h3><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; last, split, first, includes &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hooksPlugin <span class="keyword">as</span> hooks &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/vite-plugins&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dts <span class="keyword">from</span> <span class="string">&quot;vite-plugin-dts&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">dts</span>(&#123;</span><br><span class="line">      <span class="attr">include</span>: [<span class="string">&quot;./**/*.ts&quot;</span>],</span><br><span class="line">      <span class="attr">exclude</span>: [<span class="string">&quot;./vite.config.ts&quot;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">hooks</span>(&#123;</span><br><span class="line">      <span class="attr">rmFiles</span>: [<span class="string">&quot;./dist&quot;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">minify</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">lib</span>: &#123;</span><br><span class="line">      <span class="attr">entry</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./index.ts&quot;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;hooks&quot;</span>,</span><br><span class="line">      <span class="attr">fileName</span>: <span class="string">&quot;index&quot;</span>,</span><br><span class="line">      <span class="attr">formats</span>: [<span class="string">&quot;es&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">      <span class="attr">external</span>: [<span class="string">&quot;vue&quot;</span>, <span class="string">&quot;lodash-es&quot;</span>, <span class="string">&quot;vue3-i18n&quot;</span>],</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="title function_">manualChunks</span>(<span class="params">id</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">includes</span>(id, <span class="string">&quot;/packages/hooks/use&quot;</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">first</span>(<span class="title function_">split</span>(<span class="title function_">last</span>(<span class="title function_">split</span>(id, <span class="string">&quot;/&quot;</span>)), <span class="string">&quot;.&quot;</span>));</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="â””â”€-test"><a href="#â””â”€-test" class="headerlink" title="â””â”€ test"></a>â””â”€ <strong>test</strong></h3><blockquote><p>æµ‹è¯•æ–‡ä»¶</p></blockquote><h4 id="â”œâ”€-index-test-tsx"><a href="#â”œâ”€-index-test-tsx" class="headerlink" title="â”œâ”€ index.test.tsx"></a>â”œâ”€ index.test.tsx</h4><blockquote><p>å¯¹ <code>hooks</code> å…¥å£æ–‡ä»¶çš„å•å…ƒæµ‹è¯•</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, expect, it &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useClickOutside,useEventListener&#125; <span class="keyword">from</span> <span class="string">&#x27;..&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;hooks/index&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;useEventListener should be exported&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">expect</span>(useEventListener).<span class="title function_">toBeDefined</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;useClickOutside should be exported&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">expect</span>(useClickOutside).<span class="title function_">toBeDefined</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-useClickOutset-test-tsx"><a href="#â”œâ”€-useClickOutset-test-tsx" class="headerlink" title="â”œâ”€ useClickOutset.test.tsx"></a>â”œâ”€ useClickOutset.test.tsx</h4><blockquote><p>å¯¹ <code>useClickOutside</code> çš„å•å…ƒæµ‹è¯•</p></blockquote><blockquote><p>éªŒè¯å…¶ç‚¹å‡»å¤–éƒ¨åŒºåŸŸçš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸ</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, expect, it, vi &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, defineComponent &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useClickOutside <span class="keyword">from</span> <span class="string">&quot;../useClickOutside&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;hooks/useClickOutside&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should add &quot;click-outside&quot; listener&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> target = ref&lt;<span class="title class_">HTMLElement</span> | <span class="built_in">void</span>&gt;();</span><br><span class="line">    <span class="keyword">const</span> btnRef = ref&lt;<span class="title class_">HTMLButtonElement</span> | <span class="built_in">void</span>&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handler = vi.<span class="title function_">fn</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">mount</span>(</span><br><span class="line">      <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">        <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="title function_">useClickOutside</span>(target, handler);</span><br><span class="line">          <span class="keyword">return</span> <span class="function">() =&gt;</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;target&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">ref</span>=<span class="string">&#123;btnRef&#125;</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">          );</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> btnRef.<span class="property">value</span>?.<span class="title function_">click</span>();</span><br><span class="line">    <span class="title function_">expect</span>(handler).<span class="property">not</span>.<span class="title function_">toHaveBeenCalled</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">click</span>();</span><br><span class="line">    <span class="title function_">expect</span>(handler).<span class="title function_">toHaveBeenCalled</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â””â”€-useEventListener-test-tsx"><a href="#â””â”€-useEventListener-test-tsx" class="headerlink" title="â””â”€ useEventListener.test.tsx"></a>â””â”€ useEventListener.test.tsx</h4><blockquote><p>å¯¹ <code>useEventListener</code> çš„å•å…ƒæµ‹è¯•</p></blockquote><blockquote><p>éªŒè¯äº‹ä»¶ç›‘å¬å™¨çš„ç»‘å®šå’Œè§£ç»‘æ˜¯å¦æ­£å¸¸</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, expect, it, vi &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, defineComponent &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useEventListener <span class="keyword">from</span> <span class="string">&quot;../useEventListener&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;hooks/useEventListener&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should add and remove event listener when target is HTMLElement&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> target = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> handler = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(</span><br><span class="line">      <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">        <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="title function_">useEventListener</span>(target, <span class="string">&quot;click&quot;</span>, handler);</span><br><span class="line">          <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">    wrapper.<span class="title function_">get</span>(<span class="string">&quot;#container&quot;</span>).<span class="property">element</span>.<span class="title function_">appendChild</span>(target);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> target.<span class="title function_">click</span>();</span><br><span class="line">    <span class="title function_">expect</span>(handler).<span class="title function_">toHaveBeenCalledOnce</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">unmount</span>();</span><br><span class="line">    <span class="keyword">await</span> target.<span class="title function_">click</span>();</span><br><span class="line">    <span class="title function_">expect</span>(handler).<span class="title function_">toHaveBeenCalledOnce</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should add and remove event listener when target is Ref&lt;HTMLElement&gt;&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> target = ref&lt;<span class="title class_">HTMLElement</span> | <span class="built_in">void</span>&gt;();</span><br><span class="line">    <span class="keyword">const</span> handler = vi.<span class="title function_">fn</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">mount</span>(</span><br><span class="line">      <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">        <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="title function_">useEventListener</span>(target, <span class="string">&quot;click&quot;</span>, handler);</span><br><span class="line">          <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;target&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;container&#x27;</span>)?.<span class="title function_">click</span>()</span><br><span class="line">    <span class="keyword">await</span> target.<span class="property">value</span>?.<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(handler).<span class="title function_">toHaveBeenCalledOnce</span>();</span><br><span class="line"></span><br><span class="line">    target.<span class="property">value</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;container&#x27;</span>)?.<span class="title function_">click</span>()</span><br><span class="line">    <span class="title function_">expect</span>(handler).<span class="title function_">toHaveBeenCalledOnce</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="â”œâ”€-locale"><a href="#â”œâ”€-locale" class="headerlink" title="â”œâ”€ locale"></a>â”œâ”€ <em><del>locale</del></em></h2><blockquote><p>å›½é™…åŒ–</p></blockquote><h3 id="â”œâ”€-index-ts-22"><a href="#â”œâ”€-index-ts-22" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h3><h3 id="â”œâ”€-lang"><a href="#â”œâ”€-lang" class="headerlink" title="â”œâ”€ lang"></a>â”œâ”€ lang</h3><blockquote><p>è¯­è¨€åŒ…</p></blockquote><h4 id="â”œâ”€-en-ts"><a href="#â”œâ”€-en-ts" class="headerlink" title="â”œâ”€ en.ts"></a>â”œâ”€ en.ts</h4><h4 id="â”œâ”€-ja-ts"><a href="#â”œâ”€-ja-ts" class="headerlink" title="â”œâ”€ ja.ts"></a>â”œâ”€ ja.ts</h4><h4 id="â”œâ”€-ko-ts"><a href="#â”œâ”€-ko-ts" class="headerlink" title="â”œâ”€ ko.ts"></a>â”œâ”€ ko.ts</h4><h4 id="â”œâ”€-zh-cn-ts"><a href="#â”œâ”€-zh-cn-ts" class="headerlink" title="â”œâ”€ zh-cn.ts"></a>â”œâ”€ zh-cn.ts</h4><h4 id="â””â”€-zh-tw-ts"><a href="#â””â”€-zh-tw-ts" class="headerlink" title="â””â”€ zh-tw.ts"></a>â””â”€ zh-tw.ts</h4><h3 id="â””â”€-package-json-3"><a href="#â””â”€-package-json-3" class="headerlink" title="â””â”€ package.json"></a>â””â”€ package.json</h3><blockquote><p>ç©ºåŒ…</p></blockquote><h2 id="â”œâ”€-play"><a href="#â”œâ”€-play" class="headerlink" title="â”œâ”€ play"></a>â”œâ”€ <em><del>play</del></em></h2><blockquote><p>storybookå®éªŒå®¤</p></blockquote><h3 id="â”œâ”€-storybook"><a href="#â”œâ”€-storybook" class="headerlink" title="â”œâ”€ .storybook"></a>â”œâ”€ .storybook</h3><h4 id="â”œâ”€-main-js"><a href="#â”œâ”€-main-js" class="headerlink" title="â”œâ”€ main.js"></a>â”œâ”€ main.js</h4><h4 id="â””â”€-preview-js"><a href="#â””â”€-preview-js" class="headerlink" title="â””â”€ preview.js"></a>â””â”€ preview.js</h4><h3 id="â”œâ”€-index-html"><a href="#â”œâ”€-index-html" class="headerlink" title="â”œâ”€ index.html"></a>â”œâ”€ index.html</h3><h3 id="â”œâ”€-public"><a href="#â”œâ”€-public" class="headerlink" title="â”œâ”€ public"></a>â”œâ”€ public</h3><h4 id="â””â”€-vite-svg"><a href="#â””â”€-vite-svg" class="headerlink" title="â””â”€ vite.svg"></a>â””â”€ vite.svg</h4><h3 id="â”œâ”€-src"><a href="#â”œâ”€-src" class="headerlink" title="â”œâ”€ src"></a>â”œâ”€ src</h3><h4 id="â”œâ”€-App-vue"><a href="#â”œâ”€-App-vue" class="headerlink" title="â”œâ”€ App.vue"></a>â”œâ”€ App.vue</h4><h4 id="â”œâ”€-main-ts"><a href="#â”œâ”€-main-ts" class="headerlink" title="â”œâ”€ main.ts"></a>â”œâ”€ main.ts</h4><h4 id="â”œâ”€-stories"><a href="#â”œâ”€-stories" class="headerlink" title="â”œâ”€ stories"></a>â”œâ”€ stories</h4><h5 id="â”œâ”€-Alert-stories-tsx"><a href="#â”œâ”€-Alert-stories-tsx" class="headerlink" title="â”œâ”€ Alert.stories.tsx"></a>â”œâ”€ Alert.stories.tsx</h5><h5 id="â”œâ”€-Button-stories-ts"><a href="#â”œâ”€-Button-stories-ts" class="headerlink" title="â”œâ”€ Button.stories.ts"></a>â”œâ”€ Button.stories.ts</h5><h5 id="â””â”€-Collapse-stories-ts"><a href="#â””â”€-Collapse-stories-ts" class="headerlink" title="â””â”€ Collapse.stories.ts"></a>â””â”€ Collapse.stories.ts</h5><h4 id="â””â”€-vite-env-d-ts"><a href="#â””â”€-vite-env-d-ts" class="headerlink" title="â””â”€ vite-env.d.ts"></a>â””â”€ vite-env.d.ts</h4><h3 id="â”œâ”€-vite-config-ts-1"><a href="#â”œâ”€-vite-config-ts-1" class="headerlink" title="â”œâ”€ vite.config.ts"></a>â”œâ”€ vite.config.ts</h3><h3 id="â”œâ”€-README-md"><a href="#â”œâ”€-README-md" class="headerlink" title="â”œâ”€ README.md"></a>â”œâ”€ README.md</h3><h3 id="â””â”€-package-json-4"><a href="#â””â”€-package-json-4" class="headerlink" title="â””â”€ package.json"></a>â””â”€ package.json</h3><p><strong>é¡¹ç›®ä¾èµ–</strong></p><blockquote><p>æ— ï¼Œé€šè¿‡æ ¹ç›®å½•ç»§æ‰¿</p></blockquote><p><strong>å¼€å‘ä¾èµ–</strong></p><blockquote><ul><li><code>@chromatic-com/storybook</code>ï¼šChromatic æˆªå›¾æµ‹è¯•å·¥å…·</li><li><code>@storybook/addon-*</code>ï¼šStorybook çš„æ‰©å±•æ’ä»¶</li><li><code>@storybook/vue3</code>ï¼šStorybook çš„ Vue 3 æ”¯æŒ</li><li><code>@storybook/vue3-vite</code>ï¼šStorybook çš„ Vite é›†æˆ</li><li><code>@vitejs/plugin-vue</code>ï¼šVite çš„ Vue æ’ä»¶</li><li><code>chromatic</code>ï¼šChromatic å‘½ä»¤è¡Œå·¥å…·</li><li><code>storybook</code>ï¼šStorybook æ ¸å¿ƒ</li></ul></blockquote><h2 id="â”œâ”€-theme"><a href="#â”œâ”€-theme" class="headerlink" title="â”œâ”€ theme"></a>â”œâ”€ <em><del>theme</del></em></h2><blockquote><p>æ ·å¼ç³»ç»Ÿ</p><p><strong>æ ·å¼æ„å»ºæµç¨‹é›†ä¸­åœ¨ <code>core</code> åŒ…</strong></p><p>é‡‡ç”¨ <strong>æ ¸å¿ƒåŒ…æ‰˜ç®¡æ¨¡å¼</strong></p><p><code>theme</code> åŒ…ä»…ä½œä¸ºæºç å­˜åœ¨</p></blockquote><h3 id="â”œâ”€-index-css"><a href="#â”œâ”€-index-css" class="headerlink" title="â”œâ”€ index.css"></a>â”œâ”€ index.css</h3><h3 id="â”œâ”€-package-json-3"><a href="#â”œâ”€-package-json-3" class="headerlink" title="â”œâ”€ package.json"></a>â”œâ”€ package.json</h3><p><strong>é¡¹ç›®ä¾èµ–</strong></p><blockquote><p>æ— </p></blockquote><h3 id="â””â”€-reset-css"><a href="#â””â”€-reset-css" class="headerlink" title="â””â”€ reset.css"></a>â””â”€ reset.css</h3><h2 id="â””â”€-utils"><a href="#â””â”€-utils" class="headerlink" title="â””â”€ utils"></a>â””â”€ <em><del>utils</del></em></h2><blockquote><p>å·¥å…·å‡½æ•°å’Œè¾…åŠ©æ–¹æ³•ï¼Œæ”¯æŒç»„ä»¶åº“çš„åº•å±‚é€»è¾‘</p></blockquote><h3 id="â”œâ”€-error-ts"><a href="#â”œâ”€-error-ts" class="headerlink" title="â”œâ”€ error.ts"></a>â”œâ”€ error.ts</h3><blockquote><p>é”™è¯¯å¤„ç†ç›¸å…³çš„å·¥å…·å‡½æ•°</p><p>ä¾‹å¦‚ <strong>æŠ›å‡ºé”™è¯¯</strong>ã€<strong>æ•è·å¼‚å¸¸</strong> ç­‰</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isString &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ErUIError</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">message</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(message);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;ErUIError&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">throwError</span>(<span class="params"><span class="attr">scope</span>: <span class="built_in">string</span>, <span class="attr">msg</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ErUIError</span>(<span class="string">`[<span class="subst">$&#123;scope&#125;</span>] <span class="subst">$&#123;msg&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debugWarn</span>(<span class="params"><span class="attr">error</span>: <span class="title class_">Error</span></span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debugWarn</span>(<span class="params"><span class="attr">scope</span>: <span class="built_in">string</span>, <span class="attr">msg</span>: <span class="built_in">string</span></span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debugWarn</span>(<span class="params"><span class="attr">scope</span>: <span class="built_in">string</span> | <span class="title class_">Error</span>, <span class="attr">msg</span>?: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&quot;production&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> err = <span class="title function_">isString</span>(scope) ? <span class="keyword">new</span> <span class="title class_">ErUIError</span>(<span class="string">`[<span class="subst">$&#123;scope&#125;</span>] <span class="subst">$&#123;msg&#125;</span>`</span>) : scope;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">warn</span>(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-index-ts-23"><a href="#â”œâ”€-index-ts-23" class="headerlink" title="â”œâ”€ index.ts"></a>â”œâ”€ index.ts</h3><blockquote><p>å¯¼å‡ºå…¬å…±ç±»å‹æˆ–æ¥å£</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isFunction &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">RenderVnode</span> = <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">vNode</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: [<span class="title class_">String</span>, <span class="title class_">Object</span>, <span class="title class_">Function</span>],</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> (<span class="title function_">isFunction</span>(props.<span class="property">vNode</span>) ? props.<span class="title function_">vNode</span>() : props.<span class="property">vNode</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> typeIconMap = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">  [<span class="string">&quot;info&quot;</span>, <span class="string">&quot;circle-info&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;success&quot;</span>, <span class="string">&quot;check-circle&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;warning&quot;</span>, <span class="string">&quot;circle-exclamation&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;danger&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./install&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./error&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./style&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-install-ts"><a href="#â”œâ”€-install-ts" class="headerlink" title="â”œâ”€ install.ts"></a>â”œâ”€ install.ts</h3><blockquote><p>ç»™installé™„åŠ ä¸€äº›æ–¹æ³•å’Œå¯¹è±¡</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">App</span>, <span class="title class_">Plugin</span>, <span class="title class_">Directive</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; noop &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt; = T &amp; <span class="title class_">Plugin</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withInstall = &lt;T&gt;<span class="function">(<span class="params"><span class="attr">component</span>: T</span>) =&gt;</span> &#123;</span><br><span class="line">  (component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;).<span class="property">install</span> = <span class="function">(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> name = (component <span class="keyword">as</span> <span class="built_in">any</span>)?.<span class="property">name</span> || <span class="string">&quot;UnnamedComponent&quot;</span>;</span><br><span class="line">    app.<span class="title function_">component</span>(name, component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withInstallFunction = &lt;T&gt;<span class="function">(<span class="params"><span class="attr">fn</span>: T, <span class="attr">name</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  (fn <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;).<span class="property">install</span> = <span class="function">(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt;</span> &#123;</span><br><span class="line">    app.<span class="property">config</span>.<span class="property">globalProperties</span>[name] = fn;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> fn <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withInstallDirective = &lt;T <span class="keyword">extends</span> <span class="title class_">Directive</span>&gt;(</span><br><span class="line">  <span class="attr">directive</span>: T,</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">): <span class="title class_">SFCWithInstall</span>&lt;T&gt; =&gt; &#123;</span><br><span class="line">  (directive <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;).<span class="property">install</span> = <span class="function">(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt;</span> &#123;</span><br><span class="line">    app.<span class="title function_">directive</span>(name, directive);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> directive <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withNoopInstall = &lt;T&gt;<span class="function">(<span class="params"><span class="attr">component</span>: T</span>) =&gt;</span> &#123;</span><br><span class="line">  (component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;).<span class="property">install</span> = noop;</span><br><span class="line">  <span class="keyword">return</span> component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸¾ä¾‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErButton</span> = <span class="title function_">withInstall</span>(<span class="title class_">Button</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErButtonGroup</span> = <span class="title function_">withInstall</span>(<span class="title class_">ButtonGroup</span>);</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h3 id="â”œâ”€-package-json-4"><a href="#â”œâ”€-package-json-4" class="headerlink" title="â”œâ”€ package.json"></a>â”œâ”€ package.json</h3><p><strong>ä¾èµ–</strong></p><blockquote><p>æ— </p></blockquote><h3 id="â”œâ”€-style-ts"><a href="#â”œâ”€-style-ts" class="headerlink" title="â”œâ”€ style.ts"></a>â”œâ”€ style.ts</h3><blockquote><p>å¤„ç†åŠ¨æ€æ ·å¼æˆ– CSS å˜é‡</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isNumber, isString &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; debugWarn &#125; <span class="keyword">from</span> <span class="string">&quot;./error&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SCOPE</span> = <span class="string">&quot;utils/style&quot;</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isStringNumber = (<span class="attr">val</span>: <span class="built_in">string</span>): <span class="function"><span class="params">boolean</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isString</span>(val)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> !<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="title class_">Number</span>(val));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">addUnit</span>(<span class="params"><span class="attr">value</span>?: <span class="built_in">string</span> | <span class="built_in">number</span>, defaultUnit = <span class="string">&quot;px&quot;</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!value) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isNumber</span>(value) || <span class="title function_">isStringNumber</span>(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;value&#125;</span><span class="subst">$&#123;defaultUnit&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isString</span>(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">debugWarn</span>(<span class="variable constant_">SCOPE</span>, <span class="string">&quot;binding value must be a string or number&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â””â”€-tests"><a href="#â””â”€-tests" class="headerlink" title="â””â”€ tests"></a>â””â”€ <strong>tests</strong></h3><h4 id="â”œâ”€-error-test-tsx"><a href="#â”œâ”€-error-test-tsx" class="headerlink" title="â”œâ”€ error.test.tsx"></a>â”œâ”€ error.test.tsx</h4><blockquote><p>å¯¹ <code>error.ts</code> çš„å•å…ƒæµ‹è¯•ï¼ŒéªŒè¯é”™è¯¯å¤„ç†é€»è¾‘æ˜¯å¦æ­£ç¡®</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;describe,expect,it,vi&#125; <span class="keyword">from</span> <span class="string">&#x27;vitest&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;debugWarn,throwError&#125; <span class="keyword">from</span> <span class="string">&#x27;../error&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;error&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;throwError should work&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="title function_">throwError</span>(<span class="string">&#x27;scope&#x27;</span>, <span class="string">&#x27;message&#x27;</span>)</span><br><span class="line">    &#125;).<span class="title function_">toThrowError</span>(<span class="string">&#x27;[scope] message&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;debugWarn should work&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> warn = vi.<span class="title function_">spyOn</span>(<span class="variable language_">console</span>, <span class="string">&#x27;warn&#x27;</span>).<span class="title function_">mockImplementation</span>(<span class="function">()=&gt;</span> vi.<span class="property">fn</span>)</span><br><span class="line">    <span class="title function_">debugWarn</span>(<span class="string">&#x27;scope&#x27;</span>,<span class="string">&#x27;message&#x27;</span>)</span><br><span class="line">    <span class="title function_">debugWarn</span>(<span class="keyword">new</span> <span class="title class_">SyntaxError</span>(<span class="string">&#x27;custom error&#x27;</span>))</span><br><span class="line">    <span class="title function_">expect</span>(warn.<span class="property">mock</span>.<span class="property">calls</span>).<span class="title function_">toMatchInlineSnapshot</span>(<span class="string">`</span></span><br><span class="line"><span class="string">      [</span></span><br><span class="line"><span class="string">        [</span></span><br><span class="line"><span class="string">          [ErUIError: [scope] message],</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">        [</span></span><br><span class="line"><span class="string">          [SyntaxError: custom error],</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    `</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="â”œâ”€-index-test-tsx-1"><a href="#â”œâ”€-index-test-tsx-1" class="headerlink" title="â”œâ”€ index.test.tsx"></a>â”œâ”€ index.test.tsx</h4><blockquote><p>å¯¹ <code>utils</code> å…¥å£æ–‡ä»¶çš„å•å…ƒæµ‹è¯•</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, expect, it &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  debugWarn,</span><br><span class="line">  throwError,</span><br><span class="line">  withInstall,</span><br><span class="line">  typeIconMap,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; each &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;utils/index&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;debugWarn should be exported&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(debugWarn).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;throwError should be exported&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(throwError).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;withInstall should be exported&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(withInstall).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;typeIconMap should be worked&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(typeIconMap).<span class="title function_">toBeDefined</span>();</span><br><span class="line">    <span class="title function_">each</span>(</span><br><span class="line">      [</span><br><span class="line">        [<span class="string">&quot;info&quot;</span>, <span class="string">&quot;circle-info&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;success&quot;</span>, <span class="string">&quot;check-circle&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;warning&quot;</span>, <span class="string">&quot;circle-exclamation&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;danger&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">      ],</span><br><span class="line">      <span class="function">(<span class="params">[<span class="keyword">type</span>, icon]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">expect</span>(typeIconMap.<span class="title function_">get</span>(<span class="keyword">type</span>)).<span class="title function_">toBe</span>(icon);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="â””â”€-install-test-tsx"><a href="#â””â”€-install-test-tsx" class="headerlink" title="â””â”€ install.test.tsx"></a>â””â”€ install.test.tsx</h4><blockquote><p>å¯¹ <code>install.ts</code> çš„å•å…ƒæµ‹è¯•ï¼ŒéªŒè¯ç»„ä»¶æ³¨å†Œé€»è¾‘æ˜¯å¦æ­£å¸¸</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, expect, it &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent, createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;../install&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AppComp</span> = <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>app<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> componentA = <span class="title function_">withInstall</span>(</span><br><span class="line">  <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> componentB = <span class="title function_">withInstall</span>(</span><br><span class="line">  <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;test2&quot;</span>,</span><br><span class="line">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>test2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;install&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;withInstall should be worked&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wapper = <span class="title function_">mount</span>(<span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>);</span><br><span class="line">    <span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">AppComp</span>);</span><br><span class="line"></span><br><span class="line">    app.<span class="title function_">use</span>(componentA).<span class="title function_">use</span>(componentB).<span class="title function_">mount</span>(wapper.<span class="property">element</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(componentA.<span class="property">install</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">    <span class="title function_">expect</span>(componentB.<span class="property">install</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wapper.<span class="title function_">findComponent</span>(componentA)).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wapper.<span class="title function_">findComponent</span>(componentB)).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="â”œâ”€-package-json-5"><a href="#â”œâ”€-package-json-5" class="headerlink" title="â”œâ”€ package.json"></a>â”œâ”€ <em><del>package.json</del></em></h1><blockquote><p>æ ¹ç›®å½•ä¾èµ–</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tyche&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm --filter @tyche/play dev&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;story&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm --filter @tyche/play storybook&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;docs:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm --filter @tyche/docs dev&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;docs:build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm --filter @tyche/docs build&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm --filter @tyche/components test&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;run-s build-hooks build-components&quot;</span><span class="punctuation">,</span><span class="comment">//æ„å»º @tyche/docs å­é¡¹ç›®çš„é™æ€æ–‡æ¡£ç«™ç‚¹</span></span><br><span class="line"><span class="attr">&quot;build-components&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cross-env NODE_ENV=production pnpm --filter tyche build&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;build-hooks&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cross-env NODE_ENV=production pnpm --filter @tyche/hooks build&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;build:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;run-s build-hooks:dev build-components:dev&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;build-components:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cross-env NODE_ENV=development pnpm --filter tyche build:watch&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;build-hooks:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cross-env NODE_ENV=development pnpm --filter @tyche/hooks build&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;keywords&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;packageManager&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm@10.4.1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//å¼€å‘ä¾èµ–</span></span><br><span class="line"><span class="attr">&quot;@types/lodash-es&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.17.12&quot;</span><span class="punctuation">,</span><span class="comment">//Lodash çš„ TypeScript ç±»å‹å®šä¹‰</span></span><br><span class="line"><span class="attr">&quot;@types/node&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^20.12.12&quot;</span><span class="punctuation">,</span><span class="comment">//Node.js çš„ TypeScript ç±»å‹å®šä¹‰</span></span><br><span class="line"><span class="attr">&quot;@types/shelljs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.8.15&quot;</span><span class="punctuation">,</span><span class="comment">//Shell.js çš„ TypeScript ç±»å‹å®šä¹‰</span></span><br><span class="line"><span class="attr">&quot;@vitejs/plugin-vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.2.3&quot;</span><span class="punctuation">,</span><span class="comment">//Vite çš„ Vue æ’ä»¶</span></span><br><span class="line"><span class="attr">&quot;@vitejs/plugin-vue-jsx&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.1.0&quot;</span><span class="punctuation">,</span><span class="comment">//Vite çš„ Vue JSX æ’ä»¶</span></span><br><span class="line"><span class="attr">&quot;@vitest/coverage-v8&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.6.1&quot;</span><span class="punctuation">,</span><span class="comment">//Vitest çš„è¦†ç›–ç‡æ’ä»¶</span></span><br><span class="line"><span class="attr">&quot;@vue/test-utils&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.4.5&quot;</span><span class="punctuation">,</span><span class="comment">//Vue æµ‹è¯•å·¥å…·</span></span><br><span class="line"><span class="attr">&quot;@vue/tsconfig&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.5.1&quot;</span><span class="punctuation">,</span><span class="comment">//Vue çš„ TypeScript é…ç½®</span></span><br><span class="line"><span class="attr">&quot;cross-env&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.0.3&quot;</span><span class="punctuation">,</span><span class="comment">//è·¨å¹³å°ç¯å¢ƒå˜é‡è®¾ç½®</span></span><br><span class="line"><span class="attr">&quot;cssnano&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.0.1&quot;</span><span class="punctuation">,</span><span class="comment">//CSS å‹ç¼©å·¥å…·</span></span><br><span class="line"><span class="attr">&quot;jsdom&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^24.0.0&quot;</span><span class="punctuation">,</span><span class="comment">//JavaScript DOM ç¯å¢ƒæ¨¡æ‹Ÿ</span></span><br><span class="line"><span class="attr">&quot;npm-run-all&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.1.5&quot;</span><span class="punctuation">,</span><span class="comment">//å¹¶è¡Œè¿è¡Œè„šæœ¬</span></span><br><span class="line"><span class="attr">&quot;postcss-color-mix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.1.0&quot;</span><span class="punctuation">,</span><span class="comment">//PostCSS æ’ä»¶</span></span><br><span class="line"><span class="attr">&quot;postcss-each&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;postcss-each-variables&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.3.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;postcss-for&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.1.1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;postcss-nested&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;prettier&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.2.5&quot;</span><span class="punctuation">,</span><span class="comment">//ä»£ç æ ¼å¼åŒ–å·¥å…·</span></span><br><span class="line"><span class="attr">&quot;rollup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.18.0&quot;</span><span class="punctuation">,</span><span class="comment">//æ‰“åŒ…å·¥å…·</span></span><br><span class="line"><span class="attr">&quot;shelljs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.8.5&quot;</span><span class="punctuation">,</span><span class="comment">//Shell å‘½ä»¤å°è£…</span></span><br><span class="line"><span class="attr">&quot;typescript&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.4.5&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.4.14&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vite-plugin-dts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.9.1&quot;</span><span class="punctuation">,</span><span class="comment">//ç”Ÿæˆ TypeScript å£°æ˜æ–‡ä»¶</span></span><br><span class="line"><span class="attr">&quot;vitest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.6.1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vue-tsc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.8.27&quot;</span><span class="comment">//Vue çš„ TypeScript ç¼–è¯‘å™¨</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;@fortawesome/fontawesome-svg-core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.5.2&quot;</span><span class="punctuation">,</span><span class="comment">//Font Awesome å›¾æ ‡åº“æ ¸å¿ƒ</span></span><br><span class="line"><span class="attr">&quot;@fortawesome/free-solid-svg-icons&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.5.2&quot;</span><span class="punctuation">,</span><span class="comment">//Font Awesome å®ä½“å›¾æ ‡</span></span><br><span class="line"><span class="attr">&quot;@fortawesome/vue-fontawesome&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.8&quot;</span><span class="punctuation">,</span><span class="comment">//Vue 3 çš„ Font Awesome é›†æˆ</span></span><br><span class="line"><span class="attr">&quot;@popperjs/core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.11.8&quot;</span><span class="punctuation">,</span><span class="comment">//ç”¨äºå¼¹çª—å®šä½çš„ Popper.js</span></span><br><span class="line"><span class="attr">&quot;@tyche/components&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span><span class="comment">//å·¥ä½œåŒºå†…çš„ç»„ä»¶åº“</span></span><br><span class="line"><span class="attr">&quot;@tyche/hooks&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span><span class="comment">//å·¥ä½œåŒºå†…çš„é’©å­åº“</span></span><br><span class="line"><span class="attr">&quot;@tyche/theme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span><span class="comment">//å·¥ä½œåŒºå†…çš„ä¸»é¢˜åº“</span></span><br><span class="line"><span class="attr">&quot;@tyche/utils&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span><span class="comment">//å·¥ä½œåŒºå†…çš„å·¥å…·åº“</span></span><br><span class="line"><span class="attr">&quot;@tyche/locale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span><span class="comment">//å·¥ä½œåŒºå†…çš„å›½é™…åŒ–åº“</span></span><br><span class="line"><span class="attr">&quot;@tyche/constants&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span><span class="comment">//å·¥ä½œåŒºå†…çš„å¸¸é‡åº“</span></span><br><span class="line"><span class="attr">&quot;async-validator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.2.5&quot;</span><span class="punctuation">,</span><span class="comment">//è¡¨å•éªŒè¯åº“</span></span><br><span class="line"><span class="attr">&quot;lodash-es&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.17.21&quot;</span><span class="punctuation">,</span><span class="comment">//Lodash çš„ ES æ¨¡å—ç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">&quot;tyche&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.5.13&quot;</span><span class="comment">//Vue3æ ¸å¿ƒåº“</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>å¼€å‘ä¾èµ–</strong></p><blockquote><ul><li><code>vue3-i18n</code>ï¼šVue å›½é™…åŒ–åº“</li></ul></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æ€»ç»“</span><br><span class="line">æ ¸å¿ƒä¾èµ–ï¼š</span><br><span class="line">vueï¼šæ‰€æœ‰ Vue 3 ç›¸å…³åŒ…çš„ä¾èµ–ã€‚</span><br><span class="line">@fortawesome/fontawesome-svg-coreï¼šå›¾æ ‡åº“ã€‚</span><br><span class="line">async-validatorï¼šè¡¨å•éªŒè¯ã€‚</span><br><span class="line">å¼€å‘ä¾èµ–ï¼š</span><br><span class="line">æµ‹è¯•ï¼švitest, @vue/test-utilsã€‚</span><br><span class="line">æ„å»ºï¼švite, rollupã€‚</span><br><span class="line">å·¥å…·ï¼štypescript, prettierã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pnpm ls &lt;package-name&gt;  # æŸ¥çœ‹ä¾èµ–æ ‘</span><br><span class="line">pnpm why &lt;package-name&gt; # æŸ¥çœ‹ä¾èµ–åŸå› </span><br></pre></td></tr></table></figure><h1 id="â”œâ”€-pnpm-lock-yaml"><a href="#â”œâ”€-pnpm-lock-yaml" class="headerlink" title="â”œâ”€ pnpm-lock.yaml"></a>â”œâ”€ <em><del>pnpm-lock.yaml</del></em></h1><blockquote><p>ç¯å¢ƒğŸ”’</p></blockquote><h1 id="â”œâ”€-pnpm-workspace-yaml"><a href="#â”œâ”€-pnpm-workspace-yaml" class="headerlink" title="â”œâ”€ pnpm-workspace.yaml"></a>â”œâ”€ <em><del>pnpm-workspace.yaml</del></em></h1><blockquote><p>PNPM å·¥ä½œåŒºçš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºç®¡ç†å¤šä¸ªåŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">packages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;packages/*&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;libs/*&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ‰€æœ‰ä½äº <code>packages</code> ç›®å½•ä¸‹çš„å­ç›®å½•éƒ½è¢«è§†ä¸ºç‹¬ç«‹çš„åŒ…ï¼Œå¹¶ä¸”æ˜¯å·¥ä½œåŒºçš„ä¸€éƒ¨åˆ†</p><p>åŒæ ·çš„ï¼Œ<code>libs</code> ç›®å½•ä¸‹çš„å­ç›®å½•ä¹Ÿè¢«è§†ä¸ºç‹¬ç«‹çš„åŒ…ï¼Œè¢«è§†ä¸ºå·¥ä½œåŒºçš„ä¸€éƒ¨åˆ†</p></blockquote><blockquote><p>å¦‚æœä½ æœ‰ä¸€ä¸ªåŒ…åœ¨ <code>packages</code> æ–‡ä»¶å¤¹ä¸­ä¾èµ–äº†å¦ä¸€ä¸ªä½äº <code>libs</code> æ–‡ä»¶å¤¹ä¸­çš„åŒ…ï¼ŒPNPM ä¸ä¼šä»è¿œç¨‹ä»“åº“ä¸‹è½½è¯¥ä¾èµ–ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥æŒ‡å‘è¯¥æœ¬åœ°åŒ…çš„ä½ç½®ã€‚</p></blockquote><blockquote><p>å½“ä½ åœ¨ä¸€ä¸ªå·¥ä½œåŒºå†…çš„ä»»æ„ä¸€ä¸ªåŒ…ä¸­å®‰è£…ä¾èµ–æ—¶ï¼ŒPNPM ä¼šå°†è¿™äº›ä¾èµ–å®‰è£…åœ¨å·¥ä½œåŒºæ ¹ç›®å½•ä¸‹çš„ <code>node_modules</code> æ–‡ä»¶å¤¹å†…ã€‚å·¥ä½œåŒºå†…æ‰€æœ‰çš„åŒ…å¯ä»¥å…±äº«ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ï¼Œå‡å°‘äº†é‡å¤å®‰è£…å’Œå­˜å‚¨ç©ºé—´çš„æµªè´¹</p></blockquote><h1 id="â”œâ”€-postcss-config-cjs"><a href="#â”œâ”€-postcss-config-cjs" class="headerlink" title="â”œâ”€ postcss.config.cjs"></a>â”œâ”€ <em><del>postcss.config.cjs</del></em></h1><blockquote><p><em>PostCSS</em> æ˜¯ä¸€ä¸ªä½¿ç”¨ JavaScript è½¬æ¢ CSS çš„å·¥å…·</p><p>è¯¥æ–‡ä»¶æ˜¯ <em>PostCSS</em> çš„é…ç½®æ–‡ä»¶</p><p>è¯¦æƒ…è§æ–‡æ¡£ <a href="https://www.postcss.com.cn/">PostCSSä¸­æ–‡ç½‘</a>  æˆ–  <a href="https://github.com/postcss/postcss#usage">Github&#x2F;postcss</a></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-env node */</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"><span class="comment">// publicPath: process.env.NODE_ENV === &#x27;production&#x27; ? &#x27;/Tyche/&#x27; : &#x27;/&#x27;,</span></span><br><span class="line"><span class="attr">plugins</span>: [<span class="comment">//ä¸€ç³»åˆ— PostCSS æ’ä»¶</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;postcss-nested&#x27;</span>),<span class="comment">//æ”¯æŒåµŒå¥—</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;postcss-each-variables&#x27;</span>),<span class="comment">//å¾ªç¯åŠŸèƒ½</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;postcss-each&#x27;</span>)(&#123;</span><br><span class="line"><span class="attr">plugins</span>: &#123;</span><br><span class="line"><span class="attr">beforeEach</span>: [<span class="built_in">require</span>(<span class="string">&#x27;postcss-for&#x27;</span>), <span class="built_in">require</span>(<span class="string">&#x27;postcss-color-mix&#x27;</span>)],<span class="comment">//forï¼šå¾ªç¯æ§åˆ¶ï¼›color-mixï¼šé¢œè‰²æ··åˆ</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;),</span><br><span class="line">],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="â”œâ”€-tsconfig-build-json"><a href="#â”œâ”€-tsconfig-build-json" class="headerlink" title="â”œâ”€ tsconfig.build.json"></a>â”œâ”€ tsconfig.build.json</h1><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h1 id="â”œâ”€-tsconfig-json"><a href="#â”œâ”€-tsconfig-json" class="headerlink" title="â”œâ”€ tsconfig.json"></a>â”œâ”€ <em><del>tsconfig.json</del></em></h1><blockquote><p>TypeScript ç¼–è¯‘å™¨çš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰å¦‚ä½•ç¼–è¯‘é¡¹ç›®ä¸­çš„ TypeScript æ–‡ä»¶</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;extends&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@vue/tsconfig/tsconfig.dom.json&quot;</span><span class="punctuation">,</span><span class="comment">//ä½¿ç”¨ Vue æä¾›çš„åŸºç¡€ TypeScript é…ç½®ï¼Œå¹¶åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•ã€‚</span></span><br><span class="line">    <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//åŒ…å«ä¸€ç³»åˆ—ç¼–è¯‘é€‰é¡¹</span></span><br><span class="line">        <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ES2020&quot;</span><span class="punctuation">,</span><span class="comment">//ç¼–è¯‘åçš„ JavaScript ç›®æ ‡ç‰ˆæœ¬ä¸º ES2020</span></span><br><span class="line">        <span class="attr">&quot;useDefineForClassFields&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span><span class="comment">//ä½¿ç”¨ &quot;ESNext&quot; æ¨¡å—ç³»ç»Ÿä¸ºäº†æ”¯æŒæœ€æ–°çš„ ECMAScript æ¨¡å—æ ‡å‡†</span></span><br><span class="line">        <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ES2020&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DOM&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DOM.Iterable&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="comment">//åˆ—å‡ºäº†ç¼–è¯‘è¿‡ç¨‹ä¸­éœ€è¦åŒ…å«çš„åº“æ–‡ä»¶</span></span><br><span class="line">        <span class="attr">&quot;skipLibCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="comment">//å¿½ç•¥æ‰€æœ‰å£°æ˜æ–‡ä»¶ï¼ˆ.d.tsï¼‰çš„ç±»å‹æ£€æŸ¥ï¼ŒåŠ å¿«ç¼–è¯‘é€Ÿåº¦</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Bundler mode */</span></span><br><span class="line">        <span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bundler&quot;</span><span class="punctuation">,</span><span class="comment">//é€‚åº”ç°ä»£æ„å»ºå·¥å…·å¦‚ Vite çš„æ¨¡å—è§£ææœºåˆ¶</span></span><br><span class="line">        <span class="attr">&quot;allowImportingTsExtensions&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;resolveJsonModule&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;isolatedModules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;noEmit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;jsx&quot;</span><span class="punctuation">:</span> <span class="string">&quot;preserve&quot;</span><span class="punctuation">,</span><span class="comment">//JSX å°†è¢«ä¿ç•™ä»¥ä¾¿åç»­å¤„ç†</span></span><br><span class="line">        <span class="attr">&quot;jsxImportSource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Linting */</span></span><br><span class="line">        <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="comment">//ä¸¥æ ¼æ¨¡å¼</span></span><br><span class="line">        <span class="attr">&quot;noUnusedLocals&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="comment">//ç¦æ­¢æœªä½¿ç”¨çš„å±€éƒ¨å˜é‡</span></span><br><span class="line">        <span class="attr">&quot;noUnusedParameters&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="comment">//ç¦æ­¢æœªä½¿ç”¨çš„å‡½æ•°å‚æ•°</span></span><br><span class="line">        <span class="attr">&quot;noFallthroughCasesInSwitch&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="comment">//åº”è¢«åŒ…å«åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­çš„æ–‡ä»¶</span></span><br><span class="line">        <span class="string">&quot;env.d.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;packages/**/*.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;packages/**/*.tsx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;packages/**/*.vue&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;packages/play/src/stories/*.stories.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;vitest.config.ts&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;packages/components/vitest.config.ts&quot;</span><span class="punctuation">,</span><span class="string">&quot;packages/components/index.test.ts&quot;</span><span class="punctuation">]</span><span class="comment">//åº”è¢«æ’é™¤åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­çš„æ–‡ä»¶</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="â”œâ”€-tsconfig-node-json"><a href="#â”œâ”€-tsconfig-node-json" class="headerlink" title="â”œâ”€ tsconfig.node.json"></a>â”œâ”€ <em><del>tsconfig.node.json</del></em></h1><blockquote><p>ä¸“é—¨ä¸º Node.js ç¯å¢ƒä¸‹çš„ TypeScript é…ç½®æ–‡ä»¶</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;extends&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@tsconfig/node18/tsconfig.json&quot;</span><span class="punctuation">,</span><span class="comment">//åŸºäº Node.js 18 ç‰ˆæœ¬çš„æ ‡å‡†é…ç½®</span></span><br><span class="line"><span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;packages/**/**.config.ts&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="comment">//æ‰€æœ‰ä»¥ .config.ts ç»“å°¾çš„æ–‡ä»¶éƒ½åº”è¯¥è¢«åŒ…å«è¿›æ¥</span></span><br><span class="line"><span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;composite&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="comment">//è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªå¤åˆé¡¹ç›®ï¼Œå¯ä»¥ä¸å…¶ä»–é¡¹ç›®å…±äº«ç¼–è¯‘è¾“å‡º</span></span><br><span class="line"><span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span><span class="comment">//ä½¿ç”¨ &quot;ESNext&quot; æ¨¡å—ç³»ç»Ÿä¸ºäº†æ”¯æŒæœ€æ–°çš„ ECMAScript æ¨¡å—æ ‡å‡†</span></span><br><span class="line"><span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bundler&quot;</span><span class="punctuation">,</span><span class="comment">//é€‚åº”ç°ä»£æ„å»ºå·¥å…·å¦‚ Vite çš„æ¨¡å—è§£ææœºåˆ¶</span></span><br><span class="line"><span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;node&quot;</span><span class="punctuation">]</span><span class="comment">//æŒ‡å®šè¦åŒ…å«çš„ç±»å‹å£°æ˜ï¼Œç¡®ä¿ Node.js çš„å…¨å±€å˜é‡å’Œæ¨¡å—éƒ½èƒ½è¢«æ­£ç¡®è¯†åˆ«</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="â”œâ”€-vitest-config-ts"><a href="#â”œâ”€-vitest-config-ts" class="headerlink" title="â”œâ”€ vitest.config.ts"></a>â”œâ”€ <em><del>vitest.config.ts</del></em></h1><blockquote><p>Vitest æµ‹è¯•æ¡†æ¶çš„é…ç½®æ–‡ä»¶</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;vitest&quot; /&gt; //å¼•ç”¨ç±»å‹å£°æ˜:å‘Šè¯‰TypeScriptç¼–è¯‘å™¨åŒ…å«Vitestçš„ç±»å‹å®šä¹‰</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>; <span class="comment">//å®šä¹‰é…ç½®å¯¹è±¡å‡½æ•°</span></span><br><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> vueJsx <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-vue-jsx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [<span class="title function_">vue</span>(), <span class="title function_">vueJsx</span>()],<span class="comment">//è¢«åº”ç”¨åˆ° Vite æ„å»ºè¿‡ç¨‹ä¸­çš„æ’ä»¶[å¯¹ Vue å•æ–‡ä»¶ç»„ä»¶çš„æ”¯æŒ &amp; JSX è¯­æ³•çš„æ”¯æŒ]</span></span><br><span class="line">    <span class="attr">define</span>: &#123; <span class="comment">//å®šä¹‰å…¨å±€å¸¸é‡(PROD, DEV, TEST)</span></span><br><span class="line">        <span class="attr">PROD</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="literal">false</span>),</span><br><span class="line">        <span class="attr">DEV</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="literal">false</span>),</span><br><span class="line">        <span class="attr">TEST</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="literal">true</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">test</span>: &#123;</span><br><span class="line">        <span class="attr">globals</span>: <span class="literal">true</span>, <span class="comment">//å°†æµ‹è¯•æ¡†æ¶æš´éœ²ä¸ºå…¨å±€å˜é‡,å¯ä»¥ç›´æ¥ä½¿ç”¨ describe, it, expect ç­‰è€Œæ— éœ€æ¯æ¬¡éƒ½å¯¼å…¥</span></span><br><span class="line">        <span class="attr">environment</span>: <span class="string">&quot;jsdom&quot;</span>, <span class="comment">//æµ‹è¯•å°†åœ¨æ¨¡æ‹Ÿçš„æµè§ˆå™¨ç¯å¢ƒä¸­è¿è¡Œï¼Œå¯¹æ ‡éœ€è¦ DOM æ“ä½œçš„æµ‹è¯•</span></span><br><span class="line">        <span class="attr">setupFiles</span>:[<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./vitest.setup.ts&#x27;</span>)] <span class="comment">//æŒ‡å®švitest.setup.tsåœ¨æ‰€æœ‰æµ‹è¯•ä¹‹å‰è‡ªåŠ¨è¿è¡Œï¼Œç”¨äºå…¨å±€çš„åˆå§‹åŒ–å·¥ä½œ</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="â””â”€-vitest-setup-ts"><a href="#â””â”€-vitest-setup-ts" class="headerlink" title="â””â”€ vitest.setup.ts"></a>â””â”€ <em><del>vitest.setup.ts</del></em></h1><blockquote><p>é€šå¸¸ç”¨äºåœ¨è¿è¡Œæµ‹è¯•ä¹‹å‰æ‰§è¡Œä¸€äº›åˆå§‹åŒ–é€»è¾‘</p><p>åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œåˆå§‹åŒ– FontAwesome å›¾æ ‡åº“ï¼Œæ•´ä¸ªæµ‹è¯•è¿‡ç¨‹ä¸­ä½¿ç”¨ Solid é£æ ¼çš„å›¾æ ‡</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; library &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/fontawesome-svg-core&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fas &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/free-solid-svg-icons&quot;</span>;<span class="comment">//æ‰€æœ‰çš„ Solid é£æ ¼å›¾æ ‡é›†</span></span><br><span class="line"></span><br><span class="line">library.<span class="title function_">add</span>(fas);<span class="comment">//å°† Solid å›¾æ ‡æ·»åŠ åˆ°äº† FontAwesome çš„åº“ä¸­</span></span><br><span class="line"><span class="comment">//ä»»ä½•éœ€è¦ä½¿ç”¨ Solid å›¾æ ‡çš„ç»„ä»¶æˆ–æµ‹è¯•éƒ½å¯ä»¥ç›´æ¥è®¿é—®è¿™äº›å›¾æ ‡ï¼Œè€Œä¸éœ€è¦å†æ¬¡å•ç‹¬å¼•å…¥å®ƒä»¬</span></span><br></pre></td></tr></table></figure><blockquote><p>é¿å…äº†ç”±äºå›¾æ ‡æœªåŠ è½½è€Œå¯¼è‡´çš„æµ‹è¯•å¤±è´¥</p></blockquote><p><em>æ‰©å±•</em></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; library &#125; <span class="keyword">from</span> <span class="string">&#x27;@fortawesome/fontawesome-svg-core&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fas &#125; <span class="keyword">from</span> <span class="string">&#x27;@fortawesome/free-solid-svg-icons&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; far &#125; <span class="keyword">from</span> <span class="string">&#x27;@fortawesome/free-regular-svg-icons&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fab &#125; <span class="keyword">from</span> <span class="string">&#x27;@fortawesome/free-brands-svg-icons&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FontAwesomeIcon</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@fortawesome/vue-fontawesome&#x27;</span></span><br><span class="line">library.<span class="title function_">add</span>(fas,far,fab)</span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">component</span>(<span class="string">&#x27;font-awesome-icon&#x27;</span>, <span class="title class_">FontAwesomeIcon</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¤§å°</span></span><br><span class="line">&lt;font-awesome-icon icon=<span class="string">&quot;fa-solid fa-house&quot;</span> size=<span class="string">&quot;xs&quot;</span>/&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">size</span>=<span class="string">&quot;lg&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">size</span>=<span class="string">&quot;2x&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">size</span>=<span class="string">&quot;4x&quot;</span>/&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ—‹è½¬</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">rotation</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">rotation</span>=<span class="string">&quot;90&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">rotation</span>=<span class="string">&quot;180&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">rotation</span>=<span class="string">&quot;270&quot;</span>/&gt;</span></span></span><br></pre></td></tr></table></figure><h1 id="å„å·¥ä½œåŒºä¾èµ–ç¯å¢ƒè¯¦æƒ…"><a href="#å„å·¥ä½œåŒºä¾èµ–ç¯å¢ƒè¯¦æƒ…" class="headerlink" title="å„å·¥ä½œåŒºä¾èµ–ç¯å¢ƒè¯¦æƒ…"></a>å„å·¥ä½œåŒºä¾èµ–ç¯å¢ƒè¯¦æƒ…</h1><h2 id="æ ¹ç›®å½•"><a href="#æ ¹ç›®å½•" class="headerlink" title="æ ¹ç›®å½•"></a>æ ¹ç›®å½•</h2><ul><li><strong>ç”Ÿäº§ç¯å¢ƒä¾èµ–</strong><ul><li>@tyche&#x2F;components: workspace:*</li><li>@tyche&#x2F;hooks: workspace:*</li><li>@tyche&#x2F;theme: workspace:*</li><li>@tyche&#x2F;utils: workspace:*</li><li>@tyche&#x2F;locale: workspace:*</li><li>@tyche&#x2F;constants: workspace:*</li><li>@tyche&#x2F;vite-plugins: workspace:*</li><li>@fortawesome&#x2F;fontawesome-svg-core: ^6.5.2</li><li>@fortawesome&#x2F;free-solid-svg-icons: ^6.5.2</li><li>@fortawesome&#x2F;vue-fontawesome: ^3.0.8</li><li>@popperjs&#x2F;core: ^2.11.8</li><li>@vitepress-preview&#x2F;component: workspace:*</li><li>async-validator: ^4.2.5</li><li>eric-ui: workspace:*</li><li>lodash-es: ^4.17.21</li><li>vue: ^3.4.27</li></ul></li><li><strong>å¼€å‘ç¯å¢ƒä¾èµ–</strong><ul><li>@types&#x2F;lodash-es: ^4.17.12</li><li>@types&#x2F;node: ^20.12.12</li><li>@types&#x2F;shelljs: ^0.8.15</li><li>@vitejs&#x2F;plugin-vue: ^5.0.4</li><li>@vitejs&#x2F;plugin-vue-jsx: ^3.1.0</li><li>@vitest&#x2F;coverage-v8: ^1.4.0</li><li>@vue&#x2F;test-utils: ^2.4.5</li><li>@vue&#x2F;tsconfig: ^0.5.1</li><li>cross-env: ^7.0.3</li><li>cssnano: ^7.0.1</li><li>jsdom: ^24.0.0</li><li>npm-run-all: ^4.1.5</li><li>postcss-color-mix: ^1.1.0</li><li>postcss-each: ^1.1.0</li><li>postcss-each-variables: ^0.3.0</li><li>postcss-for: ^2.1.1</li><li>postcss-nested: ^6.0.1</li><li>prettier: ^3.2.5</li><li>rollup: ^4.18.0</li><li>shelljs: ^0.8.5</li><li>typescript: ^5.4.5</li><li>vite: ^5.2.11</li><li>vite-plugin-dts: ^3.9.1</li><li>vitest: ^1.6.0</li><li>vue-tsc: ^1.8.27</li><li>vue3-i18n: ^1.1.5</li></ul></li></ul><h3 id="packages-utils"><a href="#packages-utils" class="headerlink" title="&#x2F;packages&#x2F;utils"></a>&#x2F;packages&#x2F;utils</h3><ul><li><strong>ç”Ÿäº§ç¯å¢ƒä¾èµ–</strong>: æ— æ˜ç¡®å£°æ˜</li><li>å¼€å‘ç¯å¢ƒä¾èµ–<ul><li>æ— ï¼ˆä»…åŒ…å«ä¸€ä¸ªæµ‹è¯•è„šæœ¬ï¼‰</li></ul></li></ul><h3 id="packages-components"><a href="#packages-components" class="headerlink" title="&#x2F;packages&#x2F;components"></a>&#x2F;packages&#x2F;components</h3><ul><li>ç”Ÿäº§ç¯å¢ƒä¾èµ–<ul><li>axios: ^1.6.8 (åœ¨ devDependencies ä¸­, å¯èƒ½æ˜¯è¯¯ç½®)</li></ul></li><li>å¼€å‘ç¯å¢ƒä¾èµ–<ul><li>æ— æ˜ç¡®å£°æ˜ï¼ˆé™¤äº† axios å¤–ï¼‰</li></ul></li></ul><h3 id="packages-constants"><a href="#packages-constants" class="headerlink" title="&#x2F;packages&#x2F;constants"></a>&#x2F;packages&#x2F;constants</h3><ul><li><strong>ç”Ÿäº§ç¯å¢ƒä¾èµ–</strong>: æ— </li><li><strong>å¼€å‘ç¯å¢ƒä¾èµ–</strong>: æ— </li></ul><h3 id="packages-core"><a href="#packages-core" class="headerlink" title="&#x2F;packages&#x2F;core"></a>&#x2F;packages&#x2F;core</h3><ul><li>ç”Ÿäº§ç¯å¢ƒä¾èµ–<ul><li>@fortawesome&#x2F;fontawesome-svg-core: ^6.5.1</li><li>@fortawesome&#x2F;free-solid-svg-icons: ^6.5.1</li><li>@fortawesome&#x2F;vue-fontawesome: ^3.0.6</li><li>@popperjs&#x2F;core: ^2.11.8</li><li>async-validator: ^4.2.5</li></ul></li><li>å¼€å‘ç¯å¢ƒä¾èµ–<ul><li>@rollup&#x2F;plugin-terser: ^0.4.4</li><li>rollup-plugin-visualizer: ^5.12.0</li><li>terser: ^5.31.0</li><li>vite-plugin-compression: ^0.5.1</li></ul></li></ul><h3 id="packages-docs"><a href="#packages-docs" class="headerlink" title="&#x2F;packages&#x2F;docs"></a>&#x2F;packages&#x2F;docs</h3><ul><li><strong>ç”Ÿäº§ç¯å¢ƒä¾èµ–</strong>: æ— </li><li>å¼€å‘ç¯å¢ƒä¾èµ–<ul><li>@vitepress-demo-preview&#x2F;component: ^2.3.2</li><li>@vitepress-demo-preview&#x2F;plugin: ^1.2.3</li><li>vitepress: 1.1.4</li></ul></li></ul><h3 id="packages-hooks"><a href="#packages-hooks" class="headerlink" title="&#x2F;packages&#x2F;hooks"></a>&#x2F;packages&#x2F;hooks</h3><ul><li><strong>ç”Ÿäº§ç¯å¢ƒä¾èµ–</strong>: æ— </li><li>å¼€å‘ç¯å¢ƒä¾èµ–<ul><li>æ— ï¼ˆä½†æœ‰ peerDependenciesï¼‰</li><li>peerDependencies:<ul><li>vue: ^3.4.27</li><li>lodash-es: ^4.17.21</li></ul></li></ul></li></ul><h3 id="packages-locale"><a href="#packages-locale" class="headerlink" title="&#x2F;packages&#x2F;locale"></a>&#x2F;packages&#x2F;locale</h3><ul><li><strong>ç”Ÿäº§ç¯å¢ƒä¾èµ–</strong>: æ— </li><li><strong>å¼€å‘ç¯å¢ƒä¾èµ–</strong>: æ— </li></ul><h3 id="packages-play"><a href="#packages-play" class="headerlink" title="&#x2F;packages&#x2F;play"></a>&#x2F;packages&#x2F;play</h3><ul><li><strong>ç”Ÿäº§ç¯å¢ƒä¾èµ–</strong>: æ— </li><li><strong>å¼€å‘ç¯å¢ƒä¾èµ–</strong>: æ— </li></ul><h3 id="packages-theme"><a href="#packages-theme" class="headerlink" title="&#x2F;packages&#x2F;theme"></a>&#x2F;packages&#x2F;theme</h3><ul><li><strong>ç”Ÿäº§ç¯å¢ƒä¾èµ–</strong>: æ— </li><li>å¼€å‘ç¯å¢ƒä¾èµ–<ul><li>@chromatic-com&#x2F;storybook: 1.3.3</li><li>@storybook&#x2F;addon-essentials: ^8.0.10</li><li>@storybook&#x2F;addon-interactions: ^8.0.10</li><li>@storybook&#x2F;addon-links: ^8.0.10</li><li>@storybook&#x2F;blocks: ^8.0.10</li><li>@storybook&#x2F;test: ^8.0.10</li><li>@storybook&#x2F;vue3: ^8.0.10</li><li>@storybook&#x2F;vue3-vite: ^8.0.10</li><li>@vitejs&#x2F;plugin-vue: ^5.0.4</li><li>chromatic: ^11.3.1</li><li>storybook: ^8.0.10</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¯·æ³¨æ„ï¼Œå¯¹äº `/packages/components`ï¼Œå…¶ä¸­ `axios` è¢«æ”¾ç½®åœ¨ `devDependencies` ä¸­ï¼Œè¿™å¯èƒ½æ˜¯é”™è¯¯é…ç½®ï¼Œé™¤éå®ƒç¡®å®åªç”¨äºå¼€å‘ç¯å¢ƒã€‚æ­¤å¤–ï¼ŒæŸäº›åŒ…å¦‚ `/packages/hooks` ä½¿ç”¨äº† `peerDependencies` æ¥å®šä¹‰å…¶å¯¹å…¶ä»–åŒ…çš„ä¾èµ–å…³ç³»ï¼Œè¿™äº›ä¾èµ–éœ€è¦ç”±ä½¿ç”¨è€…æä¾›ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç»„ä»¶åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Tooltip æ–‡å­—ç»„ä»¶</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Tooltip%20%E6%96%87%E5%AD%97%E6%8F%90%E7%A4%BA/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Tooltip%20%E6%96%87%E5%AD%97%E6%8F%90%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<hr><h1 id="Tooltip-æ–‡å­—ç»„ä»¶"><a href="#Tooltip-æ–‡å­—ç»„ä»¶" class="headerlink" title="Tooltip æ–‡å­—ç»„ä»¶"></a>Tooltip æ–‡å­—ç»„ä»¶</h1><hr><h2 id="å¯¼å‡ºçš„ç±»å‹"><a href="#å¯¼å‡ºçš„ç±»å‹" class="headerlink" title="å¯¼å‡ºçš„ç±»å‹"></a>å¯¼å‡ºçš„ç±»å‹</h2><h3 id="1-TooltipProps"><a href="#1-TooltipProps" class="headerlink" title="1. TooltipProps"></a>1. <code>TooltipProps</code></h3><ul><li><strong>æè¿°</strong>: Tooltip ç»„ä»¶çš„ props é…ç½®ã€‚</li><li><strong>å­—æ®µ</strong>:<ul><li><code>content?</code>: <code>string</code><br>æç¤ºæ¡†æ˜¾ç¤ºçš„å†…å®¹æ–‡æœ¬ã€‚</li><li><code>trigger?</code>: <code>&#39;hover&#39; | &#39;click&#39; | &#39;contextmenu&#39;</code><br>è§¦å‘æ–¹å¼ï¼ˆé»˜è®¤ <code>&#39;hover&#39;</code>ï¼‰ã€‚</li><li><code>placement?</code>: <code>Placement</code><br>Popper.js çš„å®šä½ç­–ç•¥ï¼ˆå¦‚ <code>&#39;bottom&#39;</code>ï¼‰ã€‚</li><li><code>manual?</code>: <code>boolean</code><br>æ˜¯å¦æ‰‹åŠ¨æ§åˆ¶æ˜¾ç¤ºï¼ˆé»˜è®¤ <code>false</code>ï¼‰ã€‚</li><li><code>disabled?</code>: <code>boolean</code><br>æ˜¯å¦ç¦ç”¨ç»„ä»¶ï¼ˆé»˜è®¤ <code>false</code>ï¼‰ã€‚</li><li><code>popperOptions?</code>: <code>Partial&lt;Options&gt;</code><br>Popper.js çš„é…ç½®é€‰é¡¹ã€‚</li><li><code>transition?</code>: <code>string</code><br>è¿‡æ¸¡åŠ¨ç”»åç§°ï¼ˆé»˜è®¤ <code>&#39;fade&#39;</code>ï¼‰ã€‚</li><li><code>showTimeout?</code>: <code>number</code><br>æ˜¾ç¤ºå»¶è¿Ÿï¼ˆé»˜è®¤ <code>0</code>ï¼‰ã€‚</li><li><code>hideTimeout?</code>: <code>number</code><br>éšè—å»¶è¿Ÿï¼ˆé»˜è®¤ <code>200</code>ï¼‰ã€‚</li></ul></li></ul><hr><h3 id="2-TooltipEmits"><a href="#2-TooltipEmits" class="headerlink" title="2. TooltipEmits"></a>2. <code>TooltipEmits</code></h3><ul><li><strong>æè¿°</strong>: Tooltip ç»„ä»¶çš„äº‹ä»¶ç±»å‹ã€‚</li><li><strong>å­—æ®µ</strong>:<ul><li><code>&#39;visible-change&#39;</code>: <code>(value: boolean) =&gt; void</code><br>æç¤ºæ¡†æ˜¾ç¤ºçŠ¶æ€å˜åŒ–æ—¶è§¦å‘ã€‚</li><li><code>&#39;click-outside&#39;</code>: <code>() =&gt; void</code><br>ç‚¹å‡»å¤–éƒ¨åŒºåŸŸæ—¶è§¦å‘ã€‚</li></ul></li></ul><hr><h3 id="3-TooltipInstance"><a href="#3-TooltipInstance" class="headerlink" title="3. TooltipInstance"></a>3. <code>TooltipInstance</code></h3><ul><li><strong>æè¿°</strong>: Tooltip ç»„ä»¶æš´éœ²ç»™å¤–éƒ¨çš„æ¥å£ã€‚</li><li><strong>å­—æ®µ</strong>:<ul><li><code>show()</code>: æ‰‹åŠ¨æ˜¾ç¤ºæç¤ºæ¡†ã€‚</li><li><code>hide()</code>: æ‰‹åŠ¨éšè—æç¤ºæ¡†ã€‚</li></ul></li></ul><hr><hr><h2 id="å…³é”®ä»£ç è§£é‡Š"><a href="#å…³é”®ä»£ç è§£é‡Š" class="headerlink" title="å…³é”®ä»£ç è§£é‡Š"></a>å…³é”®ä»£ç è§£é‡Š</h2><h3 id="1-defineOptions"><a href="#1-defineOptions" class="headerlink" title="1. defineOptions"></a>1. <code>defineOptions</code></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;VrTooltip&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>ä½œç”¨</strong>: å®šä¹‰ç»„ä»¶åç§°ä¸º <code>VrTooltip</code>ï¼Œåœ¨å…¨å±€æ³¨å†Œæ—¶å¯é€šè¿‡ <code>&lt;vr-tooltip&gt;</code> ä½¿ç”¨ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>: åœ¨ <code>packages/core/components.ts</code> ä¸­é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯¼å…¥å¹¶æ³¨å†Œï¼š<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">VrTooltip</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/components&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> components = [<span class="title class_">VrTooltip</span>];</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="2-withDefaults-è®¾ç½®é»˜è®¤å€¼"><a href="#2-withDefaults-è®¾ç½®é»˜è®¤å€¼" class="headerlink" title="2. withDefaults è®¾ç½®é»˜è®¤å€¼"></a>2. <code>withDefaults</code> è®¾ç½®é»˜è®¤å€¼</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;_TooltipProps&gt;(), &#123;</span><br><span class="line">    <span class="attr">placement</span>: <span class="string">&#x27;bottom&#x27;</span>,</span><br><span class="line">    <span class="attr">trigger</span>: <span class="string">&#x27;hover&#x27;</span>,</span><br><span class="line">    <span class="attr">transition</span>: <span class="string">&#x27;fade&#x27;</span>,</span><br><span class="line">    <span class="attr">showTimeout</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">hideTimeout</span>: <span class="number">200</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>ç¤ºä¾‹</strong>:<ul><li><code>placement</code> é»˜è®¤ä¸º <code>&#39;bottom&#39;</code>ã€‚</li><li><code>trigger</code> é»˜è®¤ä¸º <code>&#39;hover&#39;</code>ã€‚</li></ul></li></ul><hr><h3 id="3-äº‹ä»¶ç­–ç•¥æ˜ å°„"><a href="#3-äº‹ä»¶ç­–ç•¥æ˜ å°„" class="headerlink" title="3. äº‹ä»¶ç­–ç•¥æ˜ å°„"></a>3. <strong>äº‹ä»¶ç­–ç•¥æ˜ å°„</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">triggerStrategyMap</span>: <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="function">() =&gt;</span> <span class="built_in">void</span>&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">triggerStrategyMap.<span class="title function_">set</span>(<span class="string">&#x27;hover&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    events.<span class="property">value</span>[<span class="string">&#x27;mouseenter&#x27;</span>] = openFinal;</span><br><span class="line">    outerEvents.<span class="property">value</span>[<span class="string">&#x27;mouseleave&#x27;</span>] = closeFinal;</span><br><span class="line">    dropdownEvents.<span class="property">value</span>[<span class="string">&#x27;mouseenter&#x27;</span>] = openFinal;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// å…¶ä»–ç­–ç•¥ç±»ä¼¼</span></span><br></pre></td></tr></table></figure><ul><li><strong>ä½œç”¨</strong>: æ ¹æ® <code>trigger</code> ç±»å‹ç»‘å®šä¸åŒäº‹ä»¶ï¼ˆå¦‚ <code>&#39;hover&#39;</code> ç»‘å®šé¼ æ ‡æ‚¬åœäº‹ä»¶ï¼‰ã€‚</li></ul><hr><h3 id="4-é˜²æŠ–é€»è¾‘"><a href="#4-é˜²æŠ–é€»è¾‘" class="headerlink" title="4. é˜²æŠ–é€»è¾‘"></a>4. <strong>é˜²æŠ–é€»è¾‘</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    openDebounce = <span class="title function_">debounce</span>(<span class="title function_">bind</span>(setVisible, <span class="literal">null</span>, <span class="literal">true</span>), openDelay.<span class="property">value</span>);</span><br><span class="line">    closeDebounce = <span class="title function_">debounce</span>(<span class="title function_">bind</span>(setVisible, <span class="literal">null</span>, <span class="literal">false</span>), closeDelay.<span class="property">value</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>ä½œç”¨</strong>: é€šè¿‡ <code>debounce</code> å®ç°æ˜¾ç¤ºå’Œéšè—çš„å»¶è¿Ÿæ§åˆ¶ï¼ˆå¦‚ <code>showTimeout</code> å’Œ <code>hideTimeout</code>ï¼‰ã€‚</li></ul><hr><h3 id="5-Popper-js-é›†æˆ"><a href="#5-Popper-js-é›†æˆ" class="headerlink" title="5. Popper.js é›†æˆ"></a>5. <strong>Popper.js é›†æˆ</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(visible, <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!val) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (triggerNode.<span class="property">value</span> &amp;&amp; popperNode.<span class="property">value</span>) &#123;</span><br><span class="line">        popperInstance = <span class="title function_">createPopper</span>(</span><br><span class="line">            triggerNode.<span class="property">value</span>,</span><br><span class="line">            popperNode.<span class="property">value</span>,</span><br><span class="line">            popperOptions.<span class="property">value</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123; <span class="attr">flush</span>: <span class="string">&#x27;post&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>ä½œç”¨</strong>: æ ¹æ® <code>placement</code> å’Œ <code>popperOptions</code> åŠ¨æ€å®šä½æç¤ºæ¡†çš„ä½ç½®ã€‚</li></ul><hr><h3 id="6-è™šæ‹Ÿè§¦å‘èŠ‚ç‚¹å¤„ç†"><a href="#6-è™šæ‹Ÿè§¦å‘èŠ‚ç‚¹å¤„ç†" class="headerlink" title="6. è™šæ‹Ÿè§¦å‘èŠ‚ç‚¹å¤„ç†"></a>6. <strong>è™šæ‹Ÿè§¦å‘èŠ‚ç‚¹å¤„ç†</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> triggerNode = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">virtualTriggering</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            ((props.<span class="property">virtualRef</span> <span class="keyword">as</span> <span class="title class_">ButtonInstance</span>)?.<span class="property">ref</span> <span class="keyword">as</span> <span class="built_in">any</span>) ??</span><br><span class="line">            (props.<span class="property">virtualRef</span> <span class="keyword">as</span> <span class="title class_">HTMLElement</span>) ??</span><br><span class="line">            _triggerNode.<span class="property">value</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _triggerNode.<span class="property">value</span> <span class="keyword">as</span> <span class="title class_">HTMLElement</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>ä½œç”¨</strong>: æ”¯æŒé€šè¿‡ <code>virtualRef</code> ç»‘å®šå¤–éƒ¨ç»„ä»¶ï¼ˆå¦‚æŒ‰é’®ï¼‰ä½œä¸ºè§¦å‘å™¨ï¼Œè€Œéç›´æ¥æ¸²æŸ“çš„èŠ‚ç‚¹ã€‚</li></ul><hr><h3 id="7-äº‹ä»¶ç›‘å¬ä¸æ¸…ç†"><a href="#7-äº‹ä»¶ç›‘å¬ä¸æ¸…ç†" class="headerlink" title="7. äº‹ä»¶ç›‘å¬ä¸æ¸…ç†"></a>7. <strong>äº‹ä»¶ç›‘å¬ä¸æ¸…ç†</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">destroyPopperInstance</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>ä½œç”¨</strong>: åœ¨ç»„ä»¶å¸è½½æ—¶é”€æ¯ Popper å®ä¾‹å¹¶æ¸…ç†äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</li></ul><hr><h3 id="8-è‡ªå®šä¹‰é’©å­-useEventsToTiggerNode"><a href="#8-è‡ªå®šä¹‰é’©å­-useEventsToTiggerNode" class="headerlink" title="8. è‡ªå®šä¹‰é’©å­ useEventsToTiggerNode"></a>8. <strong>è‡ªå®šä¹‰é’©å­ <code>useEventsToTiggerNode</code></strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useEvenstToTiggerNode</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">props</span>: <span class="title class_">TooltipProps</span> &amp; &#123; virtualTriggering?: <span class="built_in">boolean</span> &#125;,</span></span><br><span class="line"><span class="params">  <span class="attr">triggerNode</span>: <span class="title class_">ComputedRef</span>&lt;<span class="title class_">HTMLElement</span> | <span class="literal">undefined</span>&gt;,</span></span><br><span class="line"><span class="params">  <span class="attr">events</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">EventListener</span>&gt;&gt;,</span></span><br><span class="line"><span class="params">  <span class="attr">closeMethod</span>: () =&gt; <span class="built_in">void</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// å†…éƒ¨å®ç°ç»‘å®š/è§£ç»‘äº‹ä»¶åˆ°è™šæ‹Ÿè§¦å‘èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ä½œç”¨</strong>: å½“ <code>virtualTriggering</code> ä¸º <code>true</code> æ—¶ï¼Œå°†äº‹ä»¶ç»‘å®šåˆ°å¤–éƒ¨æä¾›çš„è™šæ‹Ÿè§¦å‘èŠ‚ç‚¹ï¼ˆå¦‚æŒ‰é’®ç»„ä»¶çš„ <code>ref</code>ï¼‰ã€‚</li></ul><hr><h3 id="9-æ¨¡æ¿ä¸­çš„åŠ¨æ€æ¸²æŸ“"><a href="#9-æ¨¡æ¿ä¸­çš„åŠ¨æ€æ¸²æŸ“" class="headerlink" title="9. æ¨¡æ¿ä¸­çš„åŠ¨æ€æ¸²æŸ“"></a>9. <strong>æ¨¡æ¿ä¸­çš„åŠ¨æ€æ¸²æŸ“</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template v-if=&quot;!virtualTriggering&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;vr-tooltip__trigger&quot; ref=&quot;_triggerNode&quot; v-on=&quot;events&quot;&gt;</span><br><span class="line">        &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;slot name=&quot;default&quot; v-else&gt;&lt;/slot&gt;</span><br></pre></td></tr></table></figure><ul><li><strong>ä½œç”¨</strong>: æ ¹æ® <code>virtualTriggering</code> å†³å®šæ˜¯å¦æ¸²æŸ“é»˜è®¤è§¦å‘èŠ‚ç‚¹ï¼Œæˆ–ä½¿ç”¨å¤–éƒ¨æä¾›çš„è™šæ‹Ÿè§¦å‘èŠ‚ç‚¹ã€‚</li></ul><hr><h3 id="10-è¿‡æ¸¡åŠ¨ç”»ä¸-Popper-é”€æ¯"><a href="#10-è¿‡æ¸¡åŠ¨ç”»ä¸-Popper-é”€æ¯" class="headerlink" title="10. è¿‡æ¸¡åŠ¨ç”»ä¸ Popper é”€æ¯"></a>10. <strong>è¿‡æ¸¡åŠ¨ç”»ä¸ Popper é”€æ¯</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;transition :name=&quot;transition&quot; @after-leave=&quot;destroyPopperInstance&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;vr-tooltip__popper&quot; v-if=&quot;visible&quot;&gt;</span><br><span class="line">        &lt;slot name=&quot;content&quot;&gt;&#123;&#123; content &#125;&#125;&lt;/slot&gt;</span><br><span class="line">        &lt;div id=&quot;arrow&quot; data-popper-arrow&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/transition&gt;</span><br></pre></td></tr></table></figure><ul><li><strong>ä½œç”¨</strong>: ä½¿ç”¨ Vue è¿‡æ¸¡åŠ¨ç”»ï¼ˆå¦‚ <code>fade</code>ï¼‰ï¼Œå¹¶åœ¨åŠ¨ç”»ç»“æŸåé”€æ¯ Popper å®ä¾‹ã€‚</li></ul><hr><h3 id="11-ç‚¹å‡»å¤–éƒ¨åŒºåŸŸå…³é—­"><a href="#11-ç‚¹å‡»å¤–éƒ¨åŒºåŸŸå…³é—­" class="headerlink" title="11. ç‚¹å‡»å¤–éƒ¨åŒºåŸŸå…³é—­"></a>11. <strong>ç‚¹å‡»å¤–éƒ¨åŒºåŸŸå…³é—­</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useClickOutside</span>(containerNode, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">emits</span>(<span class="string">&#x27;click-outside&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">trigger</span> === <span class="string">&#x27;hover&#x27;</span> || props.<span class="property">manual</span>) <span class="keyword">return</span>;</span><br><span class="line">    visible.<span class="property">value</span> &amp;&amp; <span class="title function_">closeFinal</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>ä½œç”¨</strong>: å½“ç‚¹å‡»å¤–éƒ¨åŒºåŸŸæ—¶è§¦å‘ <code>click-outside</code> äº‹ä»¶ï¼Œå¹¶åœ¨éæ‰‹åŠ¨æ§åˆ¶ä¸”éæ‚¬åœæ¨¡å¼ä¸‹éšè—æç¤ºæ¡†ã€‚</li></ul><hr><h3 id="12-æ‰‹åŠ¨æ§åˆ¶æ¨¡å¼"><a href="#12-æ‰‹åŠ¨æ§åˆ¶æ¨¡å¼" class="headerlink" title="12. æ‰‹åŠ¨æ§åˆ¶æ¨¡å¼"></a>12. <strong>æ‰‹åŠ¨æ§åˆ¶æ¨¡å¼</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (props.<span class="property">manual</span>) &#123;</span><br><span class="line">    events.<span class="property">value</span> = &#123;&#125;;</span><br><span class="line">    outerEvents.<span class="property">value</span> = &#123;&#125;;</span><br><span class="line">    dropdownEvents.<span class="property">value</span> = &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ä½œç”¨</strong>: å½“ <code>manual</code> ä¸º <code>true</code> æ—¶ï¼Œç¦ç”¨è‡ªåŠ¨è§¦å‘é€»è¾‘ï¼Œéœ€é€šè¿‡ <code>show()</code> å’Œ <code>hide()</code> æ‰‹åŠ¨æ§åˆ¶ã€‚</li></ul><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li><strong>æ ¸å¿ƒåŠŸèƒ½</strong>: æä¾›å¯å®šåˆ¶çš„æç¤ºæ¡†ç»„ä»¶ï¼Œæ”¯æŒå¤šç§è§¦å‘æ–¹å¼ã€ä½ç½®å®šä½å’Œè™šæ‹Ÿè§¦å‘èŠ‚ç‚¹ã€‚</li><li><strong>æ‰©å±•æ€§</strong>: é€šè¿‡ <code>popperOptions</code> å’Œ <code>transition</code> è‡ªå®šä¹‰å®šä½å’ŒåŠ¨ç”»ã€‚</li><li><strong>äº¤äº’</strong>: æ”¯æŒé˜²æŠ–ã€æ‰‹åŠ¨æ§åˆ¶ã€è™šæ‹Ÿè§¦å‘èŠ‚ç‚¹å’Œå¤–éƒ¨äº‹ä»¶ç›‘å¬ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç»„ä»¶åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MessageBox å¯¹è¯æ¡†ç»„ä»¶</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/MessageBox%20%E5%AF%B9%E8%AF%9D%E5%BC%B9%E5%87%BA%E6%A1%86/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/MessageBox%20%E5%AF%B9%E8%AF%9D%E5%BC%B9%E5%87%BA%E6%A1%86/</url>
      
        <content type="html"><![CDATA[<h1 id="MessageBox-å¯¹è¯æ¡†ç»„ä»¶"><a href="#MessageBox-å¯¹è¯æ¡†ç»„ä»¶" class="headerlink" title="MessageBox å¯¹è¯æ¡†ç»„ä»¶"></a>MessageBox å¯¹è¯æ¡†ç»„ä»¶</h1><hr><h2 id="MessageBox-vue"><a href="#MessageBox-vue" class="headerlink" title="MessageBox.vue"></a>MessageBox.vue</h2><h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, reactive, computed, watch, nextTick, <span class="keyword">type</span> <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isFunction, isNil &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash-es&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">MessageBoxProps</span>, <span class="title class_">MessageBoxAction</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrOverlay</span> <span class="keyword">from</span> <span class="string">&#x27;../Overlay/Overlay.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrIcon</span> <span class="keyword">from</span> <span class="string">&#x27;../Icon/Icon.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrButton</span> <span class="keyword">from</span> <span class="string">&#x27;../Button/Button.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useId, useZIndex &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/hooks&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; typeIconMap &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/utils&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;VrMessageBox&#x27;</span>, <span class="comment">// å®šä¹‰ç»„ä»¶åç§°</span></span><br><span class="line">    <span class="attr">inheritAttrs</span>: <span class="literal">false</span>, <span class="comment">// ç¦ç”¨ç»§æ‰¿å±æ€§</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">MessageBoxProps</span>&gt;(), &#123;</span><br><span class="line">    <span class="attr">lockScroll</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">closeOnClickModal</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">confirmButtonType</span>: <span class="string">&#x27;primary&#x27;</span>,</span><br><span class="line">    <span class="attr">roundButton</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">boxType</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">inputValue</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">inputPlaceholder</span>: <span class="string">&#x27;Please input...&#x27;</span>,</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&#x27;Ok&#x27;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&#x27;Cancel&#x27;</span>,</span><br><span class="line">    <span class="attr">showConfirmButton</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; doAction &#125; = props;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> inputId = <span class="title function_">useId</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; nextZIndex &#125; = <span class="title function_">useZIndex</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    ...props,</span><br><span class="line">    <span class="attr">zIndex</span>: <span class="title function_">nextZizonIndex</span>(),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hasMessage = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> !!state.<span class="property">message</span>);</span><br><span class="line"><span class="keyword">const</span> iconComponent = <span class="title function_">computed</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> state.<span class="property">icon</span> ?? typeIconMap.<span class="title function_">get</span>(state.<span class="property">type</span> ?? <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬ visible å˜åŒ–ï¼Œæ›´æ–° zIndex å¹¶èšç„¦è¾“å…¥æ¡†</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> props.<span class="property">visible</span>?.<span class="property">value</span>,</span><br><span class="line">    <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (val) state.<span class="property">zIndex</span> = <span class="title function_">nextZIndex</span>();</span><br><span class="line">        <span class="keyword">if</span> (props.<span class="property">boxType</span> !== <span class="string">&#x27;prompt&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (!val) <span class="keyword">return</span>;</span><br><span class="line">        <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// inputRef.value?.focus();</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‚¹å‡»é®ç½©å±‚è§¦å‘å…³é—­</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleWrapperClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    props.<span class="property">closeOnClickModal</span> &amp;&amp; <span class="title function_">handleAction</span>(<span class="string">&#x27;close&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å…¥æ¡†å›è½¦è§¦å‘ç¡®è®¤</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleInputEnter</span>(<span class="params"><span class="attr">e</span>: <span class="title class_">KeyboardEvent</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (state.<span class="property">inputType</span> === <span class="string">&#x27;textarea&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="title function_">handleAction</span>(<span class="string">&#x27;confirm&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘æ“ä½œï¼ˆç¡®è®¤/å–æ¶ˆ/å…³é—­ï¼‰</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleAction</span>(<span class="params"><span class="attr">action</span>: <span class="title class_">MessageBoxAction</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isFunction</span>(props.<span class="property">beforeClose</span>)) &#123;</span><br><span class="line">        props.<span class="title function_">beforeClose</span>(action, state, <span class="function">() =&gt;</span> <span class="title function_">doAction</span>(action, state.<span class="property">inputValue</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">doAction</span>(action, state.<span class="property">inputValue</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­å¯¹è¯æ¡†</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleClose</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">handleAction</span>(<span class="string">&#x27;close&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="å…³é”®è§£é‡Š"><a href="#å…³é”®è§£é‡Š" class="headerlink" title="å…³é”®è§£é‡Š"></a><em><strong>å…³é”®è§£é‡Š</strong></em></h3><blockquote><p><code>defineOptions</code></p><ul><li>å®šä¹‰ç»„ä»¶åç§°ä¸º <code>VrMessageBox</code>ï¼Œç¦ç”¨å±æ€§ç»§æ‰¿ï¼š<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;VrMessageBox&#x27;</span>,</span><br><span class="line">    <span class="attr">inheritAttrs</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul></blockquote><hr><blockquote><p><code>withDefaults</code></p><p>ä¸º <code>props</code> è®¾ç½®é»˜è®¤å€¼ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">MessageBoxProps</span>&gt;(), &#123;</span><br><span class="line"> <span class="attr">lockScroll</span>: <span class="literal">true</span>,</span><br><span class="line"> <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line"> <span class="attr">closeOnClickModal</span>: <span class="literal">true</span>,</span><br><span class="line"> <span class="attr">confirmButtonType</span>: <span class="string">&#x27;primary&#x27;</span>,</span><br><span class="line"> <span class="attr">roundButton</span>: <span class="literal">false</span>,</span><br><span class="line"> <span class="attr">boxType</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"> <span class="attr">inputValue</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"> <span class="attr">inputPlaceholder</span>: <span class="string">&#x27;Please input...&#x27;</span>,</span><br><span class="line"> <span class="attr">confirmButtonText</span>: <span class="string">&#x27;Ok&#x27;</span>,</span><br><span class="line"> <span class="attr">cancelButtonText</span>: <span class="string">&#x27;Cancel&#x27;</span>,</span><br><span class="line"> <span class="attr">showConfirmButton</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote><hr><blockquote><p><code>useZIndex</code></p><p>é€šè¿‡ <code>useZIndex</code> ç®¡ç†å¯¹è¯æ¡†å±‚çº§ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; nextZIndex &#125; = <span class="title function_">useZIndex</span>();</span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; ...props, <span class="attr">zIndex</span>: <span class="title function_">nextZIndex</span>() &#125;);</span><br></pre></td></tr></table></figure></blockquote><hr><blockquote><p><code>handleAction</code></p><p>ç»Ÿä¸€å¤„ç†æŒ‰é’®ç‚¹å‡»å’Œè¾“å…¥å›è½¦æ“ä½œï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleAction</span>(<span class="params"><span class="attr">action</span>: <span class="title class_">MessageBoxAction</span></span>) &#123;</span><br><span class="line"> <span class="keyword">if</span> (<span class="title function_">isFunction</span>(props.<span class="property">beforeClose</span>)) &#123;</span><br><span class="line">     props.<span class="title function_">beforeClose</span>(action, state, <span class="function">() =&gt;</span> <span class="title function_">doAction</span>(action, state.<span class="property">inputValue</span>));</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="title function_">doAction</span>(action, state.<span class="property">inputValue</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><hr><h3 id="template"><a href="#template" class="headerlink" title="template"></a>template</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Transition</span><br><span class="line">    name=&quot;fade-in-linear&quot;</span><br><span class="line">    @after-leave=&quot;destroy&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;VrOverlay</span><br><span class="line">      v-show=&quot;(visible as Ref).value&quot;</span><br><span class="line">      :z-index=&quot;state.zIndex&quot;</span><br><span class="line">      mask</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        role=&quot;dialog&quot;</span><br><span class="line">        class=&quot;vr-overlay-message-box&quot;</span><br><span class="line">        @click=&quot;handleWrapperClick&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          ref=&quot;rootRef&quot;</span><br><span class="line">          class=&quot;vr-message-box&quot;</span><br><span class="line">          :class=&quot;&#123; &#x27;is-center&#x27;: state.center &#125;&quot;</span><br><span class="line">          @click.stop</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;!-- æ ‡é¢˜æ  --&gt;</span><br><span class="line">          &lt;div</span><br><span class="line">            v-if=&quot;!isNil(state.title)&quot;</span><br><span class="line">            ref=&quot;headerRef&quot;</span><br><span class="line">            class=&quot;vr-message-box__header&quot;</span><br><span class="line">            :class=&quot;&#123; &#x27;show-close&#x27;: state.showClose &#125;&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;div class=&quot;vr-message-box__title&quot;&gt;</span><br><span class="line">              &lt;VrIcon</span><br><span class="line">                v-if=&quot;iconComponent &amp;&amp; state.center&quot;</span><br><span class="line">                :class=&quot;&#123; [`vr-icon-$&#123;state.type&#125;`]: state.type &#125;&quot;</span><br><span class="line">                :icon=&quot;iconComponent&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">              &#123;&#123; state.title &#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;button</span><br><span class="line">              v-if=&quot;showClose&quot;</span><br><span class="line">              class=&quot;vr-message-box__header-btn&quot;</span><br><span class="line">              @click.stop=&quot;handleClose&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;VrIcon icon=&quot;xmark&quot; /&gt;</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- å†…å®¹åŒº --&gt;</span><br><span class="line">          &lt;div class=&quot;vr-message-box__content&quot;&gt;</span><br><span class="line">            &lt;VrIcon</span><br><span class="line">              v-if=&quot;iconComponent &amp;&amp; !state.center &amp;&amp; hasMessage&quot;</span><br><span class="line">              :class=&quot;&#123; [`vr-icon-$&#123;state.type&#125;`]: state.type &#125;&quot;</span><br><span class="line">              :icon=&quot;iconComponent&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;div v-if=&quot;hasMessage&quot; class=&quot;vr-message-box__message&quot;&gt;</span><br><span class="line">              &lt;slot&gt;</span><br><span class="line">                &lt;component</span><br><span class="line">                  :is=&quot;state.showInput ? &#x27;label&#x27; : &#x27;p&#x27;&quot;</span><br><span class="line">                  :for=&quot;state.showInput ? inputId : void 0&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                  &#123;&#123; state.message &#125;&#125;</span><br><span class="line">                &lt;/component&gt;</span><br><span class="line">              &lt;/slot&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- è¾“å…¥æ¡† --&gt;</span><br><span class="line">          &lt;div v-show=&quot;state.showInput&quot; class=&quot;vr-message-box__input&quot;&gt;</span><br><span class="line">            &lt;VrInput</span><br><span class="line">              v-model=&quot;state.inputValue&quot;</span><br><span class="line">              :placeholder=&quot;state.inputPlaceholder&quot;</span><br><span class="line">              :type=&quot;state.inputType&quot;</span><br><span class="line">              @keyup.enter=&quot;handleInputEnter&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- æŒ‰é’®åŒº --&gt;</span><br><span class="line">          &lt;div class=&quot;vr-message-box__footer&quot;&gt;</span><br><span class="line">            &lt;VrButton</span><br><span class="line">              v-if=&quot;state.showCancelButton&quot;</span><br><span class="line">              class=&quot;vr-message-box__footer-btn vr-message-box__cancel-btn&quot;</span><br><span class="line">              :type=&quot;state.cancelButtonType&quot;</span><br><span class="line">              :round=&quot;state.roundButton&quot;</span><br><span class="line">              :loading=&quot;state.cancelButtonLoading&quot;</span><br><span class="line">              @click=&quot;handleAction(&#x27;cancel&#x27;)&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &#123;&#123; state.cancelButtonText &#125;&#125;</span><br><span class="line">            &lt;/VrButton&gt;</span><br><span class="line">            &lt;VrButton</span><br><span class="line">              v-show=&quot;state.showConfirmButton&quot;</span><br><span class="line">              class=&quot;vr-message-box__footer-btn vr-message-box__confirm-btn&quot;</span><br><span class="line">              :type=&quot;state.confirmButtonType&quot;</span><br><span class="line">              :round=&quot;state.roundButton&quot;</span><br><span class="line">              :loading=&quot;state.confirmButtonLoading&quot;</span><br><span class="line">              @click=&quot;handleAction(&#x27;confirm&#x27;)&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &#123;&#123; state.confirmButtonText &#125;&#125;</span><br><span class="line">            &lt;/VrButton&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/VrOverlay&gt;</span><br><span class="line">  &lt;/Transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="å…³é”®è§£é‡Š-1"><a href="#å…³é”®è§£é‡Š-1" class="headerlink" title="å…³é”®è§£é‡Š"></a><em><strong>å…³é”®è§£é‡Š</strong></em></h3><blockquote><p><code>Transition</code></p><ul><li>ä½¿ç”¨ <code>fade-in-linear</code> åŠ¨ç”»ï¼ŒåŠ¨ç”»ç»“æŸåè§¦å‘ <code>destroy</code> ç§»é™¤ DOMã€‚</li></ul></blockquote><hr><blockquote><p><code>VrOverlay</code></p><ul><li>åŒ…è£¹å¯¹è¯æ¡†çš„é®ç½©å±‚ï¼Œæ”¯æŒ <code>mask</code> å±æ€§æ§åˆ¶é®ç½©æ˜¯å¦å¯ç‚¹å‡»ã€‚</li></ul></blockquote><hr><blockquote><p>è¾“å…¥æ¡†ä¸æŒ‰é’®</p><ul><li><code>state.showInput</code> æ§åˆ¶è¾“å…¥æ¡†æ˜¾ç¤ºï¼ˆå¦‚ <code>prompt</code> ç±»å‹ï¼‰ã€‚</li><li>æŒ‰é’®æ ¹æ® <code>showCancelButton</code>&#x2F;<code>showConfirmButton</code> åŠ¨æ€æ˜¾ç¤ºã€‚</li></ul></blockquote><hr><blockquote><p>æ ‡é¢˜ä¸å†…å®¹</p><ul><li><code>center</code> æ¨¡å¼ä¸‹å›¾æ ‡å±…ä¸­æ˜¾ç¤ºåœ¨æ ‡é¢˜æ å†…ã€‚</li><li><code>hasMessage</code> æ£€æµ‹æ˜¯å¦å­˜åœ¨æ¶ˆæ¯å†…å®¹ã€‚</li></ul></blockquote><hr><h3 id="methods-ts"><a href="#methods-ts" class="headerlink" title="methods.ts"></a>methods.ts</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    createVNode,</span><br><span class="line">    isVNode,</span><br><span class="line">    ref,</span><br><span class="line">    render,</span><br><span class="line">    nextTick,</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">ComponentPublicInstance</span>,</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">VNode</span>,</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">VNodeProps</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;</span><br><span class="line">    <span class="title class_">MessageBoxAction</span>,</span><br><span class="line">    <span class="title class_">MessageBoxOptions</span>,</span><br><span class="line">    <span class="title class_">MessageBoxData</span>,</span><br><span class="line">    <span class="title class_">MessageBoxCallback</span>,</span><br><span class="line">    <span class="title class_">MessageBoxProps</span>,</span><br><span class="line">    <span class="title class_">IVrMessageBox</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MessageBoxConstructor</span> <span class="keyword">from</span> <span class="string">&#x27;./MessageBox.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; assign, each, isFunction, isObject, isString, isUndefined, set &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash-es&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> messageInstanceMap = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;</span><br><span class="line">    <span class="title class_">ComponentPublicInstance</span>&lt;&#123; <span class="attr">doClose</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125;&gt;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span>;</span><br><span class="line">        <span class="attr">callback</span>: <span class="title class_">MessageBoxCallback</span> | <span class="built_in">void</span>;</span><br><span class="line">        <span class="attr">resolve</span>: <span class="function">(<span class="params"><span class="attr">res</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">        <span class="attr">reject</span>: <span class="function">(<span class="params"><span class="attr">res</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå¯¹è¯æ¡†å®ä¾‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initInstance</span>(<span class="params"><span class="attr">props</span>: <span class="title class_">MessageBoxProps</span>, <span class="attr">container</span>: <span class="title class_">HTMLElement</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> isVNodeMsg = <span class="title function_">isFunction</span>(props?.<span class="property">message</span>) || <span class="title function_">isVNode</span>(props?.<span class="property">message</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">genDefaultSlot</span> = (<span class="params"><span class="attr">message</span>: <span class="title class_">VNode</span> | (() =&gt; VNode)</span>) =&gt;</span><br><span class="line">        <span class="title function_">isFunction</span>(message) ? message : <span class="function">() =&gt;</span> message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> vnode = <span class="title function_">createVNode</span>(</span><br><span class="line">        <span class="title class_">MessageBoxConstructor</span>,</span><br><span class="line">        &#123; ...props, visible &#125; <span class="keyword">as</span> <span class="title class_">VNodeProps</span>,</span><br><span class="line">        isVNodeMsg ? &#123; <span class="attr">default</span>: <span class="title function_">genDefaultSlot</span>(props.<span class="property">message</span> <span class="keyword">as</span> <span class="title class_">VNode</span>) &#125; : <span class="built_in">void</span> <span class="number">0</span></span><br><span class="line">    );</span><br><span class="line">    <span class="title function_">render</span>(vnode, container);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(container.<span class="property">firstElementChild</span>!);</span><br><span class="line">    <span class="keyword">return</span> vnode.<span class="property">component</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå®¹å™¨</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">genContainer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç¤ºå¯¹è¯æ¡†</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showMessage</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> container = <span class="title function_">genContainer</span>();</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">props</span>: <span class="title class_">MessageBoxProps</span> = &#123;</span><br><span class="line">        ...options,</span><br><span class="line">        <span class="attr">doClose</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            vm.<span class="property">visible</span>.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">doAction</span>: <span class="function">(<span class="params"><span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>, <span class="attr">inputVal</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> currentMsg = messageInstanceMap.<span class="title function_">get</span>(vm);</span><br><span class="line">            <span class="keyword">const</span> resolve = options.<span class="property">showInput</span></span><br><span class="line">                ? &#123; <span class="attr">value</span>: inputVal, action &#125;</span><br><span class="line">                : action;</span><br><span class="line">            <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> vm.<span class="title function_">doClose</span>());</span><br><span class="line">            <span class="keyword">if</span> (options.<span class="property">callback</span>) &#123;</span><br><span class="line">                options.<span class="title function_">callback</span>(resolve);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (action === <span class="string">&#x27;cancel&#x27;</span> || action === <span class="string">&#x27;close&#x27;</span>) &#123;</span><br><span class="line">                currentMsg?.<span class="title function_">reject</span>(action);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            currentMsg?.<span class="title function_">resolve</span>(resolve);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">destroy</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">render</span>(<span class="literal">null</span>, container);</span><br><span class="line">            messageInstanceMap.<span class="title function_">delete</span>(vm);</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> instance = <span class="title function_">initInstance</span>(props <span class="keyword">as</span> <span class="title class_">MessageBoxProps</span>, container);</span><br><span class="line">    <span class="keyword">const</span> vm = instance?.<span class="property">proxy</span> <span class="keyword">as</span> <span class="title class_">ComponentPublicInstance</span>&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line">    vm.<span class="property">visible</span>.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> vm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸»å‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MessageBox</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span> | <span class="built_in">string</span> | <span class="title class_">VNode</span></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">callback</span>: <span class="title class_">MessageBoxCallback</span> | <span class="built_in">void</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isString</span>(options) || <span class="title function_">isVNode</span>(options)) &#123;</span><br><span class="line">        options = &#123; <span class="attr">message</span>: options &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        callback = options.<span class="property">callback</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> vm = <span class="title function_">showMessage</span>(options);</span><br><span class="line">        messageInstanceMap.<span class="title function_">set</span>(vm, &#123; options, callback, resolve, reject &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢„å®šä¹‰å¯¹è¯æ¡†ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MESSAGE_BOX_VARIANTS</span> = [<span class="string">&#x27;alert&#x27;</span>, <span class="string">&#x27;confirm&#x27;</span>, <span class="string">&#x27;prompt&#x27;</span>] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">MESSAGE_BOX_DEFAULT_OPTS</span>: <span class="title class_">Record</span>&lt;</span><br><span class="line">    (<span class="keyword">typeof</span> <span class="variable constant_">MESSAGE_BOX_VARIANTS</span>)[<span class="built_in">number</span>],</span><br><span class="line">    <span class="title class_">Partial</span>&lt;<span class="title class_">MessageBoxOptions</span>&gt;</span><br><span class="line">&gt; = &#123;</span><br><span class="line">    <span class="attr">alert</span>: &#123; <span class="attr">closeOnClickModal</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    <span class="attr">confirm</span>: &#123; <span class="attr">showCancelButton</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    <span class="attr">prompt</span>: &#123; <span class="attr">showCancelButton</span>: <span class="literal">true</span>, <span class="attr">showInput</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">each</span>(<span class="variable constant_">MESSAGE_BOX_VARIANTS</span>, <span class="function">(<span class="params"><span class="keyword">type</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="title class_">MessageBox</span>, <span class="keyword">type</span>, <span class="title function_">messageBoxFactory</span>(<span class="keyword">type</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¥å‚å‡½æ•°ç”Ÿæˆä¸åŒç±»å‹çš„å¯¹è¯æ¡†</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">messageBoxFactory</span>(<span class="params"><span class="attr">boxType</span>: (<span class="keyword">typeof</span> MESSAGE_BOX_VARIANTS)[<span class="built_in">number</span>]</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="attr">message</span>: <span class="built_in">string</span> | <span class="title class_">VNode</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="attr">title</span>: <span class="built_in">string</span> | <span class="title class_">MessageBoxOptions</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span> = &#123;&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">    </span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> titleOrOpts = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isObject</span>(title)) &#123;</span><br><span class="line">            options = title <span class="keyword">as</span> <span class="title class_">MessageBoxOptions</span>;</span><br><span class="line">            titleOrOpts = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isUndefined</span>(title)) &#123;</span><br><span class="line">            titleOrOpts = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            titleOrOpts = title <span class="keyword">as</span> <span class="built_in">string</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">MessageBox</span>(</span><br><span class="line">            <span class="title function_">assign</span>(</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">title</span>: titleOrOpts,</span><br><span class="line">                    message,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                    boxType,</span><br><span class="line">                    ...<span class="variable constant_">MESSAGE_BOX_DEFAULT_OPTS</span>[boxType],</span><br><span class="line">                &#125;,</span><br><span class="line">                options</span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­æ‰€æœ‰å®ä¾‹</span></span><br><span class="line"><span class="title function_">set</span>(<span class="title class_">MessageBox</span>, <span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    messageInstanceMap.<span class="title function_">forEach</span>(<span class="function">(<span class="params">_, vm</span>) =&gt;</span> &#123;</span><br><span class="line">        vm.<span class="title function_">doClose</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    messageInstanceMap.<span class="title function_">clear</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MessageBox</span> <span class="keyword">as</span> <span class="title class_">IVrMessageBox</span>;</span><br></pre></td></tr></table></figure><hr><h3 id="å…³é”®è§£é‡Š-2"><a href="#å…³é”®è§£é‡Š-2" class="headerlink" title="å…³é”®è§£é‡Š"></a><em><strong>å…³é”®è§£é‡Š</strong></em></h3><blockquote><p><code>messageInstanceMap</code></p><p>å­˜å‚¨æ‰€æœ‰å¯¹è¯æ¡†å®ä¾‹ï¼Œæ”¯æŒæ‰¹é‡æ“ä½œï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> messageInstanceMap = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;</span><br><span class="line"> <span class="title class_">ComponentPublicInstance</span>&lt;&#123; <span class="attr">doClose</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125;&gt;,</span><br><span class="line"> &#123;</span><br><span class="line">     <span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span>;</span><br><span class="line">     <span class="attr">resolve</span>: <span class="function">(<span class="params"><span class="attr">res</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">     <span class="attr">reject</span>: <span class="function">(<span class="params"><span class="attr">res</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&gt;();</span><br></pre></td></tr></table></figure></blockquote><hr><blockquote><p><code>showMessage</code></p><ul><li>æ ¹æ® <code>options</code> ç”Ÿæˆå¯¹è¯æ¡†å®ä¾‹ã€‚</li><li><code>doAction</code> å¤„ç†ç”¨æˆ·æ“ä½œå¹¶è§¦å‘ <code>resolve/reject</code>ã€‚</li></ul></blockquote><hr><blockquote><p>é¢„å®šä¹‰å¯¹è¯æ¡†ç±»å‹</p><ul><li><code>alert</code>ï¼šé»˜è®¤ç¦ç”¨é®ç½©å±‚å…³é—­ã€‚</li><li><code>confirm</code>ï¼šé»˜è®¤æ˜¾ç¤ºå–æ¶ˆæŒ‰é’®ã€‚</li><li><code>prompt</code>ï¼šé»˜è®¤æ˜¾ç¤ºè¾“å…¥æ¡†å’Œå–æ¶ˆæŒ‰é’®ã€‚</li></ul></blockquote><hr><h3 id="types-ts"><a href="#types-ts" class="headerlink" title="types.ts"></a>types.ts</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">VNode</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; messageType &#125; <span class="keyword">from</span> <span class="string">&#x27;../Message/types&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ButtonType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../Button/types&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxAction</span> = <span class="string">&#x27;confirm&#x27;</span> | <span class="string">&#x27;cancel&#x27;</span> | <span class="string">&#x27;close&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxType</span> = <span class="string">&#x27;&#x27;</span> | <span class="string">&#x27;prompt&#x27;</span> | <span class="string">&#x27;alert&#x27;</span> | <span class="string">&#x27;confirm&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxCallback</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span> | &#123; value: <span class="built_in">string</span>; action: MessageBoxAction &#125;</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxInputData</span> = &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxData</span> = <span class="title class_">MessageBoxInputData</span> &amp; <span class="title class_">MessageBoxAction</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageBoxOptions</span> &#123;</span><br><span class="line">    <span class="attr">title</span>?: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">message</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span> | (<span class="function">() =&gt;</span> <span class="title class_">VNode</span>);</span><br><span class="line">    <span class="attr">type</span>?: messageType;</span><br><span class="line">    <span class="attr">boxType</span>?: <span class="title class_">MessageBoxType</span>;</span><br><span class="line">    <span class="attr">icon</span>?: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">callback</span>?: <span class="title class_">MessageBoxCallback</span>;</span><br><span class="line">    <span class="attr">showClose</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">showInput</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">showCancelButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">showConfirmButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">cancelButtonText</span>?: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">confirmButtonText</span>?: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">cancelButtonLoading</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">confirmButtonLoading</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">cancelButtonDisabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">confirmButtonDisabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">cancelButtonType</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">    <span class="attr">confirmButtonType</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">    <span class="attr">roundButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">center</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">lockScroll</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">closeOnClickModal</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">beforeClose</span>?: <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="attr">instance</span>: <span class="built_in">any</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="attr">done</span>: () =&gt; <span class="built_in">void</span></span></span></span><br><span class="line"><span class="params"><span class="function">    </span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å…³é”®è§£é‡Š-3"><a href="#å…³é”®è§£é‡Š-3" class="headerlink" title="å…³é”®è§£é‡Š"></a><em><strong>å…³é”®è§£é‡Š</strong></em></h3><blockquote><p><code>MessageBoxOptions</code></p><ul><li><code>boxType</code>ï¼šæŒ‡å®šå¯¹è¯æ¡†ç±»å‹ï¼ˆ<code>alert/confirm/prompt</code>ï¼‰ã€‚</li><li><code>showInput</code>ï¼šæ˜¯å¦æ˜¾ç¤ºè¾“å…¥æ¡†ï¼ˆé€šå¸¸ç”¨äº <code>prompt</code> ç±»å‹ï¼‰ã€‚</li><li><code>beforeClose</code>ï¼šå…³é—­å‰çš„é’©å­å‡½æ•°ï¼Œéœ€è°ƒç”¨ <code>done()</code> å®Œæˆå…³é—­ã€‚</li></ul></blockquote><hr><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; MessageBox &#125; from &#x27;veyra-ui&#x27;;</span><br><span class="line"></span><br><span class="line">// åŸºç¡€ Alert</span><br><span class="line">MessageBox.alert(&#x27;æ“ä½œæˆåŠŸ&#x27;, &#x27;æç¤º&#x27;, &#123;</span><br><span class="line">    type: &#x27;success&#x27;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// ç¡®è®¤å¯¹è¯æ¡†</span><br><span class="line">MessageBox.confirm(&#x27;ç¡®å®šåˆ é™¤è¯¥æ–‡ä»¶ï¼Ÿ&#x27;, &#x27;è­¦å‘Š&#x27;, &#123;</span><br><span class="line">    type: &#x27;warning&#x27;,</span><br><span class="line">    confirmButtonText: &#x27;ç¡®å®š&#x27;,</span><br><span class="line">    cancelButtonText: &#x27;å–æ¶ˆ&#x27;,</span><br><span class="line">&#125;).then(() =&gt; &#123;</span><br><span class="line">    console.log(&#x27;å·²ç¡®è®¤&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// è¾“å…¥å¯¹è¯æ¡†</span><br><span class="line">MessageBox.prompt(&#x27;è¯·è¾“å…¥ç”¨æˆ·å&#x27;, &#x27;è¾“å…¥æ¡†&#x27;, &#123;</span><br><span class="line">    inputPlaceholder: &#x27;è¯·è¾“å…¥...&#x27;,</span><br><span class="line">    inputType: &#x27;text&#x27;,</span><br><span class="line">&#125;).then((&#123; value, action &#125;) =&gt; &#123;</span><br><span class="line">    if (action === &#x27;confirm&#x27;) &#123;</span><br><span class="line">        console.log(&#x27;è¾“å…¥å†…å®¹:&#x27;, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// å…³é—­æ‰€æœ‰å¯¹è¯æ¡†</span><br><span class="line">MessageBox.close();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="æ ¸å¿ƒ-API"><a href="#æ ¸å¿ƒ-API" class="headerlink" title="æ ¸å¿ƒ API"></a>æ ¸å¿ƒ API</h3><h4 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h4><table><thead><tr><th>å±æ€§</th><th>ç±»å‹</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>title</code></td><td><code>string</code></td><td>-</td><td>å¯¹è¯æ¡†æ ‡é¢˜</td></tr><tr><td><code>message</code></td><td>&#96;string</td><td>VNode</td><td>(() &#x3D;&gt; VNode)&#96;</td></tr><tr><td><code>type</code></td><td><code>messageType</code></td><td><code>&#39;&#39;</code></td><td>æ¶ˆæ¯ç±»å‹ï¼ˆ<code>info/success/warning/danger/error</code>ï¼‰</td></tr><tr><td><code>boxType</code></td><td><code>MessageBoxType</code></td><td><code>&#39;&#39;</code></td><td>å¯¹è¯æ¡†ç±»å‹ï¼ˆ<code>alert/confirm/prompt</code>ï¼‰</td></tr><tr><td><code>showClose</code></td><td><code>boolean</code></td><td><code>true</code></td><td>æ˜¯å¦æ˜¾ç¤ºå…³é—­æŒ‰é’®</td></tr><tr><td><code>showInput</code></td><td><code>boolean</code></td><td><code>false</code></td><td>æ˜¯å¦æ˜¾ç¤ºè¾“å…¥æ¡†ï¼ˆ<code>prompt</code> ç±»å‹é»˜è®¤å¼€å¯ï¼‰</td></tr><tr><td><code>showCancelButton</code></td><td><code>boolean</code></td><td><code>false</code></td><td>æ˜¯å¦æ˜¾ç¤ºå–æ¶ˆæŒ‰é’®</td></tr><tr><td><code>showConfirmButton</code></td><td><code>boolean</code></td><td><code>true</code></td><td>æ˜¯å¦æ˜¾ç¤ºç¡®è®¤æŒ‰é’®</td></tr><tr><td><code>confirmButtonText</code></td><td><code>string</code></td><td><code>&#39;Ok&#39;</code></td><td>ç¡®è®¤æŒ‰é’®æ–‡å­—</td></tr><tr><td><code>cancelButtonText</code></td><td><code>string</code></td><td><code>&#39;Cancel&#39;</code></td><td>å–æ¶ˆæŒ‰é’®æ–‡å­—</td></tr><tr><td><code>lockScroll</code></td><td><code>boolean</code></td><td><code>true</code></td><td>æ˜¯å¦é”å®šé¡µé¢æ»šåŠ¨</td></tr><tr><td><code>closeOnClickModal</code></td><td><code>boolean</code></td><td><code>true</code></td><td>æ˜¯å¦å…è®¸ç‚¹å‡»é®ç½©å±‚å…³é—­</td></tr></tbody></table><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><table><thead><tr><th>æ–¹æ³•å</th><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>MessageBox()</code></td><td><code>options: MessageBoxOptions</code></td><td>æ˜¾ç¤ºè‡ªå®šä¹‰å¯¹è¯æ¡†</td></tr><tr><td><code>alert()</code></td><td>&#96;message: string</td><td>VNode, title?: string, options?: MessageBoxOptions&#96;</td></tr><tr><td><code>confirm()</code></td><td>&#96;message: string</td><td>VNode, title?: string, options?: MessageBoxOptions&#96;</td></tr><tr><td><code>prompt()</code></td><td>&#96;message: string</td><td>VNode, title?: string, options?: MessageBoxOptions&#96;</td></tr><tr><td><code>close()</code></td><td>-</td><td>å…³é—­æ‰€æœ‰å¯¹è¯æ¡†</td></tr></tbody></table><h4 id="å›è°ƒå‚æ•°"><a href="#å›è°ƒå‚æ•°" class="headerlink" title="å›è°ƒå‚æ•°"></a>å›è°ƒå‚æ•°</h4><table><thead><tr><th>åœºæ™¯</th><th>è¿”å›å€¼ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>alert</code></td><td><code>string</code> (<code>&#39;confirm&#39;</code>&#x2F;<code>&#39;close&#39;</code>)</td><td>ç”¨æˆ·æ“ä½œç±»å‹</td></tr><tr><td><code>confirm/prompt</code></td><td><code>&#123; value: string; action: &#39;confirm&#39; &#125;</code> æˆ– <code>&#39;cancel&#39;</code>&#x2F;<code>&#39;close&#39;</code></td><td>åŒ…å«è¾“å…¥å€¼å’Œæ“ä½œç±»å‹ï¼ˆ<code>prompt</code> æ—¶è¿”å›è¾“å…¥å€¼ï¼‰</td></tr></tbody></table><hr><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ol><li><p><strong>ç±»å‹ä¸é»˜è®¤é…ç½®</strong>ï¼š</p><ul><li><code>alert</code> é»˜è®¤ç¦ç”¨é®ç½©å±‚å…³é—­ï¼Œ<code>confirm</code> é»˜è®¤æ˜¾ç¤ºå–æ¶ˆæŒ‰é’®ï¼Œ<code>prompt</code> é»˜è®¤æ˜¾ç¤ºè¾“å…¥æ¡†å’Œå–æ¶ˆæŒ‰é’®ã€‚</li></ul></li><li><p><strong>å¼‚æ­¥å¤„ç†</strong>ï¼š</p><ul><li><code>MessageBox</code> è¿”å› <code>Promise</code>ï¼Œéœ€é€šè¿‡ <code>.then()</code> æˆ– <code>await</code> å¤„ç†ç”¨æˆ·æ“ä½œç»“æœã€‚</li></ul></li><li><p><strong>è¾“å…¥éªŒè¯</strong>ï¼š</p><ul><li><code>prompt</code> ç±»å‹å¯é€šè¿‡ <code>beforeClose</code> é’©å­éªŒè¯è¾“å…¥å†…å®¹ï¼Œé˜»æ­¢æ— æ•ˆæäº¤ã€‚</li></ul></li><li><p><strong>æ ·å¼æ‰©å±•</strong>ï¼š</p><ul><li>æŒ‰é’®æ ·å¼æ”¯æŒé€šè¿‡ <code>confirmButtonType</code>&#x2F;<code>cancelButtonType</code> æŒ‡å®šç±»å‹ï¼ˆå¦‚ <code>&#39;primary&#39;</code>&#x2F;<code>&#39;danger&#39;</code>ï¼‰ã€‚</li></ul></li><li><p><strong>é”å±æ»šåŠ¨</strong>ï¼š</p><ul><li><code>lockScroll</code> å¯ç”¨æ—¶ï¼Œé¡µé¢æ»šåŠ¨å°†è¢«ç¦ç”¨ï¼Œå¯¹è¯æ¡†å±…ä¸­æ˜¾ç¤ºã€‚</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç»„ä»¶åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Message æ¶ˆæ¯æç¤ºç»„ä»¶</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Message%20%E6%B6%88%E6%81%AF%E6%8F%90%E7%A4%BA/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Message%20%E6%B6%88%E6%81%AF%E6%8F%90%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="Message-æ¶ˆæ¯æç¤ºç»„ä»¶"><a href="#Message-æ¶ˆæ¯æç¤ºç»„ä»¶" class="headerlink" title="Message æ¶ˆæ¯æç¤ºç»„ä»¶"></a>Message æ¶ˆæ¯æç¤ºç»„ä»¶</h1><hr><h2 id="Message-vue"><a href="#Message-vue" class="headerlink" title="Message.vue"></a>Message.vue</h2><h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">MessageProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; computed, onMounted, ref, watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useOffset &#125; <span class="keyword">from</span> <span class="string">&#x27;./methods&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; typeIconMap &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/utils&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrIcon</span> <span class="keyword">from</span> <span class="string">&#x27;../Icon/Icon.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;VrMessage&#x27;</span>, <span class="comment">// å®šä¹‰ç»„ä»¶åç§°</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">MessageProps</span>&gt;(), &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>, <span class="comment">// é»˜è®¤ç±»å‹</span></span><br><span class="line">    <span class="attr">duration</span>: <span class="number">3000</span>, <span class="comment">// é»˜è®¤è‡ªåŠ¨å…³é—­æ—¶é—´</span></span><br><span class="line">    <span class="attr">offset</span>: <span class="number">10</span>, <span class="comment">// æ¶ˆæ¯é—´è·</span></span><br><span class="line">    <span class="attr">transitionName</span>: <span class="string">&#x27;fade-up&#x27;</span>, <span class="comment">// é»˜è®¤è¿‡æ¸¡åŠ¨ç”»</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">false</span>); <span class="comment">// æ§åˆ¶æ¶ˆæ¯å¯è§æ€§</span></span><br><span class="line"><span class="keyword">const</span> messageRef = ref&lt;<span class="title class_">HTMLDivElement</span>&gt;(); <span class="comment">// æ¶ˆæ¯ DOM å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å›¾æ ‡æ˜ å°„ï¼ˆæ ¹æ® type æ˜ å°„å›¾æ ‡ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> iconName = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> typeIconMap.<span class="title function_">get</span>(props.<span class="property">type</span>) ?? <span class="string">&#x27;circle-info&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—æ¶ˆæ¯å‚ç›´ä½ç½®</span></span><br><span class="line"><span class="keyword">const</span> &#123; topOffset, bottomOffset &#125; = <span class="title function_">useOffset</span>(&#123;</span><br><span class="line">    <span class="attr">getLastBottomOffset</span>: getLastBottomOffset.<span class="title function_">bind</span>(props),</span><br><span class="line">    <span class="attr">offset</span>: props.<span class="property">offset</span>,</span><br><span class="line">    <span class="attr">boxHeight</span>: <span class="title function_">computed</span>(<span class="function">() =&gt;</span> messageRef.<span class="property">value</span>?.<span class="property">offsetHeight</span> ?? <span class="number">0</span>),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€æ ·å¼ç»‘å®š</span></span><br><span class="line"><span class="keyword">const</span> cssStyle = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;topOffset.value&#125;</span>px`</span>,</span><br><span class="line">    <span class="attr">zIndex</span>: props.<span class="property">zIndex</span>,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">timer</span>: <span class="built_in">number</span>;</span><br><span class="line"><span class="comment">// å¯åŠ¨è‡ªåŠ¨å…³é—­å®šæ—¶å™¨</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">startTimer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">duration</span> === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(close, props.<span class="property">duration</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸…é™¤å®šæ—¶å™¨</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clearTimer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­æ¶ˆæ¯</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">close</span>(<span class="params"></span>) &#123;</span><br><span class="line">    visible.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    visible.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="title function_">startTimer</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬ visible å˜åŒ–è§¦å‘é”€æ¯é€»è¾‘</span></span><br><span class="line"><span class="title function_">watch</span>(visible, <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!val) props.<span class="title function_">onDestory</span>(); <span class="comment">// è§¦å‘é”€æ¯å›è°ƒ</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æš´éœ²æ–¹æ³•ç»™å¤–éƒ¨</span></span><br><span class="line"><span class="title function_">defineExpose</span>(&#123;</span><br><span class="line">    bottomOffset,</span><br><span class="line">    close,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="å…³é”®è§£é‡Š"><a href="#å…³é”®è§£é‡Š" class="headerlink" title="å…³é”®è§£é‡Š"></a><em><strong>å…³é”®è§£é‡Š</strong></em></h3><blockquote><p><code>defineOptions</code></p><p>å®šä¹‰ç»„ä»¶åç§°ä¸º <code>VrMessage</code>ï¼Œåœ¨å…¨å±€æ³¨å†Œæ—¶éœ€é€šè¿‡ <code>VrMessage</code> è°ƒç”¨ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line"> <span class="attr">name</span>: <span class="string">&#x27;VrMessage&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote><hr><blockquote><p><code>withDefaults</code></p><p>ä¸º <code>props</code> è®¾ç½®é»˜è®¤å€¼ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">MessageProps</span>&gt;(), &#123;</span><br><span class="line"> <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line"> <span class="attr">duration</span>: <span class="number">3000</span>,</span><br><span class="line"> <span class="attr">offset</span>: <span class="number">10</span>,</span><br><span class="line"> <span class="attr">transitionName</span>: <span class="string">&#x27;fade-up&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote><hr><blockquote><p><code>useOffset</code></p><p>åŠ¨æ€è®¡ç®—æ¶ˆæ¯å‚ç›´ä½ç½®ï¼š</p><ul><li><code>topOffset</code>ï¼šæ ¹æ®å‰ä¸€ä¸ªæ¶ˆæ¯çš„ <code>bottomOffset</code> å’Œ <code>offset</code> ç´¯åŠ è®¡ç®—å½“å‰æ¶ˆæ¯çš„ <code>top</code> å€¼ã€‚</li><li><code>boxHeight</code>ï¼šé€šè¿‡ <code>messageRef</code> è·å–å½“å‰æ¶ˆæ¯çš„é«˜åº¦ï¼Œç”¨äºè®¡ç®—åç»­æ¶ˆæ¯çš„åç§»ã€‚</li></ul></blockquote><hr><blockquote><p><code>Transition</code></p><p>é€šè¿‡ <code>transitionName</code> æ§åˆ¶å…¥åœº&#x2F;ç¦»å¼€åŠ¨ç”»ï¼š</p><ul><li><code>@after-leave</code>ï¼šåŠ¨ç”»ç»“æŸåè§¦å‘ <code>onDestory</code> ç§»é™¤ DOMã€‚</li></ul></blockquote><hr><blockquote><p><code>defineExpose</code></p><p>æš´éœ²ä»¥ä¸‹å±æ€§å’Œæ–¹æ³•ç»™å¤–éƒ¨ï¼š</p><ul><li><code>bottomOffset</code>ï¼šå½“å‰æ¶ˆæ¯åº•éƒ¨ä½ç½®ï¼Œä¾›åç»­æ¶ˆæ¯è®¡ç®—åç§»ã€‚</li><li><code>close</code>ï¼šæ‰‹åŠ¨å…³é—­æ¶ˆæ¯çš„æ–¹æ³•ã€‚</li></ul></blockquote><hr><h3 id="template"><a href="#template" class="headerlink" title="template"></a>template</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Transition</span><br><span class="line">    :name=&quot;transitionName&quot;</span><br><span class="line">    @after-leave=&quot;props.onDestory()&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&quot;visible&quot;</span><br><span class="line">      :style=&quot;cssStyle&quot;</span><br><span class="line">      class=&quot;vr-message&quot;</span><br><span class="line">      :class=&quot;&#123;</span><br><span class="line">        [`vr-message--$&#123;type&#125;`]: type, // ç±»å‹æ ·å¼ï¼ˆå¦‚ vr-message--successï¼‰</span><br><span class="line">        &#x27;is-close&#x27;: showClose, // æ˜¯å¦æ˜¾ç¤ºå…³é—­æŒ‰é’®</span><br><span class="line">        &#x27;text-center&#x27;: center, // æ–‡å­—å±…ä¸­</span><br><span class="line">      &#125;&quot;</span><br><span class="line">      role=&quot;alert&quot;</span><br><span class="line">      @mouseenter=&quot;clearTimer&quot; // é¼ æ ‡è¿›å…¥æš‚åœå®šæ—¶å™¨</span><br><span class="line">      @mouseleave=&quot;startTimer&quot; // é¼ æ ‡ç¦»å¼€é‡å¯å®šæ—¶å™¨</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- å›¾æ ‡ --&gt;</span><br><span class="line">      &lt;vr-icon</span><br><span class="line">        v-if=&quot;type !== &#x27;text&#x27;&quot;</span><br><span class="line">        class=&quot;vr-message__icon&quot;</span><br><span class="line">        :icon=&quot;iconName&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;!-- å†…å®¹ --&gt;</span><br><span class="line">      &lt;div class=&quot;vr-message__content&quot;&gt;</span><br><span class="line">        &lt;slot&gt;</span><br><span class="line">          &lt;render-vnode v-if=&quot;message&quot; :vNode=&quot;message&quot; /&gt;</span><br><span class="line">        &lt;/slot&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- å…³é—­æŒ‰é’® --&gt;</span><br><span class="line">      &lt;div v-if=&quot;showClose&quot; class=&quot;vr-message__close&quot;&gt;</span><br><span class="line">        &lt;vr-icon icon=&quot;xmark&quot; @click.stop=&quot;close&quot; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/Transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="å…³é”®è§£é‡Š-1"><a href="#å…³é”®è§£é‡Š-1" class="headerlink" title="å…³é”®è§£é‡Š"></a><em><strong>å…³é”®è§£é‡Š</strong></em></h3><blockquote><p><code>Transition</code></p><ul><li><code>name=&quot;transitionName&quot;</code>ï¼šç»‘å®šåŠ¨ç”»åç§°ï¼ˆå¦‚ <code>fade-up</code>ï¼‰ã€‚</li><li><code>@after-leave</code>ï¼šåŠ¨ç”»ç»“æŸåè§¦å‘ <code>onDestory</code> ç§»é™¤ DOMã€‚</li></ul></blockquote><hr><blockquote><p><code>v-show=&quot;visible&quot;</code></p><p>æ§åˆ¶æ¶ˆæ¯çš„æ˜¾ç¤º&#x2F;éšè—ï¼Œç”± <code>visible</code> å“åº”å¼å˜é‡é©±åŠ¨ã€‚</p></blockquote><hr><blockquote><p><code>@mouseenter</code>&#x2F;<code>@mouseleave</code></p><ul><li>é¼ æ ‡æ‚¬åœæ—¶æš‚åœè‡ªåŠ¨å…³é—­ï¼Œç§»å‡ºåæ¢å¤å®šæ—¶å™¨ã€‚</li></ul></blockquote><hr><blockquote><p>å›¾æ ‡ä¸å†…å®¹</p><ul><li><code>type !== &#39;text&#39;</code>ï¼šæ–‡æœ¬ç±»å‹ä¸æ˜¾ç¤ºå›¾æ ‡ã€‚</li><li><code>&lt;render-vnode&gt;</code>ï¼šæ¸²æŸ“ <code>message</code> å±æ€§ä¼ é€’çš„ VNode å†…å®¹ï¼ˆå…¼å®¹å­—ç¬¦ä¸²æˆ–è‡ªå®šä¹‰ VNodeï¼‰ã€‚</li></ul></blockquote><hr><h3 id="methods-ts"><a href="#methods-ts" class="headerlink" title="methods.ts"></a>methods.ts</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">CreateMessageProps</span>, <span class="title class_">MessageInstance</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render, h, shallowReactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useZIndex &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/hooks&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instances = shallowReactive&lt;<span class="title class_">MessageInstance</span>[]&gt;([]);</span><br><span class="line"><span class="keyword">const</span> &#123; nextZIndex &#125; = <span class="title function_">useZIndex</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> messageDefaults = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="attr">offset</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">transitionName</span>: <span class="string">&#x27;fade-up&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºæ¶ˆæ¯å®ä¾‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createMessage</span>(<span class="params"><span class="attr">props</span>: <span class="title class_">CreateMessageProps</span></span>): <span class="title class_">MessageInstance</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="string">`message-<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">destory</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> idx = instances.<span class="title function_">findIndex</span>(<span class="function"><span class="params">i</span> =&gt;</span> i.<span class="property">id</span> === id);</span><br><span class="line">        <span class="keyword">if</span> (idx !== -<span class="number">1</span>) &#123;</span><br><span class="line">            instances.<span class="title function_">splice</span>(idx, <span class="number">1</span>);</span><br><span class="line">            <span class="title function_">render</span>(<span class="literal">null</span>, container);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> _props = &#123;</span><br><span class="line">        ...props,</span><br><span class="line">        id,</span><br><span class="line">        <span class="attr">zIndex</span>: <span class="title function_">nextZIndex</span>(),</span><br><span class="line">        <span class="attr">onDestory</span>: destory,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> vnode = <span class="title function_">h</span>(<span class="title class_">MessageConstructor</span>, _props);</span><br><span class="line">    <span class="title function_">render</span>(vnode, container);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(container.<span class="property">firstElementChild</span>!);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        id,</span><br><span class="line">        vnode,</span><br><span class="line">        <span class="attr">props</span>: _props,</span><br><span class="line">        <span class="attr">handler</span>: &#123;</span><br><span class="line">            <span class="attr">close</span>: <span class="function">() =&gt;</span> vnode.<span class="property">component</span>!.<span class="property">exposed</span>!.<span class="title function_">close</span>(),</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å‰ä¸€ä¸ªæ¶ˆæ¯çš„åº•éƒ¨åç§»</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getLastBottomOffset</span>(<span class="params"><span class="attr">this</span>: <span class="title class_">MessageProps</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> prevInstance = instances.<span class="title function_">find</span>(</span><br><span class="line">        <span class="function"><span class="params">i</span> =&gt;</span> i.<span class="property">id</span> &lt; <span class="variable language_">this</span>.<span class="property">id</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> prevInstance?.<span class="property">exposed</span>?.<span class="property">bottomOffset</span> ?? <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­æ‰€æœ‰æ¶ˆæ¯</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">closeAll</span>(<span class="params"><span class="attr">type</span>?: messageType</span>) &#123;</span><br><span class="line">    instances.<span class="title function_">forEach</span>(<span class="function"><span class="params">instance</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">type</span> || instance.<span class="property">props</span>.<span class="property">type</span> === <span class="keyword">type</span>) &#123;</span><br><span class="line">            instance.<span class="property">handler</span>.<span class="title function_">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å…³é”®è§£é‡Š-2"><a href="#å…³é”®è§£é‡Š-2" class="headerlink" title="å…³é”®è§£é‡Š"></a><em><strong>å…³é”®è§£é‡Š</strong></em></h3><blockquote><p><code>createMessage</code></p><ul><li>ç”Ÿæˆå”¯ä¸€ <code>id</code>ï¼Œå¹¶åˆ›å»ºæ¶ˆæ¯ DOMã€‚</li><li>é€šè¿‡ <code>useZIndex</code> ç®¡ç†å±‚çº§ï¼Œç¡®ä¿æ–°æ¶ˆæ¯å§‹ç»ˆåœ¨æœ€ä¸Šå±‚ã€‚</li><li>å°†å®ä¾‹å­˜å…¥ <code>instances</code> æ•°ç»„ï¼Œæ”¯æŒæ‰¹é‡æ“ä½œã€‚</li></ul></blockquote><hr><blockquote><p><code>getLastBottomOffset</code></p><p>æ ¹æ®å½“å‰æ¶ˆæ¯çš„ <code>id</code>ï¼ŒæŸ¥æ‰¾å‰ä¸€ä¸ªæ¶ˆæ¯çš„ <code>bottomOffset</code>ï¼Œç”¨äºè®¡ç®—å½“å‰æ¶ˆæ¯çš„ <code>top</code> å€¼ã€‚</p></blockquote><hr><blockquote><p><code>closeAll</code></p><p>å…³é—­æŒ‡å®šç±»å‹æˆ–æ‰€æœ‰æ¶ˆæ¯ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">message.<span class="title function_">closeAll</span>(<span class="string">&#x27;warning&#x27;</span>); <span class="comment">// å…³é—­æ‰€æœ‰è­¦å‘Šç±»å‹æ¶ˆæ¯</span></span><br><span class="line">message.<span class="title function_">closeAll</span>(); <span class="comment">// å…³é—­æ‰€æœ‰æ¶ˆæ¯</span></span><br></pre></td></tr></table></figure></blockquote><hr><h3 id="types-ts"><a href="#types-ts" class="headerlink" title="types.ts"></a>types.ts</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">VNode</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> messageTypes = [<span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;warning&#x27;</span>, <span class="string">&#x27;danger&#x27;</span>, <span class="string">&#x27;error&#x27;</span>] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> messageType = (<span class="keyword">typeof</span> messageTypes)[<span class="built_in">number</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageProps</span> &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">message</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span> | (<span class="function">() =&gt;</span> <span class="title class_">VNode</span>);</span><br><span class="line">    <span class="attr">duration</span>?: <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">showClose</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">center</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">type</span>?: messageType;</span><br><span class="line">    <span class="attr">offset</span>?: <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">zIndex</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">transitionName</span>?: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">onDestory</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageOptions</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">Omit</span>&lt;<span class="title class_">MessageProps</span>, <span class="string">&#x27;id&#x27;</span> | <span class="string">&#x27;onDestory&#x27;</span>&gt;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageInstance</span> &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">vnode</span>: <span class="title class_">VNode</span>;</span><br><span class="line">    <span class="attr">props</span>: <span class="title class_">MessageProps</span>;</span><br><span class="line">    <span class="attr">handler</span>: &#123;</span><br><span class="line">        <span class="attr">close</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CreateMessageProps</span> = <span class="title class_">Omit</span>&lt;</span><br><span class="line">    <span class="title class_">MessageProps</span>,</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span> | <span class="string">&#x27;zIndex&#x27;</span> | <span class="string">&#x27;onDestory&#x27;</span></span><br><span class="line">&gt;;</span><br></pre></td></tr></table></figure><hr><h3 id="å…³é”®è§£é‡Š-3"><a href="#å…³é”®è§£é‡Š-3" class="headerlink" title="å…³é”®è§£é‡Š"></a><em><strong>å…³é”®è§£é‡Š</strong></em></h3><blockquote><p><code>messageTypes</code></p><p>å®šä¹‰æ”¯æŒçš„æ¶ˆæ¯ç±»å‹æšä¸¾ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> messageTypes = [</span><br><span class="line"> <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;warning&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;danger&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br></pre></td></tr></table></figure></blockquote><hr><blockquote><p><code>MessageProps</code></p><ul><li><code>id</code>: æ¶ˆæ¯å”¯ä¸€æ ‡è¯†ã€‚</li><li><code>message</code>: æ”¯æŒå­—ç¬¦ä¸²ã€VNode æˆ–è¿”å› VNode çš„å‡½æ•°ã€‚</li><li><code>showClose</code>: æ˜¯å¦æ˜¾ç¤ºå…³é—­æŒ‰é’®ã€‚</li><li><code>center</code>: å†…å®¹æ˜¯å¦å±…ä¸­ã€‚</li></ul></blockquote><hr><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; message &#125; from &#x27;veyra-ui&#x27;;</span><br><span class="line"></span><br><span class="line">// åŸºç¡€ç”¨æ³•</span><br><span class="line">message(&#x27;æ“ä½œæˆåŠŸ&#x27;, &#123;</span><br><span class="line">    type: &#x27;success&#x27;,</span><br><span class="line">    duration: 2000,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// è‡ªå®šä¹‰å†…å®¹</span><br><span class="line">message(&#123;</span><br><span class="line">    message: () =&gt; h(&#x27;div&#x27;, &#123; style: &#x27;color: red&#x27; &#125;, &#x27;è‡ªå®šä¹‰å†…å®¹&#x27;),</span><br><span class="line">    showClose: true,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// å…³é—­æ‰€æœ‰è­¦å‘Šæ¶ˆæ¯</span><br><span class="line">message.closeAll(&#x27;warning&#x27;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="æ ¸å¿ƒ-API"><a href="#æ ¸å¿ƒ-API" class="headerlink" title="æ ¸å¿ƒ API"></a>æ ¸å¿ƒ API</h3><h4 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h4><table><thead><tr><th>å±æ€§</th><th>ç±»å‹</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>type</code></td><td><code>messageType</code></td><td><code>info</code></td><td>æ¶ˆæ¯ç±»å‹ï¼ˆ<code>info/success/warning/danger/error</code>ï¼‰</td></tr><tr><td><code>message</code></td><td>&#96;string</td><td>VNode</td><td>(() &#x3D;&gt; VNode)&#96;</td></tr><tr><td><code>duration</code></td><td><code>number</code></td><td><code>3000</code></td><td>è‡ªåŠ¨å…³é—­æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ0 è¡¨ç¤ºä¸å…³é—­</td></tr><tr><td><code>showClose</code></td><td><code>boolean</code></td><td><code>false</code></td><td>æ˜¯å¦æ˜¾ç¤ºå…³é—­æŒ‰é’®</td></tr><tr><td><code>offset</code></td><td><code>number</code></td><td><code>10</code></td><td>æ¶ˆæ¯å‚ç›´é—´è·</td></tr><tr><td><code>transitionName</code></td><td><code>string</code></td><td><code>fade-up</code></td><td>è¿‡æ¸¡åŠ¨ç”»åç§°</td></tr></tbody></table><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><table><thead><tr><th>æ–¹æ³•å</th><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>message()</code></td><td><code>MessageOptions</code></td><td>åˆ›å»ºå¹¶æ˜¾ç¤ºæ¶ˆæ¯</td></tr><tr><td><code>success()</code></td><td><code>MessageOptions</code></td><td>åˆ›å»ºæˆåŠŸç±»å‹çš„æ¶ˆæ¯</td></tr><tr><td><code>closeAll()</code></td><td><code>type?: messageType</code></td><td>å…³é—­æŒ‡å®šç±»å‹æˆ–æ‰€æœ‰æ¶ˆæ¯</td></tr></tbody></table><h4 id="æ’æ§½"><a href="#æ’æ§½" class="headerlink" title="æ’æ§½"></a>æ’æ§½</h4><table><thead><tr><th>åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>é»˜è®¤æ’æ§½</td><td>è‡ªå®šä¹‰æ¶ˆæ¯å†…å®¹ï¼ˆè¦†ç›– <code>message</code> å±æ€§ï¼‰</td></tr></tbody></table><hr><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ol><li><p><strong>ä½ç½®å †å </strong>ï¼š</p><ul><li>æ–°æ¶ˆæ¯ä¼šå †å åœ¨å‰ä¸€ä¸ªæ¶ˆæ¯ä¸‹æ–¹ï¼Œé€šè¿‡ <code>offset</code> æ§åˆ¶é—´è·ã€‚</li><li>é¦–ä¸ªæ¶ˆæ¯ä»é¡¶éƒ¨ <code>offset</code> å¼€å§‹å¸ƒå±€ã€‚</li></ul></li><li><p><strong>åŠ¨ç”»ä¸é”€æ¯</strong>ï¼š</p><ul><li><code>transitionName</code> éœ€é…åˆ CSS è¿‡æ¸¡ç±»ï¼ˆå¦‚ <code>fade-up-enter-active</code>ï¼‰ã€‚</li><li><code>@after-leave</code> è§¦å‘åè‡ªåŠ¨ç§»é™¤ DOMã€‚</li></ul></li><li><p><strong>ç±»å‹æ‰©å±•</strong>ï¼š</p><ul><li>é€šè¿‡ <code>messageTypes</code> æ‰©å±•æ”¯æŒçš„ç±»å‹ï¼Œéœ€åŒæ­¥æ›´æ–° <code>typeIconMap</code> å›¾æ ‡æ˜ å°„ã€‚</li></ul></li><li><p><strong>å…³é—­é€»è¾‘</strong>ï¼š</p><ul><li>ç‚¹å‡»å…³é—­æŒ‰é’®ã€Escape é”®ã€æˆ–è¶…å‡º <code>duration</code> æ—¶é—´åè‡ªåŠ¨å…³é—­ã€‚</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç»„ä»¶åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Dropdown ä¸‹æ‹‰èœå•</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Dropdown%20%E4%B8%8B%E6%8B%89%E8%8F%9C%E5%8D%95/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Dropdown%20%E4%B8%8B%E6%8B%89%E8%8F%9C%E5%8D%95/</url>
      
        <content type="html"><![CDATA[<h3 id="Dropdown-ä¸‹æ‹‰èœå•"><a href="#Dropdown-ä¸‹æ‹‰èœå•" class="headerlink" title="Dropdown ä¸‹æ‹‰èœå•"></a>Dropdown ä¸‹æ‹‰èœå•</h3><hr><h4 id="Dropdown-vue"><a href="#Dropdown-vue" class="headerlink" title="Dropdown.vue"></a><strong>Dropdown.vue</strong></h4><hr><h3 id="Script-éƒ¨åˆ†"><a href="#Script-éƒ¨åˆ†" class="headerlink" title="Script éƒ¨åˆ†"></a><strong>Script éƒ¨åˆ†</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, computed, provide &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; omit, isNil &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash-es&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">DropdownProps</span>, <span class="title class_">DropdownEmits</span>, <span class="title class_">DropdownContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useId, useDisabledStyle &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DROPDOWN_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrButton</span> <span class="keyword">from</span> <span class="string">&#x27;../Button/index.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrButtonGroup</span> <span class="keyword">from</span> <span class="string">&#x27;../ButtonGroup/index.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">DropdownItem</span> <span class="keyword">from</span> <span class="string">&#x27;./DropdownItem.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Tooltip</span> <span class="keyword">from</span> <span class="string">&#x27;../Tooltip/Tooltip.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;VrDropdown&#x27;</span>,</span><br><span class="line">  <span class="attr">inheritAttrs</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">DropdownProps</span>&gt;(), &#123;</span><br><span class="line">  <span class="attr">hideOnClick</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">items</span>: <span class="function">() =&gt;</span> [] <span class="keyword">as</span> <span class="title class_">DropdownItemProps</span>[],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emits = defineEmits&lt;<span class="title class_">DropdownEmits</span>&gt;()</span><br><span class="line"><span class="keyword">const</span> slots = <span class="title function_">defineSlots</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tooltipRef = ref&lt;<span class="title class_">TooltipInstance</span>&gt;()</span><br><span class="line"><span class="keyword">const</span> triggerRef = ref&lt;<span class="keyword">typeof</span> <span class="title class_">VrButton</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tooltipProps = <span class="title function_">computed</span>(<span class="function">() =&gt;</span></span><br><span class="line">  <span class="title function_">omit</span>(props, [<span class="string">&#x27;items&#x27;</span>, <span class="string">&#x27;hideAfterClick&#x27;</span>, <span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;splitButton&#x27;</span>])</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleItemClick</span>(<span class="params"><span class="attr">item</span>: <span class="title class_">DropdownItemProps</span></span>) &#123;</span><br><span class="line">  props.<span class="property">hideOnClick</span> &amp;&amp; tooltipRef.<span class="property">value</span>?.<span class="title function_">hide</span>()</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isNil</span>(item.<span class="property">command</span>)) <span class="title function_">emits</span>(<span class="string">&#x27;command&#x27;</span>, item.<span class="property">command</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">useDisabledStyle</span>()</span><br><span class="line"></span><br><span class="line">defineExpose&lt;<span class="title class_">DropdownInstance</span>&gt;(&#123;</span><br><span class="line">  <span class="attr">open</span>: <span class="function">() =&gt;</span> tooltipRef.<span class="property">value</span>?.<span class="title function_">show</span>(),</span><br><span class="line">  <span class="attr">close</span>: <span class="function">() =&gt;</span> tooltipRef.<span class="property">value</span>?.<span class="title function_">hide</span>(),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">provide</span>(<span class="variable constant_">DROPDOWN_CTX_KEY</span>, &#123;</span><br><span class="line">  handleItemClick,</span><br><span class="line">  <span class="attr">size</span>: <span class="title function_">computed</span>(<span class="function">() =&gt;</span> props.<span class="property">size</span>),</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h4 id="å…³é”®ç‚¹è§£é‡Š"><a href="#å…³é”®ç‚¹è§£é‡Š" class="headerlink" title="å…³é”®ç‚¹è§£é‡Š"></a><strong>å…³é”®ç‚¹è§£é‡Š</strong></h4><ol><li><p><strong>ç»„ä»¶ç»“æ„</strong></p><ul><li>ç»§æ‰¿è‡ª <code>Tooltip</code>ï¼Œé€šè¿‡ <code>tooltipProps</code> ä¼ é€’é…ç½®ï¼Œæ”¯æŒå¼¹å‡ºä½ç½®ã€è§¦å‘æ–¹å¼ç­‰ã€‚</li><li>æ”¯æŒ <code>splitButton</code> æ¨¡å¼ï¼šç»„åˆä¸»æŒ‰é’®å’Œä¸‹æ‹‰æŒ‰é’®ï¼ˆå¦‚ <code>VrButtonGroup</code>ï¼‰ã€‚</li><li>æä¾› <code>open</code> å’Œ <code>close</code> æ–¹æ³•ï¼Œé€šè¿‡ <code>defineExpose</code> æš´éœ²ç»™å¤–éƒ¨è°ƒç”¨ã€‚</li></ul></li><li><p><strong>Props &amp; é»˜è®¤å€¼</strong></p><ul><li><code>items</code>ï¼šä¸‹æ‹‰é¡¹æ•°ç»„ï¼Œæ¯ä¸ªé¡¹éœ€åŒ…å« <code>command</code>ã€<code>label</code>ã€<code>disabled</code>ã€<code>divided</code> ç­‰å±æ€§ã€‚</li><li><code>splitButton</code>ï¼šå¯ç”¨åˆ†ä½“æŒ‰é’®æ¨¡å¼ï¼ˆä¸»æŒ‰é’® + ä¸‹æ‹‰æŒ‰é’®ï¼‰ã€‚</li><li><code>hideOnClick</code>ï¼šç‚¹å‡»ä¸‹æ‹‰é¡¹åè‡ªåŠ¨å…³é—­èœå•ã€‚</li></ul></li><li><p><strong>äº‹ä»¶å¤„ç†</strong></p><ul><li><code>command</code>ï¼šå½“ç‚¹å‡»æœ‰ <code>command</code> çš„é¡¹æ—¶è§¦å‘ï¼Œä¼ é€’ <code>command</code> å€¼ã€‚</li><li><code>visible-change</code>ï¼šå¼¹å‡ºå±‚æ˜¾ç¤º&#x2F;éšè—æ—¶è§¦å‘ï¼Œä¼ é€’å¸ƒå°”å€¼ã€‚</li></ul></li><li><p><strong>æä¾›ä¸Šä¸‹æ–‡ï¼ˆProvide&#x2F;Injectï¼‰</strong></p><ul><li>é€šè¿‡ <code>DROPDOWN_CTX_KEY</code> å‘å­ç»„ä»¶ <code>DropdownItem</code> æä¾› <code>handleItemClick</code> å’Œ <code>size</code>ã€‚</li><li><code>size</code> ç”¨äºå­é¡¹æ ·å¼é€‚é…ã€‚</li></ul></li></ol><hr><h3 id="Template-éƒ¨åˆ†"><a href="#Template-éƒ¨åˆ†" class="headerlink" title="Template éƒ¨åˆ†"></a><strong>Template éƒ¨åˆ†</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;vr-dropdown&quot; :id=&quot;`dropdown-$&#123;useId().value&#125;`&quot; :class=&quot;&#123; &#x27;is-disabled&#x27;: props.disabled &#125;&quot;&gt;</span><br><span class="line">    &lt;tooltip</span><br><span class="line">      ref=&quot;tooltipRef&quot;</span><br><span class="line">      v-bind=&quot;tooltipProps&quot;</span><br><span class="line">      :virtual-triggering=&quot;splitButton&quot;</span><br><span class="line">      :virtual-ref=&quot;triggerRef&quot;</span><br><span class="line">      @visible-change=&quot;$emit(&#x27;visible-change&#x27;, $event)&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- è§¦å‘å™¨ --&gt;</span><br><span class="line">      &lt;vr-button-group</span><br><span class="line">        v-if=&quot;splitButton&quot;</span><br><span class="line">        :type=&quot;type&quot;</span><br><span class="line">        :size=&quot;size&quot;</span><br><span class="line">        :disabled=&quot;disabled&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;vr-button @click=&quot;$emit(&#x27;click&#x27;, $event)&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;default&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/vr-button&gt;</span><br><span class="line">        &lt;vr-button ref=&quot;triggerRef&quot; icon=&quot;angle-down&quot; /&gt;</span><br><span class="line">      &lt;/vr-button-group&gt;</span><br><span class="line">      &lt;!-- å•ä¸€è§¦å‘å™¨ --&gt;</span><br><span class="line">      &lt;slot v-else name=&quot;default&quot;&gt;&lt;/slot&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- ä¸‹æ‹‰å†…å®¹ --&gt;</span><br><span class="line">      &lt;template #content&gt;</span><br><span class="line">        &lt;ul class=&quot;vr-dropdown__menu&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;dropdown&quot;&gt;</span><br><span class="line">            &lt;template v-for=&quot;item in items&quot; :key=&quot;item.command ?? useId().value&quot;&gt;</span><br><span class="line">              &lt;dropdown-item v-bind=&quot;item&quot; /&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/slot&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/tooltip&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><hr><h4 id="å…³é”®ç‚¹è§£é‡Š-1"><a href="#å…³é”®ç‚¹è§£é‡Š-1" class="headerlink" title="å…³é”®ç‚¹è§£é‡Š"></a><strong>å…³é”®ç‚¹è§£é‡Š</strong></h4><ol><li><p><strong>è§¦å‘å™¨æ¨¡å¼</strong></p><ul><li><strong>åˆ†ä½“æŒ‰é’®æ¨¡å¼ï¼ˆsplitButtonï¼‰</strong>ï¼š<ul><li>ä½¿ç”¨ <code>VrButtonGroup</code> åŒ…å«ä¸»æŒ‰é’®å’Œä¸‹æ‹‰ç®­å¤´æŒ‰é’®ã€‚</li><li>ä¸»æŒ‰é’®ç‚¹å‡»è§¦å‘ <code>click</code> äº‹ä»¶ï¼Œä¸‹æ‹‰ç®­å¤´æŒ‰é’®æ§åˆ¶å¼¹å‡ºå±‚ã€‚</li></ul></li><li><strong>æ™®é€šæ¨¡å¼</strong>ï¼š<ul><li>ç›´æ¥ä½¿ç”¨æ’æ§½å†…å®¹ä½œä¸ºè§¦å‘å™¨ï¼ˆå¦‚è‡ªå®šä¹‰æŒ‰é’®æˆ–å›¾æ ‡ï¼‰ã€‚</li></ul></li></ul></li><li><p><strong>ä¸‹æ‹‰å†…å®¹æ¸²æŸ“</strong></p><ul><li>é€šè¿‡ <code>#content</code> æ’æ§½æ¸²æŸ“ä¸‹æ‹‰èœå•ï¼Œä¼˜å…ˆä½¿ç”¨ <code>slot=&quot;dropdown&quot;</code> çš„è‡ªå®šä¹‰å†…å®¹ã€‚</li><li>é»˜è®¤éå† <code>items</code> æ•°ç»„ï¼Œæ¸²æŸ“ <code>DropdownItem</code> ç»„ä»¶ã€‚</li></ul></li><li><p><strong>æ ·å¼ä¸ç¦ç”¨çŠ¶æ€</strong></p><ul><li><code>is-disabled</code> ç±»æ§åˆ¶ç¦ç”¨çŠ¶æ€æ ·å¼ã€‚</li><li>åˆ†ä½“æŒ‰é’®æ¨¡å¼ä¸‹ï¼ŒæŒ‰é’®ç»„çš„æœ€åä¸€ä¸ªæŒ‰é’®ï¼ˆç®­å¤´ï¼‰æ ·å¼é€šè¿‡ <code>:deep</code> è¿›è¡Œ CSS è¦†ç›–ã€‚</li></ul></li></ol><hr><h4 id="DropdownItem-vue"><a href="#DropdownItem-vue" class="headerlink" title="DropdownItem.vue"></a><strong>DropdownItem.vue</strong></h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; inject, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useId &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DROPDOWN_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">DropdownItemProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;VrDropdownItem&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">DropdownItemProps</span>&gt;(), &#123;</span><br><span class="line">  <span class="attr">command</span>: <span class="title function_">useId</span>().<span class="property">value</span>,</span><br><span class="line">  <span class="attr">divided</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">disabled</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ctx = <span class="title function_">inject</span>(<span class="variable constant_">DROPDOWN_CTX_KEY</span>)</span><br><span class="line"><span class="keyword">const</span> size = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> ctx?.<span class="property">size</span>.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="property">disabled</span>) <span class="keyword">return</span></span><br><span class="line">  ctx?.<span class="title function_">handleItemClick</span>(props)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-if</span>=<span class="string">&quot;divided&quot;</span> <span class="attr">role</span>=<span class="string">&quot;separator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;divided-placeholder&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">li</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">:id</span>=<span class="string">&quot;`dropdown-item-$&#123;command ?? useId().value&#125;`&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">:class</span>=<span class="string">&quot;&#123;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">      &#x27;vr-dropdown__item&#x27;: true,</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">      [`vr-dropdown__item--$&#123;size&#125;`]: size,</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">      &#x27;is-disabled&#x27;: disabled,</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">      &#x27;is-divided&#x27;: divided,</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">    &#125;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    @<span class="attr">click</span>=<span class="string">&quot;handleClick&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  &gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span>&#123;&#123; label &#125;&#125;<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure><hr><h4 id="å…³é”®ç‚¹è§£é‡Š-2"><a href="#å…³é”®ç‚¹è§£é‡Š-2" class="headerlink" title="å…³é”®ç‚¹è§£é‡Š"></a><strong>å…³é”®ç‚¹è§£é‡Š</strong></h4><ol><li><p><strong>é¡¹çš„æ¸²æŸ“</strong></p><ul><li><code>divided</code> å±æ€§ï¼šå½“ä¸º <code>true</code> æ—¶æ¸²æŸ“åˆ†éš”ç¬¦ï¼ˆ<code>role=&quot;separator&quot;</code> çš„ <code>li</code> å…ƒç´ ï¼‰ã€‚</li><li><code>command</code>ï¼šå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºè§¦å‘ <code>command</code> äº‹ä»¶ã€‚</li></ul></li><li><p><strong>æ ·å¼é€‚é…</strong></p><ul><li>æ ¹æ®çˆ¶ç»„ä»¶çš„ <code>size</code> åŠ¨æ€æ·»åŠ ç±»åï¼ˆå¦‚ <code>vr-dropdown__item--large</code>ï¼‰ã€‚</li><li><code>is-disabled</code> å’Œ <code>is-divided</code> æ§åˆ¶ç¦ç”¨å’Œåˆ†éš”ç¬¦æ ·å¼ã€‚</li></ul></li><li><p><strong>äº‹ä»¶è§¦å‘</strong></p><ul><li>ç‚¹å‡»éç¦ç”¨é¡¹æ—¶ï¼Œè°ƒç”¨çˆ¶ç»„ä»¶çš„ <code>handleItemClick</code> æ–¹æ³•ï¼Œå¹¶ä¼ é€’è‡ªèº« <code>props</code>ã€‚</li></ul></li></ol><hr><h4 id="è¾…åŠ©æ–‡ä»¶"><a href="#è¾…åŠ©æ–‡ä»¶" class="headerlink" title="è¾…åŠ©æ–‡ä»¶"></a><strong>è¾…åŠ©æ–‡ä»¶</strong></h4><ol><li><p><strong>constants.ts</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">DropdownContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">DROPDOWN_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">DropdownContext</span>&gt; = <span class="title class_">Symbol</span>(<span class="string">&quot;dropdownContext&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li>å®šä¹‰æ³¨å…¥é”® <code>DROPDOWN_CTX_KEY</code>ï¼Œç”¨äºåœ¨å­ç»„ä»¶ä¸­æ³¨å…¥ä¸Šä¸‹æ–‡ã€‚</li></ul></li><li><p><strong>types.ts</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownItemProps</span> &#123;</span><br><span class="line">  <span class="attr">command</span>?: <span class="built_in">string</span> | <span class="built_in">number</span></span><br><span class="line">  <span class="attr">label</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span></span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line">  <span class="attr">divided</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownProps</span> <span class="keyword">extends</span> <span class="title class_">TooltipProps</span> &#123;</span><br><span class="line">  <span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line">  <span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line">  <span class="attr">items</span>?: <span class="title class_">DropdownItemProps</span>[]</span><br><span class="line">  <span class="attr">hideOnClick</span>?: <span class="built_in">boolean</span></span><br><span class="line">  <span class="attr">splitButton</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;visible-change&quot;</span>, <span class="attr">value</span>: <span class="built_in">boolean</span>): <span class="title function_">void</span></span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;command&quot;</span>, <span class="attr">value</span>: <span class="title class_">DropdownCommand</span>): <span class="title function_">void</span></span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;click&quot;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>DropdownProps</strong>ï¼šç»§æ‰¿ <code>TooltipProps</code>ï¼Œæ”¯æŒ <code>placement</code>ã€<code>trigger</code> ç­‰å±æ€§ã€‚</li><li><strong>DropdownItemProps</strong>ï¼šå®šä¹‰ä¸‹æ‹‰é¡¹å±æ€§ï¼Œå¦‚ <code>command</code>ã€<code>disabled</code>ã€<code>divided</code>ã€‚</li></ul></li></ol><hr><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a><strong>ä½¿ç”¨ç¤ºä¾‹</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;vr-dropdown</span><br><span class="line">    v-model:visible=&quot;visible&quot;</span><br><span class="line">    :items=&quot;items&quot;</span><br><span class="line">    split-button</span><br><span class="line">    type=&quot;primary&quot;</span><br><span class="line">    @command=&quot;handleCommand&quot;</span><br><span class="line">    @visible-change=&quot;handleVisibleChange&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;template #default&gt;</span><br><span class="line">      &lt;vr-button&gt;è‡ªå®šä¹‰è§¦å‘å™¨&lt;/vr-button&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;template #dropdown&gt;</span><br><span class="line">      &lt;ul class=&quot;custom-menu&quot;&gt;</span><br><span class="line">        &lt;vr-dropdown-item command=&quot;custom1&quot;&gt;è‡ªå®šä¹‰é¡¹1&lt;/vr-dropdown-item&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/vr-dropdown&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const items = ref([</span><br><span class="line">  &#123; label: &#x27;é€‰é¡¹1&#x27;, command: &#x27;cmd1&#x27; &#125;,</span><br><span class="line">  &#123; label: &#x27;é€‰é¡¹2&#x27;, command: &#x27;cmd2&#x27;, divided: true &#125;,</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">const handleCommand = (command: string) =&gt; &#123;</span><br><span class="line">  console.log(&#x27;Command:&#x27;, command)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="æ ¸å¿ƒæœºåˆ¶æ€»ç»“"><a href="#æ ¸å¿ƒæœºåˆ¶æ€»ç»“" class="headerlink" title="æ ¸å¿ƒæœºåˆ¶æ€»ç»“"></a><strong>æ ¸å¿ƒæœºåˆ¶æ€»ç»“</strong></h3><ol><li><strong>å¼¹å‡ºå±‚é›†æˆ</strong>ï¼šåŸºäº <code>Tooltip</code> å®ç°ï¼Œæ”¯æŒä½ç½®ã€è§¦å‘æ–¹å¼ç­‰é…ç½®ã€‚</li><li><strong>åˆ†ä½“æŒ‰é’®æ¨¡å¼</strong>ï¼šé€šè¿‡ <code>splitButton</code> å±•ç¤ºä¸»æŒ‰é’®å’Œä¸‹æ‹‰æŒ‰é’®ç»„åˆã€‚</li><li><strong>åŠ¨æ€é¡¹æ¸²æŸ“</strong>ï¼šé€šè¿‡ <code>items</code> æ•°ç»„æˆ– <code>slot=&quot;dropdown&quot;</code> è‡ªå®šä¹‰ä¸‹æ‹‰å†…å®¹ã€‚</li><li><strong>äº‹ä»¶äº¤äº’</strong>ï¼š<ul><li><code>command</code>ï¼šç‚¹å‡»å¸¦ <code>command</code> çš„é¡¹æ—¶è§¦å‘ã€‚</li><li><code>visible-change</code>ï¼šå¼¹å‡ºå±‚çŠ¶æ€å˜åŒ–æ—¶è§¦å‘ã€‚</li></ul></li><li><strong>æ ·å¼é€‚é…</strong>ï¼šé€šè¿‡ <code>size</code> å’Œ <code>type</code> ç»§æ‰¿æŒ‰é’®æ ·å¼ï¼Œæ”¯æŒåˆ†éš”ç¬¦å’Œç¦ç”¨çŠ¶æ€ã€‚</li></ol><p>é€šè¿‡ <code>provide/inject</code> å®ç°çˆ¶å­ç»„ä»¶é€šä¿¡ï¼Œç¡®ä¿ä¸‹æ‹‰é¡¹ç‚¹å‡»èƒ½è§¦å‘çˆ¶ç»„ä»¶çš„äº‹ä»¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç»„ä»¶åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Collapse æŠ˜å é¢æ¿</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Collapse%20%E6%8A%98%E5%8F%A0%E9%9D%A2%E6%9D%BF/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Collapse%20%E6%8A%98%E5%8F%A0%E9%9D%A2%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<h1 id="Collapse-æŠ˜å é¢æ¿"><a href="#Collapse-æŠ˜å é¢æ¿" class="headerlink" title="Collapse æŠ˜å é¢æ¿"></a>Collapse æŠ˜å é¢æ¿</h1><h2 id="Collapse-vue"><a href="#Collapse-vue" class="headerlink" title="Collapse.vue"></a>Collapse.vue</h2><h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, provide, watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; each &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash-es&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">CollapseItemName</span>, <span class="title class_">CollapseProps</span>, <span class="title class_">CollapseEmits</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; debugWarn &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">COLLAPSE_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">COMPONENT_NAME</span> = <span class="string">&#x27;VrCollapse&#x27;</span> <span class="keyword">as</span> <span class="keyword">const</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="variable constant_">COMPONENT_NAME</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = defineProps&lt;<span class="title class_">CollapseProps</span>&gt;()</span><br><span class="line"><span class="keyword">const</span> emits = defineEmits&lt;<span class="title class_">CollapseEmits</span>&gt;()</span><br><span class="line"><span class="keyword">const</span> activeNames = ref&lt;<span class="title class_">CollapseItemName</span>[]&gt;(props.<span class="property">modelValue</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (props.<span class="property">accordion</span> &amp;&amp; activeNames.<span class="property">value</span>.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="title function_">debugWarn</span>(<span class="variable constant_">COMPONENT_NAME</span>, <span class="string">&#x27;accordion mode should only have one active item&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleItemClick</span>(<span class="params"><span class="attr">item</span>: <span class="title class_">CollapseItemName</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> _activeNames = [...activeNames.<span class="property">value</span>]</span><br><span class="line">    <span class="comment">// æ‰‹é£ç´æ¨¡å¼</span></span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">accordion</span>) &#123;</span><br><span class="line">        _activeNames = [_activeNames[<span class="number">0</span>] === item ? <span class="string">&#x27;&#x27;</span> : item]</span><br><span class="line">        <span class="title function_">updateActiveNames</span>(_activeNames)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> index = _activeNames.<span class="title function_">indexOf</span>(item)</span><br><span class="line">    <span class="keyword">if</span> (index &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// å­˜åœ¨ï¼Œåˆ é™¤æ•°ç»„ä¸­çš„ä¸€é¡¹</span></span><br><span class="line">        _activeNames.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸å­˜åœ¨ï¼Œæ’å…¥å¯¹åº” name</span></span><br><span class="line">        _activeNames.<span class="title function_">push</span>(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">updateActiveNames</span>(_activeNames)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateActiveNames</span>(<span class="params"><span class="attr">val</span>: <span class="title class_">CollapseItemName</span>[]</span>) &#123;</span><br><span class="line">    activeNames.<span class="property">value</span> = val</span><br><span class="line">    <span class="title function_">each</span>([<span class="string">&#x27;update:modelValue&#x27;</span>, <span class="string">&#x27;change&#x27;</span>], <span class="function">(<span class="params">e</span>) =&gt;</span></span><br><span class="line">        <span class="title function_">emits</span>(e <span class="keyword">as</span> <span class="string">&#x27;update:modelValue&#x27;</span> &amp; <span class="string">&#x27;change&#x27;</span>, val)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> props.<span class="property">modelValue</span>,</span><br><span class="line">    <span class="function">(<span class="params">val</span>) =&gt;</span> <span class="title function_">updateActiveNames</span>(val)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="title function_">provide</span>(<span class="variable constant_">COLLAPSE_CTX_KEY</span>, &#123;</span><br><span class="line">    activeNames,</span><br><span class="line">    handleItemClick,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><em><strong>å…³é”®è§£é‡Š</strong></em></p><blockquote><p><code>defineOptions</code></p><blockquote><p>æœ€ç»ˆå¯¼å‡ºç»„ä»¶åä¸º <code>VrCollapse</code>ï¼Œåœ¨ <code>packages\core\components.ts</code> ä¸­ä»¥ä»¥ä¸‹å½¢å¼å¯¼å…¥</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">VrCollapse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/components&#x27;</span></span><br></pre></td></tr></table></figure></blockquote></blockquote><blockquote><p><code>props</code> å’Œ <code>modelValue</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">const</span> props = defineProps&lt;<span class="title class_">CollapseProps</span>&gt;()</span><br></pre></td></tr></table></figure><p>æ¥å£å®šä¹‰ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseProps</span> &#123;</span><br><span class="line">&gt;<span class="attr">modelValue</span>: <span class="title class_">CollapseItemName</span>[] <span class="comment">// å¿…é¡»æ˜¯æ•°ç»„</span></span><br><span class="line">&gt;<span class="attr">accordion</span>?: <span class="built_in">boolean</span> <span class="comment">// æ˜¯å¦ä¸ºæ‰‹é£ç´æ¨¡å¼</span></span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><p><code>modelValue</code> é€šè¿‡ <code>v-model</code> å®ç°åŒå‘ç»‘å®šï¼Œ<code>watch</code> ç›‘å¬å…¶å˜åŒ–å¹¶åŒæ­¥åˆ° <code>activeNames</code></p></blockquote><blockquote><p><code>provide</code> ä¸Šä¸‹æ–‡</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="title function_">provide</span>(<span class="variable constant_">COLLAPSE_CTX_KEY</span>, &#123;</span><br><span class="line">&gt;activeNames,</span><br><span class="line">&gt;handleItemClick,</span><br><span class="line">&gt;&#125;)</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ³¨å…¥é”® <code>COLLAPSE_CTX_KEY</code>ï¼Œå­ç»„ä»¶ <code>CollapseItem</code> å¯ä»¥é€šè¿‡ <code>inject</code> è·å–çˆ¶ç»„ä»¶çš„çŠ¶æ€å’Œæ–¹æ³•</p></blockquote><blockquote><p><code>handleItemClick</code> é€»è¾‘</p><ul><li><strong>æ‰‹é£ç´æ¨¡å¼</strong>ï¼šä»…å…è®¸ä¸€ä¸ªå±•å¼€é¡¹ï¼Œç‚¹å‡»æ—¶åˆ‡æ¢ä¸ºå½“å‰é¡¹æˆ–æ¸…ç©º</li><li><strong>æ™®é€šæ¨¡å¼</strong>ï¼šç‚¹å‡»æ—¶åˆ‡æ¢é¡¹çš„å±•å¼€&#x2F;æ”¶èµ·çŠ¶æ€</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">if</span> (props.<span class="property">accordion</span>) &#123;</span><br><span class="line"> _activeNames = [_activeNames[<span class="number">0</span>] === item ? <span class="string">&#x27;&#x27;</span> : item]</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><code>updateActiveNames</code> å’Œ <code>emits</code></p><p>åŒæ—¶è§¦å‘ <code>update:modelValue</code>ï¼ˆåŒå‘ç»‘å®šï¼‰å’Œ <code>change</code> äº‹ä»¶</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="title function_">each</span>([<span class="string">&#x27;update:modelValue&#x27;</span>, <span class="string">&#x27;change&#x27;</span>], <span class="function">(<span class="params">e</span>) =&gt;</span></span><br><span class="line">&gt;<span class="title function_">emits</span>(e <span class="keyword">as</span> ..., val)</span><br><span class="line">&gt;)</span><br></pre></td></tr></table></figure></blockquote><hr><h3 id="template"><a href="#template" class="headerlink" title="template"></a>template</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;vr-collapse&quot;&gt;</span><br><span class="line">  &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><em><strong>å…³é”®è§£é‡Š</strong></em></p><blockquote><p>å®¹å™¨ç»„ä»¶</p><p>é€šè¿‡ <code>&lt;slot&gt;</code> æ’å…¥ <code>CollapseItem</code> å­ç»„ä»¶ï¼Œå†…å®¹ç”±å­ç»„ä»¶è‡ªè¡Œæ¸²æŸ“</p></blockquote><hr><h2 id="CollapseItem-vue"><a href="#CollapseItem-vue" class="headerlink" title="CollapseItem.vue"></a>CollapseItem.vue</h2><h3 id="script-1"><a href="#script-1" class="headerlink" title="script"></a>script</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; inject, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">COLLAPSE_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> transitionEvents <span class="keyword">from</span> <span class="string">&#x27;./transitionEvents&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrIcon</span> <span class="keyword">from</span> <span class="string">&#x27;../Icon/Icon.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;VrCollapseItem&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = defineProps&lt;<span class="title class_">CollapseItemProps</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ctx = <span class="title function_">inject</span>(<span class="variable constant_">COLLAPSE_CTX_KEY</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isActive = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> ctx?.<span class="property">activeNames</span>.<span class="property">value</span>?.<span class="title function_">includes</span>(props.<span class="property">name</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">disabled</span>) <span class="keyword">return</span></span><br><span class="line">    ctx?.<span class="title function_">handleItemClick</span>(props.<span class="property">name</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em><strong>å…³é”®è§£é‡Š</strong></em></p><blockquote><p><code>inject</code> è·å–çˆ¶ç»„ä»¶ä¸Šä¸‹æ–‡</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">const</span> ctx = <span class="title function_">inject</span>(<span class="variable constant_">COLLAPSE_CTX_KEY</span>)</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code>COLLAPSE_CTX_KEY</code> æ³¨å…¥é”®ï¼Œè·å–çˆ¶ç»„ä»¶çš„ <code>activeNames</code> å’Œ <code>handleItemClick</code> æ–¹æ³•</p></blockquote><blockquote><p><code>isActive</code> è®¡ç®—å±æ€§</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">const</span> isActive = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> ctx?.<span class="property">activeNames</span>.<span class="property">value</span>?.<span class="title function_">includes</span>(props.<span class="property">name</span>))</span><br></pre></td></tr></table></figure><p>æ ¹æ®çˆ¶ç»„ä»¶çš„ <code>activeNames</code> åˆ¤æ–­å½“å‰é¡¹æ˜¯å¦å¤„äºå±•å¼€çŠ¶æ€</p></blockquote><blockquote><p><code>handleClick</code> ç‚¹å‡»äº‹ä»¶</p><ul><li>æ£€æŸ¥ <code>disabled</code> å±æ€§ï¼Œç¦ç”¨é¡¹ä¸å¯ç‚¹å‡»</li><li>é€šè¿‡ <code>ctx?.handleItemClick</code> é€šçŸ¥çˆ¶ç»„ä»¶æ›´æ–°é€‰ä¸­çŠ¶æ€</li></ul></blockquote><hr><h3 id="template-1"><a href="#template-1" class="headerlink" title="template"></a>template</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">    class=&quot;vr-collapse-item&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">        &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">    &#125;&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">        class=&quot;vr-collapse-item__header&quot;</span><br><span class="line">        :id=&quot;`item-header-$&#123;name&#125;`&quot;</span><br><span class="line">        :class=&quot;&#123;</span><br><span class="line">            &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">            &#x27;is-active&#x27;: isActive,</span><br><span class="line">        &#125;&quot;</span><br><span class="line">        @click=&quot;handleClick&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;vr-collapse-item__title&quot;&gt;</span><br><span class="line">            &lt;slot name=&quot;title&quot;&gt;</span><br><span class="line">                &#123;&#123; title &#125;&#125;</span><br><span class="line">            &lt;/slot&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">        &lt;vr-icon icon=&quot;angle-right&quot; class=&quot;header-angle&quot; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;transition name=&quot;slide&quot; v-on=&quot;transitionEvents&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;vr-collapse-item__wapper&quot; v-show=&quot;isActive&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;vr-collapse-item__content&quot; :id=&quot;`item-content-$&#123;name&#125;`&quot;&gt;</span><br><span class="line">                &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><em><strong>å…³é”®è§£é‡Š</strong></em></p><blockquote><p><code>transition</code> åŠ¨ç”»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&lt;transition name=&quot;slide&quot; v-on=&quot;transitionEvents&quot;&gt;</span><br></pre></td></tr></table></figure><p>å¼•å…¥ <code>transitionEvents.ts</code> ä¸­å®šä¹‰çš„è¿‡æ¸¡é’©å­å‡½æ•°ï¼Œæ§åˆ¶é«˜åº¦å˜åŒ–å®ç°æŠ˜å åŠ¨ç”»</p></blockquote><blockquote><p><code>v-show=&quot;isActive&quot;</code></p><p>æ ¹æ® <code>isActive</code> çŠ¶æ€å†³å®šæ˜¯å¦æ˜¾ç¤ºå†…å®¹åŒºåŸŸ</p></blockquote><blockquote><p><code>header-angle</code> å›¾æ ‡</p><p>é»˜è®¤ä½¿ç”¨ <code>angle-right</code> å›¾æ ‡ï¼Œæ–¹å‘å¯é€šè¿‡è‡ªå®šä¹‰å›¾æ ‡ä¿®æ”¹</p></blockquote><hr><h2 id="constants-ts"><a href="#constants-ts" class="headerlink" title="constants.ts"></a>constants.ts</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">CollapseContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">COLLAPSE_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">CollapseContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;collapseContext&quot;</span>);</span><br></pre></td></tr></table></figure><p><em><strong>å…³é”®è§£é‡Š</strong></em></p><blockquote><p>æ³¨å…¥é”® <code>COLLAPSE_CTX_KEY</code></p><p>å…è®¸ <code>CollapseItem</code> é€šè¿‡ <code>inject</code> è·å–çˆ¶ç»„ä»¶çš„ <code>CollapseContext</code>ï¼ŒåŒ…å« <code>activeNames</code> å’Œ <code>handleItemClick</code> æ–¹æ³•</p></blockquote><hr><h2 id="transitionEvents-ts"><a href="#transitionEvents-ts" class="headerlink" title="transitionEvents.ts"></a>transitionEvents.ts</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">_setHeightZero</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;0px&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setHeightScroll</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt;</span><br><span class="line">  (el.<span class="property">style</span>.<span class="property">height</span> = <span class="string">`<span class="subst">$&#123;el.scrollHeight&#125;</span>px`</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setHeightEmpty</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setOverflowHidden</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&quot;hidden&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setOverflowEmpty</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">transitionEvents</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="function">(<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt;</span> <span class="built_in">void</span>&gt; = &#123;</span><br><span class="line">  <span class="title function_">beforeEnter</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightZero</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowHidden</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">enter</span>: <span class="function">(<span class="params">el</span>) =&gt;</span> <span class="title function_">_setHeightScroll</span>(el),</span><br><span class="line">  <span class="title function_">afterEnter</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightEmpty</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowEmpty</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeLeave</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightScroll</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowHidden</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">leave</span>: <span class="function">(<span class="params">el</span>) =&gt;</span> <span class="title function_">_setHeightZero</span>(el),</span><br><span class="line">  <span class="title function_">afterLeave</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightEmpty</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowEmpty</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> transitionEvents;</span><br></pre></td></tr></table></figure><p><em><strong>å…³é”®è§£é‡Š</strong></em></p><blockquote><p>è¿‡æ¸¡åŠ¨ç”»å®ç°</p><ul><li><strong>beforeEnter&#x2F;afterEnter</strong>ï¼šæ§åˆ¶å…ƒç´ é«˜åº¦ä» <code>0</code> åˆ° <code>scrollHeight</code> å†æ¢å¤é»˜è®¤</li><li><strong>beforeLeave&#x2F;afterLeave</strong>ï¼šæ§åˆ¶å…ƒç´ é«˜åº¦ä» <code>scrollHeight</code> åˆ° <code>0</code> å†æ¢å¤é»˜è®¤</li><li><strong>overflow</strong>ï¼šè¿‡æ¸¡è¿‡ç¨‹ä¸­è®¾ç½® <code>overflow: hidden</code> é¿å…å†…å®¹æº¢å‡º</li></ul></blockquote><hr><h2 id="types-ts"><a href="#types-ts" class="headerlink" title="types.ts"></a>types.ts</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CollapseItemName</span> = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseProps</span> &#123;</span><br><span class="line">  <span class="attr">modelValue</span>: <span class="title class_">CollapseItemName</span>[];</span><br><span class="line">  <span class="attr">accordion</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseItemProps</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="title class_">CollapseItemName</span>;</span><br><span class="line">  <span class="attr">title</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseContext</span> &#123;</span><br><span class="line">  <span class="attr">activeNames</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">CollapseItemName</span>[]&gt;;</span><br><span class="line">  <span class="title function_">handleItemClick</span>(<span class="attr">name</span>: <span class="title class_">CollapseItemName</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;update:modelValue&quot;</span>, <span class="attr">value</span>: <span class="title class_">CollapseItemName</span>[]): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;change&quot;</span>, <span class="attr">value</span>: <span class="title class_">CollapseItemName</span>[]): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em><strong>å…³é”®è§£é‡Š</strong></em></p><blockquote><p><code>CollapseContext</code> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseContext</span> &#123;</span><br><span class="line">&gt;<span class="attr">activeNames</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">CollapseItemName</span>[]&gt;</span><br><span class="line">&gt;<span class="title function_">handleItemClick</span>(<span class="attr">name</span>: <span class="title class_">CollapseItemName</span>): <span class="built_in">void</span></span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰çˆ¶ç»„ä»¶é€šè¿‡ <code>provide</code> æš´éœ²ç»™å­ç»„ä»¶çš„ä¸Šä¸‹æ–‡æ•°æ®å’Œæ–¹æ³•</p></blockquote><blockquote><p><code>CollapseItemProps</code> å¿…è¦å±æ€§</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="attr">name</span>: <span class="title class_">CollapseItemName</span> <span class="comment">// å¿…é¡»å”¯ä¸€æ ‡è¯†ç¬¦</span></span><br></pre></td></tr></table></figure><p>ç”¨äºåˆ¤æ–­æ˜¯å¦è¢«é€‰ä¸­ï¼Œæ”¯æŒå­—ç¬¦ä¸²æˆ–æ•°å­—ç±»å‹</p></blockquote><blockquote><p><code>emits</code> äº‹ä»¶è¯´æ˜</p><ul><li><code>update:modelValue</code>ï¼šåŒå‘ç»‘å®šæ›´æ–°å€¼</li><li><code>change</code>ï¼šé€‰ä¸­çŠ¶æ€å˜åŒ–æ—¶è§¦å‘</li></ul></blockquote><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Collapse ç»„ä»¶é€šè¿‡ä»¥ä¸‹æ ¸å¿ƒæœºåˆ¶å®ç°æŠ˜å é¢æ¿åŠŸèƒ½ï¼š</p><ol><li><strong>åŒå‘ç»‘å®š</strong>ï¼šé€šè¿‡ <code>v-model</code> ç»‘å®š <code>modelValue</code>ï¼Œç»“åˆ <code>update:modelValue</code> å’Œ <code>change</code> äº‹ä»¶åŒæ­¥çŠ¶æ€</li><li><strong>æ‰‹é£ç´æ¨¡å¼</strong>ï¼šé€šè¿‡ <code>accordion</code> å±æ€§é™åˆ¶ä»…å±•å¼€ä¸€ä¸ªé¡¹</li><li><strong>çŠ¶æ€å…±äº«</strong>ï¼šé€šè¿‡ <code>provide/inject</code> å®ç°çˆ¶ç»„ä»¶ä¸å­ç»„ä»¶çš„çŠ¶æ€å’Œæ–¹æ³•ä¼ é€’</li><li><strong>åŠ¨ç”»æ•ˆæœ</strong>ï¼šé€šè¿‡ <code>transitionEvents</code> æ§åˆ¶é«˜åº¦å˜åŒ–å®ç°å¹³æ»‘è¿‡æ¸¡</li></ol><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;vr-collapse v-model=&quot;activeNames&quot; :accordion=&quot;true&quot;&gt;</span><br><span class="line">  &lt;vr-collapse-item </span><br><span class="line">    v-for=&quot;item in items&quot; </span><br><span class="line">    :key=&quot;item.id&quot; </span><br><span class="line">    :name=&quot;item.id&quot;</span><br><span class="line">    :title=&quot;item.title&quot;&gt;</span><br><span class="line">    &#123;&#123; item.content &#125;&#125;</span><br><span class="line">  &lt;/vr-collapse-item&gt;</span><br><span class="line">&lt;/vr-collapse&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç»„ä»¶åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Button æŒ‰é’®</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Button%20%E6%8C%89%E9%92%AE/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Button%20%E6%8C%89%E9%92%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="Button-æŒ‰é’®"><a href="#Button-æŒ‰é’®" class="headerlink" title="Button æŒ‰é’®"></a>Button æŒ‰é’®</h1><h2 id="Button-vue"><a href="#Button-vue" class="headerlink" title="Button.vue"></a>Button.vue</h2><h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, computed, inject &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ButtonProps</span>, <span class="title class_">ButtonEmits</span>, <span class="title class_">ButtonInstance</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">BUTTON_GROUP_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; throttle &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash-es&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrIcon</span> <span class="keyword">from</span> <span class="string">&#x27;../Icon/Icon.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;VrButton&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">ButtonProps</span>&gt;(), &#123;</span><br><span class="line">    <span class="attr">tag</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">    <span class="attr">nativeType</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">    <span class="attr">useThrottle</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">throttleDuration</span>: <span class="number">500</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emits = defineEmits&lt;<span class="title class_">ButtonEmits</span>&gt;();</span><br><span class="line"><span class="keyword">const</span> slots = <span class="title function_">defineSlots</span>();</span><br><span class="line"><span class="keyword">const</span> buttonGroupCtx = <span class="title function_">inject</span>(<span class="variable constant_">BUTTON_GROUP_CTX_KEY</span>, <span class="built_in">void</span> <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _ref = ref&lt;<span class="title class_">HTMLElement</span>&gt;();</span><br><span class="line"><span class="keyword">const</span> size = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> buttonGroupCtx?.<span class="property">size</span> ?? props.<span class="property">size</span> ?? <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">type</span> = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> buttonGroupCtx?.<span class="property">type</span> ?? props.<span class="property">type</span> ?? <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> disabled = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> props.<span class="property">disabled</span> || buttonGroupCtx?.<span class="property">disabled</span> || <span class="literal">false</span>);</span><br><span class="line"><span class="keyword">const</span> hasDefaultSlot = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> !!slots.<span class="property">default</span>);</span><br><span class="line"><span class="keyword">const</span> iconStyle = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">marginRight</span>: hasDefaultSlot.<span class="property">value</span> ? <span class="string">&#x27;6px&#x27;</span> : <span class="string">&#x27;0px&#x27;</span>,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleBtnClick</span> = (<span class="params"><span class="attr">e</span>: <span class="title class_">MouseEvent</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">emits</span>(<span class="string">&#x27;click&#x27;</span>, e);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleBtnClickThrottle = <span class="title function_">throttle</span>(</span><br><span class="line">    handleBtnClick,</span><br><span class="line">    props.<span class="property">throttleDuration</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;<span class="title class_">ButtonInstance</span>&gt;(&#123;</span><br><span class="line">    <span class="attr">ref</span>: _ref,</span><br><span class="line">    disabled,</span><br><span class="line">    size,</span><br><span class="line">    <span class="keyword">type</span>,</span><br><span class="line">    <span class="attr">loading</span>: <span class="title function_">computed</span>(<span class="function">() =&gt;</span> props.<span class="property">loading</span>),</span><br><span class="line">    <span class="attr">click</span>: handleBtnClick,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><em><strong>å…³é”®è§£é‡Š</strong></em></p><blockquote><p><code>defineOptions</code></p><blockquote><p>æœ€ç»ˆå¯¼å‡ºç»„ä»¶åä¸º <code>VrButton</code>ï¼Œåœ¨ packages\core\components.ts ä¸­ä»¥ä»¥ä¸‹å½¢å¼å¯¼å…¥</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">VrButton</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/components&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><blockquote><p><code>withDefaults</code></p><blockquote><p>ç»™ <code>defineProps</code> ç»‘å®š<strong>é»˜è®¤å€¼</strong></p></blockquote><blockquote><p>æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">ButtonProps</span>&#123;</span><br><span class="line">    <span class="attr">tag</span>?: <span class="built_in">string</span> | <span class="title class_">Component</span></span><br><span class="line">    <span class="attr">size</span>?: <span class="string">&#x27;default&#x27;</span> | <span class="string">&#x27;large&#x27;</span> | <span class="string">&#x27;small&#x27;</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">ButtonProps</span>&gt;(), &#123;</span><br><span class="line">   <span class="attr">tag</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">   <span class="attr">nativeType</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">   <span class="attr">useThrottle</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">throttleDuration</span>: <span class="number">500</span>,</span><br><span class="line">&gt;&#125;)</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><code>defineEmits</code></p><blockquote><p>å­å‘çˆ¶å‘å°„äº‹ä»¶</p></blockquote><p><strong>å­ç»„ä»¶</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emits = defineEmits&lt;<span class="title class_">ButtonEmits</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleBtnClick</span> = (<span class="params"><span class="attr">e</span>: <span class="title class_">MouseEvent</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">emits</span>(<span class="string">&#x27;click&#x27;</span>, e)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> handleBtneCLickThrottle = <span class="title function_">throttle</span>(</span><br><span class="line">    handleBtnClick,</span><br><span class="line">    props.<span class="property">throttleDuration</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>çˆ¶ç»„ä»¶</strong> ç”¨æˆ·ä½¿ç”¨ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;vr-... @click=&quot;Click&quot; /&gt; //å½“æ¥æ”¶åˆ°å­ç»„ä»¶å‘å°„è¿‡æ¥çš„äº‹ä»¶ä¹‹åï¼Œè§¦å‘çˆ¶ç»„ä»¶è‡ªå·±çš„&#x27;Click&#x27;å‡½æ•°</span><br></pre></td></tr></table></figure><blockquote><p>1.ç‚¹å‡»å å­ç»„ä»¶çš„ <code>@click</code> è¢«è§¦å‘ï¼Œå°†ä¸€ä¸ª <code>MouseEvent</code> ç±»å‹äº‹ä»¶ä¼ å…¥ <code>handleBtnClick</code> æˆ– <code>handleBtneCLickThrottle</code> å‡½æ•°</p><p>2.<code>emits(&#39;click&#39;, e)</code> å‘çˆ¶ç»„ä»¶å‘å°„ <code>&#39;click&#39;</code> äº‹ä»¶</p><p>3.çˆ¶ç»„ä»¶é€šè¿‡@clickå“åº”åˆ° <code>&#39;click&#39;</code> äº‹ä»¶, å¼€å§‹æ‰§è¡Œçˆ¶ç»„ä»¶ä¸­è‡ªå®šä¹‰çš„ <code>Click</code> äº‹ä»¶</p></blockquote></blockquote><blockquote><p><code>defineSlots</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> slots = <span class="title function_">defineSlots</span>()</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> iconStyle = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">marginRight</span>: slots.<span class="property">default</span> ? <span class="string">&#x27;6px&#x27;</span> : <span class="string">&#x27;0px&#x27;</span>,</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><blockquote><p>æ£€æµ‹ç»„ä»¶æ˜¯å¦æœ‰<slot>é»˜è®¤æ’æ§½, æœ‰åˆ™æ’å…¥æ ·å¼ <code>marginRight: 6px</code></p></blockquote></blockquote><h3 id="template"><a href="#template" class="headerlink" title="template"></a>template</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;component</span><br><span class="line">    :is=&quot;tag&quot;</span><br><span class="line">    ref=&quot;_ref&quot;</span><br><span class="line">    class=&quot;vr-button&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      [`vr-button--$&#123;type&#125;`]: type,</span><br><span class="line">      [`vr-button--$&#123;size&#125;`]: size,</span><br><span class="line">      &#x27;is-plain&#x27;: plain,</span><br><span class="line">      &#x27;is-round&#x27;: round,</span><br><span class="line">      &#x27;is-circle&#x27;: circle,</span><br><span class="line">      &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">      &#x27;is-loading&#x27;: loading,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">    :disabled=&quot;disabled || loading&quot;</span><br><span class="line">    :type=&quot;tag === &#x27;button&#x27; ? nativeType : void 0&quot;</span><br><span class="line">    :autofocus=&quot;autofocus&quot;</span><br><span class="line">    @click=&quot;useThrottle ? handleBtnClickThrottle : handleBtnClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;template v-if=&quot;loading&quot;&gt;</span><br><span class="line">      &lt;slot name=&quot;loading&quot;&gt;</span><br><span class="line">        &lt;vr-icon</span><br><span class="line">          class=&quot;loading-icon&quot;</span><br><span class="line">          :icon=&quot;loadingIcon ?? &#x27;spinner&#x27;&quot;</span><br><span class="line">          :style=&quot;iconStyle&quot;</span><br><span class="line">          size=&quot;1x&quot;</span><br><span class="line">          spin</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;vr-icon</span><br><span class="line">      v-if=&quot;icon &amp;&amp; !loading&quot;</span><br><span class="line">      :icon=&quot;icon&quot;</span><br><span class="line">      size=&quot;1x&quot;</span><br><span class="line">      :style=&quot;iconStyle&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/component&gt;</span><br></pre></td></tr></table></figure><p><em><strong>å…³é”®è§£é‡Š</strong></em></p><blockquote><p><code>&lt;component&gt;&lt;/component&gt;</code>æ˜¯vueå†…ç½®çš„åŠ¨æ€ç»„ä»¶<br>é€šè¿‡:iså¯æ§åˆ¶ç»„ä»¶çš„æœ€ç»ˆç±»å‹</p><p>ä¾‹å¦‚<code>&lt;component :is=&quot;button&quot;&gt;&lt;/component&gt;</code>çš„æœ€ç»ˆæ¸²æŸ“ç»“æœä¸º<code>&lt;button&gt;&lt;/button&gt;</code></p></blockquote><blockquote><p><code>ref=&quot;_ref&quot;</code></p><p>é¦–å…ˆï¼Œ<code>ref</code> å±æ€§çš„ä½œç”¨æ˜¯å°† **DOM å…ƒç´  **æˆ– <strong>å­ç»„ä»¶å®ä¾‹</strong> <em><strong>ç»‘å®š</strong></em> åˆ°å¯¹åº”çš„ <strong>å“åº”å¼å˜é‡</strong> ä¸Š</p><blockquote><p><code>ref=&quot;_ref&quot;</code> å°†æ¸²æŸ“çš„ DOM å…ƒç´ ï¼ˆä¾‹å¦‚ <code>&lt;button&gt;</code> æˆ– <code>&lt;a&gt;</code>ï¼‰ç»‘å®šåˆ° <code>_ref</code> å˜é‡</p><p>ç»„ä»¶æŒ‚è½½åï¼Œ<code>_ref.value</code> å°±ä¼šæŒ‡å‘è¿™ä¸ª DOM å…ƒç´ </p></blockquote><p>ä½¿ç”¨ <code>defineExpose</code> å°† <code>_ref</code> æš´éœ²ç»™çˆ¶ç»„ä»¶ï¼Œå…è®¸çˆ¶ç»„ä»¶è®¿é—®å­ç»„ä»¶çš„ DOM å…ƒç´ </p><p>ä¾‹å¦‚ï¼Œçˆ¶ç»„ä»¶å¯ä»¥è°ƒç”¨å­ç»„ä»¶æŒ‰é’®çš„ <code>focus()</code> æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&lt;vr-button ref=&quot;myButton&quot; /&gt;</span><br><span class="line">&gt;&lt;button @click=&quot;focus&quot;&gt;focus vr-button&lt;/button&gt;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">const</span> myButton = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">function</span> <span class="title function_">focus</span>(<span class="params"></span>) &#123;</span><br><span class="line">   myButton.<span class="property">value</span>.<span class="property">ref</span>.<span class="title function_">focus</span>() <span class="comment">// è°ƒç”¨å­ç»„ä»¶çš„ DOM å…ƒç´ çš„ focus æ–¹æ³•</span></span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å½“ç”¨æˆ·ç‚¹å‡»çˆ¶ç»„ä»¶çš„æŒ‰é’®æ—¶ï¼Œå­ç»„ä»¶çš„æŒ‰é’®ä¼šè·å¾—ç„¦ç‚¹</p></blockquote></blockquote><blockquote><p><code>:class</code></p><p>ä½¿ç”¨å¯¹è±¡è¯­æ³•åŠ¨æ€ç»‘å®šç±»å</p><p>ä¾‹å¦‚æ–‡ä¸­ä¸¤ç§</p><blockquote><p>å½“ <code>type</code> å­˜åœ¨æ—¶ï¼ˆå¦‚ <code>primary</code>ã€<code>success</code>ï¼‰ï¼Œæ·»åŠ ç±»å <code>er-button--primary</code></p></blockquote><blockquote><p><code>&#39;is-plain&#39;: plain</code></p><p>å½“ plain ä¸º true æ—¶ï¼Œæ·»åŠ ç±»å <code>is-plain</code></p></blockquote></blockquote><h2 id="constants-ts"><a href="#constants-ts" class="headerlink" title="constants.ts"></a>constants.ts</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ButtonGroupContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨å…¥é”®ï¼ˆInjection Keyï¼‰ï¼ˆBUTTON_GROUP_CTX_KEYï¼‰</span></span><br><span class="line"><span class="comment">//ä¸»è¦ä½œç”¨æ˜¯ä¸ºæŒ‰é’®ç»„ç»„ä»¶ï¼ˆ`ButtonGroup`ï¼‰æä¾›ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ï¼Œä½¿å¾—æŒ‰é’®ç»„ä¸­çš„å­æŒ‰é’®å¯ä»¥è®¿é—®çˆ¶çº§æŒ‰é’®ç»„çš„ç›¸å…³ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">BUTTON_GROUP_CTX_KEY</span>: </span><br><span class="line"><span class="title class_">InjectionKey</span>&lt;<span class="title class_">ButtonGroupContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;buttonGroupContext&quot;</span>);<span class="comment">//åŸå§‹æ•°æ®ç±»å‹ï¼Œç”¨äºåˆ›å»ºå”¯ä¸€çš„æ ‡è¯†ç¬¦</span></span><br></pre></td></tr></table></figure><p><em><strong>å…³é”®è§£é‡Š</strong></em></p><blockquote><p>ä¸¾ä¸ªä¾‹å­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çˆ¶ç»„ä»¶</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨ `provide` æ–¹æ³•å°†æŸäº›æ•°æ®æˆ–æ–¹æ³•æä¾›ç»™å­ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> &#123; provide &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>; </span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">BUTTON_GROUP_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constants&quot;</span>; </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; </span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123; </span><br><span class="line"><span class="keyword">const</span> buttonGroupContext = &#123; <span class="attr">size</span>: <span class="string">&quot;large&quot;</span>, <span class="attr">type</span>: <span class="string">&quot;primary&quot;</span>, &#125;; </span><br><span class="line"><span class="title function_">provide</span>(<span class="variable constant_">BUTTON_GROUP_CTX_KEY</span>, buttonGroupContext); <span class="comment">// æä¾›ä¸Šä¸‹æ–‡ </span></span><br><span class="line"><span class="keyword">return</span> &#123;&#125;; </span><br><span class="line">&#125;, </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å­ç»„ä»¶</span></span><br><span class="line"><span class="comment">//é€šè¿‡ `inject` æ–¹æ³•è·å–çˆ¶ç»„ä»¶æä¾›çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">BUTTON_GROUP_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constants&quot;</span>; </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123; </span><br><span class="line"><span class="keyword">const</span> buttonGroupContext = <span class="title function_">inject</span>(<span class="variable constant_">BUTTON_GROUP_CTX_KEY</span>); <span class="comment">// æ³¨å…¥ä¸Šä¸‹æ–‡ </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buttonGroupContext); <span class="comment">// è¾“å‡º &#123; size: &quot;large&quot;, type: &quot;primary&quot; &#125; </span></span><br><span class="line"><span class="keyword">return</span> &#123;&#125;; </span><br><span class="line">&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></blockquote><h2 id="types-ts"><a href="#types-ts" class="headerlink" title="types.ts"></a>types.ts</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Component</span>, <span class="keyword">type</span> <span class="title class_">ComputedRef</span>, <span class="keyword">type</span> <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ButtonType</span> = <span class="string">&#x27;primary&#x27;</span> | <span class="string">&#x27;success&#x27;</span> | <span class="string">&#x27;warning&#x27;</span> | <span class="string">&#x27;danger&#x27;</span> | <span class="string">&#x27;info&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NativeType</span> = <span class="string">&#x27;button&#x27;</span> | <span class="string">&#x27;submit&#x27;</span> | <span class="string">&#x27;reset&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ButtonSize</span> = <span class="string">&#x27;default&#x27;</span> | <span class="string">&#x27;large&#x27;</span> | <span class="string">&#x27;small&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonProps</span> &#123;</span><br><span class="line"><span class="attr">tag</span>?: <span class="built_in">string</span> | <span class="title class_">Component</span></span><br><span class="line"><span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line"><span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line"><span class="attr">plain</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">round</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">circle</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">autofocus</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">nativeType</span>?: <span class="title class_">NativeType</span></span><br><span class="line"><span class="attr">icon</span>?: <span class="built_in">string</span></span><br><span class="line"><span class="attr">loading</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">loadingIcon</span>?: <span class="built_in">string</span></span><br><span class="line"><span class="attr">useThrottle</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">throttleDuration</span>?: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonGroupProps</span> &#123;</span><br><span class="line"><span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line"><span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line"><span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonGroupContext</span> &#123;</span><br><span class="line"><span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line"><span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line"><span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonEmits</span> &#123;</span><br><span class="line">(<span class="attr">e</span>: <span class="string">&#x27;click&#x27;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonInstance</span> &#123;</span><br><span class="line"><span class="attr">ref</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">HTMLButtonElement</span> | <span class="built_in">void</span>&gt;</span><br><span class="line"><span class="attr">disabled</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">boolean</span>&gt;</span><br><span class="line"><span class="attr">size</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line"><span class="attr">type</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç»„ä»¶åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Alert æç¤ºç»„ä»¶</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Alert%20%E6%8F%90%E7%A4%BA/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Alert%20%E6%8F%90%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<h3 id="Alert-è­¦å‘Šæç¤ºç»„ä»¶åˆ†æ"><a href="#Alert-è­¦å‘Šæç¤ºç»„ä»¶åˆ†æ" class="headerlink" title="Alert è­¦å‘Šæç¤ºç»„ä»¶åˆ†æ"></a>Alert è­¦å‘Šæç¤ºç»„ä»¶åˆ†æ</h3><hr><h4 id="ç»„ä»¶åŠŸèƒ½æ¦‚è¿°"><a href="#ç»„ä»¶åŠŸèƒ½æ¦‚è¿°" class="headerlink" title="ç»„ä»¶åŠŸèƒ½æ¦‚è¿°"></a><strong>ç»„ä»¶åŠŸèƒ½æ¦‚è¿°</strong></h4><p>Alert ç»„ä»¶ç”¨äºæ˜¾ç¤ºä¸åŒç±»å‹ï¼ˆå¦‚æˆåŠŸã€è­¦å‘Šç­‰ï¼‰çš„æç¤ºä¿¡æ¯ï¼Œæ”¯æŒå…³é—­ã€å›¾æ ‡ã€å±…ä¸­å¯¹é½ç­‰åŠŸèƒ½ï¼Œé€šè¿‡ <code>v-model</code> æˆ– <code>v-show</code> æ§åˆ¶æ˜¾ç¤ºçŠ¶æ€ã€‚</p><hr><h4 id="æ ¸å¿ƒä»£ç è§£æ"><a href="#æ ¸å¿ƒä»£ç è§£æ" class="headerlink" title="æ ¸å¿ƒä»£ç è§£æ"></a><strong>æ ¸å¿ƒä»£ç è§£æ</strong></h4><hr><h3 id="Script-éƒ¨åˆ†"><a href="#Script-éƒ¨åˆ†" class="headerlink" title="Script éƒ¨åˆ†"></a><strong>Script éƒ¨åˆ†</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">AlertProps</span>, <span class="title class_">AlertEmits</span>, <span class="title class_">AlertInstance</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; typeIconMap &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrIcon</span> <span class="keyword">from</span> <span class="string">&#x27;../Icon/Icon.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;VrAlert&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">AlertProps</span>&gt;(), &#123;</span><br><span class="line">  <span class="attr">effect</span>: <span class="string">&#x27;light&#x27;</span>,      <span class="comment">// é»˜è®¤è§†è§‰æ•ˆæœ</span></span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,         <span class="comment">// é»˜è®¤ç±»å‹</span></span><br><span class="line">  <span class="attr">closable</span>: <span class="literal">true</span>,       <span class="comment">// é»˜è®¤æ˜¾ç¤ºå…³é—­æŒ‰é’®</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emits = defineEmits&lt;<span class="title class_">AlertEmits</span>&gt;()</span><br><span class="line"><span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">true</span>) <span class="comment">// æ§åˆ¶æ˜¾ç¤ºçŠ¶æ€</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iconName = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> </span><br><span class="line">  typeIconMap.<span class="title function_">get</span>(props.<span class="property">type</span>) ?? <span class="string">&#x27;circle-info&#x27;</span> <span class="comment">// æ ¹æ®ç±»å‹è·å–å›¾æ ‡</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> withDescription = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> </span><br><span class="line">  props.<span class="property">description</span> || !!<span class="title function_">useSlots</span>().<span class="property">default</span> <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰æè¿°å†…å®¹</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">close</span>(<span class="params"></span>) &#123;</span><br><span class="line">  visible.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">  <span class="title function_">emits</span>(<span class="string">&#x27;close&#x27;</span>) <span class="comment">// è§¦å‘å…³é—­äº‹ä»¶</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">open</span>(<span class="params"></span>) &#123;</span><br><span class="line">  visible.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defineExpose&lt;<span class="title class_">AlertInstance</span>&gt;(&#123;</span><br><span class="line">  open,</span><br><span class="line">  close,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h4 id="å…³é”®ç‚¹è§£é‡Š"><a href="#å…³é”®ç‚¹è§£é‡Š" class="headerlink" title="å…³é”®ç‚¹è§£é‡Š"></a><strong>å…³é”®ç‚¹è§£é‡Š</strong></h4><ol><li><p><strong>Props é»˜è®¤å€¼</strong></p><ul><li><code>effect</code>ï¼šé»˜è®¤ <code>light</code>ï¼ˆæµ…è‰²èƒŒæ™¯ï¼‰</li><li><code>type</code>ï¼šé»˜è®¤ <code>info</code>ï¼ˆä¿¡æ¯ç±»å‹ï¼‰</li><li><code>closable</code>ï¼šé»˜è®¤æ˜¾ç¤ºå…³é—­æŒ‰é’®</li></ul></li><li><p><strong>å›¾æ ‡é€»è¾‘</strong></p><ul><li>é€šè¿‡ <code>typeIconMap</code> æ˜ å°„ç±»å‹åˆ°å›¾æ ‡ï¼ˆå¦‚ <code>success â†’ check-circle</code>ï¼‰</li><li>é»˜è®¤å›¾æ ‡ä¸º <code>circle-info</code>ï¼ˆå½“ç±»å‹æœªåŒ¹é…æ—¶ï¼‰</li></ul></li><li><p><strong>å†…å®¹åˆ¤æ–­</strong></p><ul><li><code>withDescription</code>ï¼šè‹¥å­˜åœ¨ <code>description</code> æˆ–é»˜è®¤æ’æ§½å†…å®¹ï¼Œåˆ™è®¤ä¸ºæœ‰æè¿°ï¼Œè°ƒæ•´å›¾æ ‡å¤§å°</li></ul></li><li><p><strong>çŠ¶æ€æ§åˆ¶</strong></p><ul><li><code>visible</code>ï¼šé€šè¿‡ <code>v-show</code> æ§åˆ¶ç»„ä»¶æ˜¾ç¤º</li><li><code>close</code> æ–¹æ³•è§¦å‘ <code>close</code> äº‹ä»¶å¹¶éšè—ç»„ä»¶</li><li><code>open</code> æ–¹æ³•æš´éœ²ç»™å¤–éƒ¨è°ƒç”¨</li></ul></li></ol><hr><h3 id="Template-éƒ¨åˆ†"><a href="#Template-éƒ¨åˆ†" class="headerlink" title="Template éƒ¨åˆ†"></a><strong>Template éƒ¨åˆ†</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition name=&quot;vr-alert-fade&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&quot;visible&quot;</span><br><span class="line">      class=&quot;vr-alert&quot;</span><br><span class="line">      role=&quot;alert&quot;</span><br><span class="line">      :class=&quot;&#123;</span><br><span class="line">        [`vr-alert__$&#123;type&#125;`]: type,</span><br><span class="line">        [`vr-alert__$&#123;effect&#125;`]: effect,</span><br><span class="line">        &#x27;text-center&#x27;: center,</span><br><span class="line">      &#125;&quot;&gt;</span><br><span class="line">      &lt;!-- å›¾æ ‡ --&gt;</span><br><span class="line">      &lt;vr-icon</span><br><span class="line">        v-if=&quot;showIcon&quot;</span><br><span class="line">        class=&quot;vr-alert__icon&quot;</span><br><span class="line">        :class=&quot;&#123; &#x27;big-icon&#x27;: withDescription &#125;&quot;</span><br><span class="line">        :icon=&quot;iconName&quot; /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- å†…å®¹åŒºåŸŸ --&gt;</span><br><span class="line">      &lt;div class=&quot;vr-alert__content&quot;&gt;</span><br><span class="line">        &lt;span</span><br><span class="line">          class=&quot;vr-alert__title&quot;</span><br><span class="line">          :class=&quot;&#123; &#x27;with-desc&#x27;: withDescription &#125;&quot;</span><br><span class="line">          :style=&quot;&#123; display: center &amp;&amp; !showIcon ? &#x27;flow&#x27; : &#x27;inline&#x27; &#125;&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;title&quot;&gt;&#123;&#123; title &#125;&#125;&lt;/slot&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- æè¿°å†…å®¹ --&gt;</span><br><span class="line">        &lt;p class=&quot;vr-alert__description&quot;&gt;</span><br><span class="line">          &lt;slot&gt;&#123;&#123; description &#125;&#125;&lt;/slot&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- å…³é—­æŒ‰é’® --&gt;</span><br><span class="line">        &lt;div v-if=&quot;closable&quot; class=&quot;vr-alert__close&quot; @click.stop=&quot;close&quot;&gt;</span><br><span class="line">          &lt;vr-icon icon=&quot;xmark&quot; /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><hr><h4 id="å…³é”®ç‚¹è§£é‡Š-1"><a href="#å…³é”®ç‚¹è§£é‡Š-1" class="headerlink" title="å…³é”®ç‚¹è§£é‡Š"></a><strong>å…³é”®ç‚¹è§£é‡Š</strong></h4><ol><li><p><strong>è¿‡æ¸¡åŠ¨ç”»</strong></p><ul><li>ä½¿ç”¨ <code>vr-alert-fade</code> å®ç°æ¸éšæ•ˆæœï¼ˆéœ€åœ¨æ ·å¼ä¸­å®šä¹‰è¿‡æ¸¡ç±»ï¼‰</li></ul></li><li><p><strong>ç±»åæ§åˆ¶</strong></p><ul><li><code>vr-alert__type</code>ï¼šæ ¹æ® <code>type</code> æ·»åŠ ç±»å‹æ ·å¼ï¼ˆå¦‚ <code>vr-alert__success</code>ï¼‰</li><li><code>vr-alert__effect</code>ï¼šæ ¹æ® <code>effect</code> æ·»åŠ è§†è§‰æ•ˆæœæ ·å¼</li><li><code>text-center</code>ï¼šå±…ä¸­å¯¹é½å†…å®¹</li></ul></li><li><p><strong>å›¾æ ‡æ˜¾ç¤º</strong></p><ul><li><code>showIcon</code> æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºå›¾æ ‡</li><li><code>big-icon</code> ç±»åœ¨æœ‰æè¿°æ—¶å¢å¤§å›¾æ ‡å°ºå¯¸</li></ul></li><li><p><strong>æ ‡é¢˜ä¸æè¿°</strong></p><ul><li>æ ‡é¢˜æ”¯æŒè‡ªå®šä¹‰æ’æ§½ï¼Œä½¿ç”¨ <code>slot=&quot;title&quot;</code></li><li>æè¿°å†…å®¹ä½¿ç”¨é»˜è®¤æ’æ§½æˆ– <code>description</code> å±æ€§</li><li>å½“ <code>center</code> ä¸º <code>true</code> ä¸”æ— å›¾æ ‡æ—¶ï¼Œæ ‡é¢˜é‡‡ç”¨ <code>flex</code> å¸ƒå±€ï¼ˆå¯èƒ½å­˜åœ¨ <code>flow</code> æ‹¼å†™é”™è¯¯ï¼‰</li></ul></li><li><p><strong>å…³é—­æŒ‰é’®</strong></p><ul><li>ç‚¹å‡»å…³é—­æ—¶é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼ˆ<code>@click.stop</code>ï¼‰</li><li>å›¾æ ‡ä½¿ç”¨ <code>xmark</code>ï¼ˆå‰å·ï¼‰</li></ul></li></ol><hr><h3 id="æ ¸å¿ƒæœºåˆ¶æ€»ç»“"><a href="#æ ¸å¿ƒæœºåˆ¶æ€»ç»“" class="headerlink" title="æ ¸å¿ƒæœºåˆ¶æ€»ç»“"></a><strong>æ ¸å¿ƒæœºåˆ¶æ€»ç»“</strong></h3><ol><li><p><strong>ç±»å‹ä¸å›¾æ ‡æ˜ å°„</strong></p><ul><li>é€šè¿‡ <code>typeIconMap</code> å°† <code>AlertType</code> æ˜ å°„åˆ°å…·ä½“å›¾æ ‡ï¼ˆå¦‚ <code>success â†’ check-circle</code>ï¼‰ã€‚</li></ul></li><li><p><strong>å†…å®¹ä¸å¸ƒå±€</strong></p><ul><li>æ”¯æŒæ ‡é¢˜ã€æè¿°ã€å…³é—­æŒ‰é’®çš„ç»„åˆæ˜¾ç¤ºã€‚</li><li><code>center</code> å±æ€§ä½¿å†…å®¹å±…ä¸­ï¼Œéœ€é…åˆæ— å›¾æ ‡æ—¶çš„ <code>flex</code> å¸ƒå±€è°ƒæ•´ã€‚</li></ul></li><li><p><strong>çŠ¶æ€æ§åˆ¶</strong></p><ul><li><code>visible</code> æ§åˆ¶æ˜¾ç¤ºï¼Œé€šè¿‡ <code>v-show</code> å’Œ <code>transition</code> å®ç°æ¸éšåŠ¨ç”»ã€‚</li><li>å¤–éƒ¨å¯é€šè¿‡ <code>alertRef.close()</code> æˆ– <code>v-model</code> æ§åˆ¶æ˜¾ç¤ºã€‚</li></ul></li><li><p><strong>è§†è§‰æ•ˆæœ</strong></p><ul><li><code>effect</code> æ§åˆ¶èƒŒæ™¯è‰²å’Œè¾¹æ¡†è‰²ï¼ˆ<code>light</code> æˆ– <code>dark</code>ï¼‰ã€‚</li><li><code>type</code> å†³å®šé¢œè‰²ä¸»é¢˜ï¼ˆå¦‚æˆåŠŸã€è­¦å‘Šç­‰ï¼‰ã€‚</li></ul></li></ol><hr><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a><strong>ä½¿ç”¨ç¤ºä¾‹</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;vr-alert</span><br><span class="line">    v-model:visible=&quot;alertVisible&quot;</span><br><span class="line">    type=&quot;success&quot;</span><br><span class="line">    closable</span><br><span class="line">    center</span><br><span class="line">    show-icon</span><br><span class="line">    @close=&quot;handleClose&quot;&gt;</span><br><span class="line">    &lt;template #title&gt;æ“ä½œæˆåŠŸ&lt;/template&gt;</span><br><span class="line">    &lt;p&gt;æ‚¨çš„æ“ä½œå·²æˆåŠŸå®Œæˆï¼&lt;/p&gt;</span><br><span class="line">  &lt;/vr-alert&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const alertVisible = ref(true)</span><br><span class="line">const handleClose = () =&gt; &#123;</span><br><span class="line">  alertVisible.value = false</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="API-æ–‡æ¡£"><a href="#API-æ–‡æ¡£" class="headerlink" title="API æ–‡æ¡£"></a><strong>API æ–‡æ¡£</strong></h3><table><thead><tr><th>å±æ€§</th><th>ç±»å‹</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>type</code></td><td><code>AlertType</code></td><td><code>info</code></td><td>æç¤ºç±»å‹ï¼ˆsuccess&#x2F;info&#x2F;warning&#x2F;dangerï¼‰</td></tr><tr><td><code>effect</code></td><td><code>string</code></td><td><code>light</code></td><td>è§†è§‰æ•ˆæœï¼ˆlight&#x2F;darkï¼‰</td></tr><tr><td><code>closable</code></td><td><code>boolean</code></td><td><code>true</code></td><td>æ˜¯å¦æ˜¾ç¤ºå…³é—­æŒ‰é’®</td></tr><tr><td><code>center</code></td><td><code>boolean</code></td><td><code>false</code></td><td>å†…å®¹æ˜¯å¦å±…ä¸­</td></tr><tr><td><code>showIcon</code></td><td><code>boolean</code></td><td><code>true</code></td><td>æ˜¯å¦æ˜¾ç¤ºå›¾æ ‡</td></tr><tr><td><code>title</code></td><td><code>string</code></td><td>-</td><td>æ ‡é¢˜æ–‡æœ¬</td></tr><tr><td><code>description</code></td><td><code>string</code></td><td>-</td><td>æè¿°æ–‡æœ¬</td></tr></tbody></table><table><thead><tr><th>æ’æ§½</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>title</code></td><td>è‡ªå®šä¹‰æ ‡é¢˜å†…å®¹</td></tr><tr><td><code>default</code></td><td>è‡ªå®šä¹‰æè¿°å†…å®¹</td></tr></tbody></table><table><thead><tr><th>äº‹ä»¶</th><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>close</code></td><td>æ— </td><td>å…³é—­æ—¶è§¦å‘</td></tr></tbody></table><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>open()</code></td><td>æ˜¾ç¤ºæç¤º</td></tr><tr><td><code>close()</code></td><td>éšè—æç¤º</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> ç»„ä»¶åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é€šä¿—ç‰ˆPromiseè§£é‡Š</title>
      <link href="/2025/03/08/JS/%E9%80%9A%E4%BF%97%E7%89%88Promise%E8%A7%A3%E9%87%8A/"/>
      <url>/2025/03/08/JS/%E9%80%9A%E4%BF%97%E7%89%88Promise%E8%A7%A3%E9%87%8A/</url>
      
        <content type="html"><![CDATA[<h1 id="é€šä¿—ç‰ˆPromiseè§£é‡Š"><a href="#é€šä¿—ç‰ˆPromiseè§£é‡Š" class="headerlink" title="é€šä¿—ç‰ˆPromiseè§£é‡Š"></a>é€šä¿—ç‰ˆPromiseè§£é‡Š</h1><p><strong>é¦–å…ˆè¦ç†è§£å‰ç«¯çš„åŒæ­¥å¼‚æ­¥ä»»åŠ¡æµç¨‹</strong></p><h2 id="åŒæ­¥-vs-å¼‚æ­¥ä»»åŠ¡"><a href="#åŒæ­¥-vs-å¼‚æ­¥ä»»åŠ¡" class="headerlink" title="åŒæ­¥ vs å¼‚æ­¥ä»»åŠ¡"></a>åŒæ­¥ vs å¼‚æ­¥ä»»åŠ¡</h2><h3 id="åŒæ­¥ä»»åŠ¡ï¼ˆæ’é˜Ÿä¹°å¥¶èŒ¶ï¼‰"><a href="#åŒæ­¥ä»»åŠ¡ï¼ˆæ’é˜Ÿä¹°å¥¶èŒ¶ï¼‰" class="headerlink" title="åŒæ­¥ä»»åŠ¡ï¼ˆæ’é˜Ÿä¹°å¥¶èŒ¶ï¼‰"></a><strong>åŒæ­¥ä»»åŠ¡ï¼ˆæ’é˜Ÿä¹°å¥¶èŒ¶ï¼‰</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// ä½ ç«™åœ¨æŸœå°å‰å¹²ç­‰ï¼Œä¸åšå…¶ä»–äº‹</span><br><span class="line">console.log(&quot;1. ç‚¹å•ï¼šæˆ‘è¦çç å¥¶èŒ¶&quot;);</span><br><span class="line">console.log(&quot;2. ç­‰åº—å‘˜åˆ¶ä½œ...ï¼ˆå¹²ç­‰5ç§’ï¼‰&quot;);</span><br><span class="line">// æ¨¡æ‹ŸåŒæ­¥ç­‰å¾…</span><br><span class="line">const start = Date.now();</span><br><span class="line">while (Date.now() - start &lt; 5000) &#123;&#125; // ç›´æ¥é˜»æ–­åé¢çš„è¿›ç¨‹ï¼Œé˜»å¡5ç§’</span><br><span class="line">console.log(&quot;3. æ‹¿åˆ°å¥¶èŒ¶ï¼Œå¼€å¿ƒå–ï¼&quot;);</span><br></pre></td></tr></table></figure><hr><h3 id="å¼‚æ­¥ä»»åŠ¡ï¼ˆå¤–å–é€šçŸ¥ï¼‰"><a href="#å¼‚æ­¥ä»»åŠ¡ï¼ˆå¤–å–é€šçŸ¥ï¼‰" class="headerlink" title="å¼‚æ­¥ä»»åŠ¡ï¼ˆå¤–å–é€šçŸ¥ï¼‰"></a><strong>å¼‚æ­¥ä»»åŠ¡ï¼ˆå¤–å–é€šçŸ¥ï¼‰</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">console.log(&quot;1. æ‰‹æœºä¸‹å•å¥¶èŒ¶&quot;);</span><br><span class="line">// å¼‚æ­¥æ“ä½œï¼šä¸‹å•åå…ˆåšå…¶ä»–äº‹ï¼Œç­‰é€šçŸ¥</span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  console.log(&quot;3. å¤–å–å‘˜é€šçŸ¥ï¼šå¥¶èŒ¶åˆ°å•¦ï¼&quot;);</span><br><span class="line">&#125;, 5000); // 5ç§’åæ‰è§¦å‘å›è°ƒï¼Œä¸é˜»å¡ä¸»è¿›ç¨‹</span><br><span class="line">console.log(&quot;2. ä¸‹å•æˆåŠŸï¼Œå…ˆå»æ‰“æ¸¸æˆ~&quot;);</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºé¡ºåº</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. æ‰‹æœºä¸‹å•å¥¶èŒ¶  </span><br><span class="line">2. ä¸‹å•æˆåŠŸï¼Œå…ˆå»æ‰“æ¸¸æˆ~  </span><br><span class="line">3. å¤–å–å‘˜é€šçŸ¥ï¼šå¥¶èŒ¶åˆ°å•¦ï¼  </span><br></pre></td></tr></table></figure><h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>**å¯ä»¥æŠŠ <strong><strong>Promise</strong> æƒ³è±¡æˆä¸€å¼  <strong>è®¢é¤æ—¶çš„è®¢å•å°ç¥¨</strong>ã€‚</strong> **ä½ ç‚¹äº†ä¸€ä»½å¤–å–ï¼ˆå‘èµ·ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰ï¼Œè¿™æ—¶å€™æœåŠ¡å‘˜ä¸ä¼šè®©ä½ å¹²ç­‰ç€ï¼Œè€Œæ˜¯ç»™ä½ ä¸€å¼ è®¢å•å°ç¥¨ï¼ˆPromiseå¯¹è±¡ï¼‰ï¼Œå‘Šè¯‰ä½ ï¼šâ€œé¤å¥½äº†ä¼šé€šçŸ¥ä½ â€ã€‚</p><hr><h3 id="é€šä¿—ç‰ˆè§£é‡Šï¼š"><a href="#é€šä¿—ç‰ˆè§£é‡Šï¼š" class="headerlink" title="é€šä¿—ç‰ˆè§£é‡Šï¼š"></a><strong>é€šä¿—ç‰ˆè§£é‡Šï¼š</strong></h3><ol><li><strong>ä¸‹å•ï¼ˆPendingçŠ¶æ€ï¼‰</strong><ul><li>**ä½ ç‚¹äº†é¤ï¼Œä½†é¥­è¿˜æ²¡åšå¥½ â†’ **<code>new Promise()</code> åˆ›å»ºæ—¶å¤„äº <strong>è¿›è¡Œä¸­ï¼ˆPendingï¼‰</strong>ã€‚</li><li><strong>æ­¤æ—¶ä½ ï¼ˆä»£ç ï¼‰å¯ä»¥ç»§ç»­åšå…¶ä»–äº‹ï¼ˆæ¯”å¦‚ç©æ‰‹æœºï¼‰ï¼Œä¸ç”¨ä¸€ç›´ç›¯ç€å¨æˆ¿ã€‚ï¼ˆå¼‚æ­¥ï¼‰</strong></li></ul></li><li><strong>é¤å¥½äº†ï¼ˆFulfilledçŠ¶æ€ï¼‰</strong><ul><li>**å¨æˆ¿é€šçŸ¥ä½ ï¼šâ€œé¤å¥½äº†ï¼Œæ¥å–å§ï¼â€ â†’ Promise **<strong>æˆåŠŸï¼ˆResolvedï¼‰</strong>ã€‚</li><li>**ä½ æ‹¿åˆ°é¥­åå¼€å§‹åƒ â†’ ç”¨ **<code>.then()</code> å¤„ç†æˆåŠŸçš„ç»“æœï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order.then(food =&gt; eat(food)); // æ‹¿åˆ°é¥­å°±åƒ</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>é¤å‡ºé—®é¢˜äº†ï¼ˆRejectedçŠ¶æ€ï¼‰</strong><ul><li>**å¨æˆ¿è¯´ï¼šâ€œæŠ±æ­‰ï¼Œæ²¡é£Ÿæäº†â€ â†’ Promise **<strong>å¤±è´¥ï¼ˆRejectedï¼‰</strong>ã€‚</li><li>**ä½ å†³å®šæ³¡é¢ â†’ ç”¨ **<code>.catch()</code> å¤„ç†å¤±è´¥ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order.catch(error =&gt; eatInstantNoodles()); // å¤±è´¥å°±åƒæ³¡é¢</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æ— è®ºå¦‚ä½•éƒ½è¦æ”¶æ‹¾æ¡Œå­ï¼ˆFinallyï¼‰</strong><ul><li>**ä¸ç®¡åƒæ²¡åƒåˆ°å¤–å–ï¼Œä½ éƒ½è¦æ“¦æ¡Œå­ â†’ **<code>.finally()</code>ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order.finally(() =&gt; cleanTable()); // æ— è®ºæˆè´¥éƒ½æ‰§è¡Œ</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h3 id="ä¸ºä»€ä¹ˆæ¯”-â€œå›è°ƒå‡½æ•°â€-æ›´å¥½ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ¯”-â€œå›è°ƒå‡½æ•°â€-æ›´å¥½ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ¯” â€œå›è°ƒå‡½æ•°â€ æ›´å¥½ï¼Ÿ"></a><strong>ä¸ºä»€ä¹ˆæ¯” â€œå›è°ƒå‡½æ•°â€ æ›´å¥½ï¼Ÿ</strong></h3><ul><li><strong>å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰</strong>ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">// ä¼ ç»Ÿå›è°ƒå†™æ³•</span><br><span class="line">function orderMilkTea(callback) &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        console.log(&quot;1. æ‹¿åˆ°åŸºç¡€å¥¶èŒ¶&quot;);</span><br><span class="line">        callback(null, &quot;ğŸµåŸºç¡€å¥¶èŒ¶&quot;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addPearl(tea, callback) &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        console.log(&quot;2. åŠ çç &quot;);</span><br><span class="line">        callback(null, tea + &quot; + ğŸ±çç &quot;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addCheeseFoam(tea, callback) &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        console.log(&quot;3. åŠ å¥¶ç›–&quot;);</span><br><span class="line">        callback(null, tea + &quot; + ğŸ§€å¥¶ç›–&quot;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨å›è°ƒåœ°ç‹±</span><br><span class="line">orderMilkTea((error, tea) =&gt; &#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(&quot;å¤±è´¥ï¼š&quot;, error);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        addPearl(tea, (error, teaWithPearl) =&gt; &#123;</span><br><span class="line">            if (error) &#123;</span><br><span class="line">                console.log(&quot;å¤±è´¥ï¼š&quot;, error);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                addCheeseFoam(teaWithPearl, (error, finalTea) =&gt; &#123;</span><br><span class="line">                    if (error) &#123;</span><br><span class="line">                        console.log(&quot;å¤±è´¥ï¼š&quot;, error);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        console.log(&quot;æœ€ç»ˆå¥¶èŒ¶ï¼š&quot;, finalTea);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><strong>Promiseé“¾å¼è°ƒç”¨</strong>ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">// ç”¨PromiseåŒ…è£…å¼‚æ­¥æ“ä½œ</span><br><span class="line">function orderMilkTea() &#123;</span><br><span class="line">    return new Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&quot;1. æ‹¿åˆ°åŸºç¡€å¥¶èŒ¶&quot;);</span><br><span class="line">            resolve(&quot;ğŸµåŸºç¡€å¥¶èŒ¶&quot;);</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addPearl(tea) &#123;</span><br><span class="line">    return new Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&quot;2. åŠ çç &quot;);</span><br><span class="line">            resolve(tea + &quot; + ğŸ§‹çç &quot;);</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addCheeseFoam(tea) &#123;</span><br><span class="line">    return new Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&quot;3. åŠ å¥¶ç›–&quot;);</span><br><span class="line">            resolve(tea + &quot; + ğŸ§€å¥¶ç›–&quot;);</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// é“¾å¼è°ƒç”¨</span><br><span class="line">orderMilkTea()</span><br><span class="line">    .then(tea =&gt; addPearl(tea))</span><br><span class="line">    .then(teaWithPearl =&gt; addCheeseFoam(teaWithPearl))</span><br><span class="line">    .then(finalTea =&gt; &#123;</span><br><span class="line">    console.log(&quot;æœ€ç»ˆå¥¶èŒ¶ï¼š&quot;, finalTea);</span><br><span class="line">&#125;)</span><br><span class="line">    .catch(error =&gt; &#123;</span><br><span class="line">    console.log(&quot;å¤±è´¥ï¼š&quot;, error);</span><br><span class="line">&#125;)</span><br><span class="line">    .finally(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;æµç¨‹ç»“æŸï¼Œæ¸…ç†æ“ä½œ&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="ä¸€å¥è¯æ€»ç»“ï¼š"><a href="#ä¸€å¥è¯æ€»ç»“ï¼š" class="headerlink" title="ä¸€å¥è¯æ€»ç»“ï¼š"></a><strong>ä¸€å¥è¯æ€»ç»“ï¼š</strong></h3><p>**Promise å°±æ˜¯ä¸€å¼  ****â€œæœªæ¥äº‹ä»¶ä¿è¯ä¹¦â€**ï¼Œå‘Šè¯‰ç¨‹åºï¼šâ€œåˆ«å¹²ç­‰ï¼Œå…ˆå¿™ä½ çš„ï¼Œäº‹æƒ…æˆäº†æˆ–é»„äº†ï¼Œæˆ‘éƒ½ä¼šç»™ä½ ä¸ªäº¤ä»£ï¼â€</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¡¹ç›®ä¸­z-indexè§„åˆ’è®¾è®¡</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E4%B8%ADz-index%E7%9A%84%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E4%B8%ADz-index%E7%9A%84%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="é¡¹ç›®ä¸­z-indexçš„è§„åˆ’è®¾è®¡"><a href="#é¡¹ç›®ä¸­z-indexçš„è§„åˆ’è®¾è®¡" class="headerlink" title="é¡¹ç›®ä¸­z-indexçš„è§„åˆ’è®¾è®¡"></a>é¡¹ç›®ä¸­z-indexçš„è§„åˆ’è®¾è®¡</h2><p><strong>æŠ€æœ¯è§„èŒƒï¼šå¤¹å±‚æ¨¡å‹</strong></p><p><strong>æ•´ä¸ªç»“æ„åˆ†ä¸ºAPPå±‚å’Œé¡µé¢ç»„ä»¶å±‚ã€‚APPåªæœ‰ä¸€ä¸ªï¼Œä½†é¡µé¢æœ‰å¾ˆå¤šã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1~999ï¼šéƒ½æ˜¯é¡µé¢å†…æ¯”è¾ƒæ­£å¸¸çš„å…ƒç´ </span><br><span class="line"></span><br><span class="line">1000~1999ï¼šå¼¹çª—çš„ç°è‰²é®ç½©èƒŒæ™¯ä¹‹ç±»çš„ç»„ä»¶ï¼Œæˆ–è€…æ˜¯èƒ½å¤Ÿé®ä½å…¨å±çš„åŠ è½½åŠ¨ç”»</span><br><span class="line"></span><br><span class="line">2000~2999ï¼šå¼¹çª—é¢æ¿ï¼Œæ¯”å¦‚çªç„¶å¼¹å‡ºæ¥ä¸€ä¸ªç•Œé¢æç¤ºæ¡†ï¼Œç™»å½•æ¡†ã€è­¦å‘Šæ¡†ä¹‹ç±»çš„</span><br><span class="line"></span><br><span class="line">3000~3999ï¼šé¡µé¢é¼ æ ‡äº¤äº’å±‚ï¼šæ¯”å¦‚åœ¨è¿™ä¸ªç•Œé¢ï¼Œä¼šæœ‰ä¸€ä¸ªé¼ æ ‡ç‚¹å‡»ä¸€ä¸‹å°±èƒ½è®©å±å¹•ä¸Šå¤šå‡ºæ¥ä¸€ä¸ªå°æ¡ƒå¿ƒçš„ä¸Šæµ®åŠ¨ç”»ï¼Œè¿™ä¸ªå°æ¡ƒå¿ƒå°±å¯ä»¥ç”¨ç»å¯¹å®šä½ä¸€ä¸ªdivæ¥å®ç°ã€‚ä½†ä»–çš„z-indexå¿…é¡»å¾ˆé«˜ï¼Œæ¯”å¼¹çª—ç»„ä»¶è¿˜è¦é«˜ã€‚</span><br></pre></td></tr></table></figure><p><strong>æœ‰äº†ç•Œé¢å±‚ï¼Œå…¶å®è¿˜åº”è¯¥æœ‰ä¸ªå…¨å±€çš„APPå±‚ï¼ŒAPPå±‚æ˜¯å®Œå…¨é«˜äºç•Œé¢å±‚çš„ä¸€ç§å±‚ã€‚å’Œç•Œé¢ä¸€æ ·ï¼Œä¹Ÿæœ‰é®ç½©å±‚ã€å¼¹çª—é¢æ¿å±‚å’Œé¼ æ ‡äº¤äº’å±‚ã€‚ä¸ºäº†æ–¹ä¾¿è®°å¿†ï¼Œç›´æ¥è®¾å®šAPPå±‚ä¸ºå››ä½æ•°ä¸Šä¸‡ã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¹Ÿå°±æ˜¯10000~~19999,20000~~29999,30000~39999ã€‚</span><br></pre></td></tr></table></figure><p><strong>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¯¥æ¨¡å‹ä¸­ä¸ä»…æœ‰å‘ä¸Šçš„è€ƒè™‘ï¼Œè¿˜æœ‰0ä»¥ä¸‹çš„è€ƒè™‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¯ä»¥è®¾å®šä¸€ä¸ªé¡µé¢èƒŒæ™¯å±‚ï¼Œè®©z-indexï¼š-1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç„¶åå†è®¾è®¡ä¸€ä¸ªAPPé€šç”¨èƒŒæ™¯å±‚ï¼Œz-indexï¼š-2ã€‚</span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1000ä»¥å†…éƒ½æ˜¯æ­£å¸¸é¡µé¢ï¼Œä¸Šåƒçº§åˆ«æ˜¯é¡µé¢çº§åˆ«çš„ä¸œè¥¿ï¼Œä¸Šä¸‡çº§åˆ«æ˜¯APPçº§åˆ«çš„ä¸œè¥¿ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1xxx+æ˜¯å¼¹çª—èƒŒæ™¯ï¼Œ2xxx+æ˜¯å¼¹çª—ï¼Œ3xxx+æ˜¯é¼ æ ‡äº¤äº’å±‚ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿä¸Šæ‰‹EChart(Vueé¡¹ç›®)</title>
      <link href="/2025/03/08/%E5%B7%A5%E5%85%B7/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BEChart%E5%90%AB%E5%9B%BE%E8%A1%A8%E6%A8%A1%E6%9D%BF_vue%E9%A1%B9%E7%9B%AE%E5%86%99%E6%B3%95/"/>
      <url>/2025/03/08/%E5%B7%A5%E5%85%B7/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BEChart%E5%90%AB%E5%9B%BE%E8%A1%A8%E6%A8%A1%E6%9D%BF_vue%E9%A1%B9%E7%9B%AE%E5%86%99%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯åŸºäº EChart å®˜æ–¹æ–‡æ¡£è¿›è¡Œçš„ç®€åŒ–</p><p><a href="https://echarts.apache.org/handbook/zh/get-started/" title="å¿«é€Ÿä¸Šæ‰‹ - ä½¿ç”¨æ‰‹å†Œ - Apache ECharts">å¿«é€Ÿä¸Šæ‰‹ - ä½¿ç”¨æ‰‹å†Œ - Apache ECharts</a></p><h2 id="ECharts"><a href="#ECharts" class="headerlink" title="ECharts"></a>ECharts</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install echarts --save</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h3 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h3><h4 id="å…¨å±€å¯¼å…¥"><a href="#å…¨å±€å¯¼å…¥" class="headerlink" title="å…¨å±€å¯¼å…¥"></a>å…¨å±€å¯¼å…¥</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å¼•å…¥ ECharts æ ¸å¿ƒæ¨¡å—</span><br><span class="line">import * as echarts from &#x27;echarts/core&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="æŒ‰éœ€å¯¼å…¥"><a href="#æŒ‰éœ€å¯¼å…¥" class="headerlink" title="æŒ‰éœ€å¯¼å…¥"></a>æŒ‰éœ€å¯¼å…¥</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç”±äºä¸åŒå›¾è¡¨ç±»å‹éœ€è¦å¯¼å…¥çš„ä¸œè¥¿éå¸¸æ‚ä¹±ï¼Œä»¥ä¸‹ä¸ºå¯¼å…¥åˆ†ç±»æ€»ç»“</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>æ¸²æŸ“å™¨ï¼ˆå¿…ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å¼•å…¥ Canvas æ¸²æŸ“å™¨</span><br><span class="line">import &#123; CanvasRenderer &#125; from &#x27;echarts/renderers&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>å›¾è¡¨ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// å¼•å…¥æŸ±çŠ¶å›¾å›¾è¡¨</span><br><span class="line">import &#123; BarChart &#125; from &#x27;echarts/charts&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥æŠ˜çº¿å›¾å›¾è¡¨</span><br><span class="line">import &#123; LineChart &#125; from &#x27;echarts/charts&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥é¥¼å›¾å›¾è¡¨</span><br><span class="line">import &#123; PieChart &#125; from &#x27;echarts/charts&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// å¼•å…¥æ ‡é¢˜ç»„ä»¶</span><br><span class="line">import &#123; TitleComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥æç¤ºæ¡†ç»„ä»¶</span><br><span class="line">import &#123; TooltipComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥ç›´è§’åæ ‡ç³»ç»„ä»¶ï¼ˆç”¨äºæŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ç­‰ï¼‰</span><br><span class="line">import &#123; GridComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥æ•°æ®é›†ç»„ä»¶</span><br><span class="line">import &#123; DatasetComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥å†…ç½®æ•°æ®è½¬æ¢å™¨ç»„ä»¶</span><br><span class="line">import &#123; TransformComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥å›¾ä¾‹ç»„ä»¶ï¼ˆç”¨äºé¥¼å›¾ç­‰ï¼‰</span><br><span class="line">import &#123; LegendComponent &#125; from &#x27;echarts/components&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>ç‰¹æ€§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å¼•å…¥æ ‡ç­¾è‡ªåŠ¨å¸ƒå±€ç‰¹æ€§</span><br><span class="line">import &#123; LabelLayout &#125; from &#x27;echarts/features&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥å…¨å±€è¿‡æ¸¡åŠ¨ç”»ç‰¹æ€§</span><br><span class="line">import &#123; UniversalTransition &#125; from &#x27;echarts/features&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>æ³¨å†Œç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// æ³¨å†Œå¿…é¡»çš„ç»„ä»¶å’Œç‰¹æ€§</span><br><span class="line">echarts.use([</span><br><span class="line">  TitleComponent,      // æ ‡é¢˜ç»„ä»¶</span><br><span class="line">  TooltipComponent,    // æç¤ºæ¡†ç»„ä»¶</span><br><span class="line">  GridComponent,       // ç›´è§’åæ ‡ç³»ç»„ä»¶</span><br><span class="line">  DatasetComponent,    // æ•°æ®é›†ç»„ä»¶</span><br><span class="line">  TransformComponent,  // å†…ç½®æ•°æ®è½¬æ¢å™¨ç»„ä»¶</span><br><span class="line">  BarChart,            // æŸ±çŠ¶å›¾</span><br><span class="line">  LineChart,           // æŠ˜çº¿å›¾</span><br><span class="line">  PieChart,            // é¥¼å›¾</span><br><span class="line">  LabelLayout,         // æ ‡ç­¾è‡ªåŠ¨å¸ƒå±€ç‰¹æ€§</span><br><span class="line">  UniversalTransition, // å…¨å±€è¿‡æ¸¡åŠ¨ç”»ç‰¹æ€§</span><br><span class="line">  CanvasRenderer,      // Canvas æ¸²æŸ“å™¨</span><br><span class="line">  LegendComponent,     // å›¾ä¾‹ç»„ä»¶</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h5 id="å®Œæ•´ç¤ºä¾‹æ¨¡æ¿"><a href="#å®Œæ•´ç¤ºä¾‹æ¨¡æ¿" class="headerlink" title="å®Œæ•´ç¤ºä¾‹æ¨¡æ¿"></a>å®Œæ•´ç¤ºä¾‹æ¨¡æ¿</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import &#123; onMounted &#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥ ECharts æ ¸å¿ƒæ¨¡å—</span><br><span class="line">import * as echarts from &#x27;echarts/core&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥å›¾è¡¨ç±»å‹</span><br><span class="line">import &#123; BarChart &#125; from &#x27;echarts/charts&#x27;;        // æŸ±çŠ¶å›¾</span><br><span class="line">import &#123; LineChart &#125; from &#x27;echarts/charts&#x27;;       // æŠ˜çº¿å›¾</span><br><span class="line">import &#123; PieChart &#125; from &#x27;echarts/charts&#x27;;        // é¥¼å›¾</span><br><span class="line"></span><br><span class="line">// å¼•å…¥ç»„ä»¶</span><br><span class="line">import &#123; TitleComponent &#125; from &#x27;echarts/components&#x27;;      // æ ‡é¢˜ç»„ä»¶</span><br><span class="line">import &#123; TooltipComponent &#125; from &#x27;echarts/components&#x27;;    // æç¤ºæ¡†ç»„ä»¶</span><br><span class="line">import &#123; GridComponent &#125; from &#x27;echarts/components&#x27;;       // ç›´è§’åæ ‡ç³»ç»„ä»¶</span><br><span class="line">import &#123; DatasetComponent &#125; from &#x27;echarts/components&#x27;;    // æ•°æ®é›†ç»„ä»¶</span><br><span class="line">import &#123; TransformComponent &#125; from &#x27;echarts/components&#x27;;  // å†…ç½®æ•°æ®è½¬æ¢å™¨ç»„ä»¶</span><br><span class="line">import &#123; LegendComponent &#125; from &#x27;echarts/components&#x27;;     // å›¾ä¾‹ç»„ä»¶</span><br><span class="line"></span><br><span class="line">// å¼•å…¥ç‰¹æ€§</span><br><span class="line">import &#123; LabelLayout &#125; from &#x27;echarts/features&#x27;;           // æ ‡ç­¾è‡ªåŠ¨å¸ƒå±€ç‰¹æ€§</span><br><span class="line">import &#123; UniversalTransition &#125; from &#x27;echarts/features&#x27;;   // å…¨å±€è¿‡æ¸¡åŠ¨ç”»ç‰¹æ€§</span><br><span class="line"></span><br><span class="line">// å¼•å…¥æ¸²æŸ“å™¨</span><br><span class="line">import &#123; CanvasRenderer &#125; from &#x27;echarts/renderers&#x27;;       // Canvas æ¸²æŸ“å™¨</span><br><span class="line"></span><br><span class="line">// æ³¨å†Œå¿…é¡»çš„ç»„ä»¶å’Œç‰¹æ€§</span><br><span class="line">echarts.use([</span><br><span class="line">  TitleComponent,      // æ ‡é¢˜ç»„ä»¶</span><br><span class="line">  TooltipComponent,    // æç¤ºæ¡†ç»„ä»¶</span><br><span class="line">  GridComponent,       // ç›´è§’åæ ‡ç³»ç»„ä»¶</span><br><span class="line">  DatasetComponent,    // æ•°æ®é›†ç»„ä»¶</span><br><span class="line">  TransformComponent,  // å†…ç½®æ•°æ®è½¬æ¢å™¨ç»„ä»¶</span><br><span class="line">  BarChart,            // æŸ±çŠ¶å›¾</span><br><span class="line">  LineChart,           // æŠ˜çº¿å›¾</span><br><span class="line">  PieChart,            // é¥¼å›¾</span><br><span class="line">  LabelLayout,         // æ ‡ç­¾è‡ªåŠ¨å¸ƒå±€ç‰¹æ€§</span><br><span class="line">  UniversalTransition, // å…¨å±€è¿‡æ¸¡åŠ¨ç”»ç‰¹æ€§</span><br><span class="line">  CanvasRenderer,      // Canvas æ¸²æŸ“å™¨</span><br><span class="line">  LegendComponent,     // å›¾ä¾‹ç»„ä»¶</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p>å®¹å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">        &lt;div id=&quot;main&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>æ ·å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#main &#123;</span><br><span class="line">    width: 600px;</span><br><span class="line">    height: 400px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>å¼•å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import &#123; onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">// å¼•å…¥ echarts æ ¸å¿ƒæ¨¡å—ï¼Œæ ¸å¿ƒæ¨¡å—æä¾›äº† echarts ä½¿ç”¨å¿…é¡»è¦çš„æ¥å£ã€‚</span><br><span class="line">import * as echarts from &#x27;echarts/core&#x27;</span><br><span class="line">// å¼•å…¥æŸ±çŠ¶å›¾å›¾è¡¨ï¼Œå›¾è¡¨åç¼€éƒ½ä¸º Chart</span><br><span class="line">import &#123; BarChart &#125; from &#x27;echarts/charts&#x27;</span><br><span class="line">// å¼•å…¥æ ‡é¢˜ï¼Œæç¤ºæ¡†ï¼Œç›´è§’åæ ‡ç³»ï¼Œæ•°æ®é›†ï¼Œå†…ç½®æ•°æ®è½¬æ¢å™¨ç»„ä»¶ï¼Œç»„ä»¶åç¼€éƒ½ä¸º Component</span><br><span class="line">import &#123;</span><br><span class="line">TitleComponent,</span><br><span class="line">TooltipComponent,</span><br><span class="line">GridComponent,</span><br><span class="line">DatasetComponent,</span><br><span class="line">TransformComponent,</span><br><span class="line">&#125; from &#x27;echarts/components&#x27;</span><br><span class="line">// æ ‡ç­¾è‡ªåŠ¨å¸ƒå±€ã€å…¨å±€è¿‡æ¸¡åŠ¨ç”»ç­‰ç‰¹æ€§</span><br><span class="line">import &#123; LabelLayout, UniversalTransition &#125; from &#x27;echarts/features&#x27;</span><br><span class="line">// å¼•å…¥ Canvas æ¸²æŸ“å™¨ï¼Œæ³¨æ„å¼•å…¥ CanvasRenderer æˆ–è€… SVGRenderer æ˜¯å¿…é¡»çš„ä¸€æ­¥</span><br><span class="line">import &#123; CanvasRenderer &#125; from &#x27;echarts/renderers&#x27;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>æ³¨å†Œç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">echarts.use([</span><br><span class="line">    TitleComponent,</span><br><span class="line">    TooltipComponent,</span><br><span class="line">    GridComponent,</span><br><span class="line">    DatasetComponent,</span><br><span class="line">    TransformComponent,</span><br><span class="line">    BarChart,</span><br><span class="line">    LabelLayout,</span><br><span class="line">    UniversalTransition,</span><br><span class="line">    CanvasRenderer,</span><br><span class="line">])</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h3 id="å›¾è¡¨é…ç½®"><a href="#å›¾è¡¨é…ç½®" class="headerlink" title="å›¾è¡¨é…ç½®"></a>å›¾è¡¨é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">    // åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹</span><br><span class="line">    const myChart = echarts.init(document.getElementById(&#x27;main&#x27;))</span><br><span class="line"></span><br><span class="line">    // é¢œè‰²æ•°ç»„</span><br><span class="line">    let colors = [</span><br><span class="line">        &#x27;#5470c6&#x27;,</span><br><span class="line">        &#x27;#91cc75&#x27;,</span><br><span class="line">        &#x27;#fac858&#x27;,</span><br><span class="line">        &#x27;#ee6666&#x27;,</span><br><span class="line">        &#x27;#73c0de&#x27;,</span><br><span class="line">        &#x27;#3ba272&#x27;,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    const option = &#123;</span><br><span class="line">        // æ ‡é¢˜</span><br><span class="line">        title: &#123;</span><br><span class="line">            text: &#x27;ECharts å…¥é—¨ç¤ºä¾‹&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">        // æç¤ºæ¡†</span><br><span class="line">        tooltip: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">        // xè½´</span><br><span class="line">        xAxis: &#123;</span><br><span class="line">            data: [&#x27;è¡¬è¡«&#x27;, &#x27;ç¾Šæ¯›è¡«&#x27;, &#x27;é›ªçººè¡«&#x27;, &#x27;è£¤å­&#x27;, &#x27;é«˜è·Ÿé‹&#x27;, &#x27;è¢œå­&#x27;],</span><br><span class="line">        &#125;,</span><br><span class="line">        // yè½´</span><br><span class="line">        yAxis: &#123;</span><br><span class="line">            data: [&#x27;0&#x27;, &#x27;50&#x27;, &#x27;100&#x27;, &#x27;150&#x27;, &#x27;200&#x27;, &#x27;250&#x27;],</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        // æ•°æ®ç³»åˆ—</span><br><span class="line">        series: [</span><br><span class="line">            &#123;</span><br><span class="line">                name: &#x27;é”€é‡&#x27;,</span><br><span class="line">                type: &#x27;bar&#x27;,</span><br><span class="line">                data: [5, 20, 36, 10, 10, 20],</span><br><span class="line">                itemStyle: &#123;</span><br><span class="line">                    color: (params) =&gt; colors[params.dataIndex] || &#x27;#fac858&#x27;,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //lodingé¢„åŠ è½½</span><br><span class="line">    myChart.showLoading()</span><br><span class="line">    $.get(&#x27;data.json&#x27;).done(function () &#123;</span><br><span class="line">        myChart.hideLoading()</span><br><span class="line">        myChart.setOption(option)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    myChart.setOption(option)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h3 id="æ‹†åˆ†ç»„ä»¶"><a href="#æ‹†åˆ†ç»„ä»¶" class="headerlink" title="æ‹†åˆ†ç»„ä»¶"></a>æ‹†åˆ†ç»„ä»¶</h3><h4 id="series-å›¾è¡¨"><a href="#series-å›¾è¡¨" class="headerlink" title="series &#x2F; å›¾è¡¨"></a>series &#x2F; å›¾è¡¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">series: [</span><br><span class="line">    &#123;</span><br><span class="line">        name: &#x27;é”€é‡&#x27;,//å•ä½é‡</span><br><span class="line">        type: &#x27;bar&#x27;,//å›¾è¡¨ç±»å‹</span><br><span class="line">        data: [5, 20, 36, 10, 10, 20],//å›¾è¡¨æ•°æ®</span><br><span class="line">        itemStyle: &#123;//æ ·å¼é…ç½®</span><br><span class="line">            color: (params) =&gt; option.color[params.dataIndex] || &#x27;#fac858&#x27;, // ä½¿ç”¨å…¨å±€é¢œè‰²</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h5 id="type-ç±»å‹"><a href="#type-ç±»å‹" class="headerlink" title="type &#x2F; ç±»å‹"></a>type &#x2F; ç±»å‹</h5><h6 id="æŸ±çŠ¶å›¾ï¼ˆbarï¼‰"><a href="#æŸ±çŠ¶å›¾ï¼ˆbarï¼‰" class="headerlink" title="æŸ±çŠ¶å›¾ï¼ˆbarï¼‰"></a>æŸ±çŠ¶å›¾ï¼ˆ<code>bar</code>ï¼‰</h6><p>éœ€æ±‚</p><ul><li><strong>åæ ‡è½´</strong>ï¼šéœ€è¦ <code>xAxis</code> å’Œ <code>yAxis</code> é…ç½®ã€‚</li><li><strong>æ•°æ®æ ¼å¼</strong>ï¼šæ•°æ®é€šå¸¸æ˜¯ç®€å•çš„æ•°å€¼æ•°ç»„æˆ–å¯¹è±¡æ•°ç»„ã€‚</li><li><strong>å…¶ä»–é…ç½®</strong>ï¼šå¯ä»¥æ·»åŠ  <code>tooltip</code>ã€<code>title</code>ã€<code>legend</code> ç­‰ç»„ä»¶æ¥å¢å¼ºå›¾è¡¨çš„å¯è¯»æ€§å’Œäº¤äº’æ€§ã€‚</li></ul><p>é…ç½®ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: &#x27;ECharts é”€é‡ç»Ÿè®¡&#x27;,</span><br><span class="line">    subtext: &#x27;ç¤ºä¾‹æ•°æ®&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;</span><br><span class="line">    trigger: &#x27;axis&#x27;, // è§¦å‘ç±»å‹ä¸ºåæ ‡è½´è§¦å‘</span><br><span class="line">  &#125;,</span><br><span class="line">  xAxis: &#123;</span><br><span class="line">    type: &#x27;category&#x27;, // ç±»ç›®è½´</span><br><span class="line">    data: [&#x27;è¡¬è¡«&#x27;, &#x27;ç¾Šæ¯›è¡«&#x27;, &#x27;é›ªçººè¡«&#x27;, &#x27;è£¤å­&#x27;, &#x27;é«˜è·Ÿé‹&#x27;, &#x27;è¢œå­&#x27;], // xè½´æ•°æ®</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">      fontSize: 14,  // æ ‡ç­¾å­—ä½“å¤§å°</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        color: &#x27;#ccc&#x27;, // è½´çº¿é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    axisTick: &#123;</span><br><span class="line">      show: false, // æ˜¯å¦æ˜¾ç¤ºåˆ»åº¦çº¿</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  yAxis: &#123;</span><br><span class="line">    type: &#x27;value&#x27;, // æ•°å€¼è½´</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">      formatter: &#x27;&#123;value&#125; ä»¶&#x27;, // æ ‡ç­¾æ ¼å¼åŒ–</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      show: false, // æ˜¯å¦æ˜¾ç¤ºè½´çº¿</span><br><span class="line">    &#125;,</span><br><span class="line">    splitLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        type: &#x27;dashed&#x27;, // åˆ†å‰²çº¿æ ·å¼</span><br><span class="line">        color: &#x27;#eee&#x27;,  // åˆ†å‰²çº¿é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;é”€é‡&#x27;,</span><br><span class="line">      type: &#x27;bar&#x27;, // æŸ±çŠ¶å›¾</span><br><span class="line">      data: [5, 20, 36, 10, 10, 20], // æ•°æ®</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: (params) =&gt; [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;][params.dataIndex] || &#x27;#fac858&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h6 id="æŠ˜çº¿å›¾ï¼ˆlineï¼‰"><a href="#æŠ˜çº¿å›¾ï¼ˆlineï¼‰" class="headerlink" title="æŠ˜çº¿å›¾ï¼ˆlineï¼‰"></a>æŠ˜çº¿å›¾ï¼ˆ<code>line</code>ï¼‰</h6><p>éœ€æ±‚</p><ul><li><strong>åæ ‡è½´</strong>ï¼šéœ€è¦ <code>xAxis</code> å’Œ <code>yAxis</code> é…ç½®ã€‚</li><li><strong>æ•°æ®æ ¼å¼</strong>ï¼šæ•°æ®é€šå¸¸æ˜¯ç®€å•çš„æ•°å€¼æ•°ç»„æˆ–å¯¹è±¡æ•°ç»„ã€‚</li><li><strong>å…¶ä»–é…ç½®</strong>ï¼šå¯ä»¥æ·»åŠ  <code>tooltip</code>ã€<code>title</code>ã€<code>legend</code> ç­‰ç»„ä»¶æ¥å¢å¼ºå›¾è¡¨çš„å¯è¯»æ€§å’Œäº¤äº’æ€§ã€‚</li></ul><p>é…ç½®ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: &#x27;ECharts é”€é‡è¶‹åŠ¿&#x27;,</span><br><span class="line">    subtext: &#x27;ç¤ºä¾‹æ•°æ®&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;</span><br><span class="line">    trigger: &#x27;axis&#x27;, // è§¦å‘ç±»å‹ä¸ºåæ ‡è½´è§¦å‘</span><br><span class="line">  &#125;,</span><br><span class="line">  xAxis: &#123;</span><br><span class="line">    type: &#x27;category&#x27;, // ç±»ç›®è½´</span><br><span class="line">    data: [&#x27;è¡¬è¡«&#x27;, &#x27;ç¾Šæ¯›è¡«&#x27;, &#x27;é›ªçººè¡«&#x27;, &#x27;è£¤å­&#x27;, &#x27;é«˜è·Ÿé‹&#x27;, &#x27;è¢œå­&#x27;], // xè½´æ•°æ®</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">      fontSize: 14,  // æ ‡ç­¾å­—ä½“å¤§å°</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        color: &#x27;#ccc&#x27;, // è½´çº¿é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    axisTick: &#123;</span><br><span class="line">      show: false, // æ˜¯å¦æ˜¾ç¤ºåˆ»åº¦çº¿</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  yAxis: &#123;</span><br><span class="line">    type: &#x27;value&#x27;, // æ•°å€¼è½´</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">      formatter: &#x27;&#123;value&#125; ä»¶&#x27;, // æ ‡ç­¾æ ¼å¼åŒ–</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      show: false, // æ˜¯å¦æ˜¾ç¤ºè½´çº¿</span><br><span class="line">    &#125;,</span><br><span class="line">    splitLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        type: &#x27;dashed&#x27;, // åˆ†å‰²çº¿æ ·å¼</span><br><span class="line">        color: &#x27;#eee&#x27;,  // åˆ†å‰²çº¿é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;é”€é‡&#x27;,</span><br><span class="line">      type: &#x27;line&#x27;, // æŠ˜çº¿å›¾</span><br><span class="line">      data: [5, 20, 36, 10, 10, 20], // æ•°æ®</span><br><span class="line">      smooth: true, // å¹³æ»‘æ›²çº¿</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: &#x27;#5470c6&#x27;, // çº¿æ¡é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h6 id="é¥¼å›¾ï¼ˆpieï¼‰"><a href="#é¥¼å›¾ï¼ˆpieï¼‰" class="headerlink" title="é¥¼å›¾ï¼ˆpieï¼‰"></a>é¥¼å›¾ï¼ˆ<code>pie</code>ï¼‰</h6><p>éœ€æ±‚</p><ul><li><strong>åæ ‡è½´</strong>ï¼šä¸éœ€è¦ <code>xAxis</code> å’Œ <code>yAxis</code>ï¼Œå› ä¸ºé¥¼å›¾æ˜¯åŸºäºåœ†å½¢çš„ã€‚</li><li><strong>æ•°æ®æ ¼å¼</strong>ï¼šæ•°æ®é€šå¸¸æ˜¯åŒ…å« <code>value</code> å’Œ <code>name</code> çš„å¯¹è±¡æ•°ç»„ã€‚</li><li><strong>å…¶ä»–é…ç½®</strong>ï¼šå¯ä»¥æ·»åŠ  <code>tooltip</code>ã€<code>title</code>ã€<code>legend</code> ç­‰ç»„ä»¶æ¥å¢å¼ºå›¾è¡¨çš„å¯è¯»æ€§å’Œäº¤äº’æ€§ã€‚</li></ul><p>é…ç½®ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: &#x27;ECharts é”€é‡åˆ†å¸ƒ&#x27;,</span><br><span class="line">    subtext: &#x27;ç¤ºä¾‹æ•°æ®&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;</span><br><span class="line">    trigger: &#x27;item&#x27;, // è§¦å‘ç±»å‹ä¸ºå•ä¸ªæ•°æ®ç‚¹è§¦å‘</span><br><span class="line">  &#125;,</span><br><span class="line">  legend: &#123;</span><br><span class="line">    orient: &#x27;vertical&#x27;, // å›¾ä¾‹æ–¹å‘</span><br><span class="line">    left: &#x27;left&#x27;,       // å›¾ä¾‹ä½ç½®</span><br><span class="line">  &#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;é”€é‡&#x27;,</span><br><span class="line">      type: &#x27;pie&#x27;, // é¥¼å›¾</span><br><span class="line">      radius: &#x27;50%&#x27;, // é¥¼å›¾çš„åŠå¾„</span><br><span class="line">      data: [</span><br><span class="line">        &#123; value: 5, name: &#x27;è¡¬è¡«&#x27; &#125;,</span><br><span class="line">        &#123; value: 20, name: &#x27;ç¾Šæ¯›è¡«&#x27; &#125;,</span><br><span class="line">        &#123; value: 36, name: &#x27;é›ªçººè¡«&#x27; &#125;,</span><br><span class="line">        &#123; value: 10, name: &#x27;è£¤å­&#x27; &#125;,</span><br><span class="line">        &#123; value: 10, name: &#x27;é«˜è·Ÿé‹&#x27; &#125;,</span><br><span class="line">        &#123; value: 20, name: &#x27;è¢œå­&#x27; &#125;,</span><br><span class="line">      ], // æ•°æ®</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: (params) =&gt; [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;][params.dataIndex] || &#x27;#fac858&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h6 id="æ•£ç‚¹å›¾ï¼ˆscatterï¼‰"><a href="#æ•£ç‚¹å›¾ï¼ˆscatterï¼‰" class="headerlink" title="æ•£ç‚¹å›¾ï¼ˆscatterï¼‰"></a>æ•£ç‚¹å›¾ï¼ˆ<code>scatter</code>ï¼‰</h6><p>éœ€æ±‚</p><ul><li><strong>åæ ‡è½´</strong>ï¼šéœ€è¦ <code>xAxis</code> å’Œ <code>yAxis</code> é…ç½®ã€‚</li><li><strong>æ•°æ®æ ¼å¼</strong>ï¼šæ•°æ®é€šå¸¸æ˜¯äºŒç»´æ•°ç»„ï¼Œæ¯ä¸ªæ•°æ®ç‚¹åŒ…å«ä¸¤ä¸ªå€¼ <code>[x, y]</code>ã€‚</li><li><strong>å…¶ä»–é…ç½®</strong>ï¼šå¯ä»¥æ·»åŠ  <code>tooltip</code>ã€<code>title</code>ã€<code>legend</code> ç­‰ç»„ä»¶æ¥å¢å¼ºå›¾è¡¨çš„å¯è¯»æ€§å’Œäº¤äº’æ€§ã€‚</li></ul><p>é…ç½®ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: &#x27;ECharts æ•£ç‚¹å›¾ç¤ºä¾‹&#x27;,</span><br><span class="line">    subtext: &#x27;éšæœºç”Ÿæˆçš„æ•°æ®&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;</span><br><span class="line">    trigger: &#x27;item&#x27;, // è§¦å‘ç±»å‹ä¸ºå•ä¸ªæ•°æ®ç‚¹è§¦å‘</span><br><span class="line">  &#125;,</span><br><span class="line">  xAxis: &#123;</span><br><span class="line">    type: &#x27;value&#x27;, // æ•°å€¼è½´</span><br><span class="line">    name: &#x27;Xè½´&#x27;,</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">      fontSize: 14,  // æ ‡ç­¾å­—ä½“å¤§å°</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        color: &#x27;#ccc&#x27;, // è½´çº¿é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  yAxis: &#123;</span><br><span class="line">    type: &#x27;value&#x27;, // æ•°å€¼è½´</span><br><span class="line">    name: &#x27;Yè½´&#x27;,</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">      fontSize: 14,  // æ ‡ç­¾å­—ä½“å¤§å°</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        color: &#x27;#ccc&#x27;, // è½´çº¿é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;æ•£ç‚¹&#x27;,</span><br><span class="line">      type: &#x27;scatter&#x27;, // æ•£ç‚¹å›¾</span><br><span class="line">      data: [</span><br><span class="line">        [10, 20],</span><br><span class="line">        [20, 30],</span><br><span class="line">        [30, 40],</span><br><span class="line">        [40, 50],</span><br><span class="line">        [50, 60],</span><br><span class="line">        [60, 70],</span><br><span class="line">      ], // æ•°æ®</span><br><span class="line">      symbolSize: 20, // æ•£ç‚¹å¤§å°</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: &#x27;#5470c6&#x27;, // æ•£ç‚¹é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h5 id="itemStyle-æ ·å¼"><a href="#itemStyle-æ ·å¼" class="headerlink" title="itemStyle &#x2F; æ ·å¼"></a>itemStyle &#x2F; æ ·å¼</h5><p>ï¼æ³¨æ„ï¼šé¢œè‰²çš„é…ç½®åªèƒ½åœ¨</p><p><strong>1.series å¤–ï¼ˆå…¨å±€ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  // ... å…¶ä»–é…ç½®</span><br><span class="line">  color: [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;], // å…¨å±€é¢œè‰²</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;é”€é‡&#x27;,</span><br><span class="line">      type: &#x27;bar&#x27;,</span><br><span class="line">      data: [5, 20, 36, 10, 10, 20],</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: (params) =&gt; option.color[params.dataIndex] || &#x27;#fac858&#x27;, // ä½¿ç”¨å…¨å±€é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  // ... å…¶ä»–é…ç½®</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p><strong>2.<code>itemStyle</code> å†…éƒ¨ï¼ˆå±€éƒ¨ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">series: [</span><br><span class="line">  &#123;</span><br><span class="line">    name: &#x27;é”€é‡&#x27;,</span><br><span class="line">    type: &#x27;bar&#x27;,</span><br><span class="line">    data: [5, 20, 36, 10, 10, 20],</span><br><span class="line">    itemStyle: &#123;</span><br><span class="line">      color: (params) =&gt; &#123;</span><br><span class="line">        const colors = [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;];</span><br><span class="line">        return colors[params.dataIndex] || &#x27;#fac858&#x27;; // ç›´æ¥ä½¿ç”¨æœ¬åœ°å®šä¹‰çš„ colors æ•°ç»„</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p><strong><em>ä¸èƒ½åœ¨ series ä¸­é…ç½®é¢œè‰²æ•°ç»„</em></strong></p><p>æ¸å˜è‰²ï¼ˆå†…éƒ¨é…ç½®ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">itemStyle: &#123;</span><br><span class="line">    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [</span><br><span class="line">        &#123; offset: 0, color: &#x27;#5470c6&#x27; &#125;,</span><br><span class="line">        &#123; offset: 0.2, color: &#x27;#91cc75&#x27; &#125;,</span><br><span class="line">        &#123; offset: 0.5, color: &#x27;#91cc75&#x27; &#125;,</span><br><span class="line">        &#123; offset: 0.7, color: &#x27;#fac858&#x27; &#125;,</span><br><span class="line">        &#123; offset: 1, color: &#x27;#91cc75&#x27; &#125;,</span><br><span class="line">    ]),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="title-æ ‡é¢˜"><a href="#title-æ ‡é¢˜" class="headerlink" title="title | æ ‡é¢˜"></a>title | æ ‡é¢˜</h4><p>è‡ªå®šä¹‰æ ‡é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">title: &#123;</span><br><span class="line">    text: &#x27;ECharts é”€é‡ç»Ÿè®¡&#x27;,</span><br><span class="line">    subtext: &#x27;ç¤ºä¾‹æ•°æ®&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">    textStyle: &#123;</span><br><span class="line">       fontSize: 20,</span><br><span class="line">       color: &#x27;#333&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="color-é¢œè‰²"><a href="#color-é¢œè‰²" class="headerlink" title="color | é¢œè‰²"></a>color | é¢œè‰²</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">color: [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;], // å…¨å±€é¢œè‰²</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="tooltip-æç¤ºæ¡†"><a href="#tooltip-æç¤ºæ¡†" class="headerlink" title="tooltip | æç¤ºæ¡†"></a>tooltip | æç¤ºæ¡†</h4><p>è‡ªå®šä¹‰æç¤ºæ¡†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tooltip: &#123;</span><br><span class="line">  trigger: &#x27;axis&#x27;, // è§¦å‘ç±»å‹ï¼Œå¯ä»¥æ˜¯ &#x27;item&#x27; æˆ– &#x27;axis&#x27;</span><br><span class="line">  axisPointer: &#123;</span><br><span class="line">    type: &#x27;shadow&#x27;, // é»˜è®¤ä¸º &#x27;line&#x27;ï¼Œä¹Ÿå¯ä»¥æ˜¯ &#x27;shadow&#x27; æˆ– &#x27;cross&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  formatter: function (params) &#123;</span><br><span class="line">    return `$&#123;params[0].name&#125;: $&#123;params[0].value&#125;`;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="x-yAxis-åæ ‡è½´"><a href="#x-yAxis-åæ ‡è½´" class="headerlink" title="x&#x2F;yAxis | åæ ‡è½´"></a>x&#x2F;yAxis | åæ ‡è½´</h4><p>é€‚ç”¨äº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æŸ±çŠ¶å›¾ bar</span><br><span class="line">æŠ˜çº¿å›¾ line</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>åæ ‡è½´æ ·å¼</p><p>è‡ªå®šä¹‰ x è½´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">xAxis: &#123;</span><br><span class="line">  type: &#x27;category&#x27;,</span><br><span class="line">  data: [&#x27;è¡¬è¡«&#x27;, &#x27;ç¾Šæ¯›è¡«&#x27;, &#x27;é›ªçººè¡«&#x27;, &#x27;è£¤å­&#x27;, &#x27;é«˜è·Ÿé‹&#x27;, &#x27;è¢œå­&#x27;],</span><br><span class="line">  axisLabel: &#123;</span><br><span class="line">    color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">    fontSize: 14,  // æ ‡ç­¾å­—ä½“å¤§å°</span><br><span class="line">  &#125;,</span><br><span class="line">  axisLine: &#123;</span><br><span class="line">    lineStyle: &#123;</span><br><span class="line">      color: &#x27;#ccc&#x27;, // è½´çº¿é¢œè‰²</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  axisTick: &#123;</span><br><span class="line">    show: false, // æ˜¯å¦æ˜¾ç¤ºåˆ»åº¦çº¿</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>è‡ªå®šä¹‰ y è½´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">yAxis: &#123;</span><br><span class="line">  type: &#x27;value&#x27;,</span><br><span class="line">  axisLabel: &#123;</span><br><span class="line">    color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">    formatter: &#x27;&#123;value&#125; ä»¶&#x27;, // æ ‡ç­¾æ ¼å¼åŒ–</span><br><span class="line">  &#125;,</span><br><span class="line">  axisLine: &#123;</span><br><span class="line">    show: false, // æ˜¯å¦æ˜¾ç¤ºè½´çº¿</span><br><span class="line">  &#125;,</span><br><span class="line">  splitLine: &#123;</span><br><span class="line">    lineStyle: &#123;</span><br><span class="line">      type: &#x27;dashed&#x27;, // åˆ†å‰²çº¿æ ·å¼</span><br><span class="line">      color: &#x27;#eee&#x27;,  // åˆ†å‰²çº¿é¢œè‰²</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="animation-åŠ¨ç”»"><a href="#animation-åŠ¨ç”»" class="headerlink" title="animation | åŠ¨ç”»"></a>animation | åŠ¨ç”»</h4><p>åŠ¨ç”»æ ·å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">animation: true, // æ˜¯å¦å¼€å¯åŠ¨ç”»</span><br><span class="line">animationDuration: 1000, // åŠ¨ç”»æŒç»­æ—¶é—´</span><br><span class="line">animationEasing: &#x27;elasticOut&#x27;, // åŠ¨ç”»ç¼“åŠ¨æ•ˆæœ</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h3 id="å…¶ä»–é…ç½®"><a href="#å…¶ä»–é…ç½®" class="headerlink" title="å…¶ä»–é…ç½®"></a>å…¶ä»–é…ç½®</h3><h4 id="loding-é¢„åŠ è½½"><a href="#loding-é¢„åŠ è½½" class="headerlink" title="loding | é¢„åŠ è½½"></a>loding | é¢„åŠ è½½</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm i --save-dev @types/jquery</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myChart.showLoading()</span><br><span class="line">$.get(&#x27;data.json&#x27;).done(function (data) &#123;</span><br><span class="line">    myChart.hideLoading()</span><br><span class="line">    myChart.setOption(option)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é”®ç›˜ä¹±é”®é—®é¢˜è§£å†³</title>
      <link href="/2025/03/08/%E5%B7%A5%E5%85%B7/%E9%94%AE%E7%9B%98%E4%B9%B1%E9%94%AE%E9%97%AE%E9%A2%98/"/>
      <url>/2025/03/08/%E5%B7%A5%E5%85%B7/%E9%94%AE%E7%9B%98%E4%B9%B1%E9%94%AE%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="é”®ç›˜ä¹±é”®é—®é¢˜"><a href="#é”®ç›˜ä¹±é”®é—®é¢˜" class="headerlink" title="é”®ç›˜ä¹±é”®é—®é¢˜"></a>é”®ç›˜ä¹±é”®é—®é¢˜</h1><p><strong>çœŸçš„å¾ˆå´©æºƒï¼Œæœºæ¢°é”®ç›˜çš„ä¹±é”®é—®é¢˜å±…ç„¶è¿˜èƒ½è¿å¸¦åˆ°æœ¬æœºçš„é”®ç›˜ä¸ŠğŸ˜…</strong></p><p><strong>æœ€åå‘ç°æ­¥éª¤å…¶å®å¾ˆç®€å•ï¼Œç„¶åæˆ‘ä¹±ä¿®äº†ä¸¤ä¸ªå°æ—¶ğŸ™ƒ</strong></p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><p><strong>æœºæ¢°+æœ¬æœºé”®ç›˜å‡ºå‚è®¾ç½®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fn + esc é•¿æŒ‰äº”ç§’ä»¥ä¸Š</span><br></pre></td></tr></table></figure><p><strong>é‡å¯ç”µè„‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿˜æœ‰æˆ‘ç”µè„‘å¼€æœºæ˜¯æœ‰ä¸€ä¸ªé”®ç›˜é©±åŠ¨é€‰é¡¹çš„ï¼Œç›´æ¥ç»™æ‹’äº†</span><br></pre></td></tr></table></figure><p><strong>é‡æ–°é…ç½®æœºæ¢°é”®ç›˜ï¼ˆè“ç‰™å•Šå•¥çš„ï¼‰</strong></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BFCä¸IFC</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8A%E4%B8%8B%E6%96%87--BFC%E4%B8%8EIFC/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8A%E4%B8%8B%E6%96%87--BFC%E4%B8%8EIFC/</url>
      
        <content type="html"><![CDATA[<h3 id="ç›’å­"><a href="#ç›’å­" class="headerlink" title="ç›’å­"></a>ç›’å­</h3><h5 id="æ ¼å¼åŒ–ä¸Šä¸‹æ–‡"><a href="#æ ¼å¼åŒ–ä¸Šä¸‹æ–‡" class="headerlink" title="æ ¼å¼åŒ–ä¸Šä¸‹æ–‡"></a>æ ¼å¼åŒ–ä¸Šä¸‹æ–‡</h5><p><strong>å¤–éƒ¨æ˜¾ç¤ºç±»å‹ï¼ˆdisplay-outsideï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è§„å®šç›’å­å¦‚ä½•ä¸ç»Ÿä¸€æ ¼å¼ä¸Šä¸‹æ–‡ä¸­çš„å…¶ä»–å…ƒç´ ä¸€èµ·æ˜¾ç¤º</span><br></pre></td></tr></table></figure><p><strong>å†…éƒ¨æ˜¾ç¤ºç±»å‹ï¼ˆ display-inside  ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è§„å®šç›’å­å†…éƒ¨å¸ƒå±€æ–¹å¼ï¼Œæ¯”å¦‚</span><br><span class="line">display:    flex    (å¤–éƒ¨æ˜¾ç¤ºä¸ºblock ) å‚ä¸BFCï¼ˆå—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰</span><br><span class="line">display:inline-flex (å¤–éƒ¨æ˜¾ç¤ºä¸ºinline) å‚ä¸IFCï¼ˆå†…è”çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰</span><br></pre></td></tr></table></figure><h5 id="BFC"><a href="#BFC" class="headerlink" title="BFC"></a>BFC</h5><p><strong>å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡</strong></p><p><em><strong>FC</strong></em>ï¼ˆFormatting Contextï¼‰ï¼ˆ<em><strong>æ ¼å¼åŒ–ä¸Šä¸‹æ–‡</strong></em>ï¼‰</p><p><strong>æ‰€æœ‰çš„ç›’å­éƒ½å±äºFC</strong></p><p><strong>å¯èƒ½å±äºä¸€ä¸ªBFCï¼ˆblockï¼‰(div&#x2F;p&#x2F;h1)ã€ä¹Ÿå¯èƒ½æ˜¯IFCï¼ˆinlineï¼‰(a&#x2F;span&#x2F;i&#x2F;img)</strong></p><h6 id="ä¼šç”ŸæˆBFCçš„æƒ…å†µ"><a href="#ä¼šç”ŸæˆBFCçš„æƒ…å†µ" class="headerlink" title="ä¼šç”ŸæˆBFCçš„æƒ…å†µ"></a><strong>ä¼šç”ŸæˆBFCçš„æƒ…å†µ</strong></h6><p><img src="/upload/image-20241104160610394.png" alt="image-20241104160610394.png"></p><h6 id="BFCçš„ä½œç”¨"><a href="#BFCçš„ä½œç”¨" class="headerlink" title="BFCçš„ä½œç”¨"></a><strong>BFCçš„ä½œç”¨</strong></h6><p><strong>å¸®åŠ©ç›’å­ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªæ²¿ç€å‚ç›´æ–¹å‘æ’å¸ƒ</strong></p><p><strong>marginå°±æ˜¯ç”±BFCæ¥è§£æçš„</strong></p><p><strong>ä¸¤ä¸ªç›’å­éƒ½è®¾ç½®marginæ—¶å€™ä¼šæŠ˜å ï¼Œå°±æ˜¯BFCåœ¨èµ·ä½œç”¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨åŒä¸€ä¸ªBFCé‡Œï¼Œä¸¤ä¸ªç›’å­çš„marginæ‰ä¼šæŠ˜å </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTMLå¯ä»¥å½¢æˆæ ‡å‡†æµï¼Œå› ä¸ºæœ¬èº«å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„BFCç¯å¢ƒ</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨BFCä¸­ï¼Œæ¯ä¸ªå…ƒç´ çš„å·¦è¾¹ç¼˜æ˜¯ç´§æŒ¨ç€åŒ…å«å—çš„å·¦è¾¹ç¼˜çš„</span><br></pre></td></tr></table></figure><p><strong>BFCå¯ä»¥è§£å†³</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">marginçš„æŠ˜å é—®é¢˜</span><br><span class="line">æµ®åŠ¨çš„é«˜åº¦å¡Œé™·é—®é¢˜</span><br></pre></td></tr></table></figure><h6 id="å½¢æˆæ–°çš„BFC"><a href="#å½¢æˆæ–°çš„BFC" class="headerlink" title="å½¢æˆæ–°çš„BFC"></a>å½¢æˆæ–°çš„BFC</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//åªè¦overflow: !!ä¸æ˜¯!! visible</span><br><span class="line">å¯ä»¥æ˜¯ auto/hidden/scroll</span><br></pre></td></tr></table></figure><p><strong>è§£å†³æŠ˜å é—®é¢˜</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//çˆ¶çº§åŒ…è£¹ä¸¤ä¸ªå…ƒç´ </span><br><span class="line">div content</span><br><span class="line">    div item</span><br><span class="line">    div item</span><br><span class="line">div</span><br><span class="line">//cssåˆ›å»ºBFC</span><br><span class="line">.content&#123;</span><br><span class="line">    overflow: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è§£å†³æµ®åŠ¨é«˜åº¦å¡Œé™·</strong></p><p><strong>æ¡ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//çˆ¶å…ƒç´ è§¦å‘BFCï¼Œå½¢æˆç‹¬ç«‹å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡</span><br><span class="line">//çˆ¶å…ƒç´ é«˜åº¦ä¸ºauto</span><br></pre></td></tr></table></figure><p><em>BFCçš„è®¡ç®—æ–¹å¼</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.å¦‚æœåªæœ‰inline-levelï¼Œæ˜¯è¡Œé«˜çš„é¡¶éƒ¨å’Œåº•éƒ¨çš„è·ç¦»</span><br><span class="line">2.å¦‚æœæœ‰block-levelï¼Œæ˜¯ç”±æœ€åº•å±‚çš„å—ä¸Šè¾¹ç¼˜å’Œæœ€åº•å±‚å—ç›’å­çš„ä¸‹è¾¹ç¼˜ä¹‹é—´çš„è·ç¦»</span><br><span class="line">3.å¦‚æœæœ‰ç»å¯¹å®šä½å…ƒç´ ï¼Œå°†è¢«å¿½ç•¥;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4.å¦‚æœæœ‰æµ®åŠ¨å…ƒç´ ï¼Œé‚£ä¹ˆä¼šå¢åŠ é«˜åº¦ä»¥åŒ…æ‹¬è¿™äº›æµ®åŠ¨å…ƒç´ çš„ä¸‹è¾¹ç¼˜</span><br></pre></td></tr></table></figure><h6 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">overflow: visible;  //å¯è§</span><br><span class="line">overflow: hidden;   //éšè—(å¯æ»šåŠ¨çš„å®¹å™¨)</span><br><span class="line">overflow: clip;     //å‰ªè¾‘(ç¦æ­¢æ»šåŠ¨)</span><br><span class="line">overflow: scroll;   //æ»šåŠ¨(æµè§ˆå™¨æ€»æ˜¯æ˜¾ç¤ºæ»šåŠ¨æ¡)</span><br><span class="line">overflow: auto;     //è‡ªåŠ¨(å¦‚æœå†…å®¹æº¢å‡ºï¼Œåˆ™æµè§ˆå™¨æä¾›æ»šåŠ¨æ¡)</span><br><span class="line">overflow: hidden;   //è¦†ç›–(æ»šåŠ¨æ¡ç»˜åˆ¶åœ¨å†…å®¹ä¹‹ä¸Šï¼Œè€Œä¸æ˜¯å æ®ç©ºé—´)</span><br></pre></td></tr></table></figure><h5 id="IFC"><a href="#IFC" class="headerlink" title="IFC"></a>IFC</h5><p><strong>å†…è”çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç›’å­ä¼šä»åŒ…å«å—çš„é¡¶éƒ¨å¼€å§‹ï¼ŒæŒ‰æ°´å¹³æ’åˆ—</span><br><span class="line">è¿™äº›ç›’å­å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼å¯¹é½</span><br><span class="line">åŒ…å«ä¸€ä¸²ç›’å­çš„çŸ©å½¢åŒºåŸŸå°±æ˜¯ä¸€ä¸ª â€œçº¿æ¡æ¡†(line box)â€</span><br></pre></td></tr></table></figure><h6 id="å¯¹é½æ–¹å¼"><a href="#å¯¹é½æ–¹å¼" class="headerlink" title="å¯¹é½æ–¹å¼"></a>å¯¹é½æ–¹å¼</h6><p><img src="/upload/image-20241110155405765.png" alt="image-20241110155405765.png"></p><p><img src="/upload/image-20241110155807497.png" alt="image-20241110155807497.png"></p><p><img src="/upload/image-20241110160000770.png" alt="image-20241110160000770.png"></p><h5 id="å±‚å ä¸Šä¸‹æ–‡"><a href="#å±‚å ä¸Šä¸‹æ–‡" class="headerlink" title="å±‚å ä¸Šä¸‹æ–‡"></a>å±‚å ä¸Šä¸‹æ–‡</h5><p><strong>å¯¹HTMLå…ƒç´ çš„ä¸‰ç»´æ„æƒ³ï¼ŒåŸºäºç”¨æˆ·ç•Œé¢zè½´çš„ä¸Šä¸‹æ’å¸ƒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¯¹äºæµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹çš„â€œæ¸²æŸ“å±‚(render layer)â€</span><br></pre></td></tr></table></figure><h6 id="å±‚å æ°´å¹³"><a href="#å±‚å æ°´å¹³" class="headerlink" title="å±‚å æ°´å¹³"></a>å±‚å æ°´å¹³</h6><p><strong>ä¹Ÿå°±æ˜¯å±‚å é¡ºåº</strong></p><p><img src="/upload/image-20241110164351519.png" alt="image-20241110164351519.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">z-indexåªèƒ½åœ¨åŒä¸€ä¸ªå±‚å ä¸Šä¸‹æ–‡æ¯”è¾ƒ</span><br><span class="line">å­å…ƒç´ çš„z-indexæ— æ³•è¶…è¿‡çˆ¶å…ƒç´ çš„z-indexé¡ºåº</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Electronå®ç°æ¡Œé¢ç«¯è®¡æ—¶å™¨</title>
      <link href="/2025/03/08/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%B0%9D%E8%AF%95%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E6%A1%8C%E9%9D%A2%E7%AB%AF%E8%AE%A1%E6%97%B6%E5%99%A8%EF%BC%88%E5%8D%8A%E6%88%90%E5%93%81%E7%89%88%EF%BC%89/"/>
      <url>/2025/03/08/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%B0%9D%E8%AF%95%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E6%A1%8C%E9%9D%A2%E7%AB%AF%E8%AE%A1%E6%97%B6%E5%99%A8%EF%BC%88%E5%8D%8A%E6%88%90%E5%93%81%E7%89%88%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="åæ§½"><a href="#åæ§½" class="headerlink" title="åæ§½"></a>åæ§½</h2><p><strong>æœ€åˆæŠ€æœ¯æ ˆä¸ºVue+Electron+TSï¼Œå¤ªç”œç¾çš„éš¾äº†ã€‚ã€‚ã€‚é…ç½®æŠ¥é”™é—®é¢˜ä¸€å¤§å †ï¼Œä¸€è·¯æŠ¥é”™é—®AIä¸€è·¯æ”¹ï¼Œé•¿è¾¾ä¸‰ä¸ªå°æ—¶æŠŠæ–‡ä»¶æ”¹çš„ä¹±ä¸ƒå…«ç³Ÿæ— æ³•æ”¶å°¾å¿ç—›æ”¾å¼ƒæ–°å¼€é¡¹ç›®</strong></p><p>**æœ€åæŠ€æœ¯æ ˆé€‰æ‹©ä¸º **<strong>Vue+Electron+Vite+JS</strong> ï¼ŒåŒ…ç®¡ç†å·¥å…·é€‰æ‹©ä¸º <strong>pnpm</strong></p><p><del>å®Œæ•´ä»£ç è§githubä»“åº“</del> <code>......</code>(è¿˜æ²¡æ¨ï¼Œå› ä¸ºdistæ–‡ä»¶å¤ªå¤§çš„åŸå› æ²¡åŠæ³•ä¼ ï¼Œç›®å‰è¿˜åœ¨å¯»æ‰¾æ›´åˆç†çš„æ¨é€æ–¹æ¡ˆ)</p><h2 id="ä¸»æ­¥éª¤"><a href="#ä¸»æ­¥éª¤" class="headerlink" title="ä¸»æ­¥éª¤"></a>ä¸»æ­¥éª¤</h2><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p><strong>åˆ›å»º</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm create vite Tclick --template vue</span><br></pre></td></tr></table></figure><p><strong>ä¾èµ–</strong></p><p><strong>package.json ç›´äº«ç‰ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;clock&quot;,</span><br><span class="line">    &quot;private&quot;: true,</span><br><span class="line">    &quot;version&quot;: &quot;0.0.0&quot;,</span><br><span class="line">    &quot;description&quot;: &quot;An Timer application.&quot;,//æè¿°</span><br><span class="line">    &quot;author&quot;: &quot;none &lt;ä½ çš„é‚®ç®±&gt;&quot;,//ä½œè€…</span><br><span class="line">    &quot;homepage&quot;: &quot;./&quot;,</span><br><span class="line">    &quot;main&quot;: &quot;main.js&quot;,</span><br><span class="line">    &quot;scripts&quot;: &#123;</span><br><span class="line">        &quot;dev&quot;: &quot;vite&quot;,</span><br><span class="line">        &quot;build&quot;: &quot;vite build&quot;,</span><br><span class="line">        &quot;serve&quot;: &quot;vite preview&quot;,</span><br><span class="line">        &quot;electron:dev&quot;: &quot;concurrently \&quot;cross-env NODE_ENV=development wait-on http://localhost:5173 &amp;&amp; electron .\&quot; \&quot;npm run dev\&quot;&quot;,</span><br><span class="line">        &quot;electron:build&quot;: &quot;npm run build &amp;&amp; electron-builder &amp;&amp; node post-build.js&quot;,</span><br><span class="line">        &quot;start&quot;: &quot;npm run electron:dev&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;dependencies&quot;: &#123;</span><br><span class="line">        &quot;vue&quot;: &quot;^3.5.13&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;devDependencies&quot;: &#123;</span><br><span class="line">        &quot;@vitejs/plugin-vue&quot;: &quot;^5.2.1&quot;,</span><br><span class="line">        &quot;concurrently&quot;: &quot;^9.1.2&quot;,</span><br><span class="line">        &quot;cross-env&quot;: &quot;^7.0.3&quot;,</span><br><span class="line">        &quot;electron&quot;: &quot;^33.3.1&quot;,</span><br><span class="line">        &quot;electron-builder&quot;: &quot;^25.1.8&quot;,</span><br><span class="line">        &quot;vite&quot;: &quot;^6.0.5&quot;,</span><br><span class="line">        &quot;vite-plugin-html&quot;: &quot;^3.2.2&quot;,</span><br><span class="line">        &quot;wait-on&quot;: &quot;^8.0.2&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;build&quot;: &#123;</span><br><span class="line">        &quot;productName&quot;: &quot;Clock&quot;,</span><br><span class="line">        &quot;appId&quot;: &quot;com.example.clock&quot;,</span><br><span class="line">        &quot;directories&quot;: &#123;</span><br><span class="line">            &quot;output&quot;: &quot;release&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;files&quot;: [</span><br><span class="line">            &quot;dist/**/*&quot;,</span><br><span class="line">            &quot;node_modules/**/*&quot;,</span><br><span class="line">            &quot;main.js&quot;,</span><br><span class="line">            &quot;preload.js&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;mac&quot;: &#123;</span><br><span class="line">            &quot;target&quot;: &quot;dmg&quot;,</span><br><span class="line">            &quot;icon&quot;: &quot;dist/installer-icon-256.ico&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;win&quot;: &#123;</span><br><span class="line">            &quot;target&quot;: &quot;nsis&quot;,</span><br><span class="line">            &quot;icon&quot;: &quot;dist/installer-icon-256.ico&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;linux&quot;: &#123;</span><br><span class="line">            &quot;target&quot;: &quot;AppImage&quot;,</span><br><span class="line">            &quot;icon&quot;: &quot;dist/installer-icon-256.ico&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;nsis&quot;: &#123;</span><br><span class="line">            &quot;installerIcon&quot;: &quot;./public/installer-icon.ico&quot;,//è¿™é‡Œçš„icoæ˜¯æˆ‘ä¸‹çš„æ—¶é’Ÿå›¾æ ‡ï¼Œæ›¿æ¢è½¯ä»¶å›¾æ ‡</span><br><span class="line">            &quot;oneClick&quot;: false,</span><br><span class="line">            &quot;allowToChangeInstallationDirectory&quot;: true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install</span><br></pre></td></tr></table></figure><h3 id="è¡¥å……é¡¹ç›®ç»“æ„"><a href="#è¡¥å……é¡¹ç›®ç»“æ„" class="headerlink" title="è¡¥å……é¡¹ç›®ç»“æ„"></a>è¡¥å……é¡¹ç›®ç»“æ„</h3><p><code>public/icon</code>ï¼ˆå›¾æ ‡ï¼‰</p><p><code>main.js</code>ï¼ˆElectronä¸»è¿›ç¨‹ï¼‰</p><p><code>preload.js</code>ï¼ˆElectroné¢„åŠ è½½è„šæœ¬ï¼‰</p><p><code>post-build.js</code>ï¼ˆæ–‡ä»¶æ“ä½œï¼Œç”Ÿæˆdistï¼‰</p><h3 id="æ ¸å¿ƒé…ç½®"><a href="#æ ¸å¿ƒé…ç½®" class="headerlink" title="æ ¸å¿ƒé…ç½®"></a>æ ¸å¿ƒé…ç½®</h3><p><code>index.html</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">        &lt;link rel=&quot;icon&quot; type=&quot;image/svg+xml&quot; href=&quot;./dist/installer-icon.ico&quot; /&gt;</span><br><span class="line">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">        &lt;title&gt;Clock&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;script type=&quot;module&quot; src=&quot;/src/main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><code>main.js</code>ï¼ˆElectronä¸»è¿›ç¨‹ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">const &#123; app, BrowserWindow &#125; = require(&#x27;electron&#x27;)</span><br><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line"></span><br><span class="line">function createWindow() &#123;</span><br><span class="line">    const win = new BrowserWindow(&#123;</span><br><span class="line">        width: 500,</span><br><span class="line">        height: 210,</span><br><span class="line">        x: 800, // æŒ‡å®šåˆå§‹ x åæ ‡</span><br><span class="line">        y: 20, // æŒ‡å®šåˆå§‹ y åæ ‡</span><br><span class="line">        webPreferences: &#123;</span><br><span class="line">            preload: path.join(__dirname, &#x27;preload.js&#x27;),</span><br><span class="line">            nodeIntegration: false,</span><br><span class="line">            contextIsolation: true,</span><br><span class="line">            // è®¾ç½® CSP</span><br><span class="line">            additionalArguments: [&#x27;--disable-features=ElectronSandbox&#x27;], // æ ¹æ®éœ€è¦è°ƒæ•´</span><br><span class="line">            webviewTag: false, // ç¦æ­¢ä½¿ç”¨ &lt;webview&gt; æ ‡ç­¾</span><br><span class="line">            webSecurity: true,</span><br><span class="line">            sandbox: true,</span><br><span class="line">            contentSecurityPolicy: `</span><br><span class="line">        default-src &#x27;self&#x27;;</span><br><span class="line">        script-src &#x27;self&#x27;;</span><br><span class="line">        connect-src &#x27;self&#x27;;</span><br><span class="line">        style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; /* å¦‚æœéœ€è¦å†…è”æ ·å¼ */</span><br><span class="line">        img-src &#x27;self&#x27; data:;</span><br><span class="line">        font-src &#x27;self&#x27;;</span><br><span class="line">      `,</span><br><span class="line">        &#125;,</span><br><span class="line">        title: &#x27;Clock&#x27;, // è®¾ç½®çª—å£æ ‡é¢˜</span><br><span class="line">        icon: path.join(__dirname, &#x27;dist&#x27;, &#x27;installer-icon.ico&#x27;), // è®¾ç½®çª—å£å›¾æ ‡</span><br><span class="line">        autoHideMenuBar: true, //è‡ªåŠ¨éšè—èœå•æ </span><br><span class="line">        alwaysOnTop: true, // ç¡®ä¿çª—å£å§‹ç»ˆåœ¨é¡¶éƒ¨</span><br><span class="line">        // frame: false, // éšè—çª—å£è¾¹æ¡†</span><br><span class="line">        // resizable: false, // ç¦æ­¢è°ƒæ•´çª—å£å¤§å°</span><br><span class="line">        transparent: true, // ä½¿çª—å£é€æ˜</span><br><span class="line">        // skipTaskbar: true, // è·³è¿‡ä»»åŠ¡æ æ˜¾ç¤º</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    if (process.env.NODE_ENV === &#x27;development&#x27;) &#123;</span><br><span class="line">        win.loadURL(&#x27;http://localhost:5173&#x27;)</span><br><span class="line">        // win.loadFile(&#x27;dist/index.html&#x27;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        win.loadFile(path.resolve(__dirname, &#x27;dist&#x27;, &#x27;index.html&#x27;))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.whenReady().then(() =&gt; &#123;</span><br><span class="line">    createWindow()</span><br><span class="line"></span><br><span class="line">    app.on(&#x27;activate&#x27;, function () &#123;</span><br><span class="line">        if (BrowserWindow.getAllWindows().length === 0) createWindow()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// å…¶ä»–äº‹ä»¶ç›‘å¬å™¨...</span><br><span class="line"></span><br><span class="line">app.on(&#x27;window-all-closed&#x27;, () =&gt; &#123;</span><br><span class="line">    if (process.platform !== &#x27;darwin&#x27;) &#123;</span><br><span class="line">        app.quit()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.on(&#x27;activate&#x27;, () =&gt; &#123;</span><br><span class="line">    if (BrowserWindow.getAllWindows().length === 0) &#123;</span><br><span class="line">        createWindow()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>preload.js</code>ï¼ˆElectroné¢„åŠ è½½è„šæœ¬ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// preload.js</span><br><span class="line">window.addEventListener(&#x27;DOMContentLoaded&#x27;, () =&gt; &#123;</span><br><span class="line">    // è¿™é‡Œå¯ä»¥æ·»åŠ ä¸DOMäº¤äº’çš„ä»£ç </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>post-build.js</code>ï¼ˆæ–‡ä»¶æ“ä½œï¼Œç”Ÿæˆdistï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;)</span><br><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line"></span><br><span class="line">const htmlFilePath = path.resolve(__dirname, &#x27;dist&#x27;, &#x27;index.html&#x27;)</span><br><span class="line"></span><br><span class="line">fs.readFile(htmlFilePath, &#x27;utf8&#x27;, (err, data) =&gt; &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        return console.log(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const result = data.replace(/&lt;title&gt;.*?&lt;\/title&gt;/, &#x27;&lt;title&gt;Clock&lt;/title&gt;&#x27;)</span><br><span class="line"></span><br><span class="line">    fs.writeFile(htmlFilePath, result, &#x27;utf8&#x27;, (err) =&gt; &#123;</span><br><span class="line">        if (err) return console.log(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="ç®€é™‹çš„ç»„ä»¶"><a href="#ç®€é™‹çš„ç»„ä»¶" class="headerlink" title="ç®€é™‹çš„ç»„ä»¶"></a>ç®€é™‹çš„ç»„ä»¶</h3><p><code>App.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=&quot;app&quot; class=&quot;hide-scrollbar&quot;&gt;</span><br><span class="line">        &lt;Main /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    import Main from &#x27;./components/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .hide-scrollbar &#123;</span><br><span class="line">        scrollbar-width: none; /* Firefox */</span><br><span class="line">        -ms-overflow-style: none; /* IE å’Œ Edge */</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .hide-scrollbar::-webkit-scrollbar &#123;</span><br><span class="line">        display: none;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style</span><br></pre></td></tr></table></figure><p><code>utils/timeUtils.js</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">export const getFormattedTime = () =&gt; &#123;</span><br><span class="line">    const now = new Date();</span><br><span class="line">    </span><br><span class="line">    // è·å–å½“å‰æ—¶é—´çš„å°æ—¶ã€åˆ†é’Ÿå’Œç§’æ•°ï¼Œå¹¶ç¡®ä¿å®ƒä»¬éƒ½æ˜¯ä¸¤ä½æ•°</span><br><span class="line">    const padZero = (num) =&gt; num.toString().padStart(2, &#x27;0&#x27;);</span><br><span class="line">    const hours = padZero(now.getHours());</span><br><span class="line">    const minutes = padZero(now.getMinutes());</span><br><span class="line">    const seconds = padZero(now.getSeconds());</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">        hoursFirstChar: hours[0],</span><br><span class="line">        hoursSecondChar: hours[1],</span><br><span class="line">        minutesFirstChar: minutes[0],</span><br><span class="line">        minutesSecondChar: minutes[1],</span><br><span class="line">        secondsFirstChar: seconds[0],</span><br><span class="line">        secondsSecondChar: seconds[1],</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>components / index.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;layouts&quot;&gt;</span><br><span class="line">        &lt;div v-for=&quot;(title, index) in titles&quot; :key=&quot;index&quot; class=&quot;layout&quot;&gt;</span><br><span class="line">            &lt;div&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;top&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;title&quot;&gt;&#123;&#123; title &#125;&#125;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;btn&quot; @click=&quot;start(index)&quot; :disabled=&quot;timers[index].isRunning&quot;&gt;å¼€å§‹&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;btn&quot; @click=&quot;stop(index)&quot; :disabled=&quot;!timers[index].isRunning&quot;&gt;åœæ­¢&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;btn&quot; @click=&quot;reset(index)&quot; :disabled=&quot;timers[index].elapsedTime === 0&quot;&gt;é‡ç½®&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;!-- &lt;Flip</span><br><span class="line">                :hours=&quot;timers[index].formattedTime.hours&quot;</span><br><span class="line">                :minutes=&quot;timers[index].formattedTime.minutes&quot;</span><br><span class="line">                :seconds=&quot;timers[index].formattedTime.seconds&quot; /&gt; --&gt;</span><br><span class="line">            &lt;Timer /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    import &#123; ref, computed &#125; from &#x27;vue&#x27;</span><br><span class="line">    import Flip from &#x27;./Flip/index.vue&#x27;</span><br><span class="line">    import Timer from &#x27;./Timer/index.vue&#x27;</span><br><span class="line"></span><br><span class="line">    const titles = [&#x27;å­¦ä¹ æ—¶é•¿&#x27;, &#x27;è‹±è¯­æ—¶é•¿&#x27;, &#x27;çœ‹ä¹¦æ—¶é•¿&#x27;, &#x27;åšå®¢æ—¶é•¿&#x27;]</span><br><span class="line">    const timers = ref([])</span><br><span class="line"></span><br><span class="line">    for (let i = 0; i &lt; 4; i++) &#123;</span><br><span class="line">        timers.value.push(&#123;</span><br><span class="line">            startTime: null,</span><br><span class="line">            elapsedTime: 0,</span><br><span class="line">            isRunning: false,</span><br><span class="line">            formattedTime: &#123; hours: &#x27;00&#x27;, minutes: &#x27;00&#x27;, seconds: &#x27;00&#x27; &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const start = (index) =&gt; &#123;</span><br><span class="line">        if (!timers.value[index].isRunning) &#123;</span><br><span class="line">            timers.value[index].startTime = Date.now() - (timers.value[index].startTime ? timers.value[index].startTime : 0)</span><br><span class="line">            timers.value[index].isRunning = true</span><br><span class="line">            updateElapsedTime(index)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const stop = (index) =&gt; &#123;</span><br><span class="line">        timers.value[index].isRunning = false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const reset = (index) =&gt; &#123;</span><br><span class="line">        timers.value[index].startTime = null</span><br><span class="line">        timers.value[index].elapsedTime = 0</span><br><span class="line">        timers.value[index].isRunning = false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const updateElapsedTime = (index) =&gt; &#123;</span><br><span class="line">        if (timers.value[index].isRunning) &#123;</span><br><span class="line">            timers.value[index].elapsedTime = Math.floor((Date.now() - timers.value[index].startTime) / 1000)</span><br><span class="line">            updateFormattedTime(index)</span><br><span class="line">            setTimeout(() =&gt; updateElapsedTime(index), 1000)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const updateFormattedTime = (index) =&gt; &#123;</span><br><span class="line">        const hours = Math.floor(timers.value[index].elapsedTime / 3600).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        const minutes = Math.floor((timers.value[index].elapsedTime % 3600) / 60).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        const seconds = (timers.value[index].elapsedTime % 60).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        timers.value[index].formattedTime = &#123; hours, minutes, seconds &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .layouts &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: row;</span><br><span class="line">        gap: 20px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        align-items: center;</span><br><span class="line">        width: 25%;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout .top &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: space-between;</span><br><span class="line">        align-items: center;</span><br><span class="line">        width: 100%;</span><br><span class="line">        background: #fff;</span><br><span class="line">        border-radius: 20px;</span><br><span class="line">        padding: 10px;</span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout .top .title &#123;</span><br><span class="line">        font-size: 20px;</span><br><span class="line">        font-weight: 700;</span><br><span class="line">        color: #333;</span><br><span class="line">        margin-right: auto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout .top .btn &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        align-items: center;</span><br><span class="line">        width: 50px;</span><br><span class="line">        height: 24px;</span><br><span class="line">        border-radius: 10px;</span><br><span class="line">        border: 1px solid #333;</span><br><span class="line">        font-size: 14px;</span><br><span class="line">        font-weight: 700;</span><br><span class="line">        color: #333;</span><br><span class="line">        padding: 0px 3px;</span><br><span class="line">        cursor: pointer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout .top .btn:hover &#123;</span><br><span class="line">        background: #333;</span><br><span class="line">        color: #fff;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><code>components / Flip / index.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;clock&quot;&gt;</span><br><span class="line">        &lt;!-- å°æ—¶ --&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;hoursFirstChar&quot;&gt;&#123;&#123; hoursFirstChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;hoursSecondChar&quot;&gt;&#123;&#123; hoursSecondChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;em class=&quot;divider&quot;&gt;:&lt;/em&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- åˆ†é’Ÿ --&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;minutesFirstChar&quot;&gt;&#123;&#123; minutesFirstChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;minutesSecondChar&quot;&gt;&#123;&#123; minutesSecondChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;em class=&quot;divider&quot;&gt;:&lt;/em&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- ç§’ --&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;secondsFirstChar&quot;&gt;&#123;&#123; secondsFirstChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;secondsSecondChar&quot;&gt;&#123;&#123; secondsSecondChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    import &#123; ref, onMounted, watch &#125; from &#x27;vue&#x27;;</span><br><span class="line">    import &#123; getFormattedTime &#125; from &#x27;../../utils/timeUtils&#x27;; // ç¡®ä¿è·¯å¾„æ­£ç¡®</span><br><span class="line"></span><br><span class="line">    const hoursFirstChar = ref(&#x27;&#x27;);</span><br><span class="line">    const hoursSecondChar = ref(&#x27;&#x27;);</span><br><span class="line">    const minutesFirstChar = ref(&#x27;&#x27;);</span><br><span class="line">    const minutesSecondChar = ref(&#x27;&#x27;);</span><br><span class="line">    const secondsFirstChar = ref(&#x27;&#x27;);</span><br><span class="line">    const secondsSecondChar = ref(&#x27;&#x27;);</span><br><span class="line"></span><br><span class="line">    const updateTime = () =&gt; &#123;</span><br><span class="line">        const time = getFormattedTime();</span><br><span class="line">        hoursFirstChar.value = time.hoursFirstChar;</span><br><span class="line">        hoursSecondChar.value = time.hoursSecondChar;</span><br><span class="line">        minutesFirstChar.value = time.minutesFirstChar;</span><br><span class="line">        minutesSecondChar.value = time.minutesSecondChar;</span><br><span class="line">        secondsFirstChar.value = time.secondsFirstChar;</span><br><span class="line">        secondsSecondChar.value = time.secondsSecondChar;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">        updateTime(); // åˆå§‹åŒ–æ—¶æ›´æ–°æ—¶é—´</span><br><span class="line">        setInterval(updateTime, 1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡æ—¶é—´</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        align-items: center;</span><br><span class="line">        height: 100vh;</span><br><span class="line">        width: 100vw;</span><br><span class="line">        background-color: #2c3e50; /* æ·»åŠ èƒŒæ™¯è‰²ä»¥ä¾¿äºæŸ¥çœ‹ */</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .clock &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* æ—¶é’Ÿçš„åˆ†éš” */</span><br><span class="line">    .clock .divider &#123;</span><br><span class="line">        font-size: 30px;</span><br><span class="line">        line-height: 60px;</span><br><span class="line">        font-style: normal;</span><br><span class="line">        color: rgb(255, 255, 255); /* æ›´æ”¹ä¸ºç™½è‰²ä»¥ä¾¿äºæŸ¥çœ‹ */</span><br><span class="line">        margin: 0 5px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* æ—¶é’Ÿçš„å¡ç‰‡ */</span><br><span class="line">    .clock .flip &#123;</span><br><span class="line">        position: relative;</span><br><span class="line">        width: 40px; /* ç¨å¾®å¢åŠ å®½åº¦ä»¥ç¡®ä¿æ•°å­—å®Œå…¨æ˜¾ç¤º */</span><br><span class="line">        height: 60px; /* å¢åŠ é«˜åº¦ä»¥ç¡®ä¿æ•°å­—å®Œå…¨æ˜¾ç¤º */</span><br><span class="line">        margin: 2px;</span><br><span class="line">        font-size: 48px; /* å¢åŠ å­—ä½“å¤§å°ä»¥ä¾¿äºæŸ¥çœ‹ */</span><br><span class="line">        font-weight: 700;</span><br><span class="line">        line-height: 60px; /* ç¡®ä¿æ–‡æœ¬å‚ç›´å±…ä¸­ */</span><br><span class="line">        text-align: center;</span><br><span class="line">        background: rgb(46, 45, 45);</span><br><span class="line">        border: 1px solid rgb(34, 33, 33);</span><br><span class="line">        border-radius: 10px;</span><br><span class="line">        box-shadow: 0 0 6px rgba(54, 54, 54, 0.5);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* æ—¶é’Ÿä¸Šçš„æ•°å­— */</span><br><span class="line">    .clock .flip .digital &#123;</span><br><span class="line">        position: absolute;</span><br><span class="line">        top: 0;</span><br><span class="line">        left: 0;</span><br><span class="line">        right: 0;</span><br><span class="line">        bottom: 0;</span><br><span class="line">        color: white; /* æ•°å­—é¢œè‰²ä¸ºç™½è‰² */</span><br><span class="line">        background: transparent; /* èƒŒæ™¯é€æ˜ */</span><br><span class="line">        border-radius: 10px;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">        justify-content: center;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><code>components / Timer / index.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;&#123;&#123; formattedTime &#125;&#125;&lt;/h1&gt;</span><br><span class="line">        &lt;button @click=&quot;start&quot; :disabled=&quot;isRunning&quot;&gt;å¼€å§‹&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;stop&quot; :disabled=&quot;!isRunning&quot;&gt;åœæ­¢&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;reset&quot; :disabled=&quot;elapsedTime === 0&quot;&gt;é‡ç½®&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    import &#123; ref, computed, onMounted, onUnmounted &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">    const startTime = ref(null)</span><br><span class="line">    const elapsedTime = ref(0)</span><br><span class="line">    const isRunning = ref(false)</span><br><span class="line"></span><br><span class="line">    const formattedTime = computed(() =&gt; &#123;</span><br><span class="line">        const hours = Math.floor(elapsedTime.value / 3600).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        const minutes = Math.floor((elapsedTime.value % 3600) / 60).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        const seconds = (elapsedTime.value % 60).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        return `$&#123;hours&#125;:$&#123;minutes&#125;:$&#123;seconds&#125;`</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    let intervalId = null</span><br><span class="line"></span><br><span class="line">    function start() &#123;</span><br><span class="line">        if (!isRunning.value) &#123;</span><br><span class="line">            startTime.value = Date.now() - (startTime.value ? startTime.value : 0)</span><br><span class="line">            isRunning.value = true</span><br><span class="line">            intervalId = setInterval(updateElapsedTime, 1000)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function stop() &#123;</span><br><span class="line">        clearInterval(intervalId)</span><br><span class="line">        isRunning.value = false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function reset() &#123;</span><br><span class="line">        clearInterval(intervalId)</span><br><span class="line">        startTime.value = null</span><br><span class="line">        elapsedTime.value = 0</span><br><span class="line">        isRunning.value = false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function updateElapsedTime() &#123;</span><br><span class="line">        elapsedTime.value = Math.floor((Date.now() - startTime.value) / 1000)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">        document.addEventListener(&#x27;visibilitychange&#x27;, handleVisibilityChange)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    onUnmounted(() =&gt; &#123;</span><br><span class="line">        document.removeEventListener(&#x27;visibilitychange&#x27;, handleVisibilityChange)</span><br><span class="line">        clearInterval(intervalId)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    function handleVisibilityChange() &#123;</span><br><span class="line">        if (document.visibilityState === &#x27;hidden&#x27;) &#123;</span><br><span class="line">            if (isRunning.value) &#123;</span><br><span class="line">                stop()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else if (document.visibilityState === &#x27;visible&#x27;) &#123;</span><br><span class="line">            if (isRunning.value) &#123;</span><br><span class="line">                start()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨é¡¹ç›®"><a href="#å¯åŠ¨é¡¹ç›®" class="headerlink" title="å¯åŠ¨é¡¹ç›®"></a>å¯åŠ¨é¡¹ç›®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run build</span><br></pre></td></tr></table></figure><p><strong>ç½‘é¡µç«¯å¼€å‘ç¯å¢ƒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run dev</span><br></pre></td></tr></table></figure><p><strong>æ¡Œé¢ç«¯å¼€å‘ç¯å¢ƒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run start</span><br></pre></td></tr></table></figure><h3 id="exeæ–‡ä»¶ç”Ÿæˆä½ç½®"><a href="#exeæ–‡ä»¶ç”Ÿæˆä½ç½®" class="headerlink" title=".exeæ–‡ä»¶ç”Ÿæˆä½ç½®"></a>.exeæ–‡ä»¶ç”Ÿæˆä½ç½®</h3><p><code>release</code>æ–‡ä»¶å¤¹ä¸­çš„ Setup.exeï¼ˆæ–‡ä»¶æœ‰70å¤šm!!!ä¸ç†è§£ï¼‰</p><h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a><em>TODO</em></h3><p><strong>1.æ¡Œé¢è½¯ä»¶å›¾æ ‡è¿˜æ˜¯Electronçš„ï¼Œéœ€è¦ä¿®æ”¹ä¸ºä¸‹å¥½çš„ico</strong></p><p><strong>2.gitå¤§æ–‡ä»¶æäº¤é—®é¢˜ï¼ˆå¯èƒ½æ˜¯éœ€è¦æ”¹åŠ¨gitignoreï¼Ÿæ²¡æœ‰æ¥è§¦è¿‡ï¼‰</strong></p><p><strong>3.ç¬¬ä¸€ç‰ˆVue+Electron+TSé¡¹ç›®æåˆ°è¿‡è‡ªåŠ¨å‘å¸ƒç‰ˆæœ¬å·¥ä½œæµï¼Œè¿˜æœ‰æ£€æµ‹æ ‡ç­¾å•¥çš„ï¼Œè¿˜æ²¡å¼„æ‡‚è¿™å‘¨æ¢ç´¢ä¸€ä¸‹ï¼Œæ²¡è®°é”™çš„è¯githubä¸»é¡µçš„è´ªåƒè›‡å¥½åƒä¹Ÿå’Œè¿™ä¸ªæœ‰å…³ç³»</strong></p><p><strong>4.ç®€å•UIæ’å¸ƒ</strong></p><p><strong>5.äº¤äº’åŠŸèƒ½ï¼šç”¨æˆ·å¯è‡ªè¡Œæ·»åŠ å¤šä¸ªè®¡æ—¶å™¨ï¼Œä¸”ç‹¬ç«‹è®¡æ—¶</strong></p><p><strong>6.è€ƒè™‘åˆ°æŒ‚åå°ä¼šæœ‰è®¡æ—¶è¯¯å·®ï¼Œæ·»åŠ æ–°çš„è®¡æ—¶é€»è¾‘ï¼ˆbeginè®°å½•æ—¶é—´æˆ³ï¼Œä»åå°è°ƒå‡ºæ—¶é€šè¿‡æ—¶é—´æˆ³ç›¸å‡æ›´æ–°æ—¶é—´ï¼‰</strong></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ¢ç´¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WebSocket</title>
      <link href="/2025/03/08/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/WebSocket/"/>
      <url>/2025/03/08/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/WebSocket/</url>
      
        <content type="html"><![CDATA[<h1 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h1><blockquote><p><strong>ä½å»¶è¿Ÿï¼ŒåŒå‘å®æ—¶é€šä¿¡(åŒå…¨å·¥)ï¼Œé•¿æœŸè¿è¡Œ</strong></p></blockquote><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><strong>ç›¸æ¯”HTTPåè®®ï¼ŒWebSocketæ˜¯ä¸€ç§****å®æ—¶é€šä¿¡</strong>åè®®</p><p><strong>åœ¨å®æ—¶é€šè®¯å‰ï¼ŒHTTPé€šè¿‡****è½®è¯¢</strong>è§£å†³å®æ—¶é—®é¢˜</p><blockquote><p><strong>è½®è¯¢ï¼šå®¢æˆ·ç«¯å®šæœŸå‘æœåŠ¡å™¨å‘é€è¯·æ±‚</strong></p><blockquote><p><strong>é•¿è½®è¯¢ï¼šå®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚åï¼Œä¿æŒè¿æ¥æ‰“å¼€ï¼Œç­‰å¾…æ–°æ•°æ®å“åº”åå†å…³é—­è¿æ¥</strong></p></blockquote><blockquote><p><strong>Cometï¼šä¿æŒé•¿è¿æ¥ï¼Œè¿”å›è¯·æ±‚åç»§ç»­ä¿æŒè¿æ¥æ‰“å¼€</strong></p></blockquote></blockquote><p><strong>WebSocketçš„è¿æ¥åªéœ€è¦å»ºç«‹ä¸€æ¬¡</strong></p><h2 id="å»ºç«‹è¿æ¥"><a href="#å»ºç«‹è¿æ¥" class="headerlink" title="å»ºç«‹è¿æ¥"></a>å»ºç«‹è¿æ¥</h2><h3 id="ç†è®ºé¡»çŸ¥"><a href="#ç†è®ºé¡»çŸ¥" class="headerlink" title="ç†è®ºé¡»çŸ¥"></a>ç†è®ºé¡»çŸ¥</h3><p><strong>éœ€è¦HTTPå‘æœåŠ¡å™¨å‘èµ·ä¸€æ¬¡å¸¸è§„Getè¯·æ±‚ï¼Œå¹¶åœ¨è¿™ä¸ªè¯·æ±‚å¤´ä¸Šæºå¸¦</strong><em><strong>Upgrade</strong></em></p><blockquote><p><strong>Upgradeä½œä¸ºå‡çº§è¯·æ±‚å°†ä¼ é€’ç»™æœåŠ¡å™¨ï¼Œåè®®ä»HTTPå‡çº§ä¸ºWebSocket</strong></p></blockquote><p><strong>åœ¨æ­¤ä¹‹åå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å³å¯éšæ—¶å‘å½¼æ­¤å‘é€æ¶ˆæ¯</strong></p><h3 id="å…·ä½“ä»£ç "><a href="#å…·ä½“ä»£ç " class="headerlink" title="å…·ä½“ä»£ç "></a>å…·ä½“ä»£ç </h3><p><strong>å‰ç«¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const socket = new WebSocket(&quot;ws://localhost:8080&quot;);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">socket.onopen =function(event)&#123;</span><br><span class="line">    console.log(&quot;Websocketè¿æ¥å·²æ‰“å¼€&quot;)</span><br><span class="line">&#125;</span><br><span class="line">socket.onmessage =function(event)&#123;</span><br><span class="line">    console.log(&quot;æ”¶åˆ°äº†å›å¤:&quot;event.data)</span><br><span class="line">&#125;</span><br><span class="line">socket.onclose = function(event)&#123;</span><br><span class="line">    console.log(&quot;Websocketè¿æ¥å·²å…³é—­&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function click()&#123;//å‘é€æ¶ˆæ¯</span><br><span class="line">    socket.send(&quot;Hello World!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åç«¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&#x27;http&#x27;);//å¼•å…¥æ¨¡å—</span><br><span class="line">const WebSocket = require(&#x27;ws&#x27;);</span><br><span class="line"></span><br><span class="line">const server = http.createServer();//HTTPæœåŠ¡å™¨å®ä¾‹</span><br><span class="line">const wss = new WebSocket.Server(&#123; server &#125;);//æ ¹æ®æœåŠ¡å™¨å®ä¾‹åˆ›å»ºWebSocketå®ä¾‹</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wss.on(&#x27;connection&#x27;,(socket) =&gt; &#123;//å®¢æˆ·ç«¯è¿å…¥WebsocketæœåŠ¡å™¨</span><br><span class="line">    socket.on(&#x27;message&#x27;,(message)=&gt;&#123;</span><br><span class="line">        console.log(&#x27;æ”¶åˆ°æ¶ˆæ¯:&#x27;+ message)</span><br><span class="line">        socket.send(&#x27;Hello FireUG&#x27;);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    socket.on(&#x27;close&#x27;,() =&gt; &#123;</span><br><span class="line">        console.log(&#x27;Websocketè¿æ¥å·²å…³é—­&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server.on(&#x27;request&#x27;,(request,response)=&gt;&#123;</span><br><span class="line">    response.writeHead(200,&#123;&#x27;Content-Type&#x27;:&#x27;text/plain&#x27;&#125;)</span><br><span class="line">    response.end(&#x27;Hello, World!&#x27;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.listen(8080ï¼Œ() =&gt; &#123;</span><br><span class="line">    console.log(&#x27;æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç«¯å£å·ä¸º 8080&#x27;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="å¿ƒè·³æœºåˆ¶"><a href="#å¿ƒè·³æœºåˆ¶" class="headerlink" title="å¿ƒè·³æœºåˆ¶"></a>å¿ƒè·³æœºåˆ¶</h2><blockquote><p><strong>ä¸ºäº†ä¿æŒé•¿è¿æ¥ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´é€šè¿‡</strong> <code>å¿ƒè·³åŒ…</code>ä¿æŒè¿æ¥çŠ¶æ€ï¼Œé˜²æ­¢é•¿æ—¶é—´æ²¡æœ‰æ•°æ®ä¼ è¾“è€Œè¢«åˆ‡æ–­</p></blockquote><p><code>å¿ƒè·³åŒ…</code></p><blockquote><p><strong>ä¸€ç§æ•°æ®åŒ…ï¼Œä¸åŒ…å«ä»»ä½•å®é™…æ•°æ®</strong></p><p><strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å®šæœŸå‘é€ä¸€ä¸ªç©ºçš„æ•°æ®åŒ…ï¼Œç¡®ä¿é“¾æ¥ä»ç„¶æœ‰æ•ˆ</strong></p><p><strong>å¦‚æœä¸€æ®µæ—¶é—´æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„å¿ƒè·³åŒ…ï¼Œå°±å¯è®¤ä¸ºè¿æ¥å·²ç»æ–­å¼€</strong></p></blockquote><h2 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h2><p><strong>å®‰å…¨</strong></p><blockquote><p><strong>ä¸æä¾›åŠ å¯†åŠŸèƒ½ï¼Œéœ€é‡‡ç”¨å…¶ä»–æ–¹å¼æ¥ç¡®ä¿å®‰å…¨æ€§</strong></p><blockquote><p><strong>SSLåè®®ï¼šå¯å¯¹WebSocketè¿æ¥è¿›è¡ŒåŠ å¯†é˜²æ­¢æ•æ„Ÿä¿¡æ¯è¢«çªƒå¬å’Œç¯¡æ”¹</strong></p></blockquote><blockquote><p><strong>è®¾ç½®é»‘ç™½åå•ï¼šåœ¨æœåŠ¡ç«¯è®¾ç½®ï¼Œåªå…è®¸ç‰¹å®šIPåœ°å€æˆ–åŸŸåçš„å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥</strong></p></blockquote></blockquote><p><strong>æ”¯æŒ</strong></p><blockquote><p><strong>å°äºIE10çš„æµè§ˆå™¨ä¸æ”¯æŒ</strong></p></blockquote><p><strong>ä¼˜åŒ–</strong></p><blockquote><p><strong>ä¿æŒé•¿è¿æ¥éœ€è¦æœåŠ¡å™¨ä¸æ–­åœ°ç»´æŠ¤å’Œå¤„ç†è¿æ¥çŠ¶æ€ï¼Œéœ€è¦ä¼˜åŒ–æ€§èƒ½ï¼Œä¸ç„¶ä¼šè¿‡åº¦åœ°æ¶ˆè€—æœåŠ¡å™¨èµ„æº</strong></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ¢ç´¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Node.js</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Node.js%E5%9F%BA%E7%A1%80/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Node.js%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="Node-jsåŸºç¡€"><a href="#Node-jsåŸºç¡€" class="headerlink" title="Node.jsåŸºç¡€"></a>Node.jsåŸºç¡€</h1><h2 id="æ¨¡å—ç³»ç»Ÿ"><a href="#æ¨¡å—ç³»ç»Ÿ" class="headerlink" title="æ¨¡å—ç³»ç»Ÿ"></a>æ¨¡å—ç³»ç»Ÿ</h2><h3 id="require-module"><a href="#require-module" class="headerlink" title="require &amp; module"></a>require &amp; module</h3><blockquote><p><strong>CommonJSè§„èŒƒ</strong></p><p><strong>æ¨¡å—åŒ–:æŠŠä»£ç æŒ‰åŠŸèƒ½åˆ†å¼€(å¯å¤ç”¨æ€§å¼º)</strong></p></blockquote><p><strong>ä¸¾ä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function sayHello(name) &#123;</span><br><span class="line">    return `Hello, $&#123;name&#125;`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);//å¼•å…¥expressæ¨¡å—</span><br><span class="line">const sayHello = require(&#x27;./myModule&#x27;);//å¼•å…¥è‡ªå®šä¹‰æ¨¡å—</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, (req, res) =&gt; &#123;</span><br><span class="line">    res.send(sayHello(&#x27;World&#x27;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="npmåŒ…ç®¡ç†"><a href="#npmåŒ…ç®¡ç†" class="headerlink" title="npmåŒ…ç®¡ç†"></a>npmåŒ…ç®¡ç†</h3><blockquote><p><strong>å°±æ˜¯å‰ç«¯å¸¸è§çš„ npm install ä¸‹åŒ…</strong></p></blockquote><h2 id="å¼‚æ­¥ç¼–ç¨‹"><a href="#å¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹"></a>å¼‚æ­¥ç¼–ç¨‹</h2><h3 id="å›è°ƒå‡½æ•°Promise"><a href="#å›è°ƒå‡½æ•°Promise" class="headerlink" title="å›è°ƒå‡½æ•°Promise"></a>å›è°ƒå‡½æ•°Promise</h3><blockquote><p><strong>å¯ä»¥é€šè¿‡</strong> <code>util.promisify</code>å°†åŸºäºå›è°ƒçš„APIè½¬æ¢ä¸ºè¿”å›Promiseçš„å½¢å¼</p><p><code>async</code>å…³é”®å­—å®šä¹‰ä¸€ä¸ªè¿”å›Promiseçš„å‡½æ•°ï¼Œ<code>await</code>ç­‰å¾…ä¸€ä¸ªPromiseå¯¹è±¡çš„ç»“æœ</p></blockquote><h3 id="fs-readFile"><a href="#fs-readFile" class="headerlink" title="fs.readFile"></a>fs.readFile</h3><blockquote><p><strong>Node.jsçš„æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼ˆfsï¼‰æä¾›äº†åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§ç‰ˆæœ¬çš„APIï¼Œå¦‚</strong> <code>fs.readFile</code>å’Œ <code>fs.readFileSync</code>ã€‚</p></blockquote><p><strong>å››ç§å†™æ³•</strong></p><p><img src="/upload/image-20250207162038459.png" alt="image-20250207162038459.png"></p><h2 id="HTTPæœåŠ¡å™¨"><a href="#HTTPæœåŠ¡å™¨" class="headerlink" title="HTTPæœåŠ¡å™¨"></a>HTTPæœåŠ¡å™¨</h2><h3 id="å¼•å…¥nodejså†…ç½®æ¨¡å—"><a href="#å¼•å…¥nodejså†…ç½®æ¨¡å—" class="headerlink" title="å¼•å…¥nodejså†…ç½®æ¨¡å—"></a>å¼•å…¥nodejså†…ç½®æ¨¡å—</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&#x27;http&#x27;);</span><br><span class="line">const url = require(&#x27;url&#x27;);</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºæœåŠ¡å™¨"><a href="#åˆ›å»ºæœåŠ¡å™¨" class="headerlink" title="åˆ›å»ºæœåŠ¡å™¨"></a>åˆ›å»ºæœåŠ¡å™¨</h3><blockquote><p><code>http.createServer()</code>å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„HTTPæœåŠ¡å™¨å®ä¾‹</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const server = http.createServer((req, res) =&gt; &#123;</span><br><span class="line">  // å¤„ç†è¯·æ±‚å’Œå“åº”</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>å½“æœ‰è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼Œå›è°ƒå‡½æ•°ä¼šè¢«è§¦å‘</strong></p><p><code>req</code>æ˜¯è¯·æ±‚å¯¹è±¡ï¼Œ<code>res</code>æ˜¯å“åº”å¯¹è±¡</p></blockquote><h3 id="è§£æURL"><a href="#è§£æURL" class="headerlink" title="è§£æURL"></a>è§£æURL</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const parsedUrl = url.parse(req.url, true);</span><br></pre></td></tr></table></figure><blockquote><p><strong><code>req.url</code></strong>ï¼šè·å–è¯·æ±‚çš„URLï¼ˆæ¯”å¦‚ <code>/hello?name=Qwen</code>ï¼‰</p><p><strong><code>url.parse()</code></strong>ï¼šå°†URLæ‹†è§£æˆå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•° <code>true</code>è¡¨ç¤ºå°†æŸ¥è¯¢å‚æ•°ï¼ˆå¦‚ <code>?name=Qwen</code>ï¼‰è§£æä¸ºå¯¹è±¡ï¼ˆ<code>parsedUrl.query</code>ï¼‰</p></blockquote><h3 id="è®¾ç½®å“åº”å¤´"><a href="#è®¾ç½®å“åº”å¤´" class="headerlink" title="è®¾ç½®å“åº”å¤´"></a>è®¾ç½®å“åº”å¤´</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.writeHead(200, &#123;&#x27;Content-Type&#x27;: &#x27;text/plain&#x27;&#125;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>çŠ¶æ€ç 200</strong>ï¼šè¡¨ç¤ºè¯·æ±‚æˆåŠŸ</p><p><strong><code>Content-Type: text/plain</code></strong>ï¼šå‘Šè¯‰æµè§ˆå™¨è¿”å›çš„å†…å®¹æ˜¯çº¯æ–‡æœ¬</p></blockquote><h3 id="å¤„ç†è¯·æ±‚"><a href="#å¤„ç†è¯·æ±‚" class="headerlink" title="å¤„ç†è¯·æ±‚"></a>å¤„ç†è¯·æ±‚</h3><p><strong>req.url</strong></p><p><strong>req.method</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if (req.method === &#x27;GET&#x27;) &#123;</span><br><span class="line">  if (parsedUrl.pathname === &#x27;/hello&#x27;) &#123;//http://localhost:3000/hello?...=...</span><br><span class="line">    // å¤„ç†/helloè·¯å¾„</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // å¤„ç†å…¶ä»–è·¯å¾„</span><br><span class="line">  &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  // å¤„ç†éGETè¯·æ±‚</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è·¯å¾„æ˜¯</strong> <code>/hello</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let name = parsedUrl.query.name || &quot;World&quot;;</span><br><span class="line">res.end(`Hello $&#123;name&#125;!\n`);</span><br></pre></td></tr></table></figure><blockquote><p><strong>è·å–æŸ¥è¯¢å‚æ•°</strong>ï¼šä» <code>parsedUrl.query</code>ä¸­è¯»å– <code>name</code>å‚æ•°ï¼ˆå¦‚ <code>?name=Qwen</code>ï¼‰</p><p><strong>å¦‚æœæœªæä¾›</strong> <code>name</code>ï¼Œé»˜è®¤å€¼ä¸º <code>World</code></p><p><strong>ç¤ºä¾‹</strong>ï¼šè®¿é—® <code>http://localhost:3000/hello?name=Qwen</code>ä¼šè¿”å› <code>Hello Qwen!</code></p></blockquote><p><strong>å…¶ä»–è·¯å¾„</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.end(&#x27;Welcome to the simple HTTP server!\n&#x27;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ ¹è·¯å¾„ç¤ºä¾‹</strong>ï¼šè®¿é—® <code>http://localhost:3000/</code>ä¼šè¿”å›æ¬¢è¿æ¶ˆæ¯</p></blockquote><h3 id="égetè¯·æ±‚"><a href="#égetè¯·æ±‚" class="headerlink" title="égetè¯·æ±‚"></a>égetè¯·æ±‚</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.writeHead(405, &#123;&#x27;Content-Type&#x27;: &#x27;text/plain&#x27;&#125;);</span><br><span class="line">res.end(&#x27;Method Not Allowed\n&#x27;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>çŠ¶æ€ç 405</strong>ï¼šè¡¨ç¤ºæœåŠ¡å™¨ä¸æ”¯æŒè¯¥è¯·æ±‚æ–¹æ³•ï¼ˆå¦‚POSTã€PUTç­‰ï¼‰</p><p><strong>ä¼šè¿”å›é”™è¯¯ä¿¡æ¯</strong> <code>Method Not Allowed</code></p></blockquote><h3 id="å¯åŠ¨æœåŠ¡å™¨"><a href="#å¯åŠ¨æœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨æœåŠ¡å™¨"></a>å¯åŠ¨æœåŠ¡å™¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.listen(3000, () =&gt; &#123;</span><br><span class="line">  console.log(&#x27;Server is listening on port 3000&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>æœåŠ¡å™¨ç›‘å¬æœ¬åœ°çš„3000ç«¯å£ï¼Œå¯åŠ¨åæ‰“å°æ—¥å¿—ã€‚</strong></p></blockquote><h2 id="è°ƒè¯•ä¸éƒ¨ç½²"><a href="#è°ƒè¯•ä¸éƒ¨ç½²" class="headerlink" title="è°ƒè¯•ä¸éƒ¨ç½²"></a>è°ƒè¯•ä¸éƒ¨ç½²</h2><h3 id="nodemonçƒ­é‡è½½"><a href="#nodemonçƒ­é‡è½½" class="headerlink" title="nodemonçƒ­é‡è½½"></a>nodemonçƒ­é‡è½½</h3><blockquote><p><code>nodemon</code>æ˜¯ä¸€ä¸ªç”¨äºNode.jsåº”ç”¨çš„å·¥å…·ï¼Œå®ƒå¯ä»¥ç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶åœ¨æ–‡ä»¶è¢«ä¿®æ”¹æ—¶è‡ªåŠ¨é‡å¯æœåŠ¡ï¼Œè¿™å¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡</p></blockquote><h3 id="PM2è¿›ç¨‹ç®¡ç†"><a href="#PM2è¿›ç¨‹ç®¡ç†" class="headerlink" title="PM2è¿›ç¨‹ç®¡ç†"></a>PM2è¿›ç¨‹ç®¡ç†</h3><blockquote><p><strong>å®ƒå¯ä»¥ä¿è¯ä½ çš„åº”ç”¨ç¨‹åºå§‹ç»ˆåœ¨çº¿ï¼Œå³ä½¿é‡åˆ°å´©æºƒä¹Ÿèƒ½è‡ªåŠ¨é‡å¯</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start app.js --name &quot;MyApi&quot;</span><br></pre></td></tr></table></figure><blockquote><p><code>app.js</code>å°±æ˜¯ä½ Node.jsåº”ç”¨çš„å…¥å£æ–‡ä»¶</p></blockquote><p><strong>å®‰è£…</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express nodemon pm2 --save</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mini-vueæ­å»ºç¬”è®°</title>
      <link href="/2025/03/08/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/mini-vue%E6%90%AD%E5%BB%BA%E7%AC%94%E8%AE%B0/"/>
      <url>/2025/03/08/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/mini-vue%E6%90%AD%E5%BB%BA%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="mini-vueæ­å»ºç¬”è®°"><a href="#mini-vueæ­å»ºç¬”è®°" class="headerlink" title="mini-vueæ­å»ºç¬”è®°"></a>mini-vueæ­å»ºç¬”è®°</h1><h1 id="åŸç†æ¦‚å†µ"><a href="#åŸç†æ¦‚å†µ" class="headerlink" title="åŸç†æ¦‚å†µ"></a>åŸç†æ¦‚å†µ</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/cuixiaorui/mini-vue</span><br></pre></td></tr></table></figure><h2 id="Vue3æ¨¡å—ç»„ç»‡æ–¹å¼"><a href="#Vue3æ¨¡å—ç»„ç»‡æ–¹å¼" class="headerlink" title="Vue3æ¨¡å—ç»„ç»‡æ–¹å¼"></a>Vue3æ¨¡å—ç»„ç»‡æ–¹å¼</h2><h3 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h3><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250219223855962.png?lastModify=1740547033" alt="image-20250219223855962"></p><h3 id="ç®€å•æ¥è¯´"><a href="#ç®€å•æ¥è¯´" class="headerlink" title="ç®€å•æ¥è¯´"></a>ç®€å•æ¥è¯´</h3><h4 id="å¤„ç†ç¼–è¯‘"><a href="#å¤„ç†ç¼–è¯‘" class="headerlink" title="å¤„ç†ç¼–è¯‘"></a>å¤„ç†ç¼–è¯‘</h4><blockquote><p><code>compiler-sfc</code>ä¸“é—¨è§£æsfc (ä½¿ç”¨rollup-vue<em><strong>æŠŠApp.vueå•æ–‡ä»¶ç»„ä»¶ç¼–è¯‘æˆJS</strong></em>)</p><p><code>compiler-dom</code>ä¾èµ–coreï¼Œå¤„ç†templateæ ‡ç­¾ï¼Œ<em><strong>æŠŠtemplateç¼–è¯‘è½¬åŒ–æˆä¸€ä¸ªrenderå‡½æ•°</strong></em></p><p><code>compiler-core</code>ç»™domæä¾›ä¾èµ–</p></blockquote><h4 id="å¤„ç†è¿è¡Œæ—¶"><a href="#å¤„ç†è¿è¡Œæ—¶" class="headerlink" title="å¤„ç†è¿è¡Œæ—¶"></a>å¤„ç†è¿è¡Œæ—¶</h4><blockquote><p><code>runtime-dom</code>ä¾èµ–core</p><p><code>runtime-core</code><em><strong>æœ€é‡ç‚¹çš„æ ¸å¿ƒä»£ç </strong></em></p><p><code>runtime-reactivity</code>å®ç°vueçš„<em><strong>å“åº”å¼</strong></em></p></blockquote><h3 id="æ›´ä¸ºè¯¦ç»†çš„"><a href="#æ›´ä¸ºè¯¦ç»†çš„" class="headerlink" title="æ›´ä¸ºè¯¦ç»†çš„"></a>æ›´ä¸ºè¯¦ç»†çš„</h3><h4 id="runtime-reactivity-å“åº”å¼ç³»ç»Ÿ"><a href="#runtime-reactivity-å“åº”å¼ç³»ç»Ÿ" class="headerlink" title="runtime-reactivity å“åº”å¼ç³»ç»Ÿ"></a>runtime-reactivity å“åº”å¼ç³»ç»Ÿ</h4><blockquote><p><strong>æä¾›äº†è¯¸å¦‚ reactiveã€ref ç­‰ API æ¥åˆ›å»ºå“åº”å¼å¯¹è±¡æˆ–å˜é‡ã€‚</strong> <strong>ä½¿ç”¨ WeakMap æ•°æ®ç»“æ„æ¥è·Ÿè¸ªä¾èµ–å…³ç³»ï¼Œç¡®ä¿å½“æ•°æ®å˜åŒ–æ—¶èƒ½å¤Ÿé€šçŸ¥ç›¸å…³çš„è§‚å¯Ÿè€…è¿›è¡Œæ›´æ–°ã€‚</strong> <strong>å®ç°äº† effect å‡½æ•°æœºåˆ¶ï¼Œç”¨äºè‡ªåŠ¨è¿½è¸ªå’Œè§¦å‘å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œã€‚</strong></p></blockquote><h4 id="runtime-core-è·¨å¹³å°æ¸²æŸ“"><a href="#runtime-core-è·¨å¹³å°æ¸²æŸ“" class="headerlink" title="runtime-core è·¨å¹³å°æ¸²æŸ“"></a>runtime-core è·¨å¹³å°æ¸²æŸ“</h4><blockquote><p><strong>Vue3 çš„è¿è¡Œæ—¶æ ¸å¿ƒæ¨¡å—ï¼Œæä¾›äº†è·¨å¹³å°çš„æ¸²æŸ“èƒ½åŠ›ã€‚å®ƒçš„ä¸»è¦èŒè´£åŒ…æ‹¬ï¼š</strong> <strong>å®šä¹‰äº†é€šç”¨çš„æ¸²æŸ“å™¨æ¥å£ createRendererï¼Œå…è®¸å¼€å‘è€…è‡ªå®šä¹‰æ¸²æŸ“é€»è¾‘ã€‚</strong> <strong>å®ç°äº†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€æ’æ§½æœºåˆ¶ä»¥åŠå…¶ä»–è¿è¡Œæ—¶æ‰€éœ€çš„åŸºç¡€åŠŸèƒ½ã€‚</strong> <strong>æä¾›äº†è¯¸å¦‚ h å‡½æ•°è¿™æ ·çš„å·¥å…·ï¼Œç”¨äºåˆ›å»ºè™šæ‹Ÿ DOM èŠ‚ç‚¹ã€‚</strong> <strong>åŒ…å«äº†ä¸å¹³å°æ— å…³çš„è¿è¡Œæ—¶æ ¸å¿ƒå®ç°ï¼ˆå¦‚è™šæ‹Ÿ DOM çš„æ¸²æŸ“å™¨ã€ç»„ä»¶å®ç°å’Œä¸€äº›å…¨å±€çš„ JS APIï¼‰ã€‚</strong></p></blockquote><h4 id="runtime-dom-DOMæ–¹æ³•"><a href="#runtime-dom-DOMæ–¹æ³•" class="headerlink" title="runtime-dom DOMæ–¹æ³•"></a>runtime-dom DOMæ–¹æ³•</h4><blockquote><p><strong>runtime-dom æ¨¡å—é’ˆå¯¹æµè§ˆå™¨ç¯å¢ƒå®ç°äº†å…·ä½“çš„è¿è¡Œæ—¶é€»è¾‘ã€‚å…¶ä¸»è¦ä»»åŠ¡æ˜¯ï¼š</strong> <strong>å°è£…äº†ä¸€ç³»åˆ—ä¸ DOM æ“ä½œç›¸å…³çš„å®ç”¨æ–¹æ³•ï¼Œå¦‚åˆ›å»ºå…ƒç´ ã€æ’å…¥èŠ‚ç‚¹ç­‰ã€‚</strong> <strong>æä¾›äº†ä¸€ä¸ªåŸºäº runtime-core çš„é»˜è®¤æ¸²æŸ“å™¨å®ä¾‹ï¼Œç”¨äºå°†è™šæ‹Ÿ DOM èŠ‚ç‚¹æ¸²æŸ“åˆ°çœŸå®çš„ DOM å®¹å™¨ä¸­ã€‚</strong> <strong>å¤„ç†ç‰¹å®šäºæµè§ˆå™¨çš„è¡Œä¸ºï¼Œæ¯”å¦‚å±æ€§ç»‘å®šã€äº‹ä»¶ç›‘å¬å™¨æ·»åŠ ç­‰ã€‚</strong> <strong>å¯¹åŸç”Ÿ DOM APIã€å±æ€§ã€æ ·å¼ã€äº‹ä»¶ç­‰è¿›è¡Œç®¡ç†ã€‚</strong></p></blockquote><h4 id="compiler-sfc-è§£æ-vueç»„ä»¶"><a href="#compiler-sfc-è§£æ-vueç»„ä»¶" class="headerlink" title="compiler-sfc è§£æ.vueç»„ä»¶"></a>compiler-sfc è§£æ.vueç»„ä»¶</h4><blockquote><p><strong>compiler-sfc æ¨¡å—è´Ÿè´£è§£æå•æ–‡ä»¶ç»„ä»¶ï¼ˆ.vue æ–‡ä»¶ï¼‰ï¼Œå®ƒå°† .vue æ–‡ä»¶ä¸­çš„ <strong><template></strong>ã€</strong><script>** å’Œ <strong><style></strong> éƒ¨åˆ†åˆ†åˆ«æå–å‡ºæ¥ï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚å…·ä½“è€Œè¨€ï¼š** <strong>å¯¹äº <strong><template></strong> éƒ¨åˆ†ï¼Œä¼šè°ƒç”¨ compiler-dom æ¥å°†å…¶ç¼–è¯‘ä¸ºæ¸²æŸ“å‡½æ•°ã€‚</strong> <strong>å¯¹äº <strong><script></strong> éƒ¨åˆ†ï¼Œå¯èƒ½ä¼šåšä¸€äº›é¢å¤–çš„å¤„ç†ï¼Œæ¯”å¦‚æ³¨å…¥ä¸Šä¸‹æ–‡æˆ–å¤„ç† TypeScript ç±»å‹å£°æ˜ã€‚</strong> <strong>å¯¹äº <strong><style></strong> éƒ¨åˆ†ï¼Œåˆ™å¯èƒ½æ¶‰åŠ CSS æ¨¡å—åŒ–å¤„ç†æˆ–è€…å…¶ä»–æ ·å¼ç›¸å…³çš„è½¬æ¢ã€‚</strong></p></blockquote><h4 id="compiler-core-ç¼–è¯‘é€»è¾‘å’Œç®—æ³•"><a href="#compiler-core-ç¼–è¯‘é€»è¾‘å’Œç®—æ³•" class="headerlink" title="compiler-core ç¼–è¯‘é€»è¾‘å’Œç®—æ³•"></a>compiler-core ç¼–è¯‘é€»è¾‘å’Œç®—æ³•</h4><blockquote><p><strong>ä½œä¸º Vue ç¼–è¯‘çš„æ ¸å¿ƒæ¨¡å—ï¼Œcompiler-core æ˜¯å¹³å°æ— å…³çš„ï¼Œæä¾›äº†åŸºç¡€çš„ç¼–è¯‘é€»è¾‘å’Œç®—æ³•ã€‚å®ƒçš„èŒè´£æ˜¯å®šä¹‰äº†ç¼–è¯‘çš„åŸºæœ¬æµç¨‹ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</strong> <strong>æä¾› baseParse å‡½æ•°ç”¨äºè§£ææ¨¡æ¿å­—ç¬¦ä¸²åˆ° ASTã€‚</strong> <strong>å®šä¹‰äº† transform æ–¹æ³•æ¥å¯¹ AST è¿›è¡Œè½¬æ¢ã€‚</strong> <strong>å®ç°äº† generate å‡½æ•°ç”¨æ¥ä» AST ç”Ÿæˆæœ€ç»ˆçš„æ¸²æŸ“å‡½æ•°ä»£ç ã€‚</strong> <strong>æä¾›äº†ä¸å¹³å°æ— å…³çš„ä»£ç è½¬æ¢æ’ä»¶ï¼Œé€‚ç”¨äºä¸åŒç±»å‹çš„ç¼–è¯‘éœ€æ±‚ã€‚</strong></p></blockquote><h4 id="compiler-dom-æµè§ˆå™¨æ¨¡æ¿ç¼–è¯‘"><a href="#compiler-dom-æµè§ˆå™¨æ¨¡æ¿ç¼–è¯‘" class="headerlink" title="compiler-dom æµè§ˆå™¨æ¨¡æ¿ç¼–è¯‘"></a>compiler-dom æµè§ˆå™¨æ¨¡æ¿ç¼–è¯‘</h4><blockquote><p><strong>è¯¥æ¨¡å—ä¸“æ³¨äºæµè§ˆå™¨ç«¯çš„æ¨¡æ¿ç¼–è¯‘å·¥ä½œã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</strong> <strong>æ¥æ”¶ Vue çš„æ¨¡æ¿å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥ï¼Œé€šè¿‡è°ƒç”¨ baseCompile å‡½æ•°æ¥æ‰§è¡Œå®é™…çš„ç¼–è¯‘è¿‡ç¨‹ã€‚</strong> <strong>å°†æ¨¡æ¿å­—ç¬¦ä¸²è§£æä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚</strong> <strong>å¯¹ AST è¿›è¡Œå¿…è¦çš„è½¬æ¢å’Œä¼˜åŒ–ã€‚</strong> <strong>æœ€ç»ˆç”Ÿæˆå¯æ‰§è¡Œçš„ JavaScript æ¸²æŸ“å‡½æ•°ä»£ç ï¼Œä»¥ä¾¿åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­è¿è¡Œã€‚</strong></p></blockquote><h1 id="runtime-reactivity-å“åº”å¼ç³»ç»Ÿ-1"><a href="#runtime-reactivity-å“åº”å¼ç³»ç»Ÿ-1" class="headerlink" title="runtime-reactivity å“åº”å¼ç³»ç»Ÿ"></a>runtime-reactivity å“åº”å¼ç³»ç»Ÿ</h1><h2 id="ä¸»æµç¨‹-è„‘å›¾"><a href="#ä¸»æµç¨‹-è„‘å›¾" class="headerlink" title="ä¸»æµç¨‹ | è„‘å›¾"></a>ä¸»æµç¨‹ | è„‘å›¾</h2><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250220163321605.png?lastModify=1740547033" alt="image-20250220163321605"></p><h3 id="reactive-å“åº”å¼è®¾ç½®"><a href="#reactive-å“åº”å¼è®¾ç½®" class="headerlink" title="reactive å“åº”å¼è®¾ç½®"></a>reactive å“åº”å¼è®¾ç½®</h3><blockquote><p><em><strong>reactivityæ ¸å¿ƒAPI</strong></em></p><p><strong><code>reactive()</code><strong>åˆ›å»º</strong>å¯¹è±¡ç±»å‹</strong>çš„å“åº”å¼æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive &#125; from &#x27;vue&#x27;;</span><br><span class="line">const state = reactive(&#123; count: 0 &#125;);</span><br><span class="line">state.count++; // ä¿®æ”¹åè§†å›¾è‡ªåŠ¨æ›´æ–°</span><br></pre></td></tr></table></figure><p><strong><code>ref()</code><strong>åˆ›å»º</strong>ä»»æ„ç±»å‹</strong>çš„å“åº”å¼æ•°æ®ï¼ˆé€šè¿‡ <code>.value</code> è®¿é—®ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">const num = ref(0);</span><br><span class="line">num.value = 10; // ä¿®æ”¹éœ€ä½¿ç”¨ .value</span><br></pre></td></tr></table></figure><p>**<code>computed()</code>**åˆ›å»ºä¾èµ–å…¶ä»–æ•°æ®çš„è®¡ç®—å±æ€§ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const doubleCount = computed(() =&gt; state.count * 2);</span><br></pre></td></tr></table></figure><p>**<code>watch()</code> å’Œ <code>watchEffect()</code>**ç›‘å¬æ•°æ®å˜åŒ–æ‰§è¡Œå‰¯ä½œç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">watch(num, (newVal) =&gt; console.log(&#x27;numå˜åŒ–:&#x27;, newVal));</span><br><span class="line">watchEffect(() =&gt; console.log(&#x27;countå˜åŒ–:&#x27;, state.count));</span><br></pre></td></tr></table></figure></blockquote><h4 id="reactive-å•æµ‹"><a href="#reactive-å•æµ‹" class="headerlink" title="reactive å•æµ‹"></a>reactive å•æµ‹</h4><p><strong>reactivity / tests / reactive.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive, isReactive, toRaw, reactiveMap &#125; from &quot;../src/reactive&quot;;</span><br></pre></td></tr></table></figure><blockquote><p><code>reactive</code>: å°†æ™®é€šå¯¹è±¡è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡ã€‚** <strong><code>isReactive</code>: æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯å“åº”å¼å¯¹è±¡ã€‚</strong> <strong><code>toRaw</code>: è·å–å“åº”å¼å¯¹è±¡å¯¹åº”çš„åŸå§‹å¯¹è±¡ã€‚</strong> **<code>reactiveMap</code>: å†…éƒ¨ä½¿ç”¨çš„ Map æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨åŸå§‹å¯¹è±¡å’Œå“åº”å¼å¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">describe(&quot;reactive&quot;, () =&gt; &#123;</span><br><span class="line">  test(&quot;Object&quot;, () =&gt; &#123;//æµ‹è¯•ç”¨ä¾‹1 | åŸºæœ¬åŠŸèƒ½ï¼šç¡®ä¿ reactive æ–¹æ³•èƒ½å¤Ÿæ­£ç¡®åœ°å°†æ™®é€šå¯¹è±¡è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡ã€‚</span><br><span class="line">    const original = &#123; foo: 1 &#125;;</span><br><span class="line">    const observed = reactive(original);//å°†æ™®é€šå¯¹è±¡è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡</span><br><span class="line">    expect(observed).not.toBe(original);//ç¡®ä¿ reactive è¿”å›çš„å¯¹è±¡ä¸åŸå§‹å¯¹è±¡ä¸æ˜¯åŒä¸€ä¸ªå¼•ç”¨</span><br><span class="line">    expect(isReactive(observed)).toBe(true);//éªŒè¯ observed æ˜¯å“åº”å¼å¯¹è±¡</span><br><span class="line">    expect(isReactive(original)).toBe(false);//è€Œ original ä¸æ˜¯</span><br><span class="line">    expect(observed.foo).toBe(1);//å¯è¯»å–</span><br><span class="line">    expect(&quot;foo&quot; in observed).toBe(true);//å­˜åœ¨</span><br><span class="line">    expect(Object.keys(observed)).toEqual([&quot;foo&quot;]);//è‡ªæœ‰å±æ€§é”®å</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  test(&quot;nested reactives&quot;, () =&gt; &#123;//æµ‹è¯•ç”¨ä¾‹2 | åµŒå¥—å¯¹è±¡æ”¯æŒï¼šç¡®ä¿åµŒå¥—å¯¹è±¡å’Œæ•°ç»„ä¹Ÿèƒ½è¢«æ­£ç¡®è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡ã€‚</span><br><span class="line">    const original = &#123;//å®šä¹‰ä¸€ä¸ªå¤æ‚å¯¹è±¡</span><br><span class="line">      nested: &#123;//åµŒå¥—å¯¹è±¡</span><br><span class="line">        foo: 1,</span><br><span class="line">      &#125;,</span><br><span class="line">      array: [&#123; bar: 2 &#125;],//æ•°ç»„</span><br><span class="line">    &#125;;</span><br><span class="line">    const observed = reactive(original);//å°†å¤æ‚å¯¹è±¡è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡</span><br><span class="line">    expect(isReactive(observed.nested)).toBe(true);</span><br><span class="line">    expect(isReactive(observed.array)).toBe(true);</span><br><span class="line">    expect(isReactive(observed.array[0])).toBe(true);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  test(&quot;toRaw&quot;, () =&gt; &#123;//æµ‹è¯•ç”¨ä¾‹3 | toRaw æ–¹æ³•ï¼šç¡®ä¿å¯ä»¥æ­£ç¡®åœ°ä»å“åº”å¼å¯¹è±¡ä¸­è·å–åŸå§‹å¯¹è±¡ã€‚</span><br><span class="line">    const original = &#123; foo: 1 &#125;;</span><br><span class="line">    const observed = reactive(original);</span><br><span class="line">    expect(toRaw(observed)).toBe(original);//ç¡®ä¿é€šè¿‡ toRaw æ–¹æ³•å¯ä»¥ä»å“åº”å¼å¯¹è±¡ observed ä¸­è·å–åŸå§‹å¯¹è±¡ original</span><br><span class="line">    expect(toRaw(original)).toBe(original);//å¦‚æœç›´æ¥å¯¹åŸå§‹å¯¹è±¡è°ƒç”¨ toRawï¼Œåº”è¯¥è¿”å›åŸå§‹å¯¹è±¡æœ¬èº«</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="reactive-æºç å®ç°ï¼ˆProxyï¼‰"><a href="#reactive-æºç å®ç°ï¼ˆProxyï¼‰" class="headerlink" title="reactive æºç å®ç°ï¼ˆProxyï¼‰"></a>reactive æºç å®ç°ï¼ˆ<em>Proxy</em>ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function reactive(target) &#123;</span><br><span class="line">  return createReactiveObject(target, reactiveMap, mutableHandlers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ğŸ‘‡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function createReactiveObject(target, proxyMap, baseHandlers) &#123;//åŸç†æ˜¯JSåˆ›å»ºçš„Proxyå¯¹è±¡ï¼Œç›®çš„æ˜¯å¯ä»¥ä¾¦å¬åˆ°ç”¨æˆ· get æˆ–è€… set çš„åŠ¨ä½œ</span><br><span class="line">    </span><br><span class="line">  const existingProxy = proxyMap.get(target);//å…ˆæ£€æŸ¥ proxyMap ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ä¸å½“å‰ target å¯¹åº”çš„ä»£ç†å¯¹è±¡ã€‚</span><br><span class="line">  if (existingProxy) &#123;//å­˜åœ¨åˆ™ç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„ä»£ç†å¯¹è±¡ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚</span><br><span class="line">    return existingProxy;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //target è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡</span><br><span class="line">  //baseHandlers ä¸€ä¸ªæ‹¦æˆªå™¨å¯¹è±¡ï¼Œå®šä¹‰äº†ä»£ç†çš„è¡Œä¸ºï¼ˆä¾‹å¦‚å¦‚ä½•å¤„ç† get å’Œ set æ“ä½œï¼‰</span><br><span class="line">  const proxy = new Proxy(target, baseHandlers);</span><br><span class="line"></span><br><span class="line">  proxyMap.set(target, proxy);//æŠŠåˆ›å»ºå¥½çš„ proxy ç»™å­˜èµ·æ¥</span><br><span class="line">  return proxy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>å¦ï¼šå›é¡¾ProxyåŠŸèƒ½ | å¯åœ¨ç”¨æˆ·å¯¹ç›®æ ‡å¯¹è±¡çš„</strong>***è®¿é—®(get)<em><strong>å’Œ</strong></em>ä¿®æ”¹(set)***æ“ä½œä¸­ï¼Œè‡ªå®šä¹‰é€»è¾‘ï¼ˆå¦‚è§¦å‘ä¾èµ–æ›´æ–°ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// å®šä¹‰ä¸€ä¸ªç›®æ ‡å¯¹è±¡</span><br><span class="line">const target = &#123; count: 0 &#125;;</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºä¸€ä¸ª Proxy å¯¹è±¡</span><br><span class="line">const reactiveObj = new Proxy(target, &#123;</span><br><span class="line">get(target, key, receiver) &#123;</span><br><span class="line">console.log(`Getting $&#123;key&#125;`);</span><br><span class="line">return Reflect.get(target, key, receiver);</span><br><span class="line">&#125;,</span><br><span class="line">set(target, key, value, receiver) &#123;</span><br><span class="line">console.log(`Setting $&#123;key&#125; to $&#123;value&#125;`);</span><br><span class="line">const result = Reflect.set(target, key, value, receiver);</span><br><span class="line">if (result) &#123;</span><br><span class="line">console.log(&quot;Trigger updates...&quot;);</span><br><span class="line">&#125;</span><br><span class="line">return result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// æµ‹è¯•</span><br><span class="line">console.log(reactiveObj.count); // è¾“å‡º: Getting count</span><br><span class="line">reactiveObj.count++; // è¾“å‡º: Setting count to 1 å’Œ Trigger updates...</span><br></pre></td></tr></table></figure></blockquote><h3 id="init-åˆå§‹åŒ–"><a href="#init-åˆå§‹åŒ–" class="headerlink" title="init åˆå§‹åŒ–"></a>init åˆå§‹åŒ–</h3><h4 id="effect-å•æµ‹"><a href="#effect-å•æµ‹" class="headerlink" title="effect å•æµ‹"></a>effect å•æµ‹</h4><blockquote><p><em><strong>effect å‡½æ•°åŠŸèƒ½</strong></em></p><p><strong>å½“ä¾èµ–çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè‡ªåŠ¨é‡æ–°æ‰§è¡ŒæŒ‡å®šçš„å‡½æ•°ã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive, effect &#125; from &#x27;@vue/reactivity&#x27;;</span><br><span class="line"></span><br><span class="line">const state = reactive(&#123; count: 0 &#125;);</span><br><span class="line"></span><br><span class="line">// effectå‡½æ•°</span><br><span class="line">effect(() =&gt; &#123;</span><br><span class="line">console.log(`Count is $&#123;state.count&#125;`);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// ä¿®æ”¹çŠ¶æ€</span><br><span class="line">state.count++; // è¾“å‡º: Count is 1</span><br><span class="line">state.count++; // è¾“å‡º: Count is 2</span><br></pre></td></tr></table></figure><p>**æ‰‹åŠ¨åœæ­¢ **<code>effect</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºä¸€ä¸ª effect å¹¶è·å–åœæ­¢å‡½æ•°</span><br><span class="line">const stop = effect(() =&gt; &#123;</span><br><span class="line">console.log(`Count is $&#123;state.count&#125;`);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// ä¿®æ”¹çŠ¶æ€</span><br><span class="line">state.count++; // è¾“å‡º: Count is 1</span><br><span class="line">// åœæ­¢ effect</span><br><span class="line">stop();</span><br><span class="line">// å†æ¬¡ä¿®æ”¹çŠ¶æ€ï¼Œä½† effect ä¸å†è§¦å‘</span><br><span class="line">state.count++; // æ— è¾“å‡º</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive &#125; from &quot;../src/reactive&quot;;</span><br><span class="line">import &#123; effect, stop &#125; from &quot;../src/effect&quot;;</span><br><span class="line">import &#123; vi &#125; from &quot;vitest&quot;;</span><br><span class="line"></span><br><span class="line">describe(&quot;effect&quot;, () =&gt; &#123;</span><br><span class="line">  it(&quot;should run the passed function once (wrapped by a effect)&quot;, () =&gt; &#123; //éªŒè¯ effect å‡½æ•°æ˜¯å¦ä¼šç«‹å³æ‰§è¡Œä¼ å…¥çš„å‡½æ•°ä¸€æ¬¡</span><br><span class="line">    const fnSpy = vi.fn(() =&gt; &#123;&#125;);//åˆ›å»ºä¸€ä¸ªé—´è°å‡½æ•°fnSpy</span><br><span class="line">    effect(fnSpy);//fnSpyä½œä¸ºå‚æ•°ä¼ é€’ç»™effectå‡½æ•°</span><br><span class="line">    expect(fnSpy).toHaveBeenCalledTimes(1);//éªŒè¯fnSpyæ˜¯å¦è¢«è°ƒç”¨äº†ä¸€æ¬¡</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should observe basic properties&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿè§‚å¯Ÿåˆ°å“åº”å¼å¯¹è±¡çš„åŸºæœ¬å±æ€§çš„å˜åŒ–</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; num: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = counter.num));//ä½¿ç”¨ effect å‡½æ•°åŒ…è£¹ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œè¯¥å‡½æ•°å°† counter.num çš„å€¼èµ‹ç»™ dummyã€‚</span><br><span class="line">    </span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.num = 7;</span><br><span class="line">    expect(dummy).toBe(7);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should observe multiple properties&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿè§‚å¯Ÿåˆ°å“åº”å¼å¯¹è±¡çš„å¤šä¸ªå±æ€§çš„å˜åŒ–</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; num1: 0, num2: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = counter.num1 + counter.num1 + counter.num2));</span><br><span class="line">    </span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.num1 = counter.num2 = 7;</span><br><span class="line">    expect(dummy).toBe(21);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should handle multiple effects&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿå¤„ç†å¤šä¸ªå“åº”å¼ä¾èµ–</span><br><span class="line">    let dummy1, dummy2;</span><br><span class="line">    const counter = reactive(&#123; num: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy1 = counter.num));</span><br><span class="line">    effect(() =&gt; (dummy2 = counter.num));</span><br><span class="line"></span><br><span class="line">    expect(dummy1).toBe(0);</span><br><span class="line">    expect(dummy2).toBe(0);</span><br><span class="line">    counter.num++;</span><br><span class="line">    expect(dummy1).toBe(1);</span><br><span class="line">    expect(dummy2).toBe(1);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should observe nested properties&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿè§‚å¯Ÿåˆ°åµŒå¥—å±æ€§çš„å˜åŒ–</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; nested: &#123; num: 0 &#125; &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = counter.nested.num));</span><br><span class="line"></span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.nested.num = 8;</span><br><span class="line">    expect(dummy).toBe(8);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should observe function call chains&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿè§‚å¯Ÿåˆ°å‡½æ•°è°ƒç”¨é“¾çš„å˜åŒ–</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; num: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = getNum()));</span><br><span class="line"></span><br><span class="line">    function getNum() &#123;</span><br><span class="line">      return counter.num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.num = 2;</span><br><span class="line">    expect(dummy).toBe(2);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;scheduler&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°è°ƒç”¨ scheduler å‡½æ•°</span><br><span class="line">    let dummy;</span><br><span class="line">    let run: any;</span><br><span class="line">    const scheduler = vi.fn(() =&gt; &#123;</span><br><span class="line">      run = runner;</span><br><span class="line">    &#125;);</span><br><span class="line">    const obj = reactive(&#123; foo: 1 &#125;);</span><br><span class="line">    const runner = effect(</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        dummy = obj.foo;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; scheduler &#125;</span><br><span class="line">    );</span><br><span class="line">    expect(scheduler).not.toHaveBeenCalled();</span><br><span class="line">    expect(dummy).toBe(1);</span><br><span class="line">    // should be called on first trigger</span><br><span class="line">    obj.foo++;</span><br><span class="line">    expect(scheduler).toHaveBeenCalledTimes(1);</span><br><span class="line">    // // should not run yet</span><br><span class="line">    expect(dummy).toBe(1);</span><br><span class="line">    // // manually run</span><br><span class="line">    run();</span><br><span class="line">    // // should have run</span><br><span class="line">    expect(dummy).toBe(2);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;stop&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°åœæ­¢è§‚å¯Ÿ</span><br><span class="line">    let dummy;</span><br><span class="line">    const obj = reactive(&#123; prop: 1 &#125;);</span><br><span class="line">    const runner = effect(() =&gt; &#123;</span><br><span class="line">      dummy = obj.prop;</span><br><span class="line">    &#125;);</span><br><span class="line">    obj.prop = 2;</span><br><span class="line">    expect(dummy).toBe(2);</span><br><span class="line">    stop(runner);</span><br><span class="line">    // obj.prop = 3</span><br><span class="line">    obj.prop++;</span><br><span class="line">    expect(dummy).toBe(2);</span><br><span class="line"></span><br><span class="line">    // stopped effect should still be manually callable</span><br><span class="line">    runner();</span><br><span class="line">    expect(dummy).toBe(3);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;events: onStop&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°è§¦å‘ onStop äº‹ä»¶</span><br><span class="line">    const onStop = vi.fn();</span><br><span class="line">    const runner = effect(() =&gt; &#123;&#125;, &#123;</span><br><span class="line">      onStop,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    stop(runner);</span><br><span class="line">    expect(onStop).toHaveBeenCalled();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="effect-æºç å®ç°"><a href="#effect-æºç å®ç°" class="headerlink" title="effect æºç å®ç°"></a>effect æºç å®ç°</h4><p><strong>effectå‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">export function effect(fn, options = &#123;&#125;) &#123;</span><br><span class="line">    //fnï¼šç”¨æˆ·ä¼ å…¥çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œè¯¥å‡½æ•°å†…éƒ¨é€šå¸¸ä¼šè®¿é—®å“åº”å¼æ•°æ®ï¼Œå½“è¿™äº›å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œfn ä¼šè¢«é‡æ–°æ‰§è¡Œã€‚</span><br><span class="line">    //optionsï¼šä¸€ä¸ªå¯é€‰çš„é…ç½®å¯¹è±¡ï¼Œé»˜è®¤å€¼ä¸ºç©ºå¯¹è±¡ &#123;&#125;ã€‚</span><br><span class="line">    const _effect = new ReactiveEffect(fn);</span><br><span class="line"></span><br><span class="line">    extend(_effect, options);//å°†ç”¨æˆ·ä¼ å…¥çš„ options é…ç½®å¯¹è±¡åˆå¹¶åˆ°_effect å®ä¾‹ä¸Šï¼Œä½†ä¸å®¹æ˜“ç›´æ¥çœ‹å‡º _effect å®ä¾‹ä¸Šæœ‰å“ªäº›é¢å¤–çš„å±æ€§</span><br><span class="line">    _effect.run();//è°ƒç”¨å†…éƒ¨runæ–¹æ³•</span><br><span class="line"></span><br><span class="line">    // å°† _effect.run æ–¹æ³•ç»‘å®šåˆ° _effect å®ä¾‹ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•° runner</span><br><span class="line">    // å½“è°ƒç”¨ runner å‡½æ•°æ—¶ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨ _effect.run æ–¹æ³•</span><br><span class="line">    const runner: any = _effect.run.bind(_effect);</span><br><span class="line">    //åœ¨ runner å‡½æ•°ä¸Šæ·»åŠ ä¸€ä¸ª effect å±æ€§ï¼ŒæŒ‡å‘ _effect å®ä¾‹</span><br><span class="line">    runner.effect = _effect;</span><br><span class="line">    return runner;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ‰§è¡Œfn"><a href="#æ‰§è¡Œfn" class="headerlink" title="æ‰§è¡Œfn"></a>æ‰§è¡Œfn</h5><p><strong>ReactiveEffectç±»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">export class ReactiveEffect &#123;</span><br><span class="line">  active = true; //æ ‡è®°è¯¥å‰¯ä½œç”¨å‡½æ•°æ˜¯å¦å¤„äºæ´»è·ƒçŠ¶æ€</span><br><span class="line">  deps = []; //å­˜å‚¨è¯¥å‰¯ä½œç”¨å‡½æ•°çš„æ‰€æœ‰ä¾èµ–é¡¹</span><br><span class="line">  public onStop?: () =&gt; void; //å‰¯ä½œç”¨å‡½æ•°åœæ­¢æ—¶çš„å›è°ƒ</span><br><span class="line">  constructor(public fn, public scheduler?) &#123;</span><br><span class="line">    console.log(&quot;åˆ›å»º ReactiveEffect å¯¹è±¡&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  run() &#123;</span><br><span class="line">    console.log(&quot;run&quot;);</span><br><span class="line">      </span><br><span class="line">    //å¦‚æœ this.active ä¸º falseï¼Œè¡¨ç¤ºè¯¥å‰¯ä½œç”¨å‡½æ•°å·²ç»è¢«åœæ­¢ï¼ˆè°ƒç”¨äº† stop æ–¹æ³•ï¼‰ï¼Œæ­¤æ—¶ç›´æ¥æ‰§è¡Œ this.fn() å¹¶è¿”å›ç»“æœï¼Œä¸è¿›è¡Œä¾èµ–æ”¶é›†ã€‚</span><br><span class="line">    if (!this.active) &#123;</span><br><span class="line">      return this.fn();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    shouldTrack = true;//å…¨å±€å˜é‡ï¼Œæ§åˆ¶æ˜¯å¦è¿›è¡Œä¾èµ–æ”¶é›†ã€‚trueè¡¨ç¤ºå¼€å§‹æ”¶é›†ä¾èµ–ã€‚</span><br><span class="line">    activeEffect = this as any;//å…¨å±€å˜é‡ï¼Œå­˜å‚¨å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°ã€‚thisè¡¨ç¤ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°æ˜¯ ReactiveEffect çš„å®ä¾‹ã€‚</span><br><span class="line">      </span><br><span class="line">    console.log(&quot;æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„ fn&quot;);</span><br><span class="line">    const result = this.fn();</span><br><span class="line"></span><br><span class="line">    shouldTrack = false;//åœæ­¢ä¾èµ–æ”¶é›†ã€‚</span><br><span class="line">    activeEffect = undefined;//å½“å‰æ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°ã€‚</span><br><span class="line"></span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  stop() &#123;</span><br><span class="line">    if (this.active) &#123;//è¯¥å‰¯ä½œç”¨å‡½æ•°å·²ç»è¢«åœæ­¢</span><br><span class="line">      // å¦‚æœç¬¬ä¸€æ¬¡æ‰§è¡Œ stop å active å°± false äº†ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢é‡å¤çš„è°ƒç”¨ï¼Œæ‰§è¡Œ stop é€»è¾‘</span><br><span class="line">      cleanupEffect(this);//ä»æ‰€æœ‰ä¾èµ–è¯¥å‰¯ä½œç”¨å‡½æ•°çš„å“åº”å¼å¯¹è±¡ä¸­ç§»é™¤è¯¥å‰¯ä½œç”¨å‡½æ•°ï¼Œä»è€Œåœæ­¢å“åº”å¼è¿½è¸ª</span><br><span class="line">      if (this.onStop) &#123;//this.onStop å­˜åœ¨ï¼Œåˆ™è°ƒç”¨è¯¥å›è°ƒå‡½æ•°ï¼Œå…è®¸ç”¨æˆ·åœ¨å‰¯ä½œç”¨å‡½æ•°åœæ­¢æ—¶æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘</span><br><span class="line">        this.onStop();</span><br><span class="line">      &#125;</span><br><span class="line">      this.active = false;//å‰¯ä½œç”¨å‡½æ•°å·²ç»åœæ­¢</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="è§¦å‘get-è®¿é—®"><a href="#è§¦å‘get-è®¿é—®" class="headerlink" title="è§¦å‘get(è®¿é—®)"></a>è§¦å‘get(è®¿é—®)</h5><h5 id="æ‰§è¡Œtrack-æ”¶é›†ä¾èµ–"><a href="#æ‰§è¡Œtrack-æ”¶é›†ä¾èµ–" class="headerlink" title="æ‰§è¡Œtrack(æ”¶é›†ä¾èµ–)"></a>æ‰§è¡Œtrack(æ”¶é›†ä¾èµ–)</h5><h5 id="æŠŠeffectæ”¶é›†èµ·æ¥ä½œä¸ºä¾èµ–"><a href="#æŠŠeffectæ”¶é›†èµ·æ¥ä½œä¸ºä¾èµ–" class="headerlink" title="æŠŠeffectæ”¶é›†èµ·æ¥ä½œä¸ºä¾èµ–"></a>æŠŠeffectæ”¶é›†èµ·æ¥ä½œä¸ºä¾èµ–</h5><h3 id="update-æ›´æ–°"><a href="#update-æ›´æ–°" class="headerlink" title="update æ›´æ–°"></a>update æ›´æ–°</h3><h4 id="ä¾‹ï¼šeffect-å•æµ‹"><a href="#ä¾‹ï¼šeffect-å•æµ‹" class="headerlink" title="ä¾‹ï¼šeffect å•æµ‹"></a>ä¾‹ï¼šeffect å•æµ‹</h4><h5 id="è§¦å‘set-ä¿®æ”¹"><a href="#è§¦å‘set-ä¿®æ”¹" class="headerlink" title="è§¦å‘set(ä¿®æ”¹)"></a>è§¦å‘set(ä¿®æ”¹)</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">it(&quot;should observe basic properties&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿè§‚å¯Ÿåˆ°å“åº”å¼å¯¹è±¡çš„åŸºæœ¬å±æ€§çš„å˜åŒ–</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; num: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = counter.num));</span><br><span class="line"></span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.num = 7;// æ›´æ–°æ—¶è§¦å‘setæ“ä½œ</span><br><span class="line">    expect(dummy).toBe(7);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="æ‰§è¡Œtrigger-è§¦å‘ä¾èµ–"><a href="#æ‰§è¡Œtrigger-è§¦å‘ä¾èµ–" class="headerlink" title="æ‰§è¡Œtrigger(è§¦å‘ä¾èµ–)"></a>æ‰§è¡Œtrigger(è§¦å‘ä¾èµ–)</h5><p><strong>baseHandlers.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function createSetter() &#123;</span><br><span class="line">    return function set(target, key, value, receiver) &#123;</span><br><span class="line">        const result = Reflect.set(target, key, value, receiver)</span><br><span class="line"></span><br><span class="line">        trigger(target, &#x27;set&#x27;, key)// è§¦å‘triggeråé‡æ–°è¿è¡Œeffectå‡½æ•°</span><br><span class="line"></span><br><span class="line">        return result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="effecté‡æ–°è¿è¡Œ"><a href="#effecté‡æ–°è¿è¡Œ" class="headerlink" title="effecté‡æ–°è¿è¡Œ"></a>effecté‡æ–°è¿è¡Œ</h5><blockquote><p><strong>æ‰§è¡Œfn-&gt;è§¦å‘get(è®¿é—®)-&gt;æ‰§è¡Œtrack(æ”¶é›†ä¾èµ–)-&gt;æŠŠeffectæ”¶é›†èµ·æ¥ä½œä¸ºä¾èµ–</strong></p></blockquote><h2 id="baseHandlers-è„‘å›¾"><a href="#baseHandlers-è„‘å›¾" class="headerlink" title="baseHandlers | è„‘å›¾"></a>baseHandlers | è„‘å›¾</h2><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250220164149032.png?lastModify=1740547033" alt="image-20250220164149032"></p><p><strong>ç›´è¾¾src / baseHandlers.ts</strong></p><h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">function createGetter(isReadonly = false, shallow = false) &#123;</span><br><span class="line">  return function get(target, key, receiver) &#123;</span><br><span class="line">    //è¿™äº›è¾…åŠ©å‡½æ•°ç”¨äºæ£€æŸ¥ key æ˜¯å¦ä¸º ReactiveFlags.RAWï¼Œå¹¶ä¸” receiver æ˜¯å¦ä¸ç›¸åº”çš„æ˜ å°„è¡¨ï¼ˆreactiveMapã€readonlyMap æˆ– shallowReadonlyMapï¼‰ä¸­çš„ç›®æ ‡å¯¹è±¡åŒ¹é…ã€‚</span><br><span class="line">    const isExistInReactiveMap = () =&gt;</span><br><span class="line">      key === ReactiveFlags.RAW &amp;&amp; receiver === reactiveMap.get(target);</span><br><span class="line"></span><br><span class="line">    const isExistInReadonlyMap = () =&gt;</span><br><span class="line">      key === ReactiveFlags.RAW &amp;&amp; receiver === readonlyMap.get(target);</span><br><span class="line"></span><br><span class="line">    const isExistInShallowReadonlyMap = () =&gt;</span><br><span class="line">      key === ReactiveFlags.RAW &amp;&amp; receiver === shallowReadonlyMap.get(target);</span><br><span class="line"></span><br><span class="line">    if (key === ReactiveFlags.IS_REACTIVE) &#123;//è¡¨ç¤ºå¯¹è±¡æ˜¯å¦ä¸ºå“åº”å¼å¯¹è±¡ã€‚</span><br><span class="line">      return !isReadonly;</span><br><span class="line">    &#125; else if (key === ReactiveFlags.IS_READONLY) &#123;</span><br><span class="line">      return isReadonly;</span><br><span class="line">    &#125; else if (//è¡¨ç¤ºå¯¹è±¡æ˜¯å¦ä¸ºåªè¯»å¯¹è±¡ã€‚</span><br><span class="line">      isExistInReactiveMap() ||</span><br><span class="line">      isExistInReadonlyMap() ||</span><br><span class="line">      isExistInShallowReadonlyMap()</span><br><span class="line">    ) &#123;</span><br><span class="line">      return target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å‡è®¾obj=&#123;foo:1&#125; key:foo -&gt; res = 1 reså°±æ˜¯ç›®æ ‡å¯¹è±¡çš„å±æ€§å€¼//</span><br><span class="line">    const res = Reflect.get(target, key, receiver);</span><br><span class="line"></span><br><span class="line">    if (!isReadonly) &#123;//å¦‚æœå¯¹è±¡ä¸æ˜¯åªè¯»çš„ï¼Œè°ƒç”¨ track å‡½æ•°è¿›è¡Œä¾èµ–æ”¶é›†ã€‚åªè¯»å¯¹è±¡ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä¹Ÿå°±ä¸ä¼šè§¦å‘ trigger å‡½æ•°ï¼Œæ‰€ä»¥ä¸éœ€è¦æ”¶é›†ä¾èµ–ã€‚</span><br><span class="line">      // åœ¨è§¦å‘ get çš„æ—¶å€™è¿›è¡Œä¾èµ–æ”¶é›†</span><br><span class="line">      track(target, &quot;get&quot;, key);//è§¦å‘track</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (shallow) &#123;//å¦‚æœæ˜¯æµ…å“åº”å¼æ¨¡å¼ï¼Œç›´æ¥è¿”å›å±æ€§å€¼ï¼Œä¸è¿›è¡Œé€’å½’å¤„ç†</span><br><span class="line">      return res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (isObject(res)) &#123;//å¦‚æœå±æ€§å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ ¹æ® isReadonly çš„å€¼ï¼Œå°†å…¶è½¬æ¢ä¸ºåªè¯»å“åº”å¼å¯¹è±¡æˆ–æ™®é€šå“åº”å¼å¯¹è±¡</span><br><span class="line">      // res ç­‰äº target[key]</span><br><span class="line">      return isReadonly ? readonly(res) : reactive(res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return res;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function createSetter() &#123;</span><br><span class="line">    return function set(target, key, value, receiver) &#123;</span><br><span class="line">         //å‡è®¾obj=&#123;foo:1&#125; key:foo -&gt; valueå¯å˜2//</span><br><span class="line">         //obj=&#123;foo:2&#125;//</span><br><span class="line">        const result = Reflect.set(target, key, value, receiver)//è®¾ç½®å¯¹è±¡çš„å±æ€§å€¼</span><br><span class="line"></span><br><span class="line">        trigger(target, &#x27;set&#x27;, key)//triggerå‡½æ•°ä¼šé€šçŸ¥æ‰€æœ‰ä¾èµ–è¯¥å±æ€§çš„å‰¯ä½œç”¨å‡½æ•°é‡æ–°æ‰§è¡Œï¼Œä»¥ç¡®ä¿å“åº”å¼ç³»ç»Ÿèƒ½å¤Ÿæ­£ç¡®æ›´æ–°ç›¸å…³çš„è§†å›¾æˆ–æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">        return result//è®¾ç½®å®Œæˆï¼Œè¿”å›ç»“æœ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="deleteProperty"><a href="#deleteProperty" class="headerlink" title="deleteProperty"></a>deleteProperty</h3><h3 id="has"><a href="#has" class="headerlink" title="has"></a>has</h3><h3 id="ownKeys"><a href="#ownKeys" class="headerlink" title="ownKeys"></a>ownKeys</h3><h2 id="track-æ”¶é›†ä¾èµ–-è„‘å›¾"><a href="#track-æ”¶é›†ä¾èµ–-è„‘å›¾" class="headerlink" title="track(æ”¶é›†ä¾èµ–) | è„‘å›¾"></a>track(æ”¶é›†ä¾èµ–) | è„‘å›¾</h2><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250220212111915.png?lastModify=1740547033" alt="image-20250220212111915"></p><h3 id="åˆå§‹åŒ–dep"><a href="#åˆå§‹åŒ–dep" class="headerlink" title="åˆå§‹åŒ–dep"></a>åˆå§‹åŒ–dep</h3><p><strong>src / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">export function track(target, type, key) &#123;</span><br><span class="line">    //targetï¼šå“åº”å¼å¯¹è±¡ï¼Œå³è¢«ä»£ç†çš„åŸå§‹å¯¹è±¡ã€‚</span><br><span class="line">    //typeï¼šæ“ä½œç±»å‹ï¼Œä¾‹å¦‚ GETã€SET ç­‰ï¼Œä¸è¿‡åœ¨å½“å‰ä»£ç ä¸­ï¼Œtype å‚æ•°æœªè¢«ä½¿ç”¨ã€‚</span><br><span class="line">    //keyï¼šå“åº”å¼å¯¹è±¡çš„å±æ€§åã€‚</span><br><span class="line">    if (!isTracking()) &#123;//å½“å‰æ˜¯å¦å…è®¸è¿›è¡Œä¾èµ–æ”¶é›†</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(`è§¦å‘ track -&gt; target: $&#123;target&#125; type:$&#123;type&#125; key:$&#123;key&#125;`);</span><br><span class="line">    </span><br><span class="line">    let depsMap = targetMap.get(target);//targetMap æ˜¯ä¸€ä¸ª WeakMapï¼Œç”¨äºå­˜å‚¨æ¯ä¸ªå“åº”å¼å¯¹è±¡å¯¹åº”çš„ depsMap</span><br><span class="line">    if (!depsMap) &#123;// å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡çš„è¯ï¼Œåˆå§‹åŒ– depsMap çš„é€»è¾‘</span><br><span class="line">        depsMap = new Map();// åˆ›å»ºä¸€ä¸ªæ–°çš„ Map å®ä¾‹</span><br><span class="line">        targetMap.set(target, depsMap);//å­˜å‚¨åˆ° targetMap ä¸­</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let dep = depsMap.get(key);//depsMap æ˜¯ä¸€ä¸ª Mapï¼Œå­˜å‚¨æ¯ä¸ªå±æ€§å¯¹åº”çš„ dep</span><br><span class="line">    if (!dep) &#123;</span><br><span class="line">        dep = createDep();//åˆ›å»ºä¸€ä¸ªæ–°çš„ dep å®ä¾‹</span><br><span class="line">        depsMap.set(key, dep);//å­˜å‚¨åˆ° depsMap ä¸­</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    trackEffects(dep);//å°†å½“å‰çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆactiveEffectï¼‰æ·»åŠ åˆ° dep ä¸­ï¼Œå¹¶å°† dep æ·»åŠ åˆ° activeEffect çš„ deps æ•°ç»„ä¸­</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸºäºactiveEffectè·å–å½“å‰ä¾èµ–-dep-push-activeEffect"><a href="#åŸºäºactiveEffectè·å–å½“å‰ä¾èµ–-dep-push-activeEffect" class="headerlink" title="åŸºäºactiveEffectè·å–å½“å‰ä¾èµ– &amp; dep.push(activeEffect)"></a>åŸºäºactiveEffectè·å–å½“å‰ä¾èµ– &amp; dep.push(activeEffect)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export function trackEffects(dep) &#123;</span><br><span class="line">    // å°†å½“å‰æ´»è·ƒçš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆactiveEffectï¼‰æ·»åŠ åˆ°å¯¹åº”çš„ä¾èµ–é›†åˆï¼ˆdepï¼‰ä¸­ï¼ŒåŒæ—¶å°†è¯¥ä¾èµ–é›†åˆæ·»åŠ åˆ°å‰¯ä½œç”¨å‡½æ•°çš„ä¾èµ–åˆ—è¡¨ï¼ˆdepsï¼‰é‡Œã€‚</span><br><span class="line">    if (!dep.has(activeEffect)) &#123;//æ£€æŸ¥æ˜¯å¦å·²æ”¶é›†å‰¯å‡½æ•°</span><br><span class="line">        dep.add(activeEffect);//æ·»åŠ </span><br><span class="line">        (activeEffect as any).deps.push(dep);//æ·»åŠ ä¾èµ–é›†åˆåˆ°å‰¯ä½œç”¨å‡½æ•°çš„ä¾èµ–åˆ—è¡¨</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="trigger-è§¦å‘ä¾èµ–-è„‘å›¾"><a href="#trigger-è§¦å‘ä¾èµ–-è„‘å›¾" class="headerlink" title="trigger(è§¦å‘ä¾èµ–) | è„‘å›¾"></a>trigger(è§¦å‘ä¾èµ–) | è„‘å›¾</h2><p><strong>src / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">export function trigger(target, type, key) &#123;</span><br><span class="line">    // targetï¼šå“åº”å¼å¯¹è±¡ï¼Œå³è¢«ä»£ç†çš„åŸå§‹å¯¹è±¡ã€‚</span><br><span class="line">    // typeï¼šæ“ä½œç±»å‹ï¼Œä¾‹å¦‚ GETã€SET ç­‰ã€‚ä¸è¿‡åœ¨å½“å‰ä»£ç ä¸­ï¼Œæš‚æ—¶åªå¤„ç†äº† GET ç±»å‹ã€‚</span><br><span class="line">    // keyï¼šå“åº”å¼å¯¹è±¡çš„å±æ€§åã€‚</span><br><span class="line">    let deps: Array&lt;any&gt; = [];//å­˜å‚¨æ‰€æœ‰ä¾èµ–è¯¥å±æ€§çš„ä¾èµ–é›†åˆï¼ˆdepï¼‰</span><br><span class="line"></span><br><span class="line">    const depsMap = targetMap.get(target);//ä» targetMap ä¸­è·å– target å¯¹åº”çš„ depsMap</span><br><span class="line"></span><br><span class="line">    if (!depsMap) return;</span><br><span class="line"></span><br><span class="line">    // æš‚æ—¶åªå®ç°äº† GET ç±»å‹</span><br><span class="line">    // get ç±»å‹åªéœ€è¦å–å‡ºæ¥å°±å¯ä»¥</span><br><span class="line">    const dep = depsMap.get(key);</span><br><span class="line"></span><br><span class="line">    deps.push(dep);// æœ€åæ”¶é›†åˆ° deps å†…</span><br><span class="line"></span><br><span class="line">    const effects: Array&lt;any&gt; = [];</span><br><span class="line">    deps.forEach((dep) =&gt; &#123; // è¿™é‡Œè§£æ„ dep å¾—åˆ°çš„æ˜¯ dep å†…éƒ¨å­˜å‚¨çš„ effect</span><br><span class="line">        effects.push(...dep);</span><br><span class="line">    &#125;);</span><br><span class="line">    // è¿™é‡Œçš„ç›®çš„æ˜¯åªæœ‰ä¸€ä¸ª dep ï¼Œè¿™ä¸ªdep é‡Œé¢åŒ…å«æ‰€æœ‰çš„ effect</span><br><span class="line">    // è¿™é‡Œçš„ç›®å‰åº”è¯¥æ˜¯ä¸ºäº† triggerEffects è¿™ä¸ªå‡½æ•°çš„å¤ç”¨</span><br><span class="line">    triggerEffects(createDep(effects));// è§¦å‘è¯¥ä¾èµ–é›†åˆä¸­çš„æ‰€æœ‰å‰¯ä½œç”¨å‡½æ•°é‡æ–°æ‰§è¡Œ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>src / dep.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export function createDep(effects?) &#123;</span><br><span class="line">    // Set æ˜¯ JavaScript ä¸­çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œç±»ä¼¼äºæ•°ç»„ï¼Œä½†æˆå‘˜çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰é‡å¤çš„å€¼ã€‚</span><br><span class="line">    const dep = new Set(effects);// å°†ä¼ å…¥çš„ effects ä½œä¸ºåˆå§‹å€¼å¡«å……åˆ°è¿™ä¸ª Set ä¸­</span><br><span class="line">    return dep;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>src / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export function triggerEffects(dep) &#123; // dep æ˜¯ä¸€ä¸ªå­˜å‚¨å‰¯ä½œç”¨å‡½æ•°çš„é›†åˆï¼Œé€šå¸¸æ˜¯ä¸€ä¸ª Set ç±»å‹ï¼Œç”¨äºè®°å½•ä¾èµ–äºæŸä¸ªå“åº”å¼å¯¹è±¡å±æ€§çš„æ‰€æœ‰å‰¯ä½œç”¨å‡½æ•°ã€‚</span><br><span class="line">    for (const effect of dep) &#123;// éå† dep é›†åˆä¸­çš„æ¯ä¸ªå‰¯ä½œç”¨å‡½æ•° effect</span><br><span class="line">        if (effect.scheduler) &#123;// effect.schedulerå­˜åœ¨</span><br><span class="line">            // scheduler å¯ä»¥è®©ç”¨æˆ·è‡ªå·±é€‰æ‹©è°ƒç”¨çš„æ—¶æœºï¼Œè¿™æ ·å°±å¯ä»¥çµæ´»çš„æ§åˆ¶è°ƒç”¨äº†</span><br><span class="line">            // åœ¨ runtime-core ä¸­ï¼Œå°±æ˜¯ä½¿ç”¨äº† scheduler å®ç°äº†åœ¨ next ticker ä¸­è°ƒç”¨çš„é€»è¾‘</span><br><span class="line">            effect.scheduler();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            effect.run();// ç›´æ¥è°ƒç”¨ effect.run() æ–¹æ³•ï¼Œæ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ã€‚</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="runtime-core-åˆå§‹åŒ–æ ¸å¿ƒ"><a href="#runtime-core-åˆå§‹åŒ–æ ¸å¿ƒ" class="headerlink" title="runtime-core åˆå§‹åŒ–æ ¸å¿ƒ"></a>runtime-core åˆå§‹åŒ–æ ¸å¿ƒ</h1><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p><strong>example / helloWorld</strong></p><p><strong>index.html</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script src=&quot;main.js&quot; type=&quot;module&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><strong>main.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &quot;../../dist/mini-vue.esm-bundler.js&quot;;</span><br><span class="line">import App from &quot;./App.js&quot;;</span><br><span class="line"></span><br><span class="line">const rootContainer = document.querySelector(&quot;#root&quot;);//è·å–æ ¹æ ‡ç­¾èŠ‚ç‚¹</span><br><span class="line">createApp(App).mount(rootContainer); //createApp(ä¼ å…¥æ ¹ç»„ä»¶).mount(ä¼ å…¥æ ¹å®¹å™¨)</span><br></pre></td></tr></table></figure><p><strong>App.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;//ä¸€ä¸ªå¯¹è±¡</span><br><span class="line">    name: &quot;App&quot;,//æ ‡è®°å½“å‰ç»„ä»¶çš„åå­—</span><br><span class="line">    setup(props,context) &#123;&#125;,//ä¸€ä¸ªåœ¨ç»„ä»¶åˆ›å»ºä¹‹å‰æ‰§è¡Œçš„å‡½æ•°ï¼Œå¯ä½¿ç”¨å“åº”å¼æ•°æ®ã€ç”Ÿå‘½å‘¨æœŸé’©å­ã€è®¡ç®—å±æ€§ç­‰</span><br><span class="line"></span><br><span class="line">    render() &#123;//æŠŠtemplateè½¬åŒ–æˆrenderå‡½æ•°ï¼Œä»£è¡¨è¿™ä¸ªç»„ä»¶æƒ³è¦æ¸²æŸ“å‡ºæ¥çš„è§†å›¾</span><br><span class="line">        //tagæ ‡ç­¾å(div)  propså±æ€§å¯¹è±¡  childrenæ•°æ®åŒ…å«äº†(div å…ƒç´ çš„å­èŠ‚ç‚¹)</span><br><span class="line">        return h(&quot;div&quot;, &#123; tId: 1 &#125;, [h(&quot;p&quot;, &#123;&#125;, &quot;ä¸»é¡µ&quot;), h(HelloWorld)]);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="æ¸²æŸ“æµç¨‹è¯¦è§£"><a href="#æ¸²æŸ“æµç¨‹è¯¦è§£" class="headerlink" title="æ¸²æŸ“æµç¨‹è¯¦è§£"></a>æ¸²æŸ“æµç¨‹è¯¦è§£</h2><h3 id="mount-åˆå§‹åŒ–æµç¨‹"><a href="#mount-åˆå§‹åŒ–æµç¨‹" class="headerlink" title="mount åˆå§‹åŒ–æµç¨‹"></a>mount åˆå§‹åŒ–æµç¨‹</h3><blockquote><p><strong>å…ˆè¿›å…¥main.js---è·å–åˆ°æ ¹å®¹å™¨---è§¦å‘createAppå‡½æ•°---è°ƒç”¨createAppå†…éƒ¨Appå¯¹è±¡çš„mountå‡½æ•°---mountå†…éƒ¨åŸºäºä¼ æ¥çš„æ ¹å®¹å™¨ç”Ÿæˆè™šæ‹ŸèŠ‚ç‚¹vnode(ä¸€ä¸ªæ™®é€šå¯¹è±¡ä½†æœ‰å‡ ä¸ªå…³é”®çš„keyï¼Œæœ€å…³é”®çš„æ˜¯æœ‰typeå¯¹è±¡[å’Œä¼ å…¥çš„å¯¹è±¡æ˜¯ä¸€æ ·çš„name|setup|render])</strong></p><p><strong>è°ƒç”¨mountå†…éƒ¨çš„render---è°ƒç”¨å†…éƒ¨patchæ–¹æ³•---è§£æ„å‡ºtypeå¯¹è±¡---switchåˆ¤æ–­typeçš„ç±»å‹ä»è€Œç”¨ä¸åŒçš„æ–¹æ³•å¤„ç†</strong></p><blockquote><p><strong>component</strong> ç»„ä»¶ç±»å‹---è°ƒç”¨processComponent---æ ¹æ®!n1åˆ†æˆåˆå§‹åŒ–oræ›´æ–°</p></blockquote><blockquote><blockquote><p><strong>mountComponent</strong> åˆå§‹åŒ–---æ¨¡æ¿åˆå§‹åŒ–å¯¹è±¡+æŠŠvnodeè™šæ‹ŸèŠ‚ç‚¹æŒ‚åœ¨åˆ°è¯¥å¯¹è±¡ä¸Š---<em><strong>setupComponent</strong></em>---initProps+initSlots+setupStatefulComponentåˆå§‹åŒ–props/slots/setup&amp;å¤„ç†ç»„ä»¶---åœ¨setupStatefulComponentåˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡[è¿˜æ˜¯é‚£ä¸ªä¼ æ¥çš„typeå¯¹è±¡]å°†å…¶ç»‘å®šåˆ°instanceå¯¹è±¡ä¸Š---ä¼ å…¥instanceè§¦å‘setcurrentinstance---handlesetupResultåŸºäºsetupä¸­çš„propså’Œcontextåšå‡ºä¸€å®šçš„å¤„ç†---1.setupè¿”å›ä¸€ä¸ªå‡½æ•°[ä¼šæŠŠå®ƒå½“æˆrenderå‡½æ•°å»å†™] 2.setupè¿”å›ä¸€ä¸ªå¯¹è±¡[èµ‹å€¼,è°ƒç”¨finishComponentSetup,å¦‚æœæ²¡æœ‰renderä¼šå°†Componentçš„renderèµ‹å€¼ç»™å®ƒ]</p></blockquote></blockquote><blockquote><blockquote><p><strong>å¾€å›èµ°èµ°åˆ°</strong><em><strong>setupComponent</strong></em>ï¼Œinstance.updateä½¿ç”¨effectè°ƒç”¨componentUpdateFn---è¯¥å‡½æ•°ä¸­è¦è°ƒç”¨ä¼ æ¥å¯¹è±¡é‡Œçš„renderå‡½æ•°è·å–vnodeå­ç»„ä»¶ç”Ÿæˆå¥½çš„è™šæ‹ŸèŠ‚ç‚¹---åœ¨componentUpdateFnè§¦å‘<em><strong>patch</strong></em>(é€’å½’å›å»äº†)ã€!æ­¤æ—¶å·²ç»å˜æˆ<strong>element</strong>å…ƒç´ ç±»å‹äº†!ã€‘</p></blockquote></blockquote><blockquote><blockquote><p><strong>updateComponent</strong> æ›´æ–°</p></blockquote></blockquote><blockquote><p><strong>element</strong> å…ƒç´ ç±»å‹---è°ƒç”¨processElement---æ ¹æ®!n1åˆ†æˆåˆå§‹åŒ–oræ›´æ–°</p></blockquote><blockquote><blockquote><p><strong>mountElement</strong> åˆå§‹åŒ–(æŠŠè™šæ‹ŸèŠ‚ç‚¹è½¬åŒ–æˆä¸€ä¸ªçœŸå®çš„domå…ƒç´ )---åˆ›å»ºel(çœŸå®çš„element)---[æ–‡æœ¬ç±»å‹è°ƒç”¨hostcreateElement]---[æ•°ç»„ç±»å‹è°ƒç”¨mountChildren]ä¼ å…¥childerèŠ‚ç‚¹,el---éå†æ•°ç»„è§¦å‘<em><strong>patch</strong></em>(é€’å½’)ã€!æ­¤æ—¶æ•°ç»„å…ƒç´ å°±æ˜¯<strong>element</strong>ç±»å‹!ã€‘</p></blockquote></blockquote><blockquote><blockquote><p><strong>ä»ç„¶ä½äºmountElementå‡½æ•°ä¸­,å¦‚æœå…ƒç´ propså­˜åœ¨,éå†è°ƒç”¨****hostPatchProp</strong>(ä¼ å…¥el,key,null,val)---åˆ†ç±»,å†…éƒ¨å¤„ç†è¿˜æ˜¯è°ƒç”¨äº†domå†…éƒ¨çš„API</p></blockquote></blockquote><blockquote><blockquote><p><strong>è¿”å›mountElementå‡½æ•°,ä¸‹ä¸€æ­¥è°ƒç”¨****hostInsert</strong>(el,container[æ ¹ç»„ä»¶])[å°†æ‰€æœ‰çš„ä¸€åˆ‡æ’å›#rootæ ¹å…ƒç´ ç»„ä»¶]åˆ°æ­¤æ‰€æœ‰å…ƒç´ å°±éƒ½åœ¨é¡µé¢ä¸Šå±•ç¤ºå‡ºæ¥äº†ï¼Œä¹Ÿå°±æ˜¯åˆå§‹åŒ–çš„å…¨è¿‡ç¨‹</p></blockquote></blockquote><blockquote><blockquote><p><strong>patchElement</strong></p></blockquote></blockquote></blockquote><blockquote><p>**é€šä¿—æ¥è¯´ï¼š**<em><strong>è°ƒç”¨renderå°±æ˜¯â€œæ‹†ç®±â€çš„è¿‡ç¨‹</strong></em>ç›´åˆ°æŠŠå†…éƒ¨æ‰€æœ‰çš„ç»„ä»¶æ¸²æŸ“åˆ°æµè§ˆå™¨ä¸Š</p></blockquote><h3 id="update-æ›´æ–°æµç¨‹"><a href="#update-æ›´æ–°æµç¨‹" class="headerlink" title="update æ›´æ–°æµç¨‹"></a>update æ›´æ–°æµç¨‹</h3><p><strong>App.js æ ·ä¾‹å˜åŠ¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;//ä¸€ä¸ªå¯¹è±¡</span><br><span class="line">    name: &quot;App&quot;,//æ ‡è®°å½“å‰ç»„ä»¶çš„åå­—</span><br><span class="line">    setup(props,context) &#123;//ä¸€ä¸ªåœ¨ç»„ä»¶åˆ›å»ºä¹‹å‰æ‰§è¡Œçš„å‡½æ•°ï¼Œå¯ä½¿ç”¨å“åº”å¼æ•°æ®ã€ç”Ÿå‘½å‘¨æœŸé’©å­ã€è®¡ç®—å±æ€§ç­‰</span><br><span class="line">        const count = ref(10)</span><br><span class="line">        window.count = count</span><br><span class="line">        </span><br><span class="line">        return&#123;</span><br><span class="line">            count,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    render() &#123;//æŠŠtemplateè½¬åŒ–æˆrenderå‡½æ•°ï¼Œä»£è¡¨è¿™ä¸ªç»„ä»¶æƒ³è¦æ¸²æŸ“å‡ºæ¥çš„è§†å›¾</span><br><span class="line">        //tagæ ‡ç­¾å(div)  propså±æ€§å¯¹è±¡  childrenæ•°æ®åŒ…å«äº†(div å…ƒç´ çš„å­èŠ‚ç‚¹)</span><br><span class="line">        return h(&quot;div&quot;, &#123; tId: 1 &#125;, [h(&quot;p&quot;, &#123;&#125;, &quot;ä¸»é¡µ&quot; + this.count)]);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p><strong>å“åº”å¼çš„å€¼å‘ç”Ÿæ”¹å˜(å“åº”å¼å¯¹è±¡éƒ½åœ¨renderå‡½æ•°å†…)---æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„fn---åˆ¤æ–­æ˜¯å¦åˆå§‹åŒ–---è§¦å‘å½“å‰ç»„ä»¶çš„effectå‡½æ•°æ‰§è¡Œ(instance,update)---è°ƒç”¨renderå‡½æ•°(è·å–å‰åè™šæ‹ŸèŠ‚ç‚¹æ ‘èŠ‚ç‚¹)---è§¦å‘</strong><em><strong>patch</strong></em>(å‰åè™šæ‹ŸèŠ‚ç‚¹æ ‘èŠ‚ç‚¹)---æ ¹æ®!n2åˆ†æˆ<strong>component</strong>ç»„ä»¶ç±»å‹or<strong>element</strong>å…ƒç´ ç±»å‹</p><p><em><em>æ›´æ–°é€»è¾‘ï¼š<strong><em><strong>processXXX</strong></em>ä¸­n1å­˜åœ¨---è¿›å…¥</strong></em>updateXXX</em>**(n1,n2)---å–å‡ºæ–°(n1&amp;n2)è€(n2&amp;{})props---n2.el=n1.el---å¯¹æ¯”props(patchProps)---å¯¹æ¯”children(patchChild)åŒç«¯å¯¹æ¯”ç®—æ³•å®ç°</p></blockquote><h1 id="é€æ­¥æ­å»º"><a href="#é€æ­¥æ­å»º" class="headerlink" title="é€æ­¥æ­å»º"></a>é€æ­¥æ­å»º</h1><h2 id="åˆå§‹åŒ–é¡¹ç›®-æ­å»ºç¯å¢ƒ"><a href="#åˆå§‹åŒ–é¡¹ç›®-æ­å»ºç¯å¢ƒ" class="headerlink" title="åˆå§‹åŒ–é¡¹ç›®+æ­å»ºç¯å¢ƒ"></a>åˆå§‹åŒ–é¡¹ç›®+æ­å»ºç¯å¢ƒ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm install --save-dev jest</span><br><span class="line">pnpm add typescript --save-dev</span><br><span class="line">npx tsc --init</span><br><span class="line">pnpm add --save-dev jest</span><br><span class="line">pnpm i --save-dev @types/node</span><br></pre></td></tr></table></figure><p><strong>æ›¿æ¢ package.json &amp; tsconfig.json</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;jest&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&quot;types&quot;: [&quot;jest&quot;],</span><br><span class="line">&quot;noImplicitAny&quot;: false,//æŠŠanyæŠ¥é”™å¿½ç•¥æ‰</span><br></pre></td></tr></table></figure><p><strong>é…ç½®bableç¯å¢ƒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add --save-dev babel-jest @babel/core @babel/preset-env @babel/preset-typescript</span><br></pre></td></tr></table></figure><p><strong>æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª</strong> <code>babel.config.js</code>æ–‡ä»¶</p><blockquote><p><strong>ä»¥å½“å‰nodeç‰ˆæœ¬åšä¸€ä¸ªè½¬æ¢ | æ”¯æŒTS</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  presets: [</span><br><span class="line">    [&#x27;@babel/preset-env&#x27;, &#123;targets: &#123;node: &#x27;current&#x27;&#125;&#125;],</span><br><span class="line">    &#x27;@babel/preset-typescript&#x27;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>ç¼–å†™æµ‹è¯•æ–‡ä»¶</strong></p><p><strong>reactivity / index.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function sum(a, b) &#123;</span><br><span class="line">    return a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>reactivity / tests / index.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;index&#x27;, () =&gt; &#123;</span><br><span class="line">    expect(1).toBe(1)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>å•æµ‹è¿è¡Œ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm test</span><br></pre></td></tr></table></figure><h2 id="runtime-reactivity-å“åº”å¼ç³»ç»Ÿå®ç°"><a href="#runtime-reactivity-å“åº”å¼ç³»ç»Ÿå®ç°" class="headerlink" title="runtime-reactivity å“åº”å¼ç³»ç»Ÿå®ç°"></a>runtime-reactivity å“åº”å¼ç³»ç»Ÿå®ç°</h2><h3 id="ç¼–å†™å•æµ‹"><a href="#ç¼–å†™å•æµ‹" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h3><h4 id="effect"><a href="#effect" class="headerlink" title="effect"></a>effect</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import &#123; effect &#125; from &#x27;../effect&#x27;</span><br><span class="line">import &#123; reactive &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;effect&#x27;, () =&gt; &#123;</span><br><span class="line">    it.skip(&#x27;effect&#x27;, () =&gt; &#123;</span><br><span class="line">        const user = reactive(&#123;// å“åº”å¼å¯¹è±¡</span><br><span class="line">            age: 10,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        let nextAge</span><br><span class="line">        effect(() =&gt; &#123;//æ”¶é›†ä¾èµ– æ¥æ”¶fn è§¦å‘getæ“ä½œ</span><br><span class="line">            nextAge = user.age + 1</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        expect(nextAge).toBe(11)</span><br><span class="line"></span><br><span class="line">        // update è§¦å‘setæ“ä½œ</span><br><span class="line">        user.age++</span><br><span class="line">        expect(nextAge).toBe(12)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h4><p><strong>reactivity / texts / reactive.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;reactive&#x27;, () =&gt; &#123;</span><br><span class="line">    it(&#x27;reactive&#x27;, () =&gt; &#123;</span><br><span class="line">        const original = &#123; age: 1 &#125;</span><br><span class="line">        const observed = reactive(original)</span><br><span class="line">        expect(observed).not.toBe(original)</span><br><span class="line">        expect(observed.age).toBe(1)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="å®ç°reactive"><a href="#å®ç°reactive" class="headerlink" title="å®ç°reactive"></a>å®ç°reactive</h3><p><strong>tsconfig.json</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;lib&quot;: [&quot;DOM&quot;,&quot;ES6&quot;], </span><br></pre></td></tr></table></figure><p><strong>reactivity / reactive.ts</strong></p><blockquote><p><strong>ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªProxyå¯¹è±¡ï¼Œå®ç° get &amp; set å‡½æ•°</strong></p><blockquote><p><strong>è¯¦è§£ å‡è®¾å¯¹è±¡ä¸º { foo : 1 }</strong></p></blockquote><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target: &#123; foo : 1 &#125;</span><br><span class="line">key: foo</span><br><span class="line">value: 1</span><br></pre></td></tr></table></figure></blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">export function reactive(raw) &#123;</span><br><span class="line">    return new Proxy(raw, &#123;</span><br><span class="line">        get(target, key) &#123;</span><br><span class="line">            const res = Reflect.get(target, key)</span><br><span class="line"></span><br><span class="line">            // TODO:æ”¶é›†ä¾èµ–</span><br><span class="line"></span><br><span class="line">            return res</span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br><span class="line">        set(target, key, value) &#123;</span><br><span class="line">            const res = Reflect.set(target, key, value)</span><br><span class="line">            </span><br><span class="line">            // TODO:è§¦å‘ä¾èµ–</span><br><span class="line"></span><br><span class="line">            return res</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æµ‹è¯• pnpm test reactive</strong></p></blockquote><h3 id="å®ç°effect"><a href="#å®ç°effect" class="headerlink" title="å®ç°effect"></a>å®ç°effect</h3><p><strong>reactivity / effect.ts</strong></p><blockquote><p><strong>ä¼ å…¥ä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°fnï¼Œå“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‡æ–°æ‰§è¡Œfn</strong></p><blockquote><p>**å°è£…ç±»ï¼Œå°† **<code>_fn</code> ç§æœ‰å±æ€§å’Œ <code>run</code> æ–¹æ³•å°è£…åœ¨ä¸€èµ·ï¼Œå¤–éƒ¨ä»£ç åªèƒ½é€šè¿‡ <code>run</code> æ–¹æ³•æ¥æ‰§è¡Œ <code>_fn</code>ï¼Œéšè—å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œæé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§</p></blockquote><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class ReactiveEffect &#123;</span><br><span class="line">private _fn: any</span><br><span class="line"> constructor(fn) &#123;</span><br><span class="line">     this._fn = fn</span><br><span class="line"> &#125;</span><br><span class="line"> run() &#123;</span><br><span class="line">     this._fn()</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export function effect(fn) &#123;</span><br><span class="line">    const _effect = new ReactiveEffect(fn)</span><br><span class="line"></span><br><span class="line">    _effect.run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æµ‹è¯• pnpm test effect</strong></p></blockquote><h3 id="å®ç°reactive-get"><a href="#å®ç°reactive-get" class="headerlink" title="å®ç°reactive-get"></a>å®ç°reactive-get</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">get(target, key) &#123;</span><br><span class="line">    const res = Reflect.get(target, key)</span><br><span class="line"></span><br><span class="line">    track(target, key) //ä¼ å…¥å¯¹è±¡å’Œkey</span><br><span class="line"></span><br><span class="line">    return res</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="track-ä¾èµ–æ”¶é›†"><a href="#track-ä¾èµ–æ”¶é›†" class="headerlink" title="track ä¾èµ–æ”¶é›†"></a>track ä¾èµ–æ”¶é›†</h4><p><strong>reactivity / effect.ts</strong></p><blockquote><p><strong>æ„å»ºä¸€ä¸ªå®¹å™¨ï¼Œå­˜å‚¨ä¾èµ–</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const targetMap = new Map() // å­˜å‚¨ä¾èµ–å…³ç³»</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const targetMap = new Map() // å­˜æ‰€æœ‰ä¾èµ–</span><br><span class="line">export function track(target, key) &#123;</span><br><span class="line">    let depsMap = targetMap.get(target)</span><br><span class="line">    if (!depsMap) &#123;</span><br><span class="line">        depsMap = new Map()</span><br><span class="line">        targetMap.set(target, depsMap)//targetMapç»“æ„[target&lt;obj&gt;, depsMap&lt;map&gt;]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let dep = depsMap.get(key)</span><br><span class="line">    if (!dep) &#123;</span><br><span class="line">        dep = new Set()</span><br><span class="line">        depsMap.set(key, dep)//depsMapç»“æ„[key&lt;key&gt;, dep&lt;ReactiveEffect&gt;]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dep.add(ï¼Ÿ)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¦‚ä½•æ‹¿åˆ°fn</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//å…¨å±€å¯¹è±¡</span><br><span class="line">let activeEffect</span><br><span class="line"></span><br><span class="line">//ReactiveEffectç±»å†…</span><br><span class="line">run() &#123;</span><br><span class="line">    activeEffect = this</span><br><span class="line">    this._fn()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ä¼ å…¥effect</span><br><span class="line">dep.add(activeEffect)</span><br></pre></td></tr></table></figure><h3 id="å®ç°reactive-set"><a href="#å®ç°reactive-set" class="headerlink" title="å®ç°reactive-set"></a>å®ç°reactive-set</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">set(target, key, value) &#123;</span><br><span class="line">    const res = Reflect.set(target, key, value)</span><br><span class="line"></span><br><span class="line">    trigger(target, key) //ä¼ å…¥å¯¹è±¡å’Œkey</span><br><span class="line">    </span><br><span class="line">    return res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="trigger-ä¾èµ–è§¦å‘"><a href="#trigger-ä¾èµ–è§¦å‘" class="headerlink" title="trigger ä¾èµ–è§¦å‘"></a>trigger ä¾èµ–è§¦å‘</h4><p><strong>reactivity / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">export function trigger(target, key) &#123;</span><br><span class="line">    let depsMap = targetMap.get(target)</span><br><span class="line">    if (!depsMap) &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let dep = depsMap.get(key)</span><br><span class="line">    if (!dep) &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dep.forEach((effect) =&gt; &#123;</span><br><span class="line">        effect.run()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æµ‹è¯• pnpm test effect</strong></p></blockquote><h3 id="å®Œå–„effectåŠŸèƒ½"><a href="#å®Œå–„effectåŠŸèƒ½" class="headerlink" title="å®Œå–„effectåŠŸèƒ½"></a>å®Œå–„effectåŠŸèƒ½</h3><h4 id="åŠŸèƒ½å•æµ‹1"><a href="#åŠŸèƒ½å•æµ‹1" class="headerlink" title="åŠŸèƒ½å•æµ‹1"></a>åŠŸèƒ½å•æµ‹1</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;è¿”å›runnerå¯ä»¥è§¦å‘effect&#x27;, () =&gt; &#123;</span><br><span class="line">    let foo = 10</span><br><span class="line">    const runner = effect(() =&gt; &#123;</span><br><span class="line">        foo++</span><br><span class="line">        return foo</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    expect(foo).toBe(11)//åˆ›å»ºeffect - foo++</span><br><span class="line">    const r = runner()//è°ƒç”¨runner - foo++</span><br><span class="line">    expect(foo).toBe(12)</span><br><span class="line">    expect(r).toBe(foo)//è°ƒç”¨runner - foo++</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹effecté€»è¾‘</strong></p><p><em>å®ç°åˆ›å»ºå®ä¾‹æ—¶runä¸€æ¬¡</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export function effect(fn) &#123;</span><br><span class="line">const _effect = new ReactiveEffect(fn)</span><br><span class="line"></span><br><span class="line">_effect.run() //å…ˆæ‰§è¡Œä¸€æ¬¡</span><br><span class="line"></span><br><span class="line">    return _effect.run.bind(_effect)//è¿”å›runå‡½æ•°å¹¶ç»‘å®šthis</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">run() &#123;</span><br><span class="line">    activeEffect = this</span><br><span class="line">    return this._fn()//è¿”å›å€¼</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>**Tipsï¼šæœ‰å…³ *****.bind(...)***</p><p>**ç›´æ¥è¿”å› **<code>_effect.run</code> ä¼šè®© <code>run</code> æ–¹æ³•åœ¨è°ƒç”¨æ—¶ <code>this</code> æŒ‡å‘å‡ºç°é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´ <code>this._fn()</code> æ— æ³•æ­£å¸¸æ‰§è¡Œã€‚</p><p><em>ä¾‹å­</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">class ReactiveEffect &#123;</span><br><span class="line">private _fn: any;</span><br><span class="line">constructor(fn) &#123;</span><br><span class="line">this._fn = fn;</span><br><span class="line">&#125;</span><br><span class="line">run() &#123;</span><br><span class="line">console.log(&#x27;this:&#x27;, this);</span><br><span class="line">this._fn();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function effectWithBind(fn) &#123;// è¿”å› _effect.run.bind(_effect)</span><br><span class="line">const _effect = new ReactiveEffect(fn);</span><br><span class="line">_effect.run();</span><br><span class="line">return _effect.run.bind(_effect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function effectWithoutBind(fn) &#123;// è¿”å› _effect.run</span><br><span class="line">const _effect = new ReactiveEffect(fn);</span><br><span class="line">_effect.run();</span><br><span class="line">return _effect.run;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const boundRun = effectWithBind(f);// ä½¿ç”¨ effectWithBind</span><br><span class="line">boundRun(); // this æŒ‡å‘ _effect å®ä¾‹</span><br><span class="line"></span><br><span class="line">const unboundRun = effectWithoutBind(f);// ä½¿ç”¨ effectWithoutBind</span><br><span class="line">unboundRun(); // this æŒ‡å‘å…¨å±€å¯¹è±¡ï¼ˆåœ¨æµè§ˆå™¨ä¸­æ˜¯ windowï¼‰</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><strong>æµ‹è¯• pnpm test effect</strong></p></blockquote><h4 id="åŠŸèƒ½å•æµ‹2"><a href="#åŠŸèƒ½å•æµ‹2" class="headerlink" title="åŠŸèƒ½å•æµ‹2"></a>åŠŸèƒ½å•æµ‹2</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">it.skip(&quot;scheduler&quot;, () =&gt; &#123;</span><br><span class="line">    // 1. é€šè¿‡ effect çš„ç¬¬äºŒä¸ªå‚æ•°ç»™å®šä¸€ä¸ª scheduler çš„ fn</span><br><span class="line">    // 2. effect ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ è¿˜ä¼šæ‰§è¡Œ fn</span><br><span class="line">    // 3. å½“ å“åº”å¼å¯¹è±¡ set update ä¸ä¼šæ‰§è¡Œ fn è€Œæ˜¯æ‰§è¡Œ scheduler</span><br><span class="line">    // 4. å¦‚æœè¯´å½“æ‰§è¡Œ runner çš„æ—¶å€™ ä¼šå†æ¬¡æ‰§è¡Œ fn</span><br><span class="line">    let dummy</span><br><span class="line">    let run: any</span><br><span class="line">    const scheduler = jest.fn(() =&gt; &#123;</span><br><span class="line">        run = runner</span><br><span class="line">    &#125;)</span><br><span class="line">    const obj = reactive(&#123; foo: 1 &#125;)</span><br><span class="line">    const runner = effect(() =&gt; </span><br><span class="line">&#123; dummy = obj.foo &#125;,</span><br><span class="line">&#123; scheduler &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    expect(scheduler).not.toHaveBeenCalled()//schedulerä¸ä¼šè¢«è°ƒç”¨</span><br><span class="line">    expect(dummy).toBe(1)</span><br><span class="line"></span><br><span class="line">    //å½“å“åº”å¼å¯¹è±¡setæ—¶è°ƒç”¨scheduler,ä½†ä¸ä¼šæ‰§è¡Œfn</span><br><span class="line">    obj.foo++</span><br><span class="line">    expect(scheduler).toHaveBeenCalledTimes(1)</span><br><span class="line">    expect(dummy).toBe(1)</span><br><span class="line"></span><br><span class="line">    //è°ƒç”¨runneræ—¶æ‰§è¡Œfn</span><br><span class="line">    run()</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>æ›´æ–°effectå‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">constructor(fn, public scheduler?) &#123;//æ‹¿åˆ°å¯é€‰å‚æ•°scheduler</span><br><span class="line">    this._fn = fn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function effect(fn, options: any = &#123;&#125;) &#123;</span><br><span class="line">    const scheduler = options.scheduler//æ‹¿åˆ°scheduler</span><br><span class="line">    const _effect = new ReactiveEffect(fn, scheduler)//ç»™ç±»ä¼ å…¥scheduler</span><br><span class="line"></span><br><span class="line">    _effect.run()</span><br><span class="line">    return _effect.run.bind(_effect)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹æ›´æ–°å‡½æ•°triggeré€»è¾‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dep.forEach((effect) =&gt; &#123;</span><br><span class="line">    if (effect.scheduler) &#123;</span><br><span class="line">        effect.scheduler()</span><br><span class="line">        return</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        effect.run()</span><br><span class="line">    &#125;</span><br><span class="line">    effect.run()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test effect</strong></p></blockquote><h4 id="åŠŸèƒ½å•æµ‹3"><a href="#åŠŸèƒ½å•æµ‹3" class="headerlink" title="åŠŸèƒ½å•æµ‹3"></a>åŠŸèƒ½å•æµ‹3</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">it(&quot;stopçš„æ‰§è¡Œé€»è¾‘&quot;, () =&gt; &#123;</span><br><span class="line">    let dummy</span><br><span class="line">    const obj = reactive(&#123; prop: 1 &#125;)</span><br><span class="line">    const runner = effect(() =&gt; &#123;</span><br><span class="line">        dummy = obj.prop</span><br><span class="line">    &#125;)</span><br><span class="line">    obj.prop = 2</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line"></span><br><span class="line">    stop(runner)//åœæ­¢æ‰§è¡Œrunner</span><br><span class="line"></span><br><span class="line">    obj.prop = 3</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line"></span><br><span class="line">    runner()</span><br><span class="line">    expect(dummy).toBe(3)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>reactivity / effect.ts</strong></p><p><strong>å®ç°stopä»£ç </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function stop(runner) &#123;</span><br><span class="line">    runner.effect.stop()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹effectå‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export function effect(fn, options: any = &#123;&#125;) &#123;</span><br><span class="line">    const scheduler = options.scheduler</span><br><span class="line">    const _effect = new ReactiveEffect(fn, scheduler)</span><br><span class="line"></span><br><span class="line">    _effect.run()</span><br><span class="line"></span><br><span class="line">    const runner: any = _effect.run.bind(_effect) //å®šä¹‰runnerå‡½æ•°å¹¶ç»‘å®šthis</span><br><span class="line">    runner.effect = _effect //å°†effectæŒ‚è½½åˆ°runnerä¸Š</span><br><span class="line"></span><br><span class="line">    return runner</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>trackï¼ˆä¾èµ–æ”¶é›†ï¼‰å‡½æ•°æ·»åŠ é€»è¾‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dep.add(activeEffect)</span><br><span class="line">activeEffect.deps.push(dep)</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹effectç±» | æ·»åŠ stopå‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public deps = []</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    this.deps.forEach((dep:any) =&gt; &#123;</span><br><span class="line">        dep.delete(this)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test effect --watch</strong></p></blockquote><p><strong>ä»£ç ä¼˜åŒ–ï¼ˆæŠ½ç¦»æ¸…é™¤é€»è¾‘ &amp; é˜²æŠ–ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">active = true</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    if (this.active) &#123;</span><br><span class="line">        cleanupEffect(this)</span><br><span class="line">        this.active = false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function cleanupEffect(effect) &#123;</span><br><span class="line">    effect.deps.forEach((dep: any) =&gt; &#123;</span><br><span class="line">        dep.delete(effect)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å•æµ‹4"><a href="#åŠŸèƒ½å•æµ‹4" class="headerlink" title="åŠŸèƒ½å•æµ‹4"></a>åŠŸèƒ½å•æµ‹4</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;onStopçš„æ‰§è¡Œé€»è¾‘&#x27;, () =&gt; &#123;</span><br><span class="line">    const obj = reactive(&#123;</span><br><span class="line">        foo: 1,</span><br><span class="line">    &#125;)</span><br><span class="line">    const onStop = jest.fn()//jest.fn() åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿå‡½æ•° onStopï¼Œç”¨äºè®°å½•å…¶è°ƒç”¨æ¬¡æ•°å’Œå‚æ•°</span><br><span class="line">    let dummy</span><br><span class="line">    const runner = effect(</span><br><span class="line">        () =&gt; &#123;</span><br><span class="line">            dummy = obj.foo//å“åº”å¼å¯¹è±¡</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            onStop,//é€‰é¡¹å¯¹è±¡</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    stop(runner)</span><br><span class="line">    expect(onStop).toBeCalledTimes(1)//éªŒè¯ onStop å‡½æ•°æ˜¯å¦è¢«è°ƒç”¨äº†ä¸€æ¬¡</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>reactivity / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//_effect.onStop = options.onStop//è°ƒç”¨ç±»æ–¹æ³•</span><br><span class="line">//Object.assign(_effect, options)//è°ƒç”¨ç±»æ–¹æ³•(ä¼˜åŒ–)</span><br><span class="line">extend(_effect, options)//è°ƒç”¨ç±»æ–¹æ³•(æŠ½ç¦»å°è£…)</span><br></pre></td></tr></table></figure><blockquote><p><strong>Tipï¼šäºŒè€…åŒºåˆ«</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// å‡è®¾ options å¯¹è±¡å¦‚ä¸‹</span><br><span class="line">const options = &#123;</span><br><span class="line">onStop: () =&gt; console.log(&#x27;Effect stopped&#x27;),</span><br><span class="line">someOtherOption: &#x27;value&#x27;</span><br><span class="line">&#125;;</span><br><span class="line">const _effect = new ReactiveEffect(() =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// ä»…èµ‹å€¼ onStop å±æ€§</span><br><span class="line">_effect.onStop = options.onStop;</span><br><span class="line"></span><br><span class="line">console.log(_effect.onStop); // è¾“å‡º: () =&gt; console.log(&#x27;Effect stopped&#x27;)</span><br><span class="line">console.log(_effect.someOtherOption); // è¾“å‡º: undefined</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å¤åˆ¶ options å¯¹è±¡çš„æ‰€æœ‰å±æ€§åˆ° _effect</span><br><span class="line">Object.assign(_effect, options);</span><br><span class="line"></span><br><span class="line">console.log(_effect.onStop); // è¾“å‡º: () =&gt; console.log(&#x27;Effect stopped&#x27;)</span><br><span class="line">console.log(_effect.someOtherOption); // è¾“å‡º: &#x27;value&#x27;</span><br></pre></td></tr></table></figure></blockquote><p><strong>ç»§ç»­æŠ½ç¦»å‡½æ•°</strong></p><p><strong>src / shared (æ”¾ç½®é€šç”¨çš„å·¥å…·å‡½æ•°) / index.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export const extend = Object.assign</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹ç±»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">onStop?: () =&gt; void</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    if (this.active) &#123;</span><br><span class="line">        cleanupEffect(this)</span><br><span class="line">        if (this.onStop) &#123;</span><br><span class="line">            this.onStop()</span><br><span class="line">        &#125;</span><br><span class="line">        this.active = false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°readonlyåŠŸèƒ½"><a href="#å®ç°readonlyåŠŸèƒ½" class="headerlink" title="å®ç°readonlyåŠŸèƒ½"></a>å®ç°readonlyåŠŸèƒ½</h3><h4 id="ç¼–å†™å•æµ‹-1"><a href="#ç¼–å†™å•æµ‹-1" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><p><strong>readonly.spec.ts</strong></p><blockquote><p><strong>åªè¯»å±æ€§åªèƒ½è¯»å–setä¸èƒ½è¢«æ”¹å†™set</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import &#123; readonly &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;readonly&#x27;, () =&gt; &#123;</span><br><span class="line">it(&#x27;readonly&#x27;, () =&gt; &#123;</span><br><span class="line">const original = &#123; foo: 1 &#125;</span><br><span class="line">const wrapped = readonly(original)</span><br><span class="line">expect(wrapped).not.toBe(original) //è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œéè¿”å›åŸå¯¹è±¡</span><br><span class="line">expect(wrapped.foo).toBe(1)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">it(&#x27;warning when call set&#x27;, () =&gt; &#123;</span><br><span class="line">console.warn = jest.fn()</span><br><span class="line">const user = readonly(&#123;</span><br><span class="line">age: 10,</span><br><span class="line">&#125;)</span><br><span class="line">user.age = 11</span><br><span class="line">expect(console.warn).toBeCalled()//è°ƒç”¨äº†console.warn</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>reactive</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export function readonly(raw) &#123;</span><br><span class="line">    return new Proxy(raw, &#123;</span><br><span class="line">        get(target, key) &#123;</span><br><span class="line">            return Reflect.get(target, key)</span><br><span class="line">        &#125;,</span><br><span class="line">        set(target, key, value) &#123;</span><br><span class="line">            console.warn(`key: $&#123;key&#125; set å¤±è´¥ï¼Œå› ä¸º target æ˜¯ readonly çš„`, target)</span><br><span class="line">            return true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æŠ½ç¦» get &amp; set å‡½æ•°</strong></p><p><strong>createGetter</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function createGetter(isReadonly = false, shallow = false) &#123;</span><br><span class="line">    return function get(target, key) &#123;//è¿”å›ä¸€ä¸ªgetå‡½æ•°</span><br><span class="line">        const res = Reflect.get(target, key)</span><br><span class="line">        if (!isReadonly) &#123;</span><br><span class="line">            track(target, key)</span><br><span class="line">        &#125;</span><br><span class="line">        if (shallow) &#123;</span><br><span class="line">            return res</span><br><span class="line">        &#125;</span><br><span class="line">        if (typeof res === &#x27;object&#x27;) &#123;</span><br><span class="line">            return isReadonly ? readonly(res) : reactive(res)</span><br><span class="line">        &#125;</span><br><span class="line">        return res</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>createSetter</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function createSetter(shallow = false) &#123;</span><br><span class="line">    return function set(target, key, value) &#123;</span><br><span class="line">        const res = Reflect.set(target, key, value)</span><br><span class="line">        trigger(target, key)</span><br><span class="line">        return res</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ”¹å†™å‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">export function reactive(raw) &#123;</span><br><span class="line">    return new Proxy(raw, &#123;</span><br><span class="line">        get: createGetter(),</span><br><span class="line">        set: createSetter(),</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function readonly(raw) &#123;</span><br><span class="line">    return new Proxy(raw, &#123;</span><br><span class="line">        get: createGetter(true),</span><br><span class="line">        set(target, key, value) &#123;</span><br><span class="line">            console.warn(`key: $&#123;key&#125; set å¤±è´¥ï¼Œå› ä¸º target æ˜¯ readonly çš„`, target)</span><br><span class="line">            return true</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»§ç»­ä¼˜åŒ–æŠ½ç¦»ç»„ä»¶</strong></p><p><strong>åˆ›å»º baseHanders.ts | å°è£…geté€»è¾‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import &#123; track, trigger &#125; from &#x27;./effect&#x27;</span><br><span class="line"></span><br><span class="line">function createGetter(isReadonly = false) &#123;</span><br><span class="line">return function get(target, key) &#123;</span><br><span class="line">const res = Reflect.get(target, key)</span><br><span class="line">if (!isReadonly) &#123;</span><br><span class="line">track(target, key)</span><br><span class="line">&#125;</span><br><span class="line">return res</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function createSetter() &#123;</span><br><span class="line">return function set(target, key, value) &#123;</span><br><span class="line">const res = Reflect.set(target, key, value)</span><br><span class="line">trigger(target, key)</span><br><span class="line">return res</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const reactiveHandlers = &#123;</span><br><span class="line">get: createGetter(),</span><br><span class="line">set: createSetter(),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const readonlyHandlers = &#123;</span><br><span class="line">get: createGetter(true),</span><br><span class="line">set(target, key, value) &#123;</span><br><span class="line">console.warn(`key: $&#123;key&#125; set å¤±è´¥ï¼Œå› ä¸º target æ˜¯ readonly çš„`, target)</span><br><span class="line">return true</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é‡æ„ reactive &amp; readonly</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactiveHandlers, readonlyHandlers &#125; from &#x27;./baseHanders&#x27;</span><br><span class="line"></span><br><span class="line">function createActiveEffect(raw: any, baseHanders) &#123;</span><br><span class="line">return new Proxy(raw, baseHanders)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function reactive(raw) &#123;</span><br><span class="line">return createActiveEffect(raw, reactiveHandlers)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function readonly(raw) &#123;</span><br><span class="line">return createActiveEffect(raw, readonlyHandlers)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸º createGetter æ·»åŠ ç¼“å­˜æœºåˆ¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const get = createGetter()</span><br><span class="line">const set = createSetter()</span><br><span class="line">const readonlyGet = createGetter(true)</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test readonly --watch</strong></p></blockquote><h3 id="å®ç°-isReactive-isReadonly-åŠŸèƒ½"><a href="#å®ç°-isReactive-isReadonly-åŠŸèƒ½" class="headerlink" title="å®ç° isReactive &amp; isReadonly åŠŸèƒ½"></a>å®ç° isReactive &amp; isReadonly åŠŸèƒ½</h3><h4 id="ç¼–å†™å•æµ‹-2"><a href="#ç¼–å†™å•æµ‹-2" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><p><strong>reactive.spec.ts</strong></p><blockquote><p>**åˆ¤æ–­ä¼ å…¥çš„ **<code>value</code> æ˜¯å¦ä¸ºå“åº”å¼å¯¹è±¡</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;reactive&#x27;, () =&gt; &#123;</span><br><span class="line">    const original = &#123; age: 1 &#125;</span><br><span class="line">    const observed = reactive(original)</span><br><span class="line">    expect(observed).not.toBe(original)</span><br><span class="line">    expect(observed.age).toBe(1)</span><br><span class="line"></span><br><span class="line">    //åˆ¤æ–­æ˜¯å¦æ˜¯å“åº”å¼å¯¹è±¡</span><br><span class="line">    expect(isReactive(observed)).toBe(true)</span><br><span class="line">    expect(isReactive(original)).toBe(false)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>readonly.spec.ts</strong></p><blockquote><p><strong>åˆ¤æ–­æ˜¯å¦æ˜¯åªè¯»å¯¹è±¡</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;readonly&#x27;, () =&gt; &#123;</span><br><span class="line">    const original = &#123; foo: 1 &#125;</span><br><span class="line">    const wrapped = readonly(original)</span><br><span class="line">    expect(wrapped).not.toBe(original) //è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œéè¿”å›åŸå¯¹è±¡</span><br><span class="line">    expect(wrapped.foo).toBe(1)</span><br><span class="line"></span><br><span class="line">    expect(isReadonly(wrapped)).toBe(true)//åˆ¤æ–­æ˜¯å¦æ˜¯åªè¯»å¯¹è±¡</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å®ç°"><a href="#åŠŸèƒ½å®ç°" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h4><p><strong>createGetteræ‹¦æˆªåˆ¤æ–­</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function createGetter(isReadonly = false) &#123;</span><br><span class="line">return function get(target, key) &#123;</span><br><span class="line"></span><br><span class="line">if (key === ReactiveFlags.IS_REACTIVE) &#123;//åˆ¤æ–­æ˜¯å¦æ˜¯å“åº”å¼å¯¹è±¡</span><br><span class="line">return !isReadonly</span><br><span class="line">&#125;else if (key === ReactiveFlags.IS_READONLY) &#123;//åˆ¤æ–­æ˜¯å¦æ˜¯åªè¯»å¯¹è±¡</span><br><span class="line">return isReadonly</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const res = Reflect.get(target, key)</span><br><span class="line">if (!isReadonly) &#123;</span><br><span class="line">track(target, key)</span><br><span class="line">&#125;</span><br><span class="line">return res</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>reactive.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export const enum ReactiveFlags &#123;</span><br><span class="line">IS_REACTIVE = &#x27;__v_isReactive&#x27;,</span><br><span class="line">IS_READONLY = &#x27;__v_isReadonly&#x27;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function isReactive(value) &#123;//åˆ¤æ–­æ˜¯å¦æ˜¯å“åº”å¼å¯¹è±¡</span><br><span class="line">    return !!value[ReactiveFlags.IS_REACTIVE]</span><br><span class="line">&#125;</span><br><span class="line">export function isReadonly(value) &#123;//åˆ¤æ–­æ˜¯å¦æ˜¯åªè¯»å¯¹è±¡</span><br><span class="line">    return !!value[ReactiveFlags.IS_READONLY]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test readonly --watch</strong></p><p><strong>pnpm test reactive --watch</strong></p></blockquote><h3 id="stopåŠŸèƒ½ä¼˜åŒ–"><a href="#stopåŠŸèƒ½ä¼˜åŒ–" class="headerlink" title="stopåŠŸèƒ½ä¼˜åŒ–"></a>stopåŠŸèƒ½ä¼˜åŒ–</h3><h4 id="å½“å‰bug"><a href="#å½“å‰bug" class="headerlink" title="å½“å‰bug"></a>å½“å‰bug</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">it(&quot;stopçš„æ‰§è¡Œé€»è¾‘&quot;, () =&gt; &#123;</span><br><span class="line">    let dummy</span><br><span class="line">    const obj = reactive(&#123; prop: 1 &#125;)</span><br><span class="line">    const runner = effect(() =&gt; &#123;</span><br><span class="line">        dummy = obj.prop</span><br><span class="line">    &#125;)</span><br><span class="line">    obj.prop = 2</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line"></span><br><span class="line">    stop(runner)//åœæ­¢æ‰§è¡Œrunner</span><br><span class="line"></span><br><span class="line">    // obj.prop = 3 åªæ¶‰åŠsetæ“ä½œ</span><br><span class="line">    obj.prop++ //è§¦å‘ get+set</span><br><span class="line">    </span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line"></span><br><span class="line">    runner()</span><br><span class="line">    expect(dummy).toBe(3)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><strong>stop(runner)ä¼šæ ¹æ®è¯¥å“åº”å¼å¯¹è±¡ä¸­activeçš„çŠ¶æ€æ¸…é™¤å®ƒçš„å·²ç»æ”¶é›†çš„æ‰€æœ‰ä¾èµ–</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">effect.deps.forEach((dep: any) =&gt; &#123;</span><br><span class="line">dep.delete(effect)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>**+1è§¦å‘getæ“ä½œä¸€å®šä¼šè§¦å‘trackæ“ä½œé‡æ–°æ”¶é›†ä¾èµ– **</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dep.add(activeEffect)//ä¹‹å‰çš„ä¾èµ–éƒ½ç™½æ¸…äº†</span><br></pre></td></tr></table></figure><p><strong>æ‰€ä»¥stopå‡½æ•°ä¹‹åçš„æ“ä½œä¸åº”è¯¥æ”¶é›†ä¾èµ–ï¼ˆä¸èƒ½è§¦å‘trackæ“ä½œï¼‰</strong></p></blockquote><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><strong>trackæ·»åŠ é€»è¾‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if(!activeEffect || !shouldTrack)&#123;//å¦‚æœæ²¡æœ‰æ¿€æ´»çš„effectæˆ–è€…shouldTrackä¸ºfalseï¼Œç›´æ¥è¿”å›</span><br><span class="line">    return  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//...æ”¶é›†ä¾èµ–</span><br><span class="line"></span><br><span class="line">if (dep.has(activeEffect)) &#123;</span><br><span class="line">    return</span><br><span class="line">&#125;</span><br><span class="line">dep.add(activeEffect)</span><br><span class="line">activeEffect.deps.push(dep)</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹runå‡½æ•°ï¼ˆstopæ ¹æ®activeçŠ¶æ€åŒºåˆ†ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">run() &#123;</span><br><span class="line">    if (!this.active) &#123; // stopçŠ¶æ€ç›´æ¥è¿”å›fn</span><br><span class="line">        return this._fn()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    shouldTrack = true // å…è®¸è¿›è¡Œä¾èµ–æ”¶é›†</span><br><span class="line">    activeEffect = this</span><br><span class="line"></span><br><span class="line">    const res = this._fn() // this._fn() æ‰§è¡Œï¼ŒæœŸé—´è®¿é—®å“åº”å¼å¯¹è±¡çš„å±æ€§ï¼Œè§¦å‘trackä¾èµ–æ”¶é›†</span><br><span class="line"></span><br><span class="line">    shouldTrack = false // ä¾èµ–æ”¶é›†ç»“æŸï¼Œåç»­æ“ä½œä¸ä¼šå†è§¦å‘ä¾èµ–æ”¶é›†ã€‚</span><br><span class="line"></span><br><span class="line">    return res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>cleanupEffectæ·»åŠ é€»è¾‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">effect.deps.length = 0</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test reactive --watch</strong></p></blockquote><h3 id="åµŒå¥—å“åº”å¼è½¬æ¢"><a href="#åµŒå¥—å“åº”å¼è½¬æ¢" class="headerlink" title="åµŒå¥—å“åº”å¼è½¬æ¢"></a>åµŒå¥—å“åº”å¼è½¬æ¢</h3><h4 id="ç¼–å†™å•æµ‹-3"><a href="#ç¼–å†™å•æµ‹-3" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><p><strong>reactive</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;åµŒå¥—å“åº”å¼å¯¹è±¡è½¬æ¢&#x27;, () =&gt; &#123;</span><br><span class="line">    const original = &#123;</span><br><span class="line">        nested: &#123;</span><br><span class="line">            foo: 1</span><br><span class="line">        &#125;,</span><br><span class="line">        array: [&#123; bar: 2 &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">    const observed = reactive(original)</span><br><span class="line">    expect(isReactive(observed.nested)).toBe(true)</span><br><span class="line">    expect(isReactive(observed.array)).toBe(true)</span><br><span class="line">    expect(isReactive(observed.array[0])).toBe(true) </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>readonly</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;readonly&#x27;, () =&gt; &#123;</span><br><span class="line">    const original = &#123; foo: 1, bar: &#123; baz: 2 &#125; &#125;</span><br><span class="line">    const wrapped = readonly(original)</span><br><span class="line"></span><br><span class="line">    expect(wrapped).not.toBe(original) //è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œéè¿”å›åŸå¯¹è±¡</span><br><span class="line">    expect(wrapped.foo).toBe(1)</span><br><span class="line"></span><br><span class="line">    expect(isReadonly(original)).toBe(false)</span><br><span class="line">    expect(isReadonly(original.bar)).toBe(false)</span><br><span class="line">    expect(isReadonly(wrapped)).toBe(true)//åªè¯»</span><br><span class="line">    expect(isReadonly(wrapped.bar)).toBe(true)//åªè¯»</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>baseHanders.ts é€’å½’æ‹¦æˆª</strong></p><blockquote><p><strong>createGetterå‡½æ•°</strong></p><p>**const res = Reflect.get(**<em>target</em>, <em>key</em>)åæ·»åŠ åˆ¤æ–­</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (isObject(res)) &#123;//åˆ¤æ–­æ˜¯å¦æ˜¯å¯¹è±¡</span><br><span class="line">    return isReadonly ? readonly(res) : reactive(res)//è¿”å›åªè¯»å¯¹è±¡æˆ–è€…å“åº”å¼å¯¹è±¡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>shared / index.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export const isObject = (val) =&gt; &#123;</span><br><span class="line">    return val !== null &amp;&amp; typeof val === &#x27;object&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="shallowReadonlyå·¥å…·å‡½æ•°"><a href="#shallowReadonlyå·¥å…·å‡½æ•°" class="headerlink" title="shallowReadonlyå·¥å…·å‡½æ•°"></a>shallowReadonlyå·¥å…·å‡½æ•°</h3><h4 id="ç¼–å†™å•æµ‹-4"><a href="#ç¼–å†™å•æµ‹-4" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><p><strong>shallowReadonly.spec.ts</strong></p><blockquote><p><strong>æ•°æ®å±•ç¤º:ç¡®ä¿å¤–å±‚æ•°æ®ä¸ä¼šè¢«æ„å¤–ä¿®æ”¹ï¼ŒåŒæ—¶å…è®¸åœ¨å¿…è¦æ—¶ä¿®æ”¹åµŒå¥—å¯¹è±¡</strong></p><p><strong>æ€§èƒ½ä¼˜åŒ–:é¿å…å¯¹æ‰€æœ‰åµŒå¥—å¯¹è±¡è¿›è¡Œåªè¯»å¤„ç†</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; isReadonly, shallowReadonly &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;shallowReadonly&#x27;, () =&gt; &#123;</span><br><span class="line">    it(&#x27;shallowReadonly&#x27;, () =&gt; &#123;</span><br><span class="line">        const props = shallowReadonly(&#123; n: &#123; foo: 1 &#125; &#125;)</span><br><span class="line">        expect(isReadonly(props)).toBe(true)//è¡¨å±‚åªè¯»</span><br><span class="line">        expect(isReadonly(props.n)).toBe(false)//å†…éƒ¨æ­£å¸¸</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å®ç°-1"><a href="#åŠŸèƒ½å®ç°-1" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h4><p><strong>reactive.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function shallowReadonly(raw) &#123;</span><br><span class="line">    return createActiveEffect(raw, shallowReadonlyHandlers)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>baseHanders.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const readonlyGet = createGetter(true)</span><br><span class="line">const shallowReadonlyGet = createGetter(true, true)</span><br></pre></td></tr></table></figure><p><strong>createGetteræ”¹å†™</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function createGetter(isReadonly = false, shallow = false)</span><br><span class="line"></span><br><span class="line">if (shallow) &#123;</span><br><span class="line">    return res</span><br><span class="line">&#125;</span><br><span class="line">//ğŸ‘‡åˆ¤æ–­isObjectå‰æ‹¦æˆªğŸ‘†//</span><br><span class="line">if (isObject(res)) &#123;//åˆ¤æ–­æ˜¯å¦æ˜¯å¯¹è±¡</span><br><span class="line">    return isReadonly ? readonly(res) : reactive(res) //è¿”å›åªè¯»å¯¹è±¡æˆ–è€…å“åº”å¼å¯¹è±¡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»§æ‰¿æ”¹å†™è‡ªreadonlyHandlers</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export const shallowReadonlyHandlers = extend(&#123;&#125;, readonlyHandlers, &#123;</span><br><span class="line">    get: shallowReadonlyGet,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="å®ç°isProxyåŠŸèƒ½"><a href="#å®ç°isProxyåŠŸèƒ½" class="headerlink" title="å®ç°isProxyåŠŸèƒ½"></a>å®ç°isProxyåŠŸèƒ½</h3><h4 id="ç¼–å†™å•æµ‹-5"><a href="#ç¼–å†™å•æµ‹-5" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><blockquote><p><strong>åˆ¤æ–­æ˜¯å¦æ˜¯ä»£ç†å¯¹è±¡</strong></p></blockquote><p><strong>reactive &amp; readonly åˆ†åˆ«æ·»åŠ </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(isProxy(observed)).toBe(true)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(isProxy(wrapped)).toBe(true)</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å®ç°-2"><a href="#åŠŸèƒ½å®ç°-2" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function isProxy(value) &#123; //åˆ¤æ–­æ˜¯å¦æ˜¯ä»£ç†å¯¹è±¡</span><br><span class="line">    return isReactive(value) || isReadonly(value)   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°ref"><a href="#å®ç°ref" class="headerlink" title="å®ç°ref"></a>å®ç°ref</h3><h4 id="å¿…çœ‹ï¼šrefä¸-reactiveåŒºåˆ«"><a href="#å¿…çœ‹ï¼šrefä¸-reactiveåŒºåˆ«" class="headerlink" title="å¿…çœ‹ï¼šrefä¸ reactiveåŒºåˆ«"></a>å¿…çœ‹ï¼š<code>ref</code>ä¸ <code>reactive</code>åŒºåˆ«</h4><table><thead><tr><th><strong>reactive</strong></th><th><strong>ref</strong></th></tr></thead><tbody><tr><td><strong>âŒåªæ”¯æŒ****å¯¹è±¡</strong>å’Œ<strong>æ•°ç»„</strong>(å¼•ç”¨æ•°æ®ç±»å‹)</td><td><strong>âœ…æ”¯æŒåŸºæœ¬æ•°æ®ç±»å‹+å¼•ç”¨æ•°æ®ç±»å‹</strong></td></tr><tr><td><strong>âŒé‡æ–°åˆ†é…ä¸€ä¸ªæ–°å¯¹è±¡ä¼šä¸¢å¤±å“åº”æ€§</strong></td><td><strong>âœ…é‡æ–°åˆ†é…ä¸€ä¸ªæ–°å¯¹è±¡****ä¸ä¼š</strong>å¤±å»å“åº”</td></tr><tr><td><strong>âŒå°†å¯¹è±¡ä¼ å…¥å‡½æ•°æ—¶,å¤±å»å“åº”</strong></td><td><strong>âœ…ä¼ å…¥å‡½æ•°æ—¶,ä¸ä¼šå¤±å»å“åº”</strong></td></tr><tr><td><strong>èƒ½ç›´æ¥è®¿é—®å±æ€§</strong></td><td><strong>éœ€è¦ä½¿ç”¨</strong> <code>.value</code>è®¿é—®å±æ€§</td></tr><tr><td><strong>âœ…åœ¨</strong> <code>&lt;script&gt;</code>å’Œ <code>&lt;template&gt;</code>ä¸­æ— å·®åˆ«ä½¿ç”¨</td><td><strong>âŒåœ¨</strong> <code>&lt;script&gt;</code>å’Œ <code>&lt;template&gt;</code>ä½¿ç”¨æ–¹å¼ä¸åŒ(scriptä¸­è¦ <code>.value</code>)</td></tr><tr><td><strong>âŒè§£æ„æ—¶ä¼šä¸¢å¤±å“åº”æ€§,éœ€ä½¿ç”¨toRefs</strong></td><td><strong>âŒè§£æ„å¯¹è±¡æ—¶ä¼šä¸¢å¤±å“åº”æ€§,éœ€ä½¿ç”¨toRefs</strong></td></tr></tbody></table><blockquote><p><strong>refåªä¼ å•å€¼ï¼Œä¸èƒ½ä½¿ç”¨Proxy(Proxyå¯¹å¯¹è±¡èµ·ä½œç”¨)</strong></p><p><strong>refä¸­çš„ä»»ä½•ä¸€ä¸ªç‚¹keyéƒ½è¦å¯¹åº”ä¸€ä¸ªdepï¼Œget&amp;setè¿›è¡Œä¾èµ–æ”¶é›†å’Œè§¦å‘</strong></p></blockquote><h4 id="åŠŸèƒ½å•æµ‹1-1"><a href="#åŠŸèƒ½å•æµ‹1-1" class="headerlink" title="åŠŸèƒ½å•æµ‹1"></a>åŠŸèƒ½å•æµ‹1</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; effect &#125; from &#x27;../effect&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;../ref&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;ref&#x27;, () =&gt; &#123;</span><br><span class="line">    it.only(&#x27;value&#x27;, () =&gt; &#123;</span><br><span class="line">        const a = ref(1)</span><br><span class="line">        expect(a.value).toBe(1)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>ref.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class RefImpl &#123;</span><br><span class="line">    private _value: any;</span><br><span class="line">    constructor(value) &#123;//æ„é€ å‡½æ•°</span><br><span class="line">        this._value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get value() &#123;//è·å–value</span><br><span class="line">        return this._value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // set value() &#123;</span><br><span class="line"></span><br><span class="line">    // &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function ref(value) &#123;</span><br><span class="line">    return new RefImpl(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å•æµ‹2-1"><a href="#åŠŸèƒ½å•æµ‹2-1" class="headerlink" title="åŠŸèƒ½å•æµ‹2"></a>åŠŸèƒ½å•æµ‹2</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;should be reactive&#x27;, () =&gt; &#123;</span><br><span class="line">    const a = ref(1)</span><br><span class="line">    let dummy</span><br><span class="line">    let calls = 0</span><br><span class="line">    effect(() =&gt; &#123;</span><br><span class="line">        calls++</span><br><span class="line">        dummy = a.value</span><br><span class="line">    &#125;)</span><br><span class="line">    expect(calls).toBe(1)//effectæ‰§è¡Œäº†ä¸€æ¬¡</span><br><span class="line">    expect(dummy).toBe(1)</span><br><span class="line">    a.value = 2</span><br><span class="line">    expect(calls).toBe(2)</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line">    // å€¼ç›¸åŒä¸ä¼šè§¦å‘</span><br><span class="line">    a.value = 2</span><br><span class="line">    expect(calls).toBe(2)</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>ref.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">class RefImpl &#123;</span><br><span class="line">    private _value: any //å€¼</span><br><span class="line">    public dep //ä¾èµ–å°±æ˜¯å”¯ä¸€çš„value</span><br><span class="line">    constructor(value) &#123;</span><br><span class="line">        //æ„é€ å‡½æ•°</span><br><span class="line">        this._value = value //å­˜å‚¨å€¼</span><br><span class="line">        this.dep = new Set() //å­˜å‚¨ä¾èµ–</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get value() &#123;</span><br><span class="line">        //è·å–value</span><br><span class="line">        return this._value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    set value(newValue) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function ref(value) &#123;</span><br><span class="line">    return new RefImpl(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å›åˆ°effectæŠ½ç¦» get &amp; set é€»è¾‘ä»£ç å¤ç”¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">trackEffects(dep)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function trackEffects(dep) &#123;</span><br><span class="line">    if (dep.has(activeEffect)) &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    dep.add(activeEffect)</span><br><span class="line">    activeEffect.deps.push(dep)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">triggerEffects(dep)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function triggerEffects(dep) &#123; </span><br><span class="line">dep.forEach((effect) =&gt; &#123;</span><br><span class="line">if (effect.scheduler) &#123;</span><br><span class="line">effect.scheduler()</span><br><span class="line">return</span><br><span class="line">&#125; else &#123;</span><br><span class="line">effect.run()</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ref.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">get value() &#123;</span><br><span class="line">    trackEffects(this.dep) //æ”¶é›†ä¾èµ–</span><br><span class="line">    return this._value //è·å–value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">set value(newValue) &#123;</span><br><span class="line">    this._value = newValue //è®¾ç½®value</span><br><span class="line">    triggerEffects(this.dep) //è§¦å‘ä¾èµ–</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®ç°èµ‹å€¼ç›¸åŒä¸è§¦å‘effectåŠŸèƒ½</strong></p><p><strong>set valueæ·»åŠ </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(Object.is(newValue,this._value)) return //å¦‚æœæ–°å€¼å’Œæ—§å€¼ç›¸ç­‰ï¼Œç›´æ¥è¿”å›</span><br></pre></td></tr></table></figure><p><strong>æŠ½ç¦»å°è£…æˆå·¥å…·å‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function trackRefValue(ref) &#123;</span><br><span class="line">    if (isTracking()) &#123;</span><br><span class="line">        trackEffects(ref.dep)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export const hasChange = (val, newValue) =&gt; &#123;</span><br><span class="line">    return !Object.is(val, newValue)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>get &amp; set valueæ”¹å†™</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get value() &#123;</span><br><span class="line">    trackRefValue(this) //æ”¶é›†ä¾èµ–</span><br><span class="line">    return this._value //è·å–value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set value(newValue) &#123;</span><br><span class="line">    if (hasChange(newValue, this._value)) &#123;//åˆ¤æ–­æ˜¯å¦æœ‰å˜åŒ–</span><br><span class="line">        this._value = newValue //è®¾ç½®value</span><br><span class="line">        triggerEffects(this.dep) //è§¦å‘ä¾èµ–</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å•æµ‹3-1"><a href="#åŠŸèƒ½å•æµ‹3-1" class="headerlink" title="åŠŸèƒ½å•æµ‹3"></a>åŠŸèƒ½å•æµ‹3</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;åµŒå¥—å“åº”&#x27;, () =&gt; &#123;</span><br><span class="line">    const a = ref(&#123;</span><br><span class="line">        count: 1,</span><br><span class="line">    &#125;)</span><br><span class="line">    let dummy</span><br><span class="line">    effect(() =&gt; &#123;</span><br><span class="line">        dummy = a.value.count</span><br><span class="line">    &#125;)</span><br><span class="line">    expect(dummy).toBe(1)</span><br><span class="line">    a.value.count = 2</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><strong>è¦å®ç°åµŒå¥—å°±è®¾è®¡é€’å½’å˜›</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">private _value: any //å€¼</span><br><span class="line">public dep //ä¾èµ–å°±æ˜¯å”¯ä¸€çš„value</span><br><span class="line">private _rawValue: any //åŸå§‹å€¼</span><br><span class="line">constructor(value) &#123;</span><br><span class="line">    this._rawValue = value</span><br><span class="line">    this._value = isObject(value) ? reactive(value) : value //å¦‚æœæ˜¯å¯¹è±¡ï¼Œå°±é€’å½’</span><br><span class="line">    this.dep = new Set() //å­˜å‚¨ä¾èµ–</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">set value(newValue) &#123;</span><br><span class="line">    if (hasChange(newValue, this._rawValue)) &#123;</span><br><span class="line">        //åˆ¤æ–­æ˜¯å¦æœ‰å˜åŒ–</span><br><span class="line">        this._rawValue = newValue</span><br><span class="line">        this._value = isObject(newValue) ? reactive(newValue) : newValue</span><br><span class="line">        triggerEffects(this.dep) //è§¦å‘ä¾èµ–</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»§ç»­ä¼˜åŒ–</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">private _rawValue: any //åŸå§‹å€¼</span><br><span class="line"></span><br><span class="line">set value(newValue) &#123;</span><br><span class="line">    if (hasChange(newValue, this._rawValue)) &#123;</span><br><span class="line">        //åˆ¤æ–­æ˜¯å¦æœ‰å˜åŒ–</span><br><span class="line">        this._rawValue = newValue</span><br><span class="line">        this._value = convert(newValue) //å¦‚æœæ˜¯å¯¹è±¡ï¼Œå°±é€’å½’</span><br><span class="line">        triggerEffects(this.dep) //è§¦å‘ä¾èµ–</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function convert(value) &#123;</span><br><span class="line">    return isObject(value) ? reactive(value) : value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°isRef"><a href="#å®ç°isRef" class="headerlink" title="å®ç°isRef"></a>å®ç°isRef</h3><h4 id="ç¼–å†™å•æµ‹-6"><a href="#ç¼–å†™å•æµ‹-6" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;isRef&#x27;, () =&gt; &#123;</span><br><span class="line">    const a = ref(1)</span><br><span class="line">    const user = &#123;</span><br><span class="line">        age: a,</span><br><span class="line">    &#125;</span><br><span class="line">    expect(isRef(a)).toBe(true)</span><br><span class="line">    expect(isRef(1)).toBe(false)</span><br><span class="line">    expect(isRef(user)).toBe(false)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å®ç°-3"><a href="#åŠŸèƒ½å®ç°-3" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public __v_isRef = true //æ ‡è¯†æ˜¯å¦æ˜¯ref</span><br><span class="line"></span><br><span class="line">export function isRef(ref) &#123;</span><br><span class="line">    return !!ref.__v_isRef//è½¬æ¢ä¸ºå¸ƒå°”å€¼</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°unRef"><a href="#å®ç°unRef" class="headerlink" title="å®ç°unRef"></a>å®ç°unRef</h3><blockquote><p><strong>å¦‚æœå‚æ•°æ˜¯ refï¼Œåˆ™è¿”å›å†…éƒ¨å€¼ï¼Œå¦åˆ™è¿”å›å‚æ•°æœ¬èº«</strong></p></blockquote><h4 id="ç¼–å†™å•æµ‹-7"><a href="#ç¼–å†™å•æµ‹-7" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;unRef&#x27;, () =&gt; &#123;//</span><br><span class="line">    const a = ref(1)</span><br><span class="line">    expect(unRef(a)).toBe(1)</span><br><span class="line">    expect(unRef(1)).toBe(1)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å®ç°-4"><a href="#åŠŸèƒ½å®ç°-4" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function unRef(ref) &#123;</span><br><span class="line">    return isRef(ref) ? ref.value : ref //å¦‚æœæ˜¯refï¼Œå°±è¿”å›valueï¼Œå¦åˆ™è¿”å›åŸå¯¹è±¡   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°proxyRefs"><a href="#å®ç°proxyRefs" class="headerlink" title="å®ç°proxyRefs (?)"></a>å®ç°proxyRefs (?)</h3><h4 id="ç¼–å†™å•æµ‹-8"><a href="#ç¼–å†™å•æµ‹-8" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;proxyRefs&#x27;, () =&gt; &#123;</span><br><span class="line">    const user = &#123;</span><br><span class="line">        age: ref(10),</span><br><span class="line">        name: &#x27;zf&#x27;,</span><br><span class="line">    &#125;</span><br><span class="line">    const proxyUser = proxyRefs(user)</span><br><span class="line">    expect(user.age.value).toBe(10)</span><br><span class="line">    expect(proxyUser.age).toBe(10)//å¯ä»¥çœç•¥.value</span><br><span class="line">    expect(proxyUser.name).toBe(&#x27;zf&#x27;)//å¯ä»¥çœç•¥.value</span><br><span class="line"></span><br><span class="line">    proxyUser.age = 20</span><br><span class="line">    expect(proxyUser.age).toBe(20)</span><br><span class="line">    expect(user.age.value).toBe(20)</span><br><span class="line"></span><br><span class="line">    proxyUser.age = ref(10)</span><br><span class="line">    expect(proxyUser.age).toBe(10)</span><br><span class="line">    expect(user.age.value).toBe(10)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å®ç°-5"><a href="#åŠŸèƒ½å®ç°-5" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h4><blockquote><p><strong>é€»è¾‘ï¼š</strong></p><p><strong>getåˆ°refè¿”å›.valueï¼Œå¦åˆ™ç›´æ¥è¿”å›åŸå¯¹è±¡</strong></p><p><strong>å®ä¾‹å¯¹è±¡è§¦å‘setä¼šè¿é”åŸå¯¹è±¡å€¼æ”¹å˜</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">export function proxyRefs(objectWithRefs) &#123;</span><br><span class="line">    return new Proxy(objectWithRefs, &#123;</span><br><span class="line">        get(target, key) &#123;</span><br><span class="line">            return unRef(Reflect.get(target, key)) //å¦‚æœæ˜¯refï¼Œå°±è¿”å›valueï¼Œå¦åˆ™è¿”å›åŸå¯¹è±¡</span><br><span class="line">        &#125;,</span><br><span class="line">        set(target, key, value) &#123;</span><br><span class="line">            if (isRef(target[key]) &amp;&amp; !isRef(value)) &#123;</span><br><span class="line">                return (target[key].value = value) //å¦‚æœæ˜¯refï¼Œå°±è¿”å›valueï¼Œå¦åˆ™è¿”å›åŸå¯¹è±¡</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return Reflect.set(target, key, value) //å¦‚æœæ˜¯refï¼Œå°±è¿”å›valueï¼Œå¦åˆ™è¿”å›åŸå¯¹è±¡</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°computed"><a href="#å®ç°computed" class="headerlink" title="å®ç°computed"></a>å®ç°computed</h3><blockquote><p>**æ¥å—ä¸€ä¸ª **<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/get#description">getter å‡½æ•°</a>ï¼Œè¿”å›ä¸€ä¸ªåªè¯»çš„å“åº”å¼ <a href="https://cn.vuejs.org/api/reactivity-core.html#ref">ref</a> å¯¹è±¡ã€‚è¯¥ ref é€šè¿‡ <code>.value</code> æš´éœ² getter å‡½æ•°çš„è¿”å›å€¼ã€‚å®ƒä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªå¸¦æœ‰ <code>get</code> å’Œ <code>set</code> å‡½æ•°çš„å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªå¯å†™çš„ ref å¯¹è±¡ã€‚</p></blockquote><h4 id="åŠŸèƒ½å•æµ‹1-2"><a href="#åŠŸèƒ½å•æµ‹1-2" class="headerlink" title="åŠŸèƒ½å•æµ‹1"></a>åŠŸèƒ½å•æµ‹1</h4><p><strong>computed.spec.ts</strong></p><blockquote><p><code>computed</code> å‡½æ•°ä¼šåŸºäºè¿™ä¸ª getter å‡½æ•°åˆ›å»ºä¸€ä¸ªè®¡ç®—å±æ€§ <code>age</code>ï¼Œè¯¥è®¡ç®—å±æ€§çš„å€¼ä¼šæ ¹æ® <code>user.age</code> çš„å˜åŒ–è€Œè‡ªåŠ¨æ›´æ–°ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import &#123; computed &#125; from &#x27;../computed&#x27;</span><br><span class="line">import &#123; reactive &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;computed&#x27;, () =&gt; &#123;</span><br><span class="line">    it(&#x27;computed&#x27;, () =&gt; &#123;</span><br><span class="line">        const user = reactive(&#123;</span><br><span class="line">            age: 1,</span><br><span class="line">        &#125;)</span><br><span class="line">        const age = computed(() =&gt; &#123;</span><br><span class="line">            return user.age</span><br><span class="line">        &#125;)</span><br><span class="line">        expect(age.value).toBe(1)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>computed.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class ComputedRefImpl &#123;</span><br><span class="line">    private _getter: any</span><br><span class="line">    constructor(getter) &#123;</span><br><span class="line">        this._getter = getter</span><br><span class="line">    &#125;</span><br><span class="line">    get value() &#123;</span><br><span class="line">        return this._getter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function computed(getter) &#123;</span><br><span class="line">    return new ComputedRefImpl(getter)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å•æµ‹2-2"><a href="#åŠŸèƒ½å•æµ‹2-2" class="headerlink" title="åŠŸèƒ½å•æµ‹2"></a>åŠŸèƒ½å•æµ‹2</h4><p><strong>computed.spec.ts</strong></p><blockquote><p>**æ¥å—ä¸€ä¸ª **<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/get#description">getter å‡½æ•°</a>ï¼Œè¿”å›ä¸€ä¸ªåªè¯»çš„å“åº”å¼ <a href="https://cn.vuejs.org/api/reactivity-core.html#ref">ref</a> å¯¹è±¡ã€‚è¯¥ ref é€šè¿‡ <code>.value</code> æš´éœ² getter å‡½æ•°çš„è¿”å›å€¼ã€‚å®ƒä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªå¸¦æœ‰ <code>get</code> å’Œ <code>set</code> å‡½æ•°çš„å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªå¯å†™çš„ ref å¯¹è±¡ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;should compute lazily&#x27;, () =&gt; &#123;</span><br><span class="line">    const value = reactive(&#123;</span><br><span class="line">        foo: 1,</span><br><span class="line">    &#125;)</span><br><span class="line">    const getter = jest.fn(() =&gt; &#123;</span><br><span class="line">        return value.foo</span><br><span class="line">    &#125;)</span><br><span class="line">    const cValue = computed(getter)</span><br><span class="line">    expect(getter).not.toHaveBeenCalled()</span><br><span class="line">    expect(cValue.value).toBe(1)</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(1)</span><br><span class="line">    // å†æ¬¡è®¿é—®ï¼Œä¸åº”è¯¥å†è°ƒç”¨</span><br><span class="line">    cValue.value</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(1)</span><br><span class="line">    // ä¸åº”è¯¥å†è°ƒç”¨</span><br><span class="line">    value.foo = 2</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(1)</span><br><span class="line">    // è§¦å‘getter</span><br><span class="line">    expect(cValue.value).toBe(2)</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(2)</span><br><span class="line">    // ä¸åº”è¯¥å†è°ƒç”¨</span><br><span class="line">    cValue.value</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(2)   </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>computed.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ReactiveEffect &#125; from &#x27;./effect&#x27;</span><br><span class="line"></span><br><span class="line">class ComputedRefImpl &#123;</span><br><span class="line">    private _getter: any</span><br><span class="line">    private _value: any</span><br><span class="line">    private _dirty: boolean = true</span><br><span class="line">    private _effect: any</span><br><span class="line">    constructor(getter) &#123;</span><br><span class="line">        this._getter = getter</span><br><span class="line">        this._effect = new ReactiveEffect(getter, () =&gt; &#123;</span><br><span class="line">            if (!this._dirty) &#123;</span><br><span class="line">                this._dirty = true</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    get value() &#123;</span><br><span class="line">        if (this._dirty) &#123;</span><br><span class="line">            this._dirty = false</span><br><span class="line">            this._value = this._effect.run()</span><br><span class="line">        &#125;</span><br><span class="line">        return this._value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function computed(getter) &#123;</span><br><span class="line">    return new ComputedRefImpl(getter)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="runtime-core-åˆå§‹åŒ–æµç¨‹å®ç°"><a href="#runtime-core-åˆå§‹åŒ–æµç¨‹å®ç°" class="headerlink" title="runtime-core åˆå§‹åŒ–æµç¨‹å®ç°"></a>runtime-core åˆå§‹åŒ–æµç¨‹å®ç°</h2><h3 id="æ€»è§ˆå¯¼å›¾"><a href="#æ€»è§ˆå¯¼å›¾" class="headerlink" title="æ€»è§ˆå¯¼å›¾"></a>æ€»è§ˆå¯¼å›¾</h3><blockquote><p><strong>å…¨ç¨‹è·Ÿç€è¿™ä¸ªæµç¨‹å›¾å®ç°</strong></p></blockquote><p><img src="file:///C:/Users/DELL/Downloads/runtime-core.jpg?lastModify=1740547033" alt="runtime-core"></p><p><strong>åˆ›å»ºsrc / runtime-coreæ–‡ä»¶å¤¹</strong></p><blockquote><p><strong>è¿™æ¬¡çš„æµ‹è¯•æ ·ä¾‹æ”¾åœ¨æ ¹ç›®å½•ä¸‹çš„example / helloworld</strong></p></blockquote><h3 id="åˆå§‹åŒ–-component-ä¸»æµç¨‹"><a href="#åˆå§‹åŒ–-component-ä¸»æµç¨‹" class="headerlink" title="åˆå§‹åŒ– component ä¸»æµç¨‹"></a>åˆå§‹åŒ– component ä¸»æµç¨‹</h3><h4 id="æµ‹è¯•æ–‡ä»¶"><a href="#æµ‹è¯•æ–‡ä»¶" class="headerlink" title="æµ‹è¯•æ–‡ä»¶"></a>æµ‹è¯•æ–‡ä»¶</h4><p><strong>example / helloworld / index.html</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">        &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;script src=&quot;main.js&quot; type=&quot;module&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>ä»¥ä¸‹æ–‡ä»¶æ¨¡æ‹ŸVue3</strong></p><p><strong>main.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">createApp(App).mount(&#x27;#app&#x27;)</span><br><span class="line">ğŸ‘‡</span><br><span class="line">createApp(App) + app.mount(&#x27;#app&#x27;)</span><br><span class="line">//åˆ›å»ºä¸€ä¸ªæ ¹ç»„ä»¶App(Vueåº”ç”¨å®ä¾‹)ï¼Œç„¶åå°†å…¶æŒ‚è½½åˆ°&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;ä¸­ï¼Œä»æ­¤è¿™ä¸ª &lt;div&gt; é‡Œçš„å†…å®¹ç”± Vue æ¥ç®¡ï¼ŒVue ä¼šæ ¹æ® App çš„å›¾çº¸ï¼Œåœ¨&lt;div&gt;ä¸­æ¸²æŸ“å‡ºä½ å†™çš„ç»„ä»¶</span><br></pre></td></tr></table></figure><p><strong>App.js</strong></p><blockquote><p><strong>!!! æœ‰å…³è™šæ‹ŸèŠ‚ç‚¹ å…ˆå»çœ‹çœ‹è¿™ç¯‡æ–‡ç« </strong><a href="https://juejin.cn/post/7323031996864446505">vue3è™šæ‹Ÿdomè¯¦è§£(å«æºç ) - æ˜é‡‘</a> !!!</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">export const App = &#123;</span><br><span class="line">    render() &#123;//UIé€»è¾‘</span><br><span class="line">        return h( //Vue ä¸­çš„åˆ›å»ºè™šæ‹Ÿ DOM çš„è¾…åŠ©å‡½æ•°,ç”¨äºåˆ›å»ºè™šæ‹Ÿ DOM èŠ‚ç‚¹,æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š</span><br><span class="line">            &#x27;div&#x27;, //è¦åˆ›å»ºçš„ HTML æ ‡ç­¾åæˆ–ç»„ä»¶é€‰é¡¹å¯¹è±¡.</span><br><span class="line">            &#x27;hi, &#x27; + this.msg //å­èŠ‚ç‚¹,å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„æˆ–å…¶ä»–è™šæ‹Ÿ DOM èŠ‚ç‚¹.</span><br><span class="line">        )</span><br><span class="line">    &#125;,</span><br><span class="line">    setup() &#123;//ç»„åˆå¼ API çš„å…¥å£ç‚¹,ç”¨äºç»„åˆç»„ä»¶çš„é€»è¾‘ï¼Œä¾‹å¦‚å“åº”å¼æ•°æ®ã€ç”Ÿå‘½å‘¨æœŸé’©å­ã€è®¡ç®—å±æ€§ç­‰</span><br><span class="line">        return &#123;</span><br><span class="line">            msg: &#x27;mini-vue&#x27;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŸºç¡€å®ç°"><a href="#åŸºç¡€å®ç°" class="headerlink" title="åŸºç¡€å®ç°"></a>åŸºç¡€å®ç°</h4><p><strong>createApp.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export function createApp(rootComponent: any) &#123; // ä¼ å…¥æ ¹ç»„ä»¶</span><br><span class="line">    return &#123;</span><br><span class="line">        mount(rootContainer: any) &#123; // æŒ‚è½½å›æ ¹å®¹å™¨</span><br><span class="line">            // å…ˆæŠŠæ ¹ç»„ä»¶è½¬æ¢æˆè™šæ‹ŸèŠ‚ç‚¹vnode</span><br><span class="line">            // ä¹‹åæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šåŸºäºvnodeåšå¤„ç†</span><br><span class="line">            const vnode = createVNode(rootComponent)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>vnode.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export function createVNode(type: any, props?: any, children?: any) &#123;</span><br><span class="line">    const vnode = &#123;</span><br><span class="line">        type,// ç±»å‹</span><br><span class="line">        props,// å±æ€§</span><br><span class="line">        children,// å­©å­</span><br><span class="line">        el: null,// å¯¹åº”çš„çœŸå®dom</span><br><span class="line">        component: null,// ç»„ä»¶å®ä¾‹</span><br><span class="line">        key: props?.key,// å”¯ä¸€æ ‡è¯†</span><br><span class="line">        // shapeFlag: getShapeFlag(type), // ç±»å‹æ ‡è¯†</span><br><span class="line">    &#125;</span><br><span class="line">    return vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ·»åŠ renderå‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mount(rootContainer: any) &#123;</span><br><span class="line">    const vnode = createVNode(rootComponent)</span><br><span class="line"></span><br><span class="line">    render(vnode, rootContainer)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><strong>renderer.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createComponentInstance &#125; from &quot;./component&quot;</span><br><span class="line"></span><br><span class="line">export function render(vnode: any, container: any) &#123;</span><br><span class="line">    // è°ƒç”¨patchå‡½æ•°</span><br><span class="line">    patch(vnode, container)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function patch(vnode: any, container: any) &#123;</span><br><span class="line">    if (vnode.shapeFlag === 1) &#123;</span><br><span class="line">        // å¤„ç†element</span><br><span class="line">        processElement(vnode, container)  </span><br><span class="line">    &#125;else if (vnode.shapeFlag === 8) &#123;</span><br><span class="line">        // å¤„ç†component</span><br><span class="line">        processComponent(vnode, container)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function processElement(vnode: any, container: any) &#123;</span><br><span class="line">    mountElement(vnode, container)  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mountElement(vnode: any, container: any) &#123;</span><br><span class="line">    // åˆ›å»ºç»„ä»¶å®ä¾‹å¯¹è±¡</span><br><span class="line">    const instance = createComponentInstance(vnode)</span><br><span class="line"></span><br><span class="line">    // å¤„ç†ç»„ä»¶çš„setup</span><br><span class="line">    setupComponent(instance)</span><br><span class="line"></span><br><span class="line">    // å¤„ç†ç»„ä»¶çš„render</span><br><span class="line">    setupRenderEffect(instance, vnode, container)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>component.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">export function createComponentInstance(vnode: any) &#123;</span><br><span class="line">    const instance = &#123;</span><br><span class="line">        vnode,          // ç»„ä»¶çš„è™šæ‹ŸèŠ‚ç‚¹ï¼ˆè®¾è®¡å›¾ï¼‰</span><br><span class="line">        type: vnode.type, // ç»„ä»¶å®šä¹‰ï¼ˆæ¯”å¦‚ä½ å†™çš„ .vue æ–‡ä»¶ä¸­çš„å¯¹è±¡ï¼‰</span><br><span class="line">        props: vnode.props, // å¤–éƒ¨ä¼ å…¥çš„å±æ€§</span><br><span class="line">        slots: vnode.slots, // æ’æ§½å†…å®¹ï¼ˆç±»ä¼¼ `&lt;template #header&gt;`ï¼‰</span><br><span class="line">        proxy: null,     // ä»£ç†å¯¹è±¡ï¼ˆç”¨äºè®¿é—®æ•°æ®å’Œå±æ€§ï¼‰</span><br><span class="line">    &#125;;</span><br><span class="line">    return instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function setupComponent(instance: any) &#123;</span><br><span class="line">    // åˆå§‹åŒ–ç»„ä»¶</span><br><span class="line">    initProps(instance)</span><br><span class="line">    initSlots(instance)</span><br><span class="line"></span><br><span class="line">    // å¤„ç†ç»„ä»¶çš„setup</span><br><span class="line">    setupStatefulComponent(instance)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function setupStatefulComponent(instance: any) &#123;</span><br><span class="line">    // å…ˆæ‹¿åˆ°ç»„ä»¶</span><br><span class="line">    const Component = instance.type // ç»„ä»¶å®šä¹‰ï¼ˆæ¯”å¦‚ä½ å†™çš„ setup å‡½æ•°ï¼‰</span><br><span class="line"></span><br><span class="line">    // ä»£ç†å¯¹è±¡ï¼ˆç”¨äºè®¿é—®æ•°æ®å’Œå±æ€§ï¼‰</span><br><span class="line">    instance.proxy = new Proxy(instance, &#123;</span><br><span class="line">        get(target, key) &#123;</span><br><span class="line">            const &#123; setup, props &#125; = target</span><br><span class="line"></span><br><span class="line">            if (key in setup) &#123;// ä¼˜å…ˆä» setup è¿”å›å€¼ä¸­æ‰¾</span><br><span class="line">                return setup[key]       </span><br><span class="line">            &#125;   else if (key in props) &#123;// å…¶æ¬¡ä» props ä¸­æ‰¾</span><br><span class="line">                return props[key]</span><br><span class="line">            &#125;</span><br><span class="line">            return Reflect.get(target, key)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)  </span><br><span class="line"></span><br><span class="line">    const &#123; setup &#125; = Component //è§£æ„å‡ºsetup</span><br><span class="line"></span><br><span class="line">    if (setup) &#123;</span><br><span class="line">        setCurrentInstance(instance) // æ ‡è®°â€œå½“å‰å¯¹è±¡æ˜¯è°â€</span><br><span class="line">        const setupResult = setup() // æ‰§è¡Œä½ çš„ setup å‡½æ•°</span><br><span class="line">        setCurrentInstance(null) // æ¸…é™¤æ ‡è®°</span><br><span class="line"></span><br><span class="line">        handleSetupResult(instance, setupResult) // ä¿å­˜ setup è¿”å›å€¼</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        finishComponentSetup(instance) // æ²¡æœ‰ setup ç›´æ¥å®Œæˆåˆå§‹åŒ–</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleSetupResult(instance: any, setupResult: any) &#123;</span><br><span class="line">    if (typeof setupResult === &#x27;object&#x27;) &#123;</span><br><span class="line">        instance.setupState = setupResult; // ä¿å­˜ setup è¿”å›çš„å¯¹è±¡</span><br><span class="line">    &#125;</span><br><span class="line">    finishComponentSetup(instance); // å®Œæˆç»„è£…</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function finishComponentSetup(instance: any) &#123;</span><br><span class="line">    const Component = instance.type;</span><br><span class="line">    // ç¡®å®š render å‡½æ•°ï¼ˆä½ å†™çš„ template ä¼šè¢«ç¼–è¯‘æˆ render å‡½æ•°ï¼‰</span><br><span class="line">    instance.render = Component.render || instance.vnode.render;</span><br><span class="line">    // å‡†å¤‡æ¸²æŸ“ï¼ˆè™šæ‹Ÿ DOM ç”ŸæˆçœŸå® DOMï¼‰</span><br><span class="line">    setupRenderEffect(instance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>renderer.ts ç»§ç»­å®Œå–„é€»è¾‘</strong></p><blockquote><p>**å›è°ƒrenderï¼Œå®ç° â€œæ‹†ç®±â€ **</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function setupRenderEffect(instance: any, vnode: any, container: any) &#123;</span><br><span class="line">    const &#123; proxy &#125; = instance</span><br><span class="line">    const subTree = instance.render.call(proxy) //æ‹¿åˆ°è™šæ‹ŸèŠ‚ç‚¹æ ‘</span><br><span class="line"></span><br><span class="line">    // vnode -&gt; patch</span><br><span class="line">    // vnode -&gt; element -&gt; mountElement</span><br><span class="line">    patch(subTree, container)</span><br><span class="line"></span><br><span class="line">    vnode.el = subTree.el</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-rollup-æ‰“åŒ…åº“"><a href="#ä½¿ç”¨-rollup-æ‰“åŒ…åº“" class="headerlink" title="ä½¿ç”¨ rollup æ‰“åŒ…åº“"></a>ä½¿ç”¨ rollup æ‰“åŒ…åº“</h3><blockquote><p><strong>rollupä¸€èˆ¬ç”¨äºåº“çš„æ‰“åŒ…ï¼Œè€Œwebpackæ›´å¤šç”¨äºåº”ç”¨çš„æ‰“åŒ…</strong></p><blockquote><p><strong>æ„å»ºè¾“å‡ºçš„ä½œç”¨ğŸ‘‡</strong></p></blockquote><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æä¾›å¯¹ä¸åŒæ¨¡å—æ ¼å¼çš„æ”¯æŒï¼Œå¢å¼ºåº“çš„å…¼å®¹æ€§</span><br><span class="line">ä¼˜åŒ–ä»£ç ä½“ç§¯ä¸æ€§èƒ½</span><br><span class="line">ç®€åŒ–åº“çš„åˆ†å‘ä¸ä½¿ç”¨æµç¨‹ï¼Œä¿ƒè¿›ç»„ä»¶å¤ç”¨</span><br><span class="line">å®ç°æŒ‰éœ€åŠ è½½</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><strong>åœ¨ä»¥ä¸‹æ¡ˆä¾‹ä¸­å°±æ„å»ºäº†ä¸¤ç§æ ¼å¼ CommonJS &amp; ES Module çš„æ–‡ä»¶</strong></p></blockquote></blockquote><h4 id="é…ç½®rollup"><a href="#é…ç½®rollup" class="headerlink" title="é…ç½®rollup"></a>é…ç½®rollup</h4><p><strong>å®‰è£…</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install --global rollup</span><br></pre></td></tr></table></figure><p><strong>å®‰è£…å®˜æ–¹ä¾èµ–</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pnpm install @rollup/plugin-typescript --save-dev</span><br><span class="line">pnpm install tslib</span><br></pre></td></tr></table></figure><blockquote><p><strong>åˆ›å»º src / index.ts ä½œä¸º mini-vue çš„å‡ºå…¥å£</strong></p></blockquote><p><strong>rollup.config.js ç¼–å†™è„šæœ¬æ–‡ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import typescript from &#x27;@rollup/plugin-typescript&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    input: &#x27;src/index.ts&#x27;, // å…¥å£æ–‡ä»¶</span><br><span class="line">    output: [</span><br><span class="line">        &#123;</span><br><span class="line">            file: &#x27;lib/guide-mini-vue.cjs.js&#x27;, // è¾“å‡ºçš„ CommonJS æ ¼å¼æ–‡ä»¶</span><br><span class="line">            format: &#x27;cjs&#x27;, // æŒ‡å®šè¾“å‡ºæ ¼å¼ä¸º CommonJS</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            file: &#x27;lib/guide-mini-vue.esm.js&#x27;, // è¾“å‡ºçš„ ES Module æ ¼å¼æ–‡ä»¶</span><br><span class="line">            format: &#x27;es&#x27;, // æŒ‡å®šè¾“å‡ºæ ¼å¼ä¸º ES Module</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    plugins: [</span><br><span class="line">        // æ’ä»¶åˆ—è¡¨</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ„å»ºçš„è¾“å‡ºæ–‡ä»¶å°±æ˜¯libä¸‹çš„ guide-mini-vue.cjs.js &amp; guide-mini-vue.esm.js è¿™ä¸¤ä¸ªæ–‡ä»¶</strong></p></blockquote><p><strong>åœ¨package.jsonä¸­æ‰“å¼€ä¾èµ–</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;jest&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;rollup -c config.js&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><strong>æ›´æ”¹tsconfig.jsonä¾èµ–é¡¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;module&quot;: &quot;esnext&quot;,</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><strong>å¤„ç†srcä¸‹çš„indexæ–‡ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// mini-vue çš„å…¥å£</span><br><span class="line">export * from &#x27;./runtime-core&#x27;</span><br></pre></td></tr></table></figure><p><strong>å†å¤„ç†runtime-coreä¸‹çš„indexæ–‡ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export &#123; createApp &#125; from &quot;./createApp&quot;;</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm build å³å¯æ„å»ºä¸¤ç§æ ¼å¼çš„æ–‡ä»¶</strong></p></blockquote><p><em><strong>è¡¥å……hå‡½æ•°é€»è¾‘</strong></em></p><blockquote><p><strong>å‰æƒ…æè¦</strong></p><p><strong>exampleä¸‹çš„App.jsæ–‡ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">export const App = &#123;</span><br><span class="line"> render() &#123; // UIé€»è¾‘</span><br><span class="line">     return h( // Vue ä¸­çš„åˆ›å»ºè™šæ‹Ÿ DOM çš„è¾…åŠ©å‡½æ•°,ç”¨äºåˆ›å»ºè™šæ‹Ÿ DOM èŠ‚ç‚¹,æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š</span><br><span class="line">         &#x27;div&#x27;, // è¦åˆ›å»ºçš„ HTML æ ‡ç­¾åæˆ–ç»„ä»¶é€‰é¡¹å¯¹è±¡.</span><br><span class="line">         &#123;&#125;, // æ ‡ç­¾å±æ€§,å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„.</span><br><span class="line">         &#x27;hi, &#x27; + this.msg // å­èŠ‚ç‚¹,å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„æˆ–å…¶ä»–è™šæ‹Ÿ DOM èŠ‚ç‚¹.</span><br><span class="line">     )</span><br><span class="line"> &#125;,</span><br><span class="line"> setup() &#123; // ç»„åˆå¼ API çš„å…¥å£ç‚¹,ç”¨äºç»„åˆç»„ä»¶çš„é€»è¾‘ï¼Œä¾‹å¦‚å“åº”å¼æ•°æ®ã€ç”Ÿå‘½å‘¨æœŸé’©å­ã€è®¡ç®—å±æ€§ç­‰</span><br><span class="line">     return &#123;</span><br><span class="line">         msg: &#x27;mini-vue&#x27;,</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p><strong>runtime-core / h.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createVNode &#125; from &quot;./vnode&quot;;</span><br><span class="line"></span><br><span class="line">export function h(type: any, props?: any, children?: any) &#123;</span><br><span class="line">    return createVNode(type, props, children)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>runtime-core / index.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export &#123; createApp &#125; from &#x27;./createApp&#x27;</span><br><span class="line">import &#123; h &#125; from &#x27;./h&#x27;</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm build ç»§ç»­æ„å»ºåˆ° example æµ‹è¯•é¡¹ç›®é‡Œ</strong></p></blockquote><p><strong>ç„¶åå°±å¯ä»¥åœ¨exampleä¸­ç›´æ¥å¼•ç”¨æ„å»ºä¸‹æ¥çš„æ–‡ä»¶</strong></p><p><strong>main.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// vue3</span><br><span class="line">import &#123; createApp &#125; from &#x27;../../lib/guide-mini-vue.esm.js&#x27; // å¯¼å…¥è‡ªå·±æ„å»ºçš„æ–‡ä»¶</span><br><span class="line">import &#123; App &#125; from &#x27;./App.js&#x27;</span><br><span class="line"></span><br><span class="line">createApp(App).mount(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure><p><strong>ç„¶åå°±å¯ä»¥æ‰“å¼€HTMLæ–‡ä»¶äº†</strong></p><h2 id="runtime-dom-å°è£…DOMæ–¹æ³•"><a href="#runtime-dom-å°è£…DOMæ–¹æ³•" class="headerlink" title="runtime-dom å°è£…DOMæ–¹æ³•"></a>runtime-dom å°è£…DOMæ–¹æ³•</h2><h2 id="compiler-core-ç¼–è¯‘é€»è¾‘å’Œç®—æ³•-1"><a href="#compiler-core-ç¼–è¯‘é€»è¾‘å’Œç®—æ³•-1" class="headerlink" title="compiler-core ç¼–è¯‘é€»è¾‘å’Œç®—æ³•"></a>compiler-core ç¼–è¯‘é€»è¾‘å’Œç®—æ³•</h2><h2 id="compiler-sfc-è§£æ-vueç»„ä»¶-1"><a href="#compiler-sfc-è§£æ-vueç»„ä»¶-1" class="headerlink" title="compiler-sfc è§£æ.vueç»„ä»¶"></a>compiler-sfc è§£æ.vueç»„ä»¶</h2><h2 id="compiler-dom-å¤„ç†templateæ ‡ç­¾"><a href="#compiler-dom-å¤„ç†templateæ ‡ç­¾" class="headerlink" title="compiler-dom å¤„ç†templateæ ‡ç­¾"></a>compiler-dom å¤„ç†templateæ ‡ç­¾</h2>]]></content>
      
      
      <categories>
          
          <category> æºç å­¦ä¹  </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>EChartså›¾è¡¨åº“å®æˆ˜</title>
      <link href="/2025/03/08/%E5%B7%A5%E5%85%B7/ECharts%E5%AE%98%E6%96%B9%E5%9B%BE%E8%A1%A8%E5%BA%93CV%E6%95%99%E7%A8%8B/"/>
      <url>/2025/03/08/%E5%B7%A5%E5%85%B7/ECharts%E5%AE%98%E6%96%B9%E5%9B%BE%E8%A1%A8%E5%BA%93CV%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="æœ¬æ–‡é¡¹ç›®ä¸»å¹²ç»“æ„"><a href="#æœ¬æ–‡é¡¹ç›®ä¸»å¹²ç»“æ„" class="headerlink" title="æœ¬æ–‡é¡¹ç›®ä¸»å¹²ç»“æ„"></a>æœ¬æ–‡é¡¹ç›®ä¸»å¹²ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ public</span><br><span class="line">â”‚   â””â”€â”€ data.json        # æ•°æ®æ–‡ä»¶ï¼ˆé™æ€æ‹†åˆ†æ•°æ®æ—¶ä½¿ç”¨ï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ src</span><br><span class="line">â”‚   â”œâ”€â”€ utils           # å·¥å…·</span><br><span class="line">â”‚   â”‚   â””â”€â”€ request.ts  # axiosäºŒæ¬¡å°è£…</span><br><span class="line">â”‚   â”‚</span><br><span class="line">â”‚   â”œâ”€â”€ store              # Piniaä»“åº“</span><br><span class="line">â”‚   â”‚   â””â”€â”€ chartStore.ts  # ç®¡ç†å›¾è¡¨ç›¸å…³çš„æ•°æ®</span><br><span class="line">â”‚   â”‚</span><br><span class="line">â”‚   â”œâ”€â”€ services         # API æœåŠ¡</span><br><span class="line">â”‚   â”‚   â””â”€â”€ api.ts       # æ¨¡æ‹Ÿåç«¯ API è¯·æ±‚</span><br><span class="line">â”‚   â”‚</span><br><span class="line">â”‚   â”œâ”€â”€ components       # ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ chart        # å›¾è¡¨ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ category # å›¾è¡¨åˆ†ç±»</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ rose.vue  # ç«ç‘°å›¾ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ bar.vue   # æŸ±çŠ¶å›¾ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ line.vue  # æŠ˜çº¿å›¾ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ pie.vue   # é¥¼çŠ¶å›¾ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ scaatter  # æ•£ç‚¹å›¾ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”‚   â”‚</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ data     # æ•°æ®å¤„ç†é€»è¾‘</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ chartData.ts # æ•°æ®è·å–å’Œå¤„ç†</span><br><span class="line">â”‚   â”‚   â”‚   â”‚</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ chart.vue # æ‰€æœ‰å›¾è¡¨æ±‡æ€»</span><br><span class="line">â”‚   â”‚   â”‚</span><br><span class="line">â”‚   â”‚   â””â”€â”€ other-components # å…¶ä»–ç»„ä»¶</span><br><span class="line">â”‚   â”‚</span><br><span class="line">â”‚   â”œâ”€â”€ App.vue          # æ ¹ç»„ä»¶</span><br><span class="line">â”‚   â”œâ”€â”€ main.ts          # å…¥å£æ–‡ä»¶</span><br><span class="line">â”‚   â”‚</span><br><span class="line">â”‚   â””â”€â”€ types            # ç±»å‹å®šä¹‰</span><br><span class="line">â”‚       â””â”€â”€ chart.d.ts   # ECharts æ•°æ®ç±»å‹å®šä¹‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ vite.config.ts       # Vite é…ç½®æ–‡ä»¶</span><br><span class="line">â””â”€â”€ package.json         # é¡¹ç›®ä¾èµ–</span><br></pre></td></tr></table></figure><p><a href="https://echarts.apache.org/examples/zh/index.html">Examples - Apache ECharts</a></p><p><strong>Echartså®˜ç½‘â†’æ‰€æœ‰ç¤ºä¾‹â†’é€‰æ‹©éœ€è¦å¯¼å…¥çš„å›¾è¡¨â†’å®Œæ•´ä»£ç </strong></p><p>æœ¬æ–‡ä»¥åŸºç¡€å—ä¸æ ¼å°”ç«ç‘°å›¾ä½œç¤ºä¾‹</p><p><a href="https://echarts.apache.org/examples/zh/editor.html?c=pie-roseType-simple&lang=ts&version=5.5.0">Examples - Apache ECharts</a></p><h3 id="å®˜ç½‘æºç ï¼ˆåŸç”ŸJSï¼‰"><a href="#å®˜ç½‘æºç ï¼ˆåŸç”ŸJSï¼‰" class="headerlink" title="å®˜ç½‘æºç ï¼ˆåŸç”ŸJSï¼‰"></a>å®˜ç½‘æºç ï¼ˆåŸç”ŸJSï¼‰</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> chartDom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>)!;</span><br><span class="line"><span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(chartDom);</span><br><span class="line"><span class="keyword">var</span> option;</span><br><span class="line"></span><br><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">legend</span>: &#123;</span><br><span class="line">    <span class="attr">top</span>: <span class="string">&#x27;bottom&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">toolbox</span>: &#123;</span><br><span class="line">    <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">feature</span>: &#123;</span><br><span class="line">      <span class="attr">mark</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      <span class="attr">dataView</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span>, <span class="attr">readOnly</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      <span class="attr">restore</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      <span class="attr">saveAsImage</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">series</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Nightingale Chart&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">      <span class="attr">radius</span>: [<span class="number">50</span>, <span class="number">250</span>],</span><br><span class="line">      <span class="attr">center</span>: [<span class="string">&#x27;50%&#x27;</span>, <span class="string">&#x27;50%&#x27;</span>],</span><br><span class="line">      <span class="attr">roseType</span>: <span class="string">&#x27;area&#x27;</span>,</span><br><span class="line">      <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">        <span class="attr">borderRadius</span>: <span class="number">8</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">data</span>: [</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">40</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 1&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">38</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 2&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">32</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 3&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">30</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 4&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">28</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 5&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">26</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 6&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">22</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 7&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">18</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 8&#x27;</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">option &amp;&amp; myChart.<span class="title function_">setOption</span>(option);</span><br></pre></td></tr></table></figure><h3 id="è½¬Vueç»„ä»¶ï¼ˆé™æ€æ•°æ®ï¼‰"><a href="#è½¬Vueç»„ä»¶ï¼ˆé™æ€æ•°æ®ï¼‰" class="headerlink" title="è½¬Vueç»„ä»¶ï¼ˆé™æ€æ•°æ®ï¼‰"></a>è½¬Vueç»„ä»¶ï¼ˆé™æ€æ•°æ®ï¼‰</h3><p>rose.vue</p><h4 id="template"><a href="#template" class="headerlink" title="template"></a>template</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div ref=&quot;chartContainer&quot; class=&quot;chart-container&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="script"><a href="#script" class="headerlink" title="script"></a>script</h4><h5 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å…¶ä»–æŒ‰éœ€å¼•å…¥</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onMounted, ref, onUnmounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>; <span class="comment">//æ›´å¤šçš„çœ‹è‡ªå·±éœ€æ±‚</span></span><br></pre></td></tr></table></figure><h5 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h5><p>JSæºç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> chartDom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>)!;</span><br></pre></td></tr></table></figure><p><strong>è½¬vueç»„ä»¶</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å›¾è¡¨å®¹å™¨çš„å¼•ç”¨</span></span><br><span class="line"><span class="keyword">const</span> chartContainer = ref&lt;<span class="title class_">HTMLElement</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><p>JSæºç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(chartDom);</span><br></pre></td></tr></table></figure><p><strong>è½¬vueç»„ä»¶</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰å›¾è¡¨å®ä¾‹</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myChart</span>: echarts.<span class="property">ECharts</span> | <span class="literal">null</span> = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><h5 id="option"><a href="#option" class="headerlink" title="option"></a>option</h5><p>JSæºç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> option;</span><br><span class="line">option = &#123;</span><br><span class="line">    <span class="comment">//è¿™æ®µç›´æ¥å¤åˆ¶è¿‡æ¥//</span></span><br><span class="line">    <span class="attr">legend</span>: &#123;</span><br><span class="line">        <span class="attr">top</span>: <span class="string">&#x27;bottom&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//è¿™æ®µç›´æ¥å¤åˆ¶è¿‡æ¥//</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>è½¬vueç»„ä»¶</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰å›¾è¡¨é€‰é¡¹</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">option</span>: echarts.<span class="property">EChartsOption</span> = &#123;</span><br><span class="line">    <span class="comment">//è¿™æ®µç›´æ¥å¤åˆ¶è¿‡æ¥//</span></span><br><span class="line">    <span class="attr">legend</span>: &#123;</span><br><span class="line">        <span class="attr">top</span>: <span class="string">&#x27;bottom&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//è¿™æ®µç›´æ¥å¤åˆ¶è¿‡æ¥//</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h5><p>JSæºç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">option &amp;&amp; myChart.<span class="title function_">setOption</span>(option);</span><br></pre></td></tr></table></figure><p><strong>è½¬vueç»„ä»¶ï¼ˆä¼˜åŒ–ç‰ˆï¼‰</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–å›¾è¡¨</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!chartContainer.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ– ECharts å®ä¾‹</span></span><br><span class="line">  myChart = echarts.<span class="title function_">init</span>(chartContainer.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®å›¾è¡¨é€‰é¡¹</span></span><br><span class="line">  myChart.<span class="title function_">setOption</span>(option);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œè‡ªåŠ¨è°ƒæ•´å›¾è¡¨å¤§å°</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…ç†å›¾è¡¨å®ä¾‹</span></span><br><span class="line"><span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (myChart) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">    myChart.<span class="title function_">dispose</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰å‡½æ•°ï¼šè°ƒæ•´å›¾è¡¨å¤§å°</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">resizeChart</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (myChart) &#123;</span><br><span class="line">    myChart.<span class="title function_">resize</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="style"><a href="#style" class="headerlink" title="style"></a>style</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.chart-container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>; <span class="comment">/* æ ¹æ®éœ€è¦è°ƒæ•´é«˜åº¦ */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŠ½ç¦»æ•°æ®å†™æ³•ï¼ˆé™æ€æ•°æ®ï¼‰"><a href="#æŠ½ç¦»æ•°æ®å†™æ³•ï¼ˆé™æ€æ•°æ®ï¼‰" class="headerlink" title="æŠ½ç¦»æ•°æ®å†™æ³•ï¼ˆé™æ€æ•°æ®ï¼‰"></a>æŠ½ç¦»æ•°æ®å†™æ³•ï¼ˆé™æ€æ•°æ®ï¼‰</h3><p>ã€æ³¨ï¼šè¿™é‡Œæ˜¯ä»æœ¬åœ°è°ƒç”¨æ•°æ®çš„å†™æ³•ï¼Œéœ€è¦ã€‘</p><h4 id="public-data-json"><a href="#public-data-json" class="headerlink" title="public &#x2F; data.json"></a>public &#x2F; data.json</h4><p>(æ¨¡æ‹Ÿåç«¯ä¼ æ¥çš„æ•°æ®)</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 1&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">38</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 2&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">32</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 3&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 4&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">28</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 5&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">26</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 6&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 7&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 8&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="å›¾è¡¨ç»„ä»¶ä¿®æ”¹"><a href="#å›¾è¡¨ç»„ä»¶ä¿®æ”¹" class="headerlink" title="å›¾è¡¨ç»„ä»¶ä¿®æ”¹"></a>å›¾è¡¨ç»„ä»¶ä¿®æ”¹</h4><p>option &#x2F; series éƒ¨åˆ†</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: [</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">40</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 1&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">38</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 2&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">32</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 3&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">30</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 4&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">28</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 5&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">26</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 6&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">22</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 7&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">18</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 8&#x27;</span> &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>æ”¹ä¸º</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: [], <span class="comment">// åˆå§‹ä¸ºç©ºï¼Œç¨åä» data.json åŠ è½½</span></span><br></pre></td></tr></table></figure><h5 id="æ·»åŠ å¼‚æ­¥åŠ è½½å‡½æ•°"><a href="#æ·»åŠ å¼‚æ­¥åŠ è½½å‡½æ•°" class="headerlink" title="æ·»åŠ å¼‚æ­¥åŠ è½½å‡½æ•°"></a>æ·»åŠ å¼‚æ­¥åŠ è½½å‡½æ•°</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼‚æ­¥åŠ è½½æ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ fetch ä» public/data.json è·å–æ•°æ®</span></span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/data.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ æŠ¥é”™æç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Failed to fetch data&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æå–æ•°æ®</span></span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°† JSON æ•°æ®è½¬æ¢ä¸º ECharts éœ€è¦çš„æ ¼å¼ï¼ˆæ ¹æ®æ•°æ®é”®å€¼å¯¹è‡ªè¡Œä¿®æ”¹ï¼‰</span></span><br><span class="line">        <span class="keyword">const</span> chartData = data.<span class="property">data</span>.<span class="title function_">map</span>(<span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">            <span class="attr">value</span>: item.<span class="property">value</span>,</span><br><span class="line">            <span class="attr">name</span>: item.<span class="property">name</span>,</span><br><span class="line">        &#125;))</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›¿æ¢å›¾è¡¨é€‰é¡¹ä¸­â€˜dataâ€™é¡¹</span></span><br><span class="line">        option.<span class="property">series</span>[<span class="number">0</span>].<span class="property">data</span> = chartData;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœå›¾è¡¨å·²ç»åˆå§‹åŒ–ï¼Œåˆ™é‡æ–°è®¾ç½®é€‰é¡¹</span></span><br><span class="line">        <span class="keyword">if</span> (myChart) &#123;</span><br><span class="line">            myChart.<span class="title function_">setOption</span>(option);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading data:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="è°ƒç”¨å‡½æ•°-loadData"><a href="#è°ƒç”¨å‡½æ•°-loadData" class="headerlink" title="è°ƒç”¨å‡½æ•° loadData"></a>è°ƒç”¨å‡½æ•° loadData</h5><p>åœ¨ onMounted ä¸­çš„ setOption å</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!chartContainer.<span class="property">value</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– ECharts å®ä¾‹</span></span><br><span class="line">    myChart = echarts.<span class="title function_">init</span>(chartContainer.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å›¾è¡¨é€‰é¡¹</span></span><br><span class="line">    myChart.<span class="title function_">setOption</span>(option)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ è½½æ•°æ®å¹¶æ›´æ–°å›¾è¡¨</span></span><br><span class="line">    <span class="title function_">loadData</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œè‡ªåŠ¨è°ƒæ•´å›¾è¡¨å¤§å°</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="çœŸå®å‰åç«¯å¯¹æ¥ï¼ˆåŠ¨æ€è¯·æ±‚ï¼‰"><a href="#çœŸå®å‰åç«¯å¯¹æ¥ï¼ˆåŠ¨æ€è¯·æ±‚ï¼‰" class="headerlink" title="çœŸå®å‰åç«¯å¯¹æ¥ï¼ˆåŠ¨æ€è¯·æ±‚ï¼‰"></a>çœŸå®å‰åç«¯å¯¹æ¥ï¼ˆåŠ¨æ€è¯·æ±‚ï¼‰</h3><h4 id="ä½¿ç”¨-axios"><a href="#ä½¿ç”¨-axios" class="headerlink" title="ä½¿ç”¨ axios"></a>ä½¿ç”¨ <code>axios</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install axios</span><br></pre></td></tr></table></figure><h5 id="axiosäºŒæ¬¡å°è£…"><a href="#axiosäºŒæ¬¡å°è£…" class="headerlink" title="axiosäºŒæ¬¡å°è£…"></a>axiosäºŒæ¬¡å°è£…</h5><p>æ¨¡æ¿</p><p><code>src/utils/request.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios, &#123; <span class="title class_">AxiosInstance</span>, <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span>; <span class="comment">// Element Plus ç»„ä»¶ï¼ˆä¸»è¦æ˜¯ä½¿ç”¨Messageæ¶ˆæ¯å¼¹å‡ºæ¡†ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span>; <span class="comment">// å¼•å…¥ Pinia Store</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span>; <span class="comment">// å¼•å…¥ Vue Router</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º axios å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">service</span>: <span class="title class_">AxiosInstance</span> = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_API_BASE_URL</span> || <span class="string">&#x27;/&#x27;</span>, <span class="comment">// ä»ç¯å¢ƒå˜é‡ä¸­è·å– API åŸºç¡€è·¯å¾„</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span>, <span class="comment">// è¯·æ±‚è¶…æ—¶æ—¶é—´</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚æ‹¦æˆªå™¨</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åœ¨å‘é€è¯·æ±‚ä¹‹å‰åšäº›ä»€ä¹ˆ</span></span><br><span class="line">    <span class="comment">// ä¾‹å¦‚ï¼Œæ·»åŠ èº«ä»½éªŒè¯ token</span></span><br><span class="line">    <span class="keyword">const</span> token = store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">token</span>; <span class="comment">// å‡è®¾ä½ æœ‰ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨ Pinia ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      config.<span class="property">headers</span>[<span class="string">&#x27;Authorization&#x27;</span>] = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å“åº”æ‹¦æˆªå™¨</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹å“åº”æ•°æ®åšç‚¹ä»€ä¹ˆ</span></span><br><span class="line">    <span class="keyword">const</span> res = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ¥å£è¿”å›çš„çŠ¶æ€ç ä¸æ˜¯ 200ï¼Œè¯´æ˜è¯·æ±‚å¤±è´¥</span></span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">code</span> !== <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(res.<span class="property">message</span> || <span class="string">&#x27;Error&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(res.<span class="property">message</span> || <span class="string">&#x27;Error&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹å“åº”é”™è¯¯åšç‚¹ä»€ä¹ˆ</span></span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">response</span>) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (error.<span class="property">response</span>.<span class="property">status</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">401</span>:</span><br><span class="line">          <span class="comment">// æ¸…é™¤ Token å¹¶è·³è½¬åˆ°ç™»å½•é¡µé¢</span></span><br><span class="line">          store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/logout&#x27;</span>);</span><br><span class="line">          router.<span class="title function_">push</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">403</span>:</span><br><span class="line">          <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;Forbidden&#x27;</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">404</span>:</span><br><span class="line">          <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;Not Found&#x27;</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">500</span>:</span><br><span class="line">          <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;Server Error&#x27;</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">          <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;Network Error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡ <code>import request from &#39;@/utils/request&#39;</code> æ¥ä½¿ç”¨å°è£…åçš„ axios å®ä¾‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="å‡½æ•°-loadDataä¿®æ”¹"><a href="#å‡½æ•°-loadDataä¿®æ”¹" class="headerlink" title="å‡½æ•° loadDataä¿®æ”¹"></a>å‡½æ•° loadDataä¿®æ”¹</h5><p>é™æ€è·å–</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">loadData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">/////æ›´æ”¹å¤„////</span></span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/data.json&#x27;</span>) <span class="comment">// ä½¿ç”¨ fetch ä» public/data.json è·å–æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Failed to fetch data&#x27;</span>) &#125;</span><br><span class="line">        <span class="comment">/////æ›´æ”¹å¤„////</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>()</span><br><span class="line">        ......</span><br></pre></td></tr></table></figure><p>åŠ¨æ€å¯¹æ¥</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">/////æ›´æ”¹å¤„////</span></span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/api/data&#x27;</span>); <span class="comment">// å‡è®¾åç«¯ API åœ°å€ä¸º /api/data</span></span><br><span class="line">        <span class="comment">/////æ›´æ”¹å¤„////</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">const</span> data = response.<span class="property">data</span>;</span><br><span class="line">        ......</span><br></pre></td></tr></table></figure><h4 id="PiniaçŠ¶æ€ç®¡ç†"><a href="#PiniaçŠ¶æ€ç®¡ç†" class="headerlink" title="PiniaçŠ¶æ€ç®¡ç†"></a>PiniaçŠ¶æ€ç®¡ç†</h4><p>å¦‚æœä½ çš„åº”ç”¨ä¸­æœ‰å¤šä¸ªç»„ä»¶éœ€è¦å…±äº«æ•°æ®ï¼ˆä¾‹å¦‚å¤šä¸ªå›¾è¡¨å…±äº«åŒä¸€ä»½æ•°æ®ï¼‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Vuex æˆ– Pinia è¿›è¡ŒçŠ¶æ€ç®¡ç†ã€‚è¿™æ ·å¯ä»¥é¿å…é‡å¤çš„ API è¯·æ±‚ï¼Œå¹¶ä¸”æ›´å®¹æ˜“ç®¡ç†æ•°æ®æµã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install pinia</span><br></pre></td></tr></table></figure><h5 id="åœ¨-main-ts-ä¸­æ³¨å†ŒPinia"><a href="#åœ¨-main-ts-ä¸­æ³¨å†ŒPinia" class="headerlink" title="åœ¨ main.ts ä¸­æ³¨å†ŒPinia"></a>åœ¨ <code>main.ts</code> ä¸­æ³¨å†ŒPinia</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œ Pinia</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">createPinia</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œ Vue Router å’Œ Element Plus</span></span><br><span class="line">app.<span class="title function_">use</span>(router);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure><h5 id="chartStore-ts"><a href="#chartStore-ts" class="headerlink" title="chartStore.ts"></a><code>chartStore.ts</code></h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ChartState</span> &#123;</span><br><span class="line">    <span class="attr">chartData</span>: <span class="title class_">Array</span>&lt;&#123; <span class="attr">value</span>: <span class="built_in">number</span>; <span class="attr">name</span>: <span class="built_in">string</span> &#125;&gt;;</span><br><span class="line">    <span class="attr">isLoading</span>: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">error</span>: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useChartStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;chart&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">state</span>: (): <span class="function"><span class="params">ChartState</span> =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">chartData</span>: [], <span class="comment">// å›¾è¡¨æ•°æ®</span></span><br><span class="line">        <span class="attr">isLoading</span>: <span class="literal">false</span>, <span class="comment">// åŠ è½½çŠ¶æ€</span></span><br><span class="line">        <span class="attr">error</span>: <span class="literal">null</span>, <span class="comment">// é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">fetchChartData</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">error</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> response = <span class="keyword">await</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/data&#x27;</span>); <span class="comment">// å‡è®¾åç«¯ API åœ°å€ä¸º /api/data</span></span><br><span class="line">                <span class="keyword">const</span> data = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å°† JSON æ•°æ®è½¬æ¢ä¸º ECharts éœ€è¦çš„æ ¼å¼</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">chartData</span> = data.<span class="title function_">map</span>(<span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">                    <span class="attr">value</span>: item.<span class="property">sales</span>,</span><br><span class="line">                    <span class="attr">name</span>: item.<span class="property">category</span>,</span><br><span class="line">                &#125;));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">error</span> = <span class="string">&#x27;Failed to load chart data&#x27;</span>;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading data:&#x27;</span>, error);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥åœ¨ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨ç°æˆçš„æ•°æ®é€»è¾‘äº†</p><h5 id="rose-vue"><a href="#rose-vue" class="headerlink" title="rose.vue"></a><code>rose.vue</code></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    import &#123; onMounted, onUnmounted, ref, watch &#125; from &#x27;vue&#x27;;</span><br><span class="line">    import * as echarts from &#x27;echarts&#x27;;</span><br><span class="line">    import &#123; useChartStore &#125; from &#x27;@/store/chartStore&#x27;;// è°ƒç”¨è‡ªå®šä¹‰Store</span><br><span class="line"></span><br><span class="line">    const chartContainer = ref&lt;HTMLElement | null&gt;(null);</span><br><span class="line">    let myChart: echarts.ECharts | null = null;</span><br><span class="line"></span><br><span class="line">    // è·å– Pinia Store</span><br><span class="line">    const chartStore = useChartStore();</span><br><span class="line"></span><br><span class="line">    // å®šä¹‰å›¾è¡¨é€‰é¡¹</span><br><span class="line">    const option: echarts.EChartsOption = &#123;</span><br><span class="line">        legend: &#123;</span><br><span class="line">            top: &#x27;bottom&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">        toolbox: &#123;</span><br><span class="line">            show: true,</span><br><span class="line">            feature: &#123;</span><br><span class="line">                mark: &#123; show: true &#125;,</span><br><span class="line">                dataView: &#123; show: true, readOnly: false &#125;,</span><br><span class="line">                restore: &#123; show: true &#125;,</span><br><span class="line">                saveAsImage: &#123; show: true &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        series: [</span><br><span class="line">            &#123;</span><br><span class="line">                name: &#x27;é”€é‡&#x27;,</span><br><span class="line">                type: &#x27;pie&#x27;,</span><br><span class="line">                radius: [50, 250],</span><br><span class="line">                center: [&#x27;50%&#x27;, &#x27;50%&#x27;],</span><br><span class="line">                roseType: &#x27;area&#x27;,</span><br><span class="line">                itemStyle: &#123;</span><br><span class="line">                    borderRadius: 8,</span><br><span class="line">                &#125;,</span><br><span class="line">                data: [], // åˆå§‹ä¸ºç©ºï¼Œç¨åä» Pinia Store è·å–</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // ç›‘å¬ Pinia Store ä¸­çš„æ•°æ®å˜åŒ–</span><br><span class="line">    watch(</span><br><span class="line">        () =&gt; chartStore.chartData,</span><br><span class="line">        (newData) =&gt; &#123;</span><br><span class="line">            if (myChart &amp;&amp; newData.length &gt; 0) &#123;</span><br><span class="line">                option.series[0].data = newData;</span><br><span class="line">                myChart.setOption(option);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">        if (!chartContainer.value) return;</span><br><span class="line">        // åˆå§‹åŒ– ECharts å®ä¾‹</span><br><span class="line">        myChart = echarts.init(chartContainer.value);</span><br><span class="line">        // è®¾ç½®åˆå§‹å›¾è¡¨é€‰é¡¹ï¼ˆæ­¤æ—¶ series.data ä¸ºç©ºï¼‰</span><br><span class="line">        myChart.setOption(option);</span><br><span class="line">        // åŠ è½½æ•°æ®</span><br><span class="line">        chartStore.fetchChartData();</span><br><span class="line">        // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œè‡ªåŠ¨è°ƒæ•´å›¾è¡¨å¤§å°</span><br><span class="line">        window.addEventListener(&#x27;resize&#x27;, resizeChart);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // åœ¨ç»„ä»¶å¸è½½æ—¶ç§»é™¤äº‹ä»¶ç›‘å¬å™¨</span><br><span class="line">    onUnmounted(() =&gt; &#123;</span><br><span class="line">        if (myChart) &#123;</span><br><span class="line">            window.removeEventListener(&#x27;resize&#x27;, resizeChart);</span><br><span class="line">            myChart.dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // è‡ªå®šä¹‰å‡½æ•°ï¼šè°ƒæ•´å›¾è¡¨å¤§å°</span><br><span class="line">    const resizeChart = () =&gt; &#123;</span><br><span class="line">        if (myChart) &#123;</span><br><span class="line">            myChart.resize();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h5 id="æ›´å¤šç»„ä»¶"><a href="#æ›´å¤šç»„ä»¶" class="headerlink" title="æ›´å¤šç»„ä»¶"></a>æ›´å¤šç»„ä»¶</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ ¹æ®ä¸Šè¿°æ­¥éª¤å®ç°å®˜ç½‘æºç è½¬Vueç»„ä»¶ï¼Œæ’å…¥åˆ°category #å›¾è¡¨åˆ†ç±» æ–‡ä»¶å¤¹ä¸‹å³å¯</span><br></pre></td></tr></table></figure><h4 id="åŠ è½½åŠ¨ç”»è®¾ç½®"><a href="#åŠ è½½åŠ¨ç”»è®¾ç½®" class="headerlink" title="åŠ è½½åŠ¨ç”»è®¾ç½®"></a>åŠ è½½åŠ¨ç”»è®¾ç½®</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!chartContainer.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ– ECharts å®ä¾‹</span></span><br><span class="line">  myChart = echarts.<span class="title function_">init</span>(chartContainer.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ˜¾ç¤ºåŠ è½½åŠ¨ç”»</span></span><br><span class="line">  myChart.<span class="title function_">showLoading</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŠ è½½æ•°æ®å¹¶æ›´æ–°å›¾è¡¨</span></span><br><span class="line">  <span class="title function_">loadData</span>().<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½éšè—åŠ è½½åŠ¨ç”»</span></span><br><span class="line">    myChart?.<span class="title function_">hideLoading</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œè‡ªåŠ¨è°ƒæ•´å›¾è¡¨å¤§å°</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–"><a href="#ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–"></a>ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–</h4><h5 id="ç¼“å­˜æ•°æ®"><a href="#ç¼“å­˜æ•°æ®" class="headerlink" title="ç¼“å­˜æ•°æ®"></a>ç¼“å­˜æ•°æ®</h5><p>å¦‚æœæ•°æ®ä¸ä¼šé¢‘ç¹å˜åŒ–ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶ï¼ˆå¦‚ localStorage æˆ– sessionStorageï¼‰æ¥ç¼“å­˜æ•°æ®ï¼Œå‡å°‘ä¸å¿…è¦çš„ API è¯·æ±‚ã€‚</p><p><code>chartStore.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ChartState</span> &#123;</span><br><span class="line">  <span class="attr">chartData</span>: <span class="title class_">Array</span>&lt;&#123; <span class="attr">value</span>: <span class="built_in">number</span>; <span class="attr">name</span>: <span class="built_in">string</span> &#125;&gt;;</span><br><span class="line">  <span class="attr">isLoading</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">error</span>: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useChartStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;chart&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: (): <span class="function"><span class="params">ChartState</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">chartData</span>: [], <span class="comment">// å›¾è¡¨æ•°æ®</span></span><br><span class="line">    <span class="attr">isLoading</span>: <span class="literal">false</span>, <span class="comment">// åŠ è½½çŠ¶æ€</span></span><br><span class="line">    <span class="attr">error</span>: <span class="literal">null</span>, <span class="comment">// é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">fetchChartData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">error</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ£€æŸ¥æ˜¯å¦æœ‰ç¼“å­˜æ•°æ®</span></span><br><span class="line">      <span class="keyword">const</span> cachedData = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;chartData&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (cachedData) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chartData</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(cachedData);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/data&#x27;</span>); <span class="comment">// å‡è®¾åç«¯ API åœ°å€ä¸º /api/data</span></span><br><span class="line">        <span class="keyword">const</span> data = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°† JSON æ•°æ®è½¬æ¢ä¸º ECharts éœ€è¦çš„æ ¼å¼</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chartData</span> = data.<span class="title function_">map</span>(<span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">          <span class="attr">value</span>: item.<span class="property">sales</span>,</span><br><span class="line">          <span class="attr">name</span>: item.<span class="property">category</span>,</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¼“å­˜æ•°æ®</span></span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;chartData&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">chartData</span>));</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">error</span> = <span class="string">&#x27;Failed to load chart data&#x27;</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading data:&#x27;</span>, error);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="æŒ‰éœ€åŠ è½½"><a href="#æŒ‰éœ€åŠ è½½" class="headerlink" title="æŒ‰éœ€åŠ è½½"></a>æŒ‰éœ€åŠ è½½</h5><p>å¤§å‹å›¾è¡¨æˆ–å¤æ‚çš„æ•°æ®é›†ï¼Œå¯ä»¥è€ƒè™‘åˆ†é¡µåŠ è½½æ•°æ®æˆ–æ‡’åŠ è½½</p><p><code>chartStore.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useChartStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;chart&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: (): <span class="function"><span class="params">ChartState</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">chartData</span>: [],</span><br><span class="line">    <span class="attr">isLoading</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">error</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">fetchChartData</span>(<span class="params"><span class="attr">forceRefresh</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">error</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœä¸éœ€è¦å¼ºåˆ¶åˆ·æ–°ä¸”æœ‰ç¼“å­˜æ•°æ®ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ç¼“å­˜</span></span><br><span class="line">      <span class="keyword">if</span> (!forceRefresh) &#123;</span><br><span class="line">        <span class="keyword">const</span> cachedData = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;chartData&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cachedData) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">chartData</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(cachedData);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/data&#x27;</span>); <span class="comment">// å‡è®¾åç«¯ API åœ°å€ä¸º /api/data</span></span><br><span class="line">        <span class="keyword">const</span> data = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°† JSON æ•°æ®è½¬æ¢ä¸º ECharts éœ€è¦çš„æ ¼å¼</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chartData</span> = data.<span class="title function_">map</span>(<span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">          <span class="attr">value</span>: item.<span class="property">sales</span>,</span><br><span class="line">          <span class="attr">name</span>: item.<span class="property">category</span>,</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¼“å­˜æ•°æ®</span></span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;chartData&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">chartData</span>));</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">error</span> = <span class="string">&#x27;Failed to load chart data&#x27;</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading data:&#x27;</span>, error);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>rose.vue</code></p><p>è°ƒç”¨ fetchChartData æ—¶ä¼ é€’å‚æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ç¼“å­˜æ•°æ®</span></span><br><span class="line">chartStore.<span class="title function_">fetchChartData</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœéœ€è¦å¼ºåˆ¶åˆ·æ–°æ•°æ®ï¼ˆä¾‹å¦‚ç”¨æˆ·ç‚¹å‡»äº†â€œåˆ·æ–°â€æŒ‰é’®ï¼‰ï¼Œå¯ä»¥ä¼ é€’ true</span></span><br><span class="line"><span class="comment">// chartStore.fetchChartData(true);</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯æ·±å…¥æŠ€æœ¯æ–¹å‘é€‰å‹</title>
      <link href="/2025/03/08/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%96%B9%E5%90%91%E9%80%89%E5%9E%8B/"/>
      <url>/2025/03/08/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%96%B9%E5%90%91%E9%80%89%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰ç«¯æŠ€æœ¯æ–¹å‘é€‰å‹"><a href="#å‰ç«¯æŠ€æœ¯æ–¹å‘é€‰å‹" class="headerlink" title="å‰ç«¯æŠ€æœ¯æ–¹å‘é€‰å‹"></a>å‰ç«¯æŠ€æœ¯æ–¹å‘é€‰å‹</h1><hr><h2 id="æ•°æ®å¯è§†åŒ–"><a href="#æ•°æ®å¯è§†åŒ–" class="headerlink" title="æ•°æ®å¯è§†åŒ–"></a>æ•°æ®å¯è§†åŒ–</h2><p><strong>ç®€ä»‹ï¼šå°†æ•°æ®ä»¥å›¾è¡¨ã€å›¾å½¢ç­‰å¯è§†åŒ–å½¢å¼å±•ç¤º</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ•°æ®å¯è§†åŒ–åº“ï¼Œå¦‚D3.jsã€EChartsã€AntVç­‰</span><br><span class="line">JavaScriptçš„æ•°ç»„æ“ä½œã€æ•°æ®è¿‡æ»¤</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ•°æ®å¤„ç†å’Œåˆ†æèƒ½åŠ›è¦æ±‚é«˜</span><br><span class="line">JavaScriptçš„æ•°ç»„æ“ä½œã€æ•°æ®è¿‡æ»¤ç­‰æ–¹æ³•</span><br><span class="line">ä¸åŒå›¾è¡¨ç±»å‹çš„ç‰¹ç‚¹å’Œé…ç½®é€‰é¡¹å¤æ‚ï¼Œéœ€è¦æ·±å…¥äº†è§£</span><br><span class="line">å¯è§†åŒ–æ•ˆæœçš„è®¾è®¡å’Œä¼˜åŒ–éš¾åº¦å¤§ï¼Œå¦‚è‰²å½©æ­é…ã€å¸ƒå±€è°ƒæ•´ç­‰ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæ¯”è¾ƒæˆç†Ÿï¼Œå·²æœ‰è®¸å¤šæˆç†Ÿçš„æ•°æ®å¯è§†åŒ–åº“ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼ŒåŸºæœ¬èƒ½æ»¡è¶³å¸¸è§éœ€æ±‚ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šè¾ƒå¥½ï¼Œå¯ä¸åç«¯æ•°æ®å¤„ç†ã€å‰ç«¯äº¤äº’ç­‰æŠ€æœ¯é›†æˆï¼Œæ‹“å±•æ•°æ®å¯è§†åŒ–çš„åº”ç”¨åœºæ™¯ã€‚</strong></p><hr><h2 id="è·¨ç«¯"><a href="#è·¨ç«¯" class="headerlink" title="è·¨ç«¯"></a>è·¨ç«¯</h2><p><strong>ç®€ä»‹ï¼šä¸€å¥—ä»£ç åœ¨ä¸åŒçš„å¹³å°ä¸Šè¿è¡Œï¼Œå¦‚Webã€Androidã€iOSã€å°ç¨‹åºç­‰ã€‚</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æŒæ¡è·¨ç«¯æ¡†æ¶ï¼Œå¦‚ReactNativeã€Flutterç­‰ï¼›</span><br><span class="line">äº†è§£ä¸åŒå¹³å°çš„åŸç”Ÿå¼€å‘æŠ€æœ¯ï¼Œå¦‚Androidçš„Java/Kotlinã€iOSçš„Swift/Objective-Cï¼›</span><br><span class="line">ç†Ÿæ‚‰å‰ç«¯çš„åŸºç¡€æŠ€æœ¯HTMLã€CSSã€JavaScriptï¼›</span><br><span class="line">æŒæ¡ç›¸å…³çš„æ‰“åŒ…å’Œå‘å¸ƒå·¥å…·ï¼Œå¦‚Cordovaã€Capacitorç­‰ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¸åŒå¹³å°çš„åŸç”Ÿå¼€å‘æŠ€æœ¯å·®å¼‚å¤§ï¼Œéœ€è¦å­¦ä¹ å’ŒæŒæ¡å¤šç§æŠ€æœ¯æ ˆï¼›</span><br><span class="line">è·¨ç«¯æ¡†æ¶çš„åŸç†å’Œä½¿ç”¨å¤æ‚ï¼Œå¦‚ReactNativeã€Flutterç­‰ï¼›</span><br><span class="line">é€‚é…ä¸åŒå¹³å°çš„UIå’Œäº¤äº’è§„èŒƒå›°éš¾ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæ¯”è¾ƒæˆç†Ÿï¼Œä¸»æµçš„è·¨ç«¯æ¡†æ¶å·²å¾—åˆ°å¹¿æ³›åº”ç”¨ï¼Œä½†åœ¨ä¸€äº›ç‰¹æ®Šéœ€æ±‚å’Œå¹³å°ä¸Šä»å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šå¼ºï¼Œå¯ä¸åç«¯å¼€å‘ã€äº‘æœåŠ¡ç­‰æŠ€æœ¯é›†æˆï¼Œæ‹“å±•è·¨ç«¯åº”ç”¨çš„åŠŸèƒ½å’Œåœºæ™¯ã€‚</strong></p><hr><h2 id="å·¥ç¨‹åŒ–"><a href="#å·¥ç¨‹åŒ–" class="headerlink" title="å·¥ç¨‹åŒ–"></a>å·¥ç¨‹åŒ–</h2><p><strong>ç®€ä»‹ï¼šä½¿ç”¨è½¯ä»¶å·¥ç¨‹çš„æ–¹æ³•å’Œå·¥å…·æ¥è§„èŒƒå’Œä¼˜åŒ–å‰ç«¯å¼€å‘æµç¨‹ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ„å»ºå·¥å…·ï¼Œå¦‚Webpackã€Viteç­‰ï¼›</span><br><span class="line">ä»£ç è§„èŒƒå’Œæ£€æŸ¥å·¥å…·ï¼Œå¦‚ESLintã€Prettierç­‰ï¼›</span><br><span class="line">äº†è§£æ¨¡å—åŒ–å’Œç»„ä»¶åŒ–å¼€å‘çš„æ–¹æ³•ï¼Œå¦‚ES6æ¨¡å—ã€Vueç»„ä»¶ã€Reactç»„ä»¶ç­‰ï¼›</span><br><span class="line">ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œå¦‚Git</span><br><span class="line">è‡ªåŠ¨åŒ–éƒ¨ç½²å’ŒæŒç»­é›†æˆå·¥å…·ï¼Œå¦‚Jenkinsã€GitLab CIç­‰ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ„å»ºå·¥å…·çš„é…ç½®å’Œä½¿ç”¨å¤æ‚ï¼Œå¦‚Webpackã€Viteç­‰</span><br><span class="line">ä»£ç è§„èŒƒå’Œæ£€æŸ¥å·¥å…·çš„å®šåˆ¶å’Œé›†æˆå›°éš¾</span><br><span class="line">ç†è§£å’ŒæŒæ¡æ¨¡å—åŒ–å’Œç»„ä»¶åŒ–å¼€å‘çš„åŸç†å’Œæ–¹æ³•éœ€è¦ä¸€å®šæ—¶é—´ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæ¯”è¾ƒæˆç†Ÿï¼Œç›¸å…³çš„æ„å»ºå·¥å…·ã€ä»£ç è§„èŒƒå’Œæ£€æŸ¥å·¥å…·ç­‰å·²å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šè¾ƒå¥½ï¼Œå¯ä¸å…¶ä»–æŠ€æœ¯é›†æˆï¼Œå¦‚æµ‹è¯•æ¡†æ¶ã€è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·ç­‰ï¼Œæ‹“å±•å·¥ç¨‹åŒ–çš„èŒƒå›´å’ŒåŠŸèƒ½ã€‚</strong></p><hr><h2 id="å³æ—¶é€šè®¯"><a href="#å³æ—¶é€šè®¯" class="headerlink" title="å³æ—¶é€šè®¯"></a>å³æ—¶é€šè®¯</h2><p><strong>ç®€ä»‹ï¼šå®ç°å®¢æˆ·ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„å®æ—¶é€šä¿¡ï¼Œå¦‚æ–‡å­—æ¶ˆæ¯ã€è¯­éŸ³æ¶ˆæ¯ã€è§†é¢‘é€šè¯ç­‰</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æŒæ¡WebSocketæˆ–WebRTCç­‰å®æ—¶é€šä¿¡æŠ€æœ¯ï¼›</span><br><span class="line">ç†Ÿæ‚‰ç›¸å…³çš„å³æ—¶é€šè®¯åè®®ï¼Œå¦‚XMPPã€MQTTç­‰ï¼›</span><br><span class="line">äº†è§£éŸ³è§†é¢‘å¤„ç†æŠ€æœ¯ï¼Œå¦‚éŸ³é¢‘é‡‡é›†ã€è§†é¢‘ç¼–ç ç­‰ï¼›</span><br><span class="line">æŒæ¡JavaScriptçš„äº‹ä»¶å¤„ç†å’Œå¼‚æ­¥ç¼–ç¨‹ï¼Œå®ç°å®æ—¶é€šä¿¡çš„äº¤äº’åŠŸèƒ½ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å®æ—¶é€šä¿¡åè®®å’ŒæŠ€æœ¯çš„ç†è§£å’Œå®ç°å¤æ‚ï¼Œå¦‚WebSocketã€WebRTCç­‰ï¼›</span><br><span class="line">éŸ³è§†é¢‘å¤„ç†æŠ€æœ¯éš¾åº¦å¤§ï¼ŒåŒ…æ‹¬éŸ³é¢‘é‡‡é›†ã€è§†é¢‘ç¼–ç ç­‰ï¼›</span><br><span class="line">å®‰å…¨å’Œéšç§ä¿æŠ¤è¦æ±‚é«˜ï¼Œå¦‚æ•°æ®åŠ å¯†ã€ç”¨æˆ·è®¤è¯ç­‰ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæ¯”è¾ƒæˆç†Ÿï¼Œå·²æœ‰è®¸å¤šæˆç†Ÿçš„å³æ—¶é€šè®¯è§£å†³æ–¹æ¡ˆå’Œåº“ï¼Œä½†åœ¨ä¸€äº›ç‰¹æ®Šéœ€æ±‚ä¸‹ä»éœ€å®šåˆ¶å¼€å‘ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šè¾ƒå¥½ï¼Œå¯ä¸å…¶ä»–æŠ€æœ¯é›†æˆï¼Œå¦‚äººå·¥æ™ºèƒ½èŠå¤©æœºå™¨äººã€å®¢æœç³»ç»Ÿç­‰ï¼Œæ‹“å±•åº”ç”¨åœºæ™¯ã€‚</strong></p><hr><h2 id="ååŒ"><a href="#ååŒ" class="headerlink" title="ååŒ"></a>ååŒ</h2><p><strong>ç®€ä»‹ï¼šå¤šäººå¯¹ä¸€ä¸ªé¡¹ç›®è¿›è¡Œç¼–è¯‘ï¼Œå¼€å‘ï¼Œè°ƒè¯•</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼šååŒå·¥å…·å¹³å°Gitï¼ŒSVNç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">äº†è§£å¸¸ç”¨çš„ååŒå·¥å…·å’Œå¹³å°ï¼Œå¦‚Gitã€SVNç­‰ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼›</span><br><span class="line">æŒæ¡ç›¸å…³çš„ä»£ç åˆå¹¶ã€å†²çªè§£å†³ç­‰æŠ€æœ¯ï¼›</span><br><span class="line">ç†Ÿæ‚‰å®æ—¶é€šä¿¡æŠ€æœ¯ï¼Œå¦‚WebSocketï¼Œç”¨äºå®ç°å¤šäººå®æ—¶åä½œçš„äº¤äº’åŠŸèƒ½ï¼›</span><br><span class="line">äº†è§£å›¢é˜Ÿåä½œå’Œé¡¹ç›®ç®¡ç†çš„æµç¨‹å’Œæ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å®æ—¶é€šä¿¡æŠ€æœ¯çš„å®ç°å’Œä¼˜åŒ–å¤æ‚ï¼Œå¦‚WebSocketçš„è¿æ¥ç®¡ç†ã€æ¶ˆæ¯æ¨é€ç­‰ï¼›</span><br><span class="line">å¤„ç†å¤šäººåŒæ—¶æ“ä½œçš„å¹¶å‘æ§åˆ¶å’Œæ•°æ®ä¸€è‡´æ€§å›°éš¾ï¼›</span><br><span class="line">ä¸åŒå¼€å‘äººå‘˜çš„ä»£ç åˆå¹¶å’Œå†²çªè§£å†³ç¹çã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæŠ€æœ¯åœ¨ä¸æ–­å‘å±•å’Œå®Œå–„ä¸­ï¼Œå·²æœ‰ä¸€äº›æˆç†Ÿçš„ååŒå·¥å…·å’Œå¹³å°ï¼Œä½†åœ¨ä¸€äº›å¤æ‚åœºæ™¯ä¸‹ä»å­˜åœ¨æŒ‘æˆ˜ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šå¼ºï¼Œå¯ä¸å„ç§å¼€å‘å·¥å…·å’ŒæŠ€æœ¯é›†æˆï¼Œæ‹“å±•ååŒçš„èŒƒå›´å’ŒåŠŸèƒ½ã€‚</strong></p><hr><h2 id="å¯Œæ–‡æœ¬"><a href="#å¯Œæ–‡æœ¬" class="headerlink" title="å¯Œæ–‡æœ¬"></a>å¯Œæ–‡æœ¬</h2><p><strong>ç®€ä»‹ï¼šæ”¯æŒç”¨æˆ·è¾“å…¥å’Œç¼–è¾‘ä¸°å¯Œæ ¼å¼æ–‡æœ¬çš„åŠŸèƒ½ï¼Œå¦‚åŠ ç²—ã€æ–œä½“ã€å›¾ç‰‡ã€è§†é¢‘ã€é“¾æ¥ç­‰ï¼Œåº”ç”¨äºåšå®¢ã€å†…å®¹ç®¡ç†ç³»ç»Ÿã€åœ¨çº¿æ–‡æ¡£ç­‰åœºæ™¯ã€‚</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¯ä½¿ç”¨æˆç†Ÿçš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åº“ï¼Œå¦‚TinyMCEã€CKEditorç­‰ï¼›</span><br><span class="line">æŒæ¡JavaScriptçš„äº‹ä»¶å¤„ç†å’ŒDOMæ“ä½œï¼Œå®ç°å¯¹å¯Œæ–‡æœ¬å†…å®¹çš„åŠ¨æ€ç¼–è¾‘å’Œäº¤äº’ï¼›</span><br><span class="line">ç†Ÿæ‚‰ç›¸å…³çš„å›¾ç‰‡ä¸Šä¼ ã€è§†é¢‘åµŒå…¥ç­‰æŠ€æœ¯ï¼Œä»¥åŠæ•°æ®å­˜å‚¨å’Œä¼ è¾“çš„æ–¹å¼ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„åŠŸèƒ½å¤æ‚ï¼Œéœ€è¦æ·±å…¥æŒæ¡å…¶APIå’Œé…ç½®é€‰é¡¹ï¼›</span><br><span class="line">å¤„ç†å¤§é‡æ–‡æœ¬å’Œå¤æ‚æ ¼å¼æ—¶çš„æ€§èƒ½ä¼˜åŒ–æŒ‘æˆ˜å¤§ï¼›</span><br><span class="line">å®ç°å¤šäººååŒç¼–è¾‘æ—¶çš„å†²çªå¤„ç†å’Œæ•°æ®åŒæ­¥å›°éš¾ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šè¾ƒé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæ¯”è¾ƒæˆç†Ÿï¼Œå·²æœ‰è®¸å¤šæˆç†Ÿçš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åº“ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼ŒåŸºæœ¬èƒ½æ»¡è¶³å¸¸è§éœ€æ±‚ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šè¾ƒå¥½ï¼Œå¯ä¸å…¶ä»–å‰ç«¯æŠ€æœ¯é›†æˆï¼Œå¦‚æ–‡ä»¶ä¸Šä¼ ã€å›¾ç‰‡å¤„ç†ã€æ•°æ®å­˜å‚¨ç­‰ï¼Œæ‹“å±•åº”ç”¨åœºæ™¯ã€‚</strong></p><hr><h2 id="3Dæ¸²æŸ“"><a href="#3Dæ¸²æŸ“" class="headerlink" title="3Dæ¸²æŸ“"></a>3Dæ¸²æŸ“</h2><p><strong>ç®€ä»‹ï¼šåœ¨æµè§ˆå™¨ä¸­åˆ›å»ºå’Œå±•ç¤º3Då›¾å½¢å’Œåœºæ™¯</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æŒæ¡WebGLæˆ–WebGPUçš„API</span><br><span class="line">äº†è§£3Då›¾å½¢çš„åŸºæœ¬æ¦‚å¿µï¼Œå¦‚é¡¶ç‚¹ã€çº¹ç†ã€æè´¨ç­‰ï¼›</span><br><span class="line">ç†Ÿæ‚‰ç›¸å…³çš„3Dæ¸²æŸ“å¼•æ“ï¼Œå¦‚Three.jsã€Babylon.jsç­‰ï¼›</span><br><span class="line">æŒæ¡JavaScriptçš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œä»¥æé«˜3Dæ¸²æŸ“çš„æ•ˆç‡ï¼›</span><br><span class="line">äº†è§£å›¾å½¢è®¾è®¡å’Œå»ºæ¨¡å·¥å…·ï¼Œå¦‚Blenderã€Mayaç­‰ï¼Œç”¨äºåˆ›å»º3Dæ¨¡å‹å’Œåœºæ™¯ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3Då›¾å½¢å­¦çŸ¥è¯†è¦æ±‚é«˜ï¼Œå¦‚é¡¶ç‚¹ã€çº¹ç†ã€æè´¨ç­‰æ¦‚å¿µå¤æ‚ï¼›</span><br><span class="line">WebGLæˆ–WebGPUçš„APIå­¦ä¹ æ›²çº¿é™¡å³­ï¼Œéœ€è¦æŒæ¡åº•å±‚å›¾å½¢æ¸²æŸ“åŸç†ï¼›</span><br><span class="line">æ€§èƒ½ä¼˜åŒ–éš¾åº¦å¤§ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤æ‚åœºæ™¯å’Œå¤§é‡æ•°æ®æ—¶ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šä¸­ç­‰åé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šå¤„äºå‘å±•é˜¶æ®µï¼Œç›¸å…³çš„3Dæ¸²æŸ“å¼•æ“å’Œå·¥å…·ä¸æ–­å®Œå–„ï¼Œä½†ä»æœ‰ä¸€å®šçš„æŠ€æœ¯é—¨æ§›ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šå¥½ï¼Œå¯ä¸åŠ¨ç”»ã€ç‰©ç†å¼•æ“ç­‰æŠ€æœ¯ç»“åˆï¼Œæ‹“å±•3Dåº”ç”¨çš„åŠŸèƒ½å’Œåœºæ™¯ã€‚</strong></p><hr><h2 id="éŸ³è§†é¢‘"><a href="#éŸ³è§†é¢‘" class="headerlink" title="éŸ³è§†é¢‘"></a>éŸ³è§†é¢‘</h2><p><strong>ç®€ä»‹ï¼šåœ¨å‰ç«¯å®ç°éŸ³è§†é¢‘çš„æ’­æ”¾ã€å½•åˆ¶ã€ç¼–è¾‘ã€ç›´æ’­ã€è§†é¢‘ä¼šè®®ç­‰åŠŸèƒ½</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æŒæ¡HTML5çš„ &lt;video&gt; å’Œ &lt;audio&gt; æ ‡ç­¾ï¼Œä»¥åŠç›¸å…³çš„APIï¼›</span><br><span class="line">äº†è§£éŸ³è§†é¢‘ç¼–è§£ç æŠ€æœ¯ï¼Œå¦‚H.264ã€AACç­‰ï¼›</span><br><span class="line">ç†Ÿæ‚‰éŸ³è§†é¢‘å¤„ç†åº“ï¼Œå¦‚FFmpegã€WebRTCç­‰ï¼›</span><br><span class="line">æŒæ¡JavaScriptçš„äº‹ä»¶å¤„ç†å’Œå¼‚æ­¥ç¼–ç¨‹ï¼Œå®ç°éŸ³è§†é¢‘çš„äº¤äº’åŠŸèƒ½ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">éŸ³è§†é¢‘ç¼–è§£ç æŠ€æœ¯å¤æ‚ï¼Œéœ€è¦æŒæ¡ç›¸å…³çš„æ ‡å‡†å’Œç®—æ³•ï¼›</span><br><span class="line">æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜å¤šï¼Œä¸åŒæµè§ˆå™¨å¯¹éŸ³è§†é¢‘çš„æ”¯æŒå’Œè¡¨ç°ä¸åŒï¼›</span><br><span class="line">å®æ—¶éŸ³è§†é¢‘æµçš„ä¼ è¾“å’Œå¤„ç†éš¾åº¦å¤§ï¼Œå¦‚ç½‘ç»œå»¶è¿Ÿã€ä¸¢åŒ…ç­‰é—®é¢˜ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šä¸­ç­‰åé«˜ï¼Œåœ¨çº¿æ•™è‚²ã€è§†é¢‘ä¼šè®®ã€å¨±ä¹ç­‰é¢†åŸŸå¯¹éŸ³è§†é¢‘åŠŸèƒ½çš„éœ€æ±‚ä¸æ–­å¢é•¿ã€‚</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæ¯”è¾ƒæˆç†Ÿï¼ŒHTML5çš„ <strong><video></strong> å’Œ <strong><audio></strong> æ ‡ç­¾å·²å¾—åˆ°å¹¿æ³›æ”¯æŒï¼Œç›¸å…³çš„éŸ³è§†é¢‘å¤„ç†åº“ä¹Ÿè¾ƒä¸ºå®Œå–„ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šè¾ƒå¥½</strong></p><hr><h2 id="ä½ä»£ç "><a href="#ä½ä»£ç " class="headerlink" title="ä½ä»£ç "></a>ä½ä»£ç </h2><p><strong>ç®€ä»‹ï¼šé€šè¿‡å¯è§†åŒ–ç•Œé¢å’Œå°‘é‡ä»£ç ç¼–å†™ï¼Œå¿«é€Ÿæ„å»ºåº”ç”¨ç¨‹åºçš„å¼€å‘æ–¹å¼ï¼Œæ—¨åœ¨æé«˜å¼€å‘æ•ˆç‡ã€é™ä½æŠ€æœ¯é—¨æ§›ï¼Œä½¿éä¸“ä¸šå¼€å‘äººå‘˜ä¹Ÿèƒ½å‚ä¸å¼€å‘ã€‚</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼šJeecg-bootï¼Œå®œæ­</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç²¾é€šHTMLã€CSSã€JavaScriptåŸºç¡€æŠ€æœ¯ï¼›</span><br><span class="line">ç†Ÿæ‚‰ä¸»æµçš„ä½ä»£ç å¹³å°ï¼Œå¦‚Jeecg-bootã€å®œæ­ç­‰ï¼›</span><br><span class="line">ç›¸å…³çš„å‰ç«¯æ¡†æ¶ï¼Œå¦‚Vueã€Reactç­‰</span><br><span class="line">åç«¯æŠ€æœ¯å¦‚Spring Bootã€Node.jsç­‰</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å®šåˆ¶æ€§å—é™ï¼Œå¯¹äºå¤æ‚ä¸šåŠ¡é€»è¾‘å’Œç‰¹æ®Šéœ€æ±‚éš¾ä»¥æ»¡è¶³ï¼›</span><br><span class="line">è‡ªåŠ¨ç”Ÿæˆä»£ç å¯èƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œå¦‚åŠ è½½é€Ÿåº¦æ…¢ã€å“åº”ä¸åŠæ—¶ç­‰ï¼›</span><br><span class="line">å¹³å°å…¼å®¹æ€§æœ‰å¾…æé«˜ï¼Œä¸åŒä½ä»£ç å¹³å°çš„ç»„ä»¶å’ŒåŠŸèƒ½å·®å¼‚å¤§ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šè¾ƒé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šå¤„äºå¿«é€Ÿå‘å±•é˜¶æ®µï¼ŒæŠ€æœ¯å’ŒåŠŸèƒ½ä¸æ–­å®Œå–„ï¼Œå·²æœ‰ä¸å°‘æˆç†Ÿçš„ä½ä»£ç å¹³å°ï¼Œä½†ä»å­˜åœ¨ä¸€äº›å±€é™æ€§ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šè¾ƒå¥½ï¼Œå¯ä¸å¤šç§æŠ€æœ¯é›†æˆï¼Œå¦‚åç«¯å¼€å‘æŠ€æœ¯ã€æ•°æ®åˆ†æå·¥å…·ç­‰ï¼Œæ‹“å±•åº”ç”¨åœºæ™¯ã€‚</strong></p><hr><h2 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h2><p><strong>ç®€ä»‹ï¼šé€šå¸¸ç”¨äºå¤„ç†å‰ç«¯é¡µé¢ä¸­çš„å¸ƒå±€å’Œæ’ç‰ˆï¼Œå®ç°å…ƒç´ çš„çµæ´»æ’åˆ—å’Œè‡ªé€‚åº”ï¼Œæé«˜é¡µé¢çš„å¸ƒå±€æ•ˆç‡å’Œå“åº”æ€§ã€‚</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ ¸å¿ƒæ˜¯CSSçš„Flexå¸ƒå±€å’ŒGridå¸ƒå±€</span><br><span class="line">æŒæ¡Flexå¸ƒå±€çš„å±æ€§å¦‚flex-directionã€flex-wrapç­‰ï¼Œä»¥åŠGridå¸ƒå±€çš„ç›¸å…³å±æ€§å’Œæ¦‚å¿µã€‚</span><br><span class="line">äº†è§£JavaScriptçš„DOMæ“ä½œï¼Œä»¥ä¾¿åœ¨éœ€è¦åŠ¨æ€è°ƒæ•´å¸ƒå±€æ—¶è¿›è¡Œäº¤äº’æ“ä½œã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¯¹CSSå¸ƒå±€çŸ¥è¯†è¦æ±‚é«˜ï¼Œéœ€æ·±å…¥ç†è§£Flexå’ŒGridå¸ƒå±€çš„åŸç†å’Œå±æ€§ï¼›</span><br><span class="line">åœ¨ä¸åŒæµè§ˆå™¨å’Œè®¾å¤‡ä¸Šçš„å…¼å®¹æ€§å¤„ç†å¤æ‚ï¼›</span><br><span class="line">åŠ¨æ€å¸ƒå±€è°ƒæ•´æ—¶ï¼ŒJavaScriptä¸CSSçš„äº¤äº’é€»è¾‘è¾ƒéš¾æŠŠæ¡ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šä¸­</strong></p><p><strong>æˆç†Ÿæ€§ï¼šç›¸å¯¹æˆç†Ÿï¼ŒCSSçš„Flexå’ŒGridå¸ƒå±€å·²å¾—åˆ°å¹¿æ³›æ”¯æŒï¼Œç›¸å…³çš„å¸ƒå±€åº“å’Œæ¡†æ¶ä¹Ÿè¾ƒä¸ºå®Œå–„ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šä¸€èˆ¬ï¼Œä¸»è¦å›´ç»•é¡µé¢å¸ƒå±€å’Œæ’ç‰ˆè¿›è¡Œæ‰©å±•ï¼Œå¦‚ä¸åŠ¨ç”»æ•ˆæœã€äº¤äº’ç»„ä»¶ç­‰ç»“åˆã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ¢ç´¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¡µè§†é¢‘æ•è·å·¥å…·</title>
      <link href="/2025/03/08/%E5%B7%A5%E5%85%B7/%E7%BD%91%E9%A1%B5%E8%A7%86%E9%A2%91%E6%8D%95%E8%8E%B7%E5%B7%A5%E5%85%B7/"/>
      <url>/2025/03/08/%E5%B7%A5%E5%85%B7/%E7%BD%91%E9%A1%B5%E8%A7%86%E9%A2%91%E6%8D%95%E8%8E%B7%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="ç½‘é¡µè§†é¢‘æ•è·å·¥å…·"><a href="#ç½‘é¡µè§†é¢‘æ•è·å·¥å…·" class="headerlink" title="ç½‘é¡µè§†é¢‘æ•è·å·¥å…·"></a>ç½‘é¡µè§†é¢‘æ•è·å·¥å…·</h1><h2 id="æœ¬åœ°è§£æå·¥å…·"><a href="#æœ¬åœ°è§£æå·¥å…·" class="headerlink" title="æœ¬åœ°è§£æå·¥å…·"></a>æœ¬åœ°è§£æå·¥å…·</h2><p><strong>åŸºäºWindowsç³»ç»Ÿ</strong></p><blockquote><p><a href="https://mkvtoolnix.download/downloads.html#windows">MKVToolNix Downloads â€“ Matroska tools for Linux&#x2F;Unix and Windows</a></p></blockquote><p><strong>ï¼ˆå½“ç„¶ç½‘ç«™é‡Œä¹Ÿæœ‰å…¶ä»–ç³»ç»Ÿçš„å·¥å…·ï¼Œåªæ˜¯æˆ‘æ²¡ç”¨ç”¨è¿‡ï¼‰</strong></p><p>**ä¸‹è½½åè§£å‹å‡ºæ¥ **<code>MKVToolNix</code> æ–‡ä»¶å¤¹</p><p>**å¯åŠ¨é¡¹æ˜¯ **<code>mkvtoolnix-gui.exe</code></p><p><img src="/upload/image-20250128160924228.png" alt="image-20250128160924228.png"></p><h2 id="æµè§ˆå™¨è„šæœ¬"><a href="#æµè§ˆå™¨è„šæœ¬" class="headerlink" title="æµè§ˆå™¨è„šæœ¬"></a>æµè§ˆå™¨è„šæœ¬</h2><p><code>media-source-extract</code> è£…åˆ°æ²¹çŒ´é‡Œï¼ˆæ–‡ä»¶æ”¾åœ¨æœ€åäº†ï¼‰</p><p><img src="/upload/image-20250128160910518.png" alt="image-20250128160910518.png"></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p><img src="/upload/image-20250128163554230.png" alt="image-20250128163554230.png"></p><h2 id="è„šæœ¬æ–‡ä»¶"><a href="#è„šæœ¬æ–‡ä»¶" class="headerlink" title="è„šæœ¬æ–‡ä»¶"></a><em>è„šæœ¬æ–‡ä»¶</em></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br></pre></td><td class="code"><pre><span class="line">// ==UserScript==</span><br><span class="line">// @name         media-source-extract</span><br><span class="line">// @namespace    https://github.com/Momo707577045/media-source-extract</span><br><span class="line">// @version      0.8.2</span><br><span class="line">// @description  https://github.com/Momo707577045/media-source-extract é…å¥—æ’ä»¶</span><br><span class="line">// @author       Momo707577045</span><br><span class="line">// @include      *</span><br><span class="line">// @exclude      http://blog.luckly-mjw.cn/tool-show/media-source-extract/player/player.html</span><br><span class="line">// @downloadURL https://blog.luckly-mjw.cn/tool-show/media-source-extract/media-source-extract.user.js</span><br><span class="line">// @updateURL   https://blog.luckly-mjw.cn/tool-show/media-source-extract/media-source-extract.user.js</span><br><span class="line">// @grant        none</span><br><span class="line">// @run-at document-start</span><br><span class="line">// ==/UserScript==</span><br><span class="line"></span><br><span class="line">(function () &#123;</span><br><span class="line">  &#x27;use strict&#x27;;</span><br><span class="line">  (function () &#123;</span><br><span class="line">    if (document.getElementById(&#x27;media-source-extract&#x27;)) &#123;</span><br><span class="line">      return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å¤å†™ call å‡½æ•°ï¼Œç»•è¿‡åŠ«æŒæ£€æŸ¥</span><br><span class="line">    Function.prototype.toString.call = function (caller) &#123;</span><br><span class="line">      return `&#x27;function $&#123;caller.name&#125;() &#123; [native code] &#125;&#x27;`</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è½®è¯¢ç›‘å¬ iframe çš„åŠ è½½</span><br><span class="line">    setInterval(() =&gt; &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        Array.prototype.forEach.call(document.getElementsByTagName(&#x27;iframe&#x27;), (iframe) =&gt; &#123;</span><br><span class="line">          // è‹¥ iframe ä½¿ç”¨äº† sandbox è¿›è¡Œæ“ä½œçº¦æŸï¼Œåˆ é™¤åŸæœ‰ iframeï¼Œæ‹·è´å…¶å¤‡ä»½ï¼Œåˆ é™¤ sandbox å±æ€§ï¼Œé‡æ–°è½½å…¥</span><br><span class="line">          // è‹¥ iframe å·²è½½å…¥ï¼Œå†ä¿®æ”¹ sandbox å±æ€§ï¼Œå°†ä¿®æ”¹æ— æ•ˆã€‚æ•…é€šè¿‡æ–°å»º iframe çš„æ–¹å¼ç»•è¿‡</span><br><span class="line">          if (iframe.hasAttribute(&#x27;sandbox&#x27;)) &#123;</span><br><span class="line">            const parentNode = iframe.parentNode;</span><br><span class="line">            const tempIframe = iframe.cloneNode()</span><br><span class="line">            tempIframe.removeAttribute(&quot;sandbox&quot;);</span><br><span class="line">            iframe.remove()</span><br><span class="line">            parentNode.appendChild(tempIframe);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, 1000)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    let sumFragment = 0 // å·²ç»æ•è·çš„æ‰€æœ‰ç‰‡æ®µæ•°</span><br><span class="line">    let isClose = false // æ˜¯å¦å…³é—­</span><br><span class="line">    let isStreamDownload = false // æ˜¯å¦ä½¿ç”¨æµå¼ä¸‹è½½</span><br><span class="line">    let _sourceBufferList = [] // åª’ä½“è½¨é“</span><br><span class="line">    const $showBtn = document.createElement(&#x27;div&#x27;) // å±•ç¤ºæŒ‰é’®</span><br><span class="line">    const $btnDownload = document.createElement(&#x27;div&#x27;) // ä¸‹è½½æŒ‰é’®</span><br><span class="line">    const $btnStreamDownload = document.createElement(&#x27;div&#x27;) // æµå¼ä¸‹è½½æŒ‰é’®</span><br><span class="line">    const $downloadNum = document.createElement(&#x27;div&#x27;) // å·²æ•è·è§†é¢‘ç‰‡æ®µæ•°</span><br><span class="line">    const $tenRate = document.createElement(&#x27;div&#x27;) // åå€é€Ÿæ’­æ”¾</span><br><span class="line">    const $closeBtn = document.createElement(&#x27;div&#x27;) // å…³é—­</span><br><span class="line">    const $container = document.createElement(&#x27;div&#x27;) // å®¹å™¨</span><br><span class="line">    $closeBtn.innerHTML = `</span><br><span class="line">    &lt;img style=&quot;</span><br><span class="line">      padding-top: 4px;</span><br><span class="line">      width: 24px;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">    &quot; src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAk1BMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ROyVeAAAAMHRSTlMA1Sq7gPribxkJx6Ey8onMsq+GTe10QF8kqJl5WEcvIBDc0sHAkkk1FgO2ZZ+dj1FHfPqwAAACNElEQVRIx6VW6ZqqMAwtFlEW2Rm3EXEfdZa+/9PdBEvbIVXu9835oW1yjiQlTWQE/iYPuTObOTzMNz4bQFRlY2FgnFXRC/o01mytiafP+BPvQZk56bcLSOXem1jpCy4QgXvRtlEVCARfUP65RM/hp29/+0R7eSbhoHlnffZ8h76e6x1tyw9mxXaJ3nfTVLd89hQr9NfGceJxfLIXmONh6eNNYftNSESRmgkHlEOjmhgBbYcEW08FFQN/ro6dvAczjhgXEdQP76xHEYxM+igQq259gLrCSlwbD3iDtTMy+A4Yuk0B6zV8c+BcO2OgFIp/UvJdG4o/Rp1JQYXeZFflPEFMfvugiFGFXN587YtgX7C8lRGFXPCGGYCCzlkoxJ4xqmi/jrIcdYYh5pwxiwI/gt7lDDFrcLiMKhBJ//W78ENsJgVUsV8wKpjZBXshM6cCW0jbRAilICFxIpgGMmmiWGHSIR6ViY+DPFaqSJCbQ5mbxoZLIlU0Al/cBj6N1uXfFI0okLppi69StmumSFQRP6oIKDedFi3vRDn3j6KozCZlu0DdJb3AupJXNLmqkk9+X9FEHLt1Jq8oi1H5n01AtRlvwQZQl9hmtPY4JEjMDs5ftWJN4Xr4lLrV2OHiUDHCPgvA/Tn/hP4zGUBfjZ3eLJ+NIOfHxi8CMoAQtYfmw93v01O0e7VlqqcCsXML3Vsu94cxnb4c7ML5chG8JIP9b38dENGaj3+x+TpiA/AL/fen8In7H8l3ZjdJQt2TAAAAAElFTkSuQmCC&quot;&gt;`</span><br><span class="line">    $showBtn.innerHTML = `</span><br><span class="line">    &lt;img style=&quot;</span><br><span class="line">      padding-top: 4px;</span><br><span class="line">      width: 24px;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">    &quot; src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADIBAMAAABfdrOtAAAAElBMVEUAAAD///////////////////8+Uq06AAAABXRSTlMA2kCAv5tF5NoAAAErSURBVHja7dzNasJAFIbhz8Tu7R0Eq/vQNHuxzL6YnPu/ldYpAUckxJ8zSnjfdTIPzHrOUawJdqmDJre1S/X7avigbM08kMgMSmt+iPWKbcwTsb3+KswXseOFLb2RnaTgjXTxtpwRq7XMgWz9kZ8cSKcwE6SX+SMGAgICAvJCyHdz2ud0pEx+/BpFaj2kEgQEBAQEBAQEBOT1kXWSkhbvk1vptOLs1LEWNrmVRgIBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBeTayTqpufogxduqM3q2AgICAgICAgICA3IOko4ZXkB/pqOHzhyZBQEBAQLIieVahtDNBDnrLgZT+yC4HUkmtN9JnWUiVZbVWliVhseCJdPqvCH5IV2tQNl4r6Bod+wWq9eeDik+xFQAAAABJRU5ErkJggg==&quot;&gt;`</span><br><span class="line"></span><br><span class="line">    // åå€é€Ÿæ’­æ”¾</span><br><span class="line">    function _tenRatePlay() &#123;</span><br><span class="line">      let playbackRate = 10</span><br><span class="line">      if ($tenRate.innerHTML === &#x27;åå€é€Ÿæ•è·&#x27;) &#123;</span><br><span class="line">        $tenRate.innerHTML = &#x27;æ¢å¤æ­£å¸¸æ’­æ”¾&#x27;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        playbackRate = 1</span><br><span class="line">        $tenRate.innerHTML = &#x27;åå€é€Ÿæ•è·&#x27;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      let $domList = document.getElementsByTagName(&#x27;video&#x27;)</span><br><span class="line">      for (let i = 0, length = $domList.length; i &lt; length; i++) &#123;</span><br><span class="line">        const $dom = $domList[i]</span><br><span class="line">        $dom.playbackRate = playbackRate</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è·å–é¡¶éƒ¨ window titleï¼Œå› å¯èƒ½å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œæ•…ä½¿ç”¨ try catch è¿›è¡Œä¿æŠ¤</span><br><span class="line">    function getDocumentTitle() &#123;</span><br><span class="line">      let title = document.title;</span><br><span class="line">      try &#123;</span><br><span class="line">        title = window.top.document.title</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">      &#125;</span><br><span class="line">      return title</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æµå¼ä¸‹è½½</span><br><span class="line">    function _streamDownload() &#123;</span><br><span class="line">      var _hmt = _hmt || [];</span><br><span class="line">      (function () &#123;</span><br><span class="line">        var hm = document.createElement(&quot;script&quot;);</span><br><span class="line">        hm.src = &quot;https://hm.baidu.com/hm.js?1f12b0865d866ae1b93514870d93ce89&quot;;</span><br><span class="line">        var s = document.getElementsByTagName(&quot;script&quot;)[0];</span><br><span class="line">        s.parentNode.insertBefore(hm, s);</span><br><span class="line">      &#125;)();</span><br><span class="line"></span><br><span class="line">      // å¯¹åº”çŠ¶æ€æœªä¸‹è½½ç»“æŸçš„åª’ä½“è½¨é“</span><br><span class="line">      const remainSourceBufferList = []</span><br><span class="line">      _sourceBufferList.forEach((target) =&gt; &#123;</span><br><span class="line">        // å¯¹åº”çš„ MSE çŠ¶æ€ä¸ºå·²ä¸‹è½½å®ŒæˆçŠ¶æ€</span><br><span class="line">        if (target.MSEInstance.readyState === &#x27;ended&#x27;) &#123;</span><br><span class="line">          target.streamWriter.close()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          remainSourceBufferList.push(target)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      // æµå¼ä¸‹è½½ï¼Œé‡Šæ”¾å·²ä¸‹è½½å®Œæˆçš„åª’ä½“è½¨é“ï¼Œå›æ”¶å†…å­˜</span><br><span class="line">      _sourceBufferList = remainSourceBufferList</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ™®é€šä¸‹è½½</span><br><span class="line">    function _download() &#123;</span><br><span class="line">      var _hmt = _hmt || [];</span><br><span class="line">      (function () &#123;</span><br><span class="line">        var hm = document.createElement(&quot;script&quot;);</span><br><span class="line">        hm.src = &quot;https://hm.baidu.com/hm.js?1f12b0865d866ae1b93514870d93ce89&quot;;</span><br><span class="line">        var s = document.getElementsByTagName(&quot;script&quot;)[0];</span><br><span class="line">        s.parentNode.insertBefore(hm, s);</span><br><span class="line">      &#125;)();</span><br><span class="line"></span><br><span class="line">      _sourceBufferList.forEach((target) =&gt; &#123;</span><br><span class="line">        const mime = target.mime.split(&#x27;;&#x27;)[0]</span><br><span class="line">        const type = mime.split(&#x27;/&#x27;)[1]</span><br><span class="line">        const fileBlob = new Blob(target.bufferList, &#123; type: mime &#125;) // åˆ›å»ºä¸€ä¸ªBlobå¯¹è±¡ï¼Œå¹¶è®¾ç½®æ–‡ä»¶çš„ MIME ç±»å‹</span><br><span class="line">        const a = document.createElement(&#x27;a&#x27;)</span><br><span class="line">        a.download = `$&#123;getDocumentTitle()&#125;.$&#123;type&#125;`</span><br><span class="line">        a.href = URL.createObjectURL(fileBlob)</span><br><span class="line">        a.style.display = &#x27;none&#x27;</span><br><span class="line">        document.body.appendChild(a)</span><br><span class="line">        // ç¦æ­¢ click äº‹ä»¶å†’æ³¡ï¼Œé¿å…å…¨å±€æ‹¦æˆª</span><br><span class="line">        a.onclick = function (e) &#123;</span><br><span class="line">          e.stopPropagation();</span><br><span class="line">        &#125;</span><br><span class="line">        a.click()</span><br><span class="line">        a.remove()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ç›‘å¬èµ„æºå…¨éƒ¨å½•å–æˆåŠŸ</span><br><span class="line">    let _endOfStream = window.MediaSource.prototype.endOfStream</span><br><span class="line">    window.MediaSource.prototype.endOfStream = function endOfStream() &#123;</span><br><span class="line">      if (isStreamDownload) &#123;</span><br><span class="line">        alert(&#x27;èµ„æºå…¨éƒ¨æ•è·æˆåŠŸï¼Œå³å°†ä¸‹è½½ï¼&#x27;)</span><br><span class="line">        setTimeout(_streamDownload) // ç­‰å¾… MediaSource çŠ¶æ€å˜æ›´</span><br><span class="line">        _endOfStream.call(this)</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (confirm(&#x27;èµ„æºå…¨éƒ¨æ•è·æˆåŠŸï¼Œå³å°†ä¸‹è½½ï¼&#x27;) == true) &#123;</span><br><span class="line">        _download()</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // ä¸ä¸‹è½½èµ„æº</span><br><span class="line">      &#125;</span><br><span class="line">      _endOfStream.call(this)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å½•å–èµ„æº</span><br><span class="line">    let _addSourceBuffer = window.MediaSource.prototype.addSourceBuffer</span><br><span class="line">    window.MediaSource.prototype.addSourceBuffer = function addSourceBuffer(mime) &#123;</span><br><span class="line">      _appendDom()</span><br><span class="line">      let sourceBuffer = _addSourceBuffer.call(this, mime)</span><br><span class="line">      let _append = sourceBuffer.appendBuffer</span><br><span class="line">      let bufferList = []</span><br><span class="line">      const _sourceBuffer = &#123;</span><br><span class="line">        mime,</span><br><span class="line">        bufferList,</span><br><span class="line">        MSEInstance: this,</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // å¦‚æœ streamSaver å·²æå‰åŠ è½½å®Œæˆï¼Œåˆ™åˆå§‹åŒ–å¯¹åº”çš„ streamWriter</span><br><span class="line">      try &#123;</span><br><span class="line">        if (window.streamSaver) &#123;</span><br><span class="line">          const type = mime.split(&#x27;;&#x27;)[0].split(&#x27;/&#x27;)[1]</span><br><span class="line">          _sourceBuffer.streamWriter = streamSaver.createWriteStream(`$&#123;getDocumentTitle()&#125;.$&#123;type&#125;`).getWriter()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.error(error)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      _sourceBufferList.push(_sourceBuffer)</span><br><span class="line">      sourceBuffer.appendBuffer = function (buffer) &#123;</span><br><span class="line">        sumFragment++</span><br><span class="line">        $downloadNum.innerHTML = `å·²æ•è· $&#123;sumFragment&#125; ä¸ªç‰‡æ®µ`</span><br><span class="line"></span><br><span class="line">        if (isStreamDownload &amp;&amp; _sourceBuffer.streamWriter) &#123; // æµå¼ä¸‹è½½</span><br><span class="line">          _sourceBuffer.streamWriter.write(new Uint8Array(buffer));</span><br><span class="line">        &#125; else &#123; // æ™®é€š blob ä¸‹è½½</span><br><span class="line">          bufferList.push(buffer)</span><br><span class="line">        &#125;</span><br><span class="line">        _append.call(this, buffer)</span><br><span class="line">      &#125;</span><br><span class="line">      return sourceBuffer</span><br><span class="line">    &#125;</span><br><span class="line">    window.MediaSource.prototype.addSourceBuffer.toString = function toString() &#123;</span><br><span class="line">      return &#x27;function addSourceBuffer() &#123; [native code] &#125;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ·»åŠ æ“ä½œçš„ dom</span><br><span class="line">    function _appendDom() &#123;</span><br><span class="line">      if (document.getElementById(&#x27;media-source-extract&#x27;)) &#123;</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">      $container.style = `</span><br><span class="line">      position: fixed;</span><br><span class="line">      top: 50px;</span><br><span class="line">      right: 50px;</span><br><span class="line">      text-align: right;</span><br><span class="line">      z-index: 9999;</span><br><span class="line">      `</span><br><span class="line">      const baseStyle = `</span><br><span class="line">      float:right;</span><br><span class="line">      clear:both;</span><br><span class="line">      margin-top: 10px;</span><br><span class="line">      padding: 0 20px;</span><br><span class="line">      color: white;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">      font-size: 16px;</span><br><span class="line">      font-weight: bold;</span><br><span class="line">      line-height: 40px;</span><br><span class="line">      text-align: center;</span><br><span class="line">      border-radius: 4px;</span><br><span class="line">      background-color: #3498db;</span><br><span class="line">      box-shadow: 0 3px 6px 0 rgba(0, 0, 0, 0.3);</span><br><span class="line">    `</span><br><span class="line">      $tenRate.innerHTML = &#x27;åå€é€Ÿæ•è·&#x27;</span><br><span class="line">      $downloadNum.innerHTML = &#x27;å·²æ•è· 0 ä¸ªç‰‡æ®µ&#x27;</span><br><span class="line">      $btnStreamDownload.innerHTML = &#x27;ç‰¹å¤§è§†é¢‘ä¸‹è½½ï¼Œè¾¹ä¸‹è½½è¾¹ä¿å­˜&#x27;</span><br><span class="line">      $btnDownload.innerHTML = &#x27;ä¸‹è½½å·²æ•è·ç‰‡æ®µ&#x27;</span><br><span class="line">      $btnDownload.id = &#x27;media-source-extract&#x27;</span><br><span class="line">      $tenRate.style = baseStyle</span><br><span class="line">      $downloadNum.style = baseStyle</span><br><span class="line">      $btnDownload.style = baseStyle</span><br><span class="line">      $btnStreamDownload.style = baseStyle</span><br><span class="line">      $btnStreamDownload.style.display = &#x27;none&#x27;</span><br><span class="line">      $showBtn.style = `</span><br><span class="line">      float:right;</span><br><span class="line">      clear:both;</span><br><span class="line">      display: none;</span><br><span class="line">      margin-top: 4px;</span><br><span class="line">      height: 34px;</span><br><span class="line">      width: 34px;</span><br><span class="line">      line-height: 34px;</span><br><span class="line">      text-align: center;</span><br><span class="line">      border-radius: 4px;</span><br><span class="line">      background-color: rgba(0, 0, 0, 0.5);</span><br><span class="line">      `</span><br><span class="line">      $closeBtn.style = `</span><br><span class="line">      float:right;</span><br><span class="line">      clear:both;</span><br><span class="line">      margin-top: 10px;</span><br><span class="line">      height: 34px;</span><br><span class="line">      width: 34px;</span><br><span class="line">      line-height: 34px;</span><br><span class="line">      text-align: center;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      border-radius: 50%;</span><br><span class="line">      background-color: rgba(0, 0, 0, 0.5);</span><br><span class="line">      `</span><br><span class="line"></span><br><span class="line">      $btnDownload.addEventListener(&#x27;click&#x27;, _download)</span><br><span class="line">      $tenRate.addEventListener(&#x27;click&#x27;, _tenRatePlay)</span><br><span class="line"></span><br><span class="line">      // å…³é—­æ§åˆ¶é¢æ¿</span><br><span class="line">      $closeBtn.addEventListener(&#x27;click&#x27;, function () &#123;</span><br><span class="line">        $downloadNum.style.display = &#x27;none&#x27;</span><br><span class="line">        $btnStreamDownload.style.display = &#x27;none&#x27;</span><br><span class="line">        $btnDownload.style.display = &#x27;none&#x27;</span><br><span class="line">        $closeBtn.style.display = &#x27;none&#x27;</span><br><span class="line">        $tenRate.style.display = &#x27;none&#x27;</span><br><span class="line">        $showBtn.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        isClose = true</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      // æ˜¾ç¤ºæ§åˆ¶é¢æ¿</span><br><span class="line">      $showBtn.addEventListener(&#x27;click&#x27;, function () &#123;</span><br><span class="line">        if (!isStreamDownload) &#123;</span><br><span class="line">          $btnDownload.style.display = &#x27;inline-block&#x27;</span><br><span class="line">          $btnStreamDownload.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">        $downloadNum.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        $closeBtn.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        $tenRate.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        $showBtn.style.display = &#x27;none&#x27;</span><br><span class="line">        isClose = false</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      // å¯åŠ¨æµå¼ä¸‹è½½</span><br><span class="line">      $btnStreamDownload.addEventListener(&#x27;click&#x27;, function () &#123;</span><br><span class="line">        (function () &#123;</span><br><span class="line">          var hm = document.createElement(&quot;script&quot;);</span><br><span class="line">          hm.src = &quot;https://hm.baidu.com/hm.js?1f12b0865d866ae1b93514870d93ce89&quot;;</span><br><span class="line">          var s = document.getElementsByTagName(&quot;script&quot;)[0];</span><br><span class="line">          s.parentNode.insertBefore(hm, s);</span><br><span class="line">        &#125;)();</span><br><span class="line">        isStreamDownload = true</span><br><span class="line">        $btnDownload.style.display = &#x27;none&#x27;</span><br><span class="line">        $btnStreamDownload.style.display = &#x27;none&#x27;</span><br><span class="line">        _sourceBufferList.forEach(sourceBuffer =&gt; &#123;</span><br><span class="line">          if (!sourceBuffer.streamWriter) &#123;</span><br><span class="line">            const type = sourceBuffer.mime.split(&#x27;;&#x27;)[0].split(&#x27;/&#x27;)[1]</span><br><span class="line">            sourceBuffer.streamWriter = streamSaver.createWriteStream(`$&#123;getDocumentTitle()&#125;.$&#123;type&#125;`).getWriter()</span><br><span class="line">            sourceBuffer.bufferList.forEach(buffer =&gt; &#123;</span><br><span class="line">              sourceBuffer.streamWriter.write(new Uint8Array(buffer));</span><br><span class="line">            &#125;)</span><br><span class="line">            sourceBuffer.bufferList = []</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      document.getElementsByTagName(&#x27;html&#x27;)[0].insertBefore($container, document.getElementsByTagName(&#x27;head&#x27;)[0]);</span><br><span class="line">      $container.appendChild($btnStreamDownload)</span><br><span class="line">      $container.appendChild($downloadNum)</span><br><span class="line">      $container.appendChild($btnDownload)</span><br><span class="line">      $container.appendChild($tenRate)</span><br><span class="line">      $container.appendChild($closeBtn)</span><br><span class="line">      $container.appendChild($showBtn)</span><br><span class="line"></span><br><span class="line">      // åŠ è½½ stream æµå¼ä¸‹è½½å™¨</span><br><span class="line">      try &#123;</span><br><span class="line">        let $streamSaver = document.createElement(&#x27;script&#x27;)</span><br><span class="line">        $streamSaver.src = &#x27;https://upyun.luckly-mjw.cn/lib/stream-saver.js&#x27;</span><br><span class="line">        document.body.appendChild($streamSaver);</span><br><span class="line">        $streamSaver.addEventListener(&#x27;load&#x27;, () =&gt; &#123;</span><br><span class="line">          $btnStreamDownload.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.error(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)()</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>GitHubæ”¹å</title>
      <link href="/2025/03/08/Github/%E6%9B%B4%E6%94%B9%20GitHub%20%E7%94%A8%E6%88%B7%E5%90%8D%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/"/>
      <url>/2025/03/08/Github/%E6%9B%B4%E6%94%B9%20GitHub%20%E7%94%A8%E6%88%B7%E5%90%8D%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="æ›´æ”¹-GitHub-ç”¨æˆ·åæ³¨æ„äº‹é¡¹"><a href="#æ›´æ”¹-GitHub-ç”¨æˆ·åæ³¨æ„äº‹é¡¹" class="headerlink" title="æ›´æ”¹ GitHub ç”¨æˆ·åæ³¨æ„äº‹é¡¹"></a><strong>æ›´æ”¹ GitHub ç”¨æˆ·åæ³¨æ„äº‹é¡¹</strong></h1><h2 id="æ›´æ”¹å‰é¡»çŸ¥"><a href="#æ›´æ”¹å‰é¡»çŸ¥" class="headerlink" title="æ›´æ”¹å‰é¡»çŸ¥"></a>æ›´æ”¹å‰é¡»çŸ¥</h2><p><strong>é¦–å…ˆï¼Œæ›´æ”¹ç”¨æˆ·åä¸ä¼šåˆ é™¤ä»“åº“æˆ–æäº¤å†å²ã€‚</strong></p><p>**æ—§ç”¨æˆ·åä¸‹çš„ä»“åº“ URLï¼ˆå¦‚ ****<code>https://github.com/æ—§ç”¨æˆ·å/repo</code>ï¼‰ä¼š **è‡ªåŠ¨é‡å®šå‘åˆ°æ–°åœ°å€</p><p><em><strong>ä½†</strong>ï¼š</em> &#x2F;&#x2F;&#x2F;<strong>é‡å®šå‘ä»…ä¿ç•™å‡ ä¸ªæœˆï¼Œä¹‹åå¯èƒ½å¤±æ•ˆï¼Œå»ºè®®å°½å¿«æ›´æ–°æ‰€æœ‰å¼•ç”¨</strong>&#x2F;&#x2F;&#x2F;</p><p>****&#x2F;&#x2F;&#x2F;<strong>å¦‚æœæ—§ç”¨æˆ·åè¢«ä»–äººæ³¨å†Œï¼Œé‡å®šå‘ä¼šå¤±æ•ˆ</strong>&#x2F;&#x2F;&#x2F;</p><p>****&#x2F;&#x2F;&#x2F;<strong>ä¾èµ–æ—§ URL çš„æœåŠ¡ï¼ˆå¦‚ CI&#x2F;CDã€ä¹¦ç­¾ï¼‰éœ€æ‰‹åŠ¨æ›´æ–°</strong>&#x2F;&#x2F;&#x2F;</p><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li><strong>ç¡®ä¿æœ¬åœ°ä»“åº“å·²ä¸è¿œç¨‹åŒæ­¥ï¼ˆ</strong><code>git push</code>ï¼‰ã€‚</li><li><strong>å¯¼å‡ºä»“åº“åˆ—è¡¨ï¼ˆå¯é€‰ï¼Œç”¨äºåç»­æ£€æŸ¥ï¼‰ã€‚</strong></li></ul><p><strong>æ£€æŸ¥ä¾èµ–é¡¹</strong>ï¼š</p><ul><li><strong>ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆå¦‚ CI&#x2F;CDã€åŸŸåç»‘å®šã€OAuth ç™»å½•ï¼‰æ˜¯å¦ä¾èµ–ä½ çš„æ—§ç”¨æˆ·åã€‚</strong></li><li><strong>æ–‡æ¡£ã€READMEã€å¤–éƒ¨é“¾æ¥ä¸­æ˜¯å¦æœ‰ç›´æ¥å¼•ç”¨æ—§ç”¨æˆ·åçš„ URLã€‚</strong></li></ul><h2 id="æ›´æ”¹ç”¨æˆ·å"><a href="#æ›´æ”¹ç”¨æˆ·å" class="headerlink" title="æ›´æ”¹ç”¨æˆ·å"></a><strong>æ›´æ”¹ç”¨æˆ·å</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GitHubï¼ŒSettings â†’ Account â†’ Change username</span><br></pre></td></tr></table></figure><h2 id="æ›´æ”¹å"><a href="#æ›´æ”¹å" class="headerlink" title="æ›´æ”¹å"></a>æ›´æ”¹å</h2><p><strong>æ‰€æœ‰æœ¬åœ°ä»“åº“çš„è¿œç¨‹ URL éœ€æ‰‹åŠ¨æ›´æ–°ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹å½“å‰è¿œç¨‹ URLï¼ˆæ ¼å¼ä¸ºæ—§ç”¨æˆ·åï¼‰</span><br><span class="line">git remote -v</span><br><span class="line"></span><br><span class="line"># æ›´æ–°è¿œç¨‹ URLï¼ˆæ›¿æ¢ä¸ºæ–°ç”¨æˆ·åï¼‰</span><br><span class="line">git remote set-url origin https://github.com/æ–°ç”¨æˆ·å/ä»“åº“å.git</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¸»é¡µprofileç¾åŒ–</title>
      <link href="/2025/03/08/Github/%E4%BF%9D%E5%A7%86%E7%BA%A7GitHub%E4%B8%BB%E9%A1%B5%E7%BE%8E%E5%8C%96%E6%95%99%E7%A8%8B/"/>
      <url>/2025/03/08/Github/%E4%BF%9D%E5%A7%86%E7%BA%A7GitHub%E4%B8%BB%E9%A1%B5%E7%BE%8E%E5%8C%96%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¿å§†çº§GitHubä¸»é¡µç¾åŒ–æ•™ç¨‹"><a href="#ä¿å§†çº§GitHubä¸»é¡µç¾åŒ–æ•™ç¨‹" class="headerlink" title="ä¿å§†çº§GitHubä¸»é¡µç¾åŒ–æ•™ç¨‹"></a>ä¿å§†çº§GitHubä¸»é¡µç¾åŒ–æ•™ç¨‹</h1><p><img src="https://bu.dusays.com/2025/04/03/67ee9d10540d0.png" alt="image-omub.png"></p><p><strong>å®é™…ä¸Šè¿™äº›éƒ½å­˜åœ¨ä¸€ä¸ªREADMEæ–‡ä»¶é‡Œ</strong></p><p><strong>ä¸‹é¢æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥å»ºè®¾ä½ çš„GitHubä¸»é¡µ</strong></p><h3 id="GitHubä¸­çš„åˆå§‹æ“ä½œ"><a href="#GitHubä¸­çš„åˆå§‹æ“ä½œ" class="headerlink" title="GitHubä¸­çš„åˆå§‹æ“ä½œ"></a>GitHubä¸­çš„åˆå§‹æ“ä½œ</h3><p><img src="https://bu.dusays.com/2025/04/03/67ee993411203.png" alt="image-20241109134411796.png"></p><p><img src="https://bu.dusays.com/2025/04/03/67ee996eb9961.png" alt="image-20250203234004362.png"></p><p>å¤åˆ¶ä»“åº“åœ°å€</p><p><img src="https://bu.dusays.com/2025/04/03/67ee996bcc98c.png" alt="image-isgp.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ‰¾ä¸€ä¸ªä½ æƒ³è¦å­˜å‚¨åœ¨æœ¬åœ°çš„æ–‡ä»¶åœ°å€</span><br><span class="line">å³é”®Open Git Bash here</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee996b63d18.png" alt="image-20241109140014319.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone +PasteæŠŠåˆšæ‰å¤åˆ¶çš„åœ°å€ç²˜è´´è¿‡æ¥    å›è½¦</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee996c1f224.png" alt="image-20241109140335008.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tip:å¦‚æœæœ‰æŠ¥é”™å¾ˆå¤šæƒ…å†µæ˜¯æ¢¯å­ä¸ç¨³å®šï¼Œæ²¡æœ‰è¿æ¥åˆ°gitä»“åº“ï¼Œå¤šå…³é—­åˆ·æ–°åå¤è¯•è¯•</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee996c2fe64.png" alt="image-20241109140636576.png"></p><h2 id="ç¼–è¯‘å™¨"><a href="#ç¼–è¯‘å™¨" class="headerlink" title="ç¼–è¯‘å™¨"></a>ç¼–è¯‘å™¨</h2><p><strong>è¿™é‡Œæ‹¿VS Codeç¤ºèŒƒ</strong></p><h3 id="éœ€è¦å®‰è£…çš„æ’ä»¶"><a href="#éœ€è¦å®‰è£…çš„æ’ä»¶" class="headerlink" title="éœ€è¦å®‰è£…çš„æ’ä»¶"></a>éœ€è¦å®‰è£…çš„æ’ä»¶</h3><p><img src="https://bu.dusays.com/2025/04/03/67ee99362db03.png" alt="image-20241109133836426.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹è½½å®Œæ’ä»¶ä¹‹å</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee993b71331.png" alt="image-20241109134227028.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ‰€ç¼–å†™çš„ç»„ä»¶æ˜¯æŒ‰é¡ºåºæ’åˆ—çš„</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee9971ebdea.png" alt="image-20241109135735804.png"></p><h4 id="ä»£ç ç»“æ„è¯¦è§£"><a href="#ä»£ç ç»“æ„è¯¦è§£" class="headerlink" title="ä»£ç ç»“æ„è¯¦è§£"></a>ä»£ç ç»“æ„è¯¦è§£</h4><p><img src="https://bu.dusays.com/2025/04/03/67ee99740993b.png" alt="image-20241109141238195.png"></p><h4 id="ä¸€èˆ¬æ ¼å¼æ¨¡æ¿"><a href="#ä¸€èˆ¬æ ¼å¼æ¨¡æ¿" class="headerlink" title="ä¸€èˆ¬æ ¼å¼æ¨¡æ¿"></a>ä¸€èˆ¬æ ¼å¼æ¨¡æ¿</h4><p><strong>ï¼ˆå¯ä»¥å…ˆå¤åˆ¶åˆ°è‡ªå·±çš„ç¼–è¯‘å™¨é‡Œï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;p align=&quot;center&quot;&gt;</span><br><span class="line">  &lt;img src=&quot;&quot; /&gt;</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹é¢æˆ‘ä»¬æ¥é€ä¸€å®ç°ç»„ä»¶çš„ä»£ç </span><br></pre></td></tr></table></figure><h2 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h2><h3 id="æµ·æµªæ•ˆæœè¾¹é¥°"><a href="#æµ·æµªæ•ˆæœè¾¹é¥°" class="headerlink" title="æµ·æµªæ•ˆæœè¾¹é¥°"></a>æµ·æµªæ•ˆæœè¾¹é¥°</h3><p><strong>ç½‘ç«™</strong></p><p><a href="https://capsule-render.vercel.app/">https://capsule-render.vercel.app/</a></p><p><img src="https://bu.dusays.com/2025/04/03/67ee993f06de3.png" alt="image-20241108231511744.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å·¦ä¾§é€‰æ‹©å®Œå</span><br><span class="line">ç‚¹å‡»å³ä¾§â€œCopyâ€</span><br><span class="line">å¤åˆ¶åˆ°æ¨¡æ¿çš„â€œsrcâ€å±æ€§å</span><br></pre></td></tr></table></figure><p><strong>æ›´å¤šå…·ä½“æ ·å¼å‚è€ƒ</strong></p><p><a href="https://github.com/kyechan99/capsule-render?tab=readme-ov-file#color">https://github.com/kyechan99/capsule-render?tab=readme-ov-file#color</a></p><p><img src="https://bu.dusays.com/2025/04/03/67ee993597645.png" alt="image-20241108231452249.png"></p><h3 id="æ‰“å­—æœºåŠ¨ç”»"><a href="#æ‰“å­—æœºåŠ¨ç”»" class="headerlink" title="æ‰“å­—æœºåŠ¨ç”»"></a>æ‰“å­—æœºåŠ¨ç”»</h3><p><strong>ç½‘ç«™</strong></p><p><a href="https://readme-typing-svg.demolab.com/demo/">https://readme-typing-svg.demolab.com/demo/</a></p><p><img src="https://bu.dusays.com/2025/04/03/67ee993d28549.png" alt="image-20241108230812485.png"></p><h3 id="æŠ€æœ¯æ ˆå›¾æ ‡"><a href="#æŠ€æœ¯æ ˆå›¾æ ‡" class="headerlink" title="æŠ€æœ¯æ ˆå›¾æ ‡"></a>æŠ€æœ¯æ ˆå›¾æ ‡</h3><p><strong>ç½‘ç«™ï¼ˆéœ€è¦æŒ‚æ¢¯å­ï¼‰</strong></p><p><a href="https://marwin1991.github.io/profile-technology-icons/">https://marwin1991.github.io/profile-technology-icons/</a></p><p><img src="https://bu.dusays.com/2025/04/03/67ee993feb07a.png" alt="image-20241108225831578.png"></p><h3 id="è´¡çŒ®çƒ­åº¦è¡¨"><a href="#è´¡çŒ®çƒ­åº¦è¡¨" class="headerlink" title="è´¡çŒ®çƒ­åº¦è¡¨"></a>è´¡çŒ®çƒ­åº¦è¡¨</h3><p><strong>ç½‘ç«™</strong></p><p><a href="https://github-readme-streak-stats.herokuapp.com/demo/">https://github-readme-streak-stats.herokuapp.com/demo/</a></p><p><img src="https://bu.dusays.com/2025/04/03/67ee9996225ee.png" alt="image-20241109150452284.png"></p><h3 id="å¡ç‰‡"><a href="#å¡ç‰‡" class="headerlink" title="å¡ç‰‡"></a>å¡ç‰‡</h3><p><strong>ç½‘ç«™</strong></p><p><a href="https://tools.bugdesigner.cn/#/gen_card">https://tools.bugdesigner.cn/#/gen_card</a></p><h4 id="ä¸ªäººæŒ‡æ ‡æ¨¡å—"><a href="#ä¸ªäººæŒ‡æ ‡æ¨¡å—" class="headerlink" title="ä¸ªäººæŒ‡æ ‡æ¨¡å—"></a>ä¸ªäººæŒ‡æ ‡æ¨¡å—</h4><p><img src="https://bu.dusays.com/2025/04/03/67ee993de311f.png" alt="image-20241108231807726.png"></p><p><strong>æ›´å¤šä¸»é¢˜</strong></p><p><a href="https://github.com/anuraghazra/github-readme-stats">https://github.com/anuraghazra/github-readme-stats</a></p><p><img src="https://bu.dusays.com/2025/04/03/67ee997514304.png" alt="image-20241109142125669.png"></p><p>**ä¸»é¢˜ä¿®æ”¹è¯¦æƒ…è§ä¸Šæ–‡â€œ**<strong>ä»£ç ç»“æ„è¯¦è§£</strong>â€</p><p><strong>è¿˜æ˜¯å¡ç‰‡çš„é‚£ä¸ªç½‘ç«™</strong></p><p><a href="https://tools.bugdesigner.cn/#/gen_card">https://tools.bugdesigner.cn/#/gen_card</a></p><h4 id="å¸¸ç”¨è¯­è¨€æ¨¡å—"><a href="#å¸¸ç”¨è¯­è¨€æ¨¡å—" class="headerlink" title="å¸¸ç”¨è¯­è¨€æ¨¡å—"></a>å¸¸ç”¨è¯­è¨€æ¨¡å—</h4><p><img src="https://bu.dusays.com/2025/04/03/67ee99765d728.png" alt="image-20241109142657266.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ³¨ï¼šå¤åˆ¶ä»£ç éœ€è¦ä¿è¯usernameå±æ€§æ›´æ”¹ä¸ºè‡ªå·±çš„</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">themeå±æ€§å¯ä»¥è‡ªè¡Œæ·»åŠ ï¼Œå’Œä¸ªäººæŒ‡æ ‡æ¨¡å—å¯ç”¨çš„ä¸»é¢˜ä¸€è‡´</span><br></pre></td></tr></table></figure><h4 id="ä»“åº“å›ºå®šæ¨¡å—"><a href="#ä»“åº“å›ºå®šæ¨¡å—" class="headerlink" title="ä»“åº“å›ºå®šæ¨¡å—"></a>ä»“åº“å›ºå®šæ¨¡å—</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¯å°†æŸäº›ä»“åº“å›ºå®šåœ¨READMEä¸­å±•ç¤º</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee996a1794b.png" alt="image-20241109143443105.png"></p><p><img src="https://bu.dusays.com/2025/04/03/67ee9992aead6.png" alt="image-20241109143412576.png"></p><h4 id="WakaTime-ç»Ÿè®¡å¡"><a href="#WakaTime-ç»Ÿè®¡å¡" class="headerlink" title="WakaTime ç»Ÿè®¡å¡"></a>WakaTime ç»Ÿè®¡å¡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ ¹æ®ä»¥ä¸Šæ“ä½œï¼Œæƒ³å¿…ä½ å·²ç»æ”¶æ‚‰äº†å¤§è‡´æµç¨‹ï¼Œè¯¥WakaTimeçš„éƒ¨ç½²æ–¹å¼ä¸ä¸Šè¿°æ“ä½œä¸€è‡´</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee9992bf317.png" alt="image-20241109143646929.png"></p><p>è¯¦æƒ…è§  <a href="https://capsule-render.vercel.app/">https://capsule-render.vercel.app/</a></p><h3 id="è´ªåƒè›‡"><a href="#è´ªåƒè›‡" class="headerlink" title="è´ªåƒè›‡"></a>è´ªåƒè›‡</h3><p><strong>å‚è€ƒè§†é¢‘ï¼š</strong><a href="https://www.bilibili.com/video/BV1W94y1v7cB/?spm_id_from=333.337.search-card.all.click">ç»™Githubä¸»é¡µåŠ ä¸Šè´ªåƒè›‡æ•ˆæœï¼Œè®©ä½ çš„ä¸»é¡µä¸ä¼—ä¸åŒ<em>å“”å“©å“”å“©</em>bilibili</a></p><p><strong>ä¸å¤ªå¥½é…ç½®ï¼Œå»ºè®®æ¯ä¸€æ­¥éƒ½è·Ÿç€æ¥</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºmain.ymlæ–‡ä»¶</span><br><span class="line">æ–‡ä»¶è·¯å¾„:</span><br><span class="line">.github/workflows/main.yml</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee99932b45f.png" alt="image-20241109144506704.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶åˆ°main.ymlæ–‡ä»¶ä¸­</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">name: generate animation</span><br><span class="line"></span><br><span class="line">on:</span><br><span class="line">  # run automatically every 24 hours</span><br><span class="line">  schedule:</span><br><span class="line">    - cron: &#x27;0 */24 * * *&#x27;</span><br><span class="line"></span><br><span class="line">  # allows to manually run the job at any time</span><br><span class="line">  workflow_dispatch:</span><br><span class="line"></span><br><span class="line">  # run on every push on the master branch</span><br><span class="line">  push:</span><br><span class="line">    branches:</span><br><span class="line">      - main</span><br><span class="line"></span><br><span class="line">jobs:</span><br><span class="line">  generate:</span><br><span class="line">    runs-on: ubuntu-latest</span><br><span class="line">    timeout-minutes: 10</span><br><span class="line"></span><br><span class="line">    steps:</span><br><span class="line">      # generates a snake game from a github user (&lt;github_user_name&gt;) contributions graph, output a svg animation at &lt;svg_out_path&gt;</span><br><span class="line">      - name: generate github-contribution-grid-snake.svg</span><br><span class="line">        uses: Platane/snk/svg-only@v3</span><br><span class="line">        with:</span><br><span class="line">          github_user_name: $&#123;&#123; github.repository_owner &#125;&#125;</span><br><span class="line">          outputs: |</span><br><span class="line">            dist/github-contribution-grid-snake.svg</span><br><span class="line">            dist/github-contribution-grid-snake-dark.svg?palette=github-dark</span><br><span class="line">        env:</span><br><span class="line">          GITHUB_TOKEN: $&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125;</span><br><span class="line"></span><br><span class="line">      # push the content of &lt;build_dir&gt; to a branch</span><br><span class="line">      # the content will be available at https://raw.githubusercontent.com/&lt;github_user&gt;/&lt;repository&gt;/&lt;target_branch&gt;/&lt;file&gt; , or as github page</span><br><span class="line">      - name: push github-contribution-grid-snake.svg to the output branch</span><br><span class="line">        uses: crazy-max/ghaction-github-pages@v3.1.0</span><br><span class="line">        with:</span><br><span class="line">          target_branch: output</span><br><span class="line">          build_dir: dist</span><br><span class="line">        env:</span><br><span class="line">          GITHUB_TOKEN: $&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>README.mdè´ªåƒè›‡ä»£ç </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ³¨æ„æ›´æ”¹ç”¨æˆ·å</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;picture&gt;</span><br><span class="line">  &lt;source media=&quot;(prefers-color-scheme: dark)&quot; srcset=&quot;https://raw.githubusercontent.com/ç”¨æˆ·å/ç”¨æˆ·å/output/github-contribution-grid-snake-dark.svg&quot;&gt;</span><br><span class="line">  &lt;source media=&quot;(prefers-color-scheme: light)&quot; srcset=&quot;https://raw.githubusercontent.com/ç”¨æˆ·å/ç”¨æˆ·å/output/github-contribution-grid-snake.svg&quot;&gt;</span><br><span class="line">  &lt;img alt=&quot;github contribution grid snake animation&quot; src=&quot;https://raw.githubusercontent.com/ç”¨æˆ·å/ç”¨æˆ·å/output/github-contribution-grid-snake.svg&quot;&gt;</span><br><span class="line">&lt;/picture&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ­¤æ—¶ä½ çš„é¢„è§ˆä¸­çœ‹ä¸è§è´ªåƒè›‡çš„ç»„ä»¶ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œæˆ‘ä»¬æ¥ç€ä¸‹ä¸€æ­¥èµ°</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æäº¤ä½ çš„æœ¬åœ°ä»£ç åˆ°GitHubä»“åº“ï¼Œè¯¦æƒ…è§ä¸‹æ–‡â€œæäº¤æœ¬åœ°ä»£ç è‡³GitHubâ€</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">main.ymlæ–‡ä»¶çš„æœ¬è´¨ä¼šåˆ›å»ºä¸€ä¸ªoutputåˆ†æ”¯å¹¶æ¨é€ä»£ç ï¼Œä½†æ˜¯æ‰§è¡Œæ­¤æ“ä½œGitHubéœ€è¦é…ç½®ä¸€å®šçš„æƒé™</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee99956ac52.png" alt="image-20241109145536992.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸Šæ–¹æ³•æˆäºˆå·¥ä½œæµè¯»å†™æƒé™å</span><br><span class="line">åˆ°Actionç›®å½•ï¼Œç‚¹å‡»Re-run jobsçš„Re-runï¼Œé‡æ–°æ‰§è¡Œå¤±è´¥çš„ä»»åŠ¡</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee9993c479c.png" alt="image-20241109145648691.png"></p><p><strong>ç­‰å¾…ä¸‰äº”åˆ†é’Ÿä¹‹åå³å¯å®Œæˆè´ªåƒè›‡çš„éƒ¨ç½²</strong></p><h2 id="æäº¤æœ¬åœ°ä»£ç è‡³GitHub"><a href="#æäº¤æœ¬åœ°ä»£ç è‡³GitHub" class="headerlink" title="æäº¤æœ¬åœ°ä»£ç è‡³GitHub"></a>æäº¤æœ¬åœ°ä»£ç è‡³GitHub</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æä¸€å˜´Open Git Bash hereçš„åœ°å€</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee9992c7baa.png" alt="image-20241109143924621.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä¾æ¬¡æ‰§è¡Œ(å¯¹ç©ºæ ¼å’Œè‹±æ–‡åŒå¼•å·æœ‰ä¸¥æ ¼è¦æ±‚)</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;init&quot;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><h2 id="æ›´å¤š"><a href="#æ›´å¤š" class="headerlink" title="æ›´å¤š"></a>æ›´å¤š</h2><p><strong>åˆ°æ­¤æ‰€æœ‰æ­¥éª¤å°±ç»“æŸå•¦ï¼Œè¿˜æœ‰ä¸€äº›æ²¡æåˆ°çš„ç»„ä»¶ç½‘ç«™æ”¾åœ¨è¿™é‡Œï¼Œå¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥å°è¯•å°è¯•</strong></p><p><a href="https://shields.io/">https://shields.io/</a><br><a href="https://quira.sh/">https://quira.sh/</a><br><a href="https://progvtblogo.asanatsa.cc/">https://progvtblogo.asanatsa.cc/</a></p>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ–°ç‰ˆgitæ¨é€æ³¨æ„ç‚¹</title>
      <link href="/2025/03/08/Github/%E6%96%B0%E7%89%88git%E6%8E%A8%E9%80%81%E6%B3%A8%E6%84%8F%E7%82%B9/"/>
      <url>/2025/03/08/Github/%E6%96%B0%E7%89%88git%E6%8E%A8%E9%80%81%E6%B3%A8%E6%84%8F%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="æ–°ç‰ˆgitæ¨é€æ³¨æ„ç‚¹"><a href="#æ–°ç‰ˆgitæ¨é€æ³¨æ„ç‚¹" class="headerlink" title="æ–°ç‰ˆgitæ¨é€æ³¨æ„ç‚¹"></a>æ–°ç‰ˆgitæ¨é€æ³¨æ„ç‚¹</h1><p><strong>ä¸€åˆ‡çš„å¼€å§‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure><p><strong>æ—§ç‰ˆæœ¬GitæŒ‡ä»¤ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªæœ¬åœ°çš„masteråˆ†æ”¯</strong></p><p><img src="/upload/image-20250128151124085.png" alt="image-20250128151124085.png"></p><p><strong>æˆ‘æ˜¯win 2.42ç‰ˆæœ¬</strong></p><p><img src="/upload/image-20250128151406928.png" alt="image-20250128151406928.png"></p><p><strong>ä½†æ˜¯</strong></p><p><strong>åœ¨è¾ƒæ–°çš„GitHubçš„æ–°ä»“åº“ä¸­ï¼Œé»˜è®¤çš„åˆå§‹åˆ†æ”¯åç§°å·²ç»ä»masterå˜æ›´ä¸ºmain</strong></p><p><strong>å¦‚æœæˆ‘ä»¬ç›´æ¥ä¸€å¥—æ¨é€ä¸Šå»ä¼šç›´æ¥æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œä¼šç›´æ¥æ¨é€åˆ°è¿œç¨‹çš„masteråˆ†æ”¯ä¸Šï¼Œè€Œå½“å‰é»˜è®¤çš„ä¸»åˆ†æ”¯mainä¸Šæ²¡æœ‰ä¸œè¥¿</strong></p><p><strong>ç„¶åæˆ‘å»å°è¯•äº†ä¸€ä¸‹æ›´æ–°Gitç‰ˆæœ¬</strong></p><blockquote><p><strong>è®¿é—®</strong><a href="https://gitforwindows.org/?spm=5176.28103460.0.0.65235d27rZxmXv">Git for Windows</a>å®˜æ–¹ç½‘ç«™ï¼Œå®‰è£…æœ€æ–°ç‰ˆGit 2.47</p></blockquote><p><strong>ç„¶åæˆ‘å‘ç°git initè¿˜æ˜¯é»˜è®¤masteråˆ†æ”¯</strong></p><p><strong>æœ€åè¿˜æ˜¯å…ˆå…»æˆä¹ æƒ¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init -b main</span><br></pre></td></tr></table></figure><p><strong>åˆ‡åˆ°æŒ‡å®šåˆ†æ”¯åˆ›å»º</strong></p><p><strong>æ¥ä¸‹æ¥</strong></p><p><strong>è¿æ¥è¿œç¨‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin ä»“åº“åœ°å€</span><br></pre></td></tr></table></figure><p><strong>æ¨é€ä¸‰ä»¶å¥—</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;æ³¨é‡Š&quot;</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>gitåŸºç¡€æŒ‡ä»¤é›†</title>
      <link href="/2025/03/08/Github/git%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"/>
      <url>/2025/03/08/Github/git%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="git"><a href="#git" class="headerlink" title="git"></a>git</h1><h2 id="git-çš„è¿è¡Œæœºåˆ¶"><a href="#git-çš„è¿è¡Œæœºåˆ¶" class="headerlink" title="git çš„è¿è¡Œæœºåˆ¶"></a>git çš„è¿è¡Œæœºåˆ¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitåˆ†ä¸ºæœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“ï¼Œæˆ‘ä»¬ä¸€èˆ¬æƒ…å†µéƒ½æ˜¯å†™å®Œä»£ç ï¼Œcommitåˆ°æœ¬åœ°ä»“åº“ï¼ˆç”Ÿæˆæœ¬åœ°ä»“çš„commit IDï¼Œä»£è¡¨å½“å‰æäº¤ä»£ç çš„ç‰ˆæœ¬å·ï¼‰ï¼Œç„¶åpushåˆ°è¿œç¨‹ä»“åº“ï¼ˆè®°å½•è¿™ä¸ªç‰ˆæœ¬å·ï¼‰</span><br></pre></td></tr></table></figure><h2 id="git-config-é…ç½®"><a href="#git-config-é…ç½®" class="headerlink" title="git config(é…ç½®)"></a>git config(é…ç½®)</h2><p><strong>ä¸€ä¸ªç³»ç»Ÿåªéœ€è¦é…ç½®ä¸€æ¬¡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;chen&quot;</span><br><span class="line">git config --global user.email &quot;xxx@qq.com&quot;</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶çš„çŠ¶æ€"><a href="#æ–‡ä»¶çš„çŠ¶æ€" class="headerlink" title="æ–‡ä»¶çš„çŠ¶æ€"></a>æ–‡ä»¶çš„çŠ¶æ€</h2><h4 id="æŸ¥çœ‹"><a href="#æŸ¥çœ‹" class="headerlink" title="æŸ¥çœ‹"></a>æŸ¥çœ‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure><h5 id="æœªè·Ÿè¸ª"><a href="#æœªè·Ÿè¸ª" class="headerlink" title="æœªè·Ÿè¸ª"></a>æœªè·Ÿè¸ª</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//add .å‰</span><br></pre></td></tr></table></figure><h5 id="å·²è·Ÿè¸ª"><a href="#å·²è·Ÿè¸ª" class="headerlink" title="å·²è·Ÿè¸ª"></a>å·²è·Ÿè¸ª</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">staged      //æš‚ç¼“åŒºä¸­çš„æ–‡ä»¶çŠ¶æ€,ä¹Ÿå°±æ˜¯index</span><br><span class="line">Unmodified  //commitå‘½ä»¤ï¼Œå¯ä»¥å°†stagedä¸­æ–‡ä»¶æäº¤åˆ°Gitä»“åº“</span><br><span class="line">Modified    //ä¿®æ”¹äº†æŸä¸ªæ–‡ä»¶åï¼Œä¼šå¤„äºModifiedçŠ¶æ€;</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240709164956512.png" alt="image-20240709164956512.png"></p><h2 id="SSHå¯†é’¥"><a href="#SSHå¯†é’¥" class="headerlink" title="SSHå¯†é’¥"></a>SSHå¯†é’¥</h2><p><img src="/upload/image-20240709215925092.png" alt="image-20240709215925092.png"></p><h2 id="è·å–gitä»“åº“"><a href="#è·å–gitä»“åº“" class="headerlink" title="è·å–gitä»“åº“"></a>è·å–gitä»“åº“</h2><h4 id="æ“ä½œæµç¨‹å›¾"><a href="#æ“ä½œæµç¨‹å›¾" class="headerlink" title="æ“ä½œæµç¨‹å›¾"></a>æ“ä½œæµç¨‹å›¾</h4><p><img src="/upload/image-20240709165543658.png" alt="image-20240709165543658.png"></p><p><strong>gitä¸Šåˆ›å»ºæ–°ä»“åº“</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ç•Œé¢å³ä¸Šè§’&quot;+&quot;</span><br><span class="line"></span><br><span class="line">New repository</span><br><span class="line"></span><br><span class="line">ä»“åº“åå­—åŠ æè¿°</span><br><span class="line"></span><br><span class="line">Create repository</span><br></pre></td></tr></table></figure><p><strong>å»ºç«‹æœ¬åœ°ä»“åº“</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ä»¶æ ¹ç›®å½•å³é”®:Git Bash</span><br><span class="line"></span><br><span class="line">ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤</span><br><span class="line">git init</span><br><span class="line">git add .   //è·Ÿè¸ªæœ¬åœ°æ–‡ä»¶,æ–‡ä»¶å­˜å…¥æš‚å­˜åŒº</span><br><span class="line">git commit -m &quot;æ³¨é‡Š&quot;</span><br></pre></td></tr></table></figure><p><strong>å…³è”githubä»“åº“</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ°githubä»“åº“å¤åˆ¶ä»“åº“åœ°å€</span><br></pre></td></tr></table></figure><p><img src="file:///E:/%E5%9B%BE%E8%A7%A3/github%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80(%E6%8B%9F).webp?lastModify=1724233487"></p><p><img src="/upload/github%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80(%E6%8B%9F).webp" alt="githubä»“åº“åœ°å€(æ‹Ÿ).webp"></p><p><strong>æ‰§è¡ŒæŒ‡ä»¤</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin ...(ä¸ªäººæ–°å»ºä»“åº“åœ°å€)</span><br></pre></td></tr></table></figure><p><strong>ä¸Šä¼ æœ¬åœ°ä»£ç </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><p><strong>ä¸Šä¼ å®Œæˆ</strong></p><p><strong>(å¦‚æœå‡ºç°Are you sure you want to continue connecting (yes&#x2F;no)?)</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yes</span><br></pre></td></tr></table></figure><h4 id="æ›´æ–°ä»“åº“"><a href="#æ›´æ–°ä»“åº“" class="headerlink" title="æ›´æ–°ä»“åº“"></a>æ›´æ–°ä»“åº“</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;æ³¨é‡Š&quot;</span><br><span class="line">git push ä»“åº“åœ°å€ master</span><br></pre></td></tr></table></figure><h4 id="å…‹éš†ä»“åº“"><a href="#å…‹éš†ä»“åº“" class="headerlink" title="å…‹éš†ä»“åº“"></a>å…‹éš†ä»“åº“</h4><p><strong>CodeæŒ‰é’®é‡Œå¤åˆ¶ä»“åº“åœ°å€</strong></p><p><strong>æ¡Œé¢æ–°å»ºæ–‡ä»¶å¤¹</strong></p><p><strong>æ–‡ä»¶å¤¹é‡Œå¼€GitBash</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git clone åœ°å€</span><br></pre></td></tr></table></figure><h4 id="æ—¥å¿—å’Œç‰ˆæœ¬å›é€€"><a href="#æ—¥å¿—å’Œç‰ˆæœ¬å›é€€" class="headerlink" title="æ—¥å¿—å’Œç‰ˆæœ¬å›é€€"></a>æ—¥å¿—å’Œç‰ˆæœ¬å›é€€</h4><p><strong>æ ¡éªŒå’Œ</strong>(SHA-1æ•£åˆ—,å“ˆå¸Œ)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//æ¯æ¬¡æäº¤çš„å”¯ä¸€id</span><br><span class="line">//ç”±40 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦(0-9 å’Œ a-f)ç»„æˆçš„å­—ç¬¦ä¸²ï¼ŒåŸºäº Git ä¸­æ–‡ä»¶çš„å†…å®¹æˆ–ç›®å½•ç»“æ„è®¡ç®—å‡ºæ¥</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240709181505915.png" alt="image-20240709181505915.png"></p><p><strong>æ—¥å¿—</strong> (å†å²ç‰ˆæœ¬è®°å½•)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git log     //æŒ‰ç©ºæ ¼å¯ä»¥ç»§ç»­å¾€ä¸‹æŸ¥çœ‹</span><br><span class="line">æˆ–</span><br><span class="line">//ç®€æ´ç‰ˆ</span><br><span class="line">git log --pretty=on</span><br><span class="line">git reflog</span><br></pre></td></tr></table></figure><p><strong>å›é€€</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD^      //å›é€€ä¸Šä¸ªç‰ˆæœ¬</span><br><span class="line">git reset --hard HEAD^^     //å›é€€ä¸Šä¸Šä¸ªç‰ˆæœ¬</span><br><span class="line">git reset --hard HEAD~100   //å›é€€ä¸Š100ä¸ªç‰ˆæœ¬</span><br><span class="line">git reset --hard 2xwjh73e   //å›é€€åˆ°æŒ‡å®šcommid id(å¯ä»¥åªå†™å‰7ä½)</span><br></pre></td></tr></table></figure><h2 id="å»ºç«‹è¿œç¨‹ä»“åº“è¿æ¥"><a href="#å»ºç«‹è¿œç¨‹ä»“åº“è¿æ¥" class="headerlink" title="å»ºç«‹è¿œç¨‹ä»“åº“è¿æ¥"></a>å»ºç«‹è¿œç¨‹ä»“åº“è¿æ¥</h2><p><strong>è¿æ¥</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin ä»“åº“åœ°å€</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹è¿æ¥</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote</span><br><span class="line">git remote -v</span><br></pre></td></tr></table></figure><h4 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a><strong>åˆ†æ”¯</strong></h4><p><img src="/upload/image-20240712211441114.png" alt="image-20240712211441114.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">master  //ä¸»çº¿</span><br><span class="line">dev     //å¼€å‘</span><br><span class="line">release //é¢„å‘å¸ƒ</span><br><span class="line">hotfix  //çº¿ä¸Šbugä¿®å¤</span><br><span class="line">feature </span><br></pre></td></tr></table></figure><p><strong>æ“ä½œ</strong></p><p><img src="/upload/image-20240712211630760.png" alt="image-20240712211630760.png"></p><p><strong>é¡ºåº</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºåˆ†æ”¯-&gt;ä¿®æ”¹æ–‡ä»¶-&gt;ä¿®æ”¹åçš„æ–‡ä»¶æäº¤åˆ°devä¸­</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºåˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init -b dev         //åˆ›å»ºæ–°åˆ†æ”¯,ä¼šåˆ‡æ¢åˆ°æ–°åˆ†æ”¯</span><br><span class="line">git branch &lt;æ–°åˆ†æ”¯åç§°&gt;   //åˆ›å»ºæ–°åˆ†æ”¯</span><br></pre></td></tr></table></figure><p><strong>åˆ‡æ¢åˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;æ–°åˆ†æ”¯&gt;</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;æ–°åˆ†æ”¯&gt;</span><br></pre></td></tr></table></figure><p><strong>åˆ†æ”¯é‡å‘½å</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -m &lt;æ—§åˆ†æ”¯&gt; &lt;æ–°åˆ†æ”¯&gt;</span><br></pre></td></tr></table></figure><p><strong>åˆ é™¤åˆ†æ”¯(è°¨æ…)</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -d &lt;åˆ†æ”¯&gt;  //åˆ é™¤å·²åˆå¹¶è¿‡çš„åˆ†æ”¯</span><br><span class="line">git branch -D &lt;åˆ†æ”¯&gt;  //å¼ºåˆ¶åˆ é™¤åˆ†æ”¯</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹ç‰ˆæœ¬åº“æœ‰å“ªäº›åˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹ç‰ˆæœ¬åº“çŠ¶æ€</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br><span class="line">//æ²¡æœ‰æäº¤å°±git add .</span><br></pre></td></tr></table></figure><p><strong>åˆå¹¶åˆ°å½“å‰åˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge &lt;éœ€è¦è¢«åˆå¹¶çš„åˆ†æ”¯&gt;</span><br></pre></td></tr></table></figure><p><strong>ä»æŒ‡å®šè¿œç¨‹ä»“åº“è·å–</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master(å¯æ¢) </span><br></pre></td></tr></table></figure><p><strong>å¦‚æœæƒ³ç›´æ¥æ‰§è¡Œgit fetch</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//å…ˆç»™å½“å‰åˆ†æ”¯è®¾ç½®ä¸€ä¸ªè·Ÿè¸ªåˆ†æ”¯</span><br><span class="line">git branch --set-upstream-to=origin/master</span><br><span class="line">git pull</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºä¸€ä¸ªåˆ†æ”¯æ¥è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --track dev origin/master</span><br></pre></td></tr></table></figure><h4 id="forkä¸PR"><a href="#forkä¸PR" class="headerlink" title="forkä¸PR"></a>forkä¸PR</h4><p><strong>PR</strong> : <em>pull request</em> <em>æ‹‰å–è¯·æ±‚</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å…ˆforkæŠŠåˆ«äººçš„é¡¹ç›®å¤åˆ¶åˆ°è‡ªå·±çš„è¿œç¨‹ä»“åº“é‡Œ</span><br><span class="line">&lt;&gt;Codeè·å¾—ä»“åº“çš„åœ°å€</span><br><span class="line">ç”µè„‘åˆ›å»ºæ–‡ä»¶å¤¹,Git Bashæ‰“å¼€</span><br><span class="line">git clone &lt;åœ°å€&gt;</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹æ–‡ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ststus</span><br></pre></td></tr></table></figure><p><strong>æäº¤</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;æ³¨é‡Š&quot;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><p><strong>åˆå¹¶è¯·æ±‚(PR)</strong></p><p><img src="/upload/image-20240712221944550.png" alt="image-20240712221944550.png"></p>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>GitHubè‡ªåŠ¨åŒ–éƒ¨ç½²</title>
      <link href="/2025/03/08/Github/GitHub%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/"/>
      <url>/2025/03/08/Github/GitHub%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="GitHubè‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#GitHubè‡ªåŠ¨åŒ–éƒ¨ç½²" class="headerlink" title="GitHubè‡ªåŠ¨åŒ–éƒ¨ç½²"></a>GitHubè‡ªåŠ¨åŒ–éƒ¨ç½²</h1><p><strong>é€šè¿‡ GitHub Actions å®ç°ã€Œæäº¤ä»£ç  â†’ è‡ªåŠ¨æ„å»º â†’ ç”Ÿæˆ Releasesã€</strong></p><p><strong>å®ç°æ­¥éª¤</strong></p><blockquote><p>**åœ¨æœ¬åœ°ä»“åº“ä¸­åˆ›å»º **<code>.github/workflows/build.yml</code></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">name: Build and Release</span><br><span class="line"></span><br><span class="line">on:</span><br><span class="line">  push:</span><br><span class="line">    tags: </span><br><span class="line">      - &#x27;v*&#x27; # å½“æ‰“ tag æ—¶è§¦å‘</span><br><span class="line"></span><br><span class="line">jobs:</span><br><span class="line">  build:</span><br><span class="line">    runs-on: windows-latest</span><br><span class="line"></span><br><span class="line">    steps:</span><br><span class="line">    - uses: actions/checkout@v4</span><br><span class="line"></span><br><span class="line">    - name: Install Node.js</span><br><span class="line">      uses: actions/setup-node@v3</span><br><span class="line">      with:</span><br><span class="line">        node-version: 20</span><br><span class="line"></span><br><span class="line">    - name: Install PNPM</span><br><span class="line">      run: npm install -g pnpm</span><br><span class="line"></span><br><span class="line">    - name: Install Dependencies</span><br><span class="line">      run: pnpm install</span><br><span class="line"></span><br><span class="line">    - name: Build Project</span><br><span class="line">      run: pnpm run build</span><br><span class="line"></span><br><span class="line">    - name: Create Release</span><br><span class="line">      uses: softprops/action-gh-release@v1</span><br><span class="line">      with:</span><br><span class="line">        files: release/*.exe</span><br></pre></td></tr></table></figure><blockquote><p><strong>è§¦å‘æ–¹å¼</strong>ï¼šå½“ä½ åœ¨æœ¬åœ°æ‰“æ ‡ç­¾ï¼ˆå¦‚ <code>git tag v1.0.0</code>ï¼‰å¹¶æ¨é€æ—¶ï¼Œè‡ªåŠ¨æ„å»ºå¹¶å‘å¸ƒ Release</p></blockquote><h2 id="è¿œç¨‹ä»“åº“é…ç½®"><a href="#è¿œç¨‹ä»“åº“é…ç½®" class="headerlink" title="è¿œç¨‹ä»“åº“é…ç½®"></a>è¿œç¨‹ä»“åº“é…ç½®</h2><blockquote><p><strong>GitHub -&gt; ä½ çš„ä»“åº“ -&gt; Settions -&gt; Actions -&gt; General -&gt; é€‰æ‹©Read and write permissionsï¼ˆå·¥ä½œæµæƒé™ï¼‰</strong></p></blockquote><h2 id="æ¨é€"><a href="#æ¨é€" class="headerlink" title="æ¨é€"></a>æ¨é€</h2><p><strong>å¦‚æœä½ ç¬¬ä¸€æ¬¡æ¨é€ä»£ç </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init -b main</span><br></pre></td></tr></table></figure><p><strong>è¿æ¥è¿œç¨‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin ä»“åº“åœ°å€</span><br></pre></td></tr></table></figure><p><strong>æ¨é€ä»£ç </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;æ³¨é‡Š&quot;</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure><p><strong>æ¨é€æ ‡ç­¾ï¼ˆä¹Ÿè¦æï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºæ ‡ç­¾ï¼ˆç‰ˆæœ¬å·æ ¼å¼æ¨è vX.Y.Zï¼‰</span><br><span class="line">git tag -a v1.0.0 -m &quot;Release version 1.0.0&quot;</span><br><span class="line">git push origin v1.0.0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åšå®¢éŸ³ä¹é¡µé¢å®ç°</title>
      <link href="/2025/03/08/%E5%8D%9A%E5%AE%A2/%E5%8D%9A%E5%AE%A2%E9%9F%B3%E4%B9%90%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0/"/>
      <url>/2025/03/08/%E5%8D%9A%E5%AE%A2/%E5%8D%9A%E5%AE%A2%E9%9F%B3%E4%B9%90%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="åšå®¢éŸ³ä¹ç»„ä»¶å®ç°"><a href="#åšå®¢éŸ³ä¹ç»„ä»¶å®ç°" class="headerlink" title="åšå®¢éŸ³ä¹ç»„ä»¶å®ç°"></a>åšå®¢éŸ³ä¹ç»„ä»¶å®ç°</h1><p><strong>è¯¦æƒ…ç§»æ­¥ | å®‰çŸ¥é±¼ | å¤§ä½¬çš„åšå®¢æ–‡ç« </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.anheyu.com/posts/a76e.html</span><br></pre></td></tr></table></figure><h2 id="ä¸€å›¾æµ"><a href="#ä¸€å›¾æµ" class="headerlink" title="ä¸€å›¾æµ"></a>ä¸€å›¾æµ</h2><p><img src="/upload/image-20250131180643649.png" alt="image-20250131180643649.png"></p><h2 id="å¼€æ”¾å¼å…¬ç›ŠAPI"><a href="#å¼€æ”¾å¼å…¬ç›ŠAPI" class="headerlink" title="å¼€æ”¾å¼å…¬ç›ŠAPI"></a>å¼€æ”¾å¼å…¬ç›ŠAPI</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.injahow.cn/meting/?server=:server&amp;type=:type&amp;id=:id&amp;auth=:auth&amp;r=:r</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://meting.qjqq.cn/?server=:server&amp;type=:type&amp;id=:id&amp;auth=:auth&amp;r=:r</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>var/let/const</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/varletconst%E5%8C%BA%E5%88%86/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/varletconst%E5%8C%BA%E5%88%86/</url>
      
        <content type="html"><![CDATA[<h1 id="var-let-conståŒºåˆ†"><a href="#var-let-conståŒºåˆ†" class="headerlink" title="var&#x2F;let&#x2F;conståŒºåˆ†"></a>var&#x2F;let&#x2F;conståŒºåˆ†</h1><h5 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h5><p><strong>var å’Œ let çš„ä½œç”¨åŸŸè§„åˆ™ä¸€æ ·</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å‡½æ•°å¤–ï¼Œæ˜¯å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå‡½æ•°é‡Œï¼Œæ˜¯å½“å‰å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚//å£°æ˜çš„å˜é‡çš„ä½œç”¨åŸŸåªèƒ½æ˜¯å…¨å±€æˆ–è€…æ•´ä¸ªå‡½æ•°å—çš„ã€‚</span><br></pre></td></tr></table></figure><h5 id="é‡å¤å£°æ˜"><a href="#é‡å¤å£°æ˜" class="headerlink" title="é‡å¤å£°æ˜"></a>é‡å¤å£°æ˜</h5><p><strong>var å…è®¸ï¼Œlet&#x2F;constä¸å…è®¸</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function test() &#123;</span><br><span class="line">  var a = 3;</span><br><span class="line">  var a = 4;</span><br><span class="line">  console.log(a) // 4</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>letæ˜¯å—çº§ä½œç”¨åŸŸ</strong></p><p><strong>conståªèƒ½åœ¨å£°æ˜å®ƒä»¬çš„å—çº§ä½œç”¨åŸŸä¸­è®¿é—®</strong></p><p><strong>const&#x2F;letåœ¨å—çº§ä½œç”¨åŸŸå¤–æ— æ³•è®¿é—®å†…éƒ¨å˜é‡ï¼</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(true)&#123;</span><br><span class="line">    const a=1;</span><br><span class="line">&#125;</span><br><span class="line">console.log(a)</span><br></pre></td></tr></table></figure><h5 id="ç»‘å®šå…¨å±€å˜é‡"><a href="#ç»‘å®šå…¨å±€å˜é‡" class="headerlink" title="ç»‘å®šå…¨å±€å˜é‡"></a>ç»‘å®šå…¨å±€å˜é‡</h5><p><strong>åœ¨å…¨å±€ç¯å¢ƒå£°æ˜å˜é‡ï¼Œvarä¼šåœ¨å…¨å±€å¯¹è±¡é‡Œæ–°å»ºä¸€ä¸ªå±æ€§ï¼Œlet&#x2F;constä¸ä¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var foo = &#x27;global&#x27;</span><br><span class="line">let bar = &#x27;global&#x27;</span><br><span class="line"></span><br><span class="line">console.log(this.foo) // global</span><br><span class="line">console.log(this.bar) // undefined</span><br></pre></td></tr></table></figure><p><strong>æ­¤æ—¶letå®šä¹‰çš„å˜é‡å®é™…åœ¨test å‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸Š</strong></p><p><img src="/upload/image-20241104212220166.png" alt="image-20241104212220166.png"></p><h5 id="å˜é‡æå‡ä¸æš‚å­˜æ­»åŒº"><a href="#å˜é‡æå‡ä¸æš‚å­˜æ­»åŒº" class="headerlink" title="å˜é‡æå‡ä¸æš‚å­˜æ­»åŒº"></a><strong>å˜é‡æå‡ä¸æš‚å­˜æ­»åŒº</strong></h5><p><img src="/upload/image-20241104223204685.png" alt="image-20241104223204685.png"></p><p><strong>ä¸Šè¿°ä»£ç çš„ä¾‹å­ä¸­</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">varä¾‹å­å°±æ˜¯å˜é‡æå‡ï¼Œconst/letçš„æŠ¥é”™å°±æ˜¯æš‚æ—¶æ€§æ­»åŒº</span><br></pre></td></tr></table></figure><p><strong>ä»£ç çš„æ‰§è¡ŒåŸç†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»º-&gt;åˆå§‹åŒ–-&gt;èµ‹å€¼</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var å£°æ˜çš„å˜é‡åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºé˜¶æ®µå°±ä¼šè¢«ã€Œåˆ›å»ºã€å’Œã€Œåˆå§‹åŒ–ã€ï¼Œå› æ­¤å¯¹äºæ‰§è¡Œé˜¶æ®µæ¥è¯´ï¼Œå¯ä»¥åœ¨å£°æ˜ä¹‹å‰ä½¿ç”¨ã€‚</span><br><span class="line">let å£°æ˜çš„å˜é‡åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºé˜¶æ®µåªä¼šè¢«ã€Œåˆ›å»ºã€è€Œä¸ä¼šè¢«ã€Œåˆå§‹åŒ–ã€ï¼Œå› æ­¤å¯¹äºæ‰§è¡Œé˜¶æ®µæ¥è¯´ï¼Œå¦‚æœåœ¨å…¶å®šä¹‰æ‰§è¡Œå‰ä½¿ç”¨ï¼Œç›¸å½“äºä½¿ç”¨äº†æœªè¢«åˆå§‹åŒ–çš„å˜é‡ï¼Œä¼šæŠ¥é”™ã€‚</span><br></pre></td></tr></table></figure><p><strong>let ä¸ const å¼‚åŒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å”¯ä¸€åŒºåˆ«å°±åœ¨äº const å£°æ˜çš„æ˜¯ä¸€ä¸ªåªè¯»å˜é‡ï¼Œå£°æ˜ä¹‹åä¸å…è®¸æ”¹å˜å…¶å€¼ã€‚</span><br><span class="line">å› æ­¤ï¼Œconst ä¸€æ—¦å£°æ˜å¿…é¡»åˆå§‹åŒ–ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>TSåŸºç¡€</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/TS%E5%9F%BA%E7%A1%80/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/TS%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="TS"><a href="#TS" class="headerlink" title="TS"></a>TS</h1><h3 id="ç±»å‹ï¼ˆinterfaceï¼‰"><a href="#ç±»å‹ï¼ˆinterfaceï¼‰" class="headerlink" title="ç±»å‹ï¼ˆinterfaceï¼‰"></a>ç±»å‹ï¼ˆinterfaceï¼‰</h3><h5 id="å£°æ˜"><a href="#å£°æ˜" class="headerlink" title="å£°æ˜"></a>å£°æ˜</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let a: string //å˜é‡aåªèƒ½å­˜å‚¨å­—ç¬¦ä¸²</span><br><span class="line">let b: number //å˜é‡aåªèƒ½å­˜å‚¨æ•°å€¼</span><br><span class="line">let c: boolean //å˜é‡aåªèƒ½å­˜å‚¨å¸ƒå°”å€¼</span><br><span class="line">// å‚æ•°xå¿…é¡»æ˜¯æ•°å­—ï¼Œå‚æ•°yä¹Ÿå¿…é¡»æ˜¯æ•°å­—ï¼Œå‡½æ•°è¿”å›å€¼ä¹Ÿå¿…é¡»æ˜¯æ•°å­—</span><br><span class="line">function demo(x:number,y:number):number&#123;</span><br><span class="line"> return x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">string ã€ number ã€ boolean ã€ null ã€ undefined ã€ bigint ã€ symbol ã€ object(Array ã€Function ã€Date ......)</span><br><span class="line">(æ–°)</span><br><span class="line">void ã€ never ã€ unknown ã€ any ã€ enum ã€ tuple</span><br><span class="line">(è‡ªå®šä¹‰)</span><br><span class="line">type ã€ interface</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨ç±»å‹"><a href="#å¸¸ç”¨ç±»å‹" class="headerlink" title="å¸¸ç”¨ç±»å‹"></a>å¸¸ç”¨ç±»å‹</h3><h5 id="å­—é¢é‡"><a href="#å­—é¢é‡" class="headerlink" title="å­—é¢é‡"></a>å­—é¢é‡</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å€¼åªèƒ½æ˜¯å­—â¾¯é‡å€¼ ï¼ˆå€¼æœ¬èº«ï¼‰</span><br></pre></td></tr></table></figure><h5 id="any"><a href="#any" class="headerlink" title="any"></a>any</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//æ˜¾å¼çš„any</span><br><span class="line">let a: any</span><br><span class="line">a = 100</span><br><span class="line">a = &#x27;ä½ å¥½&#x27;</span><br><span class="line">a = false</span><br><span class="line"></span><br><span class="line">//éšå¼çš„any</span><br><span class="line">let b</span><br><span class="line">b = 100</span><br><span class="line">b = &#x27;ä½ å¥½&#x27;</span><br><span class="line">b = false</span><br><span class="line"></span><br><span class="line">let a</span><br><span class="line">let x: string</span><br><span class="line">x = a // â½†è­¦å‘Š</span><br></pre></td></tr></table></figure><h5 id="unknown"><a href="#unknown" class="headerlink" title="unknown"></a>unknown</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//é€‚â½¤äºï¼šå¼€å§‹ä¸çŸ¥é“æ•°æ®çš„å…·ä½“ç±»å‹ï¼ŒåæœŸæ‰èƒ½ç¡®å®šæ•°æ®çš„ç±»å‹</span><br><span class="line">let a: unknown</span><br><span class="line">a = 100</span><br><span class="line">a = false</span><br><span class="line">a = &#x27;ä½ å¥½&#x27;</span><br><span class="line"></span><br><span class="line">let x: string</span><br><span class="line">x = a // è­¦å‘Šï¼šä¸èƒ½å°†â€œunknownâ€åˆ†é…ç»™â€œstring</span><br></pre></td></tr></table></figure><h5 id="never"><a href="#never" class="headerlink" title="never"></a>never</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">let a: never</span><br><span class="line">// è­¦å‘Š</span><br><span class="line">a = 1</span><br><span class="line">a = true</span><br><span class="line">a = undefined</span><br><span class="line">a = null</span><br><span class="line"></span><br><span class="line">//tså¯ä¸»åŠ¨æ¨æ–­</span><br><span class="line">if(typeof a === &#x27;string&#x27;)&#123;</span><br><span class="line"> a.toUpperCase()</span><br><span class="line">&#125;else&#123;</span><br><span class="line"> console.log(a) // æ¨æ–­å‡ºæ­¤å¤„ä¸ºnever</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//é€‚â½¤äºï¼šé™åˆ¶å‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">// é™åˆ¶demoå‡½æ•°ä¸éœ€è¦æœ‰ä»»ä½•è¿”å›å€¼ï¼Œä»»ä½•å€¼éƒ½ä¸â¾ï¼Œåƒundeifnedã€nulléƒ½ä¸â¾</span><br><span class="line">function demo():never&#123;</span><br><span class="line"> throw new Error(&#x27;ç¨‹åºå¼‚å¸¸é€€å‡º&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="void"><a href="#void" class="headerlink" title="void"></a>void</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//é€‚â½¤äºï¼šé™åˆ¶å‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">let a:void = undefined</span><br><span class="line">// â½†è­¦å‘Š</span><br><span class="line">function demo1():void&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">// â½†è­¦å‘Š</span><br><span class="line">function demo2():void&#123;</span><br><span class="line"> return</span><br><span class="line">&#125;</span><br><span class="line">// â½†è­¦å‘Š</span><br><span class="line">function demo3():void&#123;</span><br><span class="line"> return undefined</span><br><span class="line">&#125;</span><br><span class="line">// æœ‰è­¦å‘Šï¼šä¸èƒ½å°†ç±»å‹â€œnumberâ€åˆ†é…ç»™ç±»å‹â€œvoidâ€</span><br><span class="line">function demo4():void&#123;</span><br><span class="line"> return 666</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="objectï¼ˆä¸å¸¸ç”¨ï¼‰"><a href="#objectï¼ˆä¸å¸¸ç”¨ï¼‰" class="headerlink" title="objectï¼ˆä¸å¸¸ç”¨ï¼‰"></a>objectï¼ˆä¸å¸¸ç”¨ï¼‰</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">let a:object //açš„å€¼å¯ä»¥æ˜¯ä»»ä½•ã€â¾®åŸå§‹å€¼ç±»å‹ã€‘ï¼ŒåŒ…æ‹¬ï¼šå¯¹è±¡ã€å‡½æ•°ã€æ•°ç»„ç­‰</span><br><span class="line"></span><br><span class="line">// ã€â¾®åŸå§‹ç±»å‹ã€‘â½†è­¦å‘Š</span><br><span class="line">a = &#123;&#125;</span><br><span class="line">a = &#123;name:&#x27;å¼ ä¸‰&#x27;&#125;</span><br><span class="line">a = [1,3,5,7,9]</span><br><span class="line">a = function()&#123;&#125;</span><br><span class="line"></span><br><span class="line">// ã€åŸå§‹ç±»å‹ã€‘æœ‰è­¦å‘Š</span><br><span class="line">a = null // è­¦å‘Šï¼šä¸èƒ½å°†ç±»å‹â€œnullâ€åˆ†é…ç»™ç±»å‹â€œobjectâ€</span><br><span class="line">a = undefined // è­¦å‘Šï¼šä¸èƒ½å°†ç±»å‹â€œundefinedâ€åˆ†é…ç»™ç±»å‹â€œobjectâ€</span><br><span class="line">a = 1 // è­¦å‘Šï¼šä¸èƒ½å°†ç±»å‹â€œnumberâ€åˆ†é…ç»™ç±»å‹â€œobjectâ€</span><br><span class="line">a = true // è­¦å‘Šï¼šä¸èƒ½å°†ç±»å‹â€œbooleanâ€åˆ†é…ç»™ç±»å‹â€œobjectâ€</span><br><span class="line">a = &#x27;ä½ å¥½&#x27; // è­¦å‘Šï¼šä¸èƒ½å°†ç±»å‹â€œstringâ€åˆ†é…ç»™ç±»å‹â€œobject</span><br></pre></td></tr></table></figure><h6 id="é™åˆ¶ç±»å‹å†™æ³•"><a href="#é™åˆ¶ç±»å‹å†™æ³•" class="headerlink" title="é™åˆ¶ç±»å‹å†™æ³•"></a>é™åˆ¶ç±»å‹å†™æ³•</h6><p><strong>å¯¹è±¡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let person: &#123; name: string, age?: number&#125; //é—®å·ä»£è¡¨å¯é€‰å±æ€§</span><br><span class="line">let car: &#123; price: number; color: string; [k:string]:any&#125;</span><br><span class="line">let student: &#123;</span><br><span class="line"> id: string</span><br><span class="line"> grade:number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person = &#123;name:&#x27;å¼ ä¸‰&#x27;,age:18&#125;</span><br><span class="line">person = &#123;name:&#x27;æå››&#x27;&#125;</span><br><span class="line">car = &#123;price:100,color:&#x27;çº¢â¾Š&#x27;&#125;</span><br><span class="line">student = &#123;id:&#x27;tetqw76te01&#x27;,grade:3&#125;</span><br></pre></td></tr></table></figure><p><strong>å‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let demo: (a: number, b: number) =&gt; number</span><br><span class="line">demo = function(x,y) &#123;</span><br><span class="line"> return x+y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•°ç»„</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let arr1: string[] // è¯¥â¾ä»£ç ç­‰ä»·äºï¼š let arr1: Array&lt;string&gt;</span><br><span class="line">let arr2: number[] // è¯¥â¾ä»£ç ç­‰ä»·äºï¼š let arr2: Array&lt;number&gt;</span><br><span class="line">arr1 = [&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]</span><br><span class="line">arr2 = [1,3,5,7,9]</span><br></pre></td></tr></table></figure><h5 id="tuple"><a href="#tuple" class="headerlink" title="tuple"></a>tuple</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//é•¿çŸ­å›ºå®šçš„æ•°ç»„</span><br><span class="line">let t: [string,number]</span><br><span class="line">t = [&#x27;hello&#x27;,123]</span><br><span class="line">// è­¦å‘Šï¼Œä¸èƒ½å°†ç±»å‹â€œ[string, number, boolean]â€åˆ†é…ç»™ç±»å‹â€œ[string, number]â€</span><br><span class="line">t = [&#x27;hello&#x27;,123,false]</span><br></pre></td></tr></table></figure><h5 id="enum"><a href="#enum" class="headerlink" title="enum"></a>enum</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//æšä¸¾</span><br><span class="line">// å®šä¹‰â¼€ä¸ªæšä¸¾</span><br><span class="line">enum Color &#123;</span><br><span class="line"> Red,</span><br><span class="line"> Blue,</span><br><span class="line"> Black,</span><br><span class="line"> Gold</span><br><span class="line">&#125;</span><br><span class="line">// å®šä¹‰â¼€ä¸ªæšä¸¾ï¼Œå¹¶æŒ‡å®šå…¶åˆè¯†æ•°å€¼</span><br><span class="line">enum Color2 &#123;</span><br><span class="line"> Red = 6,</span><br><span class="line"> Blue,</span><br><span class="line"> Black,</span><br><span class="line"> Gold</span><br><span class="line">&#125;</span><br><span class="line">console.log(Color)</span><br><span class="line">/*</span><br><span class="line"> &#123;</span><br><span class="line">     0: &#x27;Red&#x27;, 1: &#x27;Blue&#x27;, 2: &#x27;Black&#x27;, 3: &#x27;Gold&#x27;,</span><br><span class="line">     Red: 0, Blue: 1, Black: 2, Gold: 3</span><br><span class="line"> &#125;</span><br><span class="line">*/</span><br><span class="line">console.log(Color2)</span><br><span class="line">/*</span><br><span class="line"> &#123;</span><br><span class="line">     6: &#x27;Red&#x27;,  7: &#x27;Blue&#x27;, 8: &#x27;Black&#x27;, 9: &#x27;Gold&#x27;,</span><br><span class="line">     Red: 6, Blue: 7, Black: 8, Gold: 9</span><br><span class="line"> &#125;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><p><strong>å®ä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// å®šä¹‰â¼€ä¸ªphoneå˜é‡ï¼Œå¹¶è®¾ç½®å¯¹â»¬è¿›â¾é™åˆ¶</span><br><span class="line">let phone: &#123;name:string,price:number,color:Color&#125;</span><br><span class="line"></span><br><span class="line">phone = &#123;name:&#x27;åä¸ºMate60&#x27;,price:6500,color:Color.Red&#125;</span><br><span class="line">phone = &#123;name:&#x27;iPhone15Pro&#x27;,price:7999,color:Color.Blue&#125;</span><br><span class="line"></span><br><span class="line">if(phone.color === Color.Red)&#123;</span><br><span class="line"> console.log(&#x27;â¼¿æœºæ˜¯çº¢â¾Šçš„&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰ç±»"><a href="#è‡ªå®šä¹‰ç±»" class="headerlink" title="è‡ªå®šä¹‰ç±»"></a>è‡ªå®šä¹‰ç±»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// æ€§åˆ«çš„æšä¸¾</span><br><span class="line">enum Gender &#123;</span><br><span class="line"> Male,</span><br><span class="line"> Female</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// â¾ƒå®šä¹‰â¼€ä¸ªå¹´çº§ç±»å‹ï¼ˆâ¾¼â¼€ã€â¾¼â¼†ã€â¾¼ä¸‰ï¼‰</span><br><span class="line">type Grade = 1 | 2 | 3</span><br><span class="line"></span><br><span class="line">// â¾ƒå®šä¹‰â¼€ä¸ªå­¦â½£ç±»å‹</span><br><span class="line">type Student = &#123;</span><br><span class="line"> name:string,</span><br><span class="line"> age:number,</span><br><span class="line"> gender:Gender,</span><br><span class="line"> grade:Grade</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å®šä¹‰ä¸¤ä¸ªå­¦â½£å˜é‡ï¼šs1ã€s2</span><br><span class="line">let s1:Student</span><br><span class="line">let s2:Student</span><br><span class="line"></span><br><span class="line">s1 = &#123;name:&#x27;å¼ ä¸‰&#x27;,age:18,gender:Gender.Male,grade:1&#125;</span><br><span class="line">s2 = &#123;name:&#x27;æå››&#x27;,age:18,gender:Gender.Female,grade:2&#125;</span><br></pre></td></tr></table></figure><h3 id="æŠ½è±¡ç±»"><a href="#æŠ½è±¡ç±»" class="headerlink" title="æŠ½è±¡ç±»"></a>æŠ½è±¡ç±»</h3><p><strong>å¸¸è§„ç±»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line"> name: string</span><br><span class="line"> age: number</span><br><span class="line"> constructor(name:string,age:number)&#123;//æ„é€ å‡½æ•°</span><br><span class="line">     this.name = name</span><br><span class="line">     this.age = age</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const p1 = new Person(&#x27;å¼ ä¸‰&#x27;,18)</span><br><span class="line">const p2 = new Person(&#x27;æå››&#x27;,19)</span><br></pre></td></tr></table></figure><p><strong>ç»§æ‰¿</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123; &#125;</span><br><span class="line"></span><br><span class="line">// Teacherç±»ç»§æ‰¿Person</span><br><span class="line">class Teacher extends Person &#123; &#125;</span><br><span class="line"></span><br><span class="line">// Studentç±»ç»§æ‰¿Person</span><br><span class="line">class Student extends Person &#123; &#125;</span><br><span class="line"></span><br><span class="line">// Personå®ä¾‹</span><br><span class="line">const p1 = new Person(&#x27;å‘¨æ°ä¼¦&#x27;,38)</span><br><span class="line">// Studentå®ä¾‹</span><br><span class="line">const s1 = new Student(&#x27;å¼ åŒå­¦&#x27;,18)</span><br><span class="line">const s2 = new Student(&#x27;æåŒå­¦&#x27;,20)</span><br><span class="line">// Teacherå®ä¾‹</span><br><span class="line">const t1 = new Teacher(&#x27;åˆ˜â½¼å¸ˆ&#x27;,40)</span><br><span class="line">const t2 = new Teacher(&#x27;å­™â½¼å¸ˆ&#x27;,50)</span><br></pre></td></tr></table></figure><p><strong>æŠ½è±¡ç±»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abstract class Person &#123; &#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// Personï¼ˆæŠ½è±¡ç±»ï¼‰</span><br><span class="line">abstract class Person &#123; &#125;</span><br><span class="line"></span><br><span class="line">// Teacherç±»ç»§æ‰¿Person</span><br><span class="line">class Teacher extends Person &#123;</span><br><span class="line"> // æ„é€ å™¨</span><br><span class="line"> constructor(name: string,age: number)&#123;</span><br><span class="line">    super(name,age)</span><br><span class="line"> &#125;</span><br><span class="line"> // â½…æ³•</span><br><span class="line"> speak()&#123;</span><br><span class="line">    console.log(&#x27;ä½ å¥½ï¼æˆ‘æ˜¯â½¼å¸ˆ:&#x27;,this.name)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Studentç±»ç»§æ‰¿Person</span><br><span class="line">class Student extends Person &#123; &#125;</span><br><span class="line">// Personå®ä¾‹</span><br><span class="line">// const p1 = new Person(&#x27;å‘¨æ°ä¼¦&#x27;,38) // æŠ½è±¡ç±»ï¼Œä¸å¯ä»¥new Person</span><br></pre></td></tr></table></figure><h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//é™åˆ¶â¼€ä¸ªç±»ä¸­åŒ…å«å“ªäº›å±æ€§å’Œâ½…æ³•</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// Personæ¥â¼</span><br><span class="line">interface Person &#123;</span><br><span class="line"> // å±æ€§å£°æ˜</span><br><span class="line"> name: string</span><br><span class="line"> age: number</span><br><span class="line"> // â½…æ³•å£°æ˜</span><br><span class="line"> speak():void</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">// Teacherå®ç°Personæ¥â¼</span><br><span class="line">class Teacher implements Person &#123;</span><br><span class="line"> name: string</span><br><span class="line"> age: number</span><br><span class="line"> // æ„é€ å™¨</span><br><span class="line"> constructor(name: string,age: number)&#123;</span><br><span class="line">     this.name = name</span><br><span class="line">     this.age = age</span><br><span class="line"> &#125;</span><br><span class="line"> // â½…æ³•</span><br><span class="line"> speak()&#123;</span><br><span class="line">    console.log(&#x27;ä½ å¥½ï¼æˆ‘æ˜¯â½¼å¸ˆ:&#x27;,this.name)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// æ¥â¼ â€”â€” Personï¼Œåªèƒ½åŒ…å«æŠ½è±¡â½…æ³•</span><br><span class="line">interface Person &#123;</span><br><span class="line"> // å±æ€§ï¼Œä¸å†™å…·ä½“å€¼</span><br><span class="line"> name:string</span><br><span class="line"> age:number</span><br><span class="line"> // â½…æ³•ï¼Œä¸å†™å…·ä½“å®ç°</span><br><span class="line"> speak():void</span><br><span class="line">&#125;</span><br><span class="line">// åˆ›å»ºTeacherç±»å®ç°Personæ¥â¼</span><br><span class="line">class Teacher implements Person &#123;</span><br><span class="line"> name:string</span><br><span class="line"> age:number</span><br><span class="line"> constructor(name:string,age:number)&#123;</span><br><span class="line">     this.name = name</span><br><span class="line">     this.age = age</span><br><span class="line"> &#125;</span><br><span class="line"> speak()&#123;</span><br><span class="line">    console.log(&#x27;æˆ‘åœ¨â»œå¿«çš„â¾â¾›ä¸­......&#x27;)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250127173649162.png?lastModify=1738423183" alt="image-20250127173649162"></p><h3 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function test&lt;T&gt;(arg: T): T&#123;</span><br><span class="line">    return arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä¸æŒ‡åç±»å‹ï¼ŒTSä¼šâ¾ƒåŠ¨æ¨æ–­å‡ºæ¥</span><br><span class="line">test(10)</span><br><span class="line"></span><br><span class="line">// æŒ‡åå…·ä½“çš„ç±»å‹</span><br><span class="line">test&lt;number&gt;(10)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function test&lt;T, K&gt;(a: T, b: K): K&#123;</span><br><span class="line"> return b;</span><br><span class="line">&#125;</span><br><span class="line">// ä¸ºå¤šä¸ªæ³›å‹æŒ‡å®šå…·ä½“â¾ƒå€¼</span><br><span class="line">test&lt;number, string&gt;(10, &quot;hello&quot;);</span><br></pre></td></tr></table></figure><p><strong>ç±»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class MyClass&lt;T&gt;&#123;</span><br><span class="line"> prop: T;</span><br><span class="line"> constructor(prop: T)&#123;</span><br><span class="line"> this.prop = prop;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³›å‹çº¦æŸ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface Demo&#123;</span><br><span class="line"> length: number;</span><br><span class="line">&#125;</span><br><span class="line">// æ³›å‹Tå¿…é¡»æ˜¯MyInterçš„â¼¦ç±»ï¼Œå³ï¼šå¿…é¡»æ‹¥æœ‰lengthå±æ€§</span><br><span class="line">function test&lt;T extends Demo&gt;(arg: T): number&#123;</span><br><span class="line"> return arg.length;</span><br><span class="line">&#125;</span><br><span class="line">test(10) // ç±»å‹â€œnumberâ€çš„å‚æ•°ä¸èƒ½èµ‹ç»™ç±»å‹â€œDemoâ€çš„å‚æ•°</span><br><span class="line">test(&#123;name:&#x27;å¼ ä¸‰&#x27;&#125;) // ç±»å‹â€œ&#123; name: string; &#125;â€çš„å‚æ•°ä¸èƒ½èµ‹ç»™ç±»å‹â€œDemoâ€çš„å‚æ•°</span><br><span class="line">test(&#x27;123&#x27;)</span><br><span class="line">test(&#123;name:&#x27;å¼ ä¸‰&#x27;,length:10&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¡µé¢é¢„åŠ è½½UIå®ç°</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B5%E9%9D%A2circle%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B5%E9%9D%A2circle%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="é¡µé¢circleåŠ è½½åŠ¨ç”»"><a href="#é¡µé¢circleåŠ è½½åŠ¨ç”»" class="headerlink" title="é¡µé¢circleåŠ è½½åŠ¨ç”»"></a>é¡µé¢circleåŠ è½½åŠ¨ç”»</h1><p><img src="/upload/image-20241116165834762.png" alt="image-20241116165834762.png"></p><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;span&gt;loding......&lt;/span&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    padding: 0;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">&#125;</span><br><span class="line">body &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100vh;</span><br><span class="line">    /* border: 10px solid red; */</span><br><span class="line">&#125;</span><br><span class="line">.container &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    align-items: center;</span><br><span class="line">    /* border: 10px solid rgb(0, 132, 255); */</span><br><span class="line">    background-color: black;</span><br><span class="line">&#125;</span><br><span class="line">/* èƒŒæ™¯å½©è‰²åœ†åœˆ */</span><br><span class="line">.circle &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 200px;</span><br><span class="line">    height: 200px;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    align-items: center;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    /* border: 10px solid rgb(0, 255, 170); */</span><br><span class="line">    background-image: linear-gradient(</span><br><span class="line">        0deg,</span><br><span class="line">        rgb(0, 255, 170),</span><br><span class="line">        rgb(0, 17, 255),</span><br><span class="line">        rgb(255, 0, 255)</span><br><span class="line">    );</span><br><span class="line">    /* !!!åŠ¨ç”»!!! */</span><br><span class="line">    animation: rotate 2s linear infinite;</span><br><span class="line">&#125;</span><br><span class="line">/* æ¨¡ç³Š */</span><br><span class="line">.circle::before &#123;</span><br><span class="line">    content: &#x27;&#x27;;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 200px;</span><br><span class="line">    height: 200px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    /* border: 10px solid rgb(0, 255, 170); */</span><br><span class="line">    background-image: linear-gradient(</span><br><span class="line">        0deg,</span><br><span class="line">        rgb(0, 255, 170),</span><br><span class="line">        rgb(0, 17, 255),</span><br><span class="line">        rgb(255, 0, 255)</span><br><span class="line">    );</span><br><span class="line">    filter: blur(35px);</span><br><span class="line">&#125;</span><br><span class="line">/* é»‘åœˆ */</span><br><span class="line">.circle::after &#123;</span><br><span class="line">    content: &#x27;&#x27;;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 180px;</span><br><span class="line">    height: 180px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    background-color: black;</span><br><span class="line">&#125;</span><br><span class="line">/* æ–‡å­— */</span><br><span class="line">span &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    color: rgb(255, 255, 255);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é‡ç‚¹"><a href="#é‡ç‚¹" class="headerlink" title="é‡ç‚¹"></a><em><strong>é‡ç‚¹</strong></em></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">animation: rotate 2s linear infinite;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/* åŠ¨ç”» */</span><br><span class="line">@keyframes rotate &#123;</span><br><span class="line">    0% &#123;</span><br><span class="line">        transform: rotate(0deg);</span><br><span class="line">    &#125;</span><br><span class="line">    100% &#123;</span><br><span class="line">        transform: rotate(360deg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹æ“é¡µé¢é¢„åŠ è½½</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B5%E9%9D%A2%E9%A2%84%E5%8A%A0%E8%BD%BD/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B5%E9%9D%A2%E9%A2%84%E5%8A%A0%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="é¡µé¢é¢„åŠ è½½"><a href="#é¡µé¢é¢„åŠ è½½" class="headerlink" title="é¡µé¢é¢„åŠ è½½"></a>é¡µé¢é¢„åŠ è½½</h1><p><strong>æœ¬æ–‡å®ç°äº†</strong></p><p><strong>1.é¢„åŠ è½½è½¬åœˆåŠ¨ç”»+åŠ è½½å®Œæ¯•é”€æ¯ç»„ä»¶</strong></p><p><strong>2.å¼€å±è’™ç‰ˆç‰¹æ•ˆï¼ˆafterèµ„æºåŠ è½½å®Œæ¯•ï¼‰</strong></p><p><strong>3.ä¸»é¡µèƒŒæ™¯å›¾æ¨¡ç³Š+ç¼©æ”¾åŠ¨ç”»ï¼ˆafterèµ„æºåŠ è½½å®Œæ¯•ï¼‰</strong></p><h2 id="ä»£ç ç»“æ„"><a href="#ä»£ç ç»“æ„" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h2><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åŠ è½½åŠ¨ç”» --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;svg&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;circle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>loding......<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é—¨æ¿"><a href="#é—¨æ¿" class="headerlink" title="é—¨æ¿"></a><strong>é—¨æ¿</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é—¨æ¿ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»é¡µé¢"><a href="#ä¸»é¡µé¢" class="headerlink" title="ä¸»é¡µé¢"></a><strong>ä¸»é¡µé¢</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä¸»é¡µé¢ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;page&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://haowallpaper.com/link/common/file/previewFileImg/718a61f6cd6efa803ca87eb743fec045718a61f6cd6efa803ca87eb743fec045&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h3 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h3><h4 id="é¢„åŠ è½½å·¥å…·"><a href="#é¢„åŠ è½½å·¥å…·" class="headerlink" title="é¢„åŠ è½½å·¥å…·"></a><strong>é¢„åŠ è½½å·¥å…·</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://libs.baidu.com/jquery/1.8.3/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="åŠ¨æ€æ›´æ–°"><a href="#åŠ¨æ€æ›´æ–°" class="headerlink" title="åŠ¨æ€æ›´æ–°"></a><strong>åŠ¨æ€æ›´æ–°</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="variable constant_">JS</span>åŠ¨æ€æ›´æ–° --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> left = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.left&#x27;</span>)  <span class="comment">//å·¦é—¨</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> right = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.right&#x27;</span>)<span class="comment">//å³é—¨</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> page = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.page&#x27;</span>)  <span class="comment">//è·å–å›¾ç‰‡å¯¹è±¡</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $(<span class="variable language_">window</span>).<span class="title function_">on</span>(<span class="string">&#x27;load&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        $(<span class="string">&#x27;.svg&#x27;</span>).<span class="title function_">animate</span>(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">opacity</span>: <span class="number">0</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="number">500</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        )</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            $(<span class="string">&#x27;.svg&#x27;</span>).<span class="title function_">remove</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">//removeç»„ä»¶lodingåæ‰§è¡Œ</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">//é—¨æ¿å¼€å±åŠ¨æ€</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                left.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateX(-60vw)`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                right.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateX(60vw)`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">//æ¨¡ç³Š/æ”¾ç¼©èƒŒæ™¯å›¾ç‰‡æ•ˆæœ</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                page.<span class="property">style</span>.<span class="property">animation</span> = <span class="string">`blur-to-clear 2s cubic-bezier(0.62, 0.21, 0.25, 1) 0s 1</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                        normal backwards running,scale 2s cubic-bezier(0.62, 0.21, 0.25, 1) 0s 1 both`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;, <span class="number">200</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;, <span class="number">500</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><h4 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a><strong>å…¨å±€é…ç½®</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/* å–æ¶ˆæ»šåŠ¨æ¡ */</span></span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠ¨ç”»å‡½æ•°"><a href="#åŠ¨ç”»å‡½æ•°" class="headerlink" title="åŠ¨ç”»å‡½æ•°"></a><strong>åŠ¨ç”»å‡½æ•°</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* åŠ¨ç”» */</span></span><br><span class="line"><span class="keyword">@keyframes</span> rotate &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ¨¡ç³ŠåŠ¨ç”» */</span></span><br><span class="line"><span class="keyword">@keyframes</span> blur-to-clear &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">35px</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">0px</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* å›¾ç‰‡å¤§å°å˜åŒ–åŠ¨ç”» */</span></span><br><span class="line"><span class="keyword">@keyframes</span> scale &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŒ…è£¹åŠ è½½çš„æ ·å¼svgï¼ˆlodingåå»é™¤ï¼‰"><a href="#åŒ…è£¹åŠ è½½çš„æ ·å¼svgï¼ˆlodingåå»é™¤ï¼‰" class="headerlink" title="åŒ…è£¹åŠ è½½çš„æ ·å¼svgï¼ˆlodingåå»é™¤ï¼‰"></a><strong>åŒ…è£¹åŠ è½½çš„æ ·å¼svgï¼ˆlodingåå»é™¤ï¼‰</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.svg</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">999</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸»é¡µèƒŒæ™¯"><a href="#ä¸»é¡µèƒŒæ™¯" class="headerlink" title="ä¸»é¡µèƒŒæ™¯"></a><strong>ä¸»é¡µèƒŒæ™¯</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span><span class="selector-class">.page</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">1080px</span>;</span><br><span class="line">    <span class="attribute">transition</span>: opacity <span class="number">1s</span>;</span><br><span class="line">    <span class="comment">/* èƒŒæ™¯å›¾ç‰‡å˜åŒ–åŠ¨ç”»(å·²å­˜å…¥JS) */</span></span><br><span class="line">    <span class="comment">/* animation: blur-to-clear 2s cubic-bezier(0.62, 0.21, 0.25, 1) 0s 1</span></span><br><span class="line"><span class="comment">    normal backwards running,</span></span><br><span class="line"><span class="comment">    scale 2s cubic-bezier(0.62, 0.21, 0.25, 1) 0s 1 both; */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠ è½½åœ†åœˆæ ·å¼"><a href="#åŠ è½½åœ†åœˆæ ·å¼" class="headerlink" title="åŠ è½½åœ†åœˆæ ·å¼"></a><strong>åŠ è½½åœ†åœˆæ ·å¼</strong></h4><p><strong>è¯¦ç»†æ‹†åˆ†è§æ–‡ç« â€œé¡µé¢circleåŠ è½½åŠ¨ç”»â€</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="comment">/* border: 10px solid rgb(0, 132, 255); */</span></span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.circle</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="comment">/* border: 10px solid rgb(0, 255, 170); */</span></span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">0deg</span>,</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">170</span>),</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">17</span>, <span class="number">255</span>),</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">/* åŠ¨ç”» */</span></span><br><span class="line">    <span class="attribute">animation</span>: rotate <span class="number">2s</span> linear infinite;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* æ¨¡ç³Š */</span></span><br><span class="line"><span class="selector-class">.circle</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="comment">/* border: 10px solid rgb(0, 255, 170); */</span></span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">0deg</span>,</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">170</span>),</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">17</span>, <span class="number">255</span>),</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">35px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* é»‘åœˆ */</span></span><br><span class="line"><span class="selector-class">.circle</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">180px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">180px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="comment">/* filter: blur(35px); */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¼€å±é—¨æ¿"><a href="#å¼€å±é—¨æ¿" class="headerlink" title="å¼€å±é—¨æ¿"></a><strong>å¼€å±é—¨æ¿</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">998</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: center center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">998</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50vw</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: center center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vueç»„ä»¶é€šä¿¡</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Vue%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Vue%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="ç»„ä»¶é€šä¿¡"><a href="#ç»„ä»¶é€šä¿¡" class="headerlink" title="ç»„ä»¶é€šä¿¡"></a>ç»„ä»¶é€šä¿¡</h2><h3 id="çˆ¶å­åŒä¼ "><a href="#çˆ¶å­åŒä¼ " class="headerlink" title="çˆ¶å­åŒä¼ "></a>çˆ¶å­åŒä¼ </h3><h5 id="props"><a href="#props" class="headerlink" title="props"></a>props</h5><p><strong>çˆ¶ä¼ å­</strong></p><p><img src="/upload/image-20240825201917435-ppsw.png" alt="image-20240825201917435-ppsw.png"></p><p><strong>å­ä¼ çˆ¶</strong></p><p><img src="/upload/image-20240825203836739-eekr.png" alt="image-20240825203836739-eekr.png"></p><h5 id="v-modelï¼ˆåŒå‘ç»‘å®šï¼‰"><a href="#v-modelï¼ˆåŒå‘ç»‘å®šï¼‰" class="headerlink" title="v-modelï¼ˆåŒå‘ç»‘å®šï¼‰"></a>v-modelï¼ˆåŒå‘ç»‘å®šï¼‰</h5><p><strong>è¡¨å•</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//ç”¨åœ¨htmlæ ‡ç­¾</span><br><span class="line">&lt;input type=&quot;text&quot; v-model=&quot;username&quot;&gt;</span><br><span class="line"></span><br><span class="line">//ç”¨åœ¨ç»„ä»¶æ ‡ç­¾ä¸Š</span><br><span class="line">&lt;ç»„ä»¶ v-model=&quot;username&quot;/&gt;</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240826134133823-jtfn.png" alt="image-20240826134133823-jtfn.png"></p><p><img src="/upload/image-20240826134643288-wved.png" alt="image-20240826134643288-wved.png"></p><h3 id="çˆ¶ä¼ å­"><a href="#çˆ¶ä¼ å­" class="headerlink" title="çˆ¶ä¼ å­"></a>çˆ¶ä¼ å­</h3><h5 id="refs"><a href="#refs" class="headerlink" title="$refs"></a>$refs</h5><p><strong>æ”¹å˜å­çš„ç©å…·</strong></p><p><img src="/upload/image-20240826163102996-vnxq.png" alt="image-20240826163102996-vnxq.png"></p><p><strong>è®©æ‰€æœ‰å­çš„ä¹¦å˜å¤š</strong></p><p><img src="/upload/image-20240826161006792-cmyw.png" alt="image-20240826161006792-cmyw.png"></p><h5 id="é»˜è®¤æ’æ§½"><a href="#é»˜è®¤æ’æ§½" class="headerlink" title="é»˜è®¤æ’æ§½"></a>é»˜è®¤æ’æ§½</h5><p><img src="/upload/image-20240826214619312-wydc.png" alt="image-20240826214619312-wydc.png"></p><p><img src="/upload/image-20240826214724976-nytt.png" alt="image-20240826214724976-nytt.png"></p><h5 id="å…·åæ’æ§½"><a href="#å…·åæ’æ§½" class="headerlink" title="å…·åæ’æ§½"></a>å…·åæ’æ§½</h5><p><img src="/upload/image-20240826221750773-jrvs.png" alt="image-20240826221750773-jrvs.png"></p><h3 id="å­ä¼ çˆ¶"><a href="#å­ä¼ çˆ¶" class="headerlink" title="å­ä¼ çˆ¶"></a>å­ä¼ çˆ¶</h3><h5 id="è‡ªå®šä¹‰"><a href="#è‡ªå®šä¹‰" class="headerlink" title="è‡ªå®šä¹‰"></a>è‡ªå®šä¹‰</h5><p><strong>çˆ¶ç»„ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Child @send-toy=&quot;toy = $event&quot;/&gt;</span><br></pre></td></tr></table></figure><p><strong>å­ç»„ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.$emit(&#x27;send-toy&#x27;, å…·ä½“æ•°æ®)</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240825212202117-gpof.png" alt="image-20240825212202117-gpof.png"></p><h5 id="parent"><a href="#parent" class="headerlink" title="$parent"></a>$parent</h5><p><strong>å‡å°‘çˆ¶çš„æˆ¿äº§</strong></p><p><img src="/upload/image-20240826162719642-svvx.png" alt="image-20240826162719642-svvx.png"></p><h5 id="ä½œç”¨åŸŸæ’æ§½"><a href="#ä½œç”¨åŸŸæ’æ§½" class="headerlink" title="ä½œç”¨åŸŸæ’æ§½"></a>ä½œç”¨åŸŸæ’æ§½</h5><p><strong>params ä½œä¸ºå¯¹è±¡</strong></p><p><img src="/upload/image-20240827151102500-ymag.png" alt="image-20240827151102500-ymag.png"></p><p><img src="/upload/image-20240827151700297-slyx.png" alt="image-20240827151700297-slyx.png"></p><h3 id="ç¥–ä¼ å­™"><a href="#ç¥–ä¼ å­™" class="headerlink" title="ç¥–ä¼ å­™"></a>ç¥–ä¼ å­™</h3><h5 id="attrs"><a href="#attrs" class="headerlink" title="$attrs"></a>$attrs</h5><p><img src="/upload/image-20240826144203197-vibc.png" alt="image-20240826144203197-vibc.png"></p><h5 id="provideï¼ˆé…-injectï¼‰"><a href="#provideï¼ˆé…-injectï¼‰" class="headerlink" title="provideï¼ˆé… injectï¼‰"></a>provideï¼ˆé… injectï¼‰</h5><p><img src="/upload/image-20240826172233626-cazp.png" alt="image-20240826172233626-cazp.png"></p><h3 id="å­™ä¼ ç»„"><a href="#å­™ä¼ ç»„" class="headerlink" title="å­™ä¼ ç»„"></a>å­™ä¼ ç»„</h3><h5 id="injectï¼ˆé…-providï¼‰"><a href="#injectï¼ˆé…-providï¼‰" class="headerlink" title="injectï¼ˆé… providï¼‰"></a>injectï¼ˆé… providï¼‰</h5><p><img src="/upload/image-20240826172226760-ueqn.png" alt="image-20240826172226760-ueqn.png"></p><h3 id="å…„å¼Ÿä¼ "><a href="#å…„å¼Ÿä¼ " class="headerlink" title="å…„å¼Ÿä¼ "></a>å…„å¼Ÿä¼ </h3><h5 id="mitt"><a href="#mitt" class="headerlink" title="mitt"></a>mitt</h5><p><strong>å®‰è£…</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mitt</span><br></pre></td></tr></table></figure><p><strong>&#x2F;utils&#x2F;emitter</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//å¼•å…¥mitt</span><br><span class="line">import mitt from &#x27;mitt&#x27;</span><br><span class="line"></span><br><span class="line">// è°ƒç”¨mittå¾—åˆ°emitterï¼Œemitterèƒ½ï¼šç»‘å®šäº‹ä»¶ã€è§¦å‘äº‹ä»¶</span><br><span class="line">const emitter = mitt()</span><br><span class="line"></span><br><span class="line">// æš´éœ²emitter</span><br><span class="line">export default emitter</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//ç»‘å®šäº‹ä»¶</span><br><span class="line">emitter.on(&#x27;text&#x27;,()=&gt;&#123;&#125;)</span><br><span class="line">//è§¦å‘äº‹ä»¶</span><br><span class="line">emmiter.emit(&#x27;text&#x27;)</span><br><span class="line">//è§£ç»‘äº‹ä»¶</span><br><span class="line">emmiter.off(&#x27;text&#x27;)</span><br><span class="line">//å…¨éƒ¨è§£ç»‘</span><br><span class="line">emmiter.all.clear()</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240826131941301-xtro.png" alt="image-20240826131941301-xtro.png"></p><h3 id="ä»»æ„ä¼ "><a href="#ä»»æ„ä¼ " class="headerlink" title="ä»»æ„ä¼ "></a>ä»»æ„ä¼ </h3><h5 id="pinia"><a href="#pinia" class="headerlink" title="pinia"></a>pinia</h5><p><strong>æ­å»º</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia</span><br></pre></td></tr></table></figure><p><strong>main.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &#x27;vue&#x27;</span><br><span class="line">import App from &#x27;./App.vue&#x27;</span><br><span class="line"></span><br><span class="line">/* å¼•å…¥createPiniaï¼Œç”¨äºåˆ›å»ºpinia */</span><br><span class="line">import &#123; createPinia &#125; from &#x27;pinia&#x27;</span><br><span class="line"></span><br><span class="line">/* åˆ›å»ºpinia */</span><br><span class="line">const pinia = createPinia()</span><br><span class="line">const app = createApp(App)</span><br><span class="line"></span><br><span class="line">/* ä½¿ç”¨æ’ä»¶ */&#123;&#125;</span><br><span class="line">app.use(pinia)</span><br><span class="line">app.mount(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure><p><strong>&#x2F;stores&#x2F;first.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123;defineStore&#125; from &quot;pinia&quot;;</span><br><span class="line"></span><br><span class="line">import &#123;ref&#125; from &quot;vue&quot;</span><br><span class="line"></span><br><span class="line">export default defineStore(&#x27;first&#x27;,()=&gt;&#123;//åˆ›å»ºè‡ªå·±çš„ä»“åº“</span><br><span class="line">    const name = ref(&#x27;pinia&#x27;);</span><br><span class="line"></span><br><span class="line">    return &#123;name&#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>App.vue</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    import useFristStore from &quot;./stores/first&quot;</span><br><span class="line">    const store = useFirstStore();//è‡ªå·±çš„ä»“åº“</span><br><span class="line">    console.log(store.name);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vueè·¯ç”±</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Vue%E8%B7%AF%E7%94%B1/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Vue%E8%B7%AF%E7%94%B1/</url>
      
        <content type="html"><![CDATA[<h2 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h2><p><img src="/upload/image-20240829155453971.png" alt="image-20240829155453971.png"></p><ul><li><p><code>router/index.ts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import &#123; creatRouter, createWebHistory &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import è‡ªå®šä¹‰å1 from &#x27;../pages/ç»„ä»¶1.vue&#x27;</span><br><span class="line">import è‡ªå®šä¹‰å2 from &#x27;../pages/ç»„ä»¶2.vue&#x27;</span><br><span class="line"></span><br><span class="line">export default createRouter(&#123;</span><br><span class="line">    history: createWebHistory(),</span><br><span class="line">    routes:[</span><br><span class="line">        &#123;</span><br><span class="line">            path:&#x27;/è‡ªå®šä¹‰è·¯ç”±å1&#x27;</span><br><span class="line">            component:/è‡ªå®šä¹‰å1,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            path:&#x27;/è‡ªå®šä¹‰è·¯ç”±å2&#x27;</span><br><span class="line">            component:/è‡ªå®šä¹‰å2,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><code>App.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;......&quot;&gt;</span><br><span class="line">        &lt;!-- å¯¼èˆªåŒº --&gt;</span><br><span class="line">        &lt;router-link active-class=&quot;active&quot; class=&quot;...&quot; to=&quot;/props&quot;&gt;1. props&lt;/router-link&gt;</span><br><span class="line">        &lt;router-link active-class=&quot;active&quot; class=&quot;...&quot; to=&quot;/event&quot;&gt;2. è‡ªå®šä¹‰äº‹ä»¶&lt;/router-link&gt;</span><br><span class="line">        ......</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;......&quot;&gt;</span><br><span class="line">        &lt;!-- å ä½ä¸€ä¸ªå±•ç¤ºåŒº --&gt;</span><br><span class="line">        &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot; name=&quot;App&quot;&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>main.ts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &#x27;vue&#x27;</span><br><span class="line">import App from &#x27;./App.vue&#x27;</span><br><span class="line">import &#123; createPinia &#125; from &#x27;pinia&#x27;</span><br><span class="line">import router from &#x27;./router/index&#x27;</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºåº”ç”¨</span><br><span class="line">const app = createApp(App)</span><br><span class="line">// åˆ›å»ºpinia</span><br><span class="line">const pinia = createPinia()</span><br><span class="line"></span><br><span class="line">// å®‰è£…æ’ä»¶</span><br><span class="line">app.use(pinia)</span><br><span class="line">// å®‰è£…è·¯ç”±å™¨</span><br><span class="line">app.use(router)</span><br><span class="line">// æŒ‚è½½åº”ç”¨</span><br><span class="line">app.mount(&#x27;#app&#x27;)//ä½¿ç”¨.mount()æ–¹æ³•å°†åº”ç”¨æŒ‚è½½åˆ°idä¸º&#x27;app&#x27;çš„å…ƒç´ ä¸Š</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ScssåŸºç¡€</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Scss/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Scss/</url>
      
        <content type="html"><![CDATA[<h1 id="Scss"><a href="#Scss" class="headerlink" title="Scss"></a>Scss</h1><p><strong>Sassä½¿ç”¨Rubyè¯­æ³• : *<em><strong>æ²¡æœ‰èŠ±æ‹¬å·</strong>ï¼Œ<strong>æ²¡æœ‰åˆ†å·</strong>ï¼Œå…·æœ‰</em>*ä¸¥æ ¼çš„ç¼©è¿›</strong></p><h2 id="åŸºç¡€ä½¿ç”¨"><a href="#åŸºç¡€ä½¿ç”¨" class="headerlink" title="åŸºç¡€ä½¿ç”¨"></a>åŸºç¡€ä½¿ç”¨</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install -D sass sass-loader</span><br></pre></td></tr></table></figure><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><p><strong>define.scss ï¼ˆä¸€èˆ¬æ”¾åœ¨srcä¸­çš„stylesæ–‡ä»¶å¤¹ä¸­ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$--primary-color: #123456;</span><br><span class="line">$white-color:$--primary-color-green !default;//è¿™ä¸ªé»˜è®¤å€¼çš„ä¼˜å…ˆçº§é™åˆ°äº†æœ€ä½ï¼Œå½“æ²¡æœ‰å…¶å®ƒåœ°æ–¹èµ‹å€¼æ—¶å€™ï¼Œæ‰ä¼šé€‰æ‹©é»˜è®¤å€¼</span><br></pre></td></tr></table></figure><p><strong>vueç»„ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;style scoped lang=&quot;scss&quot;&gt;</span><br><span class="line">@import &#x27;@/styles/define.scss&#x27;;</span><br><span class="line">    .box&#123;</span><br><span class="line">        color:$--primary-color;</span><br><span class="line">        background-color:$white-color;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="mixin"><a href="#mixin" class="headerlink" title="@mixin"></a>@mixin</h3><p><strong>å¯ä»¥å®šä¹‰ä¸€æ®µä»£ç ä½œä¸ºæ¨¡æ¿æ ·å¼</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@mixin border-radius($radius: 5px, $borderRadius: 8px) &#123;//å¯ä»¥æ¥æ”¶ä¼ å…¥çš„å‚æ•°</span><br><span class="line">  border: &#123;</span><br><span class="line">    radius: $radius;</span><br><span class="line">    top: $borderRadius solid #ff0;</span><br><span class="line">    bottom: $borderRadius solid #f00;</span><br><span class="line">    left: $borderRadius solid #00f;</span><br><span class="line">    right: $borderRadius solid #888;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@include border-radius(5px, 1px);//ä¼ å…¥å‚æ•°ï¼Œè¿”å›è®¡ç®—å¥½çš„æ ·å¼</span><br></pre></td></tr></table></figure><h3 id="extend"><a href="#extend" class="headerlink" title="@extend"></a>@extend</h3><p><strong>ç»§æ‰¿å…¶å®ƒä»£ç æ®µ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@mixin btn($width: 50px, $height: 20px, $font-size: 16px) &#123;</span><br><span class="line">  width: $width;</span><br><span class="line">  height: $height;</span><br><span class="line">  font-size: $font-size;</span><br><span class="line">  text-align: center;</span><br><span class="line">  line-height: $height;</span><br><span class="line">  @include border-radius(5px, 1px);</span><br><span class="line">  &amp;:hover &#123;</span><br><span class="line">    opacity: 0.8;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">.btn &#123;</span><br><span class="line">  @include btn(80px, 30px, 12px);</span><br><span class="line">  margin: &#123;</span><br><span class="line">    top: 10px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">.btn-primary &#123;</span><br><span class="line">  @extend .btn;//ç»§æ‰¿åˆ°äº†btnçš„æ ·å¼</span><br><span class="line">  background-color: $light-blue;</span><br><span class="line">  color: $fontColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Viteé…ç½®scss"><a href="#Viteé…ç½®scss" class="headerlink" title="Viteé…ç½®scss"></a>Viteé…ç½®scss</h2><p><strong>é…ç½®vite.config.ts</strong></p><p>é¡ºä¾¿æŠŠ@åˆ«åè·¯å¾„éƒ½é…ç½®å¥½äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; fileURLToPath &#125; from &#x27;url&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">export default defineConfig(&#123;</span><br><span class="line">    plugins: [vue()],</span><br><span class="line">    css: &#123;</span><br><span class="line">        preprocessorOptions: &#123;</span><br><span class="line">            scss: &#123;</span><br><span class="line">                additionalData: &#x27;@import &quot;@/styles/define.scss&quot;;&#x27;,</span><br><span class="line">                javascriptEnabled: true,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">            &#x27;@&#x27;: fileURLToPath(new URL(&#x27;./src&#x27;, import.meta.url)),</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åˆè¯†gridå¸ƒå±€</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/grid%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/grid%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="CSSå®šä½å…ƒç´ "><a href="#CSSå®šä½å…ƒç´ " class="headerlink" title="CSSå®šä½å…ƒç´ "></a>CSSå®šä½å…ƒç´ </h1><p><img src="/upload/image-20241110163644817.png" alt="image-20241110163644817.png"></p><h1 id="gridç½‘æ ¼å¸ƒå±€"><a href="#gridç½‘æ ¼å¸ƒå±€" class="headerlink" title="gridç½‘æ ¼å¸ƒå±€"></a>gridç½‘æ ¼å¸ƒå±€</h1><p><strong>æ–°çš„é•¿åº¦å•ä½ï¼šfr</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸€èˆ¬æ¥è¯´ 1fr çš„æ„æ€æ˜¯â€œ100%çš„å‰©ä½™ç©ºé—´â€, .25fr æ„å‘³ç€â€œ25%çš„å‰©ä½™ç©ºé—´â€ã€‚å½“æ—¶å½“ fr å¤§äº 1 çš„æ—¶å€™ï¼Œåˆ™ä¼šé‡æ–°è®¡ç®—æ¯”ä¾‹æ¥åˆ†é…ã€‚</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110161821264.png" alt="image-20241110161821264.png"></p><h3 id="gridå¸ƒå±€"><a href="#gridå¸ƒå±€" class="headerlink" title="gridå¸ƒå±€"></a>gridå¸ƒå±€</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display: grid;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grid-template-columns: 1fr 1fr 1fr 1fr;</span><br></pre></td></tr></table></figure><p><strong>ç­‰ä»·äºï¼ˆrepeatï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grid-template-columns: repeat(4, 1fr);</span><br><span class="line">grid-template-columns: repeat(4, .25fr);</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬éƒ½å»ºè®®ä½¿ç”¨ **<code>fr&gt;=1</code> çš„æƒ…å†µ</p><h3 id="å“åº”å¼è®¾è®¡"><a href="#å“åº”å¼è®¾è®¡" class="headerlink" title="å“åº”å¼è®¾è®¡"></a>å“åº”å¼è®¾è®¡</h3><p>è¿™é‡Œ <code>A</code> å’Œ <code>D</code> éƒ½æ˜¯å›ºå®šçš„ <code>50px</code>ï¼Œ<code>C</code> æ˜¯å æ€»å®½åº¦çš„ <code>20%</code>ï¼Œå‰©ä½™ç©ºé—´å°±å¯ä»¥åˆ†é…ç»™ <code>B</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.grid-container &#123;</span><br><span class="line">  grid-template-columns: 50px 1fr 20% 50px;</span><br><span class="line">  column-gap: 10px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110161302301.png" alt="image-20241110161302301.png"></p><h3 id="èˆ¹æ–°ç”¨æ³•"><a href="#èˆ¹æ–°ç”¨æ³•" class="headerlink" title="èˆ¹æ–°ç”¨æ³•"></a>èˆ¹æ–°ç”¨æ³•</h3><p><strong>3*3çš„ç½‘æ ¼</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//ç½‘æ ¼å¸ƒå±€</span><br><span class="line">.face &#123;</span><br><span class="line">    display: grid;</span><br><span class="line">    grid-template-rows:repeat(3,1fr);</span><br><span class="line">    grid-template-columns: repeat(3,lfr);</span><br><span class="line">    grid-template-areas:</span><br><span class="line">        &quot;lt . rt&quot;</span><br><span class="line">        &quot;lc cc rc&quot;</span><br><span class="line">        &quot;lb . rb&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//è§„åˆ’å—å¸ƒå±€</span><br><span class="line">.lt-dot&#123;</span><br><span class="line">    grid-area: lt;</span><br><span class="line">&#125;</span><br><span class="line">.lr-dot&#123;</span><br><span class="line">    grid-area: lr;</span><br><span class="line">&#125;</span><br><span class="line">.lc-dot&#123;</span><br><span class="line">    grid-area: lc;</span><br><span class="line">&#125;</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110163133135.png" alt="image-20241110163133135.png"></p><h3 id="ç›¸æ¯”Flex"><a href="#ç›¸æ¯”Flex" class="headerlink" title="ç›¸æ¯”Flex"></a>ç›¸æ¯”Flex</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Flexæ˜¯ä¸€ç»´å¸ƒå±€ï¼ŒGridæ˜¯äºŒç»´</span><br><span class="line">æµè§ˆå™¨å¯¹Flexçš„å…¼å®¹æ€§æ›´å¥½</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Gridé€‚ç”¨äºå¤§é¢ç§¯çš„æ•´ä½“å¸ƒå±€</span><br><span class="line">å°é¢ç§¯ç»„ä»¶Flexæ›´çµæ´»</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>gridå¸ƒå±€å®æˆ˜</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/grid+transform%E5%AE%9E%E7%8E%B0%E9%A1%B5%E9%9D%A23D%E9%AA%B0%E5%AD%90/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/grid+transform%E5%AE%9E%E7%8E%B0%E9%A1%B5%E9%9D%A23D%E9%AA%B0%E5%AD%90/</url>
      
        <content type="html"><![CDATA[<h1 id="grid-transformå®ç°é¡µé¢3Déª°å­"><a href="#grid-transformå®ç°é¡µé¢3Déª°å­" class="headerlink" title="grid+transformå®ç°é¡µé¢3Déª°å­"></a>grid+transformå®ç°é¡µé¢3Déª°å­</h1><h2 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h2><h3 id="transform"><a href="#transform" class="headerlink" title="transform"></a><em>transform</em></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform-style: preserve-3d;/*æ‰€æœ‰å­å…ƒç´ åœ¨3Dç©ºé—´ä¸­å‘ˆç°*/</span><br></pre></td></tr></table></figure><h3 id="åç§»"><a href="#åç§»" class="headerlink" title="åç§»"></a><em><strong>åç§»</strong></em></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: translateX(90px) translateY(90px) translateZ(90px);/*å·¦å³ ä¸‹ä¸Š å‰å*/</span><br></pre></td></tr></table></figure><h3 id="æ—‹è½¬"><a href="#æ—‹è½¬" class="headerlink" title="æ—‹è½¬"></a><em><strong>æ—‹è½¬</strong></em></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110201517099.png" alt="image-20241110201517099.png"></p><h2 id="å®æˆ˜æ•ˆæœ"><a href="#å®æˆ˜æ•ˆæœ" class="headerlink" title="å®æˆ˜æ•ˆæœ"></a><strong>å®æˆ˜æ•ˆæœ</strong></h2><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;wrap&quot; id=&quot;dice&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid first-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot cc-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid second-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid third-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot cc-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid forth-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot lb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid fifth-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot lb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot cc-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid sixth-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot lc-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot lb-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rt-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rc-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h5 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">container                       //å¤–å±‚å ä½å®¹å™¨</span><br><span class="line">    wrap / dice                 //æ§åˆ¶æ—‹è½¬</span><br><span class="line">        face / face-grid * 6    //é¢</span><br><span class="line">            dot / red           //ç‚¹</span><br></pre></td></tr></table></figure><h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><h5 id="box-sizing"><a href="#box-sizing" class="headerlink" title="box-sizing"></a><strong>box-sizing</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">div &#123;</span><br><span class="line">    box-sizing: border-box;/*å…ƒç´ çš„widthå’ŒheightåŒ…æ‹¬contentã€paddingå’Œborderçš„å®½åº¦ï¼Œä½†ä¸åŒ…æ‹¬margin*/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ¸å˜è¾¹æ¡†æŠ€æœ¯åšé¢"><a href="#æ¸å˜è¾¹æ¡†æŠ€æœ¯åšé¢" class="headerlink" title="æ¸å˜è¾¹æ¡†æŠ€æœ¯åšé¢"></a><strong>æ¸å˜è¾¹æ¡†æŠ€æœ¯åšé¢</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.face &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 120px;</span><br><span class="line">    height: 120px;</span><br><span class="line">    padding: 20px;/*w/h/péƒ½åŒ…è£¹è¾¹æ¡†çš„å®½åº¦ï¼Œæ˜¯ä»è¾¹æ¡†çš„æœ€é‡Œå¾€é‡Œpadding*/</span><br><span class="line">    opacity: 0.95;</span><br><span class="line">    border: 8px solid transparent; /*8pxçš„é€æ˜è¾¹æ¡†ï¼Œå°±æ˜¯æ¸å˜è¾¹æ¡†çš„å®½åº¦*/</span><br><span class="line">    background-clip: padding-box, border-box;/*å¿…è¦çš„ä¸¤é¡¹*/</span><br><span class="line">    background-origin: padding-box, border-box;/*å¿…è¦çš„ä¸¤é¡¹*/</span><br><span class="line">    background-image: </span><br><span class="line">        linear-gradient(135deg, #e1eeffbb, #f3d5ffbb),</span><br><span class="line">        linear-gradient(135deg, rgb(0, 60, 255), rgb(0, 225, 255), #f0f);/*æ¸å˜è§’åº¦+æ¸å˜é¢œè‰²*/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="gridåšç‚¹ï¼ˆface-gridï¼‰"><a href="#gridåšç‚¹ï¼ˆface-gridï¼‰" class="headerlink" title="gridåšç‚¹ï¼ˆface-gridï¼‰"></a><strong>gridåšç‚¹ï¼ˆface-gridï¼‰</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">.face-grid &#123;</span><br><span class="line">    /*éª°å­ç‚¹æ•°å¸ƒå±€*/</span><br><span class="line">    display: grid;</span><br><span class="line">    grid-template-rows: repeat(3, 1fr);/*è¡Œ*/</span><br><span class="line">    grid-template-columns: repeat(3, 1fr);/*åˆ—*/</span><br><span class="line">    grid-template-areas:</span><br><span class="line">        &#x27;lt . rt&#x27;</span><br><span class="line">        &#x27;lc cc rc&#x27;</span><br><span class="line">        &#x27;lb . rb&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">.lt-dot &#123;</span><br><span class="line">    grid-area: lt;</span><br><span class="line">&#125;</span><br><span class="line">.rt-dot &#123;</span><br><span class="line">    grid-area: rt;</span><br><span class="line">&#125;</span><br><span class="line">.lc-dot &#123;</span><br><span class="line">    grid-area: lc;</span><br><span class="line">&#125;</span><br><span class="line">.cc-dot &#123;</span><br><span class="line">    grid-area: cc;</span><br><span class="line">&#125;</span><br><span class="line">.rc-dot &#123;</span><br><span class="line">    grid-area: rc;</span><br><span class="line">&#125;</span><br><span class="line">.lb-dot &#123;</span><br><span class="line">    grid-area: lb;</span><br><span class="line">&#125;</span><br><span class="line">.rb-dot &#123;</span><br><span class="line">    grid-area: rb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ç‚¹çŠ¶æ ·å¼ï¼ˆdot-redï¼‰"><a href="#ç‚¹çŠ¶æ ·å¼ï¼ˆdot-redï¼‰" class="headerlink" title="ç‚¹çŠ¶æ ·å¼ï¼ˆdot&#x2F;redï¼‰"></a><strong>ç‚¹çŠ¶æ ·å¼ï¼ˆdot&#x2F;redï¼‰</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.dot &#123;/*é»‘ç‚¹*/</span><br><span class="line">    display: inline-block;</span><br><span class="line">    width: 25px;</span><br><span class="line">    height: 25px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    background-color: #1759af;</span><br><span class="line">&#125;</span><br><span class="line">.red &#123;/*çº¢ç‚¹ï¼ˆç»§æ‰¿é»‘ç‚¹å±æ€§ï¼‰*/</span><br><span class="line">    background-color: rgb(162, 0, 211);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åç§»-æ—‹è½¬é¢"><a href="#åç§»-æ—‹è½¬é¢" class="headerlink" title="åç§»+æ—‹è½¬é¢"></a><strong>åç§»+æ—‹è½¬é¢</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1é¢ï¼ˆå‰ï¼‰ å‰ç§» 50%è¾¹é•¿</span><br><span class="line">6é¢ï¼ˆåï¼‰ åç§» 50%è¾¹é•¿</span><br><span class="line">2é¢ï¼ˆå·¦ï¼‰ å·¦ç§» 50%è¾¹é•¿ + Y 90deg</span><br><span class="line">3é¢ï¼ˆå³ï¼‰ å³ç§» 50%è¾¹é•¿ + Y 90deg</span><br><span class="line">5é¢ï¼ˆä¸Šï¼‰ ä¸Šç§» 50%è¾¹é•¿ + X 90deg</span><br><span class="line">4é¢ï¼ˆä¸‹ï¼‰ ä¸‹ç§» 50%è¾¹é•¿ + X 90deg</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.first-face &#123;</span><br><span class="line">    transform: translateZ(60px);</span><br><span class="line">&#125;</span><br><span class="line">.second-face &#123;</span><br><span class="line">    transform: translateX(-60px) rotateY(90deg);</span><br><span class="line">&#125;</span><br><span class="line">.third-face &#123;</span><br><span class="line">    transform: translateX(50%) rotateY(90deg);</span><br><span class="line">&#125;</span><br><span class="line">.forth-face &#123;</span><br><span class="line">    transform: translateY(50%) rotateX(90deg);</span><br><span class="line">&#125;</span><br><span class="line">.fifth-face &#123;</span><br><span class="line">    transform: translateY(-50%) rotateX(90deg);</span><br><span class="line">&#125;</span><br><span class="line">.sixth-face &#123;</span><br><span class="line">    transform: translateZ(-60px);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a><strong>æ•ˆæœå›¾</strong></h5><p><img src="/upload/image-20241115172203521.png" alt="image-20241115172203521.png"></p><h5 id="åŠ ç‚¹åŠ¨æ•ˆï¼ˆCSS-hoverï¼‰"><a href="#åŠ ç‚¹åŠ¨æ•ˆï¼ˆCSS-hoverï¼‰" class="headerlink" title="åŠ ç‚¹åŠ¨æ•ˆï¼ˆCSS_hoverï¼‰"></a><strong>åŠ ç‚¹åŠ¨æ•ˆï¼ˆCSS_hoverï¼‰</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.wrap:hover &#123;</span><br><span class="line">    transform: rotateX(300deg) rotateY(0deg) rotateZ(100deg) !important;</span><br><span class="line">    transition: transform 2s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JSå®ç°éšæœºç‚¹æ•°"><a href="#JSå®ç°éšæœºç‚¹æ•°" class="headerlink" title="JSå®ç°éšæœºç‚¹æ•°"></a>JSå®ç°éšæœºç‚¹æ•°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    let wrap = document.querySelector(&#x27;.wrap&#x27;)</span><br><span class="line">    let rotateX = 0 // åˆå§‹åŒ–æ—‹è½¬è§’åº¦</span><br><span class="line">    let rotateY = 0</span><br><span class="line">    let rotateZ = 0</span><br><span class="line"></span><br><span class="line">    wrap.onclick = function () &#123;</span><br><span class="line">        let x = Math.floor(Math.random() * 10) - 5 //éšæœºæ•°ï¼ŒèŒƒå›´æ˜¯-5åˆ°5</span><br><span class="line">        let y = Math.floor(Math.random() * 10) - 5</span><br><span class="line">        let z = Math.floor(Math.random() * 10) - 5</span><br><span class="line">        rotateX += x * 90</span><br><span class="line">        rotateY += y * 90</span><br><span class="line">        rotateZ += z * 90</span><br><span class="line">        wrap.style.transform = `rotateX($&#123;rotateX&#125;deg) rotateY($&#123;rotateY&#125;deg) rotateZ($&#123;rotateZ&#125;deg)`</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><strong>æš‚æ—¶è¿˜ä¸ä¼šè®¡ç®—æ—‹è½¬åçš„ç‚¹æ•°æ˜¾ç¤º</strong></p><p><strong>ç­‰æœ‰æ€è·¯äº†ç»§ç»­æ›´æ–°</strong></p>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CSSæ­å»ºé¡µé¢3Dç©ºé—´</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/CSS%E6%90%AD%E5%BB%BA%E9%A1%B5%E9%9D%A23D%E7%A9%BA%E9%97%B4/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/CSS%E6%90%AD%E5%BB%BA%E9%A1%B5%E9%9D%A23D%E7%A9%BA%E9%97%B4/</url>
      
        <content type="html"><![CDATA[<h1 id="CSSæ­å»ºé¡µé¢3Dç©ºé—´"><a href="#CSSæ­å»ºé¡µé¢3Dç©ºé—´" class="headerlink" title="CSSæ­å»ºé¡µé¢3Dç©ºé—´"></a>CSSæ­å»ºé¡µé¢3Dç©ºé—´</h1><p><strong>é‡ç£…CSSå±æ€§</strong></p><h5 id="transform"><a href="#transform" class="headerlink" title="transform"></a><em>transform</em></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform-style: preserve-3d;/*æ‰€æœ‰å­å…ƒç´ åœ¨3Dç©ºé—´ä¸­å‘ˆç°*/</span><br></pre></td></tr></table></figure><p><em><strong>åç§»</strong></em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: translateX(90px) translateY(90px) translateZ(90px);/*å·¦å³ ä¸‹ä¸Š å‰å*/</span><br></pre></td></tr></table></figure><p><em><strong>æ—‹è½¬</strong></em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110201517099.png" alt="image-20241110201517099.png"></p>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æœ‰å…³CSSçš„å¸¸è§é—®é¢˜</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/CSS%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/CSS%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h5 id="å…ƒç´ åŒºåˆ†"><a href="#å…ƒç´ åŒºåˆ†" class="headerlink" title="å…ƒç´ åŒºåˆ†"></a>å…ƒç´ åŒºåˆ†</h5><p><strong>å—å…ƒç´ </strong><strong>div &#x2F; p &#x2F; h &#x2F; ul &#x2F; li</strong></p><p><strong>è¡Œå†…å…ƒç´ </strong><strong>a &#x2F; span &#x2F;br</strong></p><p><strong>è¡Œå†…å—å…ƒç´ </strong><strong>img &#x2F; input &#x2F; td</strong></p><h5 id="é«˜åº¦å¡Œé™·"><a href="#é«˜åº¦å¡Œé™·" class="headerlink" title="é«˜åº¦å¡Œé™·"></a>é«˜åº¦å¡Œé™·</h5><p><strong>å°±æ˜¯å¤–è¾¹è·marginå¡Œé™·</strong></p><p><strong>åªä¼šå‘ç”Ÿåœ¨å‚ç›´æ–¹å‘ï¼Œåªå‡ºç°åœ¨å—çº§å…ƒç´ ä¸Š</strong></p><p><strong>è§£å†³ï¼šå­ç»çˆ¶ç›¸</strong></p><h5 id="æµ®åŠ¨å¡Œé™·"><a href="#æµ®åŠ¨å¡Œé™·" class="headerlink" title="æµ®åŠ¨å¡Œé™·"></a>æµ®åŠ¨å¡Œé™·</h5><p><strong>å…ƒç´ ä¸€æ—¦****æµ®åŠ¨</strong>åï¼Œ<strong>è„±ç¦»æ ‡å‡†æµ</strong>ï¼Œæœç€å‘å·¦æˆ–å³æ–¹å‘ç§»åŠ¨ï¼Œç›´åˆ°è‡ªå·±çš„<strong>è¾¹ç•Œç´§è´´åŒ…å«å—</strong>(ä¸€èˆ¬æ˜¯çˆ¶å…ƒç´ )æˆ–è€…å…¶ä»–æµ®åŠ¨å…ƒç´ çš„è¾¹ç•Œä¸ºæ­¢</p><p><strong>clear</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">div -&gt;  display:float</span><br><span class="line">    span    //float: left</span><br><span class="line">    span    //è‹¥æœªè®¾ç½®é«˜åº¦ï¼Œåˆ™spanæµ®åŠ¨äºçˆ¶å…ƒç´ ä¸Šæ–¹ï¼Œäº§ç”Ÿé«˜åº¦å¡Œé™·</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">    p   -&gt;  clear: both</span><br><span class="line">div</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºBFC</strong></p><p>BFCåŸç†è¯¦æƒ…è§æ–‡ç«  â€œæ ¼å¼åŒ–ä¸Šä¸‹æ–‡â€“BFCä¸IFCâ€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://154.40.44.42:8090/archives/ge-shi-hua-shang-xia-wen--bfcyu-ifc</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">div -&gt;  display:float / overflow: hidden/auto</span><br><span class="line">    span    //float: left</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">div</span><br></pre></td></tr></table></figure><p><strong>ä¼ªå…ƒç´ ï¼ˆ!æœ€æ¨è!ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">div class=clearfix  çˆ¶å…ƒç´ </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.clearfix::after&#123;</span><br><span class="line">    content: &#x27;&#x27;     //è®¾ç½®ä¸ºç©ºå…ƒç´ </span><br><span class="line">    display: block  //è®¾ç½®ä¸ºå—çº§å…ƒç´ </span><br><span class="line">    clear: both     //clearæ¸…é™¤æµ®åŠ¨</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä¸‰è§’å½¢"><a href="#ä¸‰è§’å½¢" class="headerlink" title="ä¸‰è§’å½¢"></a>ä¸‰è§’å½¢</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">w:0</span><br><span class="line">h:0</span><br><span class="line">border: 250px solid transparent</span><br><span class="line">border-æ–¹å‘-color:é¢œè‰²</span><br></pre></td></tr></table></figure><h5 id="å›ºå®šå®½é«˜æ¯”"><a href="#å›ºå®šå®½é«˜æ¯”" class="headerlink" title="å›ºå®šå®½é«˜æ¯”"></a>å›ºå®šå®½é«˜æ¯”</h5><p><strong>éœ€è¦çˆ¶å…ƒç´ </strong></p><p><strong>å®½é«˜æ¯”&#x3D;4:3ç¤ºä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">w:100%              //ä¸ºçˆ¶å…ƒç´ 100%</span><br><span class="line">h:0</span><br><span class="line">padding:0</span><br><span class="line">padding-bottom:75%  //ä¸ºçˆ¶å…ƒç´ 75%</span><br></pre></td></tr></table></figure><h5 id="è¶…å‡ºçœç•¥"><a href="#è¶…å‡ºçœç•¥" class="headerlink" title="è¶…å‡ºçœç•¥"></a>è¶…å‡ºçœç•¥</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">white-space: nowrap;</span><br><span class="line">text-overflow: ellipsis;</span><br><span class="line">overflow: hidden;</span><br></pre></td></tr></table></figure><h5 id="æ¸å˜è¾¹æ¡†"><a href="#æ¸å˜è¾¹æ¡†" class="headerlink" title="æ¸å˜è¾¹æ¡†"></a>æ¸å˜è¾¹æ¡†</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    border: 8px solid transparent; /*8pxçš„é€æ˜è¾¹æ¡†*/</span><br><span class="line">    border-radius: 12px; /*åœ†è§’*/</span><br><span class="line">    background-clip: padding-box, border-box;/*background-clip è®¾ç½®å…ƒç´ çš„èƒŒæ™¯æ˜¯å¦å»¶ä¼¸åˆ°è¾¹æ¡†ã€å†…è¾¹è·ç›’å­ã€å†…å®¹ç›’å­ä¸‹é¢ã€‚èƒŒæ™¯å»¶ä¼¸è‡³è¾¹æ¡†å¤–æ²¿ï¼ˆä½†æ˜¯åœ¨è¾¹æ¡†ä¸‹å±‚ï¼‰ä¸”èƒŒæ™¯å»¶ä¼¸è‡³å†…è¾¹è·ï¼ˆpaddingï¼‰å¤–æ²¿ã€‚ä¸ä¼šç»˜åˆ¶åˆ°è¾¹æ¡†å¤„ã€‚*/</span><br><span class="line">    background-origin: padding-box, border-box;/*èƒŒæ™¯å›¾ç‰‡çš„æ‘†æ”¾ä»¥ border padding åŒºåŸŸä¸ºå‚è€ƒ*/</span><br><span class="line">    background-image: </span><br><span class="line">        linear-gradient(to right, #fff, #fff),</span><br><span class="line">        linear-gradient(135deg, #f00, #ff0, #f0f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¤§å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WebRTCå®ç°æœ¬åœ°è§†é¢‘é€šè¯ | å…¨æµç¨‹è¯¦è§£</title>
      <link href="/2025/03/04/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/WebRTC%E5%AE%9E%E7%8E%B0%E6%9C%AC%E5%9C%B0%E8%A7%86%E9%A2%91%E9%80%9A%E8%AF%9D%E5%85%A8%E6%B5%81%E7%A8%8B/"/>
      <url>/2025/03/04/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/WebRTC%E5%AE%9E%E7%8E%B0%E6%9C%AC%E5%9C%B0%E8%A7%86%E9%A2%91%E9%80%9A%E8%AF%9D%E5%85%A8%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>æºç è§ä»“åº“ <a href="https://github.com/Breezli/WebRTC_Demo">Breezli&#x2F;WebRTC_Demo: åŸºäºWebRTCæŠ€æœ¯å®ç°çš„æœ¬åœ°ç½‘é¡µç«¯è§†é¢‘é€šè¯</a></p><blockquote><p>ä¸ºäº†æ›´å¥½çš„é¡¹ç›®ä½“éªŒï¼Œæœ¬æ–‡çš„é¡¹ç›®å¼•ç”¨äº†ä¸‰å¼ svgï¼Œä½äºgithubä»“åº“çš„publicç›®å½•ä¸‹</p></blockquote><p>åˆ†ä¸ºå‰åç«¯ä¸¤ä¸ªæ–‡ä»¶å¤¹</p><blockquote><p>webrtc-client  (å®¢æˆ·ç«¯)</p><p>webrtc-server (æœåŠ¡ç«¯)</p></blockquote><h2 id="é¢„å…ˆå‡†å¤‡"><a href="#é¢„å…ˆå‡†å¤‡" class="headerlink" title="é¢„å…ˆå‡†å¤‡"></a>é¢„å…ˆå‡†å¤‡</h2><h3 id="webrtc-client"><a href="#webrtc-client" class="headerlink" title="webrtc-client"></a>webrtc-client</h3><p>å‰ç«¯é¡µé¢ç»˜åˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ä¾èµ–ä¸‹è½½</span><br><span class="line">pnpm create vite@latest webrtc-client -- --template vue-ts</span><br><span class="line">cd webrtc-client</span><br><span class="line">pnpm install -D tailwindcss@3.4.17 postcss autoprefixer</span><br><span class="line">pnpm install socket.io-client</span><br><span class="line">npx tailwindcss init -p</span><br></pre></td></tr></table></figure><p>package.json</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;webrtc-client&quot;</span>,</span><br><span class="line">  <span class="string">&quot;private&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;module&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;vite&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vue-tsc -b &amp;&amp; vite build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preview&quot;</span>: <span class="string">&quot;vite preview&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;socket.io-client&quot;</span>: <span class="string">&quot;^4.8.1&quot;</span>,<span class="comment">//é‡è¦ä¾èµ–ï¼Œå¹¶ä¸”æ˜¯è¿è¡Œæ—¶ä¾èµ–ï¼Œè¦ä¸‹åœ¨ç”Ÿäº§ç¯å¢ƒ</span></span><br><span class="line">    <span class="string">&quot;vue&quot;</span>: <span class="string">&quot;^3.5.13&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;@tailwindcss/postcss&quot;</span>: <span class="string">&quot;^4.1.11&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@vitejs/plugin-vue&quot;</span>: <span class="string">&quot;^6.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@vue/tsconfig&quot;</span>: <span class="string">&quot;^0.7.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;autoprefixer&quot;</span>: <span class="string">&quot;^10.4.20&quot;</span>,<span class="comment">//è‡ªåŠ¨æ·»åŠ csså‰ç¼€</span></span><br><span class="line">    <span class="string">&quot;postcss&quot;</span>: <span class="string">&quot;^8.4.49&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tailwindcss&quot;</span>: <span class="string">&quot;^4.1.11&quot;</span>,<span class="comment">//tailwindcssæ ·å¼åº“ï¼ˆä¸ç”¨ä¹Ÿç½¢ï¼Œå¯ä»¥ç®€å•ç”»ä¸€ä¸ªé¡µé¢ï¼‰</span></span><br><span class="line">    <span class="string">&quot;typescript&quot;</span>: <span class="string">&quot;~5.6.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vite&quot;</span>: <span class="string">&quot;^6.0.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vue-tsc&quot;</span>: <span class="string">&quot;^2.2.0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">App.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=<span class="string">&quot;flex items-center flex-col text-center p-12 h-screen&quot;</span>&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;relative h-full mb-4&quot;</span>&gt;</span><br><span class="line">            &lt;video</span><br><span class="line">                ref=<span class="string">&quot;localVideo&quot;</span></span><br><span class="line">                class=<span class="string">&quot;w-96 h-full bg-gray-200 mb-4 object-cover&quot;</span>&gt;&lt;/video&gt;</span><br><span class="line">            &lt;video</span><br><span class="line">                ref=<span class="string">&quot;remoteVideo&quot;</span></span><br><span class="line">                class=<span class="string">&quot;w-32 h-48 absolute bottom-0 right-0 object-cover&quot;</span>&gt;&lt;/video&gt;</span><br><span class="line">            &lt;div</span><br><span class="line">                v-<span class="keyword">if</span>=<span class="string">&quot;caller &amp;&amp; calling&quot;</span></span><br><span class="line">                class=<span class="string">&quot;absolute top-2/3 left-36 flex flex-col items-center&quot;</span>&gt;</span><br><span class="line">                &lt;p class=<span class="string">&quot;mb-4 text-white&quot;</span>&gt;ç­‰å¾…å¯¹æ–¹æ¥å¬...&lt;/p&gt;</span><br><span class="line">                &lt;img</span><br><span class="line">                    <span class="meta">@click</span>=<span class="string">&quot;hangUp&quot;</span></span><br><span class="line">                    src=<span class="string">&quot;/refuse.svg&quot;</span></span><br><span class="line">                    class=<span class="string">&quot;w-16 cursor-pointer&quot;</span></span><br><span class="line">                    alt=<span class="string">&quot;&quot;</span> /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div</span><br><span class="line">                v-<span class="keyword">if</span>=<span class="string">&quot;called &amp;&amp; calling&quot;</span></span><br><span class="line">                class=<span class="string">&quot;absolute top-2/3 left-32 flex flex-col items-center&quot;</span>&gt;</span><br><span class="line">                &lt;p class=<span class="string">&quot;mb-4 text-white&quot;</span>&gt;æ”¶åˆ°è§†é¢‘é‚€è¯·...&lt;/p&gt;</span><br><span class="line">                &lt;div class=<span class="string">&quot;flex&quot;</span>&gt;</span><br><span class="line">                    &lt;img</span><br><span class="line">                        <span class="meta">@click</span>=<span class="string">&quot;hangUp&quot;</span></span><br><span class="line">                        src=<span class="string">&quot;/refuse.svg&quot;</span></span><br><span class="line">                        class=<span class="string">&quot;w-16 cursor-pointer mr-4&quot;</span></span><br><span class="line">                        alt=<span class="string">&quot;&quot;</span> /&gt;</span><br><span class="line">                    &lt;img</span><br><span class="line">                        <span class="meta">@click</span>=<span class="string">&quot;acceptCall&quot;</span></span><br><span class="line">                        src=<span class="string">&quot;/accept.svg&quot;</span></span><br><span class="line">                        class=<span class="string">&quot;w-16 cursor-pointer&quot;</span></span><br><span class="line">                        alt=<span class="string">&quot;&quot;</span> /&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;flex gap-2 mb-4&quot;</span>&gt;</span><br><span class="line">            &lt;button</span><br><span class="line">                class=<span class="string">&quot;rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white&quot;</span></span><br><span class="line">                <span class="meta">@click</span>=<span class="string">&quot;callRemote&quot;</span>&gt;</span><br><span class="line">                å‘èµ·è§†é¢‘</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">            &lt;button</span><br><span class="line">                class=<span class="string">&quot;rounded-md bg-red-600 px-4 py-2 text-sm font-semibold text-white&quot;</span></span><br><span class="line">                <span class="meta">@click</span>=<span class="string">&quot;hangUp&quot;</span>&gt;</span><br><span class="line">                æŒ‚æ–­è§†é¢‘</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">main.ts</span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; from <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App from <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line">createApp(App).mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>style.css</code> è¿™é‡Œä½¿ç”¨äº†tailwindçš„æ ·å¼åº“</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@tailwind</span> base;</span><br><span class="line"><span class="meta">@tailwind</span> components;</span><br><span class="line"><span class="meta">@tailwind</span> utilities;</span><br></pre></td></tr></table></figure><p><code>tailwind.config.js</code> æ­¤é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ‰€æœ‰æ¨¡æ¿æ–‡ä»¶çš„è·¯å¾„</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;tailwindcss&#x27;).Config</span>&#125; */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">content</span>: [</span><br><span class="line">    <span class="string">&quot;./index.html&quot;</span>,</span><br><span class="line">    <span class="string">&quot;./src/**/*.&#123;vue,js,ts,jsx,tsx&#125;&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">    <span class="attr">theme</span>: &#123;</span><br><span class="line">        <span class="attr">extend</span>: &#123;&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤å‰ç«¯é¡µé¢ç»˜åˆ¶å®Œæˆ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm dev</span><br></pre></td></tr></table></figure><h3 id="webrtc-server"><a href="#webrtc-server" class="headerlink" title="webrtc-server"></a>webrtc-server</h3><p>åˆå§‹åŒ–æœåŠ¡ç«¯é¡¹ç›®ï¼Œåœ¨ <code>webrtc-server</code> ç›®å½•ä¸‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm init</span><br></pre></td></tr></table></figure><p><code>socket.io</code> å°è£…äº†websocketåº”ç”¨åˆ›å»ºæœåŠ¡</p><p><code>nodemon</code> å……å½“çƒ­æ›´æ–°åŠŸèƒ½</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install socket.io nodemon</span><br></pre></td></tr></table></figure><p><code>package.json</code> æ·»åŠ <code>start</code>å‘½ä»¤ï¼Œä½¿ç”¨<code>nodemon</code>å¯åŠ¨é¡¹ç›®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">  &quot;start&quot;: &quot;nodemon index.js&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>åˆ›å»º<code>index.js</code>ï¼ˆæœ€åˆç‰ˆï¼Œä¹‹ååç«¯çš„æ‰€æœ‰æ“ä½œéƒ½åœ¨è¿™ä¸ªæ–‡ä»¶ä¸Šè¿›è¡Œï¼‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = <span class="built_in">require</span>(<span class="string">&#x27;socket.io&#x27;</span>);<span class="comment">//å°è£…äº†websocketåº”ç”¨åˆ›å»ºæœåŠ¡</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);<span class="comment">//å¼•å…¥httpæ¨¡å— </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()<span class="comment">//åˆ›å»ºæœåŠ¡å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> io = <span class="title function_">socket</span>(server, &#123;</span><br><span class="line">    <span class="attr">cors</span>: &#123;</span><br><span class="line">        <span class="attr">origin</span>: <span class="string">&#x27;*&#x27;</span> <span class="comment">// é…ç½®è·¨åŸŸ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/////æ¥ä¸‹æ¥çš„ä¸»ä½“éƒ¨åˆ†/////</span></span><br><span class="line">io.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function"><span class="params">sock</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¿æ¥æˆåŠŸ...&#x27;</span>)</span><br><span class="line">    sock.<span class="title function_">emit</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>);<span class="comment">// å‘å®¢æˆ·ç«¯å‘é€è¿æ¥æˆåŠŸçš„æ¶ˆæ¯</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">io.<span class="title function_">on</span>(<span class="string">&#x27;disconnect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¿æ¥æ–­å¼€&#x27;</span>);</span><br><span class="line">    sock.<span class="title function_">emit</span>(<span class="string">&#x27;connectionFalse&#x27;</span>);<span class="comment">// å‘å®¢æˆ·ç«¯å‘é€è¿æ¥æ–­å¼€çš„æ¶ˆæ¯</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/////æ¥ä¸‹æ¥çš„ä¸»ä½“éƒ¨åˆ†/////</span></span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="æ’æ’­socketé‡è¦æŒ‡ä»¤"><a href="#æ’æ’­socketé‡è¦æŒ‡ä»¤" class="headerlink" title="!!!æ’æ’­socketé‡è¦æŒ‡ä»¤!!!"></a>!!!æ’æ’­socketé‡è¦æŒ‡ä»¤!!!</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.emit   å‘é€äº‹ä»¶</span><br><span class="line">.on     ç›‘å¬äº‹ä»¶</span><br></pre></td></tr></table></figure><p>å¸¸è§å†…ç½®äº‹ä»¶è¯´æ˜</p><table><thead><tr><th>äº‹ä»¶åç§°</th><th>è§¦å‘åœºæ™¯</th><th>ä½¿ç”¨ä½ç½®</th></tr></thead><tbody><tr><td>connect</td><td>å®¢æˆ·ç«¯æˆåŠŸè¿æ¥åˆ°æœåŠ¡ç«¯æ—¶</td><td>å®¢æˆ·ç«¯</td></tr><tr><td>connection</td><td>æœåŠ¡ç«¯æ¥æ”¶åˆ°æ–°å®¢æˆ·ç«¯è¿æ¥æ—¶</td><td>æœåŠ¡ç«¯</td></tr><tr><td>disconnect</td><td>è¿æ¥æ–­å¼€æ—¶</td><td>å®¢æˆ·ç«¯&#x2F;æœåŠ¡ç«¯</td></tr><tr><td>error</td><td>è¿æ¥å‘ç”Ÿé”™è¯¯æ—¶</td><td>å®¢æˆ·ç«¯&#x2F;æœåŠ¡ç«¯</td></tr></tbody></table><p>åç«¯è‡³æ­¤æ­å»ºå®Œæˆï¼Œåœ¨3000ç«¯å£å¯å¯åŠ¨nodeæœåŠ¡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run start</span><br></pre></td></tr></table></figure><h2 id="å‰ç«¯è¿æ¥ä¿¡ä»¤æœåŠ¡å™¨"><a href="#å‰ç«¯è¿æ¥ä¿¡ä»¤æœåŠ¡å™¨" class="headerlink" title="å‰ç«¯è¿æ¥ä¿¡ä»¤æœåŠ¡å™¨"></a>å‰ç«¯è¿æ¥ä¿¡ä»¤æœåŠ¡å™¨</h2><p>ä¾é çš„å°±æ˜¯<code>socket.io-client</code></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†åœ¨<code>App.vue</code>ä¸­å¼€å§‹ç¼–å†™è„šæœ¬</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; ref, onMounted, onUnmounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; io, <span class="title class_">Socket</span> &#125; <span class="keyword">from</span> <span class="string">&quot;socket.io-client&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> socket = ref&lt;<span class="title class_">Socket</span>&gt;() <span class="comment">// å‰ç«¯Socketå®ä¾‹</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> sock = <span class="title function_">io</span>(<span class="string">&#x27;localhost:3000&#x27;</span>); <span class="comment">// é€šè¿‡ io(&#x27;localhost:3000&#x27;) åˆ›å»ºçš„ Socket.IO å®¢æˆ·ç«¯å®ä¾‹</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è¿æ¥æˆåŠŸ</span></span></span><br><span class="line"><span class="language-javascript">        sock.<span class="title function_">on</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¿æ¥æˆåŠŸ&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        socket.<span class="property">value</span> = sock;<span class="comment">// å­˜å‚¨Socketå®ä¾‹</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿˜è®°å¾—å—ï¼Œå°±åœ¨å‰ä¸¤æ­¥ï¼ŒæœåŠ¡ç«¯åœ¨è¿æ¥æˆåŠŸåå‘å‰ç«¯.emit(å‘é€)äº†connectionSuccessäº‹ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">io.on(&#x27;connection&#x27;, sock =&gt; &#123;</span><br><span class="line">  console.log(&#x27;è¿æ¥æˆåŠŸ...&#x27;)</span><br><span class="line">  sock.emit(&#x27;connectionSuccess&#x27;);// å‘å®¢æˆ·ç«¯å‘é€è¿æ¥æˆåŠŸçš„æ¶ˆæ¯</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è€Œåœ¨æ­¤æ—¶çš„å‰ç«¯åŠ å…¥çš„</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.on(&#x27;connectionSuccess&#x27;, () =&gt; &#123;// æ¥æ”¶åˆ°æœåŠ¡ç«¯å‘æ¥çš„connectionSuccess(è¿æ¥æˆåŠŸ)äº‹ä»¶</span><br><span class="line">    console.log(&#x27;è¿æ¥æˆåŠŸ&#x27;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>äº¤äº’é€»è¾‘åœ¨è¿™é‡Œå°±æ­£å¼å¼€å§‹äº†</p><h2 id="å‘èµ·è§†é¢‘è¯·æ±‚"><a href="#å‘èµ·è§†é¢‘è¯·æ±‚" class="headerlink" title="å‘èµ·è§†é¢‘è¯·æ±‚"></a>å‘èµ·è§†é¢‘è¯·æ±‚</h2><h3 id="è·å–æœ¬åœ°éŸ³è§†é¢‘æµ"><a href="#è·å–æœ¬åœ°éŸ³è§†é¢‘æµ" class="headerlink" title="è·å–æœ¬åœ°éŸ³è§†é¢‘æµ"></a>è·å–æœ¬åœ°éŸ³è§†é¢‘æµ</h3><p>å‰ç«¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getLocalStream</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> stream = <span class="keyword">await</span> navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123;<span class="comment">// è·å–éŸ³è§†é¢‘æµ</span></span><br><span class="line">        <span class="attr">video</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">audio</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    localVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = stream <span class="comment">// å°†åª’ä½“æµè®¾ç½®åˆ° video æ ‡ç­¾ä¸Šæ’­æ”¾</span></span><br><span class="line">    localVideo.<span class="property">value</span>!.<span class="title function_">play</span>() <span class="comment">// æ’­æ”¾éŸ³è§†é¢‘æµ</span></span><br><span class="line">    localStream.<span class="property">value</span> = stream <span class="comment">// å­˜å‚¨æœ¬åœ°æµ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> stream</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â€œæˆ¿é—´â€çš„æ¦‚å¿µ"><a href="#â€œæˆ¿é—´â€çš„æ¦‚å¿µ" class="headerlink" title="â€œæˆ¿é—´â€çš„æ¦‚å¿µ"></a>â€œæˆ¿é—´â€çš„æ¦‚å¿µ</h3><blockquote><p>ä¸å¦¨å…ˆåœä¸‹æ¥æ€è€ƒä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆåœ¨åŒä¸€ä¸ªç½‘é¡µï¼Œä¸åŒçš„å®¢æˆ·ç«¯å¯ä»¥çœ‹è§ä¸åŒçš„é¡µé¢ï¼Œå’Œå®æ—¶å…±äº«çš„å†…å®¹</p></blockquote><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=N2I4NGM2N2FhYzQ0NjBmN2I0YjBhY2Q0NDQzMmVhYTZfSU5kWmpjQ1NqR01vUVJOQzFwZkZyOTJDajc5ZHBaNW9fVG9rZW46TDVmemJtcE44b0cxV0R4djlIV2M0TGN5bjdlXzE3NTU3OTkwMDA6MTc1NTgwMjYwMF9WNA" alt="img"></p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€çœ‹ä¹‹å‰ç»™å‰ç«¯å†™çš„ç»„ä»¶ï¼ˆlayoutçœç•¥ç‰ˆï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">ref</span>=<span class="string">&quot;localVideo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span>    //æœ¬åœ°è§†é¢‘</span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">ref</span>=<span class="string">&quot;remoteVideo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span>   //æ¥æ”¶æ–¹è§†é¢‘ï¼ˆä½äºå³ä¸‹è§’ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;caller &amp;&amp; calling&quot;</span>&gt;</span>  //çŠ¶æ€å‚æ•°---caller:å‘é€æ–¹---calling:å‘¼å«ä¸­</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>ç­‰å¾…å¯¹æ–¹æ¥å¬...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> @<span class="attr">click</span>=<span class="string">&quot;hangUp&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/refuse.svg&quot;</span>/&gt;</span>    //æŒ‚æ–­</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;called &amp;&amp; calling&quot;</span>&gt;</span>  //çŠ¶æ€å‚æ•°---called:æ¥æ”¶æ–¹---calling:å‘¼å«ä¸­</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ”¶åˆ°è§†é¢‘é‚€è¯·...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> @<span class="attr">click</span>=<span class="string">&quot;hangUp&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/refuse.svg&quot;</span>/&gt;</span>    //æŒ‚æ–­</span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> @<span class="attr">click</span>=<span class="string">&quot;acceptCall&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/accept.svg&quot;</span>/&gt;</span>//æ¥å¬</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;callRemote&quot;</span>&gt;</span>å‘èµ·è§†é¢‘<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;hangUp&quot;</span>&gt;</span>æŒ‚æ–­è§†é¢‘<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¸éš¾å‘ç°æˆ‘ä»¬æ˜¯ä¾é çŠ¶æ€å‚æ•°æ¥æ§åˆ¶é¡µé¢æ˜¾ç¤ºçš„</p></blockquote><p>æœ¬é¡¹ç›®å‚æ•°è¡¨å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="variable">called</span> <span class="operator">=</span> ref&lt;<span class="type">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// æ˜¯å¦æ˜¯æ¥æ”¶æ–¹</span></span><br><span class="line"><span class="type">const</span> <span class="variable">caller</span> <span class="operator">=</span> ref&lt;<span class="type">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// æ˜¯å¦æ˜¯å‘èµ·æ–¹</span></span><br><span class="line"><span class="type">const</span> <span class="variable">calling</span> <span class="operator">=</span> ref&lt;<span class="type">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// å‘¼å«ä¸­</span></span><br><span class="line"><span class="type">const</span> <span class="variable">communicating</span> <span class="operator">=</span> ref&lt;<span class="type">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// è§†é¢‘é€šè¯ä¸­</span></span><br><span class="line"><span class="type">const</span> <span class="variable">localVideo</span> <span class="operator">=</span> ref&lt;HTMLVideoElement&gt;() <span class="comment">// videoæ ‡ç­¾å®ä¾‹ï¼Œæ’­æ”¾æœ¬äººçš„è§†é¢‘</span></span><br><span class="line"><span class="type">const</span> <span class="variable">remoteVideo</span> <span class="operator">=</span> ref&lt;HTMLVideoElement&gt;() <span class="comment">// videoæ ‡ç­¾å®ä¾‹ï¼Œæ’­æ”¾å¯¹æ–¹çš„è§†é¢‘</span></span><br><span class="line"><span class="type">const</span> <span class="variable">localStream</span> <span class="operator">=</span> ref&lt;MediaStream&gt;() <span class="comment">// æœ¬åœ°æµ</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="variable">roomId</span> <span class="operator">=</span> <span class="string">&#x27;001&#x27;</span> <span class="comment">// æˆ¿é—´ID</span></span><br></pre></td></tr></table></figure><p>é¡ºä¾¿å¸¦ä¸Šå®ä¾‹åˆ›å»º</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const socket = ref<span class="tag">&lt;<span class="name">Socket</span>&gt;</span>() // Socketå®ä¾‹</span><br><span class="line">const peer = ref<span class="tag">&lt;<span class="name">any</span>&gt;</span>() // RTCPeerConnectionå®ä¾‹</span><br></pre></td></tr></table></figure><p>è€Œå¯¹äºæˆ‘ä»¬è¿™ä¸ªé¡¹ç›®ï¼Œ<code>æˆ¿é—´</code>çš„æ¦‚å¿µå°±å¾ˆç®€å•</p><blockquote><p>A (å·¦) å‘B (å³) å‘èµ·æ¥é€šè¯·æ±‚ï¼Œåœ¨Bæ¥æ”¶è¯·æ±‚åï¼Œ<strong>åŒæ–¹éƒ½å°†åŠ å…¥è¿™ä¸ªè§†é¢‘é€šè¯çš„â€æˆ¿é—´â€</strong></p><p>æˆ¿é—´ å¯ä»¥é€šè¿‡è‡ªä¸»åˆ†é…idåˆ’åˆ†ï¼Œæ¯ä¸ªæˆ¿é—´ä¹Ÿå¯ä»¥åŠ å…¥å¾ˆå¤šç”¨æˆ· (å¦‚ç›´æ’­ç³»ç»Ÿ)</p><p>æœåŠ¡ç«¯å«æœ‰åŠ å…¥æˆ¿é—´çš„æ“çºµä»£ç  sock.join(Id)</p></blockquote><h3 id="åŠ å…¥æˆ¿é—´è¯·æ±‚"><a href="#åŠ å…¥æˆ¿é—´è¯·æ±‚" class="headerlink" title="åŠ å…¥æˆ¿é—´è¯·æ±‚"></a>åŠ å…¥æˆ¿é—´è¯·æ±‚</h3><p>å‰ç«¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sock.on(&#x27;connectionSuccess&#x27;, () =&gt; &#123;</span><br><span class="line">  console.log(&#x27;è¿æ¥æœåŠ¡å™¨æˆåŠŸ...&#x27;);</span><br><span class="line">  sock.emit(&#x27;joinRoom&#x27;, roomId) // å‰ç«¯å‘é€åŠ å…¥æˆ¿é—´äº‹ä»¶</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åç«¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.on(&#x27;joinRoom&#x27;, (roomId) =&gt; &#123;</span><br><span class="line">  sock.join(roomId) // åŠ å…¥æˆ¿é—´</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="å‘èµ·è§†é¢‘è¯·æ±‚-1"><a href="#å‘èµ·è§†é¢‘è¯·æ±‚-1" class="headerlink" title="å‘èµ·è§†é¢‘è¯·æ±‚"></a>å‘èµ·è§†é¢‘è¯·æ±‚</h3><p><strong>Aæ–¹æŒ‰é’®è§¦å‘å‡½æ•°</strong></p><p>å‰ç«¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">callRemote</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å‘èµ·è§†é¢‘&#x27;</span>);<span class="comment">// çŠ¶æ€æ›´æ–°</span></span><br><span class="line">    caller.<span class="property">value</span> = <span class="literal">true</span>;<span class="comment">// å‘é€æ–¹æ ‡è®°</span></span><br><span class="line">    calling.<span class="property">value</span> = <span class="literal">true</span>;<span class="comment">// å‘¼å«ä¸­</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">getLocalStream</span>()<span class="comment">// è·å–æœ¬åœ°éŸ³è§†é¢‘æµå‡½æ•°</span></span><br><span class="line">    socket.<span class="property">value</span>?.<span class="title function_">emit</span>(<span class="string">&#x27;callRemote&#x27;</span>, roomId)<span class="comment">// å‘é€è§†é¢‘è¯·æ±‚äº‹ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åç«¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.on(&#x27;callRemote&#x27;, (roomId) =&gt; &#123;// æ”¶åˆ°å‘é€æ–¹çš„è§†é¢‘è¯·æ±‚äº‹ä»¶</span><br><span class="line">    sock.to(roomId).emit(&#x27;receiveCall&#x27;)// å‘è¿™ä¸ªæˆ¿é—´ä¸­çš„å…¶ä»–äººå¹¿æ’­äº‹ä»¶receiveCall</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å‰ç«¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveCall&#x27;</span>, <span class="function">() =&gt;</span> &#123;<span class="comment">// æˆ¿é—´å†…æ‰€æœ‰æ¥æ”¶æ–¹ç›‘å¬åˆ°è§†é¢‘è¯·æ±‚äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (!caller.<span class="property">value</span>) &#123;<span class="comment">// éå‘èµ·æ–¹</span></span><br><span class="line">        calling.<span class="property">value</span> = <span class="literal">true</span><span class="comment">// å‘¼å«ä¸­</span></span><br><span class="line">        called.<span class="property">value</span> = <span class="literal">true</span><span class="comment">// æ¥æ”¶æ–¹æ ‡è®°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶A(å‘èµ·)æ–¹å¯åŠ¨æ‘„åƒå¤´å’Œéº¦å…‹é£ï¼Œå¹¶ç­‰å¾…å¯¹æ–¹æ¥å¬</p><p>B(æ¥æ”¶)æ–¹å‡ºç° æ¥å¬&#x2F;æŒ‚æ–­ æŒ‰é’®</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-<span class="keyword">if</span>=<span class="string">&quot;caller &amp;&amp; calling&quot;</span>&gt;  <span class="comment">//çŠ¶æ€å‚æ•°---caller:å‘é€æ–¹---calling:å‘¼å«ä¸­</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>ç­‰å¾…å¯¹æ–¹æ¥å¬...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> @<span class="attr">click</span>=<span class="string">&quot;hangUp&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/refuse.svg&quot;</span>/&gt;</span></span>    <span class="comment">//æŒ‚æ–­</span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;called &amp;&amp; calling&quot;</span>&gt;</span>  //çŠ¶æ€å‚æ•°---called:æ¥æ”¶æ–¹---calling:å‘¼å«ä¸­</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ”¶åˆ°è§†é¢‘é‚€è¯·...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">img</span> @<span class="attr">click</span>=<span class="string">&quot;hangUp&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/refuse.svg&quot;</span>/&gt;</span>    //æŒ‚æ–­</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">img</span> @<span class="attr">click</span>=<span class="string">&quot;acceptCall&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/accept.svg&quot;</span>/&gt;</span>//æ¥å¬</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;callRemote&quot;</span>&gt;</span>å‘èµ·è§†é¢‘<span class="tag">&lt;/<span class="name">button</span>&gt;</span>//å‘èµ·</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;hangUp&quot;</span>&gt;</span>æŒ‚æ–­è§†é¢‘<span class="tag">&lt;/<span class="name">button</span>&gt;</span>   //æŒ‚æ–­</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="æ¥æ”¶-æŒ‚æ–­-è§†é¢‘"><a href="#æ¥æ”¶-æŒ‚æ–­-è§†é¢‘" class="headerlink" title="æ¥æ”¶ &#x2F; æŒ‚æ–­ è§†é¢‘"></a>æ¥æ”¶ &#x2F; æŒ‚æ–­ è§†é¢‘</h3><p><em><strong>è¶ç€ç°åœ¨ï¼Œæˆ‘ä»¬æ·»ä¸Šå…¶ä»–æŒ‰é’®ç»‘å®šçš„å‡½æ•°</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‚æ–­è§†é¢‘</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hangUp</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;hangUp&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¥æ”¶è§†é¢‘è¯·æ±‚ï¼ˆæ¥æ”¶æ–¹ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">acceptCall</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;acceptCall&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em><strong>æ¥ç€æ¥çœ‹åç«¯æ€ä¹ˆå¤„ç†</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‚æ–­è§†é¢‘</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;hangUp&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line">    io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;hangUp&#x27;</span>)<span class="comment">// å‘Idæˆ¿é—´å†…æ‰€æœ‰äººå¹¿æ’­è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// æ¥æ”¶è§†é¢‘è¯·æ±‚</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line">    io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;acceptCall&#x27;</span>)<span class="comment">// å‘Idæˆ¿é—´å†…æ‰€æœ‰äººå¹¿æ’­è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><em><strong>è¿”å›å‰ç«¯ï¼Œå¤„ç†æˆ‘ä»¬æ¥æ”¶åˆ°çš„ hangUp || acceptCall</strong></em></p><p><strong>æŒ‚æ–­è§†é¢‘</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;hangUp&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reset</span>()<span class="comment">// é‡ç½®çŠ¶æ€</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é‡ç½®çŠ¶æ€å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">reset</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    called.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    caller.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    communicating.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    peer.<span class="property">value</span> = <span class="literal">null</span></span><br><span class="line">    localVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = <span class="literal">null</span> <span class="comment">// å…³é—­æœ¬åœ°è§†é¢‘</span></span><br><span class="line">    remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = <span class="literal">null</span> <span class="comment">// å…³é—­è¿œç¨‹è§†é¢‘</span></span><br><span class="line">    localStream.<span class="property">value</span>?.<span class="title function_">getTracks</span>()[<span class="number">0</span>].<span class="title function_">stop</span>() <span class="comment">// å…³é—­æœ¬åœ°æµ</span></span><br><span class="line">    <span class="comment">// localStream.value = undefined // å…³é—­æœ¬åœ°æµï¼ˆç›¸åŒæ•ˆæœï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¥å—è§†é¢‘è¯·æ±‚</strong></p><p>è€Œè¿™ä¸ªå°±å˜å¤æ‚äº†</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;<span class="comment">// å‘é€æ–¹</span></span><br><span class="line">        peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>()<span class="comment">// åˆ›å»ºRTCPeerConnectionå¯¹è±¡</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="title function_">addStream</span>(localStream.<span class="property">value</span>)<span class="comment">// æ·»åŠ æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line"></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;<span class="comment">// è·å–candidateä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line">                sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;)<span class="comment">// å‘æœåŠ¡å™¨å‘é€candidateä¿¡æ¯</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è·å–å¯¹æ–¹çš„éŸ³è§†é¢‘æµ</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">            calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">            communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">            <span class="comment">// æ‹¿åˆ°å¯¹æ–¹çš„è§†é¢‘æµ</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç”Ÿæˆoffer</span></span><br><span class="line">        <span class="keyword">const</span> offer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createOffer</span>(&#123;</span><br><span class="line">            <span class="attr">offerToReceiveAudio</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦æ¥æ”¶å¯¹æ–¹çš„éŸ³é¢‘</span></span><br><span class="line">            <span class="attr">offerToReceiveVideo</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦æ¥æ”¶å¯¹æ–¹çš„è§†é¢‘</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(offer)<span class="comment">// è®¾ç½®æœ¬åœ°æè¿°çš„offer</span></span><br><span class="line">        sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, &#123; roomId, offer &#125;)<span class="comment">// å‘é€offer</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="äº¤æ¢-SDP-ä¿¡æ¯å’Œ-candidate-ä¿¡æ¯"><a href="#äº¤æ¢-SDP-ä¿¡æ¯å’Œ-candidate-ä¿¡æ¯" class="headerlink" title="äº¤æ¢ SDP ä¿¡æ¯å’Œ candidate ä¿¡æ¯"></a>äº¤æ¢ SDP ä¿¡æ¯å’Œ candidate ä¿¡æ¯</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p><em><strong>SDP</strong></em> ï¼šWebRTCçš„ä¸€ç§åè®®ï¼Œç”¨äºæè¿°<strong>è®¾å¤‡æ”¯æŒçš„åª’ä½“æ ¼å¼</strong></p><p><em><strong>candidate</strong></em> ï¼šç½‘ç»œä¿¡æ¯</p><p><strong>åª’ä½“åå•†</strong> ï¼šäº¤æ¢SDP</p><p><strong>ICE</strong> ï¼šWebRTCçš„é€šä¿¡æœºåˆ¶</p><p>å·¥ä½œåŸç†</p><blockquote><p>1.åŒæ–¹æ”¶é›†æœ¬åœ°ç½‘ç»œåœ°å€ï¼ˆåˆ† å…±æœ‰ | ç§æœ‰ï¼‰+ STUN å’Œ TURN æœåŠ¡å™¨è·å–å€™é€‰åœ°å€</p><p>2.åŒæ–¹é€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨äº¤æ¢è¿™äº›å€™é€‰åœ°å€</p><p>3.åŒæ–¹ä½¿ç”¨å€™é€‰åœ°å€è¿›è¡Œè¿æ¥æµ‹è¯•ï¼Œç¡®å®šæœ€ä½³çš„å¯ç”¨åœ°å€ï¼Œå¼€å§‹å®æ—¶éŸ³è§†é¢‘é€šè¯</p></blockquote><h3 id="åª’ä½“åå•†"><a href="#åª’ä½“åå•†" class="headerlink" title="åª’ä½“åå•†"></a>åª’ä½“åå•†</h3><p><strong>æ¥ä¸‹æ¥æ˜¯æœ€é‡è¦çš„ä¿¡ä»¤äº¤æ¢æ­¥éª¤ï¼ˆWebRTCæ ¸å¿ƒï¼‰</strong></p><p>ä¸»è¦ç”¨åˆ°ä»¥ä¸‹æ–¹æ³•</p><p>åª’ä½“åå•†</p><blockquote><p>createOffer</p><p>createAnswer</p><p>setLocalDesccription</p><p>setRemoteDesccription</p></blockquote><p>é‡è¦äº‹ä»¶</p><blockquote><p>onicecandidate</p><p>onaddstream</p></blockquote><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=MzllMjAyMjZhZjhlYTZhNTFhMWE0MzJlNTU0ZGVkNjNfZHhyejdwVXlCNzlVMXpDM3hwZUJYYjlrUkJjc3hKTldfVG9rZW46TnQxTmJCT1JMb1RrWUN4aFRQRWNJaXlKbmJoXzE3NTU3OTkwMDA6MTc1NTgwMjYwMF9WNA" alt="img"></p><p>æ­¥éª¤æµç¨‹é‡ç»˜ï¼ˆå¯ä»¥å¯¹æ ‡å·æœ‰ä¸ªå°è±¡ï¼‰</p><p><img src="https://ki5e9njf7h.feishu.cn/space/api/box/stream/download/asynccode/?code=NDllMzNmMWY3MzFjZTEzYmNlNzZmMGRhZWY5NzAyNjlfeEpybzd0b1IxMHp2bEpqcmhsWWJORmRTUmx0ZXo5MHVfVG9rZW46S1FUaWJQM3N6b01Heml4NWVWeGNURG1sbmZkXzE3NTU3OTkwMDA6MTc1NTgwMjYwMF9WNA" alt="img"></p><blockquote><p>ä»¥ä¸Šæ ‡å·çš„æ‰€æœ‰é€»è¾‘å‡åœ¨å‰ç«¯å®ç°ï¼ŒæœåŠ¡ç«¯èµ·åˆ°å‘å‰ç«¯å¹¿æ’­ä½œç”¨</p></blockquote><p>ç´§æ¥ç€æ¥æ”¶æ–¹æ¥æ”¶åˆ°å¯¹æ–¹åŒæ„çš„æ¶ˆæ¯</p><h3 id="ä¿¡æ¯äº¤æ¢å…¨ç¨‹"><a href="#ä¿¡æ¯äº¤æ¢å…¨ç¨‹" class="headerlink" title="ä¿¡æ¯äº¤æ¢å…¨ç¨‹"></a>ä¿¡æ¯äº¤æ¢å…¨ç¨‹</h3><p>å‰ç«¯ï¼ˆå‘é€æ–¹ï¼‰</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;<span class="comment">// å‘é€æ–¹</span></span><br><span class="line">        peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>()<span class="comment">// åˆ›å»ºRTCPeerConnectionå¯¹è±¡</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="title function_">addStream</span>(localStream.<span class="property">value</span>)<span class="comment">// æ·»åŠ æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–candidateä¿¡æ¯</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line">                <span class="comment">// å‘æœåŠ¡å™¨å‘é€candidateä¿¡æ¯</span></span><br><span class="line">                sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¯¹æ–¹çš„éŸ³è§†é¢‘æµ</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">            calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">            communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">            <span class="comment">// æ‹¿åˆ°å¯¹æ–¹çš„è§†é¢‘æµ</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ---â‘ ---</span><br><span class="line">        <span class="keyword">const</span> offer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createOffer</span>(&#123;<span class="comment">// ç”Ÿæˆoffer</span></span><br><span class="line">            <span class="attr">offerToReceiveAudio</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦æ¥æ”¶å¯¹æ–¹çš„éŸ³é¢‘</span></span><br><span class="line">            <span class="attr">offerToReceiveVideo</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦æ¥æ”¶å¯¹æ–¹çš„è§†é¢‘</span></span><br><span class="line">        &#125;)</span><br><span class="line">        ---â‘¡---</span><br><span class="line">        <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(offer)<span class="comment">// è®¾ç½®æœ¬åœ°æè¿°çš„offer</span></span><br><span class="line">        ---â‘¢---</span><br><span class="line">        sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, &#123; roomId, offer &#125;)<span class="comment">// å‘é€offer !!!æ³¨æ„,è¿™é‡Œofferå·²ç»å½“å‚æ•°ä¼ è¿‡å»äº†!!!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åç«¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, candidate &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    sock.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, candidate)<span class="comment">// å‘è¿™ä¸ªæˆ¿é—´é‡Œå…¶ä»–äººå¹¿æ’­candidateä¿¡æ¯</span></span><br><span class="line">&#125;)</span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendOffer&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, offer &#125;</span>) =&gt;</span> &#123;<span class="comment">// !!!offeråœ¨è¿™é‡Œ!!!</span></span><br><span class="line">    <span class="comment">// io.to(roomId).emit(&#x27;sendOffer&#x27;, offer) // å‘è¿™ä¸ªæˆ¿é—´é‡Œæ‰€æœ‰äººå¹¿æ’­offerä¿¡æ¯ &amp;&amp; å‘æ¥æ”¶æ–¹å‘é€è¿™ä¸ªoffer</span></span><br><span class="line">    <span class="comment">// åœ¨é‡æ–°æ£€æŸ¥æ–‡æ¡£æ—¶æˆ‘å‘ç°ï¼ŒğŸ‘†è¿™ä¸ªå†™æ³•å¹¶ä¸å¯å–ã€‚è¿™ä¼šå¯¼è‡´å‘é€æ–¹è‡ªå·±ä¹Ÿæ”¶åˆ°è‡ªå·±å‘çš„ offerï¼Œå¹¶è§¦å‘ä¸å¿…è¦çš„é€»è¾‘ï¼Œå¯èƒ½åˆ›å»ºå¤šä¸ª PeerConnectionï¼Œè¿™ä¼šåœ¨åœ¨å¤šç”¨æˆ·æˆ¿é—´ä¸­å‡ºç°å¾ˆä¸¥é‡çš„é”™è¯¯</span></span><br><span class="line">    <span class="comment">// æ­£ç¡®åšæ³•æ˜¯æ’é™¤å‘é€è€…è‡ªå·±ï¼Œæ‰€æœ‰çš„ä¿¡ä»¤äº‹ä»¶éƒ½åº”è¯¥æ”¹ä¸º sock ï¼ˆç¬¬ä¸€ç‰ˆæ•™ç¨‹æˆ‘éƒ½ç”¨çš„ioï¼Œç°åœ¨å…¨éƒ¨æ”¹è¿‡æ¥äº†ï¼‰</span></span><br><span class="line">    sock.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, offer) <span class="comment">// å‘è¿™ä¸ªæˆ¿é—´çš„å…¶ä»–äººå¹¿æ’­offerä¿¡æ¯</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å‰ç«¯ï¼ˆæ¥æ”¶æ–¹ï¼‰</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendOffer&#x27;</span>, <span class="title function_">async</span> (<span class="attr">offer</span>: <span class="built_in">any</span>) =&gt; &#123;<span class="comment">// !!!offerä¼ å›å‰ç«¯(åˆ¤æ–­è¢«æ ‡æ³¨çš„æ¥æ”¶æ–¹)!!!</span></span><br><span class="line">    <span class="keyword">if</span> (called.<span class="property">value</span>) &#123;<span class="comment">// æ¥æ”¶æ–¹</span></span><br><span class="line">        <span class="keyword">const</span> stream = <span class="keyword">await</span> <span class="title function_">getLocalStream</span>()<span class="comment">// è·å–æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line">        peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>()<span class="comment">// æ¥æ”¶æ–¹åˆ›å»ºè‡ªå·±çš„RTCPeerConnectionå¯¹è±¡</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="title function_">addStream</span>(stream)<span class="comment">// æ·»åŠ æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line"></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;<span class="comment">// è·å–candidateä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line">                <span class="comment">// å‘æœåŠ¡å™¨å‘é€candidateä¿¡æ¯</span></span><br><span class="line">                sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¯¹æ–¹çš„éŸ³è§†é¢‘æµ</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">            calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">            communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">            <span class="comment">// æ‹¿åˆ°å¯¹æ–¹çš„è§†é¢‘æµ</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ---â‘£---</span><br><span class="line">        <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setRemoteDescription</span>(<span class="keyword">new</span> <span class="title class_">RTCSessionDescription</span>(offer))<span class="comment">// è®¾ç½®è¿œç«¯æè¿°ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">        ---â‘¤---</span><br><span class="line">        <span class="keyword">const</span> answer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createAnswer</span>()<span class="comment">// ç”Ÿæˆanswer</span></span><br><span class="line">        ---â‘¥---</span><br><span class="line">        <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(answer)<span class="comment">// è®¾ç½®æœ¬åœ°æè¿°ä¿¡æ¯</span></span><br><span class="line">        ---â‘¦---</span><br><span class="line">        sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendAnswer&#x27;</span>, &#123; roomId, answer &#125;)<span class="comment">// å‘é€answer !!!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åç«¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, candidate &#125;</span>) =&gt;</span> &#123;<span class="comment">// !!!</span></span><br><span class="line">    sock.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, candidate)<span class="comment">// å‘è¿™ä¸ªæˆ¿é—´é‡Œå…¶ä»–äººå¹¿æ’­candidateä¿¡æ¯</span></span><br><span class="line">&#125;)</span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendAnswer&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, answer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    sock.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveAnswer&#x27;</span>, answer)<span class="comment">// å‘è¿™ä¸ªæˆ¿é—´é‡Œå…¶ä»–äººå¹¿æ’­answerä¿¡æ¯ &amp;&amp; å‘æ¥æ”¶æ–¹å‘é€è¿™ä¸ªanswer</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å‰ç«¯</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveAnswer&#x27;</span>, <span class="function">(<span class="params"><span class="attr">answer</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;<span class="comment">// å‘é€æ–¹</span></span><br><span class="line">        ---â‘§---</span><br><span class="line">        peer.<span class="property">value</span>.<span class="title function_">setRemoteDescription</span>(<span class="keyword">new</span> <span class="title class_">RTCSessionDescription</span>(answer))<span class="comment">// è®¾ç½®è¿œç«¯æè¿°ä¿¡æ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è®©æ–‡ç« ä¸é‚£ä¹ˆä¹±ï¼Œæœ€åå†è¡¥ä¸€ä¸‹<em>candidate</em></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, <span class="title function_">async</span> (<span class="attr">candidate</span>: <span class="built_in">any</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">addIceCandidate</span>(candidate) <span class="comment">// æ·»åŠ candidateä¿¡æ¯</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>ä¸€è·¯ä¸‹æ¥æ˜¯ä¸æ˜¯é€»è¾‘éå¸¸æ¸…æ™°æ˜äº†ğŸ˜ (bushi)</p></blockquote><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><h3 id="å‰ç«¯-App-vue"><a href="#å‰ç«¯-App-vue" class="headerlink" title="å‰ç«¯ (App.vue)"></a>å‰ç«¯ (App.vue)</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; io, <span class="title class_">Socket</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;socket.io-client&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> roomId = <span class="string">&#x27;001&#x27;</span> <span class="comment">// æˆ¿é—´ID</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> called = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// æ˜¯å¦æ˜¯æ¥æ”¶æ–¹</span></span><br><span class="line"><span class="keyword">const</span> caller = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// æ˜¯å¦æ˜¯å‘èµ·æ–¹</span></span><br><span class="line"><span class="keyword">const</span> calling = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// å‘¼å«ä¸­</span></span><br><span class="line"><span class="keyword">const</span> communicating = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// è§†é¢‘é€šè¯ä¸­</span></span><br><span class="line"><span class="keyword">const</span> localVideo = ref&lt;<span class="title class_">HTMLVideoElement</span>&gt;() <span class="comment">// videoæ ‡ç­¾å®ä¾‹ï¼Œæ’­æ”¾æœ¬äººçš„è§†é¢‘</span></span><br><span class="line"><span class="keyword">const</span> remoteVideo = ref&lt;<span class="title class_">HTMLVideoElement</span>&gt;() <span class="comment">// videoæ ‡ç­¾å®ä¾‹ï¼Œæ’­æ”¾å¯¹æ–¹çš„è§†é¢‘</span></span><br><span class="line"><span class="keyword">const</span> localStream = ref&lt;<span class="title class_">MediaStream</span>&gt;() <span class="comment">// æœ¬åœ°æµ</span></span><br><span class="line"><span class="keyword">const</span> socket = ref&lt;<span class="title class_">Socket</span>&gt;() <span class="comment">// Socketå®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> peer = ref&lt;<span class="built_in">any</span>&gt;() <span class="comment">// RTCPeerConnectionå®ä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = &#123; <span class="comment">// æ–°å¢ï¼šSTUN/TURN æœåŠ¡å™¨é…ç½®</span></span><br><span class="line">  <span class="attr">iceServers</span>: [</span><br><span class="line">    &#123; <span class="attr">urls</span>: <span class="string">&#x27;stun:stun.l.google.com:19302&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">urls</span>: <span class="string">&#x27;stun:stun1.l.google.com:19302&#x27;</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> sock = <span class="title function_">io</span>(<span class="string">&#x27;localhost:3001&#x27;</span>) <span class="comment">// è¿æ¥æœåŠ¡å™¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿æ¥æˆåŠŸ</span></span><br><span class="line">    sock.<span class="title function_">on</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// è¿›å…¥æˆ¿é—´</span></span><br><span class="line">        sock.<span class="title function_">emit</span>(<span class="string">&#x27;joinRoom&#x27;</span>, roomId)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶æ–¹ç›‘å¬æ”¶åˆ°è§†é¢‘è¯·æ±‚äº‹ä»¶</span></span><br><span class="line">    sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveCall&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!caller.<span class="property">value</span>) &#123;</span><br><span class="line">            calling.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">            called.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€æ–¹æ”¶åˆ°åŒæ„è§†é¢‘äº‹ä»¶</span></span><br><span class="line">    sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="comment">// å‘é€æ–¹</span></span><br><span class="line">            <span class="comment">// åˆ›å»ºRTCPeerConnectionå¯¹è±¡</span></span><br><span class="line">            peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>(config)) <span class="comment">// æ–°å¢ï¼šä¼ å…¥ STUN/TURN</span></span><br><span class="line">            <span class="comment">// æ·»åŠ æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line">            peer.<span class="property">value</span>.<span class="title function_">addStream</span>(localStream.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–candidateä¿¡æ¯</span></span><br><span class="line">            peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line">                    <span class="comment">// å‘æœåŠ¡å™¨å‘é€candidateä¿¡æ¯</span></span><br><span class="line">                    sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–å¯¹æ–¹çš„éŸ³è§†é¢‘æµ</span></span><br><span class="line">            peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">                calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">                communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">                <span class="comment">// æ‹¿åˆ°å¯¹æ–¹çš„è§†é¢‘æµ</span></span><br><span class="line">                remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">                remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç”Ÿæˆoffer</span></span><br><span class="line">            <span class="keyword">const</span> offer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createOffer</span>(&#123;</span><br><span class="line">                <span class="attr">offerToReceiveAudio</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦æ¥æ”¶å¯¹æ–¹çš„éŸ³é¢‘</span></span><br><span class="line">                <span class="attr">offerToReceiveVideo</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦æ¥æ”¶å¯¹æ–¹çš„è§†é¢‘</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// è®¾ç½®æœ¬åœ°æè¿°çš„offer</span></span><br><span class="line">            <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(offer)</span><br><span class="line">            <span class="comment">// å‘é€offer</span></span><br><span class="line">            sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, &#123; roomId, offer &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶æ–¹æ”¶åˆ°offer</span></span><br><span class="line">    sock.<span class="title function_">on</span>(<span class="string">&#x27;sendOffer&#x27;</span>, <span class="title function_">async</span> (<span class="attr">offer</span>: <span class="built_in">any</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (called.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> stream = <span class="keyword">await</span> <span class="title function_">getLocalStream</span>()</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ¥æ”¶æ–¹åˆ›å»ºè‡ªå·±çš„RTCPeerConnectionå¯¹è±¡</span></span><br><span class="line">            peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>()</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ·»åŠ æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line">            peer.<span class="property">value</span>.<span class="title function_">addStream</span>(stream)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–candidateä¿¡æ¯</span></span><br><span class="line">            peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line">                    <span class="comment">// å‘æœåŠ¡å™¨å‘é€candidateä¿¡æ¯</span></span><br><span class="line">                    sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–å¯¹æ–¹çš„éŸ³è§†é¢‘æµ</span></span><br><span class="line">            peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// æ‹¿åˆ°å¯¹æ–¹çš„è§†é¢‘æµ</span></span><br><span class="line">                calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">                communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">                remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">                remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¾ç½®è¿œç«¯æè¿°ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setRemoteDescription</span>(<span class="keyword">new</span> <span class="title class_">RTCSessionDescription</span>(offer))</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç”Ÿæˆanswer</span></span><br><span class="line">            <span class="keyword">const</span> answer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createAnswer</span>()</span><br><span class="line">            <span class="comment">// è®¾ç½®æœ¬åœ°æè¿°ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(answer)</span><br><span class="line">            <span class="comment">// å‘é€answer</span></span><br><span class="line">            sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendAnswer&#x27;</span>, &#123; roomId, answer &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€æ–¹æ”¶åˆ°æ¥æ”¶æ–¹çš„answer</span></span><br><span class="line">    sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveAnswer&#x27;</span>, <span class="function">(<span class="params"><span class="attr">answer</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="comment">// è®¾ç½®è¿œç«¯æè¿°ä¿¡æ¯</span></span><br><span class="line">            peer.<span class="property">value</span>.<span class="title function_">setRemoteDescription</span>(<span class="keyword">new</span> <span class="title class_">RTCSessionDescription</span>(answer))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶candidateä¿¡æ¯</span></span><br><span class="line">    sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, <span class="title function_">async</span> (<span class="attr">candidate</span>: <span class="built_in">any</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">addIceCandidate</span>(candidate) <span class="comment">// æ·»åŠ candidateä¿¡æ¯</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ”¶åˆ°æŒ‚æ–­è§†é¢‘è¯·æ±‚</span></span><br><span class="line">    sock.<span class="title function_">on</span>(<span class="string">&#x27;hangUp&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">reset</span>()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    socket.<span class="property">value</span> = sock</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getLocalStream</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// è·å–éŸ³è§†é¢‘æµ</span></span><br><span class="line">    <span class="keyword">const</span> stream = <span class="keyword">await</span> navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123;</span><br><span class="line">        <span class="attr">video</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">audio</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// å°†åª’ä½“æµè®¾ç½®åˆ° video æ ‡ç­¾ä¸Šæ’­æ”¾</span></span><br><span class="line">    localVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = stream</span><br><span class="line">    <span class="comment">// æ’­æ”¾éŸ³è§†é¢‘æµ</span></span><br><span class="line">    localVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">    <span class="comment">// å­˜å‚¨æœ¬åœ°æµ</span></span><br><span class="line">    localStream.<span class="property">value</span> = stream</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> stream</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘èµ·è§†é¢‘è¯·æ±‚ï¼ˆå‘èµ·æ–¹ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">callRemote</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (calling.<span class="property">value</span> || communicating.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    calling.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// è·å–æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">getLocalStream</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘æœåŠ¡å™¨å‘é€å‘èµ·è§†é¢‘è¯·æ±‚çš„äº‹ä»¶</span></span><br><span class="line">    caller.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">    socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;callRemote&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶è§†é¢‘è¯·æ±‚ï¼ˆæ¥å—æ–¹ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">acceptCall</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// å‘æœåŠ¡å™¨å‘é€æ¥å—è§†é¢‘è¯·æ±‚çš„äº‹ä»¶</span></span><br><span class="line">    socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;acceptCall&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‚æ–­è§†é¢‘</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hangUp</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;hangUp&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çŠ¶æ€é‡ç½®</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reset</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    called.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    caller.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    communicating.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    peer.<span class="property">value</span> = <span class="literal">null</span></span><br><span class="line">    localVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = <span class="literal">null</span> <span class="comment">// å…³é—­æœ¬åœ°è§†é¢‘</span></span><br><span class="line">    remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = <span class="literal">null</span> <span class="comment">// å…³é—­è¿œç¨‹è§†é¢‘</span></span><br><span class="line">    localStream.<span class="property">value</span>?.<span class="title function_">getTracks</span>()[<span class="number">0</span>].<span class="title function_">stop</span>() <span class="comment">// å…³é—­æœ¬åœ°æµ</span></span><br><span class="line">    <span class="comment">// localStream.value = undefined // å…³é—­æœ¬åœ°æµ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡ç«¯-index-js"><a href="#æœåŠ¡ç«¯-index-js" class="headerlink" title="æœåŠ¡ç«¯ (index.js)"></a>æœåŠ¡ç«¯ (index.js)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = <span class="built_in">require</span>(<span class="string">&#x27;socket.io&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> io = <span class="title function_">socket</span>(server, &#123;</span><br><span class="line">  <span class="attr">cors</span>: &#123;</span><br><span class="line">    <span class="attr">origin</span>: <span class="string">&#x27;*&#x27;</span> <span class="comment">// é…ç½®è·¨åŸŸ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">io.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function"><span class="params">sock</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¿æ¥æˆåŠŸ...&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‘å®¢æˆ·ç«¯å‘é€è¿æ¥æˆåŠŸçš„æ¶ˆæ¯</span></span><br><span class="line">  sock.<span class="title function_">emit</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç›‘å¬å®¢æˆ·ç«¯è¿›å…¥æˆ¿é—´çš„äº‹ä»¶</span></span><br><span class="line">  sock.<span class="title function_">on</span>(<span class="string">&#x27;joinRoom&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åŠ å…¥æˆ¿é—´</span></span><br><span class="line">    sock.<span class="title function_">join</span>(roomId)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ”¶åˆ°å‘é€æ–¹çš„è§†é¢‘è¯·æ±‚äº‹ä»¶</span></span><br><span class="line">  sock.<span class="title function_">on</span>(<span class="string">&#x27;callRemote&#x27;</span>, <span class="function"><span class="params">roomId</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å‘è¿™ä¸ªæˆ¿é—´ä¸­çš„å…¶ä»–äººå¹¿æ’­è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line">    sock.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCall&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ”¶åˆ°æ¥æ”¶æ–¹çš„åŒæ„è§†é¢‘äº‹ä»¶</span></span><br><span class="line">  sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="function"><span class="params">roomId</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å‘è¿™ä¸ªæˆ¿é—´ä¸­çš„å…¶ä»–äººå¹¿æ’­è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line">    sock.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;acceptCall&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ”¶åˆ°å‘é€æ–¹çš„offer</span></span><br><span class="line">  sock.<span class="title function_">on</span>(<span class="string">&#x27;sendOffer&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, offer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å‘æ¥æ”¶æ–¹å‘é€è¿™ä¸ªoffer</span></span><br><span class="line">    sock.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, offer) </span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ”¶åˆ°æ¥æ”¶æ–¹çš„answer</span></span><br><span class="line">  sock.<span class="title function_">on</span>(<span class="string">&#x27;sendAnswer&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, answer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å‘è¿™ä¸ªæˆ¿é—´ä¸­çš„å…¶ä»–äººå¹¿æ’­è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line">    sock.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveAnswer&#x27;</span>, answer)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ”¶åˆ°å‘é€æ–¹çš„candidateä¿¡æ¯</span></span><br><span class="line">  sock.<span class="title function_">on</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, candidate &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å‘è¿™ä¸ªæˆ¿é—´ä¸­çš„å…¶ä»–äººå¹¿æ’­candidateä¿¡æ¯</span></span><br><span class="line">    sock.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, candidate)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ”¶åˆ°æŒ‚æ–­è§†é¢‘è¯·æ±‚</span></span><br><span class="line">  sock.<span class="title function_">on</span>(<span class="string">&#x27;hangUp&#x27;</span>, <span class="function"><span class="params">roomId</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å‘è¿™ä¸ªæˆ¿é—´ä¸­çš„æ‰€æœ‰äººå¹¿æ’­è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line">    io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;hangUp&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="é¡¹ç›®å¯åŠ¨æ–¹å¼"><a href="#é¡¹ç›®å¯åŠ¨æ–¹å¼" class="headerlink" title="é¡¹ç›®å¯åŠ¨æ–¹å¼"></a>é¡¹ç›®å¯åŠ¨æ–¹å¼</h2><p>åç«¯å¯åŠ¨æœåŠ¡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm start</span><br></pre></td></tr></table></figure><p>å‰ç«¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pnpm install</span><br><span class="line">pnpm dev</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ¢ç´¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>TS + NodeJSå®ç°axios</title>
      <link href="/2025/03/04/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0axios/"/>
      <url>/2025/03/04/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0axios/</url>
      
        <content type="html"><![CDATA[<h1 id="TS-NodeJS-å®ç°-axios"><a href="#TS-NodeJS-å®ç°-axios" class="headerlink" title="TS + NodeJS å®ç° axios"></a>TS + NodeJS å®ç° axios</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/alexjoverm/typescript-library-starter.git ts-axios</span><br></pre></td></tr></table></figure><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><blockquote><p>åœ¨æµè§ˆå™¨ç«¯ä½¿ç”¨ XMLHttpRequest å¯¹è±¡é€šè®¯</p><p>Promise API</p><p>è¯·æ±‚å“åº”æ‹¦æˆªå™¨</p><p>è¯·æ±‚æ•°æ®å’Œå“åº”æ•°æ®è½¬æ¢</p><p>è¯·æ±‚çš„å–æ¶ˆ</p><p>JSON æ•°æ®çš„è‡ªåŠ¨è½¬æ¢</p><p>å®¢æˆ·ç«¯é˜²æ­¢ XSRF</p></blockquote><p>æ¡†æ¶å·¥å…·</p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250129205459495.png" alt="image-20250129205459495" style="zoom:67%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250129205721267.png" alt="image-20250129205721267" style="zoom:67%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250129205345604.png" alt="image-20250129205345604" style="zoom:80%;" /><h3 id="è¯·æ±‚ä»£ç "><a href="#è¯·æ±‚ä»£ç " class="headerlink" title="è¯·æ±‚ä»£ç "></a>è¯·æ±‚ä»£ç </h3><p>axios æœ€åŸºæœ¬çš„æ“ä½œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line"><span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line"><span class="attr">url</span>: <span class="string">&#x27;/simple/get&#x27;</span>,</span><br><span class="line"><span class="attr">params</span>: &#123;</span><br><span class="line"><span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå…¥å£æ–‡ä»¶</p><p><code>index.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">axios</span>(<span class="params">config</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure><p><code>xhr.ts</code></p><blockquote><p><code>xhr</code> å‡½æ•°ç”¨äºå‘é€ HTTP è¯·æ±‚çš„å·¥å…·å‡½æ•°ï¼ŒåŸºäº XMLHttpRequest API å®ç°ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªç®€å•çš„æ¥å£æ¥é…ç½®å’Œå‘é€è¯·æ±‚ã€‚</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">xhr</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> &#123; data = <span class="literal">null</span>, url, method = <span class="string">&#x27;get&#x27;</span> &#125; = config <span class="comment">// è§£æ„è®¾ç½®é»˜è®¤å€¼</span></span><br><span class="line"><span class="keyword">const</span> request = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>() <span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ª XMLHttpRequest å¯¹è±¡ å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url, <span class="literal">true</span>) <span class="comment">// è°ƒç”¨ open æ–¹æ³• å¹¶ä¼ å…¥ method url true ä¸‰ä¸ªå‚æ•° å¹¶å°† method è½¬æ¢ä¸ºå¤§å†™å¹¶èµ‹å€¼ç»™ method,url. async:true</span></span><br><span class="line">request.<span class="title function_">send</span>(data) <span class="comment">// è°ƒç”¨ send æ–¹æ³• å¹¶ä¼ å…¥ data å‚æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250130164413743.png" alt="image-20250130164413743"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="webpack-é…ç½®"><a href="#webpack-é…ç½®" class="headerlink" title="webpack é…ç½®"></a>webpack é…ç½®</h2><blockquote><p>webpack.config.js</p><p>æ•´ä½“å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« modeï¼ˆå¼€å‘æ¨¡å¼ï¼‰ï¼Œentryï¼Œoutputï¼Œmoduleï¼Œresolveï¼Œplugins å‡ ä¸ªå…³é”®å±æ€§</p></blockquote><h3 id="entry"><a href="#entry" class="headerlink" title="entry"></a><em>entry</em></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">entry</span>: fs.<span class="title function_">readdirSync</span>(__dirname).<span class="title function_">reduce</span>(<span class="function">(<span class="params">entries, dir</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fullDir = path.<span class="title function_">join</span>(__dirname, dir)</span><br><span class="line">    <span class="keyword">const</span> entry = path.<span class="title function_">join</span>(fullDir, <span class="string">&#x27;app.ts&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (fs.<span class="title function_">statSync</span>(fullDir).<span class="title function_">isDirectory</span>() &amp;&amp; fs.<span class="title function_">existsSync</span>(entry)) &#123;</span><br><span class="line">        entries[dir] = [<span class="string">&#x27;webpack-hot-middleware/client&#x27;</span>, entry]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> entries</span><br><span class="line">&#125;, &#123;&#125;),</span><br></pre></td></tr></table></figure><blockquote><p>entries æ”¶é›†äº†å¤šä¸ªç›®å½•çš„å…¥å£æ–‡ä»¶ (app.ts) ï¼Œå¹¶å°†æ¯ä¸ªå…¥å£å¼•å…¥ä¸€ä¸ªç”¨äºçƒ­æ›´æ–°çš„æ–‡ä»¶</p><p>entries æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œkey ä¸ºç›®å½•å</p></blockquote><h3 id="output"><a href="#output" class="headerlink" title="output"></a><em>output</em></h3><blockquote><p>å°† entries çš„ key æ‰“åŒ…æˆ filename</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;__build__&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;/__build__/&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="module"><a href="#module" class="headerlink" title="module"></a><em>module</em></h3><blockquote><p>rules å®šä¹‰ä¸€ç³»åˆ—å¤„ç†ä¸åŒç±»å‹æ–‡ä»¶çš„è§„åˆ™</p><p>.ts :<code>tslint-loader</code> è¿›è¡Œé¢„å¤„ç† (åŒ…æ‹¬ç±»å‹æ£€æŸ¥)</p><p>.tsx :<code>transpileOnly: true</code> åªè¿›è¡Œç¼–è¯‘è€Œä¸è¿›è¡Œç±»å‹æ£€æŸ¥</p><p>.css :<code>style-loader</code> å°† CSS æ³¨å…¥åˆ° DOM ä¸­ï¼Œ<code>css-loader</code> å¤„ç† CSS æ–‡ä»¶ä¸­çš„ <code>@import</code> å’Œ <code>url()</code></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">            <span class="attr">enforce</span>: <span class="string">&#x27;pre&#x27;</span>,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;tslint-loader&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;ts-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>: &#123;</span><br><span class="line">                        <span class="attr">transpileOnly</span>: <span class="literal">true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a><em>resolve</em></h3><blockquote><p>æŒ‡å®šåœ¨å¯¼å…¥æ¨¡å—æ—¶å¯ä»¥çœç•¥çš„æ–‡ä»¶æ‰©å±•åï¼ŒWebpack ä¼šè‡ªåŠ¨å°è¯•è¿™äº›æ‰©å±•åã€‚</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resolve</span>: &#123;</span><br><span class="line"><span class="attr">extensions</span>: [<span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a><em>plugins</em></h3><blockquote><p>çƒ­æ›´æ–° | å‘ç”Ÿé”™è¯¯ä¸æ‰“åŒ…æ–‡ä»¶</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line"><span class="keyword">new</span> webpack.<span class="title class_">HotModuleReplacementPlugin</span>(),</span><br><span class="line"><span class="keyword">new</span> webpack.<span class="title class_">NoEmitOnErrorsPlugin</span>(),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒåŠŸèƒ½"><a href="#æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="æ ¸å¿ƒåŠŸèƒ½"></a>æ ¸å¿ƒåŠŸèƒ½</h2><h3 id="å¤„ç†-url-å‚æ•°-params"><a href="#å¤„ç†-url-å‚æ•°-params" class="headerlink" title="å¤„ç† url å‚æ•°(params)"></a>å¤„ç† url å‚æ•°(params)</h3><blockquote><p>æ ¸å¿ƒæ€æƒ³ï¼šæŠŠ params çš„ key&amp;value <strong>è§£æ„æ‹¼æ¥</strong>åˆ° URL ä¸Š</p></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210214938544.png" alt="image-20250210214938544" style="zoom: 50%;" /><p><code>helpers/url.ts</code></p><h4 id="è§£æ„-URL-params"><a href="#è§£æ„-URL-params" class="headerlink" title="è§£æ„ URL -&gt; params"></a>è§£æ„ URL -&gt; params</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">bulidURL</span>(<span class="params"><span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">params</span>?: <span class="built_in">any</span></span>): <span class="built_in">string</span> &#123;<span class="comment">//è§£æ„</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>éœ€å¤„ç†é€»è¾‘</strong></p><p><em>æ²¡æœ‰å‚æ•°</em></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215202014.png" alt="image-20250210215202014" style="zoom:50%;" /><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!params) &#123;</span><br><span class="line"><span class="comment">// æ²¡æœ‰å‚æ•° ç›´æ¥è¿”å› url</span></span><br><span class="line"><span class="keyword">return</span> url</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è§£æ„-params-key-value"><a href="#è§£æ„-params-key-value" class="headerlink" title="è§£æ„ params -&gt; key&#x2F;value"></a>è§£æ„ params -&gt; key&#x2F;value</h4><p>params æ˜¯ä¸€ä¸ªåŒ…å«è¯·æ±‚å‚æ•°çš„å¯¹è±¡</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line"><span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line"><span class="attr">hobbies</span>: [<span class="string">&#x27;reading&#x27;</span>, <span class="string">&#x27;coding&#x27;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“ä»£ç </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">parts</span>: <span class="built_in">string</span>[] = [] <span class="comment">// å­˜æ”¾å‚æ•°çš„æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(params).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123; <span class="comment">// key ä¾æ¬¡å–åˆ° &#x27;name&#x27;, &#x27;age&#x27;, &#x27;hobbies&#x27; ç­‰å€¼</span></span><br><span class="line">    <span class="keyword">const</span> val = params[key] <span class="comment">// å¯¹è±¡keyå€¼æ‰€å¯¹åº”çš„value</span></span><br><span class="line">    ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><em>value ä¸º null æˆ– undefined</em></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (val === <span class="literal">null</span> || <span class="keyword">typeof</span> val === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>value</em> ä¸º <em>æ•°ç»„</em></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210214959177.png" alt="image-20250210214959177" style="zoom:50%;" /><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> values = [] <span class="comment">// å®šä¹‰ values å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(val)) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ value ä¸ºæ•°ç»„ ç›´æ¥èµ‹å€¼ç»™ values</span></span><br><span class="line">values = val</span><br><span class="line">key += <span class="string">&#x27;[]&#x27;</span> <span class="comment">// é”®ååé¢æ·»åŠ ä¸€ä¸ª []</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">values = [val] <span class="comment">// èµ‹å€¼ç»™ values</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>value</em> ä¸º <em>Data</em> | <em>å­—ç¬¦ä¸²</em> | <em>å¯¹è±¡</em></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215112025.png" alt="image-20250210215112025" style="zoom:50%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215135428.png" alt="image-20250210215135428" style="zoom:50%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215027145.png" alt="image-20250210215027145" style="zoom:50%;" /><p>helpers&#x2F;util.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isDate</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Date</span> &#123;</span><br><span class="line"><span class="keyword">return</span> toString.<span class="title function_">call</span>(val) === <span class="string">&#x27;[object Date]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isObject</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Object</span> &#123;</span><br><span class="line"><span class="keyword">return</span> val !== <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">&#x27;object&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†å›æ¥</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isDate, isObject &#125; <span class="keyword">from</span> <span class="string">&#x27;./util&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encode</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(val)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%40/g</span>, <span class="string">&#x27;@&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%3A/gi</span>, <span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%24/g</span>, <span class="string">&#x27;$&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%2C/gi</span>, <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%20/g</span>, <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%5B/gi</span>, <span class="string">&#x27;[&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%5D/gi</span>, <span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">values.<span class="title function_">forEach</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// éå† values</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isDate</span>(val)) &#123;</span><br><span class="line"><span class="comment">// value ä¸ºæ—¥æœŸ</span></span><br><span class="line">val = val.<span class="title function_">toISOString</span>() <span class="comment">// è½¬æ¢ä¸º ISO æ ¼å¼èµ‹å€¼ç»™ val</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isObject</span>(val)) &#123;</span><br><span class="line"><span class="comment">// value ä¸ºå¯¹è±¡</span></span><br><span class="line">val = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(val) <span class="comment">// è½¬æ¢ä¸ºå­—ç¬¦ä¸²èµ‹å€¼ç»™ val</span></span><br><span class="line">&#125;</span><br><span class="line">parts.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;encode(key)&#125;</span>=<span class="subst">$&#123;encode(val)&#125;</span>`</span>) <span class="comment">// ç‰¹æ®Šå­—ç¬¦è½¬ç èµ‹å€¼ç»™ parts</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ‹¼è£…æˆ URL</p><blockquote><p>parts.join(â€˜&amp;â€™) æ•ˆæœ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;[<span class="string">&#x27;name=John&#x27;</span>, <span class="string">&#x27;age=30&#x27;</span>, <span class="string">&#x27;hobbies[]=reading&#x27;</span>, <span class="string">&#x27;hobbies[]=coding&#x27;</span>]</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;name=John&amp;age=30&amp;hobbies[]=reading&amp;hobbies[]=coding&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215213939.png" alt="image-20250210215213939" style="zoom:50%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215227134.png" alt="image-20250210215227134" style="zoom:50%;" /><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> serializedParams = parts.<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>) <span class="comment">// å°† parts æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ &amp; ä½œä¸ºåˆ†éš”ç¬¦</span></span><br><span class="line"><span class="keyword">if</span> (serializedParams) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ serializedParams ä¸ä¸ºç©º åˆ™æ‹¼æ¥ url</span></span><br><span class="line"><span class="keyword">const</span> markIndex = url.<span class="title function_">indexOf</span>(<span class="string">&#x27;#&#x27;</span>) <span class="comment">// æŸ¥æ‰¾ URL ä¸­æ˜¯å¦å­˜åœ¨ # ç¬¦å· è¿”å› # ç¬¦å·åœ¨ URL ä¸­çš„ä½ç½®ç´¢å¼•</span></span><br><span class="line"><span class="keyword">if</span> (markIndex !== -<span class="number">1</span>) &#123;</span><br><span class="line">url = url.<span class="title function_">slice</span>(<span class="number">0</span>, markIndex) <span class="comment">// ä½¿ç”¨sliceæ–¹æ³•å°†URLæˆªå–åˆ°å“ˆå¸Œéƒ¨åˆ†ä¹‹å‰ï¼Œä»è€Œå»é™¤å“ˆå¸Œéƒ¨åˆ†</span></span><br><span class="line">&#125;</span><br><span class="line">url += (url.<span class="title function_">indexOf</span>(<span class="string">&#x27;?&#x27;</span>) === -<span class="number">1</span> ? <span class="string">&#x27;?&#x27;</span> : <span class="string">&#x27;&amp;&#x27;</span>) + serializedParams <span class="comment">// ç¡®ä¿URLä¸­çš„æŸ¥è¯¢å‚æ•°?å­˜åœ¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†-body-æ•°æ®"><a href="#å¤„ç†-body-æ•°æ®" class="headerlink" title="å¤„ç† body æ•°æ®"></a>å¤„ç† body æ•°æ®</h3><p>helpers&#x2F;util.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isDate</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Date</span> &#123;</span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºæ—¥æœŸ</span></span><br><span class="line"><span class="keyword">return</span> toString.<span class="title function_">call</span>(val) === <span class="string">&#x27;[object Date]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// export function isObject(val: any): val is Object &#123;  // åˆ¤æ–­æ˜¯å¦ä¸ºå¯¹è±¡</span></span><br><span class="line"><span class="comment">//   return val !== null &amp;&amp; typeof val === &#x27;object&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isPlainObject</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Object</span> &#123;</span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºæ™®é€šå¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> toString.<span class="title function_">call</span>(val) === <span class="string">&#x27;[object Object]&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>helpers&#x2F;data.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isPlainObject &#125; <span class="keyword">from</span> <span class="string">&#x27;./util&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">transformRequest</span>(<span class="params"><span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(data)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformURL</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† url è¿”å›æ‹¼æ¥åçš„ url</span></span><br><span class="line"><span class="keyword">const</span> &#123; url, params &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">bulidURL</span>(url, params)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformRequestData</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† data</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequest</span>(config.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†-header"><a href="#å¤„ç†-header" class="headerlink" title="å¤„ç† header"></a>å¤„ç† header</h3><blockquote><p>headers ä¸€èˆ¬ä¼ é€’è¯¸å¦‚è®¤è¯ä¿¡æ¯ã€å†…å®¹ç±»å‹ç­‰å…ƒæ•°æ®ç»™æœåŠ¡å™¨</p></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250212030911535.png" alt="image-20250212030911535" style="zoom:50%;" /><p>helpers&#x2F;header.ts</p><blockquote><p>å¤„ç† headers</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">processHeaders</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>, <span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// processHeaders å‡½æ•°æ¥æ”¶ headers å’Œ data ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="title function_">normalizeHeaderName</span>(headers, <span class="string">&#x27;Content-Type&#x27;</span>) <span class="comment">// è°ƒç”¨ normalizeHeaderName å‡½æ•°å°† headers çš„ Content-Type å±æ€§åè§„èŒƒåŒ–</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(data)) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ data æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡</span></span><br><span class="line"><span class="keyword">if</span> (headers &amp;&amp; !headers[<span class="string">&#x27;Content-Type&#x27;</span>]) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ headers ä¸å­˜åœ¨ Content-Type å±æ€§</span></span><br><span class="line">headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json;charset=utf-8&#x27;</span> <span class="comment">// è®¾ç½® Content-Type å±æ€§ä¸º application/json;charset=utf-8</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>Content-Type</code> æ˜¯ HTTP è¯·æ±‚å¤´çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæŒ‡ç¤ºå®ä½“ä¸»ä½“ï¼ˆå³è¯·æ±‚æˆ–å“åº”çš„æ­£æ–‡éƒ¨åˆ†ï¼‰çš„æ•°æ®ç±»å‹ã€‚å®ƒå‘Šè¯‰æ¥æ”¶æ–¹å¦‚ä½•è§£ææ¥æ”¶åˆ°çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“å‘é€ JSON æ ¼å¼çš„æ•°æ®æ—¶ï¼Œé€šå¸¸ä¼šå°† <code>Content-Type</code> è®¾ç½®ä¸º <code>application/json</code>ï¼Œè¿™æ ·æ¥æ”¶æ–¹å°±çŸ¥é“åº”è¯¥ä»¥ JSON çš„å½¢å¼æ¥è§£ææ•°æ®</p></blockquote><p>è¾…åŠ©å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeHeaderName</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>, <span class="attr">normalizedName</span>: <span class="built_in">string</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// normalizeHeaderName å‡½æ•°æ¥æ”¶ headers å’Œ normalizedName ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> (!headers) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ headers ä¸å­˜åœ¨</span></span><br><span class="line"><span class="keyword">return</span> <span class="comment">// ç›´æ¥è¿”å›</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// éå† headers çš„æ‰€æœ‰å±æ€§</span></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">name !== normalizedName &amp;&amp;</span><br><span class="line">name.<span class="title function_">toUpperCase</span>() === normalizedName.<span class="title function_">toUpperCase</span>()</span><br><span class="line">) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœå±æ€§åä¸ç­‰äº normalizedName å¹¶ä¸”å±æ€§åçš„å¤§å†™å½¢å¼ç­‰äº normalizedName çš„å¤§å†™å½¢å¼</span></span><br><span class="line">headers[normalizedName] = headers[name] <span class="comment">// å°† headers çš„å±æ€§åè®¾ç½®ä¸º normalizedName (content-type -&gt; Content-Type)</span></span><br><span class="line"><span class="keyword">delete</span> headers[name] <span class="comment">// åˆ é™¤ headers çš„å±æ€§å</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> headers <span class="comment">// è¿”å› headers</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>types&#x2F;index.ts åŠ å…¥ headers</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line"><span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.ts å¢æ·»å¤„ç†é€»è¾‘</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// å…ˆå¤„ç† headers</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// å†å¤„ç† data</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformHeaders</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† headers è°ƒç”¨ processHeaders æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> &#123; headers = &#123;&#125;, data &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">processHeaders</span>(headers, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>xhr.ts æ·»åŠ  header å¤„ç†é€»è¾‘</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">xhr</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="keyword">const</span> &#123; data = <span class="literal">null</span>, url, method = <span class="string">&#x27;get&#x27;</span>, headers &#125; = config <span class="comment">// æ·»åŠ headerè§£æ„</span></span><br><span class="line"><span class="keyword">const</span> request = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>() <span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ª XMLHttpRequest å¯¹è±¡ å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// éå† headers çš„æ‰€æœ‰å±æ€§</span></span><br><span class="line"><span class="keyword">if</span> (data === <span class="literal">null</span> &amp;&amp; name.<span class="title function_">toLowerCase</span>() === <span class="string">&#x27;content-type&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ data ä¸º null å¹¶ä¸”å±æ€§åä¸º content-type</span></span><br><span class="line"><span class="keyword">delete</span> headers[name] <span class="comment">// åˆ é™¤ headers çš„å±æ€§å</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">request.<span class="title function_">setRequestHeader</span>(name, headers[name]) <span class="comment">// è°ƒç”¨ setRequestHeader æ–¹æ³• å¹¶ä¼ å…¥ name headers[name] ä¸¤ä¸ªå‚æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">request.<span class="title function_">send</span>(data) <span class="comment">// è°ƒç”¨ send æ–¹æ³• å¹¶ä¼ å…¥ data å‚æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><blockquote><p>è¿™éƒ¨åˆ†å¤„ç†å®ç°äº†</p><p>ä¸º Content-Type è‡ªåŠ¨æ·»åŠ  application&#x2F;json;charset&#x3D;UTF-8ï¼ˆå‘ŠçŸ¥æœåŠ¡ç«¯è§£æçš„æ˜¯ JSON æ•°æ®ï¼‰</p></blockquote><h3 id="è·å–å¤„ç†-response"><a href="#è·å–å¤„ç†-response" class="headerlink" title="è·å–å¤„ç† response"></a>è·å–å¤„ç† response</h3><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="comment">//configæ¥å£</span></span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line"><span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">responseType</span>?: <span class="title class_">XMLHttpRequestResponseType</span> <span class="comment">//æ–°å¢</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line"><span class="comment">//responseæ¥å£</span></span><br><span class="line"><span class="attr">data</span>: <span class="built_in">any</span></span><br><span class="line"><span class="attr">status</span>: <span class="built_in">number</span></span><br><span class="line"><span class="attr">statusText</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">headers</span>: <span class="built_in">any</span></span><br><span class="line"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line"><span class="attr">request</span>: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosPromise</span> <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;<span class="title class_">AxiosResponse</span>&gt; &#123;</span><br><span class="line"><span class="comment">//promiseæ¥å£</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>xhr.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">xhr</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// xhr å‡½æ•°æ¥æ”¶ä¸€ä¸ª config å‚æ•°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> <span class="comment">// è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ å¹¶ä¼ å…¥ resolve reject ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line">    <span class="keyword">const</span> &#123; data = <span class="literal">null</span>, url, method = <span class="string">&#x27;get&#x27;</span>, headers, responseType &#125; = config <span class="comment">// è§£æ„èµ‹å€¼æ‹¿åˆ°å˜é‡</span></span><br><span class="line">    <span class="keyword">const</span> request = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>() <span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ª XMLHttpRequest å¯¹è±¡ å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (responseType) &#123;</span><br><span class="line">      request.<span class="property">responseType</span> = responseType</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url, <span class="literal">true</span>) <span class="comment">// è°ƒç”¨ open æ–¹æ³• å¹¶ä¼ å…¥ method url true ä¸‰ä¸ªå‚æ•° å¹¶å°† method è½¬æ¢ä¸ºå¤§å†™å¹¶èµ‹å€¼ç»™ method,url. async:trueå¼‚æ­¥</span></span><br><span class="line"></span><br><span class="line">    request.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> <span class="title function_">handleLoad</span>(<span class="params"></span>) &#123;<span class="comment">// è°ƒç”¨ onreadystatechange æ–¹æ³• å¹¶ä¼ å…¥ handleLoad å‡½æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">      <span class="keyword">if</span> (request.<span class="property">readyState</span> !== <span class="number">4</span>) &#123;<span class="comment">// 4çŠ¶æ€ä¸ºæ­£ç¡®æ¥æ”¶åˆ°æ•°æ® (// æ²¡æœ‰æ”¶åˆ°æ­£ç¡®çš„å“åº”)</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> responseHeaders = request.<span class="title function_">getAllResponseHeaders</span>() <span class="comment">// è°ƒç”¨ getAllResponseHeaders æ–¹æ³• å¹¶èµ‹å€¼ç»™ responseHeaders å˜é‡ï¼ˆåé¢è¦å¤„ç†è¿™ä¸ªå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">      <span class="keyword">const</span> responseData = responseType &amp;&amp; responseType !== <span class="string">&#x27;text&#x27;</span> ? request.<span class="property">response</span> : request.<span class="property">responseText</span> <span class="comment">// è°ƒç”¨ responseText æ–¹æ³• å¹¶èµ‹å€¼ç»™ responseData å˜é‡</span></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">response</span>: <span class="title class_">AxiosResponse</span> = &#123;</span><br><span class="line">        <span class="attr">data</span>: responseData,</span><br><span class="line">        <span class="attr">status</span>: request.<span class="property">status</span>,</span><br><span class="line">        <span class="attr">statusText</span>: request.<span class="property">statusText</span>,</span><br><span class="line">        <span class="attr">headers</span>: responseHeaders,</span><br><span class="line">        config,</span><br><span class="line">        request</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">resolve</span>(response) <span class="comment">// è°ƒç”¨ resolve æ–¹æ³• å¹¶ä¼ å…¥ response å‚æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function"><span class="params">name</span> =&gt;</span> &#123;<span class="comment">// éå† headers çš„æ‰€æœ‰å±æ€§</span></span><br><span class="line">      <span class="keyword">if</span> (data === <span class="literal">null</span> &amp;&amp; name.<span class="title function_">toLowerCase</span>() === <span class="string">&#x27;content-type&#x27;</span>) &#123;<span class="comment">// å¦‚æœ data ä¸º null å¹¶ä¸”å±æ€§åä¸º content-type</span></span><br><span class="line">        <span class="keyword">delete</span> headers[name] <span class="comment">// åˆ é™¤ headers çš„å±æ€§å</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        request.<span class="title function_">setRequestHeader</span>(name, headers[name]) <span class="comment">// è°ƒç”¨ setRequestHeader æ–¹æ³• å¹¶ä¼ å…¥ name headers[name] ä¸¤ä¸ªå‚æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    request.<span class="title function_">send</span>(data) <span class="comment">// è°ƒç”¨ send æ–¹æ³• å¹¶ä¼ å…¥ data å‚æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">axios</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line"><span class="comment">// axios å‡½æ•°æ¥æ”¶ä¸€ä¸ª config å‚æ•°</span></span><br><span class="line"><span class="title function_">processConfig</span>(config)</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">xhr</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>getAllResponseHeaders</code>æ–¹æ³•å¤„ç†</p><p>XMLHttpRequest å¯¹è±¡çš„ getAllResponseHeaders æ–¹æ³•è·å–åˆ°çš„å€¼æ˜¯å¦‚ä¸‹å­—ç¬¦ä¸²</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">date<span class="punctuation">:</span>Fri<span class="punctuation">,</span><span class="number">05</span> Apr <span class="number">2019</span> <span class="number">12</span><span class="punctuation">:</span><span class="number">40</span><span class="punctuation">:</span><span class="number">49</span> GMT</span><br><span class="line">etag<span class="punctuation">:</span> W/<span class="string">&quot;d-Ssxx4FRxEutDLwo2+xkkxKc4y0k&#x27;&#x27;</span></span><br><span class="line"><span class="string">connection: keep-alive</span></span><br><span class="line"><span class="string">x-powered-by: Express</span></span><br><span class="line"><span class="string">content-length:13</span></span><br><span class="line"><span class="string">content-type:application/json;charset=utf-8</span></span><br></pre></td></tr></table></figure><blockquote><p>æ¯ä¸€è¡Œéƒ½æ˜¯ä»¥å›è½¦å’Œæ¢è¡Œç¬¦<code>\r\n</code>ç»“æŸï¼Œæ˜¯æ¯ä¸ª header å±æ€§çš„åˆ†éš”ç¬¦</p></blockquote><p>è€Œæˆ‘ä»¬å¸Œæœ›è§£ææˆçš„å¯¹è±¡ç»“æ„</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    date<span class="punctuation">:</span>Fri<span class="punctuation">,</span><span class="number">05</span> Apr <span class="number">2019</span> <span class="number">12</span><span class="punctuation">:</span><span class="number">40</span><span class="punctuation">:</span><span class="number">49</span> GMT</span><br><span class="line">etag<span class="punctuation">:</span> W/<span class="string">&quot;d-Ssxx4FRxEutDLwo2+xkkxKc4y0k&#x27;&#x27;,</span></span><br><span class="line"><span class="string">connection: keep-alive,</span></span><br><span class="line"><span class="string">x-powered-by: Express,</span></span><br><span class="line"><span class="string">content-length:13</span></span><br><span class="line"><span class="string">content-type:application/json;charset=utf-8</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>headers.ts æ–°å¢ parseHeaders æ–¹æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">parseHeaders</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">string</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// parseHeaders å‡½æ•°æ¥æ”¶ headers å‚æ•°</span></span><br><span class="line"><span class="keyword">let</span> parsed = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>) <span class="comment">// åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">if</span> (!headers) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ headers ä¸å­˜åœ¨</span></span><br><span class="line"><span class="keyword">return</span> parsed <span class="comment">// è¿”å› parsed</span></span><br><span class="line">&#125;</span><br><span class="line">headers.<span class="title function_">split</span>(<span class="string">&#x27;\r\n&#x27;</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">line</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// éå† headers çš„æ¯ä¸€è¡Œ</span></span><br><span class="line"><span class="keyword">let</span> [key, val] = line.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>) <span class="comment">// åˆ†å‰²æ¯ä¸€è¡Œçš„ key å’Œ val</span></span><br><span class="line">key = key.<span class="title function_">trim</span>().<span class="title function_">toLowerCase</span>() <span class="comment">// å»æ‰ key çš„ç©ºæ ¼å¹¶å°† key è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line"><span class="keyword">if</span> (!key) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ key ä¸å­˜åœ¨</span></span><br><span class="line"><span class="keyword">return</span> <span class="comment">// ç›´æ¥è¿”å›</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (val) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ val å­˜åœ¨</span></span><br><span class="line">val = val.<span class="title function_">trim</span>() <span class="comment">// å»æ‰ val çš„ç©ºæ ¼</span></span><br><span class="line">&#125;</span><br><span class="line">parsed[key] = val <span class="comment">// å°† key å’Œ val èµ‹å€¼ç»™ parsed</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> parsed <span class="comment">// è¿”å› parsed</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†å“åº”-data"><a href="#å¤„ç†å“åº”-data" class="headerlink" title="å¤„ç†å“åº” data"></a>å¤„ç†å“åº” data</h3><p>ä¸è®¾ç½® responseType æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯è¿”å›æ•°æ®æ˜¯å­—ç¬¦ä¸²ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data: &quot;&#123;&quot;a&quot;:1,&quot;b&quot;:2&#125;&quot;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦è½¬æˆå¯¹è±¡</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data<span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    a<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    b<span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>data.ts æ–°å¢ transformResponse è½¬åŒ–å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">transformResponse</span>(<span class="params"><span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> data === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"><span class="comment">// do nothing</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.ts å¤„ç† axios</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/data&#x27;</span> <span class="comment">// æ–°å¢å¼•å…¥è½¬åŒ–å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">axios</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line"><span class="title function_">processConfig</span>(config)</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">xhr</span>(config).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//è¯·æ±‚ç»“æŸåå¯¹ response data è¿›è¡Œå¤„ç†</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">transformResponseData</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformResponseData</span>(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>): <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† response data</span></span><br><span class="line">res.<span class="property">data</span> = <span class="title function_">transformResponse</span>(res.<span class="property">data</span>)</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/// åŸºç¡€æ ¸å¿ƒåŠŸèƒ½è‡³æ­¤å·²å…¨éƒ¨å®ç° ///</span><br></pre></td></tr></table></figure><h2 id="é”™è¯¯å¤„ç†-reject-æ‹’å›"><a href="#é”™è¯¯å¤„ç†-reject-æ‹’å›" class="headerlink" title="é”™è¯¯å¤„ç†(reject æ‹’å›)"></a>é”™è¯¯å¤„ç†(reject æ‹’å›)</h2><h3 id="å¤„ç†ç½‘ç»œé”™è¯¯"><a href="#å¤„ç†ç½‘ç»œé”™è¯¯" class="headerlink" title="å¤„ç†ç½‘ç»œé”™è¯¯"></a>å¤„ç†ç½‘ç»œé”™è¯¯</h3><p>ç½‘ç»œä¸é€šæ—¶å‘é€è¯·æ±‚ä¼šè§¦å‘ XMLHttpRequest å¯¹è±¡å®ä¾‹çš„ error äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ onerror äº‹ä»¶å›è°ƒå‡½æ•°ä¸­æ•è·æ­¤ç±»é”™è¯¯</p><p>xhr.ts ä¸­æ·»åŠ </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onerror</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨ onerror æ–¹æ³• å¹¶ä¼ å…¥ handleError å‡½æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Network Error&#x27;</span>)) <span class="comment">// è°ƒç”¨ reject æ–¹æ³• å¹¶ä¼ å…¥ Network Error å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†è¶…æ—¶é”™è¯¯"><a href="#å¤„ç†è¶…æ—¶é”™è¯¯" class="headerlink" title="å¤„ç†è¶…æ—¶é”™è¯¯"></a>å¤„ç†è¶…æ—¶é”™è¯¯</h3><p>è®¾ç½®ä¸€ä¸ª timeoutï¼Œå½“è¯·æ±‚è¶…è¿‡æŸä¸ªæ—¶é—´åæ²¡æ”¶åˆ°å“åº”åˆ™ç»ˆæ­¢ï¼Œå¹¶è§¦å‘ timeout äº‹ä»¶</p><blockquote><p>é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 0ï¼ˆæ°¸ä¸è¶…æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å…è®¸ç¨‹åºå¯é…ç½®è¶…æ—¶æ—¶é—´</p></blockquote><p>type &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="comment">//configæ¥å£</span></span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line"><span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">responseType</span>?: <span class="title class_">XMLHttpRequestResponseType</span></span><br><span class="line"><span class="attr">timeout</span>?: <span class="built_in">number</span> <span class="comment">// æ–°å¢timeout</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>xhr.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">data = <span class="literal">null</span>,</span><br><span class="line">url,</span><br><span class="line">method = <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">headers,</span><br><span class="line">responseType,</span><br><span class="line">timeout,</span><br><span class="line">&#125; = config <span class="comment">// æ–°å¢è§£æ„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å¢é€»è¾‘</span></span><br><span class="line"><span class="keyword">if</span> (timeout) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ timeout å­˜åœ¨</span></span><br><span class="line">request.<span class="property">timeout</span> = timeout</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request.<span class="property">ontimeout</span> = <span class="keyword">function</span> <span class="title function_">handleTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Timeout of <span class="subst">$&#123;timeout&#125;</span> ms exceeded`</span>)) <span class="comment">// è¶…è¿‡ $&#123;timeout&#125; æ¯«ç§’ è¶…æ—¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çŠ¶æ€ç å¤„ç†-200-é”™è¯¯"><a href="#çŠ¶æ€ç å¤„ç†-200-é”™è¯¯" class="headerlink" title="çŠ¶æ€ç å¤„ç†(!200 é”™è¯¯)"></a>çŠ¶æ€ç å¤„ç†(!200 é”™è¯¯)</h3><blockquote><p>å¤„ç†æ—¶æœºï¼šæ¥æ”¶åˆ°å“åº”çš„æ—¶å€™</p></blockquote><p>xhr.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> <span class="title function_">handleLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (request.<span class="property">readyState</span> !== <span class="number">4</span>) &#123;</span><br><span class="line"><span class="comment">// æ²¡æœ‰æ”¶åˆ°æ­£ç¡®çš„å“åº”</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¹Ÿå°±æ˜¯åœ¨è¿™é‡Œ//</span></span><br><span class="line"><span class="keyword">if</span> (request.<span class="property">status</span> === <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœå‘é€ç½‘ç»œé”™è¯¯ || è¶…æ—¶é”™è¯¯</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">resolve</span>(response) <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// ä¼ å…¥å¤„ç† response å‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> (response.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; response.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line"><span class="comment">// çŠ¶æ€ç  å¤§äºç­‰äº 200 å¹¶ä¸”å°äº 300</span></span><br><span class="line"><span class="title function_">resolve</span>(response) <span class="comment">// è°ƒç”¨ resolve æ–¹æ³• å¹¶ä¼ å…¥ response å‚æ•°</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Request failed with status code <span class="subst">$&#123;response.status&#125;</span>`</span>)) <span class="comment">// æŠ¥é”™çŠ¶æ€ç </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é”™è¯¯ä¿¡æ¯å¢å¼º"><a href="#é”™è¯¯ä¿¡æ¯å¢å¼º" class="headerlink" title="é”™è¯¯ä¿¡æ¯å¢å¼º"></a>é”™è¯¯ä¿¡æ¯å¢å¼º</h3><blockquote><p>æŒ‰ç…§ä¹‹å‰çš„æ“ä½œï¼Œæˆ‘ä»¬å®ç°äº†å¯¹åŸºç¡€é”™è¯¯ä¿¡æ¯çš„å¤„ç†ï¼Œä½†æˆ‘ä»¬å¯¹å¤–æä¾›çš„é”™è¯¯ä¿¡æ¯æ˜¯ååˆ†æœ‰é™çš„</p><p>æˆ‘ä»¬å¸Œæœ›å¯¹å¤–æä¾›çš„é”™è¯¯ä¿¡æ¯åŒ…æ‹¬</p><p>é”™è¯¯æ–‡æœ¬ä¿¡æ¯ï¼ˆæŠ¥é”™æ˜¾ç¤ºï¼‰</p><p>è¯·æ±‚å¯¹è±¡é…ç½® config</p><p>é”™è¯¯ä»£ç  code</p><p>XMLHttpRequest å¯¹è±¡å®ä¾‹ request</p><p>è‡ªå®šä¹‰å“åº”å¯¹è±¡ response</p></blockquote><h4 id="åˆ›å»º-AxiosError-ç±»"><a href="#åˆ›å»º-AxiosError-ç±»" class="headerlink" title="åˆ›å»º AxiosError ç±»"></a>åˆ›å»º AxiosError ç±»</h4><p>types &#x2F; index.ts å®šä¹‰æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosError</span> <span class="keyword">extends</span> <span class="title class_">Error</span> &#123;</span><br><span class="line"><span class="comment">//erroræ¥å£</span></span><br><span class="line"><span class="attr">isAxiosError</span>: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line"><span class="attr">code</span>?: <span class="built_in">string</span></span><br><span class="line"><span class="attr">request</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å»º helpers &#x2F; error.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AxiosError</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªAxiosErrorç±»ç»§æ‰¿Errorç±» å®ç°AxiosErroræ¥å£ å¹¶è®¾ç½® isAxiosErrorä¸ºtrue</span></span><br><span class="line"><span class="attr">isAxiosError</span>: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line"><span class="attr">code</span>?: <span class="built_in">string</span> | <span class="literal">null</span></span><br><span class="line"><span class="attr">request</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params"><span class="comment">//æ„é€ å‡½æ•° æ¥æ”¶äº”ä¸ªå‚æ•°èµ‹å€¼ç»™å¯¹åº”çš„å±æ€§ å¹¶è®¾ç½® isAxiosErrorä¸ºtrue</span></span></span><br><span class="line"><span class="params"><span class="attr">message</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>,</span></span><br><span class="line"><span class="params"><span class="attr">code</span>?: <span class="built_in">string</span> | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params"><span class="attr">request</span>?: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params"><span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">super</span>(message) <span class="comment">//è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•° ä¼ å…¥messageå‚æ•°èµ‹å€¼ç»™messageå±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">config</span> = config</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">code</span> = code</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">request</span> = request</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">response</span> = response</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">isAxiosError</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="variable language_">this</span>, <span class="title class_">AxiosError</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// ä¿®å¤åŸå‹é“¾é—®é¢˜</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createError</span>(<span class="params"> <span class="comment">//å®šä¹‰ä¸€ä¸ªcreateErrorå‡½æ•° æ¥æ”¶äº”ä¸ªå‚æ•° å¹¶è¿”å›ä¸€ä¸ªAxiosErrorå¯¹è±¡</span></span></span><br><span class="line"><span class="params"><span class="attr">message</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>,</span></span><br><span class="line"><span class="params"><span class="attr">code</span>?: <span class="built_in">string</span> | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params"><span class="attr">request</span>?: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params"><span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> error = <span class="keyword">new</span> <span class="title class_">AxiosError</span>(message, config, code, request, response)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="createError-æ–¹æ³•åº”ç”¨"><a href="#createError-æ–¹æ³•åº”ç”¨" class="headerlink" title="createError æ–¹æ³•åº”ç”¨"></a>createError æ–¹æ³•åº”ç”¨</h4><blockquote><p>å¯¹é”™è¯¯å¯¹è±¡åˆ›å»ºçš„é€»è¾‘è¿›è¡Œä¿®æ”¹</p></blockquote><p>xhr.ts</p><p><strong><em>onerror ä¿®æ”¹</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onerror</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Network Error&#x27;</span>)) <span class="comment">// è°ƒç”¨ reject æ–¹æ³• å¹¶ä¼ å…¥ Network Error å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›¿æ¢ä¸º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onerror</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="title function_">createError</span>(<span class="string">&#x27;Network Error&#x27;</span>, config, <span class="literal">null</span>, request)) <span class="comment">// ä¼ å…¥ &#x27;Network Error&#x27;,config,null,request å‚æ•°ï¼ˆäº‹ä»¶è§¦å‘æ—¶æ‹¿ä¸åˆ°responseå°±ä¸ä¼ äº†ï¼‰ è°ƒç”¨ createError æ–¹æ³•å¹¶ä¼ å…¥å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><em>ontimeout ä¿®æ”¹</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">ontimeout</span> = <span class="keyword">function</span> <span class="title function_">handleTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨ ontimeout æ–¹æ³• å¹¶ä¼ å…¥ handleTimeout å‡½æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Timeout of <span class="subst">$&#123;timeout&#125;</span> ms exceeded`</span>)) <span class="comment">// è°ƒç”¨ reject æ–¹æ³• å¹¶ä¼ å…¥ Timeout of $&#123;timeout&#125; ms exceeded å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›¿æ¢ä¸º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">ontimeout</span> = <span class="keyword">function</span> <span class="title function_">handleTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨ ontimeout æ–¹æ³• å¹¶ä¼ å…¥ handleTimeout å‡½æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line"><span class="title function_">reject</span>(</span><br><span class="line"><span class="title function_">createError</span>(</span><br><span class="line"><span class="string">`Timeout of <span class="subst">$&#123;timeout&#125;</span> ms exceeded`</span>,</span><br><span class="line">config,</span><br><span class="line"><span class="string">&#x27;ECONNABORTED&#x27;</span>,</span><br><span class="line">request</span><br><span class="line">)</span><br><span class="line">) <span class="comment">// ä¼ å…¥ `Timeout of $&#123;timeout&#125; ms exceeded`,config,&#x27;ECONNABORTED&#x27;,request å‚æ•° è°ƒç”¨ createError æ–¹æ³• å¹¶ä¼ å…¥å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><em>handleResponse ä¿®æ”¹</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// ä¼ å…¥å¤„ç† response å‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> (response.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; response.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line"><span class="comment">// çŠ¶æ€ç  å¤§äºç­‰äº 200 å¹¶ä¸”å°äº 300</span></span><br><span class="line"><span class="title function_">resolve</span>(response) <span class="comment">// è°ƒç”¨ resolve æ–¹æ³• å¹¶ä¼ å…¥ response å‚æ•°</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Request failed with status code <span class="subst">$&#123;response.status&#125;</span>`</span>)) <span class="comment">// è°ƒç”¨ reject æ–¹æ³• å¹¶ä¼ å…¥ Request failed with status code $&#123;response.status&#125; å‚æ•°</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›¿æ¢ä¸º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// ä¼ å…¥å¤„ç† response å‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> (response.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; response.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line"><span class="comment">// çŠ¶æ€ç  å¤§äºç­‰äº 200 å¹¶ä¸”å°äº 300</span></span><br><span class="line"><span class="title function_">resolve</span>(response) <span class="comment">// è°ƒç”¨ resolve æ–¹æ³• å¹¶ä¼ å…¥ response å‚æ•°</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">reject</span>(</span><br><span class="line"><span class="title function_">createError</span>(</span><br><span class="line"><span class="string">`Request failed with status code <span class="subst">$&#123;response.status&#125;</span>`</span>,</span><br><span class="line">config,</span><br><span class="line"><span class="literal">null</span>,</span><br><span class="line">request,</span><br><span class="line">response</span><br><span class="line">)</span><br><span class="line">) <span class="comment">// ä¼ å…¥ `Request failed with status code $&#123;response.status&#125;`,config,null,request,response å‚æ•° è°ƒç”¨ createError æ–¹æ³• å¹¶ä¼ å…¥å‚æ•°</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¥å£æ‰©å±•"><a href="#æ¥å£æ‰©å±•" class="headerlink" title="æ¥å£æ‰©å±•"></a>æ¥å£æ‰©å±•</h2><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p>ä¸ºäº†ç”¨æˆ·æ›´åŠ æ–¹ä¾¿åœ°ä½¿ç”¨ axios å‘é€è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ‰€æœ‰æ”¯æŒçš„è¯·æ±‚æ–¹æ³•æ‰©å±•ä¸€äº›æ¥å£</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//[å¯é€‰é¡¹]</span></span><br><span class="line">axios.<span class="property">request</span>(config)</span><br><span class="line">axios.<span class="property">get</span>(url[,config])</span><br><span class="line">axios.<span class="property">delete</span>(url[,config])</span><br><span class="line">axios.<span class="property">head</span>(url[,config])</span><br><span class="line">axios.<span class="property">options</span>(url[,config])</span><br><span class="line">axios.<span class="property">post</span>(url[,datal,config])</span><br><span class="line">axios.<span class="property">put</span>(url[,datal,config])</span><br><span class="line">axios.<span class="property">patch</span>(url[,datal,config])</span><br></pre></td></tr></table></figure><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line"><span class="comment">//axiosæ¥å£</span></span><br><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">get</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">delete</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">head</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">options</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">post</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: <span class="built_in">any</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">put</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: <span class="built_in">any</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">patch</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: <span class="built_in">any</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInstance</span> <span class="keyword">extends</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line"><span class="comment">//axioså®ä¾‹æ¥å£ æ—¢æœ‰å‡½æ•°ç±»å‹åˆæœ‰å±æ€§æ¥å£</span></span><br><span class="line">(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º-Axios-ts"><a href="#åˆ›å»º-Axios-ts" class="headerlink" title="åˆ›å»º Axios.ts"></a>åˆ›å»º Axios.ts</h3><blockquote><p>å­˜æ”¾ä¸€äº›å‘é€è¯·æ±‚æ ¸å¿ƒä»£ç </p></blockquote><p>core &#x2F; Axios.ts &#x2F;&#x2F;å¤§å†™è¡¨ç¤ºæ˜¯ä¸€ä¸ªç±»</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line"><span class="comment">// å®ç°requestæ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>core &#x2F; dispatchRequest.ts</p><blockquote><p>å°è£… axios.ts æ ¸å¿ƒä»£ç </p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> xhr <span class="keyword">from</span> <span class="string">&#x27;../xhr&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; bulidURL &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/url&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; processHeaders &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/header&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">dispatchRequest</span>(<span class="params"></span></span><br><span class="line"><span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line"><span class="comment">// dispatchRequest å‡½æ•°æ¥æ”¶ä¸€ä¸ª config å‚æ•°</span></span><br><span class="line"><span class="title function_">processConfig</span>(config)</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">xhr</span>(config).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//è¯·æ±‚ç»“æŸåå¯¹ response data è¿›è¡Œå¤„ç†</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">transformResponseData</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// å…ˆå¤„ç† headers</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// å†å¤„ç† data</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformURL</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† url è¿”å›æ‹¼æ¥åçš„ url</span></span><br><span class="line"><span class="keyword">const</span> &#123; url, params &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">bulidURL</span>(url, params)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformRequestData</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† data è°ƒç”¨ transformRequest æ–¹æ³•</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequest</span>(config.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformHeaders</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† headers è°ƒç”¨ processHeaders æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> &#123; headers = &#123;&#125;, data &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">processHeaders</span>(headers, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformResponseData</span>(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>): <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† response data</span></span><br><span class="line">res.<span class="property">data</span> = <span class="title function_">transformResponse</span>(res.<span class="property">data</span>)</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç„¶åå°† xhr.ts ç§»å…¥ core æ–‡ä»¶å¤¹ï¼ˆxhr ä¹Ÿä½œä¸ºæ ¸å¿ƒæ¨¡å—ï¼‰</p></blockquote><p><strong>éƒ¨åˆ†æŠ¥é”™ä¿®æ”¹</strong> (ä¸¥æ ¼æ¨¡å¼)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//dispatchRequest.ts</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">bulidURL</span>(url!, params)</span><br><span class="line"></span><br><span class="line"><span class="comment">//xht.ts</span></span><br><span class="line">request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url!, <span class="literal">true</span>) <span class="comment">// è°ƒç”¨ open æ–¹æ³•ä¼ å…¥ method url true ä¸‰ä¸ªå‚æ•° å¹¶å°† method è½¬æ¢ä¸ºå¤§å†™å¹¶èµ‹å€¼ç»™ method,url. async:trueå¼‚æ­¥</span></span><br></pre></td></tr></table></figure><blockquote><p>Tipsï¼š æ–­è¨€ï¼ˆ ! ï¼‰</p><blockquote><p>TS ä¸­ï¼Œå½“ä½ ä¿è¯æŸä¸ªå˜é‡ä¸ä¼šä¸º <code>null</code> æˆ–è€… <code>undefined</code>ï¼Œä½†ç¼–è¯‘å™¨å´æ— æ³•æ¨æ–­å‡ºæ¥çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨éç©ºæ–­è¨€æ“ä½œç¬¦ ( ! )ï¼Œä¸ä¼šåœ¨è¿è¡Œæ—¶è¿›è¡Œæ£€æŸ¥ï¼Œä½†è¦æ˜¯ä½ åšå‡ºäº†é”™è¯¯çš„ä¿è¯ï¼Œåœ¨è¿è¡Œæ—¶å°±å¯èƒ½ä¼šå‡ºç°é”™è¯¯ã€‚</p></blockquote></blockquote><h3 id="å®ç°-Axios-ç±»ä¸­æ¥å£"><a href="#å®ç°-Axios-ç±»ä¸­æ¥å£" class="headerlink" title="å®ç° Axios ç±»ä¸­æ¥å£"></a>å®ç° Axios ç±»ä¸­æ¥å£</h3><p><code>Axios.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> dispatchRequest <span class="keyword">from</span> <span class="string">&#x27;./dispatchRequest&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">  <span class="title function_">request</span>(...)</span><br><span class="line">  <span class="title function_">get</span>(...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <strong><em>request</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥configå‚æ•° å¹¶è¿”å›AxiosPromise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong><em>é€»è¾‘å°è£…</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">_requestMethodWithoutData</span>(</span><br><span class="line">    <span class="attr">method</span>: <span class="title class_">Method</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line">    <span class="comment">// å°è£…_requestMethodWithoutDataæ–¹æ³•ä¼ å…¥method,urlå’Œconfigå‚æ•° å¹¶è¿”å›AxiosPromise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="title class_">Object</span>.<span class="title function_">assign</span>(config || &#123;&#125;, &#123; method, url &#125;)) <span class="comment">// è°ƒç”¨requestæ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>å®ç° <strong><em>get</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">get</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥urlå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;get&#x27;</span>, url, config) <span class="comment">// è°ƒç”¨æ–¹æ³• ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <strong><em>delete</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">delete</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥urlå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;delete&#x27;</span>, url, config) <span class="comment">// è°ƒç”¨æ–¹æ³• ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <strong><em>head</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">head</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥urlå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;head&#x27;</span>, url, config) <span class="comment">// è°ƒç”¨æ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <strong><em>options</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">options</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥urlå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;options&#x27;</span>, url, config) <span class="comment">// è°ƒç”¨æ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong><em>é€»è¾‘å°è£…</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">_requestMethodWithData</span>(</span><br><span class="line">    <span class="attr">method</span>: <span class="title class_">Method</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">data</span>?: <span class="built_in">any</span>,</span><br><span class="line">    <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line">    <span class="comment">// å°è£…_requestMethodWithDataæ–¹æ³•ä¼ å…¥method,url,dataå’Œconfigå‚æ•° å¹¶è¿”å›AxiosPromise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="title class_">Object</span>.<span class="title function_">assign</span>(config || &#123;&#125;, &#123; method, url, data &#125;)) <span class="comment">// è°ƒç”¨requestæ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>å®ç° <strong><em>post</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">head</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥url,dataå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithData</span>(<span class="string">&#x27;post&#x27;</span>, url, data, config) <span class="comment">// è°ƒç”¨æ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <strong><em>put</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">put</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥url,dataå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithData</span>(<span class="string">&#x27;put&#x27;</span>, url, data, config) <span class="comment">// è°ƒç”¨æ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <strong><em>patch</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">patch</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥url,dataå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithData</span>(<span class="string">&#x27;patch&#x27;</span>, url, data, config) <span class="comment">// è°ƒç”¨æ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ··åˆå¯¹è±¡å®ç°"><a href="#æ··åˆå¯¹è±¡å®ç°" class="headerlink" title="æ··åˆå¯¹è±¡å®ç°"></a>æ··åˆå¯¹è±¡å®ç°</h3><blockquote><p>é¦–å…ˆè¿™ä¸ªå¯¹è±¡æ˜¯å‡½æ•°ï¼Œå…¶æ¬¡è¿™ä¸ªå¯¹è±¡åŒ…æ‹¬ Axios ç±»å†…æ‰€æœ‰åŸå‹å±æ€§å’Œå®ä¾‹å±æ€§</p></blockquote><p>helpers &#x2F; utils</p><blockquote><p><code>extend</code> åˆæˆå‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> target = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">const</span> source = &#123; <span class="attr">b</span>: <span class="number">2</span> &#125;</span><br><span class="line"><span class="keyword">const</span> result = <span class="title function_">extend</span>(target, source)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result) <span class="comment">// è¾“å‡º: &#123; a: 1, b: 2 &#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨**<em>æ³›å‹</em>** <code>T</code> å’Œ <code>U</code></p><p><code>T</code> ä»£è¡¨ç›®æ ‡å¯¹è±¡ <code>to</code> çš„ç±»å‹ï¼Œ<code>U</code> ä»£è¡¨æºå¯¹è±¡ <code>from</code> çš„ç±»å‹</p><p>å‡½æ•°çš„è¿”å›å€¼ç±»å‹æ˜¯ <code>T &amp; U</code>ï¼Œä¹Ÿå°±æ˜¯ <code>to</code> å’Œ <code>from</code> ä¸¤ä¸ªå¯¹è±¡ç±»å‹çš„äº¤é›†ã€‚</p></blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> extend&lt;T, U&gt;(<span class="attr">to</span>: T, <span class="attr">from</span>: U): T &amp; U &#123;</span><br><span class="line"><span class="comment">// åˆå¹¶å¯¹è±¡</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="keyword">from</span>) &#123;</span><br><span class="line">;(to <span class="keyword">as</span> T &amp; U)[key] = <span class="keyword">from</span>[key] <span class="keyword">as</span> <span class="built_in">any</span> <span class="comment">//æŠŠ from å¯¹è±¡çš„å±æ€§å€¼èµ‹å€¼ç»™ to å¯¹è±¡å¯¹åº”çš„å±æ€§ã€‚è¿™é‡Œè¿ç”¨äº†ç±»å‹æ–­è¨€ as T &amp; U å’Œ as anyï¼Œè®© TypeScript ç¼–è¯‘å™¨è®¤å¯è¿™ç§èµ‹å€¼æ“ä½œã€‚</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> to <span class="keyword">as</span> T &amp; U <span class="comment">//ä¹Ÿç”¨äº†ç±»å‹æ–­è¨€ as T &amp; U</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å·¥å‚å‡½æ•°å®ç°"><a href="#å·¥å‚å‡½æ•°å®ç°" class="headerlink" title="å·¥å‚å‡½æ•°å®ç°"></a>å·¥å‚å‡½æ•°å®ç°</h3><p>å¤„ç† axios.ts</p><blockquote><p>åˆ æ‰å†…å®¹ï¼Œåªä¿ç•™ export default axios</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosInstance</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Axios</span> <span class="keyword">from</span> <span class="string">&#x27;./core/Axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/util&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"></span>): <span class="title class_">AxiosInstance</span> &#123;</span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> <span class="title class_">Axios</span>() <span class="comment">//å®ä¾‹åŒ–ä¸€ä¸ª Axios å¯¹è±¡ å¹¶èµ‹å€¼ç»™ context å˜é‡</span></span><br><span class="line"><span class="keyword">const</span> instance = <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span>.<span class="title function_">bind</span>(context) <span class="comment">//è°ƒç”¨ request æ–¹æ³• å¹¶ä¼ å…¥ context å‚æ•° å¹¶èµ‹å€¼ç»™ instance å˜é‡ ç»‘å®š this æŒ‡å‘ context</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">extend</span>(instance, context) <span class="comment">//è°ƒç”¨ extend æ–¹æ³• å¹¶ä¼ å…¥ instance å’Œ context å‚æ•° å®ç° instance å¯¹è±¡ç»§æ‰¿ context å¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> instance <span class="keyword">as</span> <span class="title class_">AxiosInstance</span> <span class="comment">//è¿”å› instance å¯¹è±¡ å¹¶æ–­è¨€ä¸º AxiosInstance ç±»å‹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="title function_">createInstance</span>() <span class="comment">//è°ƒç”¨ createInstance æ–¹æ³• å¹¶èµ‹å€¼ç»™ axios å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure><h3 id="axios-å‡½æ•°é‡è½½"><a href="#axios-å‡½æ•°é‡è½½" class="headerlink" title="axios å‡½æ•°é‡è½½"></a>axios å‡½æ•°é‡è½½</h3><blockquote><p>ç›®å‰æˆ‘ä»¬å‡½æ•°åªèƒ½å­˜æ”¾ä¸€ä¸ªå¯¹è±¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">url: &#x27;/extend/post&#x27;,</span><br><span class="line">method: &#x27;post&#x27;,</span><br><span class="line">data:&#123;</span><br><span class="line">msg:&#x27;hi&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚æœ axios åŒæ—¶å«æœ‰ä¸¤ä¸ªå‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">axios(&#x27;/extend/post&#x27;,&#123;</span><br><span class="line">method: &#x27;post&#x27;,</span><br><span class="line">data:&#123;</span><br><span class="line">msg:&#x27;hi&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></blockquote><p>type &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInstance</span> <span class="keyword">extends</span> <span class="title class_">Axios</span> &#123;<span class="comment">//axioså®ä¾‹æ¥å£ æ—¢æœ‰å‡½æ•°ç±»å‹åˆæœ‰å±æ€§æ¥å£</span></span><br><span class="line">  (<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromis</span>) <span class="comment">//(configå•å‚)</span></span><br><span class="line">  (<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> <span class="comment">//æ·»åŠ ï¼šå‡½æ•°é‡è½½(url+configåŒå‚)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>core &#x2F; Axios.ts</p><blockquote><p>ä¿®æ”¹ request æ–¹æ³•</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// å®ç°requestæ–¹æ³•ä¼ å…¥configå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¹ä¸º ğŸ‘‡</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">url</span>: <span class="built_in">any</span>, <span class="attr">config</span>: <span class="built_in">any</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// å®ç°requestæ–¹æ³•ä¼ å…¥urlï¼Ÿconfigï¼Ÿå‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">&#x27;string&#x27;</span>) &#123; <span class="comment">//url+configåŒå‚</span></span><br><span class="line">        <span class="keyword">if</span> (!config) &#123;</span><br><span class="line">            config = &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        config.<span class="property">url</span> = url</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//configå•å‚</span></span><br><span class="line">        config = url <span class="comment">//æ­¤æ—¶çš„urlå°±æ˜¯config</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å“åº”æ•°æ®æ”¯æŒæ³›å‹"><a href="#å“åº”æ•°æ®æ”¯æŒæ³›å‹" class="headerlink" title="å“åº”æ•°æ®æ”¯æŒæ³›å‹"></a>å“åº”æ•°æ®æ”¯æŒæ³›å‹</h3><blockquote><p>é€šå¸¸æƒ…å†µï¼Œæˆ‘ä»¬ä¼šå°†åç«¯è¿”å›æ•°æ®æ ¼å¼å•ç‹¬æ”¾å…¥ä¸€ä¸ªæ¥å£ä¸­</p></blockquote><p>è®¾ç½®æ³›å‹ï¼Œæé«˜ç±»å‹çµæ´»æ€§</p><p>type &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosResponse</span>&lt;T = <span class="built_in">any</span>&gt; &#123; <span class="comment">//responseæ¥å£</span></span><br><span class="line">    <span class="attr">data</span>: T</span><br><span class="line">    <span class="attr">status</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">statusText</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">headers</span>: <span class="built_in">any</span></span><br><span class="line">    <span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">    <span class="attr">request</span>: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosPromise</span>&lt;T = <span class="built_in">any</span>&gt; <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;<span class="title class_">AxiosResponse</span>&lt;T&gt;&gt; &#123; <span class="comment">//promiseæ¥å£</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Axios</span> &#123; <span class="comment">//axiosæ¥å£</span></span><br><span class="line">    request&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt;</span><br><span class="line">    get&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInstance</span> <span class="keyword">extends</span> <span class="title class_">Axios</span> &#123; <span class="comment">//axioså®ä¾‹æ¥å£ æ—¢æœ‰å‡½æ•°ç±»å‹åˆæœ‰å±æ€§æ¥å£</span></span><br><span class="line">&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt;</span><br><span class="line">&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt; <span class="comment">//å‡½æ•°é‡è½½</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‹¦æˆªå™¨å®ç°"><a href="#æ‹¦æˆªå™¨å®ç°" class="headerlink" title="æ‹¦æˆªå™¨å®ç°"></a>æ‹¦æˆªå™¨å®ç°</h2><blockquote><p>ä¹Ÿå°±æ˜¯ axios äºŒæ¬¡å°è£…ä¸­å¸¸è§çš„è¯·æ±‚æ‹¦æˆªå™¨ &amp; å“åº”æ‹¦æˆªå™¨</p><p>æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ç”¨æˆ· asios æ‹¦æˆªå™¨æ˜¯æ€ä¹ˆå†™çš„</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>:<span class="string">&#x27;/api</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">instance.interceptors.request.use(res =&gt;&#123;//è¯·æ±‚æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="string">    console.log(&#x27;</span>res<span class="string">&#x27;,res)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">instance.interceptors.response.use(res =&gt;&#123;//å“åº”æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="string">    console.log(&#x27;</span>res<span class="string">&#x27;,res)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default instance</span></span><br></pre></td></tr></table></figure><p>Tipï¼šrequest æ˜¯åæ·»åŠ çš„å…ˆæ‰§è¡Œï¼Œresponse æ˜¯å…ˆæ·»åŠ çš„å…ˆæ‰§è¡Œ</p></blockquote><h3 id="æ‹¦æˆªå™¨ç®¡ç†ç±»"><a href="#æ‹¦æˆªå™¨ç®¡ç†ç±»" class="headerlink" title="æ‹¦æˆªå™¨ç®¡ç†ç±»"></a>æ‹¦æˆªå™¨ç®¡ç†ç±»</h3><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInterceptorManager</span>&lt;T&gt; &#123;</span><br><span class="line"><span class="comment">//æ‹¦æˆªå™¨æ¥å£</span></span><br><span class="line"><span class="title function_">use</span>(<span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt;, <span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span>): <span class="built_in">number</span> <span class="comment">//æ·»åŠ æ‹¦æˆªå™¨ è¿”å›æ‹¦æˆªå™¨id</span></span><br><span class="line"><span class="title function_">eject</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">void</span> <span class="comment">//åˆ é™¤æ‹¦æˆªå™¨ è¿”å›æ‹¦æˆªå™¨id</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ResolvedFn</span>&lt;T = <span class="built_in">any</span>&gt; &#123;</span><br><span class="line"><span class="comment">//æˆåŠŸæ‹¦æˆªå™¨æ¥å£</span></span><br><span class="line">(<span class="attr">val</span>: T): T | <span class="title class_">Promise</span>&lt;T&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">RejectedFn</span> &#123;</span><br><span class="line"><span class="comment">//å¤±è´¥æ‹¦æˆªå™¨æ¥å£</span></span><br><span class="line">(<span class="attr">error</span>: <span class="built_in">any</span>): <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>core &#x2F; interceptorManager.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ResolvedFn</span>, <span class="title class_">RejectedFn</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Interceptor</span>&lt;T&gt; &#123;</span><br><span class="line"><span class="comment">// æ‹¦æˆªå™¨æ¥å£</span></span><br><span class="line"><span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt;</span><br><span class="line"><span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">InterceptorManager</span>&lt;T&gt; &#123;</span><br><span class="line"><span class="comment">// æ‹¦æˆªå™¨ç®¡ç†ç±»</span></span><br><span class="line"><span class="keyword">private</span> <span class="attr">interceptors</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Interceptor</span>&lt;T&gt;&gt; <span class="comment">// æ‹¦æˆªå™¨æ•°ç»„å­˜æ”¾çš„æ˜¯æ‹¦æˆªå™¨å¯¹è±¡ æ¯ä¸ªå¯¹è±¡æœ‰ä¸¤ä¸ªå±æ€§ resolved rejected</span></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// æ„é€ å‡½æ•° åˆå§‹åŒ–æ‹¦æˆªå™¨æ•°ç»„</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">interceptors</span> = [] <span class="comment">// æ‹¦æˆªå™¨æ•°ç»„ä¸­å­˜æ”¾çš„æ˜¯æ‹¦æˆªå™¨å¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">use</span>(<span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt;, <span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span>): <span class="built_in">number</span> &#123;</span><br><span class="line"><span class="comment">// æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line"><span class="comment">// å°†æ‹¦æˆªå™¨å¯¹è±¡æ·»åŠ åˆ°æ‹¦æˆªå™¨æ•°ç»„ä¸­</span></span><br><span class="line">resolved,</span><br><span class="line">rejected,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">length</span> - <span class="number">1</span> <span class="comment">// è¿”å›æ‹¦æˆªå™¨çš„id ç”¨äºåˆ é™¤æ‹¦æˆªå™¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">forEach</span>(<span class="attr">fn</span>: <span class="function">(<span class="params"><span class="attr">interceptor</span>: <span class="title class_">Interceptor</span>&lt;T&gt;</span>) =&gt;</span> <span class="built_in">void</span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// éå†æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">interceptor</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// éå†æ‹¦æˆªå™¨æ•°ç»„</span></span><br><span class="line"><span class="keyword">if</span> (interceptor !== <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">// åˆ¤æ–­æ‹¦æˆªå™¨æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="title function_">fn</span>(interceptor) <span class="comment">// å­˜åœ¨åˆ™è°ƒç”¨fnå‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">eject</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// åˆ é™¤æ‹¦æˆªå™¨ é€šè¿‡idåˆ é™¤æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">interceptors</span>[id]) &#123;</span><br><span class="line"><span class="comment">// åˆ¤æ–­æ‹¦æˆªå™¨æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">interceptors</span>[id] = <span class="literal">null</span> <span class="comment">// å­˜åœ¨åˆ™å°†æ‹¦æˆªå™¨ç½®ä¸ºnull</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é“¾å¼è°ƒç”¨å®ç°"><a href="#é“¾å¼è°ƒç”¨å®ç°" class="headerlink" title="é“¾å¼è°ƒç”¨å®ç°"></a>é“¾å¼è°ƒç”¨å®ç°</h3><p>core &#x2F; Axios.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>,<span class="title class_">AxiosResponse</span>, <span class="title class_">Method</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">InterceptorManager</span> <span class="keyword">from</span> <span class="string">&#x27;./interceptorManager&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Interceptors</span> &#123;</span><br><span class="line">    <span class="attr">request</span>: <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;</span><br><span class="line">    <span class="attr">response</span>: <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">    <span class="attr">interceptors</span>: <span class="title class_">Interceptors</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">interceptors</span> = &#123; <span class="comment">//ç”¨æˆ·å¯ä»¥é€šè¿‡axios.interceptors.request.use()æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line">            <span class="attr">request</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;(),</span><br><span class="line">            <span class="attr">response</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">request</span>(...)...</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œå–„ request (å®ç°è°ƒç”¨é“¾)</p><blockquote><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250218152615640.png" alt="image-20250218152615640"></p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>, <span class="title class_">AxiosResponse</span>, <span class="title class_">Method</span>,<span class="title class_">ResolvedFn</span>,<span class="title class_">RejectedFn</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PromiseChain</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt; | (<span class="function">(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>) =&gt;</span> <span class="title class_">AxiosPromise</span>)<span class="comment">//resolvedæ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ æ¥æ”¶ä¸€ä¸ªAxiosRequestConfigç±»å‹çš„å‚æ•° è¿”å›ä¸€ä¸ªAxiosPromiseç±»å‹çš„å‚æ•°</span></span><br><span class="line">    <span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span> <span class="comment">//rejectedæ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ æ¥æ”¶ä¸€ä¸ªAxiosRequestConfigç±»å‹çš„å‚æ•° è¿”å›ä¸€ä¸ªAxiosPromiseç±»å‹çš„å‚æ•°</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="title function_">request</span>(<span class="attr">url</span>: <span class="built_in">any</span>, <span class="attr">config</span>: <span class="built_in">any</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// å®ç°requestæ–¹æ³•ä¼ å…¥å‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!config) &#123;</span><br><span class="line">            config = &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        config.<span class="property">url</span> = url</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        config = url</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">chain</span>:<span class="title class_">PromiseChain</span>&lt;<span class="built_in">any</span>&gt;[] = [</span><br><span class="line">        &#123;<span class="comment">// åˆ›å»ºä¸€ä¸ªæ•°ç»„chain</span></span><br><span class="line">            <span class="attr">resolved</span>: dispatchRequest,</span><br><span class="line">            <span class="attr">rejected</span>: <span class="literal">undefined</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">interceptor</span> =&gt;</span> &#123;<span class="comment">// éå†requestæ‹¦æˆªå™¨</span></span><br><span class="line">        chain.<span class="title function_">unshift</span>(interceptor) <span class="comment">// å°†æ‹¦æˆªå™¨æ·»åŠ åˆ°chainæ•°ç»„çš„å¼€å¤´</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">interceptor</span> =&gt;</span> &#123;<span class="comment">// éå†responseæ‹¦æˆªå™¨</span></span><br><span class="line">        chain.<span class="title function_">push</span>(interceptor) <span class="comment">// å°†æ‹¦æˆªå™¨æ·»åŠ åˆ°chainæ•°ç»„çš„æœ«å°¾</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(config) <span class="comment">// åˆ›å»ºä¸€ä¸ªpromiseå¯¹è±¡ å¹¶ä¼ å…¥configå‚æ•°</span></span><br><span class="line">    <span class="keyword">while</span> (chain.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// éå†chainæ•°ç»„</span></span><br><span class="line">        <span class="keyword">const</span> &#123; resolved, rejected &#125; = chain.<span class="title function_">shift</span>()! <span class="comment">// å–å‡ºchainæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">              promise = promise.<span class="title function_">then</span>(resolved, rejected) <span class="comment">// å°†promiseå¯¹è±¡çš„thenæ–¹æ³•ä¼ å…¥resolvedå’Œrejectedå‚æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆå¹¶ç”¨æˆ·é…ç½®"><a href="#åˆå¹¶ç”¨æˆ·é…ç½®" class="headerlink" title="åˆå¹¶ç”¨æˆ·é…ç½®"></a>åˆå¹¶ç”¨æˆ·é…ç½®</h2><blockquote><p>ç”¨æˆ·åœ¨å‘é€è¯·æ±‚æ—¶å¯ä»¥ä¼ å…¥ä¸€ä¸ªé…ç½®æ¥å†³å®šè¯·æ±‚çš„ä¸åŒè¡Œä¸º</p><p>ç”šè‡³å¯ä»¥ç›´æ¥ä¿®æ”¹ä¸€äº›é»˜è®¤é…ç½® (defaults)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">axios.<span class="property">defaults</span>.<span class="property">headers</span>.<span class="property">common</span>[<span class="string">&#x27;test&#x27;</span>] = <span class="number">123</span> <span class="comment">//é»˜è®¤å¯¹ä»»ä½•ç±»å‹çš„è¯·æ±‚çš„headeréƒ½æ·»åŠ testå±æ€§</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">headers</span>.<span class="property">post</span>[<span class="string">&#x27;Content-Type&#x27;</span>] =</span><br><span class="line"><span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span> <span class="comment">//é»˜è®¤å¯¹postè¯·æ±‚çš„headeréƒ½æ·»åŠ Content-Typeå±æ€§</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">timeout</span> = <span class="number">2000</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="é»˜è®¤é…ç½®è®¾ç½®"><a href="#é»˜è®¤é…ç½®è®¾ç½®" class="headerlink" title="é»˜è®¤é…ç½®è®¾ç½®"></a>é»˜è®¤é…ç½®è®¾ç½®</h3><p>defaults.ts é…ç½®é»˜è®¤è¯·æ±‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span> = &#123;</span><br><span class="line"><span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"><span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line"><span class="attr">timeout</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="attr">common</span>: &#123;</span><br><span class="line"><span class="title class_">Accept</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>, <span class="comment">//é€šç”¨çš„è¯·æ±‚å¤´ æ¥å—çš„å“åº”ç±»å‹ä¸ºjson/plainæ–‡æœ¬*/*è¡¨ç¤ºä»»æ„ç±»å‹ ä¼˜å…ˆçº§æœ€ä½</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> methodsNoData = [<span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;head&#x27;</span>, <span class="string">&#x27;options&#x27;</span>]</span><br><span class="line"></span><br><span class="line">methodsNoData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">method</span>) =&gt;</span> &#123;</span><br><span class="line">defaults.<span class="property">headers</span>[method] = &#123;&#125; <span class="comment">//æ²¡æœ‰æ•°æ®çš„è¯·æ±‚å¤´ ä¼˜å…ˆçº§é«˜äºé€šç”¨çš„è¯·æ±‚å¤´</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> methodsWithData = [<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;put&#x27;</span>, <span class="string">&#x27;patch&#x27;</span>]</span><br><span class="line"></span><br><span class="line">methodsWithData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">method</span>) =&gt;</span> &#123;</span><br><span class="line">defaults.<span class="property">headers</span>[method] = &#123;</span><br><span class="line"><span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>, <span class="comment">//è¡¨å•æäº¤çš„è¯·æ±‚å¤´ ä¼˜å…ˆçº§é«˜äºé€šç”¨çš„è¯·æ±‚å¤´</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defaults</span><br></pre></td></tr></table></figure><p>core &#x2F; Axios.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">    <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">    <span class="attr">interceptors</span>: <span class="title class_">Interceptors</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">initConfig</span>?: <span class="title class_">AxiosRequestConfig</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">defaults</span> = initConfig <span class="comment">// åˆå§‹åŒ–defaultså±æ€§</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">interceptors</span> = &#123;</span><br><span class="line">            <span class="comment">//ç”¨æˆ·å¯ä»¥é€šè¿‡axios.interceptors.request.use()æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line">            <span class="attr">request</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;(),</span><br><span class="line">            <span class="attr">response</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">    <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span> <span class="comment">//é»˜è®¤é…ç½®</span></span><br><span class="line">    <span class="attr">interceptors</span>: &#123; <span class="comment">//æ‹¦æˆªå™¨</span></span><br><span class="line">        <span class="attr">request</span>: <span class="title class_">AxiosInterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;</span><br><span class="line">        <span class="attr">response</span>: <span class="title class_">AxiosInterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å†™ axios.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosInstance</span>, <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Axios</span> <span class="keyword">from</span> <span class="string">&#x27;./core/Axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/util&#x27;</span></span><br><span class="line"><span class="keyword">import</span> defaults <span class="keyword">from</span> <span class="string">&#x27;./defaults&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosInstance</span> &#123;</span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> <span class="title class_">Axios</span>(config) <span class="comment">//åˆ›å»ºä¸€ä¸ª Axios å®ä¾‹ å¹¶ä¼ å…¥ config å‚æ•° å¹¶èµ‹å€¼ç»™ context å˜é‡</span></span><br><span class="line"><span class="keyword">const</span> instance = <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span>.<span class="title function_">bind</span>(context) <span class="comment">//è°ƒç”¨ request æ–¹æ³• å¹¶ä¼ å…¥ context å‚æ•° å¹¶èµ‹å€¼ç»™ instance å˜é‡ ç»‘å®š this æŒ‡å‘ context</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">extend</span>(instance, context) <span class="comment">//è°ƒç”¨ extend æ–¹æ³• å¹¶ä¼ å…¥ instance å’Œ context å‚æ•° å®ç° instance å¯¹è±¡ç»§æ‰¿ context å¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> instance <span class="keyword">as</span> <span class="title class_">AxiosInstance</span> <span class="comment">//è¿”å› instance å¯¹è±¡ å¹¶æ–­è¨€ä¸º AxiosInstance ç±»å‹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="title function_">createInstance</span>(defaults) <span class="comment">//è°ƒç”¨ createInstance æ–¹æ³• å¹¶ä¼ å…¥ defaults å‚æ•° å¹¶èµ‹å€¼ç»™ axios å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure><h3 id="åˆå¹¶ç­–ç•¥å®ç°"><a href="#åˆå¹¶ç­–ç•¥å®ç°" class="headerlink" title="åˆå¹¶ç­–ç•¥å®ç°"></a>åˆå¹¶ç­–ç•¥å®ç°</h3><p>åˆ›å»º core &#x2F; mergeConfig.ts</p><blockquote><p><code>config1</code> ä¸ºé»˜è®¤é…ç½®</p><p><code>config2</code> ä»£è¡¨ç”¨æˆ·ä¼ å…¥çš„è‡ªå®šä¹‰é…ç½®</p><blockquote><p>å®ç°ç¤ºä¾‹ (å‡è®¾ <code>config1</code> å’Œ <code>config2</code> å¦‚ä¸‹ï¼š)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config1 = &#123;</span><br><span class="line"><span class="attr">timeout</span>: <span class="number">1000</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config2 = &#123;</span><br><span class="line"><span class="attr">timeout</span>: <span class="number">2000</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="title class_">Authorization</span>: <span class="string">&#x27;Bearer token&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå¹¶ <code>timeout</code> å±æ€§æ—¶ï¼Œ<code>val1</code> å°±æ˜¯ <code>config1.timeout</code> çš„å€¼ <code>1000</code>ï¼Œ<code>val2</code> å°±æ˜¯ <code>config2.timeout</code> çš„å€¼ <code>2000</code>ã€‚</p></blockquote></blockquote><h4 id="timeout-é€»è¾‘"><a href="#timeout-é€»è¾‘" class="headerlink" title="timeout é€»è¾‘"></a>timeout é€»è¾‘</h4><p>mergeConfig.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> strats = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>) <span class="comment">//åˆå¹¶ç­–ç•¥ keyä¸ºå±æ€§å valueä¸ºåˆå¹¶ç­–ç•¥å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defaultStrat</span>(<span class="params"><span class="attr">val1</span>: <span class="built_in">any</span>, <span class="attr">val2</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">//é»˜è®¤åˆå¹¶ç­–ç•¥</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">typeof</span> val2 !== <span class="string">&#x27;undefined&#x27;</span> ? val2 : val1 <span class="comment">//ä¼˜å…ˆå–val2 å¦‚æœval2ä¸å­˜åœ¨åˆ™å–val1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fromVal2Strat</span>(<span class="params"><span class="attr">val1</span>: <span class="built_in">any</span>, <span class="attr">val2</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> val2 !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">//å¿½ç•¥val1 åªå–val2</span></span><br><span class="line"><span class="keyword">return</span> val2</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stratKeysFromVal2 = [<span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;params&#x27;</span>, <span class="string">&#x27;data&#x27;</span>]</span><br><span class="line"></span><br><span class="line">stratKeysFromVal2.<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//å¯¹äºurl params dataå±æ€§ åªå–val2</span></span><br><span class="line">strats[key] = fromVal2Strat</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">mergeConfig</span>(<span class="params"></span></span><br><span class="line"><span class="params"><span class="attr">config1</span>: <span class="title class_">AxiosRequestConfig</span>,</span></span><br><span class="line"><span class="params"><span class="attr">config2</span>?: <span class="title class_">AxiosRequestConfig</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!config2) &#123;</span><br><span class="line">config2 = &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> config = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>) <span class="comment">//åˆå¹¶åçš„é…ç½®ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> config2) &#123;</span><br><span class="line"><span class="title function_">mergeField</span>(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> config1) &#123;</span><br><span class="line"><span class="keyword">if</span> (!config2[key]) &#123;</span><br><span class="line"><span class="title function_">mergeField</span>(key)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mergeField</span>(<span class="params"><span class="attr">key</span>: <span class="built_in">string</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="keyword">const</span> strat = strats[key] || defaultStrat <span class="comment">//åˆå¹¶ç­–ç•¥</span></span><br><span class="line">config[key] = <span class="title function_">strat</span>(config1[key], config2![key])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>types &#x2F; index.ts æ·»åŠ è‡ªåŠ¨ç´¢å¼•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    [<span class="attr">propName</span>: <span class="built_in">string</span>]: <span class="built_in">any</span> <span class="comment">//å­—ç¬¦ä¸²è‡ªåŠ¨ç´¢å¼•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="headers-é€»è¾‘"><a href="#headers-é€»è¾‘" class="headerlink" title="headers é€»è¾‘"></a>headers é€»è¾‘</h4><h5 id="åˆå¹¶"><a href="#åˆå¹¶" class="headerlink" title="åˆå¹¶"></a>åˆå¹¶</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepMergeStrat</span>(<span class="params"><span class="attr">val1</span>: <span class="built_in">any</span>, <span class="attr">val2</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(val2)) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœval2æ˜¯å¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">deepMerge</span>(val1, val2) <span class="comment">//é€’å½’åˆå¹¶</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> val2 !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœval2ä¸æ˜¯å¯¹è±¡ ä¸”val2å­˜åœ¨</span></span><br><span class="line"><span class="keyword">return</span> val2</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(val1)) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœval2ä¸æ˜¯å¯¹è±¡ ä¸”val2ä¸å­˜åœ¨ ä¸”val1æ˜¯å¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">deepMerge</span>(val1) <span class="comment">//é€’å½’åˆå¹¶</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> val1 !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœval2ä¸æ˜¯å¯¹è±¡ ä¸”val2ä¸å­˜åœ¨ ä¸”val1ä¸æ˜¯å¯¹è±¡ ä¸”val1å­˜åœ¨</span></span><br><span class="line"><span class="keyword">return</span> val1</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>deepMerge å·¥å…·å‡½æ•°å®ç°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deepMerge</span>(<span class="params">...<span class="attr">objs</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// æ·±åº¦åˆå¹¶å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">objs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (obj) &#123;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> val = obj[key]</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(val)) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(result[key])) &#123;</span><br><span class="line">result[key] = <span class="title function_">deepMerge</span>(result[key], val)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">result[key] = <span class="title function_">deepMerge</span>(val)</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">result[key] = val</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¯·æ±‚ä¸­åº”ç”¨å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">url</span>: <span class="built_in">any</span>, <span class="attr">config</span>: <span class="built_in">any</span>): <span class="title class_">AxiosPromise</span> &#123; <span class="comment">// å®ç°requestæ–¹æ³•ä¼ å…¥å‚æ•°</span></span><br><span class="line">    ã€‚ã€‚ã€‚</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!config) &#123;</span><br><span class="line">            config = &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        config.<span class="property">url</span> = url</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        config = url</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘é€è¯·æ±‚ä¹‹å‰åº”ç”¨</span></span><br><span class="line">    config = <span class="variable language_">this</span>.<span class="title function_">mergeConfig</span>(<span class="variable language_">this</span>.<span class="property">defaults</span>,config) <span class="comment">// åˆå¹¶config</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">chain</span>:<span class="title class_">PromiseChain</span>&lt;<span class="built_in">any</span>&gt;[] = [</span><br><span class="line">        &#123;<span class="comment">// åˆ›å»ºä¸€ä¸ªæ•°ç»„chain</span></span><br><span class="line">            <span class="attr">resolved</span>: dispatchRequest,</span><br><span class="line">            <span class="attr">rejected</span>: <span class="literal">undefined</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    ã€‚ã€‚ã€‚</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å‹ç¼©"><a href="#å‹ç¼©" class="headerlink" title="å‹ç¼©"></a>å‹ç¼©</h5><blockquote><p>åˆå¹¶åçš„ headers æ˜¯ä¸€ä¸ªå¤æ‚å¯¹è±¡ï¼Œå¤šäº† commonã€postã€get ç­‰å±æ€§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">headers:&#123;</span><br><span class="line">    common:&#123;</span><br><span class="line">    Accept:&#x27;application/json,text/plain,*/*&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    post: &#123;</span><br><span class="line">    &#x27;Content-Type&#x27;:&#x27;application/x-www-form-urlencoded&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦å‹ç¼©æˆä¸€çº§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">headers:&#123;</span><br><span class="line">Accept:&#x27;application/json,text/plain,*/*&#x27;,</span><br><span class="line">&#x27;Content-Type&#x27;:&#x27;application/x-www-form-urlencoded&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Tipï¼šå¯¹äº comman ä¸­å®šä¹‰çš„ header å­—æ®µï¼Œæˆ‘ä»¬éƒ½è¦æå–ï¼Œè€Œå¯¹äº postã€get è¿™ç±»æå–ï¼Œéœ€è¦å’Œè¯¥æ¬¡è¯·æ±‚çš„æ–¹æ³•å¯¹åº”ã€‚</p></blockquote><p>headers.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">flattenHeaders</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>, <span class="attr">method</span>: <span class="title class_">Method</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// flattenHeaders å‡½æ•°æ¥æ”¶ headers å’Œ method å‚æ•° å°† headers ä¸­çš„å±æ€§åè§„èŒƒåŒ– å¹¶åˆ é™¤ä¸å¿…è¦çš„å±æ€§ å¹¶è¿”å›ä¸€ä¸ªæ–°çš„ headers å¯¹è±¡</span></span><br><span class="line"><span class="keyword">if</span> (!headers) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ headers ä¸å­˜åœ¨</span></span><br><span class="line"><span class="keyword">return</span> headers <span class="comment">// è¿”å› headers</span></span><br><span class="line">&#125;</span><br><span class="line">headers = <span class="title function_">deepMerge</span>(headers, <span class="literal">null</span>) <span class="comment">// è°ƒç”¨ deepMerge å‡½æ•°å°† headers æ·±åº¦åˆå¹¶</span></span><br><span class="line"><span class="keyword">const</span> methodsToDelete = [</span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªæ•°ç»„ methodsToDelete å­˜å‚¨éœ€è¦åˆ é™¤çš„ headers å±æ€§å</span></span><br><span class="line"><span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;get&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;head&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;options&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;post&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;put&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;patch&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;common&#x27;</span>,</span><br><span class="line">]</span><br><span class="line">methodsToDelete.<span class="title function_">forEach</span>(<span class="function">(<span class="params">method</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// éå† methodsToDelete æ•°ç»„</span></span><br><span class="line"><span class="keyword">delete</span> headers[method] <span class="comment">// åˆ é™¤ headers çš„å±æ€§å</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> headers <span class="comment">// è¿”å› headers</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>dispatchRequest.ts åº”ç”¨å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// å…ˆå¤„ç† headers</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// å†å¤„ç† data</span></span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">flattenHeaders</span>(config.<span class="property">headers</span>, config.<span class="property">method</span>!) <span class="comment">//å¤„ç† headers æ‰å¹³åŒ–</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ›´å¤šé…ç½®"><a href="#æ›´å¤šé…ç½®" class="headerlink" title="æ›´å¤šé…ç½®"></a>æ›´å¤šé…ç½®</h3><h4 id="transfromRequest-transfromResponse"><a href="#transfromRequest-transfromResponse" class="headerlink" title="transfromRequest &amp; transfromResponse"></a>transfromRequest &amp; transfromResponse</h4><blockquote><p>å®˜æ–¹ axios ä¸­æä¾›<code>transfromRequest</code>&amp;<code>transfromResponse</code>ï¼Œå€¼ä¸º**<em>ä¸€ä¸ªæ•°ç»„æˆ–ä¸€ä¸ªå‡½æ•°</em>**</p><p>è¿™ä¸¤ä¸ªå±æ€§å…è®¸ç”¨æˆ·åœ¨ <strong>æ•°æ®å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰</strong>(åªé€‚ç”¨äº putã€postã€patchï¼Œè€Œä¸”å¯ä»¥ä¿®æ”¹ headers å¯¹è±¡) &#x2F; <strong>æŠŠå“åº”æ•°æ®ä¼ é€’ç»™ then æˆ– catch ä¹‹å‰</strong> å¯¹å…¶ä¿®æ”¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">    transformRequest: [</span><br><span class="line">        (function(data) &#123;</span><br><span class="line">            return qs.stringify(data); // è‡ªå®šä¹‰çš„ transformRequest</span><br><span class="line">        &#125;),</span><br><span class="line">        ...axios.defaults.transformRequest // ä¿ç•™é»˜è®¤çš„ transformRequest</span><br><span class="line">    ],</span><br><span class="line">    transformResponse: [</span><br><span class="line">        ...axios.defaults.transformResponse, // å±•å¼€é»˜è®¤çš„ transformResponse</span><br><span class="line">        function(data) &#123;</span><br><span class="line">            if (typeof data === &#x27;object&#x27;) &#123; // è‡ªå®šä¹‰çš„ transformResponse</span><br><span class="line">                data.b = 2; // ä¿®æ”¹å“åº”æ•°æ®</span><br><span class="line">            &#125;</span><br><span class="line">            return data;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    url: &#x27;/config/post&#x27;, // è¯·æ±‚çš„ URL</span><br><span class="line">    method: &#x27;post&#x27;, // è¯·æ±‚æ–¹æ³•</span><br><span class="line">    data: &#123;</span><br><span class="line">        a: 1 // è¯·æ±‚çš„æ•°æ®</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote><h5 id="å®šä¹‰æ¥å£"><a href="#å®šä¹‰æ¥å£" class="headerlink" title="å®šä¹‰æ¥å£"></a>å®šä¹‰æ¥å£</h5><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="comment">//configæ¥å£</span></span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line"><span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">responseType</span>?: <span class="title class_">XMLHttpRequestResponseType</span></span><br><span class="line"><span class="attr">timeout</span>?: <span class="built_in">number</span></span><br><span class="line"><span class="attr">transformRequest</span>?: <span class="title class_">AxiosTransformer</span> | <span class="title class_">AxiosTransformer</span>[] <span class="comment">//è¯·æ±‚æ•°æ®è½¬æ¢å‡½æ•°</span></span><br><span class="line"><span class="attr">transformResponse</span>?: <span class="title class_">AxiosTransformer</span> | <span class="title class_">AxiosTransformer</span>[] <span class="comment">//å“åº”æ•°æ®è½¬æ¢å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">[<span class="attr">propName</span>: <span class="built_in">string</span>]: <span class="built_in">any</span> <span class="comment">//å­—ç¬¦ä¸²è‡ªåŠ¨ç´¢å¼•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosTransformer</span> &#123;</span><br><span class="line"><span class="comment">//è½¬æ¢æ¥å£</span></span><br><span class="line">(<span class="attr">data</span>: <span class="built_in">any</span>, <span class="attr">headers</span>?: <span class="built_in">any</span>): <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>defaults.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; processHeaders &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/header&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span> = &#123;</span><br><span class="line"><span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"><span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line"><span class="attr">timeout</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="attr">common</span>: &#123;</span><br><span class="line"><span class="title class_">Accept</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>, <span class="comment">//é€šç”¨çš„è¯·æ±‚å¤´ æ¥å—çš„å“åº”ç±»å‹ä¸ºjson/plainæ–‡æœ¬*/*è¡¨ç¤ºä»»æ„ç±»å‹ ä¼˜å…ˆçº§æœ€ä½</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="attr">transformRequest</span>: [</span><br><span class="line"><span class="keyword">function</span> (<span class="params"><span class="attr">data</span>: <span class="built_in">any</span>, <span class="attr">headers</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="title function_">processHeaders</span>(headers, data) <span class="comment">//å¤„ç†è¯·æ±‚å¤´</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">transformRequest</span>(data) <span class="comment">//å¤„ç†è¯·æ±‚æ•°æ®</span></span><br><span class="line">&#125;,</span><br><span class="line">],</span><br><span class="line"><span class="attr">transformResponse</span>: [</span><br><span class="line"><span class="keyword">function</span> (<span class="params"><span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">transformResponse</span>(data) <span class="comment">//å¤„ç†å“åº”æ•°æ®</span></span><br><span class="line">&#125;,</span><br><span class="line">],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é‡æ„-transform-é€»è¾‘"><a href="#é‡æ„-transform-é€»è¾‘" class="headerlink" title="é‡æ„ transform é€»è¾‘"></a>é‡æ„ transform é€»è¾‘</h5><p>core &#x2F; transform.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosTransformer</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">transform</span>(<span class="params"> <span class="comment">//transformå‡½æ•°æ¥æ”¶data headers fnsä¸‰ä¸ªå‚æ•°</span></span></span><br><span class="line"><span class="params"><span class="attr">data</span>: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params"><span class="attr">fns</span>?: <span class="title class_">AxiosTransformer</span> | <span class="title class_">AxiosTransformer</span>[]</span></span><br><span class="line"><span class="params"></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!fns) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰ä¼ å…¥fns ç›´æ¥è¿”å›data</span></span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(fns)) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœfnsä¸æ˜¯æ•°ç»„ å°†å…¶è½¬ä¸ºæ•°ç»„</span></span><br><span class="line">fns = [fns]</span><br><span class="line">&#125;</span><br><span class="line">fns.<span class="title function_">forEach</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//éå†fnsæ•°ç»„ ä¾æ¬¡è°ƒç”¨fnå‡½æ•°</span></span><br><span class="line">data = <span class="title function_">fn</span>(data, headers)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>core &#x2F; dispatchRequest.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> transform <span class="keyword">from</span> <span class="string">&#x27;./transform&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// å…ˆå¤„ç† headers</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// å†å¤„ç† data</span></span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">flattenHeaders</span>(config.<span class="property">headers</span>, config.<span class="property">method</span>!) <span class="comment">//å¤„ç† headers æ‰å¹³åŒ–</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´æ”¹ä¸º ğŸ‘‡</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transform</span>(config.<span class="property">data</span>, config.<span class="property">headers</span>, config.<span class="property">transformRequest</span>) <span class="comment">//å¤„ç† data</span></span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">flattenHeaders</span>(config.<span class="property">headers</span>, config.<span class="property">method</span>!) <span class="comment">//å¤„ç† headers æ‰å¹³åŒ–</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ æ‰ä¸ç”¨çš„ä¸œè¥¿</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformRequestData</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† data è°ƒç”¨ transformRequest æ–¹æ³•</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequest</span>(config.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformHeaders</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† headers è°ƒç”¨ processHeaders æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> &#123; headers = &#123;&#125;, data &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">processHeaders</span>(headers, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´æ”¹é€»è¾‘</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">transformResponseData</span>(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>): <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† response data</span></span><br><span class="line">res.<span class="property">data</span> = <span class="title function_">transform</span>(res.<span class="property">data</span>, res.<span class="property">headers</span>, res.<span class="property">config</span>.<span class="property">transformResponse</span>)</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="create"><a href="#create" class="headerlink" title="create"></a>create</h4><blockquote><p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ axios éƒ½æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œä¸€æ—¦æˆ‘ä»¬ä¿®æ”¹äº† axios çš„é»˜è®¤é…ç½®ï¼Œä¼šå½±å“æ‰€æœ‰çš„è¯·æ±‚ã€‚æˆ‘ä»¬å¸Œæœ›æä¾›äº†ä¸€ä¸ª<code>axios.create</code>çš„é™æ€æ¥å£å…è®¸æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ axios å®ä¾‹ï¼ŒåŒæ—¶å…è®¸æˆ‘ä»¬ä¼ å…¥æ–°çš„é…ç½®å’Œé»˜è®¤é…ç½®åˆå¹¶ï¼Œå¹¶åšä¸ºæ–°çš„é»˜è®¤é…ç½®ã€‚</p></blockquote><h5 id="æ‰©å±•æ–°çš„æ¥å£"><a href="#æ‰©å±•æ–°çš„æ¥å£" class="headerlink" title="æ‰©å±•æ–°çš„æ¥å£"></a>æ‰©å±•æ–°çš„æ¥å£</h5><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosStatic</span> <span class="keyword">extends</span> <span class="title class_">AxiosInstance</span> &#123;</span><br><span class="line"><span class="comment">//axiosé™æ€æ¥å£</span></span><br><span class="line"><span class="title function_">create</span>(<span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosInstance</span> <span class="comment">//åˆ›å»ºaxioså®ä¾‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>axios.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosStatic</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Axios</span> <span class="keyword">from</span> <span class="string">&#x27;./core/Axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/util&#x27;</span></span><br><span class="line"><span class="keyword">import</span> defaults <span class="keyword">from</span> <span class="string">&#x27;./defaults&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mergeConfig <span class="keyword">from</span> <span class="string">&#x27;./core/mergeConfig&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosStatic</span> &#123;</span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> <span class="title class_">Axios</span>(config) <span class="comment">//åˆ›å»ºä¸€ä¸ª Axios å®ä¾‹ å¹¶ä¼ å…¥ config å‚æ•° å¹¶èµ‹å€¼ç»™ context å˜é‡</span></span><br><span class="line"><span class="keyword">const</span> instance = <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span>.<span class="title function_">bind</span>(context) <span class="comment">//è°ƒç”¨ request æ–¹æ³• å¹¶ä¼ å…¥ context å‚æ•° å¹¶èµ‹å€¼ç»™ instance å˜é‡ ç»‘å®š this æŒ‡å‘ context</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">extend</span>(instance, context) <span class="comment">//è°ƒç”¨ extend æ–¹æ³• å¹¶ä¼ å…¥ instance å’Œ context å‚æ•° å®ç° instance å¯¹è±¡ç»§æ‰¿ context å¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> instance <span class="keyword">as</span> <span class="title class_">AxiosStatic</span> <span class="comment">//è¿”å› instance å¯¹è±¡ å¹¶æ–­è¨€ä¸º AxiosStatic ç±»å‹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="title function_">createInstance</span>(defaults) <span class="comment">//è°ƒç”¨ createInstance æ–¹æ³• å¹¶ä¼ å…¥ defaults å‚æ•° å¹¶èµ‹å€¼ç»™ axios å˜é‡</span></span><br><span class="line"></span><br><span class="line">axios.<span class="property">create</span> = <span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">config</span>) &#123;</span><br><span class="line"><span class="comment">//axios.create æ–¹æ³•æ¥æ”¶ä¸€ä¸ª config å‚æ•° å¹¶è¿”å›ä¸€ä¸ª createInstance æ–¹æ³•çš„è°ƒç”¨ç»“æœ å¹¶ä¼ å…¥ mergeConfig æ–¹æ³•çš„è°ƒç”¨ç»“æœ å¹¶ä¼ å…¥ defaults å’Œ config å‚æ•°</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">createInstance</span>(<span class="title function_">mergeConfig</span>(defaults, config))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æºç å­¦ä¹  </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æºç æ¢ç©¶ runtime-coreæ¨¡å—</title>
      <link href="/2025/03/04/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/%E6%BA%90%E7%A0%81%E6%8E%A2%E7%A9%B6%20runtime-core%E6%A8%A1%E5%9D%97/"/>
      <url>/2025/03/04/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/%E6%BA%90%E7%A0%81%E6%8E%A2%E7%A9%B6%20runtime-core%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="æºç æ¢ç©¶-runtime-core-æ¨¡å—"><a href="#æºç æ¢ç©¶-runtime-core-æ¨¡å—" class="headerlink" title="æºç æ¢ç©¶ runtime-core æ¨¡å—"></a>æºç æ¢ç©¶ runtime-core æ¨¡å—</h1><blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†å¯¹è¿™è¡Œæ ¸å¿ƒä»£ç çš„æºç è¿›è¡Œå…¨æµç¨‹è¿½è¸ª</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#root&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å·²ç»é€šè¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const rootContainer = document.querySelector(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ° <strong><em>rootContainer</em></strong> ï¼š<div id="app"></div></p></blockquote><p>æ‹†åˆ†æˆä¸¤ä¸ªæ­¥éª¤</p><blockquote><p>createApp(App)</p><p>.mount(â€œ#rootâ€)</p></blockquote><h2 id="createApp-App"><a href="#createApp-App" class="headerlink" title="createApp(App)"></a>createApp(App)</h2><h3 id="å…³äº-App"><a href="#å…³äº-App" class="headerlink" title="å…³äº App"></a>å…³äº App</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹ç”¨æˆ·è¿™è¾¹çš„æ“ä½œ</p><p>App.js</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">App</span> = &#123;</span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// UIé€»è¾‘</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">h</span>(</span><br><span class="line"><span class="comment">// Vue ä¸­çš„åˆ›å»ºè™šæ‹Ÿ DOM çš„è¾…åŠ©å‡½æ•°,ç”¨äºåˆ›å»ºè™šæ‹Ÿ DOM èŠ‚ç‚¹,æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š</span></span><br><span class="line"><span class="string">&#x27;div&#x27;</span>, <span class="comment">// typeï¼šè¦åˆ›å»ºçš„ HTML æ ‡ç­¾åæˆ–ç»„ä»¶é€‰é¡¹å¯¹è±¡.</span></span><br><span class="line">&#123; <span class="attr">id</span>: <span class="string">&#x27;root&#x27;</span>, <span class="attr">class</span>: [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;hard&#x27;</span>] &#125;, <span class="comment">// propsï¼šæ ‡ç­¾å±æ€§,å¯ä»¥æ˜¯ä¸€ä¸ª å¯¹è±¡ æˆ– æ•°ç»„.</span></span><br><span class="line"><span class="string">&#x27;hi, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">msg</span> <span class="comment">// childrenï¼šå­èŠ‚ç‚¹,å¯ä»¥æ˜¯ å­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„ã€å…¶ä»–è™šæ‹Ÿ DOM èŠ‚ç‚¹.</span></span><br><span class="line">)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// ç»„åˆå¼ API çš„å…¥å£ç‚¹,ç”¨äºç»„åˆç»„ä»¶çš„é€»è¾‘ï¼Œä¾‹å¦‚å“åº”å¼æ•°æ®ã€ç”Ÿå‘½å‘¨æœŸé’©å­ã€è®¡ç®—å±æ€§ç­‰</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="attr">msg</span>: <span class="string">&#x27;mini-vue&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œç»™ h è¾…åŠ©å‡½æ•°ä¼ å…¥ä¸‰ä¸ªå‚æ•°</p><p><strong><em>type</em></strong>ï¼šè¦åˆ›å»ºçš„ HTML æ ‡ç­¾åæˆ–ç»„ä»¶é€‰é¡¹å¯¹è±¡(div)</p><p><strong><em>props</em></strong>ï¼šæ ‡ç­¾å±æ€§,å¯ä»¥æ˜¯ä¸€ä¸ª å¯¹è±¡ æˆ– æ•°ç»„</p><p><strong><em>children</em></strong>ï¼šå­èŠ‚ç‚¹,å¯ä»¥æ˜¯ å­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„ã€å…¶ä»–è™šæ‹Ÿ DOM èŠ‚ç‚¹</p></blockquote><p>æ¥çœ‹çœ‹ h è¾…åŠ©å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">h</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">createVNode</span>(<span class="keyword">type</span>, props, children)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€ createVNode</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createVNode</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> vnode = &#123;</span><br><span class="line"><span class="keyword">type</span>, <span class="comment">// ç±»å‹</span></span><br><span class="line">props, <span class="comment">// å±æ€§</span></span><br><span class="line">children, <span class="comment">// å­©å­</span></span><br><span class="line"><span class="attr">el</span>: <span class="literal">null</span>, <span class="comment">// å¯¹åº”çš„çœŸå®dom</span></span><br><span class="line"><span class="attr">component</span>: <span class="literal">null</span>, <span class="comment">// ç»„ä»¶å®ä¾‹</span></span><br><span class="line"><span class="attr">key</span>: props === <span class="literal">null</span> || props === <span class="built_in">void</span> <span class="number">0</span> ? <span class="built_in">void</span> <span class="number">0</span> : props.<span class="property">key</span>, <span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="comment">// shapeFlag: getShapeFlag(type), // ç±»å‹æ ‡è¯†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç°åœ¨ App çš„ç»“æ„å°±å˜æˆäº†è¿™æ ·</p><p>render()</p><blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type<span class="punctuation">,</span> <span class="comment">// ç±»å‹</span></span><br><span class="line">props<span class="punctuation">,</span> <span class="comment">// å±æ€§</span></span><br><span class="line">children<span class="punctuation">,</span> <span class="comment">// å­©å­</span></span><br><span class="line">el<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// å¯¹åº”çš„çœŸå®dom</span></span><br><span class="line">component<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// ç»„ä»¶å®ä¾‹</span></span><br><span class="line">key<span class="punctuation">:</span> props === <span class="literal"><span class="keyword">null</span></span> || props === void <span class="number">0</span> ? void <span class="number">0</span> <span class="punctuation">:</span> props.key<span class="punctuation">,</span> <span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br></pre></td></tr></table></figure></blockquote><p>setup()</p></blockquote><h3 id="å…³äº-createApp"><a href="#å…³äº-createApp" class="headerlink" title="å…³äº createApp"></a>å…³äº createApp</h3><blockquote><p>ä¼ å…¥ç»“æ„ App-&gt;rootComponent</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createApp</span>(<span class="params">rootComponent</span>) &#123;</span><br><span class="line"><span class="comment">//rootComponentå°±æ˜¯App</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="title function_">mount</span>(<span class="params">rootContainer</span>) &#123;</span><br><span class="line"><span class="comment">//.mountæ–¹æ³•çš„æ‰©å±•</span></span><br><span class="line"><span class="keyword">const</span> vnode = <span class="title function_">createVNode</span>(rootComponent)</span><br><span class="line"><span class="title function_">render</span>(vnode, rootContainer)</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç”±æ­¤è¿›å…¥.mount(â€œ#rootâ€)éƒ¨åˆ†</p></blockquote><h2 id="mount-â€œ-rootâ€"><a href="#mount-â€œ-rootâ€" class="headerlink" title=".mount(â€œ#rootâ€)"></a>.mount(â€œ#rootâ€)</h2><blockquote><p>æ¥ç€çœ‹ mount æ–¹æ³•çš„å†…éƒ¨</p><p>&#x2F;&#x2F; æŒ‚è½½å›æ ¹å®¹å™¨<br>&#x2F;&#x2F; å…ˆæŠŠæ ¹ç»„ä»¶è½¬æ¢æˆè™šæ‹ŸèŠ‚ç‚¹ vnode<br>&#x2F;&#x2F; ä¹‹åæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šåŸºäº vnode åšå¤„ç†</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createApp</span>(<span class="params">rootComponent</span>) &#123;</span><br><span class="line"><span class="comment">// rootComponent å°±æ˜¯ &#123;render: Æ’, setup: Æ’&#125;</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="title function_">mount</span>(<span class="params">rootContainer</span>) &#123;</span><br><span class="line"><span class="comment">// rootContainer å°±æ˜¯ div#app</span></span><br><span class="line"><span class="keyword">const</span> vnode = <span class="title function_">createVNode</span>(rootComponent) <span class="comment">// æ ¹ç»„ä»¶è½¬æ¢æˆè™šæ‹ŸèŠ‚ç‚¹vnode</span></span><br><span class="line"><span class="title function_">render</span>(vnode, rootContainer) <span class="comment">// å°† vnode æ¸²æŸ“åˆ° container ä¸­</span></span><br><span class="line"><span class="comment">// ä¹‹åæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šåŸºäºvnodeåšå¤„ç†</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="createVNode"><a href="#createVNode" class="headerlink" title="createVNode"></a>createVNode</h3><blockquote><p>rootComponent ä¼ è¿›æ¥äº† {render: Æ’, setup: Æ’}</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createVNode</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> vnode = &#123;</span><br><span class="line"><span class="keyword">type</span>, <span class="comment">// ç±»å‹</span></span><br><span class="line">props, <span class="comment">// å±æ€§</span></span><br><span class="line">children, <span class="comment">// å­©å­</span></span><br><span class="line"><span class="attr">el</span>: <span class="literal">null</span>, <span class="comment">// å¯¹åº”çš„çœŸå®dom</span></span><br><span class="line"><span class="attr">component</span>: <span class="literal">null</span>, <span class="comment">// ç»„ä»¶å®ä¾‹</span></span><br><span class="line"><span class="attr">key</span>: props === <span class="literal">null</span> || props === <span class="built_in">void</span> <span class="number">0</span> ? <span class="built_in">void</span> <span class="number">0</span> : props.<span class="property">key</span>, <span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="comment">// shapeFlag: getShapeFlag(type), // ç±»å‹æ ‡è¯†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç°åœ¨ {render: Æ’, setup: Æ’} è¢«æŒ‚åˆ°äº†è™šæ‹ŸèŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå±æ€§ <strong><em>type</em></strong> ä¸Š</p></blockquote><blockquote><p>ç°åœ¨ <strong><em>vnode</em></strong> çš„ç»“æ„å°±å˜æˆäº†è¿™æ ·</p><p><strong>type</strong></p><blockquote><p>render()</p><blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type<span class="punctuation">,</span> <span class="comment">// ç±»å‹</span></span><br><span class="line">props<span class="punctuation">,</span> <span class="comment">// å±æ€§</span></span><br><span class="line">children<span class="punctuation">,</span> <span class="comment">// å­©å­</span></span><br><span class="line">el<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// å¯¹åº”çš„çœŸå®dom</span></span><br><span class="line">component<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// ç»„ä»¶å®ä¾‹</span></span><br><span class="line">key<span class="punctuation">:</span> props === <span class="literal"><span class="keyword">null</span></span> || props === void <span class="number">0</span> ? void <span class="number">0</span> <span class="punctuation">:</span> props.key<span class="punctuation">,</span> <span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br></pre></td></tr></table></figure></blockquote><p>setup()</p></blockquote><p><strong>props</strong></p><p><strong>children</strong></p><p><strong>el</strong></p><p><strong>component</strong></p><p><strong>key</strong></p></blockquote><h3 id="render"><a href="#render" class="headerlink" title="render"></a>render</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(vnode, rootContainer) <span class="comment">// å°† vnode æ¸²æŸ“åˆ° container ä¸­</span></span><br></pre></td></tr></table></figure><blockquote><p>vnode : åˆšæ‰å†™çš„ç»“æ„ ğŸ‘†</p><p>rootContainer : div#app</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="comment">// ç›´æ¥æŒ‡å‘patchå‡½æ•°</span></span><br><span class="line"><span class="title function_">patch</span>(vnode, container)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="patch-æ‹†ç®±å›è°ƒ"><a href="#patch-æ‹†ç®±å›è°ƒ" class="headerlink" title="patch æ‹†ç®±å›è°ƒ"></a>patch æ‹†ç®±å›è°ƒ</h3><blockquote><p>æ‹†ç®±å‡½æ•°ï¼Œæ·±å±‚å›è°ƒçš„èµ·ç‚¹</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">type</span> === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// å…ƒç´ åˆ†æ”¯</span></span><br><span class="line"><span class="title function_">processElement</span>(vnode, container)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">type</span> === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// ç»„ä»¶åˆ†æ”¯</span></span><br><span class="line"><span class="title function_">processComponent</span>(vnode)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="processComponent-ç»„ä»¶åˆ†æ”¯ï¼ˆé¦–æ¬¡è¿›å…¥ï¼‰"><a href="#processComponent-ç»„ä»¶åˆ†æ”¯ï¼ˆé¦–æ¬¡è¿›å…¥ï¼‰" class="headerlink" title="processComponent ç»„ä»¶åˆ†æ”¯ï¼ˆé¦–æ¬¡è¿›å…¥ï¼‰"></a>processComponent ç»„ä»¶åˆ†æ”¯ï¼ˆé¦–æ¬¡è¿›å…¥ï¼‰</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processComponent</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="title function_">mountComponent</span>(vnode)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="mountComponent-ç»„ä»¶åˆå§‹åŒ–åˆ†æ”¯"><a href="#mountComponent-ç»„ä»¶åˆå§‹åŒ–åˆ†æ”¯" class="headerlink" title="mountComponent ç»„ä»¶åˆå§‹åŒ–åˆ†æ”¯"></a>mountComponent ç»„ä»¶åˆå§‹åŒ–åˆ†æ”¯</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountComponent</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> instance = <span class="title function_">createComponentInstance</span>(vnode) <span class="comment">// åˆ›å»ºç»„ä»¶å®ä¾‹</span></span><br><span class="line"><span class="title function_">setupComponent</span>(instance) <span class="comment">// å¤„ç†ç»„ä»¶</span></span><br><span class="line"><span class="title function_">setupRenderEffect</span>(instance, vnode, container) <span class="comment">// å¤„ç†ç»„ä»¶æ¸²æŸ“</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="createComponentInstance"><a href="#createComponentInstance" class="headerlink" title="createComponentInstance"></a>createComponentInstance</h6><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createComponentInstance</span>(<span class="params">vnode</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> instance = &#123;</span><br><span class="line">vnode,</span><br><span class="line"><span class="attr">type</span>: vnode.<span class="property">type</span>,</span><br><span class="line"><span class="attr">props</span>: vnode.<span class="property">props</span>,</span><br><span class="line"><span class="attr">slots</span>: vnode.<span class="property">slots</span>, <span class="comment">// æ’æ§½</span></span><br><span class="line"><span class="attr">proxy</span>: <span class="literal">null</span>, <span class="comment">// ä»£ç†å¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> instance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿”å›çš„ <strong><em>instance</em></strong> ç»“æ„</p><p><strong>vnode</strong>(æ–°å¢) ï¼šç»§æ‰¿å½“å‰ä¼ è¿‡æ¥çš„æ•´ä¸ª vnode ç»“æ„</p><p><strong>type</strong></p><blockquote><p>render()</p><blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type<span class="punctuation">,</span> <span class="comment">// ç±»å‹</span></span><br><span class="line">props<span class="punctuation">,</span> <span class="comment">// å±æ€§</span></span><br><span class="line">children<span class="punctuation">,</span> <span class="comment">// å­©å­</span></span><br><span class="line">el<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// å¯¹åº”çš„çœŸå®dom</span></span><br><span class="line">component<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// ç»„ä»¶å®ä¾‹</span></span><br><span class="line">key<span class="punctuation">:</span> props === <span class="literal"><span class="keyword">null</span></span> || props === void <span class="number">0</span> ? void <span class="number">0</span> <span class="punctuation">:</span> props.key<span class="punctuation">,</span> <span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br></pre></td></tr></table></figure></blockquote><p>setup()</p></blockquote><p><strong>props</strong></p><p><strong>slots</strong>(æ–°å¢)</p><p><strong>proxy</strong>(æ–°å¢)</p><p><strong>children</strong></p><p><strong>el</strong></p><p><strong>component</strong></p><p><strong>key</strong></p></blockquote><h6 id="setupComponent"><a href="#setupComponent" class="headerlink" title="setupComponent"></a>setupComponent</h6><blockquote><p>instance çš„ç»“æ„è§ä¸Š ğŸ‘†</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setupComponent</span>(<span class="params">instance</span>) &#123;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–ç»„ä»¶</span></span><br><span class="line"><span class="title function_">initProps</span>(instance)</span><br><span class="line"><span class="title function_">initSlots</span>(instance)</span><br><span class="line"><span class="title function_">setupStatefulComponent</span>(instance) <span class="comment">// å¤„ç†ç»„ä»¶çš„setup</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>setupStatefulComponent</strong></p><blockquote><p>æŒ‰è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œè§£æ„å‡ºæ¥çš„ setup ç»“æ„ä¸º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Æ’ <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;mini-vue&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setupStatefulComponent</span>(<span class="params">instance</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Component</span> = instance.<span class="property">type</span> <span class="comment">// å…ˆæ‹¿åˆ°ç»„ä»¶ &#123;render: Æ’, setup: Æ’&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; setup &#125; = <span class="title class_">Component</span> <span class="comment">//è§£æ„å‡ºsetup(ç»“æ„è§ä¸Šé¢æ³¨é‡Š)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (setup) &#123;</span><br><span class="line"><span class="comment">// setCurrentInstance(instance)</span></span><br><span class="line"><span class="keyword">const</span> setupResult = <span class="title function_">setup</span>() <span class="comment">// &#123;msg: &#x27;mini-vue&#x27;&#125;</span></span><br><span class="line"><span class="comment">// setCurrentInstance(null)</span></span><br><span class="line"><span class="title function_">handleSetupResult</span>(instance, setupResult) <span class="comment">// instance &amp; &#123;msg: &#x27;mini-vue&#x27;&#125;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">finishComponentSetup</span>(instance)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸‹é¢è¿™ä¸ªå…ˆç•™ä¸ªå‘ğŸ•³åé¢çœ‹</span></span><br><span class="line">instance.<span class="property">proxy</span> = <span class="keyword">new</span> <span class="title class_">Proxy</span>(instance, &#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> &#123; setup, props &#125; = target</span><br><span class="line"><span class="keyword">if</span> (key <span class="keyword">in</span> setup) &#123;</span><br><span class="line"><span class="keyword">return</span> setup[key]</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (key <span class="keyword">in</span> props) &#123;</span><br><span class="line"><span class="keyword">return</span> props[key]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key)</span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœ setup å­˜åœ¨</strong></p><p>handleSetupResult ï¼ˆå¤„ç†ç»„ä»¶çš„ setupï¼‰</p><blockquote><p>ä¼ å…¥ instance &amp; {msg: â€˜mini-vueâ€™}</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleSetupResult</span>(<span class="params"><span class="attr">instance</span>: <span class="built_in">any</span>, <span class="attr">setupResult</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> setupResult === <span class="string">&#x27;object&#x27;</span> &amp;&amp; setupResult !== <span class="literal">null</span>) &#123;</span><br><span class="line">instance.<span class="property">setupState</span> = setupResult <span class="comment">// instanceæ–°å¢å±æ€§setupState</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">finishComponentSetup</span>(instance) <span class="comment">// å¤„ç†ç»„ä»¶çš„render</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>finishComponentSetup ï¼ˆå¤„ç†ç»„ä»¶çš„ renderï¼‰</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">finishComponentSetup</span>(<span class="params">instance</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Component</span> = instance.<span class="property">type</span> <span class="comment">// å…ˆæ‹¿åˆ°ç»„ä»¶ &#123;render: Æ’, setup: Æ’&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">Component</span>.<span class="property">render</span>) &#123;</span><br><span class="line">instance.<span class="property">render</span> = <span class="title class_">Component</span>.<span class="property">render</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">instance.<span class="property">render</span> = instance.<span class="property">vnode</span>.<span class="property">render</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œ instance åˆæ–°å¢äº† render å±æ€§</p></blockquote><p><strong>å¦‚æœ setup ä¸å­˜åœ¨</strong></p><blockquote><p>ç›´æ¥å¤„ç†ç»„ä»¶çš„ render</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">finishComponentSetup</span>(instance)</span><br></pre></td></tr></table></figure><blockquote><p>åˆ°è¿™é‡Œå°±æ˜¯ç»„ä»¶åˆå§‹åŒ–çš„æœ€åº•å±‚äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å›åˆ° <em>mountComponent</em> å®Œæˆ <em>setupRenderEffect</em> éƒ¨åˆ†</p></blockquote><h6 id="setupRenderEffect"><a href="#setupRenderEffect" class="headerlink" title="setupRenderEffect"></a>setupRenderEffect</h6><blockquote><p>è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•° <strong><em>instance</em></strong>, <strong><em>vnode</em></strong>, <strong><em>container</em></strong></p><p>å·²çŸ¥ <strong>container</strong> ä½œä¸ºå®¹å™¨ä¸º<div id="app"></div></p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹ç›®å‰ <strong>instance</strong> &amp; <strong>vnode</strong> å†…éƒ¨çš„å‚æ•°</p><table><thead><tr><th align="left">instance</th><th align="left">vnode</th><th align="center">å±æ€§</th></tr></thead><tbody><tr><td align="left">âœ…</td><td align="left">âœ…</td><td align="center">children</td></tr><tr><td align="left">âœ…</td><td align="left">âœ…</td><td align="center">component</td></tr><tr><td align="left">âœ…</td><td align="left">âœ…</td><td align="center">el</td></tr><tr><td align="left">âœ…</td><td align="left">âœ…</td><td align="center">key</td></tr><tr><td align="left">âœ…</td><td align="left">âœ…</td><td align="center">props</td></tr><tr><td align="left">âœ… å†…éƒ¨æ˜¯å³è¾¹ vnode çš„å‰äº”ä¸ªå±æ€§</td><td align="left">â›”</td><td align="center"><strong><em>vnode</em></strong></td></tr><tr><td align="left">âœ… { render: Æ’, setup: Æ’ }</td><td align="left">âœ… { render: Æ’, setup: Æ’ }</td><td align="center"><strong><em>type</em></strong></td></tr><tr><td align="left">âœ…</td><td align="left">â›”</td><td align="center">proxy</td></tr><tr><td align="left">âœ…</td><td align="left">â›”</td><td align="center">slots</td></tr><tr><td align="left">âœ… { msg: â€˜mini-vueâ€™ }</td><td align="left">â›”</td><td align="center">setupState</td></tr></tbody></table></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupRenderEffect</span>(<span class="params"><span class="attr">instance</span>: <span class="built_in">any</span>, <span class="attr">vnode</span>: <span class="built_in">any</span>, <span class="attr">container</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line"><span class="comment">//æˆ‘ä»¬å…ˆçœ‹è¿™ä¸€éƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">const</span> &#123; proxy &#125; = instance</span><br><span class="line"><span class="keyword">const</span> subTree = instance.<span class="property">render</span>.<span class="title function_">call</span>(proxy) <span class="comment">// æ³¨æ„!æ˜¯è¿™ä¸ªæ—¶å€™å»è°ƒç”¨renderé‡Œçš„hå‡½æ•°äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vnode -&gt; patch</span></span><br><span class="line"><span class="comment">// vnode -&gt; element -&gt; mountElement</span></span><br><span class="line"><span class="comment">// patch(subTree, container)</span></span><br><span class="line"><span class="comment">// vnode.el = subTree.el</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›é¡¾ h å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">h</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">createVNode</span>(<span class="keyword">type</span>, props, children)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å†çœ‹è¿™æ—¶å€™çš„ type, props, children ä¹Ÿå°±æ˜¯ç”¨æˆ·æ ·ä¾‹</p><p>typeï¼šâ€™divâ€™</p><p>propsï¼š{ id: â€˜rootâ€™, class: [â€˜redâ€™, â€˜hardâ€™] }</p><p>childrenï¼šâ€™hi, mini-vueâ€™</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createVNode</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> vnode = &#123;</span><br><span class="line"><span class="keyword">type</span>, <span class="comment">// ä¼ å…¥ç±»å‹</span></span><br><span class="line">props, <span class="comment">// ä¼ å…¥å±æ€§</span></span><br><span class="line">children, <span class="comment">// ä¼ å…¥å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="attr">el</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">component</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">key</span>: props === <span class="literal">null</span> || props === <span class="built_in">void</span> <span class="number">0</span> ? <span class="built_in">void</span> <span class="number">0</span> : props.<span class="property">key</span>, <span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é‚£ä¹ˆæ¥ä¸‹æ¥çš„ <strong><em>subTree</em></strong> ç»“æ„å°±æ˜¯</p><p><strong>type</strong> &#x3D; â€˜divâ€™</p><p><strong>props</strong> &#x3D; { id: â€˜rootâ€™, class: [â€˜redâ€™, â€˜hardâ€™] }</p><p><strong>children</strong> &#x3D; â€˜hi, mini-vueâ€™</p><p><strong>el</strong></p><p><strong>component</strong></p><p><strong>key</strong></p></blockquote><blockquote><p>ä»¥åŠ <strong><em>container</em></strong> ç»“æ„</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span> <span class="attr">class</span>=<span class="string">&quot;red, hard&quot;</span>&gt;</span>hi, mini-vue<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><p>è¿”å› <strong>setupRenderEffect</strong> å‡½æ•°ï¼Œç»§ç»­çœ‹ä¸‹é¢çš„é€»è¾‘</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupRenderEffect</span>(<span class="params"><span class="attr">instance</span>: <span class="built_in">any</span>, <span class="attr">vnode</span>: <span class="built_in">any</span>, <span class="attr">container</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line"><span class="comment">// const &#123; proxy &#125; = instance</span></span><br><span class="line"><span class="comment">// const subTree = instance.render.call(proxy) // æ³¨æ„!æ˜¯è¿™ä¸ªæ—¶å€™å»è°ƒç”¨renderé‡Œçš„hå‡½æ•°äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vnode -&gt; patch</span></span><br><span class="line"><span class="comment">// vnode -&gt; element -&gt; mountElement</span></span><br><span class="line"><span class="title function_">patch</span>(subTree, container) <span class="comment">//ä¼ å…¥subtree container</span></span><br><span class="line">vnode.<span class="property">el</span> = subTree.<span class="property">el</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è°ƒç”¨ <strong><em>patch</em></strong> å›è°ƒæ‹†ç®±</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">type</span> === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// å…ƒç´ åˆ†æ”¯ &lt;-è¿™æ¬¡è¿›è¿™ä¸ª</span></span><br><span class="line"><span class="title function_">processElement</span>(vnode, container) <span class="comment">// æ­¤æ—¶çš„ vnode.type å·²ç»æ˜¯&#x27;div&#x27;äº†</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">type</span> === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// ç»„ä»¶åˆ†æ”¯</span></span><br><span class="line"><span class="title function_">processComponent</span>(vnode)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¿«è¿›åˆ°ä¸‹é¢çš„ processElement å…ƒç´ åˆ†æ”¯</p></blockquote><h5 id="updateComponent-æ›´æ–°åˆ†æ”¯"><a href="#updateComponent-æ›´æ–°åˆ†æ”¯" class="headerlink" title="updateComponent æ›´æ–°åˆ†æ”¯"></a>updateComponent æ›´æ–°åˆ†æ”¯</h5><blockquote><p><strong><em>!!! ç¬¬ä¸€æ¬¡çœ‹å…ˆæ è¿‡è¿™ä¸€éƒ¨åˆ†,å…ˆçœ‹åæ–‡ â€˜processElement å…ƒç´ åˆ†æ”¯â€™ å®ç°æ‹†ç®± !!!</em></strong></p></blockquote><h4 id="processElement-å…ƒç´ åˆ†æ”¯"><a href="#processElement-å…ƒç´ åˆ†æ”¯" class="headerlink" title="processElement å…ƒç´ åˆ†æ”¯"></a>processElement å…ƒç´ åˆ†æ”¯</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="title function_">mountElement</span>(vnode, container)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="mountElement-å…ƒç´ åˆå§‹åŒ–åˆ†æ”¯"><a href="#mountElement-å…ƒç´ åˆå§‹åŒ–åˆ†æ”¯" class="headerlink" title="mountElement å…ƒç´ åˆå§‹åŒ–åˆ†æ”¯"></a>mountElement å…ƒç´ åˆå§‹åŒ–åˆ†æ”¯</h5><blockquote><p>è‹¥ä»¥é¦–æ¬¡æ ·ä¾‹ä¼ å…¥ä¸ºä¾‹ï¼Œè¿›å…¥æ–‡æœ¬èŠ‚ç‚¹</p><p>è‹¥ä»¥äºŒæ¬¡æ ·ä¾‹ä¼ å…¥ä¸ºä¾‹ï¼Œè¿›å…¥æ•°ç»„èŠ‚ç‚¹</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(vnode.<span class="property">type</span>) <span class="comment">// åˆ›å»ºçœŸå®dom &lt;div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="keyword">const</span> &#123; children, props &#125; = vnode</span><br><span class="line"><span class="comment">// (é¦–æ¬¡)è§£æ„ä¸º</span></span><br><span class="line"><span class="comment">// &#x27;hi, mini-vue&#x27;</span></span><br><span class="line"><span class="comment">// &#123; id: &#x27;root&#x27;, class: [&#x27;red&#x27;, &#x27;hard&#x27;] &#125;</span></span><br><span class="line"><span class="comment">// (äºŒæ¬¡)è§£æ„ä¸º</span></span><br><span class="line"><span class="comment">// [h(&#x27;p&#x27;, &#123; class: &#x27;red&#x27; &#125;, &#x27;hi&#x27;), h(&#x27;p&#x27;, &#123; class: &#x27;blue&#x27; &#125;, &#x27;mini-vue&#x27;)]</span></span><br><span class="line"><span class="comment">// &#123; id: &#x27;root&#x27;, class: [&#x27;red&#x27;, &#x27;hard&#x27;] &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> children === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// æ–‡æœ¬èŠ‚ç‚¹(é¦–æ¬¡æ ·ä¾‹)</span></span><br><span class="line">el.<span class="property">textContent</span> = children <span class="comment">// ç›´æ¥æŠŠ&#x27;hi, mini-vue&#x27;æ’å…¥åˆ°&lt;div&gt;&lt;/div&gt;ä¸‹0ä½å¤„</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(children)) &#123;</span><br><span class="line"><span class="comment">// æ•°ç»„èŠ‚ç‚¹(äºŒæ¬¡æ ·ä¾‹)</span></span><br><span class="line"><span class="title function_">mountChildren</span>(vnode, el) <span class="comment">// æ‹†åˆ†æ•°ç»„ + patchå›è°ƒ (æ­¤æ—¶elæ˜¯&lt;p&gt;,containeræ˜¯&lt;div&gt;)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (props) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> props) &#123;</span><br><span class="line"><span class="comment">// éå†key</span></span><br><span class="line"><span class="keyword">const</span> val = props[key] <span class="comment">// æ‹¿åˆ°å±æ€§å€¼val</span></span><br><span class="line">el.<span class="title function_">setAttribute</span>(key, val) <span class="comment">// Webå†…ç½®API,æŠŠé”®å€¼å¯¹åµŒå…¥divæ ‡ç­¾</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">container.<span class="title function_">append</span>(el) <span class="comment">// Webå†…ç½®API,æŠŠelæŒ‚è½½åˆ°å®¹å™¨ä¸­</span></span><br><span class="line"><span class="comment">// (é¦–æ¬¡)æŒ‚è½½ä¸º</span></span><br><span class="line"><span class="comment">// container : &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment">// el : &lt;div id=&quot;root&quot; class=&quot;red,hard&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment">// (äºŒæ¬¡)æŒ‚è½½ä¸º</span></span><br><span class="line"><span class="comment">// container : &lt;div id=&quot;root&quot; class=&quot;red,hard&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment">// el : &lt;p class=&quot;...&quot;&gt;&lt;/p&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>(é¦–æ¬¡æ ·ä¾‹) for (const key in props) çš„è¿‡ç¨‹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span> <span class="attr">class</span>=<span class="string">&quot;red,hard&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><blockquote><p>(é¦–æ¬¡æ ·ä¾‹) container.append(el) çš„ç»“æœ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- container --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&gt; 0 =</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span> <span class="attr">class</span>=<span class="string">&quot;red, hard&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&gt; &gt; 0 = hi, mini-vue</span><br></pre></td></tr></table></figure></blockquote><p>æ­¤æ—¶è¿”å› <strong><em>setupRenderEffect</em></strong> çš„æœ€åä¸€è¡Œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vnode.<span class="property">el</span> = subTree.<span class="property">el</span></span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶æ‰“å¼€ html ç½‘é¡µï¼Œå°±å¯ä»¥çœ‹åˆ°å±å¹•ä¸Šçš„ hi, mini-vue å­—æ ·äº†</p></blockquote><p><strong><em>!!! äºŒæ¬¡å¤ç›˜ !!!</em></strong></p><blockquote><p>ç°åœ¨æˆ‘ä»¬å°† h çš„ children å‚æ•°æ”¹æˆæ•°ç»„</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title function_">h</span>(</span><br><span class="line"><span class="comment">// åˆ›å»ºè™šæ‹Ÿ DOM èŠ‚ç‚¹,æ¥æ”¶ä¸‰ä¸ªå‚æ•°</span></span><br><span class="line"><span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">&#123; <span class="attr">id</span>: <span class="string">&#x27;root&#x27;</span>, <span class="attr">class</span>: [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;hard&#x27;</span>] &#125;,</span><br><span class="line"><span class="comment">// &#x27;hi, mini-vue&#x27; //stringç±»å‹</span></span><br><span class="line">[<span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;red&#x27;</span> &#125;, <span class="string">&#x27;hi&#x27;</span>), <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;blue&#x27;</span> &#125;, <span class="string">&#x27;mini-vue&#x27;</span>)] <span class="comment">// arrayç±»å‹</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”åœ¨ index.html ä¸­æ·»åŠ  css æ ·å¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.red</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.blue</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">color</span>: blue;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></blockquote><p>è¿˜è®°å¾— children åˆ¤æ–­ç±»å‹çš„åˆ†æ”¯å—ï¼Œå°±åœ¨åˆšå†™çš„ <strong><em>mountElement</em></strong> å‡½æ•°é‡Œï¼Œè¿”å›å»å†çœ‹çœ‹ï¼Œçœ‹å®Œå†å›åˆ°è¿™é‡Œ</p><h6 id="mountChildren"><a href="#mountChildren" class="headerlink" title="mountChildren"></a>mountChildren</h6><blockquote><p>æ‰€ä»¥ç°åœ¨äºŒæ¬¡æ ·ä¾‹ä¸­çš„æ•°æ®å¦‚ä¸‹</p><p><strong>vnode.children</strong> å­èŠ‚ç‚¹æ ‡ç­¾æ•°ç»„</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;[<span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;red&#x27;</span> &#125;, <span class="string">&#x27;hi&#x27;</span>), <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;blue&#x27;</span> &#125;, <span class="string">&#x27;mini-vue&#x27;</span>)]</span><br></pre></td></tr></table></figure><p><strong>container</strong> æ ¹å®¹å™¨</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountChildren</span>(<span class="params"><span class="attr">vnode</span>: <span class="built_in">any</span>, <span class="attr">container</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">vnode.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">patch</span>(v, container) <span class="comment">// é€’å½’å¤„ç†children</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å–å‡ºæ¥çš„ <strong><em>v</em></strong> ä¾æ­¤æ˜¯</p><table><thead><tr><th align="center"></th><th align="center">ç¬¬ä¸€æ¬¡ (è°ƒç”¨ h)</th><th align="center">ç¬¬äºŒæ¬¡ (è°ƒç”¨ h)</th></tr></thead><tbody><tr><td align="center"><strong>type</strong></td><td align="center">p</td><td align="center">p</td></tr><tr><td align="center"><strong>props</strong></td><td align="center">{ class: â€˜ red â€˜ }</td><td align="center">{ class: â€˜ blue â€˜ }</td></tr><tr><td align="center"><strong>children</strong></td><td align="center">â€˜ hi â€˜</td><td align="center">â€˜ mini-vue â€˜</td></tr></tbody></table></blockquote>]]></content>
      
      
      <categories>
          
          <category> æºç å­¦ä¹  </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
