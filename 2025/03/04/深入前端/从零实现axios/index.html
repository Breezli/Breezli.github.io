<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>TS + NodeJS实现axios | 松风狸 | Breezli</title><meta name="keywords" content="TS, NodeJS, axios, 库"><meta name="author" content="Breezli"><meta name="copyright" content="Breezli"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="TS + NodeJS实现axios"><meta name="application-name" content="TS + NodeJS实现axios"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="TS + NodeJS实现axios"><meta property="og:url" content="http://example.com/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0axios/index.html"><meta property="og:site_name" content="松风狸 | Breezli"><meta property="og:description" content="TS + NodeJS 实现 axios1git clone https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;alexjoverm&amp;#x2F;typescript-library-starter.git ts-axios  需求 在浏览器端使用 XMLHttpRequest 对象通讯 Promise API 请求响应拦"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2025/03/05/67c7e99f50819.webp"><meta property="article:author" content="Breezli"><meta property="article:tag" content="前端, 博客"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2025/03/05/67c7e99f50819.webp"><meta name="description" content="TS + NodeJS 实现 axios1git clone https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;alexjoverm&amp;#x2F;typescript-library-starter.git ts-axios  需求 在浏览器端使用 XMLHttpRequest 对象通讯 Promise API 请求响应拦"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0axios/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css#fontawesome_animation 如果有就会加载，示例值：https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"吾身如浮萍，不敢言再会          ......","backTitle":"幸得天眷顾，得良友两三          ......"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"api","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["💻 前端技术学者","📕 红楼梦忠实书迷","🌄 旅行爱好者","🎨 国画九级选手","💤 睡觉居士","📜 诗词爱好者"]},
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Breezli","link":"链接: ","source":"来源: 松风狸 | Breezli","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '松风狸 | Breezli',
  title: 'TS + NodeJS实现axios',
  postAI: '',
  pageFillDescription: 'TS + NodeJS 实现 axios, 需求, 请求代码, 安装依赖, webpack 配置, entry, output, module, resolve, plugins, 核心功能, 处理 url 参数(params), 解构 URL -gt params, 解构 params -gt keyx2Fvalue, 处理 body 数据, 处理 header, 总结, 获取处理 response, 处理响应 data, 错误处理(reject 拒回), 处理网络错误, 处理超时错误, 状态码处理(!200 错误), 错误信息增强, 创建 AxiosError 类, createError 方法应用, 接口扩展, 需求分析, 创建 Axios.ts, 实现 Axios 类中接口, 混合对象实现, 工厂函数实现, axios 函数重载, 响应数据支持泛型, 拦截器实现, 拦截器管理类, 链式调用实现, 合并用户配置, 默认配置设置, 合并策略实现, timeout 逻辑, headers 逻辑, 合并, 压缩, 更多配置, transfromRequest amp transfromResponse, 定义接口, 重构 transform 逻辑, create, 扩展新的接口实现需求在浏览器端使用对象通讯请求响应拦截器请求数据和响应数据转换请求的取消数据的自动转换客户端防止框架工具请求代码最基本的操作创建入口文件函数用于发送请求的工具函数基于实现并提供了一个简单的接口来配置和发送请求解构设置默认值实例化一个对象并赋值给变量调用方法并传入三个参数并将转换为大写并赋值给调用方法并传入参数并赋值给变量安装依赖配置整体导出一个对象包含开发模式几个关键属性收集了多个目录的入口文件并将每个入口引入一个用于热更新的文件是一个对象为目录名将的打包成定义一系列处理不同类型文件的规则进行预处理包括类型检查只进行编译而不进行类型检查将注入到中处理文件中的和指定在导入模块时可以省略的文件扩展名会自动尝试这些扩展名热更新发生错误不打包文件核心功能处理参数核心思想把的解构拼接到上解构解构需处理逻辑没有参数没有参数直接返回解构是一个包含请求参数的对象例具体代码存放参数的数组依次取到等值对象值所对应的为或为数组定义变量如果为数组直接赋值给键名后面添加一个赋值给为字符串对象再回来遍历为日期转换为格式赋值给为对象转换为字符串赋值给特殊字符转码赋值给拼装成效果将数组中的所有元素连接成一个字符串并使用作为分隔符如果不为空则拼接查找中是否存在符号返回符号在中的位置索引使用方法将截取到哈希部分之前从而去除哈希部分确保中的查询参数存在处理数据判断是否为日期判断是否为对象判断是否为普通对象处理处理返回拼接后的处理处理一般传递诸如认证信息内容类型等元数据给服务器处理函数接收和两个参数调用函数将的属性名规范化如果是一个普通对象如果不存在属性设置属性为是请求头的一部分用于指示实体主体即请求或响应的正文部分的数据类型它告诉接收方如何解析接收到的数据例如当发送格式的数据时通常会将设置为这样接收方就知道应该以的形式来解析数据辅助函数函数接收和两个参数如果不存在直接返回遍历的所有属性如果属性名不等于并且属性名的大写形式等于的大写形式将的属性名设置为删除的属性名返回加入增添处理逻辑处理先处理再处理处理调用方法添加处理逻辑添加解构实例化一个对象并赋值给变量遍历的所有属性如果为并且属性名为删除的属性名调用方法并传入两个参数并赋值给变量调用方法并传入参数并赋值给变量总结这部分处理实现了为自动添加告知服务端解析的是数据获取处理接口新增接口接口函数接收一个参数返回一个对象并传入两个参数解构赋值拿到变量实例化一个对象并赋值给变量调用方法并传入三个参数并将转换为大写并赋值给异步调用方法并传入函数并赋值给变量状态为正确接收到数据没有收到正确的响应调用方法并赋值给变量后面要处理这个字符串调用方法并赋值给变量调用方法并传入参数遍历的所有属性如果为并且属性名为删除的属性名调用方法并传入两个参数并赋值给变量调用方法并传入参数并赋值给变量函数接收一个参数方法处理对象的方法获取到的值是如下字符串每一行都是以回车和换行符结束是每个属性的分隔符而我们希望解析成的对象结构新增方法函数接收参数创建一个空对象如果不存在返回遍历的每一行分割每一行的和去掉的空格并将转换为小写如果不存在直接返回如果存在去掉的空格将和赋值给返回处理响应不设置情况下服务端返回数据是字符串类型我们要转成对象新增转化函数处理新增引入转化函数请求结束后对进行处理处理基础核心功能至此已全部实现错误处理拒回处理网络错误网络不通时发送请求会触发对象实例的事件所以我们可以在事件回调函数中捕获此类错误中添加调用方法并传入函数并赋值给变量调用方法并传入参数处理超时错误设置一个当请求超过某个时间后没收到响应则终止并触发事件默认超时时间为永不超时我们首先需要允许程序可配置超时时间接口新增新增解构新增逻辑如果存在超过毫秒超时状态码处理错误处理时机接收到响应的时候没有收到正确的响应也就是在这里如果发送网络错误超时错误传入处理参数状态码大于等于并且小于调用方法并传入参数报错状态码错误信息增强按照之前的操作我们实现了对基础错误信息的处理但我们对外提供的错误信息是十分有限的我们希望对外提供的错误信息包括错误文本信息报错显示请求对象配置错误代码对象实例自定义响应对象创建类定义接口接口新建定义一个类继承类实现接口并设置为构造函数接收五个参数赋值给对应的属性并设置为调用父类的构造函数传入参数赋值给属性修复原型链问题定义一个函数接收五个参数并返回一个对象方法应用对错误对象创建的逻辑进行修改修改调用方法并传入参数替换为传入参数事件触发时拿不到就不传了调用方法并传入参数修改调用方法并传入函数并赋值给变量调用方法并传入参数替换为调用方法并传入函数并赋值给变量传入参数调用方法并传入参数修改传入处理参数状态码大于等于并且小于调用方法并传入参数调用方法并传入参数替换为传入处理参数状态码大于等于并且小于调用方法并传入参数传入参数调用方法并传入参数接口扩展需求分析为了用户更加方便地使用发送请求我们可以为所有支持的请求方法扩展一些接口可选项接口实例接口既有函数类型又有属性接口创建存放一些发送请求核心代码大写表示是一个类实现方法封装核心代码函数接收一个参数请求结束后对进行处理处理先处理再处理处理返回拼接后的处理调用方法处理调用方法处理然后将移入文件夹也作为核心模块部分报错修改严格模式调用方法传入三个参数并将转换为大写并赋值给异步断言中当你保证某个变量不会为或者但编译器却无法推断出来的时候就可以使用非空断言操作符不会在运行时进行检查但要是你做出了错误的保证在运行时就可能会出现错误实现类中接口实现接口传入参数并返回逻辑封装封装方法传入和参数并返回调用方法并传入一个对象实现接口传入和参数调用方法传入一个对象实现接口传入和参数调用方法传入一个对象实现接口传入和参数调用方法并传入一个对象实现接口传入和参数调用方法并传入一个对象逻辑封装封装方法传入和参数并返回调用方法并传入一个对象实现接口传入和参数调用方法并传入一个对象实现接口传入和参数调用方法并传入一个对象实现接口传入和参数调用方法并传入一个对象混合对象实现首先这个对象是函数其次这个对象包括类内所有原型属性和实例属性合成函数示例输出这里我们使用泛型和代表目标对象的类型代表源对象的类型函数的返回值类型是也就是和两个对象类型的交集合并对象把对象的属性值赋值给对象对应的属性这里运用了类型断言和让编译器认可这种赋值操作也用了类型断言工厂函数实现处理删掉内容只保留实例化一个对象并赋值给变量调用方法并传入参数并赋值给变量绑定指向调用方法并传入和参数实现对象继承对象返回对象并断言为类型调用方法并赋值给变量函数重载目前我们函数只能存放一个对象那么如果同时含有两个参数实例接口既有函数类型又有属性接口单参添加函数重载双参修改方法实现方法传入参数改为实现方法传入参数双参单参此时的就是响应数据支持泛型通常情况我们会将后端返回数据格式单独放入一个接口中设置泛型提高类型灵活性接口接口接口实例接口既有函数类型又有属性接口函数重载拦截器实现也就是二次封装中常见的请求拦截器响应拦截器我们先回顾一下用户拦截器是怎么写的请求拦截器响应拦截器是后添加的先执行是先添加的先执行拦截器管理类拦截器接口添加拦截器返回拦截器删除拦截器返回拦截器成功拦截器接口失败拦截器接口拦截器接口拦截器管理类拦截器数组存放的是拦截器对象每个对象有两个属性构造函数初始化拦截器数组拦截器数组中存放的是拦截器对象添加拦截器将拦截器对象添加到拦截器数组中返回拦截器的用于删除拦截器遍历拦截器遍历拦截器数组判断拦截器是否存在存在则调用函数删除拦截器通过删除拦截器判断拦截器是否存在存在则将拦截器置为链式调用实现用户可以通过添加拦截器完善实现调用链是一个函数类型接收一个类型的参数返回一个类型的参数是一个函数类型接收一个类型的参数返回一个类型的参数实现方法传入参数创建一个数组遍历拦截器将拦截器添加到数组的开头遍历拦截器将拦截器添加到数组的末尾创建一个对象并传入参数遍历数组取出数组的第一个元素将对象的方法传入和参数合并用户配置用户在发送请求时可以传入一个配置来决定请求的不同行为甚至可以直接修改一些默认配置默认对任何类型的请求的都添加属性默认对请求的都添加属性默认配置设置配置默认请求通用的请求头接受的响应类型为文本表示任意类型优先级最低没有数据的请求头优先级高于通用的请求头表单提交的请求头优先级高于通用的请求头初始化属性用户可以通过添加拦截器默认配置拦截器重写创建一个实例并传入参数并赋值给变量调用方法并传入参数并赋值给变量绑定指向调用方法并传入和参数实现对象继承对象返回对象并断言为类型调用方法并传入参数并赋值给变量合并策略实现创建为默认配置代表用户传入的自定义配置实现示例假设和如下合并属性时就是的值就是的值逻辑合并策略为属性名为合并策略函数默认合并策略优先取如果不存在则取忽略只取对于属性只取合并后的配置结果合并策略添加自动索引字符串自动索引逻辑合并如果是对象递归合并如果不是对象且存在如果不是对象且不存在且是对象递归合并如果不是对象且不存在且不是对象且存在工具函数实现深度合并对象在请求中应用函数实现方法传入参数发送请求之前应用合并创建一个数组压缩合并后的是一个复杂对象多了等属性我们需要压缩成一级对于中定义的字段我们都要提取而对于这类提取需要和该次请求的方法对应函数接收和参数将中的属性名规范化并删除不必要的属性并返回一个新的对象如果不存在返回调用函数将深度合并定义一个数组存储需要删除的属性名遍历数组删除的属性名返回应用函数处理先处理再处理处理扁平化更多配置官方中提供值为一个数组或一个函数这两个属性允许用户在数据发送到服务器之前只适用于而且可以修改对象把响应数据传递给或之前对其修改自定义的保留默认的展开默认的自定义的修改响应数据请求的请求方法请求的数据定义接口接口请求数据转换函数响应数据转换函数字符串自动索引转换接口通用的请求头接受的响应类型为文本表示任意类型优先级最低处理请求头处理请求数据处理响应数据重构逻辑函数接收三个参数如果没有传入直接返回如果不是数组将其转为数组遍历数组依次调用函数处理先处理再处理处理扁平化更改为处理处理处理扁平化删掉不用的东西处理调用方法处理调用方法更改逻辑处理目前为止我们的都是一个单例一旦我们修改了的默认配置会影响所有的请求我们希望提供了一个的静态接口允许我们创建一个新的实例同时允许我们传入新的配置和默认配置合并并做为新的默认配置扩展新的接口静态接口创建实例创建一个实例并传入参数并赋值给变量调用方法并传入参数并赋值给变量绑定指向调用方法并传入和参数实现对象继承对象返回对象并断言为类型调用方法并传入参数并赋值给变量方法接收一个参数并返回一个方法的调用结果并传入方法的调用结果并传入和参数',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-03-08 23:36:14',
  postMainColor: '#ffffff',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/512.png"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">松风狸 | Breezli</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/music/?id=13242559326&amp;server=netease"><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 梦境</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-plant-fill faa-tada" style="font-size: 0.9em;"></i><span> 簪花人间</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/cinema/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 匣中秋水</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-instagram faa-tada" style="font-size: 0.9em;"></i><span> 彩云霁月</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><span> 关于</span></a></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">32</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/" itemprop="url">深入前端</a></span><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">TS + NodeJS实现axios</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-03-04T12:33:51.374Z" title="发表于 2025-03-04 20:33:51">2025-03-04</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-03-08T15:36:14.620Z" title="更新于 2025-03-08 23:36:14">2025-03-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="TS + NodeJS实现axios"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为成都"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>成都</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://bu.dusays.com/2025/03/05/67c7e99f50819.webp"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0axios/"><header><a class="post-meta-categories" href="/categories/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/" itemprop="url">深入前端</a><h1 id="CrawlerTitle" itemprop="name headline">TS + NodeJS实现axios</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Breezli</span><time itemprop="dateCreated datePublished" datetime="2025-03-04T12:33:51.374Z" title="发表于 2025-03-04 20:33:51">2025-03-04</time><time itemprop="dateCreated datePublished" datetime="2025-03-08T15:36:14.620Z" title="更新于 2025-03-08 23:36:14">2025-03-08</time></header><h1 id="TS-NodeJS-实现-axios"><a href="#TS-NodeJS-实现-axios" class="headerlink" title="TS + NodeJS 实现 axios"></a>TS + NodeJS 实现 axios</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/alexjoverm/typescript-library-starter.git ts-axios</span><br></pre></td></tr></table></figure>

<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><blockquote>
<p>在浏览器端使用 XMLHttpRequest 对象通讯</p>
<p>Promise API</p>
<p>请求响应拦截器</p>
<p>请求数据和响应数据转换</p>
<p>请求的取消</p>
<p>JSON 数据的自动转换</p>
<p>客户端防止 XSRF</p>
</blockquote>
<p>框架工具</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250129205459495.png" alt="image-20250129205459495" style="zoom:67%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250129205721267.png" alt="image-20250129205721267" style="zoom:67%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250129205345604.png" alt="image-20250129205345604" style="zoom:80%;" />

<h3 id="请求代码"><a href="#请求代码" class="headerlink" title="请求代码"></a>请求代码</h3><p>axios 最基本的操作</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">	<span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">	<span class="attr">url</span>: <span class="string">&#x27;/simple/get&#x27;</span>,</span><br><span class="line">	<span class="attr">params</span>: &#123;</span><br><span class="line">		<span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>创建入口文件</p>
<p><code>index.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">axios</span>(<span class="params">config</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure>

<p><code>xhr.ts</code></p>
<blockquote>
<p><code>xhr</code> 函数用于发送 HTTP 请求的工具函数，基于 XMLHttpRequest API 实现，并提供了一个简单的接口来配置和发送请求。</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">xhr</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> &#123; data = <span class="literal">null</span>, url, method = <span class="string">&#x27;get&#x27;</span> &#125; = config <span class="comment">// 解构设置默认值</span></span><br><span class="line">	<span class="keyword">const</span> request = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>() <span class="comment">// 实例化一个 XMLHttpRequest 对象 并赋值给 request 变量</span></span><br><span class="line">	request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url, <span class="literal">true</span>) <span class="comment">// 调用 open 方法 并传入 method url true 三个参数 并将 method 转换为大写并赋值给 method,url. async:true</span></span><br><span class="line">	request.<span class="title function_">send</span>(data) <span class="comment">// 调用 send 方法 并传入 data 参数 并赋值给 request 变量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250130164413743.png" alt="image-20250130164413743"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="webpack-配置"><a href="#webpack-配置" class="headerlink" title="webpack 配置"></a>webpack 配置</h2><blockquote>
<p>webpack.config.js</p>
<p>整体导出一个对象，包含 mode（开发模式），entry，output，module，resolve，plugins 几个关键属性</p>
</blockquote>
<h3 id="entry"><a href="#entry" class="headerlink" title="entry"></a><em>entry</em></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">entry</span>: fs.<span class="title function_">readdirSync</span>(__dirname).<span class="title function_">reduce</span>(<span class="function">(<span class="params">entries, dir</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fullDir = path.<span class="title function_">join</span>(__dirname, dir)</span><br><span class="line">    <span class="keyword">const</span> entry = path.<span class="title function_">join</span>(fullDir, <span class="string">&#x27;app.ts&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (fs.<span class="title function_">statSync</span>(fullDir).<span class="title function_">isDirectory</span>() &amp;&amp; fs.<span class="title function_">existsSync</span>(entry)) &#123;</span><br><span class="line">        entries[dir] = [<span class="string">&#x27;webpack-hot-middleware/client&#x27;</span>, entry]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> entries</span><br><span class="line">&#125;, &#123;&#125;),</span><br></pre></td></tr></table></figure>

<blockquote>
<p>entries 收集了多个目录的入口文件 (app.ts) ，并将每个入口引入一个用于热更新的文件</p>
<p>entries 是一个对象，key 为目录名</p>
</blockquote>
<h3 id="output"><a href="#output" class="headerlink" title="output"></a><em>output</em></h3><blockquote>
<p>将 entries 的 key 打包成 filename</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;__build__&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;/__build__/&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="module"><a href="#module" class="headerlink" title="module"></a><em>module</em></h3><blockquote>
<p>rules 定义一系列处理不同类型文件的规则</p>
<p>.ts :<code>tslint-loader</code> 进行预处理 (包括类型检查)</p>
<p>.tsx :<code>transpileOnly: true</code> 只进行编译而不进行类型检查</p>
<p>.css :<code>style-loader</code> 将 CSS 注入到 DOM 中，<code>css-loader</code> 处理 CSS 文件中的 <code>@import</code> 和 <code>url()</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">            <span class="attr">enforce</span>: <span class="string">&#x27;pre&#x27;</span>,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;tslint-loader&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;ts-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>: &#123;</span><br><span class="line">                        <span class="attr">transpileOnly</span>: <span class="literal">true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a><em>resolve</em></h3><blockquote>
<p>指定在导入模块时可以省略的文件扩展名，Webpack 会自动尝试这些扩展名。</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resolve</span>: &#123;</span><br><span class="line">	<span class="attr">extensions</span>: [<span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a><em>plugins</em></h3><blockquote>
<p>热更新 | 发生错误不打包文件</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">	<span class="keyword">new</span> webpack.<span class="title class_">HotModuleReplacementPlugin</span>(),</span><br><span class="line">	<span class="keyword">new</span> webpack.<span class="title class_">NoEmitOnErrorsPlugin</span>(),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h2><h3 id="处理-url-参数-params"><a href="#处理-url-参数-params" class="headerlink" title="处理 url 参数(params)"></a>处理 url 参数(params)</h3><blockquote>
<p>核心思想：把 params 的 key&amp;value <strong>解构拼接</strong>到 URL 上</p>
</blockquote>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210214938544.png" alt="image-20250210214938544" style="zoom: 50%;" />

<p><code>helpers/url.ts</code></p>
<h4 id="解构-URL-params"><a href="#解构-URL-params" class="headerlink" title="解构 URL -&gt; params"></a>解构 URL -&gt; params</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">bulidURL</span>(<span class="params"><span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">params</span>?: <span class="built_in">any</span></span>): <span class="built_in">string</span> &#123;<span class="comment">//解构</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>需处理逻辑</strong></p>
<p><em>没有参数</em></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215202014.png" alt="image-20250210215202014" style="zoom:50%;" />

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!params) &#123;</span><br><span class="line">	<span class="comment">// 没有参数 直接返回 url</span></span><br><span class="line">	<span class="keyword">return</span> url</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="解构-params-key-value"><a href="#解构-params-key-value" class="headerlink" title="解构 params -&gt; key&#x2F;value"></a>解构 params -&gt; key&#x2F;value</h4><p>params 是一个包含请求参数的对象</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例</span></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">	<span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">	<span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">	<span class="attr">hobbies</span>: [<span class="string">&#x27;reading&#x27;</span>, <span class="string">&#x27;coding&#x27;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体代码</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">parts</span>: <span class="built_in">string</span>[] = [] <span class="comment">// 存放参数的数组</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(params).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123; <span class="comment">// key 依次取到 &#x27;name&#x27;, &#x27;age&#x27;, &#x27;hobbies&#x27; 等值</span></span><br><span class="line">    <span class="keyword">const</span> val = params[key] <span class="comment">// 对象key值所对应的value</span></span><br><span class="line">    ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><em>value 为 null 或 undefined</em></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (val === <span class="literal">null</span> || <span class="keyword">typeof</span> val === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>value</em> 为 <em>数组</em></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210214959177.png" alt="image-20250210214959177" style="zoom:50%;" />

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> values = [] <span class="comment">// 定义 values 变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(val)) &#123;</span><br><span class="line">	<span class="comment">// 如果 value 为数组 直接赋值给 values</span></span><br><span class="line">	values = val</span><br><span class="line">	key += <span class="string">&#x27;[]&#x27;</span> <span class="comment">// 键名后面添加一个 []</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	values = [val] <span class="comment">// 赋值给 values</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>value</em> 为 <em>Data</em> | <em>字符串</em> | <em>对象</em></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215112025.png" alt="image-20250210215112025" style="zoom:50%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215135428.png" alt="image-20250210215135428" style="zoom:50%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215027145.png" alt="image-20250210215027145" style="zoom:50%;" />

<p>helpers&#x2F;util.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isDate</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Date</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> toString.<span class="title function_">call</span>(val) === <span class="string">&#x27;[object Date]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isObject</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Object</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> val !== <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">&#x27;object&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再回来</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isDate, isObject &#125; <span class="keyword">from</span> <span class="string">&#x27;./util&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encode</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(val)</span><br><span class="line">		.<span class="title function_">replace</span>(<span class="regexp">/%40/g</span>, <span class="string">&#x27;@&#x27;</span>)</span><br><span class="line">		.<span class="title function_">replace</span>(<span class="regexp">/%3A/gi</span>, <span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">		.<span class="title function_">replace</span>(<span class="regexp">/%24/g</span>, <span class="string">&#x27;$&#x27;</span>)</span><br><span class="line">		.<span class="title function_">replace</span>(<span class="regexp">/%2C/gi</span>, <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">		.<span class="title function_">replace</span>(<span class="regexp">/%20/g</span>, <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">		.<span class="title function_">replace</span>(<span class="regexp">/%5B/gi</span>, <span class="string">&#x27;[&#x27;</span>)</span><br><span class="line">		.<span class="title function_">replace</span>(<span class="regexp">/%5D/gi</span>, <span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">values.<span class="title function_">forEach</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 遍历 values</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_">isDate</span>(val)) &#123;</span><br><span class="line">		<span class="comment">// value 为日期</span></span><br><span class="line">		val = val.<span class="title function_">toISOString</span>() <span class="comment">// 转换为 ISO 格式赋值给 val</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isObject</span>(val)) &#123;</span><br><span class="line">		<span class="comment">// value 为对象</span></span><br><span class="line">		val = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(val) <span class="comment">// 转换为字符串赋值给 val</span></span><br><span class="line">	&#125;</span><br><span class="line">	parts.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;encode(key)&#125;</span>=<span class="subst">$&#123;encode(val)&#125;</span>`</span>) <span class="comment">// 特殊字符转码赋值给 parts</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>拼装成 URL</p>
<blockquote>
<p>parts.join(‘&amp;’) 效果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;[<span class="string">&#x27;name=John&#x27;</span>, <span class="string">&#x27;age=30&#x27;</span>, <span class="string">&#x27;hobbies[]=reading&#x27;</span>, <span class="string">&#x27;hobbies[]=coding&#x27;</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;name=John&amp;age=30&amp;hobbies[]=reading&amp;hobbies[]=coding&#x27;</span></span><br></pre></td></tr></table></figure></blockquote>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215213939.png" alt="image-20250210215213939" style="zoom:50%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215227134.png" alt="image-20250210215227134" style="zoom:50%;" />

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> serializedParams = parts.<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>) <span class="comment">// 将 parts 数组中的所有元素连接成一个字符串，并使用 &amp; 作为分隔符</span></span><br><span class="line"><span class="keyword">if</span> (serializedParams) &#123;</span><br><span class="line">	<span class="comment">// 如果 serializedParams 不为空 则拼接 url</span></span><br><span class="line">	<span class="keyword">const</span> markIndex = url.<span class="title function_">indexOf</span>(<span class="string">&#x27;#&#x27;</span>) <span class="comment">// 查找 URL 中是否存在 # 符号 返回 # 符号在 URL 中的位置索引</span></span><br><span class="line">	<span class="keyword">if</span> (markIndex !== -<span class="number">1</span>) &#123;</span><br><span class="line">		url = url.<span class="title function_">slice</span>(<span class="number">0</span>, markIndex) <span class="comment">// 使用slice方法将URL截取到哈希部分之前，从而去除哈希部分</span></span><br><span class="line">	&#125;</span><br><span class="line">	url += (url.<span class="title function_">indexOf</span>(<span class="string">&#x27;?&#x27;</span>) === -<span class="number">1</span> ? <span class="string">&#x27;?&#x27;</span> : <span class="string">&#x27;&amp;&#x27;</span>) + serializedParams <span class="comment">// 确保URL中的查询参数?存在</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="处理-body-数据"><a href="#处理-body-数据" class="headerlink" title="处理 body 数据"></a>处理 body 数据</h3><p>helpers&#x2F;util.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isDate</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Date</span> &#123;</span><br><span class="line">	<span class="comment">// 判断是否为日期</span></span><br><span class="line">	<span class="keyword">return</span> toString.<span class="title function_">call</span>(val) === <span class="string">&#x27;[object Date]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// export function isObject(val: any): val is Object &#123;  // 判断是否为对象</span></span><br><span class="line"><span class="comment">//   return val !== null &amp;&amp; typeof val === &#x27;object&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isPlainObject</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Object</span> &#123;</span><br><span class="line">	<span class="comment">// 判断是否为普通对象</span></span><br><span class="line">	<span class="keyword">return</span> toString.<span class="title function_">call</span>(val) === <span class="string">&#x27;[object Object]&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>helpers&#x2F;data.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isPlainObject &#125; <span class="keyword">from</span> <span class="string">&#x27;./util&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">transformRequest</span>(<span class="params"><span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(data)) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 config</span></span><br><span class="line">	config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">	config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformURL</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 url 返回拼接后的 url</span></span><br><span class="line">	<span class="keyword">const</span> &#123; url, params &#125; = config</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">bulidURL</span>(url, params)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformRequestData</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 data</span></span><br><span class="line">	config.<span class="property">data</span> = <span class="title function_">transformRequest</span>(config.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="处理-header"><a href="#处理-header" class="headerlink" title="处理 header"></a>处理 header</h3><blockquote>
<p>headers 一般传递诸如认证信息、内容类型等元数据给服务器</p>
</blockquote>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250212030911535.png" alt="image-20250212030911535" style="zoom:50%;" />

<p>helpers&#x2F;header.ts</p>
<blockquote>
<p>处理 headers</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">processHeaders</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>, <span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">	<span class="comment">// processHeaders 函数接收 headers 和 data 两个参数</span></span><br><span class="line">	<span class="title function_">normalizeHeaderName</span>(headers, <span class="string">&#x27;Content-Type&#x27;</span>) <span class="comment">// 调用 normalizeHeaderName 函数将 headers 的 Content-Type 属性名规范化</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(data)) &#123;</span><br><span class="line">		<span class="comment">// 如果 data 是一个普通对象</span></span><br><span class="line">		<span class="keyword">if</span> (headers &amp;&amp; !headers[<span class="string">&#x27;Content-Type&#x27;</span>]) &#123;</span><br><span class="line">			<span class="comment">// 如果 headers 不存在 Content-Type 属性</span></span><br><span class="line">			headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json;charset=utf-8&#x27;</span> <span class="comment">// 设置 Content-Type 属性为 application/json;charset=utf-8</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>Content-Type</code> 是 HTTP 请求头的一部分，用于指示实体主体（即请求或响应的正文部分）的数据类型。它告诉接收方如何解析接收到的数据。例如，当发送 JSON 格式的数据时，通常会将 <code>Content-Type</code> 设置为 <code>application/json</code>，这样接收方就知道应该以 JSON 的形式来解析数据</p>
</blockquote>
<p>辅助函数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeHeaderName</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>, <span class="attr">normalizedName</span>: <span class="built_in">string</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="comment">// normalizeHeaderName 函数接收 headers 和 normalizedName 两个参数</span></span><br><span class="line">	<span class="keyword">if</span> (!headers) &#123;</span><br><span class="line">		<span class="comment">// 如果 headers 不存在</span></span><br><span class="line">		<span class="keyword">return</span> <span class="comment">// 直接返回</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">// 遍历 headers 的所有属性</span></span><br><span class="line">		<span class="keyword">if</span> (</span><br><span class="line">			name !== normalizedName &amp;&amp;</span><br><span class="line">			name.<span class="title function_">toUpperCase</span>() === normalizedName.<span class="title function_">toUpperCase</span>()</span><br><span class="line">		) &#123;</span><br><span class="line">			<span class="comment">// 如果属性名不等于 normalizedName 并且属性名的大写形式等于 normalizedName 的大写形式</span></span><br><span class="line">			headers[normalizedName] = headers[name] <span class="comment">// 将 headers 的属性名设置为 normalizedName (content-type -&gt; Content-Type)</span></span><br><span class="line">			<span class="keyword">delete</span> headers[name] <span class="comment">// 删除 headers 的属性名</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">return</span> headers <span class="comment">// 返回 headers</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>types&#x2F;index.ts 加入 headers</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line">	<span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line">	<span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line">	<span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.ts 增添处理逻辑</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 config</span></span><br><span class="line">	config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">	config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// 先处理 headers</span></span><br><span class="line">	config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// 再处理 data</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformHeaders</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 headers 调用 processHeaders 方法</span></span><br><span class="line">	<span class="keyword">const</span> &#123; headers = &#123;&#125;, data &#125; = config</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">processHeaders</span>(headers, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xhr.ts 添加 header 处理逻辑</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">xhr</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> &#123; data = <span class="literal">null</span>, url, method = <span class="string">&#x27;get&#x27;</span>, headers &#125; = config <span class="comment">// 添加header解构</span></span><br><span class="line">	<span class="keyword">const</span> request = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>() <span class="comment">// 实例化一个 XMLHttpRequest 对象 并赋值给 request 变量</span></span><br><span class="line">	request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">	<span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">// 遍历 headers 的所有属性</span></span><br><span class="line">		<span class="keyword">if</span> (data === <span class="literal">null</span> &amp;&amp; name.<span class="title function_">toLowerCase</span>() === <span class="string">&#x27;content-type&#x27;</span>) &#123;</span><br><span class="line">			<span class="comment">// 如果 data 为 null 并且属性名为 content-type</span></span><br><span class="line">			<span class="keyword">delete</span> headers[name] <span class="comment">// 删除 headers 的属性名</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			request.<span class="title function_">setRequestHeader</span>(name, headers[name]) <span class="comment">// 调用 setRequestHeader 方法 并传入 name headers[name] 两个参数 并赋值给 request 变量</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	request.<span class="title function_">send</span>(data) <span class="comment">// 调用 send 方法 并传入 data 参数 并赋值给 request 变量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><blockquote>
<p>这部分处理实现了</p>
<p>为 Content-Type 自动添加 application&#x2F;json;charset&#x3D;UTF-8（告知服务端解析的是 JSON 数据）</p>
</blockquote>
<h3 id="获取处理-response"><a href="#获取处理-response" class="headerlink" title="获取处理 response"></a>获取处理 response</h3><p>types &#x2F; index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line">	<span class="comment">//config接口</span></span><br><span class="line">	<span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line">	<span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line">	<span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">responseType</span>?: <span class="title class_">XMLHttpRequestResponseType</span> <span class="comment">//新增</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line">	<span class="comment">//response接口</span></span><br><span class="line">	<span class="attr">data</span>: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">status</span>: <span class="built_in">number</span></span><br><span class="line">	<span class="attr">statusText</span>: <span class="built_in">string</span></span><br><span class="line">	<span class="attr">headers</span>: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">	<span class="attr">request</span>: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosPromise</span> <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;<span class="title class_">AxiosResponse</span>&gt; &#123;</span><br><span class="line">	<span class="comment">//promise接口</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xhr.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">xhr</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// xhr 函数接收一个 config 参数</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> <span class="comment">// 返回一个 Promise 对象 并传入 resolve reject 两个参数</span></span><br><span class="line">    <span class="keyword">const</span> &#123; data = <span class="literal">null</span>, url, method = <span class="string">&#x27;get&#x27;</span>, headers, responseType &#125; = config <span class="comment">// 解构赋值拿到变量</span></span><br><span class="line">    <span class="keyword">const</span> request = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>() <span class="comment">// 实例化一个 XMLHttpRequest 对象 并赋值给 request 变量</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (responseType) &#123;</span><br><span class="line">      request.<span class="property">responseType</span> = responseType</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url, <span class="literal">true</span>) <span class="comment">// 调用 open 方法 并传入 method url true 三个参数 并将 method 转换为大写并赋值给 method,url. async:true异步</span></span><br><span class="line"></span><br><span class="line">    request.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> <span class="title function_">handleLoad</span>(<span class="params"></span>) &#123;<span class="comment">// 调用 onreadystatechange 方法 并传入 handleLoad 函数 并赋值给 request 变量</span></span><br><span class="line">      <span class="keyword">if</span> (request.<span class="property">readyState</span> !== <span class="number">4</span>) &#123;<span class="comment">// 4状态为正确接收到数据 (// 没有收到正确的响应)</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> responseHeaders = request.<span class="title function_">getAllResponseHeaders</span>() <span class="comment">// 调用 getAllResponseHeaders 方法 并赋值给 responseHeaders 变量（后面要处理这个字符串）</span></span><br><span class="line">      <span class="keyword">const</span> responseData = responseType &amp;&amp; responseType !== <span class="string">&#x27;text&#x27;</span> ? request.<span class="property">response</span> : request.<span class="property">responseText</span> <span class="comment">// 调用 responseText 方法 并赋值给 responseData 变量</span></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">response</span>: <span class="title class_">AxiosResponse</span> = &#123;</span><br><span class="line">        <span class="attr">data</span>: responseData,</span><br><span class="line">        <span class="attr">status</span>: request.<span class="property">status</span>,</span><br><span class="line">        <span class="attr">statusText</span>: request.<span class="property">statusText</span>,</span><br><span class="line">        <span class="attr">headers</span>: responseHeaders,</span><br><span class="line">        config,</span><br><span class="line">        request</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">resolve</span>(response) <span class="comment">// 调用 resolve 方法 并传入 response 参数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function"><span class="params">name</span> =&gt;</span> &#123;<span class="comment">// 遍历 headers 的所有属性</span></span><br><span class="line">      <span class="keyword">if</span> (data === <span class="literal">null</span> &amp;&amp; name.<span class="title function_">toLowerCase</span>() === <span class="string">&#x27;content-type&#x27;</span>) &#123;<span class="comment">// 如果 data 为 null 并且属性名为 content-type</span></span><br><span class="line">        <span class="keyword">delete</span> headers[name] <span class="comment">// 删除 headers 的属性名</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        request.<span class="title function_">setRequestHeader</span>(name, headers[name]) <span class="comment">// 调用 setRequestHeader 方法 并传入 name headers[name] 两个参数 并赋值给 request 变量</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    request.<span class="title function_">send</span>(data) <span class="comment">// 调用 send 方法 并传入 data 参数 并赋值给 request 变量</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">axios</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line">	<span class="comment">// axios 函数接收一个 config 参数</span></span><br><span class="line">	<span class="title function_">processConfig</span>(config)</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">xhr</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>getAllResponseHeaders</code>方法处理</p>
<p>XMLHttpRequest 对象的 getAllResponseHeaders 方法获取到的值是如下字符串</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">date<span class="punctuation">:</span>Fri<span class="punctuation">,</span><span class="number">05</span> Apr <span class="number">2019</span> <span class="number">12</span><span class="punctuation">:</span><span class="number">40</span><span class="punctuation">:</span><span class="number">49</span> GMT</span><br><span class="line">etag<span class="punctuation">:</span> W/<span class="string">&quot;d-Ssxx4FRxEutDLwo2+xkkxKc4y0k&#x27;&#x27;</span></span><br><span class="line"><span class="string">connection: keep-alive</span></span><br><span class="line"><span class="string">x-powered-by: Express</span></span><br><span class="line"><span class="string">content-length:13</span></span><br><span class="line"><span class="string">content-type:application/json;charset=utf-8</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>每一行都是以回车和换行符<code>\r\n</code>结束，是每个 header 属性的分隔符</p>
</blockquote>
<p>而我们希望解析成的对象结构</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    date<span class="punctuation">:</span>Fri<span class="punctuation">,</span><span class="number">05</span> Apr <span class="number">2019</span> <span class="number">12</span><span class="punctuation">:</span><span class="number">40</span><span class="punctuation">:</span><span class="number">49</span> GMT</span><br><span class="line">	etag<span class="punctuation">:</span> W/<span class="string">&quot;d-Ssxx4FRxEutDLwo2+xkkxKc4y0k&#x27;&#x27;,</span></span><br><span class="line"><span class="string">	connection: keep-alive,</span></span><br><span class="line"><span class="string">	x-powered-by: Express,</span></span><br><span class="line"><span class="string">	content-length:13</span></span><br><span class="line"><span class="string">	content-type:application/json;charset=utf-8</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>headers.ts 新增 parseHeaders 方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">parseHeaders</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">string</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">	<span class="comment">// parseHeaders 函数接收 headers 参数</span></span><br><span class="line">	<span class="keyword">let</span> parsed = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>) <span class="comment">// 创建一个空对象</span></span><br><span class="line">	<span class="keyword">if</span> (!headers) &#123;</span><br><span class="line">		<span class="comment">// 如果 headers 不存在</span></span><br><span class="line">		<span class="keyword">return</span> parsed <span class="comment">// 返回 parsed</span></span><br><span class="line">	&#125;</span><br><span class="line">	headers.<span class="title function_">split</span>(<span class="string">&#x27;\r\n&#x27;</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">line</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">// 遍历 headers 的每一行</span></span><br><span class="line">		<span class="keyword">let</span> [key, val] = line.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>) <span class="comment">// 分割每一行的 key 和 val</span></span><br><span class="line">		key = key.<span class="title function_">trim</span>().<span class="title function_">toLowerCase</span>() <span class="comment">// 去掉 key 的空格并将 key 转换为小写</span></span><br><span class="line">		<span class="keyword">if</span> (!key) &#123;</span><br><span class="line">			<span class="comment">// 如果 key 不存在</span></span><br><span class="line">			<span class="keyword">return</span> <span class="comment">// 直接返回</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (val) &#123;</span><br><span class="line">			<span class="comment">// 如果 val 存在</span></span><br><span class="line">			val = val.<span class="title function_">trim</span>() <span class="comment">// 去掉 val 的空格</span></span><br><span class="line">		&#125;</span><br><span class="line">		parsed[key] = val <span class="comment">// 将 key 和 val 赋值给 parsed</span></span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">return</span> parsed <span class="comment">// 返回 parsed</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="处理响应-data"><a href="#处理响应-data" class="headerlink" title="处理响应 data"></a>处理响应 data</h3><p>不设置 responseType 情况下，服务端返回数据是字符串类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data: &quot;&#123;&quot;a&quot;:1,&quot;b&quot;:2&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>我们要转成对象</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data<span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    a<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    b<span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>data.ts 新增 transformResponse 转化函数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">transformResponse</span>(<span class="params"><span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">typeof</span> data === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">		&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">			<span class="comment">// do nothing</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.ts 处理 axios</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/data&#x27;</span> <span class="comment">// 新增引入转化函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">axios</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line">	<span class="title function_">processConfig</span>(config)</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">xhr</span>(config).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">//请求结束后对 response data 进行处理</span></span><br><span class="line">		<span class="keyword">return</span> <span class="title function_">transformResponseData</span>(res)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformResponseData</span>(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>): <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 response data</span></span><br><span class="line">	res.<span class="property">data</span> = <span class="title function_">transformResponse</span>(res.<span class="property">data</span>)</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/// 基础核心功能至此已全部实现 ///</span><br></pre></td></tr></table></figure>

<h2 id="错误处理-reject-拒回"><a href="#错误处理-reject-拒回" class="headerlink" title="错误处理(reject 拒回)"></a>错误处理(reject 拒回)</h2><h3 id="处理网络错误"><a href="#处理网络错误" class="headerlink" title="处理网络错误"></a>处理网络错误</h3><p>网络不通时发送请求会触发 XMLHttpRequest 对象实例的 error 事件，所以我们可以在 onerror 事件回调函数中捕获此类错误</p>
<p>xhr.ts 中添加</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onerror</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="comment">// 调用 onerror 方法 并传入 handleError 函数 并赋值给 request 变量</span></span><br><span class="line">	<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Network Error&#x27;</span>)) <span class="comment">// 调用 reject 方法 并传入 Network Error 参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="处理超时错误"><a href="#处理超时错误" class="headerlink" title="处理超时错误"></a>处理超时错误</h3><p>设置一个 timeout，当请求超过某个时间后没收到响应则终止，并触发 timeout 事件</p>
<blockquote>
<p>默认超时时间为 0（永不超时，我们首先需要允许程序可配置超时时间</p>
</blockquote>
<p>type &#x2F; index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line">	<span class="comment">//config接口</span></span><br><span class="line">	<span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line">	<span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line">	<span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">responseType</span>?: <span class="title class_">XMLHttpRequestResponseType</span></span><br><span class="line">	<span class="attr">timeout</span>?: <span class="built_in">number</span> <span class="comment">// 新增timeout</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xhr.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">	data = <span class="literal">null</span>,</span><br><span class="line">	url,</span><br><span class="line">	method = <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">	headers,</span><br><span class="line">	responseType,</span><br><span class="line">	timeout,</span><br><span class="line">&#125; = config <span class="comment">// 新增解构</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增逻辑</span></span><br><span class="line"><span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">	<span class="comment">// 如果 timeout 存在</span></span><br><span class="line">	request.<span class="property">timeout</span> = timeout</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request.<span class="property">ontimeout</span> = <span class="keyword">function</span> <span class="title function_">handleTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Timeout of <span class="subst">$&#123;timeout&#125;</span> ms exceeded`</span>)) <span class="comment">// 超过 $&#123;timeout&#125; 毫秒 超时</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="状态码处理-200-错误"><a href="#状态码处理-200-错误" class="headerlink" title="状态码处理(!200 错误)"></a>状态码处理(!200 错误)</h3><blockquote>
<p>处理时机：接收到响应的时候</p>
</blockquote>
<p>xhr.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> <span class="title function_">handleLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> (request.<span class="property">readyState</span> !== <span class="number">4</span>) &#123;</span><br><span class="line">		<span class="comment">// 没有收到正确的响应</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//也就是在这里//</span></span><br><span class="line">	<span class="keyword">if</span> (request.<span class="property">status</span> === <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="comment">// 如果发送网络错误 || 超时错误</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="title function_">resolve</span>(response) <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="comment">// 传入处理 response 参数</span></span><br><span class="line">	<span class="keyword">if</span> (response.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; response.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line">		<span class="comment">// 状态码 大于等于 200 并且小于 300</span></span><br><span class="line">		<span class="title function_">resolve</span>(response) <span class="comment">// 调用 resolve 方法 并传入 response 参数</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Request failed with status code <span class="subst">$&#123;response.status&#125;</span>`</span>)) <span class="comment">// 报错状态码</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="错误信息增强"><a href="#错误信息增强" class="headerlink" title="错误信息增强"></a>错误信息增强</h3><blockquote>
<p>按照之前的操作，我们实现了对基础错误信息的处理，但我们对外提供的错误信息是十分有限的</p>
<p>我们希望对外提供的错误信息包括</p>
<p>错误文本信息（报错显示）</p>
<p>请求对象配置 config</p>
<p>错误代码 code</p>
<p>XMLHttpRequest 对象实例 request</p>
<p>自定义响应对象 response</p>
</blockquote>
<h4 id="创建-AxiosError-类"><a href="#创建-AxiosError-类" class="headerlink" title="创建 AxiosError 类"></a>创建 AxiosError 类</h4><p>types &#x2F; index.ts 定义接口</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosError</span> <span class="keyword">extends</span> <span class="title class_">Error</span> &#123;</span><br><span class="line">	<span class="comment">//error接口</span></span><br><span class="line">	<span class="attr">isAxiosError</span>: <span class="built_in">boolean</span></span><br><span class="line">	<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">	<span class="attr">code</span>?: <span class="built_in">string</span></span><br><span class="line">	<span class="attr">request</span>?: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建 helpers &#x2F; error.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AxiosError</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">	<span class="comment">// 定义一个AxiosError类继承Error类 实现AxiosError接口 并设置 isAxiosError为true</span></span><br><span class="line">	<span class="attr">isAxiosError</span>: <span class="built_in">boolean</span></span><br><span class="line">	<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">	<span class="attr">code</span>?: <span class="built_in">string</span> | <span class="literal">null</span></span><br><span class="line">	<span class="attr">request</span>?: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span><br><span class="line"></span><br><span class="line">	<span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">		<span class="comment">//构造函数 接收五个参数赋值给对应的属性 并设置 isAxiosError为true</span></span></span><br><span class="line"><span class="params">		<span class="attr">message</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">		<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>,</span></span><br><span class="line"><span class="params">		<span class="attr">code</span>?: <span class="built_in">string</span> | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">		<span class="attr">request</span>?: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params">		<span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span></span><br><span class="line"><span class="params">	</span>) &#123;</span><br><span class="line">		<span class="variable language_">super</span>(message) <span class="comment">//调用父类的构造函数 传入message参数赋值给message属性</span></span><br><span class="line"></span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">config</span> = config</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">code</span> = code</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">request</span> = request</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">response</span> = response</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">isAxiosError</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">		<span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="variable language_">this</span>, <span class="title class_">AxiosError</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// 修复原型链问题</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createError</span>(<span class="params"> <span class="comment">//定义一个createError函数 接收五个参数 并返回一个AxiosError对象</span></span></span><br><span class="line"><span class="params">	<span class="attr">message</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">	<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>,</span></span><br><span class="line"><span class="params">	<span class="attr">code</span>?: <span class="built_in">string</span> | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">	<span class="attr">request</span>?: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params">	<span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> error = <span class="keyword">new</span> <span class="title class_">AxiosError</span>(message, config, code, request, response)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="createError-方法应用"><a href="#createError-方法应用" class="headerlink" title="createError 方法应用"></a>createError 方法应用</h4><blockquote>
<p>对错误对象创建的逻辑进行修改</p>
</blockquote>
<p>xhr.ts</p>
<p><strong><em>onerror 修改</em></strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onerror</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Network Error&#x27;</span>)) <span class="comment">// 调用 reject 方法 并传入 Network Error 参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>替换为</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onerror</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="title function_">reject</span>(<span class="title function_">createError</span>(<span class="string">&#x27;Network Error&#x27;</span>, config, <span class="literal">null</span>, request)) <span class="comment">// 传入 &#x27;Network Error&#x27;,config,null,request 参数（事件触发时拿不到response就不传了） 调用 createError 方法并传入参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>ontimeout 修改</em></strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">ontimeout</span> = <span class="keyword">function</span> <span class="title function_">handleTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="comment">// 调用 ontimeout 方法 并传入 handleTimeout 函数 并赋值给 request 变量</span></span><br><span class="line">	<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Timeout of <span class="subst">$&#123;timeout&#125;</span> ms exceeded`</span>)) <span class="comment">// 调用 reject 方法 并传入 Timeout of $&#123;timeout&#125; ms exceeded 参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>替换为</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">ontimeout</span> = <span class="keyword">function</span> <span class="title function_">handleTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="comment">// 调用 ontimeout 方法 并传入 handleTimeout 函数 并赋值给 request 变量</span></span><br><span class="line">	<span class="title function_">reject</span>(</span><br><span class="line">		<span class="title function_">createError</span>(</span><br><span class="line">			<span class="string">`Timeout of <span class="subst">$&#123;timeout&#125;</span> ms exceeded`</span>,</span><br><span class="line">			config,</span><br><span class="line">			<span class="string">&#x27;ECONNABORTED&#x27;</span>,</span><br><span class="line">			request</span><br><span class="line">		)</span><br><span class="line">	) <span class="comment">// 传入 `Timeout of $&#123;timeout&#125; ms exceeded`,config,&#x27;ECONNABORTED&#x27;,request 参数 调用 createError 方法 并传入参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>handleResponse 修改</em></strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="comment">// 传入处理 response 参数</span></span><br><span class="line">	<span class="keyword">if</span> (response.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; response.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line">		<span class="comment">// 状态码 大于等于 200 并且小于 300</span></span><br><span class="line">		<span class="title function_">resolve</span>(response) <span class="comment">// 调用 resolve 方法 并传入 response 参数</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Request failed with status code <span class="subst">$&#123;response.status&#125;</span>`</span>)) <span class="comment">// 调用 reject 方法 并传入 Request failed with status code $&#123;response.status&#125; 参数</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>替换为</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="comment">// 传入处理 response 参数</span></span><br><span class="line">	<span class="keyword">if</span> (response.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; response.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line">		<span class="comment">// 状态码 大于等于 200 并且小于 300</span></span><br><span class="line">		<span class="title function_">resolve</span>(response) <span class="comment">// 调用 resolve 方法 并传入 response 参数</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="title function_">reject</span>(</span><br><span class="line">			<span class="title function_">createError</span>(</span><br><span class="line">				<span class="string">`Request failed with status code <span class="subst">$&#123;response.status&#125;</span>`</span>,</span><br><span class="line">				config,</span><br><span class="line">				<span class="literal">null</span>,</span><br><span class="line">				request,</span><br><span class="line">				response</span><br><span class="line">			)</span><br><span class="line">		) <span class="comment">// 传入 `Request failed with status code $&#123;response.status&#125;`,config,null,request,response 参数 调用 createError 方法 并传入参数</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="接口扩展"><a href="#接口扩展" class="headerlink" title="接口扩展"></a>接口扩展</h2><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><blockquote>
<p>为了用户更加方便地使用 axios 发送请求，我们可以为所有支持的请求方法扩展一些接口</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//[可选项]</span></span><br><span class="line">axios.<span class="property">request</span>	(config)</span><br><span class="line">axios.<span class="property">get</span>		(url[,config])</span><br><span class="line">axios.<span class="property">delete</span>	(url[,config])</span><br><span class="line">axios.<span class="property">head</span>		(url[,config])</span><br><span class="line">axios.<span class="property">options</span>	(url[,config])</span><br><span class="line">axios.<span class="property">post</span>		(url[,datal,config])</span><br><span class="line">axios.<span class="property">put</span>		(url[,datal,config])</span><br><span class="line">axios.<span class="property">patch</span>		(url[,datal,config])</span><br></pre></td></tr></table></figure>

<p>types &#x2F; index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">	<span class="comment">//axios接口</span></span><br><span class="line">	<span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">	<span class="title function_">get</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">	<span class="title function_">delete</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">	<span class="title function_">head</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">	<span class="title function_">options</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">	<span class="title function_">post</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: <span class="built_in">any</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">	<span class="title function_">put</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: <span class="built_in">any</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">	<span class="title function_">patch</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: <span class="built_in">any</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInstance</span> <span class="keyword">extends</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">	<span class="comment">//axios实例接口 既有函数类型又有属性接口</span></span><br><span class="line">	(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建-Axios-ts"><a href="#创建-Axios-ts" class="headerlink" title="创建 Axios.ts"></a>创建 Axios.ts</h3><blockquote>
<p>存放一些发送请求核心代码</p>
</blockquote>
<p>core &#x2F; Axios.ts &#x2F;&#x2F;大写表示是一个类</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">	<span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line">		<span class="comment">// 实现request方法</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>core &#x2F; dispatchRequest.ts</p>
<blockquote>
<p>封装 axios.ts 核心代码</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> xhr <span class="keyword">from</span> <span class="string">&#x27;../xhr&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; bulidURL &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/url&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; processHeaders &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/header&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">dispatchRequest</span>(<span class="params"></span></span><br><span class="line"><span class="params">	<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line">	<span class="comment">// dispatchRequest 函数接收一个 config 参数</span></span><br><span class="line">	<span class="title function_">processConfig</span>(config)</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">xhr</span>(config).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">//请求结束后对 response data 进行处理</span></span><br><span class="line">		<span class="keyword">return</span> <span class="title function_">transformResponseData</span>(res)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 config</span></span><br><span class="line">	config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">	config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// 先处理 headers</span></span><br><span class="line">	config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// 再处理 data</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformURL</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 url 返回拼接后的 url</span></span><br><span class="line">	<span class="keyword">const</span> &#123; url, params &#125; = config</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">bulidURL</span>(url, params)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformRequestData</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 data 调用 transformRequest 方法</span></span><br><span class="line">	config.<span class="property">data</span> = <span class="title function_">transformRequest</span>(config.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformHeaders</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 headers 调用 processHeaders 方法</span></span><br><span class="line">	<span class="keyword">const</span> &#123; headers = &#123;&#125;, data &#125; = config</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">processHeaders</span>(headers, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformResponseData</span>(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>): <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 response data</span></span><br><span class="line">	res.<span class="property">data</span> = <span class="title function_">transformResponse</span>(res.<span class="property">data</span>)</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>然后将 xhr.ts 移入 core 文件夹（xhr 也作为核心模块）</p>
</blockquote>
<p><strong>部分报错修改</strong> (严格模式)</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//dispatchRequest.ts</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">bulidURL</span>(url!, params)</span><br><span class="line"></span><br><span class="line"><span class="comment">//xht.ts</span></span><br><span class="line">request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url!, <span class="literal">true</span>) <span class="comment">// 调用 open 方法传入 method url true 三个参数 并将 method 转换为大写并赋值给 method,url. async:true异步</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips： 断言（ ! ）</p>
<blockquote>
<p>TS 中，当你保证某个变量不会为 <code>null</code> 或者 <code>undefined</code>，但编译器却无法推断出来的时候，就可以使用非空断言操作符 ( ! )，不会在运行时进行检查，但要是你做出了错误的保证，在运行时就可能会出现错误。</p>
</blockquote>
</blockquote>
<h3 id="实现-Axios-类中接口"><a href="#实现-Axios-类中接口" class="headerlink" title="实现 Axios 类中接口"></a>实现 Axios 类中接口</h3><p><code>Axios.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> dispatchRequest <span class="keyword">from</span> <span class="string">&#x27;./dispatchRequest&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">  <span class="title function_">request</span>(...)</span><br><span class="line">  <span class="title function_">get</span>(...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现 <strong><em>request</em></strong> 接口</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入config参数 并返回AxiosPromise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong><em>逻辑封装</em></strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">_requestMethodWithoutData</span>(</span><br><span class="line">    <span class="attr">method</span>: <span class="title class_">Method</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line">    <span class="comment">// 封装_requestMethodWithoutData方法传入method,url和config参数 并返回AxiosPromise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="title class_">Object</span>.<span class="title function_">assign</span>(config || &#123;&#125;, &#123; method, url &#125;)) <span class="comment">// 调用request方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote>
<p>实现 <strong><em>get</em></strong> 接口</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">get</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;get&#x27;</span>, url, config) <span class="comment">// 调用方法 传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现 <strong><em>delete</em></strong> 接口</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">delete</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;delete&#x27;</span>, url, config) <span class="comment">// 调用方法 传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现 <strong><em>head</em></strong> 接口</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">head</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;head&#x27;</span>, url, config) <span class="comment">// 调用方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现 <strong><em>options</em></strong> 接口</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">options</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;options&#x27;</span>, url, config) <span class="comment">// 调用方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong><em>逻辑封装</em></strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">_requestMethodWithData</span>(</span><br><span class="line">    <span class="attr">method</span>: <span class="title class_">Method</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">data</span>?: <span class="built_in">any</span>,</span><br><span class="line">    <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line">    <span class="comment">// 封装_requestMethodWithData方法传入method,url,data和config参数 并返回AxiosPromise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="title class_">Object</span>.<span class="title function_">assign</span>(config || &#123;&#125;, &#123; method, url, data &#125;)) <span class="comment">// 调用request方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote>
<p>实现 <strong><em>post</em></strong> 接口</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">head</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url,data和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithData</span>(<span class="string">&#x27;post&#x27;</span>, url, data, config) <span class="comment">// 调用方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现 <strong><em>put</em></strong> 接口</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">put</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url,data和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithData</span>(<span class="string">&#x27;put&#x27;</span>, url, data, config) <span class="comment">// 调用方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现 <strong><em>patch</em></strong> 接口</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">patch</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url,data和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithData</span>(<span class="string">&#x27;patch&#x27;</span>, url, data, config) <span class="comment">// 调用方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="混合对象实现"><a href="#混合对象实现" class="headerlink" title="混合对象实现"></a>混合对象实现</h3><blockquote>
<p>首先这个对象是函数，其次这个对象包括 Axios 类内所有原型属性和实例属性</p>
</blockquote>
<p>helpers &#x2F; utils</p>
<blockquote>
<p><code>extend</code> 合成函数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例</span></span><br><span class="line"><span class="keyword">const</span> target = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">const</span> source = &#123; <span class="attr">b</span>: <span class="number">2</span> &#125;</span><br><span class="line"><span class="keyword">const</span> result = <span class="title function_">extend</span>(target, source)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result) <span class="comment">// 输出: &#123; a: 1, b: 2 &#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里我们使用**<em>泛型</em>** <code>T</code> 和 <code>U</code></p>
<p><code>T</code> 代表目标对象 <code>to</code> 的类型，<code>U</code> 代表源对象 <code>from</code> 的类型</p>
<p>函数的返回值类型是 <code>T &amp; U</code>，也就是 <code>to</code> 和 <code>from</code> 两个对象类型的交集。</p>
</blockquote>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> extend&lt;T, U&gt;(<span class="attr">to</span>: T, <span class="attr">from</span>: U): T &amp; U &#123;</span><br><span class="line">	<span class="comment">// 合并对象</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="keyword">from</span>) &#123;</span><br><span class="line">		;(to <span class="keyword">as</span> T &amp; U)[key] = <span class="keyword">from</span>[key] <span class="keyword">as</span> <span class="built_in">any</span> <span class="comment">//把 from 对象的属性值赋值给 to 对象对应的属性。这里运用了类型断言 as T &amp; U 和 as any，让 TypeScript 编译器认可这种赋值操作。</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> to <span class="keyword">as</span> T &amp; U <span class="comment">//也用了类型断言 as T &amp; U</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="工厂函数实现"><a href="#工厂函数实现" class="headerlink" title="工厂函数实现"></a>工厂函数实现</h3><p>处理 axios.ts</p>
<blockquote>
<p>删掉内容，只保留 export default axios</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosInstance</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Axios</span> <span class="keyword">from</span> <span class="string">&#x27;./core/Axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/util&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"></span>): <span class="title class_">AxiosInstance</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> context = <span class="keyword">new</span> <span class="title class_">Axios</span>() <span class="comment">//实例化一个 Axios 对象 并赋值给 context 变量</span></span><br><span class="line">	<span class="keyword">const</span> instance = <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span>.<span class="title function_">bind</span>(context) <span class="comment">//调用 request 方法 并传入 context 参数 并赋值给 instance 变量 绑定 this 指向 context</span></span><br><span class="line"></span><br><span class="line">	<span class="title function_">extend</span>(instance, context) <span class="comment">//调用 extend 方法 并传入 instance 和 context 参数 实现 instance 对象继承 context 对象</span></span><br><span class="line">	<span class="keyword">return</span> instance <span class="keyword">as</span> <span class="title class_">AxiosInstance</span> <span class="comment">//返回 instance 对象 并断言为 AxiosInstance 类型</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="title function_">createInstance</span>() <span class="comment">//调用 createInstance 方法 并赋值给 axios 变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure>

<h3 id="axios-函数重载"><a href="#axios-函数重载" class="headerlink" title="axios 函数重载"></a>axios 函数重载</h3><blockquote>
<p>目前我们函数只能存放一个对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">	url: &#x27;/extend/post&#x27;,</span><br><span class="line">	method: &#x27;post&#x27;,</span><br><span class="line">	data:&#123;</span><br><span class="line">		msg:&#x27;hi&#x27;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>那么如果 axios 同时含有两个参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">axios(&#x27;/extend/post&#x27;,&#123;</span><br><span class="line">	method: &#x27;post&#x27;,</span><br><span class="line">	data:&#123;</span><br><span class="line">		msg:&#x27;hi&#x27;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></blockquote>
<p>type &#x2F; index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInstance</span> <span class="keyword">extends</span> <span class="title class_">Axios</span> &#123;<span class="comment">//axios实例接口 既有函数类型又有属性接口</span></span><br><span class="line">  (<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromis</span>) <span class="comment">//(config单参)</span></span><br><span class="line">  (<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> <span class="comment">//添加：函数重载(url+config双参)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>core &#x2F; Axios.ts</p>
<blockquote>
<p>修改 request 方法</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 实现request方法传入config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>改为 👇</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">url</span>: <span class="built_in">any</span>, <span class="attr">config</span>: <span class="built_in">any</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 实现request方法传入url？config？参数</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">&#x27;string&#x27;</span>) &#123; <span class="comment">//url+config双参</span></span><br><span class="line">        <span class="keyword">if</span> (!config) &#123;</span><br><span class="line">            config = &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        config.<span class="property">url</span> = url</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//config单参</span></span><br><span class="line">        config = url <span class="comment">//此时的url就是config</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="响应数据支持泛型"><a href="#响应数据支持泛型" class="headerlink" title="响应数据支持泛型"></a>响应数据支持泛型</h3><blockquote>
<p>通常情况，我们会将后端返回数据格式单独放入一个接口中</p>
</blockquote>
<p>设置泛型，提高类型灵活性</p>
<p>type &#x2F; index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosResponse</span>&lt;T = <span class="built_in">any</span>&gt; &#123; <span class="comment">//response接口</span></span><br><span class="line">    <span class="attr">data</span>: T</span><br><span class="line">    <span class="attr">status</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">statusText</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">headers</span>: <span class="built_in">any</span></span><br><span class="line">    <span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">    <span class="attr">request</span>: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosPromise</span>&lt;T = <span class="built_in">any</span>&gt; <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;<span class="title class_">AxiosResponse</span>&lt;T&gt;&gt; &#123; <span class="comment">//promise接口</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Axios</span> &#123; <span class="comment">//axios接口</span></span><br><span class="line">    request&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt;</span><br><span class="line">    get&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInstance</span> <span class="keyword">extends</span> <span class="title class_">Axios</span> &#123; <span class="comment">//axios实例接口 既有函数类型又有属性接口</span></span><br><span class="line">	&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt;</span><br><span class="line">	&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt; <span class="comment">//函数重载</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="拦截器实现"><a href="#拦截器实现" class="headerlink" title="拦截器实现"></a>拦截器实现</h2><blockquote>
<p>也就是 axios 二次封装中常见的请求拦截器 &amp; 响应拦截器</p>
<p>我们先回顾一下用户 asios 拦截器是怎么写的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>:<span class="string">&#x27;/api</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">instance.interceptors.request.use(res =&gt;&#123;//请求拦截器</span></span><br><span class="line"><span class="string">    console.log(&#x27;</span>res<span class="string">&#x27;,res)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">instance.interceptors.response.use(res =&gt;&#123;//响应拦截器</span></span><br><span class="line"><span class="string">    console.log(&#x27;</span>res<span class="string">&#x27;,res)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default instance</span></span><br></pre></td></tr></table></figure>

<p>Tip：request 是后添加的先执行，response 是先添加的先执行</p>
</blockquote>
<h3 id="拦截器管理类"><a href="#拦截器管理类" class="headerlink" title="拦截器管理类"></a>拦截器管理类</h3><p>types &#x2F; index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInterceptorManager</span>&lt;T&gt; &#123;</span><br><span class="line">	<span class="comment">//拦截器接口</span></span><br><span class="line">	<span class="title function_">use</span>(<span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt;, <span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span>): <span class="built_in">number</span> <span class="comment">//添加拦截器 返回拦截器id</span></span><br><span class="line">	<span class="title function_">eject</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">void</span> <span class="comment">//删除拦截器 返回拦截器id</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ResolvedFn</span>&lt;T = <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">	<span class="comment">//成功拦截器接口</span></span><br><span class="line">	(<span class="attr">val</span>: T): T | <span class="title class_">Promise</span>&lt;T&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">RejectedFn</span> &#123;</span><br><span class="line">	<span class="comment">//失败拦截器接口</span></span><br><span class="line">	(<span class="attr">error</span>: <span class="built_in">any</span>): <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>core &#x2F; interceptorManager.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ResolvedFn</span>, <span class="title class_">RejectedFn</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Interceptor</span>&lt;T&gt; &#123;</span><br><span class="line">	<span class="comment">// 拦截器接口</span></span><br><span class="line">	<span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt;</span><br><span class="line">	<span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">InterceptorManager</span>&lt;T&gt; &#123;</span><br><span class="line">	<span class="comment">// 拦截器管理类</span></span><br><span class="line">	<span class="keyword">private</span> <span class="attr">interceptors</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Interceptor</span>&lt;T&gt;&gt; <span class="comment">// 拦截器数组存放的是拦截器对象 每个对象有两个属性 resolved rejected</span></span><br><span class="line">	<span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">		<span class="comment">// 构造函数 初始化拦截器数组</span></span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">interceptors</span> = [] <span class="comment">// 拦截器数组中存放的是拦截器对象</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="title function_">use</span>(<span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt;, <span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span>): <span class="built_in">number</span> &#123;</span><br><span class="line">		<span class="comment">// 添加拦截器</span></span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">			<span class="comment">// 将拦截器对象添加到拦截器数组中</span></span><br><span class="line">			resolved,</span><br><span class="line">			rejected,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">length</span> - <span class="number">1</span> <span class="comment">// 返回拦截器的id 用于删除拦截器</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="title function_">forEach</span>(<span class="attr">fn</span>: <span class="function">(<span class="params"><span class="attr">interceptor</span>: <span class="title class_">Interceptor</span>&lt;T&gt;</span>) =&gt;</span> <span class="built_in">void</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">		<span class="comment">// 遍历拦截器</span></span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">interceptor</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// 遍历拦截器数组</span></span><br><span class="line">			<span class="keyword">if</span> (interceptor !== <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="comment">// 判断拦截器是否存在</span></span><br><span class="line">				<span class="title function_">fn</span>(interceptor) <span class="comment">// 存在则调用fn函数</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="title function_">eject</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">		<span class="comment">// 删除拦截器 通过id删除拦截器</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">interceptors</span>[id]) &#123;</span><br><span class="line">			<span class="comment">// 判断拦截器是否存在</span></span><br><span class="line">			<span class="variable language_">this</span>.<span class="property">interceptors</span>[id] = <span class="literal">null</span> <span class="comment">// 存在则将拦截器置为null</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="链式调用实现"><a href="#链式调用实现" class="headerlink" title="链式调用实现"></a>链式调用实现</h3><p>core &#x2F; Axios.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>,<span class="title class_">AxiosResponse</span>, <span class="title class_">Method</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">InterceptorManager</span> <span class="keyword">from</span> <span class="string">&#x27;./interceptorManager&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Interceptors</span> &#123;</span><br><span class="line">    <span class="attr">request</span>: <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;</span><br><span class="line">    <span class="attr">response</span>: <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">    <span class="attr">interceptors</span>: <span class="title class_">Interceptors</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">interceptors</span> = &#123; <span class="comment">//用户可以通过axios.interceptors.request.use()添加拦截器</span></span><br><span class="line">            <span class="attr">request</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;(),</span><br><span class="line">            <span class="attr">response</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">request</span>(...)...</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完善 request (实现调用链)</p>
<blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250218152615640.png" alt="image-20250218152615640"></p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>, <span class="title class_">AxiosResponse</span>, <span class="title class_">Method</span>,<span class="title class_">ResolvedFn</span>,<span class="title class_">RejectedFn</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PromiseChain</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt; | (<span class="function">(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>) =&gt;</span> <span class="title class_">AxiosPromise</span>)<span class="comment">//resolved是一个函数类型 接收一个AxiosRequestConfig类型的参数 返回一个AxiosPromise类型的参数</span></span><br><span class="line">    <span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span> <span class="comment">//rejected是一个函数类型 接收一个AxiosRequestConfig类型的参数 返回一个AxiosPromise类型的参数</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="title function_">request</span>(<span class="attr">url</span>: <span class="built_in">any</span>, <span class="attr">config</span>: <span class="built_in">any</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 实现request方法传入参数</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!config) &#123;</span><br><span class="line">            config = &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        config.<span class="property">url</span> = url</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        config = url</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">chain</span>:<span class="title class_">PromiseChain</span>&lt;<span class="built_in">any</span>&gt;[] = [</span><br><span class="line">        &#123;<span class="comment">// 创建一个数组chain</span></span><br><span class="line">            <span class="attr">resolved</span>: dispatchRequest,</span><br><span class="line">            <span class="attr">rejected</span>: <span class="literal">undefined</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">interceptor</span> =&gt;</span> &#123;<span class="comment">// 遍历request拦截器</span></span><br><span class="line">        chain.<span class="title function_">unshift</span>(interceptor) <span class="comment">// 将拦截器添加到chain数组的开头</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">interceptor</span> =&gt;</span> &#123;<span class="comment">// 遍历response拦截器</span></span><br><span class="line">        chain.<span class="title function_">push</span>(interceptor) <span class="comment">// 将拦截器添加到chain数组的末尾</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(config) <span class="comment">// 创建一个promise对象 并传入config参数</span></span><br><span class="line">    <span class="keyword">while</span> (chain.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 遍历chain数组</span></span><br><span class="line">        <span class="keyword">const</span> &#123; resolved, rejected &#125; = chain.<span class="title function_">shift</span>()! <span class="comment">// 取出chain数组的第一个元素</span></span><br><span class="line">              promise = promise.<span class="title function_">then</span>(resolved, rejected) <span class="comment">// 将promise对象的then方法传入resolved和rejected参数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="合并用户配置"><a href="#合并用户配置" class="headerlink" title="合并用户配置"></a>合并用户配置</h2><blockquote>
<p>用户在发送请求时可以传入一个配置来决定请求的不同行为</p>
<p>甚至可以直接修改一些默认配置 (defaults)</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">axios.<span class="property">defaults</span>.<span class="property">headers</span>.<span class="property">common</span>[<span class="string">&#x27;test&#x27;</span>] = <span class="number">123</span> <span class="comment">//默认对任何类型的请求的header都添加test属性</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">headers</span>.<span class="property">post</span>[<span class="string">&#x27;Content-Type&#x27;</span>] =</span><br><span class="line">	<span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span> <span class="comment">//默认对post请求的header都添加Content-Type属性</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">timeout</span> = <span class="number">2000</span></span><br></pre></td></tr></table></figure></blockquote>
<h3 id="默认配置设置"><a href="#默认配置设置" class="headerlink" title="默认配置设置"></a>默认配置设置</h3><p>defaults.ts 配置默认请求</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span> = &#123;</span><br><span class="line">	<span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">	<span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">	<span class="attr">timeout</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">headers</span>: &#123;</span><br><span class="line">		<span class="attr">common</span>: &#123;</span><br><span class="line">			<span class="title class_">Accept</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>, <span class="comment">//通用的请求头 接受的响应类型为json/plain文本*/*表示任意类型 优先级最低</span></span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> methodsNoData = [<span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;head&#x27;</span>, <span class="string">&#x27;options&#x27;</span>]</span><br><span class="line"></span><br><span class="line">methodsNoData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">method</span>) =&gt;</span> &#123;</span><br><span class="line">	defaults.<span class="property">headers</span>[method] = &#123;&#125; <span class="comment">//没有数据的请求头 优先级高于通用的请求头</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> methodsWithData = [<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;put&#x27;</span>, <span class="string">&#x27;patch&#x27;</span>]</span><br><span class="line"></span><br><span class="line">methodsWithData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">method</span>) =&gt;</span> &#123;</span><br><span class="line">	defaults.<span class="property">headers</span>[method] = &#123;</span><br><span class="line">		<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>, <span class="comment">//表单提交的请求头 优先级高于通用的请求头</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defaults</span><br></pre></td></tr></table></figure>

<p>core &#x2F; Axios.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">    <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">    <span class="attr">interceptors</span>: <span class="title class_">Interceptors</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">initConfig</span>?: <span class="title class_">AxiosRequestConfig</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">defaults</span> = initConfig <span class="comment">// 初始化defaults属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">interceptors</span> = &#123;</span><br><span class="line">            <span class="comment">//用户可以通过axios.interceptors.request.use()添加拦截器</span></span><br><span class="line">            <span class="attr">request</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;(),</span><br><span class="line">            <span class="attr">response</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>types &#x2F; index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">    <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span> <span class="comment">//默认配置</span></span><br><span class="line">    <span class="attr">interceptors</span>: &#123; <span class="comment">//拦截器</span></span><br><span class="line">        <span class="attr">request</span>: <span class="title class_">AxiosInterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;</span><br><span class="line">        <span class="attr">response</span>: <span class="title class_">AxiosInterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重写 axios.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosInstance</span>, <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Axios</span> <span class="keyword">from</span> <span class="string">&#x27;./core/Axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/util&#x27;</span></span><br><span class="line"><span class="keyword">import</span> defaults <span class="keyword">from</span> <span class="string">&#x27;./defaults&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosInstance</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> context = <span class="keyword">new</span> <span class="title class_">Axios</span>(config) <span class="comment">//创建一个 Axios 实例 并传入 config 参数 并赋值给 context 变量</span></span><br><span class="line">	<span class="keyword">const</span> instance = <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span>.<span class="title function_">bind</span>(context) <span class="comment">//调用 request 方法 并传入 context 参数 并赋值给 instance 变量 绑定 this 指向 context</span></span><br><span class="line"></span><br><span class="line">	<span class="title function_">extend</span>(instance, context) <span class="comment">//调用 extend 方法 并传入 instance 和 context 参数 实现 instance 对象继承 context 对象</span></span><br><span class="line">	<span class="keyword">return</span> instance <span class="keyword">as</span> <span class="title class_">AxiosInstance</span> <span class="comment">//返回 instance 对象 并断言为 AxiosInstance 类型</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="title function_">createInstance</span>(defaults) <span class="comment">//调用 createInstance 方法 并传入 defaults 参数 并赋值给 axios 变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure>

<h3 id="合并策略实现"><a href="#合并策略实现" class="headerlink" title="合并策略实现"></a>合并策略实现</h3><p>创建 core &#x2F; mergeConfig.ts</p>
<blockquote>
<p><code>config1</code> 为默认配置</p>
<p><code>config2</code> 代表用户传入的自定义配置</p>
<blockquote>
<p>实现示例 (假设 <code>config1</code> 和 <code>config2</code> 如下：)</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config1 = &#123;</span><br><span class="line">	<span class="attr">timeout</span>: <span class="number">1000</span>,</span><br><span class="line">	<span class="attr">headers</span>: &#123;</span><br><span class="line">		<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config2 = &#123;</span><br><span class="line">	<span class="attr">timeout</span>: <span class="number">2000</span>,</span><br><span class="line">	<span class="attr">headers</span>: &#123;</span><br><span class="line">		<span class="title class_">Authorization</span>: <span class="string">&#x27;Bearer token&#x27;</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>合并 <code>timeout</code> 属性时，<code>val1</code> 就是 <code>config1.timeout</code> 的值 <code>1000</code>，<code>val2</code> 就是 <code>config2.timeout</code> 的值 <code>2000</code>。</p>
</blockquote>
</blockquote>
<h4 id="timeout-逻辑"><a href="#timeout-逻辑" class="headerlink" title="timeout 逻辑"></a>timeout 逻辑</h4><p>mergeConfig.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> strats = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>) <span class="comment">//合并策略 key为属性名 value为合并策略函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defaultStrat</span>(<span class="params"><span class="attr">val1</span>: <span class="built_in">any</span>, <span class="attr">val2</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">	<span class="comment">//默认合并策略</span></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">typeof</span> val2 !== <span class="string">&#x27;undefined&#x27;</span> ? val2 : val1 <span class="comment">//优先取val2 如果val2不存在则取val1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fromVal2Strat</span>(<span class="params"><span class="attr">val1</span>: <span class="built_in">any</span>, <span class="attr">val2</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">typeof</span> val2 !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">		<span class="comment">//忽略val1 只取val2</span></span><br><span class="line">		<span class="keyword">return</span> val2</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stratKeysFromVal2 = [<span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;params&#x27;</span>, <span class="string">&#x27;data&#x27;</span>]</span><br><span class="line"></span><br><span class="line">stratKeysFromVal2.<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">//对于url params data属性 只取val2</span></span><br><span class="line">	strats[key] = fromVal2Strat</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">mergeConfig</span>(<span class="params"></span></span><br><span class="line"><span class="params">	<span class="attr">config1</span>: <span class="title class_">AxiosRequestConfig</span>,</span></span><br><span class="line"><span class="params">	<span class="attr">config2</span>?: <span class="title class_">AxiosRequestConfig</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (!config2) &#123;</span><br><span class="line">		config2 = &#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">const</span> config = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>) <span class="comment">//合并后的配置结果</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> config2) &#123;</span><br><span class="line">		<span class="title function_">mergeField</span>(key)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> config1) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!config2[key]) &#123;</span><br><span class="line">			<span class="title function_">mergeField</span>(key)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">mergeField</span>(<span class="params"><span class="attr">key</span>: <span class="built_in">string</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">		<span class="keyword">const</span> strat = strats[key] || defaultStrat <span class="comment">//合并策略</span></span><br><span class="line">		config[key] = <span class="title function_">strat</span>(config1[key], config2![key])</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>types &#x2F; index.ts 添加自动索引</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    [<span class="attr">propName</span>: <span class="built_in">string</span>]: <span class="built_in">any</span> <span class="comment">//字符串自动索引</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="headers-逻辑"><a href="#headers-逻辑" class="headerlink" title="headers 逻辑"></a>headers 逻辑</h4><h5 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepMergeStrat</span>(<span class="params"><span class="attr">val1</span>: <span class="built_in">any</span>, <span class="attr">val2</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(val2)) &#123;</span><br><span class="line">		<span class="comment">//如果val2是对象</span></span><br><span class="line">		<span class="keyword">return</span> <span class="title function_">deepMerge</span>(val1, val2) <span class="comment">//递归合并</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> val2 !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">		<span class="comment">//如果val2不是对象 且val2存在</span></span><br><span class="line">		<span class="keyword">return</span> val2</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(val1)) &#123;</span><br><span class="line">		<span class="comment">//如果val2不是对象 且val2不存在 且val1是对象</span></span><br><span class="line">		<span class="keyword">return</span> <span class="title function_">deepMerge</span>(val1) <span class="comment">//递归合并</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> val1 !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">		<span class="comment">//如果val2不是对象 且val2不存在 且val1不是对象 且val1存在</span></span><br><span class="line">		<span class="keyword">return</span> val1</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>deepMerge 工具函数实现</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deepMerge</span>(<span class="params">...<span class="attr">objs</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">any</span> &#123;</span><br><span class="line">	<span class="comment">// 深度合并对象</span></span><br><span class="line">	<span class="keyword">const</span> result = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">	objs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (obj) &#123;</span><br><span class="line">			<span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">				<span class="keyword">const</span> val = obj[key]</span><br><span class="line">				<span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(val)) &#123;</span><br><span class="line">					<span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(result[key])) &#123;</span><br><span class="line">						result[key] = <span class="title function_">deepMerge</span>(result[key], val)</span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						result[key] = <span class="title function_">deepMerge</span>(val)</span><br><span class="line">					&#125;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					result[key] = val</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在请求中应用函数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">url</span>: <span class="built_in">any</span>, <span class="attr">config</span>: <span class="built_in">any</span>): <span class="title class_">AxiosPromise</span> &#123; <span class="comment">// 实现request方法传入参数</span></span><br><span class="line">    。。。</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!config) &#123;</span><br><span class="line">            config = &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        config.<span class="property">url</span> = url</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        config = url</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送请求之前应用</span></span><br><span class="line">    config = <span class="variable language_">this</span>.<span class="title function_">mergeConfig</span>(<span class="variable language_">this</span>.<span class="property">defaults</span>,config) <span class="comment">// 合并config</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">chain</span>:<span class="title class_">PromiseChain</span>&lt;<span class="built_in">any</span>&gt;[] = [</span><br><span class="line">        &#123;<span class="comment">// 创建一个数组chain</span></span><br><span class="line">            <span class="attr">resolved</span>: dispatchRequest,</span><br><span class="line">            <span class="attr">rejected</span>: <span class="literal">undefined</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    。。。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h5><blockquote>
<p>合并后的 headers 是一个复杂对象，多了 common、post、get 等属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">headers:&#123;</span><br><span class="line">    common:&#123;</span><br><span class="line">    	Accept:&#x27;application/json,text/plain,*/*&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    post: &#123;</span><br><span class="line">    	&#x27;Content-Type&#x27;:&#x27;application/x-www-form-urlencoded&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们需要压缩成一级</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">headers:&#123;</span><br><span class="line">	Accept:&#x27;application/json,text/plain,*/*&#x27;,</span><br><span class="line">	&#x27;Content-Type&#x27;:&#x27;application/x-www-form-urlencoded&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Tip：对于 comman 中定义的 header 字段，我们都要提取，而对于 post、get 这类提取，需要和该次请求的方法对应。</p>
</blockquote>
<p>headers.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">flattenHeaders</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>, <span class="attr">method</span>: <span class="title class_">Method</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">	<span class="comment">// flattenHeaders 函数接收 headers 和 method 参数 将 headers 中的属性名规范化 并删除不必要的属性 并返回一个新的 headers 对象</span></span><br><span class="line">	<span class="keyword">if</span> (!headers) &#123;</span><br><span class="line">		<span class="comment">// 如果 headers 不存在</span></span><br><span class="line">		<span class="keyword">return</span> headers <span class="comment">// 返回 headers</span></span><br><span class="line">	&#125;</span><br><span class="line">	headers = <span class="title function_">deepMerge</span>(headers, <span class="literal">null</span>) <span class="comment">// 调用 deepMerge 函数将 headers 深度合并</span></span><br><span class="line">	<span class="keyword">const</span> methodsToDelete = [</span><br><span class="line">		<span class="comment">// 定义一个数组 methodsToDelete 存储需要删除的 headers 属性名</span></span><br><span class="line">		<span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;head&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;options&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;patch&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;common&#x27;</span>,</span><br><span class="line">	]</span><br><span class="line">	methodsToDelete.<span class="title function_">forEach</span>(<span class="function">(<span class="params">method</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">// 遍历 methodsToDelete 数组</span></span><br><span class="line">		<span class="keyword">delete</span> headers[method] <span class="comment">// 删除 headers 的属性名</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> headers <span class="comment">// 返回 headers</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>dispatchRequest.ts 应用函数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 config</span></span><br><span class="line">	config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">	config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// 先处理 headers</span></span><br><span class="line">	config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// 再处理 data</span></span><br><span class="line">	config.<span class="property">headers</span> = <span class="title function_">flattenHeaders</span>(config.<span class="property">headers</span>, config.<span class="property">method</span>!) <span class="comment">//处理 headers 扁平化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更多配置"><a href="#更多配置" class="headerlink" title="更多配置"></a>更多配置</h3><h4 id="transfromRequest-transfromResponse"><a href="#transfromRequest-transfromResponse" class="headerlink" title="transfromRequest &amp; transfromResponse"></a>transfromRequest &amp; transfromResponse</h4><blockquote>
<p>官方 axios 中提供<code>transfromRequest</code>&amp;<code>transfromResponse</code>，值为**<em>一个数组或一个函数</em>**</p>
<p>这两个属性允许用户在 <strong>数据发送到服务器之前</strong>(只适用于 put、post、patch，而且可以修改 headers 对象) &#x2F; <strong>把响应数据传递给 then 或 catch 之前</strong> 对其修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">    transformRequest: [</span><br><span class="line">        (function(data) &#123;</span><br><span class="line">            return qs.stringify(data); // 自定义的 transformRequest</span><br><span class="line">        &#125;),</span><br><span class="line">        ...axios.defaults.transformRequest // 保留默认的 transformRequest</span><br><span class="line">    ],</span><br><span class="line">    transformResponse: [</span><br><span class="line">        ...axios.defaults.transformResponse, // 展开默认的 transformResponse</span><br><span class="line">        function(data) &#123;</span><br><span class="line">            if (typeof data === &#x27;object&#x27;) &#123; // 自定义的 transformResponse</span><br><span class="line">                data.b = 2; // 修改响应数据</span><br><span class="line">            &#125;</span><br><span class="line">            return data;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    url: &#x27;/config/post&#x27;, // 请求的 URL</span><br><span class="line">    method: &#x27;post&#x27;, // 请求方法</span><br><span class="line">    data: &#123;</span><br><span class="line">        a: 1 // 请求的数据</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote>
<h5 id="定义接口"><a href="#定义接口" class="headerlink" title="定义接口"></a>定义接口</h5><p>types &#x2F; index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line">	<span class="comment">//config接口</span></span><br><span class="line">	<span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line">	<span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line">	<span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line">	<span class="attr">responseType</span>?: <span class="title class_">XMLHttpRequestResponseType</span></span><br><span class="line">	<span class="attr">timeout</span>?: <span class="built_in">number</span></span><br><span class="line">	<span class="attr">transformRequest</span>?: <span class="title class_">AxiosTransformer</span> | <span class="title class_">AxiosTransformer</span>[] <span class="comment">//请求数据转换函数</span></span><br><span class="line">	<span class="attr">transformResponse</span>?: <span class="title class_">AxiosTransformer</span> | <span class="title class_">AxiosTransformer</span>[] <span class="comment">//响应数据转换函数</span></span><br><span class="line"></span><br><span class="line">	[<span class="attr">propName</span>: <span class="built_in">string</span>]: <span class="built_in">any</span> <span class="comment">//字符串自动索引</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosTransformer</span> &#123;</span><br><span class="line">	<span class="comment">//转换接口</span></span><br><span class="line">	(<span class="attr">data</span>: <span class="built_in">any</span>, <span class="attr">headers</span>?: <span class="built_in">any</span>): <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>defaults.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; processHeaders &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/header&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span> = &#123;</span><br><span class="line">	<span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">	<span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">	<span class="attr">timeout</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">headers</span>: &#123;</span><br><span class="line">		<span class="attr">common</span>: &#123;</span><br><span class="line">			<span class="title class_">Accept</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>, <span class="comment">//通用的请求头 接受的响应类型为json/plain文本*/*表示任意类型 优先级最低</span></span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="attr">transformRequest</span>: [</span><br><span class="line">		<span class="keyword">function</span> (<span class="params"><span class="attr">data</span>: <span class="built_in">any</span>, <span class="attr">headers</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">			<span class="title function_">processHeaders</span>(headers, data) <span class="comment">//处理请求头</span></span><br><span class="line">			<span class="keyword">return</span> <span class="title function_">transformRequest</span>(data) <span class="comment">//处理请求数据</span></span><br><span class="line">		&#125;,</span><br><span class="line">	],</span><br><span class="line">	<span class="attr">transformResponse</span>: [</span><br><span class="line">		<span class="keyword">function</span> (<span class="params"><span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="title function_">transformResponse</span>(data) <span class="comment">//处理响应数据</span></span><br><span class="line">		&#125;,</span><br><span class="line">	],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="重构-transform-逻辑"><a href="#重构-transform-逻辑" class="headerlink" title="重构 transform 逻辑"></a>重构 transform 逻辑</h5><p>core &#x2F; transform.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosTransformer</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">transform</span>(<span class="params"> <span class="comment">//transform函数接收data headers fns三个参数</span></span></span><br><span class="line"><span class="params">	<span class="attr">data</span>: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params">	<span class="attr">headers</span>: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params">	<span class="attr">fns</span>?: <span class="title class_">AxiosTransformer</span> | <span class="title class_">AxiosTransformer</span>[]</span></span><br><span class="line"><span class="params"></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (!fns) &#123;</span><br><span class="line">		<span class="comment">//如果没有传入fns 直接返回data</span></span><br><span class="line">		<span class="keyword">return</span> data</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(fns)) &#123;</span><br><span class="line">		<span class="comment">//如果fns不是数组 将其转为数组</span></span><br><span class="line">		fns = [fns]</span><br><span class="line">	&#125;</span><br><span class="line">	fns.<span class="title function_">forEach</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">//遍历fns数组 依次调用fn函数</span></span><br><span class="line">		data = <span class="title function_">fn</span>(data, headers)</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>core &#x2F; dispatchRequest.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> transform <span class="keyword">from</span> <span class="string">&#x27;./transform&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 config</span></span><br><span class="line">	config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">	config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// 先处理 headers</span></span><br><span class="line">	config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// 再处理 data</span></span><br><span class="line">	config.<span class="property">headers</span> = <span class="title function_">flattenHeaders</span>(config.<span class="property">headers</span>, config.<span class="property">method</span>!) <span class="comment">//处理 headers 扁平化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更改为 👇</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 config</span></span><br><span class="line">	config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">	config.<span class="property">data</span> = <span class="title function_">transform</span>(config.<span class="property">data</span>, config.<span class="property">headers</span>, config.<span class="property">transformRequest</span>) <span class="comment">//处理 data</span></span><br><span class="line">	config.<span class="property">headers</span> = <span class="title function_">flattenHeaders</span>(config.<span class="property">headers</span>, config.<span class="property">method</span>!) <span class="comment">//处理 headers 扁平化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>删掉不用的东西</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformRequestData</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 data 调用 transformRequest 方法</span></span><br><span class="line">	config.<span class="property">data</span> = <span class="title function_">transformRequest</span>(config.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformHeaders</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 headers 调用 processHeaders 方法</span></span><br><span class="line">	<span class="keyword">const</span> &#123; headers = &#123;&#125;, data &#125; = config</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">processHeaders</span>(headers, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更改逻辑</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">transformResponseData</span>(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>): <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line">	<span class="comment">// 处理 response data</span></span><br><span class="line">	res.<span class="property">data</span> = <span class="title function_">transform</span>(res.<span class="property">data</span>, res.<span class="property">headers</span>, res.<span class="property">config</span>.<span class="property">transformResponse</span>)</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="create"><a href="#create" class="headerlink" title="create"></a>create</h4><blockquote>
<p>目前为止，我们的 axios 都是一个单例，一旦我们修改了 axios 的默认配置，会影响所有的请求。我们希望提供了一个<code>axios.create</code>的静态接口允许我们创建一个新的 axios 实例，同时允许我们传入新的配置和默认配置合并，并做为新的默认配置。</p>
</blockquote>
<h5 id="扩展新的接口"><a href="#扩展新的接口" class="headerlink" title="扩展新的接口"></a>扩展新的接口</h5><p>types &#x2F; index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosStatic</span> <span class="keyword">extends</span> <span class="title class_">AxiosInstance</span> &#123;</span><br><span class="line">	<span class="comment">//axios静态接口</span></span><br><span class="line">	<span class="title function_">create</span>(<span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosInstance</span> <span class="comment">//创建axios实例</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>axios.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosStatic</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Axios</span> <span class="keyword">from</span> <span class="string">&#x27;./core/Axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/util&#x27;</span></span><br><span class="line"><span class="keyword">import</span> defaults <span class="keyword">from</span> <span class="string">&#x27;./defaults&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mergeConfig <span class="keyword">from</span> <span class="string">&#x27;./core/mergeConfig&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosStatic</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> context = <span class="keyword">new</span> <span class="title class_">Axios</span>(config) <span class="comment">//创建一个 Axios 实例 并传入 config 参数 并赋值给 context 变量</span></span><br><span class="line">	<span class="keyword">const</span> instance = <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span>.<span class="title function_">bind</span>(context) <span class="comment">//调用 request 方法 并传入 context 参数 并赋值给 instance 变量 绑定 this 指向 context</span></span><br><span class="line"></span><br><span class="line">	<span class="title function_">extend</span>(instance, context) <span class="comment">//调用 extend 方法 并传入 instance 和 context 参数 实现 instance 对象继承 context 对象</span></span><br><span class="line">	<span class="keyword">return</span> instance <span class="keyword">as</span> <span class="title class_">AxiosStatic</span> <span class="comment">//返回 instance 对象 并断言为 AxiosStatic 类型</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="title function_">createInstance</span>(defaults) <span class="comment">//调用 createInstance 方法 并传入 defaults 参数 并赋值给 axios 变量</span></span><br><span class="line"></span><br><span class="line">axios.<span class="property">create</span> = <span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">config</span>) &#123;</span><br><span class="line">	<span class="comment">//axios.create 方法接收一个 config 参数 并返回一个 createInstance 方法的调用结果 并传入 mergeConfig 方法的调用结果 并传入 defaults 和 config 参数</span></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">createInstance</span>(<span class="title function_">mergeConfig</span>(defaults, config))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="/img/512.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="/img/512.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">Breezli</div><div class="post-copyright__author_desc">“松间听风，忽见灵狸”</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0axios/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0axios/')">TS + NodeJS实现axios</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0axios/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=TS + NodeJS实现axios&amp;url=http://example.com/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0axios/&amp;pic=https://bu.dusays.com/2025/03/05/67c7e99f50819.webp" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">松风狸 | Breezli</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2025/03/05/67c7e99e3513a.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E6%BA%90%E7%A0%81%E6%8E%A2%E7%A9%B6%20runtime-core%E6%A8%A1%E5%9D%97/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="https://bu.dusays.com/2025/03/05/67c7e99e46b9f.png" onerror="onerror=null;src='https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">源码探究 runtime-core模块</div></div></a></div><div class="next-post pull-right"><a href="/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/WebRTC%E5%AE%9E%E7%8E%B0%E6%9C%AC%E5%9C%B0%E8%A7%86%E9%A2%91%E9%80%9A%E8%AF%9D%E5%85%A8%E6%B5%81%E7%A8%8B/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="https://bu.dusays.com/2025/03/05/67c7e99e32763.png" onerror="onerror=null;src='https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">WebRTC实现本地视频通话 | 全流程详解</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="/img/512.png" onerror="this.onerror=null;this.src='https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="https://emotion.acs.pw/emotion/QQ/129.gif" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">错位的人格，错位的灵魂；</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">错位的才情，错位的人生。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">在错误的路口抢夺正确的结果，</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">用虚假的手段寻回真实的自己。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Breezli</h1><div class="author-info__desc">“松间听风，忽见灵狸”</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/Breezli" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/3546391152429457" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://img02.anheyu.com/adminuploads/1/2022/09/11/631ddb7c9b250.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(null) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#TS-NodeJS-%E5%AE%9E%E7%8E%B0-axios"><span class="toc-number">1.</span> <span class="toc-text">TS + NodeJS 实现 axios</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">1.1.</span> <span class="toc-text">需求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BB%A3%E7%A0%81"><span class="toc-number">1.1.1.</span> <span class="toc-text">请求代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">1.1.2.</span> <span class="toc-text">安装依赖</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack-%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text">webpack 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#entry"><span class="toc-number">1.2.1.</span> <span class="toc-text">entry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#output"><span class="toc-number">1.2.2.</span> <span class="toc-text">output</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#module"><span class="toc-number">1.2.3.</span> <span class="toc-text">module</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#resolve"><span class="toc-number">1.2.4.</span> <span class="toc-text">resolve</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#plugins"><span class="toc-number">1.2.5.</span> <span class="toc-text">plugins</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-number">1.3.</span> <span class="toc-text">核心功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86-url-%E5%8F%82%E6%95%B0-params"><span class="toc-number">1.3.1.</span> <span class="toc-text">处理 url 参数(params)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%9E%84-URL-params"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">解构 URL -&gt; params</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%9E%84-params-key-value"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">解构 params -&gt; key&#x2F;value</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86-body-%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.2.</span> <span class="toc-text">处理 body 数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86-header"><span class="toc-number">1.3.3.</span> <span class="toc-text">处理 header</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%A4%84%E7%90%86-response"><span class="toc-number">1.3.4.</span> <span class="toc-text">获取处理 response</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%93%8D%E5%BA%94-data"><span class="toc-number">1.3.5.</span> <span class="toc-text">处理响应 data</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86-reject-%E6%8B%92%E5%9B%9E"><span class="toc-number">1.4.</span> <span class="toc-text">错误处理(reject 拒回)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E7%BD%91%E7%BB%9C%E9%94%99%E8%AF%AF"><span class="toc-number">1.4.1.</span> <span class="toc-text">处理网络错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E8%B6%85%E6%97%B6%E9%94%99%E8%AF%AF"><span class="toc-number">1.4.2.</span> <span class="toc-text">处理超时错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%A0%81%E5%A4%84%E7%90%86-200-%E9%94%99%E8%AF%AF"><span class="toc-number">1.4.3.</span> <span class="toc-text">状态码处理(!200 错误)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E5%A2%9E%E5%BC%BA"><span class="toc-number">1.4.4.</span> <span class="toc-text">错误信息增强</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-AxiosError-%E7%B1%BB"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">创建 AxiosError 类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#createError-%E6%96%B9%E6%B3%95%E5%BA%94%E7%94%A8"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">createError 方法应用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%89%A9%E5%B1%95"><span class="toc-number">1.5.</span> <span class="toc-text">接口扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">1.5.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-Axios-ts"><span class="toc-number">1.5.2.</span> <span class="toc-text">创建 Axios.ts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-Axios-%E7%B1%BB%E4%B8%AD%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.3.</span> <span class="toc-text">实现 Axios 类中接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E5%AF%B9%E8%B1%A1%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.5.4.</span> <span class="toc-text">混合对象实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.5.5.</span> <span class="toc-text">工厂函数实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#axios-%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD"><span class="toc-number">1.5.6.</span> <span class="toc-text">axios 函数重载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E6%94%AF%E6%8C%81%E6%B3%9B%E5%9E%8B"><span class="toc-number">1.5.7.</span> <span class="toc-text">响应数据支持泛型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.6.</span> <span class="toc-text">拦截器实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8%E7%AE%A1%E7%90%86%E7%B1%BB"><span class="toc-number">1.6.1.</span> <span class="toc-text">拦截器管理类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.6.2.</span> <span class="toc-text">链式调用实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE"><span class="toc-number">1.7.</span> <span class="toc-text">合并用户配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.7.1.</span> <span class="toc-text">默认配置设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E7%AD%96%E7%95%A5%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.7.2.</span> <span class="toc-text">合并策略实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#timeout-%E9%80%BB%E8%BE%91"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">timeout 逻辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#headers-%E9%80%BB%E8%BE%91"><span class="toc-number">1.7.2.2.</span> <span class="toc-text">headers 逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%88%E5%B9%B6"><span class="toc-number">1.7.2.2.1.</span> <span class="toc-text">合并</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9"><span class="toc-number">1.7.2.2.2.</span> <span class="toc-text">压缩</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A%E9%85%8D%E7%BD%AE"><span class="toc-number">1.7.3.</span> <span class="toc-text">更多配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#transfromRequest-transfromResponse"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">transfromRequest &amp; transfromResponse</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.7.3.1.1.</span> <span class="toc-text">定义接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%87%8D%E6%9E%84-transform-%E9%80%BB%E8%BE%91"><span class="toc-number">1.7.3.1.2.</span> <span class="toc-text">重构 transform 逻辑</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#create"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">create</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E6%96%B0%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.7.3.2.1.</span> <span class="toc-text">扩展新的接口</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/%E9%80%9A%E4%BF%97%E7%89%88Promise%E8%A7%A3%E9%87%8A/" title="通俗版Promise解释"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="https://bu.dusays.com/2025/03/05/67c7e99e3513a.png" onerror="this.onerror=null;this.src='https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif'" alt="通俗版Promise解释"/></a><div class="content"><a class="title" href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/%E9%80%9A%E4%BF%97%E7%89%88Promise%E8%A7%A3%E9%87%8A/" title="通俗版Promise解释">通俗版Promise解释</a><time datetime="2025-03-08T12:28:50.979Z" title="发表于 2025-03-08 20:28:50">2025-03-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E4%B8%ADz-index%E7%9A%84%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1/" title="项目中z-index规划设计"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="https://bu.dusays.com/2025/03/09/67cc73170e34d.jpg" onerror="this.onerror=null;this.src='https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif'" alt="项目中z-index规划设计"/></a><div class="content"><a class="title" href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E4%B8%ADz-index%E7%9A%84%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1/" title="项目中z-index规划设计">项目中z-index规划设计</a><time datetime="2025-03-08T12:28:31.464Z" title="发表于 2025-03-08 20:28:31">2025-03-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BEChart%E5%90%AB%E5%9B%BE%E8%A1%A8%E6%A8%A1%E6%9D%BF_vue%E9%A1%B9%E7%9B%AE%E5%86%99%E6%B3%95/" title="快速上手EChart(Vue项目)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="https://bu.dusays.com/2025/03/05/67c7e99f623e4.webp" onerror="this.onerror=null;this.src='https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif'" alt="快速上手EChart(Vue项目)"/></a><div class="content"><a class="title" href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BEChart%E5%90%AB%E5%9B%BE%E8%A1%A8%E6%A8%A1%E6%9D%BF_vue%E9%A1%B9%E7%9B%AE%E5%86%99%E6%B3%95/" title="快速上手EChart(Vue项目)">快速上手EChart(Vue项目)</a><time datetime="2025-03-08T12:28:23.308Z" title="发表于 2025-03-08 20:28:23">2025-03-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E9%94%AE%E7%9B%98%E4%B9%B1%E9%94%AE%E9%97%AE%E9%A2%98/" title="键盘乱键问题解决"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif?_r_=616efd74-3fae-148a-dbf7-68c89b697903" onerror="this.onerror=null;this.src='https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif'" alt="键盘乱键问题解决"/></a><div class="content"><a class="title" href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E9%94%AE%E7%9B%98%E4%B9%B1%E9%94%AE%E9%97%AE%E9%A2%98/" title="键盘乱键问题解决">键盘乱键问题解决</a><time datetime="2025-03-08T12:28:23.302Z" title="发表于 2025-03-08 20:28:23">2025-03-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8A%E4%B8%8B%E6%96%87--BFC%E4%B8%8EIFC/" title="BFC与IFC"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="https://bu.dusays.com/2025/03/09/67cc73170e34d.jpg" onerror="this.onerror=null;this.src='https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif'" alt="BFC与IFC"/></a><div class="content"><a class="title" href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8A%E4%B8%8B%E6%96%87--BFC%E4%B8%8EIFC/" title="BFC与IFC">BFC与IFC</a><time datetime="2025-03-08T12:28:23.299Z" title="发表于 2025-03-08 20:28:23">2025-03-08</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="Breezli" target="_blank">Breezli</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  getScript('https://sdk.jinrishici.com/v2/browser/jinrishici.js').then(() => {
    jinrishici.load(result =>{
      if (true) {
        const sub = []
        const content = result.data.content
        sub.unshift(content)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = result.data.content
      }
    })
  })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">32</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">5</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/03/05/67c7f047dfa72.gif&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/music/?id=13242559326&amp;server=netease"><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 梦境</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-plant-fill faa-tada" style="font-size: 0.9em;"></i><span> 簪花人间</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/cinema/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 匣中秋水</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-instagram faa-tada" style="font-size: 0.9em;"></i><span> 彩云霁月</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><span> 关于</span></a></div></div><span class="sidebar-menu-item-title">标签</span></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="13242559326" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.5"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=13242559326&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>var meting_api = "https://meting.qjqq.cn/?server=:server&type=:type&id=:id&auth=:auth&r=:r";
</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  //- const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  const grt = new Date("2025-3-1");
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);

  const ascll = [
    `   原来我这几十年的岁月，不过只是这样一个简单的故事.`,
    `
                                                                         
██████╗ ██████╗ ███████╗███████╗███████╗██╗     ██╗
██╔══██╗██╔══██╗██╔════╝██╔════╝╚══███╔╝██║     ██║
██████╔╝██████╔╝█████╗  █████╗    ███╔╝ ██║     ██║
██╔══██╗██╔══██╗██╔══╝  ██╔══╝   ███╔╝  ██║     ██║
██████╔╝██║  ██║███████╗███████╗███████╗███████╗██║
╚═════╝ ╚═╝  ╚═╝╚══════╝╚══════╝╚══════╝╚══════╝╚═╝

    `,
    "   已上线", dnum, "天",
    "©2025 By 松风狸 V1.6.14",
  ];

  setTimeout(
    Log.bind(
      console,
      "%c ⚡ %c 你正在访问 Breezli 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}%c\n`,
      "color:#ffb07c",
      "color:#ffb07c",
      "color:#ffb07c",
      "color:#ffb07c",
      "color:#ffb07c",
      "color:#ffb07c",
      "color:#425AEF"
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好,旅行客。", "color:white; background-color:#4f90d9", ""));
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>