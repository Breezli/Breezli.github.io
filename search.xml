<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>隐式转换</title>
      <link href="/2025/05/12/JS/%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2/"/>
      <url>/2025/05/12/JS/%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<h3 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换</h3><blockquote><p>在某些操作中，JavaScript 自动将一种数据类型转换为另一种数据类型</p></blockquote><p>以下是常见场景</p><h4 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h4><blockquote><p>用 <code>+</code> 时，如果其中一个操作数是字符串，另一个操作数会被自动转换为字符串</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span> + <span class="string">&quot;2&quot;</span>); <span class="comment">// 输出: &quot;12&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello&quot;</span> + <span class="number">3</span>); <span class="comment">// 输出: &quot;Hello3&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">true</span> + <span class="string">&quot; world&quot;</span>); <span class="comment">// 输出: &quot;true world&quot;</span></span><br></pre></td></tr></table></figure><h4 id="数字运算"><a href="#数字运算" class="headerlink" title="数字运算"></a>数字运算</h4><blockquote><p>数学运算时，非数字类型的值会被隐式转换为数字</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">10</span> - <span class="string">&quot;5&quot;</span>); <span class="comment">// 输出: 5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;10&quot;</span> * <span class="number">3</span>); <span class="comment">// 输出: 30</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;10&quot;</span> / <span class="number">2</span>); <span class="comment">// 输出: 5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;abc&quot;</span> - <span class="number">1</span>); <span class="comment">// 输出: NaN (无法转换为数字)</span></span><br></pre></td></tr></table></figure><h4 id="布尔值"><a href="#布尔值" class="headerlink" title="布尔值"></a>布尔值</h4><blockquote><p>条件判断中，JavaScript 会将值隐式转换为布尔值</p></blockquote><p>以下值被视为false</p><p><code>false</code> <code>0</code> <code>null</code> <code>undefined</code> <code>NaN</code> <code>&quot;&quot;</code>（空字符串）</p><p>其他所有值都被视为 <code>true</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&quot;&quot;</span>) &#123; <span class="comment">// 为 false</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;This won&#x27;t run&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;hello&quot;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Non-empty string is truthy&quot;</span>); <span class="comment">// 输出: Non-empty string is truthy</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="与"><a href="#与" class="headerlink" title="&#x3D;&#x3D;与&#x3D;&#x3D;&#x3D;"></a>&#x3D;&#x3D;与&#x3D;&#x3D;&#x3D;</h4><p><code>==</code>（宽松相等）与<code>===</code>（严格相等）的核心区别在于<strong>是否进行类型转换</strong>：</p><ol><li><strong><code>===</code></strong>：直接比较 <strong>值</strong> + <strong>类型</strong> ，类型不同立即返回<code>false</code>。例如<code>5 === &quot;5&quot;</code>为<code>false</code>。</li><li><strong><code>==</code></strong>（<code>!=</code>同理）：若类型不同，按规则 <strong>隐式转换</strong> 后比较：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span> == <span class="string">&quot;1&quot;</span>);<span class="comment">// true (数字和字符串被隐式转换)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">0</span> == <span class="literal">false</span>);<span class="comment">// true (布尔值被转换为数字)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;0&quot;</span> == <span class="literal">false</span>);<span class="comment">// true (`false`转`0`，`&quot;0&quot;`转`0`)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([] == <span class="number">0</span>);<span class="comment">// true (空数组→空字符串→转`0`)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([] == ![]);<span class="comment">// true (![]转false→0，[]转0)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span> == <span class="literal">undefined</span>); <span class="comment">// true (特殊规则)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">NaN</span> == <span class="title class_">NaN</span>);<span class="comment">// false (`NaN`与任何值（包括自身）比较均为`false`)</span></span><br></pre></td></tr></table></figure><p><strong>最佳实践</strong>：</p><ul><li>始终使用<code>===</code>避免隐式转换陷阱，提升代码可预测性。</li><li>若需类型转换，应显式转换（如<code>Number(str)</code>或<code>String(num)</code>）而非依赖<code>==</code>。</li></ul>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>数据类型</title>
      <link href="/2025/05/12/JS/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
      <url>/2025/05/12/JS/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="数据类型-类型判断"><a href="#数据类型-类型判断" class="headerlink" title="数据类型+类型判断"></a>数据类型+类型判断</h3><p>JavaScript数据类型分为<strong>基本类型</strong>与<strong>引用类型</strong>。</p><p>基本类型包括<code>undefined</code>、<code>null</code>、<code>boolean</code>、<code>number</code>、<code>string</code>、<code>symbol</code>（ES6）、<code>bigint</code>（ES11）；</p><p>引用类型为<code>object</code>（如数组、函数等）。</p><p>类型判断方法如下：</p><ol><li><strong><code>typeof</code></strong>：返回类型字符串，但<code>typeof null</code>返回<code>&quot;object&quot;</code>（历史遗留问题），且无法区分数组与对象（均返回<code>&quot;object&quot;</code>）。</li><li><strong><code>instanceof</code></strong>：检测对象原型链是否包含构造函数（如<code>[] instanceof Array</code>为<code>true</code>），但跨全局环境（如iframe）时失效。</li><li><strong><code>Object.prototype.toString.call()</code></strong>：精确返回<code>[object Type]</code>格式（如数组返回<code>&quot;[object Array]&quot;</code>），可识别所有内置类型（包括<code>null</code>返回<code>&quot;[object Null]&quot;</code>）。</li><li><strong><code>Array.isArray()</code></strong>：专用于判断数组，避免<code>instanceof</code>的跨环境问题。</li></ol><p><strong>示例对比</strong>：</p><ul><li><code>typeof 42</code> → <code>&quot;number&quot;</code></li><li><code>typeof &#123;&#125;</code> → <code>&quot;object&quot;</code></li><li><code>Object.prototype.toString.call(null)</code> → <code>&quot;[object Null]&quot;</code></li><li><code>Array.isArray([])</code> → <code>true</code></li></ul><p><strong>总结</strong>：</p><ul><li>基本类型优先用<code>typeof</code>（注意<code>null</code>特例）。</li><li>精确类型用<code>Object.prototype.toString.call()</code>。</li><li>数组判断用<code>Array.isArray()</code>。</li><li>自定义对象需结合构造函数或<code>Symbol.toStringTag</code>。</li></ul>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>单点登录</title>
      <link href="/2025/05/12/JS/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/"/>
      <url>/2025/05/12/JS/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h3 id="单点登录"><a href="#单点登录" class="headerlink" title="单点登录"></a>单点登录</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><blockquote><p>SSO，是一种身份验证机制，运行用户通过一次登录可以访问多个相关但独立的软件系统</p><p>一旦用户登录一个系统，所有相关系统都将识别该用户为已认证状态</p></blockquote><h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><p><strong>背景</strong></p><blockquote><p>认证中心：颁发令牌</p><p>应用A - 应用B：两个独立应用，共享同一个认证中心</p></blockquote><p><strong>技术栈</strong></p><blockquote><p>JS、Nodejs、OAuth 2.0协议</p></blockquote><p><strong>流程</strong></p><p>前端部分</p><blockquote><p><em><strong>用户访问A</strong></em></p><p>A检测登录状态 -&gt; (未登录重定向认证中心)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 检查本地是否有有效的访问令牌</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkLoginStatus</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;accessToken&#x27;</span>);</span><br><span class="line"> <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">     <span class="comment">// 如果没有令牌，重定向到认证中心</span></span><br><span class="line">     <span class="title function_">redirectToAuthServer</span>();</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;用户已登录&#x27;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">redirectToAuthServer</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">const</span> clientId = <span class="string">&#x27;your-client-id&#x27;</span>; <span class="comment">// 应用的客户端ID</span></span><br><span class="line"> <span class="keyword">const</span> redirectUri = <span class="built_in">encodeURIComponent</span>(<span class="string">&#x27;https://app-a.com/callback&#x27;</span>); <span class="comment">// 应用A的回调地址</span></span><br><span class="line"> <span class="keyword">const</span> authUrl = <span class="string">`https://auth-server.com/authorize?response_type=code&amp;client_id=<span class="subst">$&#123;clientId&#125;</span>&amp;redirect_uri=<span class="subst">$&#123;redirectUri&#125;</span>`</span>;</span><br><span class="line"> <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = authUrl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在认证中心登录</p><p>认证中心生成认证码 + 重定向A</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取URL中的授权码</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getAuthorizationCode</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">const</span> urlParams = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>);</span><br><span class="line"> <span class="keyword">return</span> urlParams.<span class="title function_">get</span>(<span class="string">&#x27;code&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A用授权码向认证中心换取访问令牌</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用授权码换取访问令牌</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">exchangeToken</span>(<span class="params">code</span>) &#123;</span><br><span class="line"> <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;https://auth-server.com/token&#x27;</span>, &#123;</span><br><span class="line">     <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">     <span class="attr">headers</span>: &#123;</span><br><span class="line">         <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="attr">body</span>: <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(&#123;</span><br><span class="line">         <span class="attr">grant_type</span>: <span class="string">&#x27;authorization_code&#x27;</span>,</span><br><span class="line">         <span class="attr">code</span>: code,</span><br><span class="line">         <span class="attr">client_id</span>: <span class="string">&#x27;your-client-id&#x27;</span>,</span><br><span class="line">         <span class="attr">client_secret</span>: <span class="string">&#x27;your-client-secret&#x27;</span>,</span><br><span class="line">         <span class="attr">redirect_uri</span>: <span class="string">&#x27;https://app-a.com/callback&#x27;</span></span><br><span class="line">     &#125;)</span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line"> <span class="keyword">const</span> accessToken = data.<span class="property">access_token</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 保存访问令牌</span></span><br><span class="line"> <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;accessToken&#x27;</span>, accessToken);</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;登录成功，访问令牌已保存&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A保存令牌</p></blockquote><blockquote><p><em><strong>用户访问B</strong></em></p><p>B检查是否已登录 -&gt; (未登录重定向认证中心)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="comment">// 页面加载时检查授权码</span></span><br><span class="line">&gt;<span class="keyword">const</span> code = <span class="title function_">getAuthorizationCode</span>();</span><br><span class="line">&gt;<span class="keyword">if</span> (code) &#123;</span><br><span class="line">&gt;<span class="title function_">exchangeToken</span>(code);</span><br><span class="line">&gt;&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">&gt;<span class="title function_">checkLoginStatus</span>();</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><p>认证中心识别已登录，直接返回B并附带授权码</p><p>B用授权码向认证中心换取访问令牌</p></blockquote><p>后端部分</p><blockquote><p>认证中心登录页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 登录页面 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span> <span class="attr">required</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span> <span class="attr">required</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>认证中心接收到登录请求后，验证用户信息，并生成授权码</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">const</span> &#123; username, password &#125; = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 验证用户信息（这里仅作演示）</span></span><br><span class="line"> <span class="keyword">if</span> (username === <span class="string">&#x27;admin&#x27;</span> &amp;&amp; password === <span class="string">&#x27;123456&#x27;</span>) &#123;</span><br><span class="line">     <span class="keyword">const</span> code = <span class="title function_">generateAuthorizationCode</span>(); <span class="comment">// 生成随机授权码</span></span><br><span class="line">     <span class="keyword">const</span> redirectUri = <span class="string">&#x27;https://app-a.com/callback&#x27;</span>; <span class="comment">// 应用A的回调地址</span></span><br><span class="line">     res.<span class="title function_">redirect</span>(<span class="string">`<span class="subst">$&#123;redirectUri&#125;</span>?code=<span class="subst">$&#123;code&#125;</span>`</span>);</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">send</span>(<span class="string">&#x27;用户名或密码错误&#x27;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateAuthorizationCode</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substring</span>(<span class="number">2</span>, <span class="number">15</span>); <span class="comment">// 随机字符串</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>应用A或应用B使用授权码向认证中心兑换访问令牌</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/token&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">const</span> &#123; grant_type, code, client_id, client_secret, redirect_uri &#125; = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 验证授权码和客户端信息</span></span><br><span class="line"> <span class="keyword">if</span> (grant_type === <span class="string">&#x27;authorization_code&#x27;</span> &amp;&amp; <span class="title function_">isValidCode</span>(code)) &#123;</span><br><span class="line">     <span class="keyword">const</span> accessToken = <span class="title function_">generateAccessToken</span>(); <span class="comment">// 生成随机访问令牌</span></span><br><span class="line">     res.<span class="title function_">json</span>(&#123; <span class="attr">access_token</span>: accessToken &#125;);</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;无效的授权码或客户端信息&#x27;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateAccessToken</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substring</span>(<span class="number">2</span>, <span class="number">15</span>); <span class="comment">// 随机字符串</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isValidCode</span>(<span class="params">code</span>) &#123;</span><br><span class="line"> <span class="comment">// 验证授权码是否有效（这里仅作演示）</span></span><br><span class="line"> <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ol><li>用户访问应用A，前端检查本地是否有访问令牌。如果没有，则重定向到认证中心。</li><li>用户在认证中心登录成功后，认证中心生成授权码并重定向回应用A。</li><li>应用A使用授权码向认证中心兑换访问令牌，并保存到本地。</li><li>用户访问应用B，重复上述流程。由于用户已在认证中心登录，认证中心会直接返回授权码，无需再次输入用户名和密码。</li></ol>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>原型原型链</title>
      <link href="/2025/05/12/JS/%E5%8E%9F%E5%9E%8B%E5%8E%9F%E5%9E%8B%E9%93%BE/"/>
      <url>/2025/05/12/JS/%E5%8E%9F%E5%9E%8B%E5%8E%9F%E5%9E%8B%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<h3 id="原型原型链"><a href="#原型原型链" class="headerlink" title="原型原型链"></a>原型原型链</h3><h4 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h4><blockquote><p>每个 JS 对象（除 <code>null</code>）都有一个隐藏的 <code>[[Prototype]]</code> 属性，指向它的“原型对象”（简称原型）</p><p>原型对象也是一个普通对象，它包含可以被其他对象共享的属性和方法</p></blockquote><p>作用：存放一些属性和方法 + 在JS中实现继承</p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250419084957083.png" alt="image-20250419084957083" style="zoom: 50%;" /><h4 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h4><p><strong>可以通过实例对象的 <code>__proto__</code> 属性访问原型</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">arr.<span class="title function_">reverse</span>() <span class="comment">// 翻转</span></span><br><span class="line">arr.<span class="title function_">sort</span>()   <span class="comment">// 排序// 这些方法都是挂载到Array.prototype上的，可以共享给所有的数组实例使用</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span> === arr.<span class="property">__proto__</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><strong>所有原型对象的终点是null</strong></p><p>原型链的顶端通常是 <code>Object.prototype</code></p><blockquote><p>当访问一个对象的属性或方法时，JS 会沿着对象的原型链逐级向上查找，直到找到该属性或到达原型链的终点（<code>null</code>）。</p></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250419085919620.png" alt="image-20250419085919620" style="zoom:50%;" /><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>); <span class="comment">// null</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr.<span class="property">__proto__</span><span class="comment">//指向Array.prototype</span></span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span><span class="comment">//指向Object.prototype（Array.prototype也是对象，所以也有.__proto__）</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span><span class="comment">//指向null</span></span><br></pre></td></tr></table></figure><p><strong>属性查找会自动沿着原型链进行</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123; <span class="comment">// 构造函数</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">greet</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// 原型上的方法</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, my name is <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>.`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> alice = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Alice&#x27;</span>); <span class="comment">// 实例</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(alice.<span class="property">greet</span> === alice.<span class="property">__proto__</span>.<span class="property">greet</span>); <span class="comment">// true // 都指向原型</span></span><br></pre></td></tr></table></figure><p>当你写 <code>alice.greet()</code> 时</p><blockquote><p>首先检查 <code>alice</code> 对象本身是否有 <code>greet</code> 属性</p><p>如果没有，则继续检查 <code>alice.__proto__</code>（即 <code>Person.prototype</code>）</p><p>如果在 <code>alice.__proto__</code> 上找到了 <code>greet</code> 方法，则调用它，*<strong>并将 <code>this</code> 绑定到 <code>alice*</code></strong></p></blockquote><p>实际上，<code>alice.greet()</code> 是一种语法糖，等价于 <code>alice.__proto__.greet.call(alice)</code></p><p>所以直接推荐使用 <strong><code>alice.greet()</code></strong> 而省略 <code>__proto__</code></p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>new操作符</title>
      <link href="/2025/05/11/JS/new%E6%93%8D%E4%BD%9C%E7%AC%A6/"/>
      <url>/2025/05/11/JS/new%E6%93%8D%E4%BD%9C%E7%AC%A6/</url>
      
        <content type="html"><![CDATA[<h2 id="new"><a href="#new" class="headerlink" title="new"></a>new</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><blockquote><p>new会创建空的<em><strong>新对象{}</strong></em>，这个对象会被作为构造函数的上下文(就是this)</p></blockquote><blockquote><p>新对象会<em><strong>链接到原型</strong></em>，内部属性 <code>[[Prototype]]</code> (<code>__proto__</code> 指向构造函数的 <code>prototype</code> 属性)</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123; <span class="comment">// 构造函数首字母通常大写，以区分普通函数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">greet</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// 设置原型上的方法</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, my name is <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> and I am <span class="subst">$&#123;<span class="variable language_">this</span>.age&#125;</span> years old.`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 new 创建实例</span></span><br><span class="line"><span class="keyword">const</span> alice = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Alice&#x27;</span>, <span class="number">25</span>); <span class="comment">// 创建了一个新的对象 &#123;...&#125; // alice.__proto__ -&gt; Person.prototype</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(alice.<span class="property">name</span>); <span class="comment">// 输出 &#x27;Alice&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(alice.<span class="property">age</span>);  <span class="comment">// 输出 25</span></span><br><span class="line">alice.<span class="title function_">greet</span>();           <span class="comment">// 输出 &#x27;Hello, my name is Alice and I am 25 years old.&#x27;</span></span><br></pre></td></tr></table></figure><p><em><strong>注意</strong></em>：只要构造函数含有this，避免忘记使用 <code>new</code> 调用构造函数，否则 <code>this</code> 会指向全局对象（严格模式下为 <code>undefined</code>）</p><h3 id="手写"><a href="#手写" class="headerlink" title="手写"></a>手写</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myNew</span>(<span class="params">constructor, ...args</span>) &#123;</span><br><span class="line">    <span class="comment">// 1. 创建一个空对象，并继承构造函数的 prototype</span></span><br><span class="line">    <span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(constructor.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 执行构造函数，并将 this 绑定到新对象上</span></span><br><span class="line">    <span class="keyword">const</span> result = constructor.<span class="title function_">apply</span>(obj, args);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 如果构造函数返回的是一个对象，则返回这个对象，否则返回新创建的对象</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">typeof</span> result === <span class="string">&#x27;object&#x27;</span> &amp;&amp; result !== <span class="literal">null</span>) ? result : obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">// 原型上的方法</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, I&#x27;m <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Alice&#x27;</span>, <span class="number">25</span>);</span><br><span class="line">p1.<span class="title function_">sayHello</span>(); <span class="comment">// 输出 &quot;Hello, I&#x27;m Alice&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p2 = <span class="title function_">myNew</span>(<span class="title class_">Person</span>, <span class="string">&#x27;Bob&#x27;</span>, <span class="number">30</span>);</span><br><span class="line">p2.<span class="title function_">sayHello</span>(); <span class="comment">// 输出 &quot;Hello, I&#x27;m Bob&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>防抖和节流</title>
      <link href="/2025/05/11/JS/%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81/"/>
      <url>/2025/05/11/JS/%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<h3 id="防抖和节流"><a href="#防抖和节流" class="headerlink" title="防抖和节流"></a>防抖和节流</h3><h4 id="防抖"><a href="#防抖" class="headerlink" title="防抖"></a>防抖</h4><blockquote><p>重新开始，只执行最后一次</p></blockquote><p>搜索框输入、文本编辑器实时保存</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> @<span class="attr">keyup</span>=<span class="string">&quot;handleKeyUp($event)&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timerId = <span class="title function_">ref</span>(<span class="literal">null</span>); <span class="comment">// 使用 ref 来存储定时器 ID</span></span><br><span class="line"><span class="keyword">const</span> handleKeyUp = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (timerId.<span class="property">value</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timerId.<span class="property">value</span>); <span class="comment">// 清除之前的定时器</span></span><br><span class="line">    &#125;</span><br><span class="line">    timerId.<span class="property">value</span> = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(event.<span class="property">target</span>.<span class="property">value</span>); <span class="comment">// 打印输入框的值</span></span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="节流"><a href="#节流" class="headerlink" title="节流"></a>节流</h4><blockquote><p>中间禁用，只执行最先一次</p></blockquote><p>快速点击、鼠标滑动、scroll事件、下拉加载、视频播放器记录时间</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timerId = <span class="title function_">ref</span>(<span class="literal">null</span>); <span class="comment">// 使用 ref 来存储定时器的 ID</span></span><br><span class="line"><span class="keyword">const</span> handleKeyUp = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (timerId.<span class="property">value</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        timerId.<span class="property">value</span> = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(event.<span class="property">target</span>.<span class="property">value</span>); <span class="comment">// 打印输入框的值</span></span><br><span class="line">            timerId.<span class="property">value</span> = <span class="literal">null</span>; <span class="comment">// 清空定时器 ID</span></span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WeakMap &amp; Map</title>
      <link href="/2025/05/11/JS/WeakMap&amp;Map/"/>
      <url>/2025/05/11/JS/WeakMap&amp;Map/</url>
      
        <content type="html"><![CDATA[<h3 id="WeakMap-Map"><a href="#WeakMap-Map" class="headerlink" title="WeakMap &amp; Map"></a>WeakMap &amp; Map</h3><p>核心区别在于<strong>键类型</strong>、<strong>内存管理</strong>及<strong>可遍历性</strong>：</p><ol><li><strong>键类型限制</strong>：WeakMap <em><strong>仅接受对象作为键</strong></em>（非对象如字符串、Symbol会报错），而Map支持任意类型键值。</li><li><strong>弱引用机制</strong>：WeakMap的键是弱引用，若键对象无其他强引用，垃圾回收时自动清除对应条目，避免内存泄漏；Map强引用键，即使对象不再使用，仍保留条目导致内存无法释放。</li><li><strong>可遍历性</strong>：WeakMap不可遍历（无<code>size</code>、<code>keys()</code>等方法），Map支持迭代器访问所有条目。</li><li><strong>API差异</strong>：WeakMap仅有<code>get</code>、<code>set</code>、<code>has</code>、<code>delete</code>方法，Map额外提供<code>clear</code>、<code>forEach</code>及迭代接口。</li></ol><p><strong>应用场景对比</strong>：</p><ul><li><strong>WeakMap</strong>：适合关联对象与元数据且无需手动清理（如DOM元素绑定事件处理器，元素移除后自动释放）。</li><li><strong>Map</strong>：需长期维护键值对或遍历操作的场景（如缓存数据、频率统计）。</li></ul><p><strong>示例</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WeakMap：键为对象，自动清理  </span></span><br><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();  </span><br><span class="line"><span class="keyword">let</span> obj = &#123;&#125;;  </span><br><span class="line">wm.<span class="title function_">set</span>(obj, <span class="string">&#x27;data&#x27;</span>);  </span><br><span class="line">obj = <span class="literal">null</span>; <span class="comment">// 垃圾回收后，wm中对应条目自动清除  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Map：键任意类型，需手动管理  </span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();  </span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>);  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="property">size</span>); <span class="comment">// 1，可获取大小  </span></span><br></pre></td></tr></table></figure><p><strong>内存泄漏对比</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map导致内存泄漏  </span></span><br><span class="line"><span class="keyword">let</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>);  </span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();  </span><br><span class="line">map.<span class="title function_">set</span>(element, <span class="string">&#x27;info&#x27;</span>);  </span><br><span class="line">element.<span class="title function_">remove</span>(); <span class="comment">// DOM移除，但map仍保留引用，element无法被回收  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// WeakMap自动释放  </span></span><br><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();  </span><br><span class="line">wm.<span class="title function_">set</span>(element, <span class="string">&#x27;info&#x27;</span>);  </span><br><span class="line">element.<span class="title function_">remove</span>(); <span class="comment">// 无其他引用时，wm条目自动清除  </span></span><br></pre></td></tr></table></figure><p>WeakMap用于管理短期或临时状态，以及避免潜在的内存泄漏问题，适用于临时关联 生命周期与键对象绑定、缓存、模拟私有属性 的场景</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Symbol</title>
      <link href="/2025/05/11/JS/Symbol/"/>
      <url>/2025/05/11/JS/Symbol/</url>
      
        <content type="html"><![CDATA[<h3 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h3><p>Symbol 是 JavaScript 中一种<strong>唯一且不可变</strong>的原始数据类型，其核心应用场景和内存管理特性如下：</p><hr><h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h4><ol><li><p><strong>唯一属性键</strong><br>解决对象属性名冲突问题，确保第三方库扩展对象属性时互不影响：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">LOG_LEVEL</span> = <span class="title class_">Symbol</span>(<span class="string">&#x27;log&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> config = &#123; [<span class="variable constant_">LOG_LEVEL</span>]: <span class="string">&#x27;debug&#x27;</span> &#125;; <span class="comment">// 避免与可能的现有属性冲突</span></span><br></pre></td></tr></table></figure></li><li><p><strong>模拟私有成员</strong><br>通过非枚举特性隐藏内部实现（需配合闭包）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _counter = <span class="title class_">Symbol</span>(<span class="string">&#x27;counter&#x27;</span>);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>[_counter] = <span class="number">0</span>; <span class="comment">// 外部无法直接访问</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123; <span class="variable language_">this</span>[_counter]++; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 注：通过Object.getOwnPropertySymbols仍可访问，非绝对私有</span></span><br></pre></td></tr></table></figure></li><li><p><strong>内置协议驱动</strong><br>通过 Well-Known Symbols 定制对象行为：</p><ul><li><p><strong>迭代协议</strong>：<code>Symbol.iterator</code> 定义可迭代对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> range = &#123;</span><br><span class="line">    [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]() &#123; <span class="comment">/* 返回迭代器 */</span> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p><strong>类型标签</strong>：<code>Symbol.toStringTag</code> 自定义 <code>Object.prototype.toString</code> 输出</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyCollection</span> &#123;</span><br><span class="line">  get [<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]() &#123; <span class="keyword">return</span> <span class="string">&#x27;MyCollection&#x27;</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">MyCollection</span>()); <span class="comment">// [object MyCollection]</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>元编程与框架设计</strong><br>在框架中标记特殊逻辑，如 React 的 <code>Symbol.for(&#39;react.element&#39;)</code> 标识虚拟 DOM 元素。</p></li></ol><hr><h4 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a><strong>内存管理</strong></h4><ol><li><p><strong>唯一性与内存占用</strong></p><ul><li><p><strong>普通 Symbol</strong>：每次 <code>Symbol()</code> 调用生成唯一值，即使描述相同，内存独立分配。</p></li><li><p><strong>全局 Symbol</strong>：<code>Symbol.for(key)</code> 在全局注册表中复用同一值，减少重复创建：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s1 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;foo&#x27;</span>); <span class="comment">// 创建或获取全局Symbol</span></span><br><span class="line"><span class="keyword">const</span> s2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">s1 === s2; <span class="comment">// true（共享内存）</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>内存回收</strong></p><ul><li><strong>作为属性键</strong>：若对象被回收，其 Symbol 属性键占用的内存随对象释放。</li><li><strong>全局注册表</strong>：<code>Symbol.for</code> 创建的 Symbol 会持续存在，需避免滥用导致内存累积。</li></ul></li><li><p><strong>潜在泄漏场景</strong><br>长期持有含 Symbol 键的对象（如全局缓存）可能导致内存无法释放，需通过弱引用优化：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"><span class="keyword">const</span> key = <span class="title class_">Symbol</span>(<span class="string">&#x27;temp&#x27;</span>);</span><br><span class="line">wm.<span class="title function_">set</span>(key, largeData); <span class="comment">// WeakMap不阻止key被回收</span></span><br></pre></td></tr></table></figure></li></ol><hr><h4 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a><strong>最佳实践</strong></h4><ul><li><strong>按需选择作用域</strong>：优先使用局部 Symbol，仅在需要跨模块共享时用 <code>Symbol.for</code>。</li><li><strong>避免全局滥用</strong>：减少全局注册表的 Symbol 数量，防止内存驻留。</li><li><strong>结合 WeakMap</strong>：对需要关联 Symbol 与大数据量的场景，使用弱引用结构管理。</li></ul><h4 id="示例对比"><a href="#示例对比" class="headerlink" title="示例对比"></a><strong>示例对比</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通Symbol（独立内存）</span></span><br><span class="line"><span class="keyword">const</span> s1 = <span class="title class_">Symbol</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> s2 = <span class="title class_">Symbol</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">s1 === s2; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局Symbol（内存复用）</span></span><br><span class="line"><span class="keyword">const</span> g1 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> g2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">g1 === g2; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>Symbol 通过唯一性和协议扩展能力，为复杂系统设计提供底层支持，合理使用可提升代码健壮性，但需关注其内存特性以避免潜在问题。</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>深&#92;浅拷贝</title>
      <link href="/2025/05/11/JS/%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/"/>
      <url>/2025/05/11/JS/%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/</url>
      
        <content type="html"><![CDATA[<h3 id="深-浅拷贝"><a href="#深-浅拷贝" class="headerlink" title="深&#x2F;浅拷贝"></a>深&#x2F;浅拷贝</h3><p>深浅拷贝的核心区别在于<em><strong>是否递归复制对象的所有层级引用类型属性</strong></em>，常见实现方案如下：</p><hr><h4 id="浅拷贝实现"><a href="#浅拷贝实现" class="headerlink" title="浅拷贝实现"></a><strong>浅拷贝实现</strong></h4><blockquote><p>将原始对象或数组中的元素逐个复制到新对象或数组中</p><p>只会<strong>复制它们的引用</strong>，而不会创建这些嵌套对象或数组的新副本（改变原始对象会同时影响拷贝对象）</p></blockquote><ol><li><p><strong><code>Object.assign()</code></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">2</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">const</span> copy = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, obj);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy); <span class="comment">// &#123; a: 1, b: &#123; c: 2 &#125; &#125;</span></span><br><span class="line">obj.<span class="property">b</span>.<span class="property">c</span> = <span class="number">3</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">b</span>.<span class="property">c</span>); <span class="comment">// 输出: 3 (修改了原始对象的嵌套对象，影响到了浅拷贝)</span></span><br></pre></td></tr></table></figure></li><li><p><strong>扩展运算符（<code>...</code>）</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">2</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">const</span> copy = &#123; ...obj &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy); <span class="comment">// &#123; a: 1, b: &#123; c: 2 &#125; &#125;</span></span><br><span class="line">obj.<span class="property">b</span>.<span class="property">c</span> = <span class="number">3</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">b</span>.<span class="property">c</span>); <span class="comment">// 输出: 3 (同上)</span></span><br></pre></td></tr></table></figure></li><li><p><strong>数组方法</strong><br><code>slice</code>、<code>concat</code>等返回新数组，但嵌套对象仍共享引用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, &#123; <span class="attr">x</span>: <span class="number">2</span> &#125;];</span><br><span class="line"><span class="keyword">const</span> copy = arr.<span class="title function_">slice</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy); <span class="comment">// [1, &#123; x: 2 &#125;]</span></span><br><span class="line">arr[<span class="number">1</span>].<span class="property">x</span> = <span class="number">3</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy[<span class="number">1</span>].<span class="property">x</span>); <span class="comment">// 输出: 3 (同上)</span></span><br></pre></td></tr></table></figure></li></ol><hr><h4 id="深拷贝实现"><a href="#深拷贝实现" class="headerlink" title="深拷贝实现"></a><strong>深拷贝实现</strong></h4><blockquote><p>递归地复制整个对象及其嵌套的对象或数组，创建一个<strong>完全独立的新对象或数组</strong></p></blockquote><h5 id="1-JSON序列化（局限性明显）"><a href="#1-JSON序列化（局限性明显）" class="headerlink" title="1. JSON序列化（局限性明显）"></a><strong>1. JSON序列化（局限性明显）</strong></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> deepCopy = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">2</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">const</span> deepCopy = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(deepCopy); <span class="comment">// &#123; a: 1, b: &#123; c: 2 &#125; &#125;</span></span><br><span class="line">obj.<span class="property">b</span>.<span class="property">c</span> = <span class="number">3</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(deepCopy.<span class="property">b</span>.<span class="property">c</span>); <span class="comment">// 输出: 2 (未受影响)</span></span><br></pre></td></tr></table></figure><p><strong>缺点</strong>：</p><ul><li>忽略<code>undefined</code>、<code>Symbol</code>、函数属性</li><li>无法处理循环引用（如<code>obj.self = obj</code>）</li><li>破坏特殊对象类型（如<code>Date</code>转为字符串，<code>RegExp</code>转为空对象）</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;example&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="literal">undefined</span>,</span><br><span class="line">    <span class="attr">today</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">    <span class="attr">pattern</span>: <span class="regexp">/abc/g</span>,</span><br><span class="line">    <span class="attr">sayHello</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="property">self</span> = obj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> copiedObj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj)); <span class="comment">// 对象中有循环引用（即对象内部包含对其自身的引用），JSON.stringify() 会抛出错误</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copiedObj); <span class="comment">// 输出: &#123; name: &#x27;example&#x27; &#125; - undefined的属性，函数 都丢失了</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> copiedObj.<span class="property">today</span>); <span class="comment">// 输出: string - 原本的 Date 对象变成了字符串</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copiedObj.<span class="property">pattern</span>); <span class="comment">// 输出: undefined - 正则表达式丢失了</span></span><br></pre></td></tr></table></figure><blockquote><p><code>JSON.stringify()</code> 只会序列化对象的可枚举属性，任何不可枚举的属性都会被忽略。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(&#123;&#125;, &#123;</span><br><span class="line">    <span class="attr">hidden</span>: &#123;</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;This is hidden&quot;</span>,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">visible</span>: &#123;</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;This is visible&quot;</span>,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> copiedObj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copiedObj.<span class="property">hidden</span>); <span class="comment">// 输出: undefined - 非可枚举属性丢失</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copiedObj.<span class="property">visible</span>); <span class="comment">// 输出: &quot;This is visible&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p><code>JSON.stringify()</code> 只会序列化对象自身的属性，不会保留原型链上的属性或方法</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello, my name is &quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> copiedPerson = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(person));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copiedPerson); <span class="comment">// 输出: &#123; name: &#x27;Alice&#x27; &#125; - 原型链上的 sayHello 方法丢失了</span></span><br></pre></td></tr></table></figure><h5 id="2-递归手动实现"><a href="#2-递归手动实现" class="headerlink" title="2. 递归手动实现"></a><strong>2. 递归手动实现</strong></h5><blockquote><p>在这里放一个对象，以便更好地理解</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="attr">child</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;child&quot;</span>,</span><br><span class="line">        <span class="attr">sibling</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;sibling&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="property">child</span>.<span class="property">sibling</span>.<span class="property">parent</span> = obj; <span class="comment">// 创建循环引用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clonedObj = <span class="title function_">deepClone</span>(obj);</span><br></pre></td></tr></table></figure><p><strong>基础版本</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">target, map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">&#x27;object&#x27;</span> || target === <span class="literal">null</span>) <span class="keyword">return</span> target;</span><br><span class="line">    <span class="keyword">if</span> (map.<span class="title function_">has</span>(target)) <span class="keyword">return</span> map.<span class="title function_">get</span>(target); <span class="comment">// 解决循环引用</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cloneTarget = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(target) ? [] : &#123;&#125;;</span><br><span class="line">    map.<span class="title function_">set</span>(target, cloneTarget);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> target) &#123;</span><br><span class="line">        <span class="keyword">if</span> (target.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">            cloneTarget[key] = <span class="title function_">deepClone</span>(target[key], map); <span class="comment">// 递归</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cloneTarget;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>优化版本</strong>：处理特殊对象类型</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getType</span> = obj =&gt; <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj).<span class="title function_">slice</span>(<span class="number">8</span>, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">target, map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) &#123;</span><br><span class="line">  <span class="comment">// 基本类型直接返回</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">&#x27;object&#x27;</span> || target === <span class="literal">null</span>) <span class="keyword">return</span> target;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 处理循环引用</span></span><br><span class="line">  <span class="keyword">if</span> (map.<span class="title function_">has</span>(target)) <span class="keyword">return</span> map.<span class="title function_">get</span>(target);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 处理特殊对象</span></span><br><span class="line">  <span class="keyword">const</span> type = <span class="title function_">getType</span>(target);</span><br><span class="line">  <span class="keyword">let</span> clone;</span><br><span class="line">  <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Date&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(target.<span class="title function_">getTime</span>());</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;RegExp&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RegExp</span>(target.<span class="property">source</span>, target.<span class="property">flags</span>);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Set&#x27;</span>:</span><br><span class="line">      clone = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">      target.<span class="title function_">forEach</span>(<span class="function"><span class="params">v</span> =&gt;</span> clone.<span class="title function_">add</span>(<span class="title function_">deepClone</span>(v, map)));</span><br><span class="line">      <span class="keyword">return</span> clone;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Map&#x27;</span>:</span><br><span class="line">      clone = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">      target.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, k</span>) =&gt;</span> clone.<span class="title function_">set</span>(k, <span class="title function_">deepClone</span>(v, map)));</span><br><span class="line">      <span class="keyword">return</span> clone;</span><br><span class="line">    <span class="comment">// 其他类型如ArrayBuffer、TypedArray等类似处理</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      clone = <span class="keyword">new</span> target.<span class="title function_">constructor</span>(<span class="params"></span>); <span class="comment">// 保持原型链</span></span><br><span class="line">      map.<span class="title function_">set</span>(target, clone);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> target) &#123;</span><br><span class="line">        <span class="keyword">if</span> (target.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">          clone[key] = <span class="title function_">deepClone</span>(target[key], map);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> clone;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-使用第三方库"><a href="#3-使用第三方库" class="headerlink" title="3. 使用第三方库"></a><strong>3. 使用第三方库</strong></h5><ul><li><p><strong>Lodash的<code>_.cloneDeep</code></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> cloned = _.<span class="title function_">cloneDeep</span>(obj);</span><br></pre></td></tr></table></figure><p>支持复杂类型（如<code>Buffer</code>、<code>Error</code>对象）及循环引用。</p></li></ul><h5 id="4-浏览器原生API（结构化克隆）"><a href="#4-浏览器原生API（结构化克隆）" class="headerlink" title="4. 浏览器原生API（结构化克隆）"></a><strong>4. 浏览器原生API（结构化克隆）</strong></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用MessageChannel</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">structuredClone</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; port1, port2 &#125; = <span class="keyword">new</span> <span class="title class_">MessageChannel</span>();</span><br><span class="line">    port2.<span class="property">onmessage</span> = <span class="function"><span class="params">ev</span> =&gt;</span> <span class="title function_">resolve</span>(ev.<span class="property">data</span>);</span><br><span class="line">    port1.<span class="title function_">postMessage</span>(obj);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 或直接调用（需环境支持）</span></span><br><span class="line"><span class="keyword">const</span> cloned = <span class="variable language_">window</span>.<span class="title function_">structuredClone</span>(obj);</span><br></pre></td></tr></table></figure><p><strong>特点</strong>：</p><ul><li>支持循环引用、更多内置类型（如<code>Blob</code>、<code>File</code>）</li><li>兼容性问题：旧浏览器不支持<code>structuredClone</code>方法</li></ul><hr><h5 id="性能对比与选型建议"><a href="#性能对比与选型建议" class="headerlink" title="性能对比与选型建议"></a><strong>性能对比与选型建议</strong></h5><ul><li><strong>简单数据</strong>：优先用<code>JSON</code>方案（注意数据类型限制）</li><li><strong>复杂对象</strong>：推荐<code>Lodash.cloneDeep</code>或手动递归实现</li><li><strong>浏览器环境</strong>：优先用<code>structuredClone</code>（兼容时）</li><li><strong>高频深拷贝</strong>：可缓存函数或使用<code>Immutable.js</code>等不可变数据结构优化</li></ul><p><strong>循环引用测试</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line">obj.<span class="property">self</span> = obj;</span><br><span class="line"><span class="keyword">const</span> cloned = <span class="title function_">deepClone</span>(obj); <span class="comment">// 递归实现可正确处理</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cloned.<span class="property">self</span> === cloned); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>内存泄漏</title>
      <link href="/2025/05/11/JS/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/"/>
      <url>/2025/05/11/JS/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="内存泄漏"><a href="#内存泄漏" class="headerlink" title="内存泄漏"></a>内存泄漏</h3><blockquote><p><strong>不再使用的内存未被 GC 机制释放</strong>，导致 <strong>内存占用持续增长</strong>，最终可能引发性能问题或程序崩溃。</p><p>该问题只存在于启动的相关页面进程中，并不会永久性地占据电脑内存</p><p>一旦相关进程结束（关闭浏览器标签、重启浏览器或应用）操作系统会回收该进程占用的所有内存。</p></blockquote><h4 id="导致成因"><a href="#导致成因" class="headerlink" title="导致成因"></a>导致成因</h4><h5 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h5><blockquote><p>意外出现的全局变量</p><p><em><strong>全局变量不会被 GC 回收，直到页面关闭</strong></em></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">leak</span>(<span class="params"></span>) &#123;</span><br><span class="line">    leakedData = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1000000</span>); <span class="comment">// 未使用 var/let/const，变量变为全局变量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>使用严格模式（<code>&#39;use strict&#39;</code>）避免隐式全局变量</li></ul><h5 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h5><blockquote><p><em><strong>闭包引用的外部变量会长期驻留内存</strong></em></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createClosure</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> largeData = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1000000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(largeData); <span class="comment">// largeData 被闭包引用，会长期驻留内存</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> closure = <span class="title function_">createClosure</span>();</span><br></pre></td></tr></table></figure><ul><li>手动解除引用（如 <code>closure = null</code>）</li></ul><h5 id="定时器-回调函数"><a href="#定时器-回调函数" class="headerlink" title="定时器&amp;回调函数"></a>定时器&amp;回调函数</h5><blockquote><p><em><strong>定时器未清除时，回调函数及其引用变量无法释放</strong></em></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 长期运行的定时器，内部可能持有外部变量</span></span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><ul><li>使用 <code>clearInterval(timer)</code> 或 <code>clearTimeout</code> 及时清理</li></ul><h5 id="未解绑的DOM事件监听"><a href="#未解绑的DOM事件监听" class="headerlink" title="未解绑的DOM事件监听"></a>未解绑的DOM事件监听</h5><blockquote><p>DOM 元素被移除后，事件监听器仍可能持有引用</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> button = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">button.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, handleClick);</span><br><span class="line"><span class="comment">// 如果元素被移除但未解绑事件，handleClick 和关联的 DOM 元素可能泄漏</span></span><br></pre></td></tr></table></figure><ul><li>移除元素前调用 <code>removeEventListener</code></li></ul><h5 id="DOM引用残留"><a href="#DOM引用残留" class="headerlink" title="DOM引用残留"></a>DOM引用残留</h5><blockquote><p>JS 对象持有 DOM 引用时，DOM 元素无法被 GC 回收</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elements = &#123;</span><br><span class="line">    <span class="attr">button</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;button&#x27;</span>),</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 即使从页面移除 button，elements.button 仍保留对 DOM 的引用</span></span><br></pre></td></tr></table></figure><ul><li>手动解除引用（如 <code>elements.button = null</code>）</li></ul><h5 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h5><blockquote><p>未限制缓存大小，数据堆积导致内存占用上升</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cache = &#123;&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addToCache</span>(<span class="params">key, data</span>) &#123;</span><br><span class="line">    cache[key] = data; <span class="comment">// 缓存数据无限增长</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>使用 LRU 缓存策略或定期清理</li></ul><h4 id="排查方法"><a href="#排查方法" class="headerlink" title="排查方法"></a>排查方法</h4><p>使用Chrome浏览器 F12→Memory面板</p><p>选 Allocations on timeline</p><p>多次对比堆快照</p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250419024200478.png" alt="image-20250419024200478" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>垃圾回收机制</title>
      <link href="/2025/05/11/JS/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/"/>
      <url>/2025/05/11/JS/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="垃圾回收机制（GC）"><a href="#垃圾回收机制（GC）" class="headerlink" title="垃圾回收机制（GC）"></a>垃圾回收机制（GC）</h3><h4 id="核心思想"><a href="#核心思想" class="headerlink" title="核心思想"></a>核心思想</h4><p>垃圾回收器会定期检查堆内存的对象，判断哪些对象仍然被引用（“可达”）或不再被引用（“不可达”）</p><p>对于不可达的对象，垃圾回收器会将其占用的内存进行回收</p><blockquote><p>可达：该对象可以通过<strong>作用域链</strong>、<strong>全局对象</strong>或<strong>其他对象的引用</strong>来访问</p></blockquote><h4 id="回收算法"><a href="#回收算法" class="headerlink" title="回收算法"></a>回收算法</h4><h5 id="引用计数（已很少使用）"><a href="#引用计数（已很少使用）" class="headerlink" title="引用计数（已很少使用）"></a><strong>引用计数</strong>（已很少使用）</h5><p>每个对象都有一个引用计数器，记录有多少引用指向它</p><p>当引用计数为 0 时，表示该对象不可达，可以被回收</p><p><strong>但无法处理循环引用问题</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createCycle</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> obj1 = &#123;&#125;;</span><br><span class="line">    <span class="keyword">let</span> obj2 = &#123;&#125;;</span><br><span class="line">    obj1.<span class="property">ref</span> = obj2; <span class="comment">// obj1 引用 obj2</span></span><br><span class="line">    obj2.<span class="property">ref</span> = obj1; <span class="comment">// obj2 引用 obj1</span></span><br><span class="line">    <span class="keyword">return</span> [obj1, obj2];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> cycle = <span class="title function_">createCycle</span>();</span><br><span class="line">cycle = <span class="literal">null</span>; <span class="comment">// 即使外部没有引用，obj1 和 obj2 仍然互相引用</span></span><br></pre></td></tr></table></figure><h5 id="标记清除（最常用）"><a href="#标记清除（最常用）" class="headerlink" title="标记清除（最常用）"></a>标记清除（最常用）</h5><p>垃圾回收器从根对象（如全局对象）开始，递归地标记所有可达对象</p><p>标记完成后，未被标记的对象被视为不可达，其内存会被回收</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">name</span>: <span class="string">&quot;Alice&quot;</span> &#125;;</span><br><span class="line">obj = <span class="literal">null</span>; <span class="comment">// obj 不再引用对象，对象变为不可达</span></span><br><span class="line"><span class="comment">// 垃圾回收器会在下一次运行时回收该对象的内存</span></span><br></pre></td></tr></table></figure><h5 id="分代回收（现代-V8-引擎常用优化策略）"><a href="#分代回收（现代-V8-引擎常用优化策略）" class="headerlink" title="分代回收（现代 V8 引擎常用优化策略）"></a>分代回收（现代 V8 引擎常用优化策略）</h5><p>将堆内存分为不同的区域（称为“代”），根据对象的生命周期进行管理：</p><ul><li><strong>新生代（Young Generation）</strong>：存储短期对象，垃圾回收频率较高。</li><li><strong>老生代（Old Generation）</strong>：存储长期存活的对象，垃圾回收频率较低。</li></ul><p>新生代中的对象如果经过多次垃圾回收后仍然存活，则会被晋升到老生代。</p><h4 id="触发时机"><a href="#触发时机" class="headerlink" title="触发时机"></a>触发时机</h4><p><strong>内存不足时</strong> || <strong>周期性定时</strong></p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>V8引擎</title>
      <link href="/2025/05/11/JS/V8%E5%BC%95%E6%93%8E/"/>
      <url>/2025/05/11/JS/V8%E5%BC%95%E6%93%8E/</url>
      
        <content type="html"><![CDATA[<h3 id="V8引擎"><a href="#V8引擎" class="headerlink" title="V8引擎"></a>V8引擎</h3><blockquote><p>是一个由 Google 开发的高性能 JavaScript 引擎</p><p>为了提高 Chrome 浏览器中的 JavaScript 执行速度而设计的</p><p>能够将 JavaScript 代码直接编译成原生机器码并执行，而不是解释执行</p></blockquote><p><em><strong>工作原理</strong></em></p><p><strong>解析（Parsing）</strong>：当 JavaScript 代码被加载时，V8 首先将其解析为<strong>抽象语法树</strong>（AST）</p><p><strong>Ignition（解释器）</strong>：V8 使用名为 Ignition 的解释器来解释执行 AST</p><p><strong>TurboFan（优化编译器）</strong>：针对频繁执行的代码段，Ignition 会收集运行时信息，并将这些代码传递给 TurboFan 进行优化编译。TurboFan 能够生成高度优化的机器码，显著提高性能。</p><p><strong>垃圾回收（Garbage Collection, GC）</strong>：V8 实现了高效的内存管理机制，通过标记清除、分代收集等策略自动回收不再使用的对象，减少内存泄漏的风险。</p><p><em><strong>特性</strong></em></p><p><strong>即时编译（JIT Compilation）</strong>：不同于传统的解释型语言，V8 采用即时编译技术，在运行时动态地将字节码转换为机器码，以提升执行效率。</p><p><strong>隐藏类（Hidden Classes）</strong>：为了加速对象属性的访问速度，V8 在内部使用<strong>隐藏类替代传统原型链查找</strong>的方式，使得属性访问更加高效。</p><p><strong>内联缓存（Inline Caching）</strong>：这是一种基于类型预测的优化技术，通过记录方法调用时的对象类型来加快后续相同类型的调用速度。</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>栈/堆内存</title>
      <link href="/2025/05/11/JS/%E6%A0%88%E5%86%85%E5%AD%98-%E5%A0%86%E5%86%85%E5%AD%98/"/>
      <url>/2025/05/11/JS/%E6%A0%88%E5%86%85%E5%AD%98-%E5%A0%86%E5%86%85%E5%AD%98/</url>
      
        <content type="html"><![CDATA[<h3 id="栈-堆内存"><a href="#栈-堆内存" class="headerlink" title="栈&#x2F;堆内存"></a>栈&#x2F;堆内存</h3><h4 id="栈内存"><a href="#栈内存" class="headerlink" title="栈内存"></a>栈内存</h4><p>主要存储基本数据类型的值（ <code>Number</code>、<code>String</code>、<code>Boolean</code>、<code>Undefined</code>、<code>Null</code>、<code>Symbol</code> 和 <code>BigInt</code>）</p><p>还存储变量的<strong>引用地址</strong>（指向堆内存的对象）</p><p>函数调用时的执行上下文也会压入栈中</p><p>内存是连续分配的，大小固定，内存的访问、分配、释放都非常快</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">10</span>; <span class="comment">// 基本数据类型，存储在栈内存中</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="string">&quot;Hello&quot;</span>; <span class="comment">// 基本数据类型，存储在栈内存中</span></span><br><span class="line"><span class="keyword">let</span> c = <span class="literal">null</span>; <span class="comment">// 基本数据类型，存储在栈内存中</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> y = <span class="number">20</span>; <span class="comment">// 局部变量，存储在栈内存中</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x + y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(<span class="number">5</span>); <span class="comment">// 函数调用时，函数的执行上下文会被压入栈中</span></span><br></pre></td></tr></table></figure><h4 id="堆内存"><a href="#堆内存" class="headerlink" title="堆内存"></a>堆内存</h4><p>存储复杂数据类型的值（对象、数组、函数等）</p><p>还存储对象的属性、方法 &amp; 数组的元素</p><p>内存非连续分配，大小不固定，分配和释放都慢，因为需要动态管理内存，而且需要通过引用地址间接访问</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">name</span>: <span class="string">&quot;Alice&quot;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;; <span class="comment">// 对象存储在堆内存中</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; <span class="comment">// 数组存储在堆内存中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 栈内存中存储的是引用地址</span></span><br><span class="line"><span class="keyword">let</span> refObj = obj; <span class="comment">// refObj 和 obj 指向同一个堆内存地址</span></span><br><span class="line">refObj.<span class="property">age</span> = <span class="number">35</span>; <span class="comment">// 修改 refObj 的属性会影响 obj</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">age</span>); <span class="comment">// 输出: 35</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123; <span class="attr">name</span>: <span class="string">&quot;Alice&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> obj2 = obj1; <span class="comment">// 复制引用地址</span></span><br><span class="line">obj2.<span class="property">name</span> = <span class="string">&quot;Bob&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1.<span class="property">name</span>); <span class="comment">// 输出: Bob</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj2.<span class="property">name</span>); <span class="comment">// 输出: Bob</span></span><br></pre></td></tr></table></figure><h4 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h4><ul><li><strong>基本数据类型 vs 引用数据类型</strong>：<ul><li>基本数据类型直接存储在栈内存中，操作的是实际值。</li><li><strong>堆</strong>内存存储<strong>引用数据类型</strong>，<strong>栈</strong>内存中只存储<strong>引用地址</strong>。</li></ul></li><li><strong>引用传递 vs 值传递</strong>：<ul><li><em><strong>基本数据类型</strong></em>是值传递：赋值或作为参数传递时，会复制一份<strong>新的值</strong>。</li><li><em><strong>引用数据类型</strong></em>是引用传递：赋值或作为参数传递时，复制的是<strong>引用地址</strong>，<strong>多个变量可能指向同一个堆内存地址</strong>。</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>闭包</title>
      <link href="/2025/05/11/JS/%E9%97%AD%E5%8C%85/"/>
      <url>/2025/05/11/JS/%E9%97%AD%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><blockquote><p><em><strong>函数</strong></em> 与其 <em><strong>词法作用域</strong></em> 的结合</p></blockquote><ul><li>当一个 <strong>内部函数</strong> 访问其外部函数作用域中的变量时，即使外部函数已经执行完毕，内部函数仍然保留对外部变量的引用。</li><li>闭包的形成是因为函数的作用域链（Scope Chain）在定义时就已经确定，而非执行时。</li></ul><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><h5 id="计数器"><a href="#计数器" class="headerlink" title="计数器"></a>计数器</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createCounter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> count = <span class="number">0</span>; <span class="comment">// 当createCounter函数执行后本该被销毁</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">increment</span>: <span class="function">() =&gt;</span> count++, <span class="comment">// 但函数保留了对count的引用</span></span><br><span class="line">        <span class="attr">getCount</span>: <span class="function">() =&gt;</span> count,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counter = <span class="title function_">createCounter</span>();</span><br><span class="line">counter.<span class="title function_">increment</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="title function_">getCount</span>()); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h5 id="函数柯里化"><a href="#函数柯里化" class="headerlink" title="函数柯里化"></a>函数柯里化</h5><blockquote><p>一种函数式编程技术，它将一个多参数函数转换为一系列单参数函数</p><p>柯里化可以逐步传递参数，而不是一次性传递所有参数</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">add</span> = a =&gt; <span class="function"><span class="params">b</span> =&gt;</span> <span class="function"><span class="params">c</span> =&gt;</span> a + b + c;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> add5 = <span class="title function_">add</span>(<span class="number">5</span>); <span class="comment">// 固定 a = 5</span></span><br><span class="line"><span class="keyword">const</span> add5and3 = <span class="title function_">add5</span>(<span class="number">3</span>); <span class="comment">// 固定 b = 3</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add5and3</span>(<span class="number">2</span>)); <span class="comment">// 输出: 10 (5 + 3 + 2)</span></span><br></pre></td></tr></table></figure><blockquote><p>上面的例子中，<code>add5</code> 是一个闭包，它记住了 <code>a = 5</code>，并且可以在后续调用中使用这个值</p></blockquote><h4 id="核心作用"><a href="#核心作用" class="headerlink" title="核心作用"></a>核心作用</h4><ul><li><p>封装私有变量</p></li><li><p>延长变量生命周期</p></li></ul><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>闭包是指一个函数能够访问并记住其词法作用域中的变量，即使该函数在其作用域外执行。</p><p>它的核心原理是函数在定义时会绑定作用域链，使得内部函数可以访问外部函数的变量。闭包的典型应用包括封装私有变量（如计数器）、模块化开发、函数柯里化等。</p><p>需要注意的是，闭包可能导致内存泄漏，尤其是当它长期引用不再需要的大对象时。因此，在不需要时应及时解除引用（如将闭包赋值为 <code>null</code>）。此外，当闭包不再被任何地方引用时，其作用域链才会被垃圾回收。避免在频繁调用的函数（如循环体）中创建闭包，可能导致内存累积。</p><p>优先使用<code>let</code>定义块级变量，或在闭包中显式传递变量，避免意外共享。合理设计闭包生命周期，及时解除无用引用以优化内存。</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>事件循环</title>
      <link href="/2025/05/11/JS/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/"/>
      <url>/2025/05/11/JS/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/</url>
      
        <content type="html"><![CDATA[<h3 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h3><blockquote><p>JS是单线程语言，同一时间只能执行一个任务</p></blockquote><p>如果一个任务耗时过长（网络请求、文件读取），会阻塞后续代码的进行</p><p><strong>同步任务</strong>：立刻放入JS引擎（JS主线程）执行，原地等待结果</p><p><strong>异步任务</strong>：先放入宿主环境（浏览器&#x2F;Node），不阻塞主线程，在将来执行</p><h4 id="执行过程"><a href="#执行过程" class="headerlink" title="执行过程"></a>执行过程</h4><blockquote><p>过程中一共有三块环境：<strong>执行栈</strong>、<strong>宿主环境</strong>、<strong>任务队列</strong></p></blockquote><p>按代码上下文顺序</p><p>将同步任务压入执行栈</p><p>将异步任务压入宿主环境</p><p>在宿主环境中执行时机到来时（比如定时器到期），将宿主环境中异步任务（比如定时器）的<strong>回调函数</strong>推送给任务队列</p><p>此时执行栈会去看任务队列有没有异步任务需要执行，如果有则将异步任务推送到执行栈中执行</p><blockquote><p>执行栈在同步任务执行完后会反复地去任务队列看有没有需要执行的异步任务</p><p>这个反复查找的过程就叫事件循环</p></blockquote><h4 id="宏任务-微任务"><a href="#宏任务-微任务" class="headerlink" title="宏任务&#x2F;微任务"></a>宏任务&#x2F;微任务</h4><blockquote><p>JS将 <strong>异步任务</strong> 分为宏任务和微任务</p></blockquote><p><strong>宏任务</strong> 由 <strong>宿主</strong> 发起</p><blockquote><p>script (代码块)</p><p>setTimeout &#x2F; setInterval 定时器</p></blockquote><p><strong>微任务</strong> 由 <strong>JS引擎</strong> 发起</p><blockquote><p>promise (<strong>promise内部是同步</strong>，then&#x2F;catch是回调异步)</p><p>Async&#x2F;Await</p><p>procsee.nextTick (node)</p><p>Object.observe</p></blockquote><p><strong>执行顺序</strong></p><blockquote><p>先看执行栈（同步任务）→ 再看微任务队列（JS相关）→ 最后看宏任务队列</p></blockquote><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250419103641540.png" alt="image-20250419103641540"></p><blockquote><p>执行完一个宏任务，会再次清空微任务队列然后执行下一个任务</p></blockquote><h4 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">4</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">6</span>)</span><br></pre></td></tr></table></figure><blockquote><p>👆打印：135642</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="number">3</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><blockquote><p>👆打印：24531  （promise微任务看.then的位置而不是看resolve()）</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Proxy</title>
      <link href="/2025/05/11/JS/Proxy/"/>
      <url>/2025/05/11/JS/Proxy/</url>
      
        <content type="html"><![CDATA[<h3 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h3><blockquote><p>允许你创建一个代理对象来拦截并自定义基本操作（属性查找、赋值、枚举、函数调用等）</p></blockquote><h4 id="怎么用"><a href="#怎么用" class="headerlink" title="怎么用"></a>怎么用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, handler);</span><br></pre></td></tr></table></figure><ul><li><code>target</code>: 要代理的目标对象。</li><li><code>handler</code>: 一个包含 get&#x2F;set 等拦截方法的对象。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> target = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> handler = &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">obj, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop <span class="keyword">in</span> obj) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Getting <span class="subst">$&#123;prop&#125;</span>: <span class="subst">$&#123;obj[prop]&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> obj[prop];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;prop&#125;</span> 属性不存在`</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">obj, prop, value</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Setting <span class="subst">$&#123;prop&#125;</span> to <span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">        obj[prop] = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong><code>get</code></strong>(target, property, receiver)：拦截对象属性的<code>读取</code>操作。</li><li><strong><code>set</code></strong>(target, property, value, receiver)：拦截对象属性的<code>设置</code>操作。</li><li><strong><code>has</code></strong>(target, propKey)：拦截 <code>propKey in proxy</code> 的操作。</li><li><strong><code>deleteProperty</code></strong>(target, propKey)：拦截 <code>delete proxy[propKey]</code> 的操作。</li><li><strong><code>apply</code></strong>(target, thisArg, argumentsList)：拦截<code>函数调用</code>。</li><li><strong><code>construct</code></strong>(target, argumentsList, newTarget)：拦截 <code>new</code> 操作符。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy.<span class="property">name</span> = <span class="string">&quot;Alice&quot;</span>; <span class="comment">// 输出: Setting name to Alice</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(proxy.<span class="property">name</span>); <span class="comment">// 输出: Getting name: Alice</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(proxy.<span class="property">age</span>); <span class="comment">// 输出: age 属性不存在</span></span><br></pre></td></tr></table></figure><h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><p><strong>数据验证</strong></p><blockquote><p>可以在 <code>set</code> 拦截器中添加验证逻辑，确保只有符合特定条件的数据才能被设置到对象中。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> validator = &#123;</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">obj, prop, value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop === <span class="string">&#x27;age&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Number</span>.<span class="title function_">isInteger</span>(value)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;The age is not an integer&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (value &gt; <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RangeError</span>(<span class="string">&#x27;The age seems invalid&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        obj[prop] = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> <span class="title class_">Proxy</span>(&#123;&#125;, validator);</span><br><span class="line">person.<span class="property">age</span> = <span class="number">100</span>; <span class="comment">// 正常</span></span><br><span class="line">person.<span class="property">age</span> = <span class="string">&#x27;young&#x27;</span>; <span class="comment">// 抛出 TypeError</span></span><br></pre></td></tr></table></figure><p><strong>日志记录</strong></p><blockquote><p>可以使用 <code>get</code> 和 <code>set</code> 拦截器记录对对象的访问和修改情况。</p></blockquote><p><strong>性能监控</strong></p><blockquote><p>通过代理对象的方法调用，可以记录每次调用的时间消耗，用于性能分析。</p></blockquote><p><strong>私有属性管理</strong></p><blockquote><p>通过代理隐藏或保护对象的某些属性，使其不能被外部直接访问或修改。</p></blockquote><p><strong>撤销对象引用</strong></p><blockquote><p>使用 <code>Proxy.revocable()</code> 方法可以安全地撤销对某个对象的引用。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;proxy, revoke&#125; = <span class="title class_">Proxy</span>.<span class="title function_">revocable</span>(&#123;&#125;, &#123;&#125;);</span><br><span class="line">proxy.<span class="property">name</span> = <span class="string">&quot;Alice&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(proxy.<span class="property">name</span>); <span class="comment">// 输出: Alice</span></span><br><span class="line"><span class="title function_">revoke</span>(); <span class="comment">// 撤销对 name 的引用</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(proxy.<span class="property">name</span>); <span class="comment">// 抛出 TypeError 错误</span></span><br></pre></td></tr></table></figure><h4 id="手写Proxy实现数组响应式"><a href="#手写Proxy实现数组响应式" class="headerlink" title="手写Proxy实现数组响应式"></a>手写Proxy实现数组响应式</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">reactiveArray</span>(<span class="params">refArr, onChange</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> hander = &#123;</span><br><span class="line">        <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">            target[prop] = value</span><br><span class="line">            <span class="keyword">if</span> (prop != <span class="string">&#x27;length&#x27;</span>) &#123;</span><br><span class="line">                <span class="title function_">onChange</span>(target)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">deleteProperty</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">            <span class="keyword">delete</span> target[prop]</span><br><span class="line">            <span class="title function_">onChange</span>(target.<span class="title function_">slice</span>())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(refArr, hander)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myArray = <span class="title function_">reactiveArray</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="function">(<span class="params">newArr</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数组发生变化了&#x27;</span>, newArr)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">myArray.<span class="title function_">push</span>(<span class="number">4</span>) <span class="comment">// 数组发生变化了 [1, 2, 3, 4]</span></span><br><span class="line">myArray[<span class="number">0</span>] = <span class="number">5</span> <span class="comment">// 数组发生变化了 [5, 2, 3, 4]</span></span><br><span class="line">myArray.<span class="title function_">pop</span>() <span class="comment">// 数组发生变化了 [5, 2, 3]</span></span><br><span class="line">myArray.<span class="title function_">pop</span>() <span class="comment">// 数组发生变化了 [5, 2]</span></span><br><span class="line">myArray.<span class="title function_">pop</span>() <span class="comment">// 数组发生变化了 [5]</span></span><br><span class="line">myArray.<span class="title function_">pop</span>() <span class="comment">// 数组发生变化了 [空]</span></span><br><span class="line">myArray.<span class="title function_">pop</span>()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Promise 延展</title>
      <link href="/2025/05/11/JS/Promise%20%E5%BB%B6%E5%B1%95/"/>
      <url>/2025/05/11/JS/Promise%20%E5%BB%B6%E5%B1%95/</url>
      
        <content type="html"><![CDATA[<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><h4 id="什么是promise"><a href="#什么是promise" class="headerlink" title="什么是promise"></a>什么是promise</h4><p>作为<strong>异步函数</strong>，有四种状态</p><p>Pending 进行中（<em><strong>Pending</strong></em>）用 <code>new Promise()</code> 创建对象</p><p>Fulfilled 成功（<em><strong>Resolved</strong></em>）用 <code>.then()</code> 处理成功的结果</p><p>Rejected 失败 （<em><strong>Rejected</strong></em>）用 <code>.catch()</code> 处理失败</p><p>Finally 结束 （）用 <code>.finally()</code> 结束</p><h5 id="怎么用"><a href="#怎么用" class="headerlink" title="怎么用"></a>怎么用</h5><p>异步函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> step_1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//Promise对象</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;奶茶&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">step_2</span> = (<span class="params">tea</span>) =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//函数</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(tea + <span class="string">&quot;+珍珠&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">step_3</span> = (<span class="params">tea</span>) =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//函数</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(tea + <span class="string">&quot;+奶盖&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>链式调用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">step_1</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">tea</span> =&gt;</span> <span class="title function_">step_2</span>(tea))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">tea</span> =&gt;</span> <span class="title function_">step_3</span>(tea))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">tea</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;最终奶茶：&quot;</span>, tea);</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;失败：&quot;</span>, error);</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;结束并清理&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3s后打印</span></span><br><span class="line">最终奶茶：奶茶+珍珠+奶盖</span><br><span class="line">结束并清理</span><br></pre></td></tr></table></figure><p>普通函数的<strong>回调地狱</strong></p><blockquote><p>每次回调都要判断error</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">step_1</span>(<span class="function">(<span class="params">error, tea</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;失败：&quot;</span>, error);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">step_1</span>(tea, <span class="function">(<span class="params">error, tea</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;失败：&quot;</span>, error);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">step_1</span>(tea, <span class="function">(<span class="params">error, tea</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;失败：&quot;</span>, error);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;最终奶茶：&quot;</span>, tea);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h5><p><strong>网络请求</strong></p><blockquote><p>fetch返回一个promise对象</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> headers = &#123;</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        ...options.<span class="property">headers</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fetch</span>(url)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> error; <span class="comment">// 或直接返回错误信息</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetchData</span>(<span class="string">&quot;https://api.example.com/data1&quot;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;数据加载成功:&quot;</span>, data))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;数据加载失败:&quot;</span>, error));</span><br><span class="line"><span class="title function_">fetchData</span>(<span class="string">&quot;https://api.example.com/data2&quot;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;数据加载成功:&quot;</span>, data))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;数据加载失败:&quot;</span>, error));</span><br></pre></td></tr></table></figure><p><strong>统一错误处理</strong></p><blockquote><p>回调函数中需要手动检查每个步骤的错误。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">random</span>() &gt; <span class="number">0.5</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="string">&quot;成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(result))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;捕获错误:&quot;</span>, error));</span><br></pre></td></tr></table></figure><p><strong>状态管理</strong></p><blockquote><p>异步操作有三种状态：<code>pending</code>（进行中）、<code>fulfilled</code>（已完成）、<code>rejected</code>（已失败）</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;完成&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(promise); <span class="comment">// 输出: Promise &#123; &lt;pending&gt; &#125;</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(promise), <span class="number">1500</span>); <span class="comment">// 输出: Promise &#123; &lt;fulfilled&gt;: &quot;完成&quot; &#125;</span></span><br></pre></td></tr></table></figure><p><strong>链式调用</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">step1</span>()</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">result1</span> =&gt;</span> <span class="title function_">step2</span>(result1))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">result2</span> =&gt;</span> <span class="title function_">step3</span>(result2))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">finalResult</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(finalResult))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(error));</span><br></pre></td></tr></table></figure><h4 id="手写promise"><a href="#手写promise" class="headerlink" title="手写promise()"></a>手写promise()</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyPromise</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">executor</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;pending&#x27;</span>; <span class="comment">// Promise的状态：&#x27;pending&#x27;, &#x27;fulfilled&#x27;, &#x27;rejected&#x27;</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">undefined</span>; <span class="comment">// 成功时的值</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">undefined</span>; <span class="comment">// 失败时的原因</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span> = []; <span class="comment">// 存储成功回调</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span> = []; <span class="comment">// 存储失败回调</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">reason</span> = reason;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title function_">executor</span>(resolve, reject);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">        onFulfilled = <span class="keyword">typeof</span> onFulfilled === <span class="string">&#x27;function&#x27;</span> ? onFulfilled : <span class="function"><span class="params">value</span> =&gt;</span> value;</span><br><span class="line">        onRejected = <span class="keyword">typeof</span> onRejected === <span class="string">&#x27;function&#x27;</span> ? onRejected : <span class="function"><span class="params">reason</span> =&gt;</span> &#123; <span class="keyword">throw</span> reason &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> promise2 = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;fulfilled&#x27;</span>) &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">let</span> x = <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                        <span class="title function_">resolvePromise</span>(promise2, x, resolve, reject);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                        <span class="title function_">reject</span>(error);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;rejected&#x27;</span>) &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">let</span> x = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                        <span class="title function_">resolvePromise</span>(promise2, x, resolve, reject);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                        <span class="title function_">reject</span>(error);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;pending&#x27;</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">let</span> x = <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                            <span class="title function_">resolvePromise</span>(promise2, x, resolve, reject);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(error);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">let</span> x = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                            <span class="title function_">resolvePromise</span>(promise2, x, resolve, reject);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(error);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> promise2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">null</span>, onRejected);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助函数，处理promise链中的值传递</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Chaining cycle detected for promise&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> called;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (x !== <span class="literal">null</span> &amp;&amp; (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> x === <span class="string">&#x27;function&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> then = x.<span class="property">then</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                then.<span class="title function_">call</span>(x, <span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (called) <span class="keyword">return</span>;</span><br><span class="line">                    called = <span class="literal">true</span>;</span><br><span class="line">                    <span class="title function_">resolvePromise</span>(promise2, y, resolve, reject);</span><br><span class="line">                &#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (called) <span class="keyword">return</span>;</span><br><span class="line">                    called = <span class="literal">true</span>;</span><br><span class="line">                    <span class="title function_">reject</span>(err);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="keyword">if</span> (called) <span class="keyword">return</span>;</span><br><span class="line">            called = <span class="literal">true</span>;</span><br><span class="line">            <span class="title function_">reject</span>(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="什么是promise-all"><a href="#什么是promise-all" class="headerlink" title="什么是promise.all()"></a>什么是promise.all()</h4><blockquote><p>等待所有兑现（或第一个拒绝）的结果</p></blockquote><h5 id="怎么用-1"><a href="#怎么用-1" class="headerlink" title="怎么用"></a>怎么用</h5><p>例子1</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> step_1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//Promise对象</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;奶茶&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">step_2</span> = (<span class="params">tea</span>) =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//函数</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(tea + <span class="string">&quot;+珍珠&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">step_3</span> = (<span class="params">tea</span>) =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//函数</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(tea + <span class="string">&quot;+奶盖&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> step_4 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//Promise对象</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;最终收拾&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([step_1, step_4]).<span class="title function_">then</span>(<span class="function">(<span class="params">allstep</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(allstep);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;奶茶&quot;</span>, <span class="string">&quot;最终收拾&quot;</span>] <span class="comment">//1秒后打印</span></span><br></pre></td></tr></table></figure><p>例子2</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">step_1</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">tea</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">        <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(tea),<span class="comment">// step_1 的结果</span></span><br><span class="line">        <span class="title function_">step_2</span>(tea),         <span class="comment">// step_2 的结果</span></span><br><span class="line">        <span class="title function_">step_3</span>(tea),         <span class="comment">// step_3 的结果</span></span><br><span class="line">        step_4               <span class="comment">// step_4 的结果</span></span><br><span class="line">    ]);</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">results</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(results); <span class="comment">// 输出所有结果</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;奶茶&quot;</span>, <span class="string">&quot;奶茶+珍珠&quot;</span>, <span class="string">&quot;奶茶+奶盖&quot;</span>, <span class="string">&quot;最终收拾&quot;</span>] <span class="comment">//2秒后打印</span></span><br></pre></td></tr></table></figure><p>例子3</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promises = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    promises.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">`Promise <span class="subst">$&#123;i&#125;</span> 完成`</span>), <span class="number">1000</span>);</span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>(promises).<span class="title function_">then</span>(<span class="function"><span class="params">results</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(results);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="string">&quot;Promise 0 完成&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 1 完成&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 2 完成&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 3 完成&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 4 完成&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 5 完成&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 6 完成&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 7 完成&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 8 完成&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Promise 9 完成&quot;</span></span><br><span class="line">] <span class="comment">//1秒后打印</span></span><br></pre></td></tr></table></figure><h5 id="使用场景-1"><a href="#使用场景-1" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h5><blockquote><p>常用于数据聚合、资源加载、并发任务等场景</p></blockquote><p><strong>并行网络请求</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request1 = <span class="title function_">fetch</span>(<span class="string">&quot;https://api.example.com/data1&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>());</span><br><span class="line"><span class="keyword">const</span> request2 = <span class="title function_">fetch</span>(<span class="string">&quot;https://api.example.com/data2&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([request1, request2])</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">[data1, data2]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;请求1结果:&quot;</span>, data1);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;请求2结果:&quot;</span>, data2);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;请求失败:&quot;</span>, error));</span><br></pre></td></tr></table></figure><p><strong>数据聚合</strong></p><blockquote><p><code>Promise.all</code> 自动收集所有结果为一个数组，方便后续处理。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getUser</span> = (<span class="params"></span>) =&gt; <span class="title function_">fetch</span>(<span class="string">&quot;/user&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>());</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getOrders</span> = (<span class="params"></span>) =&gt; <span class="title function_">fetch</span>(<span class="string">&quot;/orders&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([<span class="title function_">getUser</span>(), <span class="title function_">getOrders</span>()])</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">[user, orders]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;用户信息:&quot;</span>, user);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;订单列表:&quot;</span>, orders);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;数据加载失败:&quot;</span>, error));</span><br></pre></td></tr></table></figure><p><strong>快速失败</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> task1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>), <span class="number">1000</span>));</span><br><span class="line"><span class="keyword">const</span> task2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_, reject</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">reject</span>(<span class="string">&quot;出错了&quot;</span>), <span class="number">500</span>));</span><br><span class="line"><span class="keyword">const</span> task3 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">3</span>), <span class="number">1000</span>));</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([task1, task2, task3])</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">results</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;所有任务完成:&quot;</span>, results))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;任务失败:&quot;</span>, error)); <span class="comment">// 输出: 任务失败: 出错了</span></span><br></pre></td></tr></table></figure><p><strong>统一处理多个异步任务</strong></p><blockquote><p>避免多次调用 <code>.then()</code> 或手动合并结果。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tasks = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;任务1完成&quot;</span>), <span class="number">1000</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;任务2完成&quot;</span>), <span class="number">1000</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;任务3完成&quot;</span>), <span class="number">1000</span>))</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>(tasks)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">results</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;所有任务结果:&quot;</span>, results))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;任务失败:&quot;</span>, error));</span><br><span class="line"><span class="comment">// 输出: 所有任务结果: [&quot;任务1完成&quot;, &quot;任务2完成&quot;, &quot;任务3完成&quot;]</span></span><br></pre></td></tr></table></figure><h4 id="手写promise-all"><a href="#手写promise-all" class="headerlink" title="手写promise.all()"></a>手写promise.all()</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myPromiseAll</span>(<span class="params">promises</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promises)) &#123; <span class="comment">// 是数组</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">// 每个元素都转换为 Promise</span></span><br><span class="line">            <span class="keyword">let</span> count = <span class="number">0</span> <span class="comment">// 记录已完成的任务数量</span></span><br><span class="line">            <span class="keyword">const</span> results = []</span><br><span class="line"></span><br><span class="line">            promises.<span class="title function_">forEach</span>(<span class="function">(<span class="params">promise, index</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise)</span><br><span class="line">                    .<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">                    results[index] = value <span class="comment">// 根据索引存</span></span><br><span class="line">                    count ++</span><br><span class="line">                    <span class="keyword">if</span> (count === promises.<span class="property">length</span>) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(results)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                    .<span class="title function_">catch</span>(reject)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;传入的参数不是数组&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">myPromiseAll</span>([</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>), <span class="number">3000</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">2</span>), <span class="number">2000</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">3</span>), <span class="number">1000</span>)),</span><br><span class="line">])</span><br><span class="line">    .<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">error</span>)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>GO?VO?AO?</title>
      <link href="/2025/04/03/JS/GO_VO_AO/"/>
      <url>/2025/04/03/JS/GO_VO_AO/</url>
      
        <content type="html"><![CDATA[<h1 id="GO-VO-AO"><a href="#GO-VO-AO" class="headerlink" title="GO?VO?AO?"></a>GO?VO?AO?</h1><p>我用 <strong>「剧场演出」</strong> 来比喻这些概念</p><h2 id="GO-（Global-Object）"><a href="#GO-（Global-Object）" class="headerlink" title="GO （Global Object）"></a>GO （Global Object）</h2><p><strong>全局上下文对象（就是全局变量）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var globalProp = &quot;剧场灯光&quot;;  // 🎯 放入GO</span><br><span class="line">function stageManager() &#123; /*...*/ &#125;  // 🎯 放入GO</span><br></pre></td></tr></table></figure><p><strong>预编译阶段</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GO = &#123;</span><br><span class="line">  globalProp: undefined,  // 先摆上道具标签</span><br><span class="line">  stageManager: function()&#123;...&#125;  // 导演剧本提前挂好</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>执行阶段</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GO = &#123;</span><br><span class="line">  globalProp: &quot;剧场灯光&quot;,  // 道具就位</span><br><span class="line">  stageManager: function()&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="VO-（Variable-Object）"><a href="#VO-（Variable-Object）" class="headerlink" title="VO （Variable Object）"></a>VO （Variable Object）</h2><p><strong>变量对象</strong></p><p><strong>每个执行上下文都有</strong></p><p><strong>上下文创建到销毁</strong></p><h2 id="AO-（Activation-Object）"><a href="#AO-（Activation-Object）" class="headerlink" title="AO （Activation Object）"></a>AO （Activation Object）</h2><p><strong>活动对象</strong></p><p><strong>函数调用时临时创建，调用结束销毁</strong></p><h2 id="用一个面试题例子来理解"><a href="#用一个面试题例子来理解" class="headerlink" title="用一个面试题例子来理解"></a>用一个面试题例子来理解</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var a = 1;</span><br><span class="line">function test() &#123;</span><br><span class="line">    console.log(a);  // 🤔 输出什么？</span><br><span class="line">    var a = 2;</span><br><span class="line">&#125;</span><br><span class="line">test();</span><br></pre></td></tr></table></figure><blockquote><p><strong>1.全局GO（初始）: { a: undefined, test: function }</strong></p><p><strong>2.</strong><code>var a = 1;</code>GO : { a: 1, test: function }</p><p><strong>3.</strong><code>test();</code>创建AO : { a: undefined }</p><p><strong>4.</strong><code>console.log(a)</code> : AO位于作用域最顶层，{ a: undefined } ，输出 <code>undefined</code></p><p><strong>5.</strong><code>var a = 2;</code>: AO : { a: 2 }</p><p><strong>6.调用函数结束，AO数据销毁，GO : { a: 1, test: function }</strong></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>音视频基础</title>
      <link href="/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80/"/>
      <url>/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="音视频基础"><a href="#音视频基础" class="headerlink" title="音视频基础"></a>音视频基础</h1><h3 id="录制原理"><a href="#录制原理" class="headerlink" title="录制原理"></a>录制原理</h3><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119142810942.png" alt="image-20250119142810942"></p><h3 id="播放原理"><a href="#播放原理" class="headerlink" title="播放原理"></a>播放原理</h3><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119143459229.png" alt="image-20250119143459229"></p><p>位深和帧率</p><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119143840320.png" alt="image-20250119143840320"></p><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119143952865.png" alt="image-20250119143952865"></p><p>1.5 码率<br>视频文件在单位时间内使用的数据流量。比如1Mbps。<br>大多数情况下码率越高 分辨率越高，也就越清晰。但模糊的视频文件大小(码率)也<br>可以很大，分辨率小的视频文件可能也比分辨率大的视频文件清晰。<br>对于同一个原始图像源的时候，同样的编码算法，则码率越高，图像的失真就会越小<br>视频画面就会越清晰</p><h2 id="视频基础"><a href="#视频基础" class="headerlink" title="视频基础"></a>视频基础</h2><h4 id="RGB-BGR"><a href="#RGB-BGR" class="headerlink" title="RGB &amp; BGR"></a>RGB &amp; BGR</h4><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119144557648.png" alt="image-20250119144557648"></p><h4 id="YUV"><a href="#YUV" class="headerlink" title="YUV"></a>YUV</h4><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119144858981.png" alt="image-20250119144858981"></p><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119145020883.png" alt="image-20250119145020883"></p><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119145216786.png" alt="image-20250119145216786"></p><h5 id="444"><a href="#444" class="headerlink" title="444"></a>444</h5><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119145531419.png" alt="image-20250119145531419"></p><h5 id="422"><a href="#422" class="headerlink" title="422"></a>422</h5><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119145642161.png" alt="image-20250119145642161"></p><h5 id="420（最常见）"><a href="#420（最常见）" class="headerlink" title="420（最常见）"></a>420（最常见）</h5><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119145818040.png" alt="image-20250119145818040"></p><h6 id="420-NV12"><a href="#420-NV12" class="headerlink" title="420 NV12"></a>420 NV12</h6><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119150048776.png" alt="image-20250119150048776"></p><h6 id="420-数据格式参考"><a href="#420-数据格式参考" class="headerlink" title="420 数据格式参考"></a>420 数据格式参考</h6><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119150151889.png" alt="image-20250119150151889"></p><h4 id="RGB-YUV转换"><a href="#RGB-YUV转换" class="headerlink" title="RGB &#x2F; YUV转换"></a>RGB &#x2F; YUV转换</h4><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119152018085.png" alt="image-20250119152018085"></p><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119152114934.png" alt="image-20250119152114934"></p><h3 id="帧"><a href="#帧" class="headerlink" title="帧"></a>帧</h3><h4 id="I帧-Intra-coded-frames"><a href="#I帧-Intra-coded-frames" class="headerlink" title="I帧(Intra coded frames)"></a>I帧(Intra coded frames)</h4><blockquote><p>I帧不需要参考其他画面而生成,解码时仅靠自己就重构完整图像<br>I帧图像采用帧内编码方式;<br>I帧所占数据的信息量比较大:<br>I帧图像是周期性出现在图像序列中的，出现频率可由编码器选择:<br>I帧是P帧和B帧的参考帧(其质量直接影响到同组中以后各的质量)<br>I帧是帧组GOP的基础帧(第一帧),在一组中只有一个|帧;<br>I帧不需要考虑运动矢量;</p></blockquote><p>类似截图，独立解码</p><h4 id="P帧"><a href="#P帧" class="headerlink" title="P帧"></a>P帧</h4><p>类似视频，依靠上一帧的数据，连续解码</p><h4 id="B帧"><a href="#B帧" class="headerlink" title="B帧"></a>B帧</h4><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119153224291.png" alt="image-20250119153224291"></p><p>依据前后帧解码</p><h4 id="解码顺序"><a href="#解码顺序" class="headerlink" title="解码顺序"></a>解码顺序</h4><p>先解出I帧，再解出P帧，进而解出B帧</p><h2 id="音频基础"><a href="#音频基础" class="headerlink" title="音频基础"></a>音频基础</h2><p>声音的频率是周期的倒数，它表示的是声音在1秒钟内的周期数，单位是赫兹(Hz)。干赫(kHz),即1000Hz,表示每秒振动1000次。声音按频率可作如下划分:<br>次声0<del>20Hz<br>人耳20Hz</del>20KHz<br>超声20KHz<del>1GHz<br>特超声1GHz</del>10THZ</p><p>数字音频</p><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119153940331.png" alt="image-20250119153940331"></p><p>根据Nyguist采样定律，要从采样中完全恢复原始信号波形采样频率必须至少是信号中最高频率的两倍。<br>前面提到人耳能听到的频率范围是[20H~20kHz，所以采样频率一般为44.1Khz，这样就能保证声音到达20Khz也能被数字化，从而使得经过数字化处理之后，人耳听到的声音质量不会被降低。<br>采样频率:<br>每秒钟采样的点的个数。常用的采样频率有，<br>22000(22kHz)无线广播。<br>44100(44.1kHz)CD音质。<br>48000(48kHz)数字电视，DVD。<br>96000(96kHz)蓝光，高清DVD.<br>192000(192kHz)蓝光，高清DVD。</p><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119154153095.png" alt="image-20250119154153095"></p><p>采样精度(采样深度):每个“样本点”的大小常用的大小为8bit，16bit，24bit。<br>通道数:单声道，双声道，四声道，5.1声道。</p><p>比特率:每秒传输的bit数，单位为:bps(Bit PerSecond) 间接衡量声音质量的一个标准。<br>没有压缩的音频数据的比特率 &#x3D;采样频率<em>采样精度</em>通道数</p><p>码率:<br>压缩后的音频数据的比特率。常见的码率<br>96kbps: FM质量<br>128-160kbps:一般质量音频。<br>192kbps:CD质量。<br>256-320Kbps:高质量音频</p><p>码率越大，压缩效率越低，青音质越好，压缩后数据越大。<br>码率 &#x3D; 音频文件大小 &#x2F; 时长。</p><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119155047124.png" alt="image-20250119155047124"></p><p>帧:每次编码的采样单元数，比如MP3通常是1152个采样点作为一个编码单元，AAC通常是1024个采样点作为一个编码单元。</p><p>帧长:<br>可以指每帧播放持续的时间:每帧持续时间(秒)&#x3D;每帧采样点数&#x2F;采样频率(HZ)<br>比如:MP3 48k,1152个采样点,每帧则为 24毫秒<br>1152&#x2F;48000&#x3D;0.024秒&#x3D;24毫秒:<br>也可以指压缩后每帧的数据长度。</p><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119155325314.png" alt="image-20250119155325314"></p><p>数字音频信号如果不加压缩地直接进行传送，将会占用极大的带宽，<br>例如，一套双声道数字音频若取样频率为44.1KHz，每样值按16bit量化，则其码率为:<br>2<em>44.1kHz</em>16bit&#x3D;1.411Mbit&#x2F;s<br>如此大的带宽将给信号的传输和处理都带来许多困难和成本(阿里云服务<br>器带宽大于5M后，每M价格是100元&#x2F;月)<br>因此必须采取音频压缩技术对音频数据进行处理，才能有效地传输音频数据。<br>数字音频压缩编码在保证信号在听觉方面不产生失真的前提下，对音频数据信号进行尽可能大的压缩，降低数据量。数字音频压缩编码采取去除声音信号中兄余成分的方法来实现。所谓兄余成分指的是音频中不能被人耳感知到的信号，它们对确定声音的音色，音调等信息没有任何的帮助。</p><p>冗余信号包含人耳听觉范围外的音频信号以及被掩蔽掉的音频信号等。例如，人耳所能察觉的声音信号的频率范围为20Hz~20KHZ，除此之外的其它频率人耳无法察觉，都可视为冗余信号。<br>此外，根据人耳听觉的生理和心理声学现象，当一个强音信号与个弱音信号同时存在时，弱音信号将被强音信号所掩蔽而听不见这样弱音信号就可以视为冗余信号而不用传送。这就是人耳听觉的掩蔽效应，主要表现在频谱掩蔽效应和时域掩蔽效应。</p><p>常见视频封装格式</p><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119160306839.png" alt="image-20250119160306839"></p><p>音视频同步</p><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119160323497.png" alt="image-20250119160323497"></p><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250119160421595.png" alt="image-20250119160421595"></p>]]></content>
      
      
      <categories>
          
          <category> 技术探索 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>FFmpeg实战</title>
      <link href="/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/FFmpeg%E5%AE%9E%E6%88%98/"/>
      <url>/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/FFmpeg%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<h1 id="FFmpeg实战"><a href="#FFmpeg实战" class="headerlink" title="FFmpeg实战"></a>FFmpeg实战</h1><p>ffmpeg</p><blockquote><p>Hyper fast Audio and Video encoder  超快音视频编码器 (类似剪辑)</p></blockquote><p>ffplay:</p><blockquote><p>Simple media player  简单媒体播放器</p></blockquote><p>ffprobe:</p><blockquote><p>Simple multimedia streams analyzer  简单多媒体流分析器</p></blockquote><h3 id="处理流程"><a href="#处理流程" class="headerlink" title="处理流程"></a>处理流程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i test 1920x1080.mp4 -acodec copy -vcodec libx264-s 1280x720 test 1280x720.flv</span><br></pre></td></tr></table></figure><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120001356595.png" alt="image-20250120001356595"></p><h3 id="ffmpeg命令"><a href="#ffmpeg命令" class="headerlink" title="ffmpeg命令"></a>ffmpeg命令</h3><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120002226077.png" alt="image-20250120002226077"></p><p><strong>复用器和解复用器的区别</strong></p><ul><li><strong>复用器（Multiplexer, MUX）</strong>：（E）<ul><li><strong>功能</strong>：将多个信号或数据流合并成一个单一的信号或数据流进行传输。</li><li><strong>应用场景</strong>：在数据传输中，复用器常用于将多个低速信号合并为一个高速信号，以便在单一通道上传输，从而提高传输效率。</li></ul></li><li><strong>解复用器（Demultiplexer, DEMUX）</strong>：（D）<ul><li><strong>功能</strong>：将单个合并后的信号或数据流分解回原始的多个信号或数据流。</li><li><strong>应用场景</strong>：在数据接收端，解复用器负责将传输过来的合并信号还原为原始的多个信号，以便各个信号能够被正确地识别和处理。</li></ul></li></ul><p><strong>ffmpeg-codecs</strong></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120004617680.png" alt="image-20250120004617680" style="zoom:67%;" /><p>解码支持Decoding supported<br>编码支持Encoding supported<br>视频编解码器Video codec<br>音频编解码器Audio codec<br>副标题编解码器Subtitle codec<br>仅帧内编解码器Intra frame-only codec<br>有损压缩Lossy compression<br>无损压缩Lossless compression</p><p><strong>ffmpeg-decoders</strong></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120005217655.png" alt="image-20250120005217655" style="zoom:67%;" /><p><strong>ffmpeg-encoders</strong></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120005623578.png" alt="image-20250120005623578" style="zoom:67%;" /><p><strong>ffmpeg-bsfs</strong></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120005835812.png" alt="image-20250120005835812" style="zoom:67%;" /><p><strong>ffmpeg-protocols</strong></p><p>注意输出次数数，分有input和output</p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120005749175.png" alt="image-20250120005749175" style="zoom:67%;" /><p><strong>ffmpeg-pix_fmts</strong></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250120010202742.png" alt="image-20250120010202742" style="zoom:67%;" /><p>更多的看视频把</p><h4 id="查看具体分类所支持的参数"><a href="#查看具体分类所支持的参数" class="headerlink" title="查看具体分类所支持的参数"></a>查看具体分类所支持的参数</h4><p>语法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmepg -h type=name</span><br></pre></td></tr></table></figure><p>比如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -h muxer=flv</span><br><span class="line">ffmpeg -h filter=atempo (atempo调整音频播放速率)</span><br><span class="line">ffmpeg -h encoder=libx264</span><br></pre></td></tr></table></figure><h3 id="ffplay命令"><a href="#ffplay命令" class="headerlink" title="ffplay命令"></a>ffplay命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">《明末万里行-与满穗同行的十年》.mp4</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffplay 文件名</span><br></pre></td></tr></table></figure><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250124235101515.png" alt="image-20250124235101515" style="zoom:67%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffplay -volume 1 《明末万里行-与满穗同行的十年》.mp4</span><br></pre></td></tr></table></figure><p>基础选项</p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250125001351564.png" alt="image-20250125001351564" style="zoom:50%;" /><p>高级选项</p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250125002712288.png" alt="image-20250125002712288" style="zoom:67%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250125003240368.png" alt="image-20250125003240368" style="zoom:67%;" />]]></content>
      
      
      <categories>
          
          <category> 技术探索 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>力扣Hot100</title>
      <link href="/2025/04/03/%E8%B5%84%E6%BA%90/%E5%8A%9B%E6%89%A3Hot100/"/>
      <url>/2025/04/03/%E8%B5%84%E6%BA%90/%E5%8A%9B%E6%89%A3Hot100/</url>
      
        <content type="html"><![CDATA[<h1 id="力扣Hot100"><a href="#力扣Hot100" class="headerlink" title="力扣Hot100"></a>力扣Hot100</h1><h2 id="1-两数之和"><a href="#1-两数之和" class="headerlink" title="1.两数之和"></a>1.两数之和</h2><h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> twoSum = <span class="keyword">function</span>(<span class="params">nums, target</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();<span class="comment">// 创建一个哈希表用于存储已遍历的数字及其索引</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nums.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> now = nums[i];</span><br><span class="line">        <span class="keyword">const</span> oth = target - now;<span class="comment">// 目标值的补数</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (map.<span class="title function_">has</span>(oth)) &#123;<span class="comment">// 检查哈希表</span></span><br><span class="line">            <span class="keyword">return</span> [map.<span class="title function_">get</span>(oth), i];<span class="comment">//返回当前索引和补数的索引</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        map.<span class="title function_">set</span>(now, i);<span class="comment">// 将当前数字及其索引存入哈希表</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="forEach"><a href="#forEach" class="headerlink" title="forEach"></a>forEach</h3><blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="title function_">forEach</span>(<span class="function">(<span class="params">element, index, array</span>) =&gt;</span> &#123; <span class="comment">/* … */</span> &#125;)</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> twoSum = <span class="keyword">function</span>(<span class="params">nums, target</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    <span class="keyword">let</span> res;</span><br><span class="line"></span><br><span class="line">    nums.<span class="title function_">forEach</span>(<span class="function">(<span class="params">now, i</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> oth = target - now;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (map.<span class="title function_">has</span>(oth)) &#123;</span><br><span class="line">            res = [map.<span class="title function_">get</span>(oth), i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        map.<span class="title function_">set</span>(now, i);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (res) &#123; <span class="keyword">return</span> result; &#125; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="3-无重复字符最长字串"><a href="#3-无重复字符最长字串" class="headerlink" title="3.无重复字符最长字串"></a>3.无重复字符最长字串</h2><blockquote><p>const map &#x3D; new Set()</p><p>双指针</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lengthOfLongestSubstring = <span class="keyword">function</span>(<span class="params">s</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> ans = <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> l = <span class="number">0</span></span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> r=<span class="number">0</span>; r&lt;s.<span class="property">length</span>; r++)&#123;</span><br><span class="line">        <span class="keyword">let</span> c=s[r]</span><br><span class="line">        <span class="keyword">while</span>(map.<span class="title function_">has</span>(c))&#123;</span><br><span class="line">            map.<span class="title function_">delete</span>(s[l])</span><br><span class="line">            l++</span><br><span class="line">        &#125;</span><br><span class="line">        map.<span class="title function_">add</span>(c)</span><br><span class="line">        <span class="keyword">if</span>(ans&lt;r-l+<span class="number">1</span>)&#123;</span><br><span class="line">            ans=r-l+<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="17-电话号码"><a href="#17-电话号码" class="headerlink" title="17.电话号码"></a>17.电话号码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> letterCombinations = <span class="keyword">function</span>(<span class="params">digits</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (digits.<span class="property">length</span> == <span class="number">0</span>) <span class="keyword">return</span> [];</span><br><span class="line">    <span class="keyword">const</span> res = [];</span><br><span class="line">    <span class="keyword">const</span> map = &#123; <span class="string">&#x27;2&#x27;</span>: <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;3&#x27;</span>: <span class="string">&#x27;def&#x27;</span>, <span class="string">&#x27;4&#x27;</span>: <span class="string">&#x27;ghi&#x27;</span>, <span class="string">&#x27;5&#x27;</span>: <span class="string">&#x27;jkl&#x27;</span>, <span class="string">&#x27;6&#x27;</span>: <span class="string">&#x27;mno&#x27;</span>, <span class="string">&#x27;7&#x27;</span>: <span class="string">&#x27;pqrs&#x27;</span>, <span class="string">&#x27;8&#x27;</span>: <span class="string">&#x27;tuv&#x27;</span>, <span class="string">&#x27;9&#x27;</span>: <span class="string">&#x27;wxyz&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">dfs</span> = (<span class="params">now, i</span>) =&gt; &#123;        <span class="comment">// now是当前字符串，i是扫描的指针</span></span><br><span class="line">        <span class="keyword">if</span> (i &gt; digits.<span class="property">length</span> - <span class="number">1</span>) &#123; <span class="comment">// 指针越界，递归出口</span></span><br><span class="line">            res.<span class="title function_">push</span>(now);           <span class="comment">// 将解推入res</span></span><br><span class="line">            <span class="keyword">return</span>;                  <span class="comment">// 结束当前递归分支</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> strs = map[digits[i]]; <span class="comment">// 当前数字对应的字母</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> str <span class="keyword">of</span> strs) &#123;    <span class="comment">// 选中str</span></span><br><span class="line">            <span class="title function_">dfs</span>(now + str, i + <span class="number">1</span>);   <span class="comment">// now + str 合并字符串并传递</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">dfs</span>(<span class="string">&#x27;&#x27;</span>, <span class="number">0</span>); <span class="comment">// 递归的入口，初始字符串为&#x27;&#x27;，从按的第一个数开始</span></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="20-括号栈"><a href="#20-括号栈" class="headerlink" title="20.括号栈"></a>20.括号栈</h2><blockquote><p>入栈右括号</p><p>([)]</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isValid = <span class="keyword">function</span>(<span class="params">s</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (s.<span class="property">length</span> % <span class="number">2</span>) &#123; <span class="comment">// s 长度必须是偶数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> map = &#123;<span class="string">&#x27;(&#x27;</span>: <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;[&#x27;</span>: <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>: <span class="string">&#x27;&#125;&#x27;</span>&#125;;</span><br><span class="line">    <span class="keyword">const</span> strs = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> str <span class="keyword">of</span> s) &#123;</span><br><span class="line">        <span class="keyword">if</span> (map[str]) &#123; <span class="comment">// str 是左括号</span></span><br><span class="line">            strs.<span class="title function_">push</span>(map[str]); <span class="comment">// 入栈右括号</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strs.<span class="property">length</span> === <span class="number">0</span> || strs.<span class="title function_">pop</span>() !== str) &#123; <span class="comment">// str 是右括号</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 没有左括号，或者左括号类型不对</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> strs.<span class="property">length</span> === <span class="number">0</span>; <span class="comment">// 所有左括号必须匹配完毕</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="22-括号生成"><a href="#22-括号生成" class="headerlink" title="22.括号生成"></a>22.括号生成</h2><blockquote><p><strong>dfs</strong> (<em>填入括号数</em>，<em>左括号数</em>)</p><p>注意填入右括号的判断逻辑</p></blockquote><blockquote><p><strong><code>join()</code></strong> 将一个数组的所有元素 <strong>连接成一个字符串</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">join() </span><br><span class="line">join(符号)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(array.<span class="title function_">join</span>());<span class="comment">//逗号分</span></span><br><span class="line"><span class="comment">// &quot;A,B,C&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(array.<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>));<span class="comment">//不分</span></span><br><span class="line"><span class="comment">// &quot;ABC&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(array.<span class="title function_">join</span>(<span class="string">&quot;-&quot;</span>));<span class="comment">//-分</span></span><br><span class="line"><span class="comment">// &quot;A-B-C&quot;</span></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> generateParenthesis = <span class="keyword">function</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> res = []</span><br><span class="line">    <span class="keyword">const</span> max = <span class="number">2</span>*n</span><br><span class="line">    <span class="keyword">const</span> path = <span class="title class_">Array</span>(max)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> dfs = (<span class="function">(<span class="params">sum,l</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sum===max)&#123;<span class="comment">//填满了</span></span><br><span class="line">            res.<span class="title function_">push</span>(path.<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(l&lt;n)&#123;<span class="comment">//填&#x27;(&#x27;</span></span><br><span class="line">            path[sum]=<span class="string">&#x27;(&#x27;</span></span><br><span class="line">            <span class="title function_">dfs</span>(sum+<span class="number">1</span>,l+<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(sum-l&lt;l)&#123;<span class="comment">//填&#x27;)&#x27;</span></span><br><span class="line">            path[sum]=<span class="string">&#x27;)&#x27;</span></span><br><span class="line">            <span class="title function_">dfs</span>(sum+<span class="number">1</span>,l)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">dfs</span>(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="46-全排列"><a href="#46-全排列" class="headerlink" title="46.全排列"></a>46.全排列</h2><blockquote><p><em><strong>array.slice (start, end)</strong></em></p><p>若省略则为 0-end</p></blockquote><blockquote><p><strong>JavaScript</strong> 中数组是<strong>引用类型</strong></p><p><strong>.slics</strong> 是一个 <strong>浅拷贝</strong> 操作</p><p>创建一个新的数组副本，并将这个副本加入到结果</p><p>本题如果写 <code>res.push(path)</code>：是将 <code>path</code> 的<strong>引用</strong>（而不是副本）push 到 res 中</p><ol><li><p>初始状态：<code>path = []</code>, <code>res = []</code>。</p></li><li><p>第一次递归：</p><ul><li>选择 <code>1</code>，更新 <code>path = [1]</code>。</li></ul></li><li><p>第二次递归：</p><ul><li><p>选择 <code>2</code>，更新 <code>path = [1, 2]</code>。</p></li><li><p>当前路径长度等于数组长度，执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.push(path)</span><br></pre></td></tr></table></figure><ul><li>此时，<code>res = [[1, 2]]</code>，但 <code>res[0]</code> 是对 <code>path</code> 的引用。</li></ul></li></ul></li><li><p>回溯：</p><ul><li>撤销选择 <code>2</code>，更新 <code>path = [1]</code>。</li><li>撤销选择 <code>1</code>，更新 <code>path = []</code>。</li></ul></li><li><p>最终状态：</p><ul><li><code>path = []</code>，而 <code>res</code> 中存储的是对 <code>path</code> 的引用。</li><li>因此，<code>res = [[], []]</code>。</li></ul></li></ol></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">permute</span> = (<span class="params">nums</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = [];</span><br><span class="line">    <span class="keyword">const</span> isused = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">dfs</span> = (<span class="params">path</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (path.<span class="property">length</span> == nums.<span class="property">length</span>) &#123; <span class="comment">// 选够了</span></span><br><span class="line">            res.<span class="title function_">push</span>(path.<span class="title function_">slice</span>()); <span class="comment">// 拷贝一份path，加入解集res</span></span><br><span class="line">            <span class="keyword">return</span>;                 <span class="comment">// 结束当前递归分支</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> num <span class="keyword">of</span> nums) &#123; <span class="comment">// for枚举出每个可选的选项</span></span><br><span class="line">            <span class="comment">// if (path.includes(num)) continue; // 不行！查找是O(n)</span></span><br><span class="line">            <span class="keyword">if</span> (isused[num]) <span class="keyword">continue</span>; <span class="comment">// 使用过的，跳过</span></span><br><span class="line">            path.<span class="title function_">push</span>(num);         <span class="comment">// 选择当前的数，加入path</span></span><br><span class="line">            isused[num] = <span class="literal">true</span>;       <span class="comment">// 记录一下 使用了</span></span><br><span class="line">            <span class="title function_">dfs</span>(path);              <span class="comment">// 基于选了当前的数，递归</span></span><br><span class="line">            path.<span class="title function_">pop</span>();             <span class="comment">// 上一句的递归结束，回溯，将最后选的数pop出来</span></span><br><span class="line">            isused[num] = <span class="literal">false</span>;      <span class="comment">// 撤销这个记录</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">dfs</span>([]); <span class="comment">// 递归的入口，空path传进去</span></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="70-爬楼梯"><a href="#70-爬楼梯" class="headerlink" title="70.爬楼梯"></a>70.爬楼梯</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> climbStairs = <span class="keyword">function</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sqrt_5 = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">const</span> fib_n = <span class="title class_">Math</span>.<span class="title function_">pow</span>((<span class="number">1</span> + sqrt_5) / <span class="number">2</span>, n + <span class="number">1</span>) - <span class="title class_">Math</span>.<span class="title function_">pow</span>((<span class="number">1</span> - sqrt_5) / <span class="number">2</span>,n + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">round</span>(fib_n / sqrt_5);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="78-子集"><a href="#78-子集" class="headerlink" title="78.子集"></a>78.子集</h2><blockquote><p>遍历树</p><p>dfs里的两种状态</p><p>不选 &#x2F; 选</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subsets = <span class="keyword">function</span>(<span class="params">nums</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> n = nums.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">const</span> ans = []</span><br><span class="line">    <span class="keyword">const</span> path = []</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dfs</span>(<span class="params">i</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i === n) &#123; <span class="comment">// 子集构造完毕</span></span><br><span class="line">            ans.<span class="title function_">push</span>(path.<span class="title function_">slice</span>()); <span class="comment">// 复制 path</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 不选 nums[i]</span></span><br><span class="line">        <span class="title function_">dfs</span>(i + <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 选 nums[i]</span></span><br><span class="line">        path.<span class="title function_">push</span>(nums[i]);</span><br><span class="line">        <span class="title function_">dfs</span>(i + <span class="number">1</span>);</span><br><span class="line">        path.<span class="title function_">pop</span>(); <span class="comment">// 恢复现场</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">dfs</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="94-二叉树中序遍历"><a href="#94-二叉树中序遍历" class="headerlink" title="94.二叉树中序遍历"></a>94.二叉树中序遍历</h2><blockquote><p>先递归左子树，再访问根节点，接着递归右子树</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inorderTraversal = <span class="keyword">function</span> (<span class="params">root</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> ans = [];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">dfs</span> = root =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">dfs</span>(root.<span class="property">left</span>);</span><br><span class="line">        ans.<span class="title function_">push</span>(root.<span class="property">val</span>);</span><br><span class="line">        <span class="title function_">dfs</span>(root.<span class="property">right</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">dfs</span>(root);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="101-对称二叉树"><a href="#101-对称二叉树" class="headerlink" title="101.对称二叉树"></a>101.对称二叉树</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isSymmetric = <span class="keyword">function</span>(<span class="params">root</span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">isSameTree</span>(<span class="params">p, q</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p === <span class="literal">null</span> || q === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> p === q;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p.<span class="property">val</span> === q.<span class="property">val</span> &amp;&amp; <span class="title function_">isSameTree</span>(p.<span class="property">left</span>, q.<span class="property">right</span>) &amp;&amp; <span class="title function_">isSameTree</span>(p.<span class="property">right</span>, q.<span class="property">left</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isSameTree</span>(root.<span class="property">left</span>, root.<span class="property">right</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="104-二叉树最大深度"><a href="#104-二叉树最大深度" class="headerlink" title="104.二叉树最大深度"></a>104.二叉树最大深度</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> maxDepth = <span class="keyword">function</span>(<span class="params">root</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> ans = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> dfs = (<span class="function">(<span class="params">root,deep</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (deep&gt;ans)ans=deep</span><br><span class="line">        <span class="keyword">if</span> (!root) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">dfs</span>(root.<span class="property">left</span>,deep+<span class="number">1</span>);</span><br><span class="line">        <span class="title function_">dfs</span>(root.<span class="property">right</span>,deep+<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">dfs</span>(root, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="136-只出现一次的数"><a href="#136-只出现一次的数" class="headerlink" title="136.只出现一次的数"></a>136.只出现一次的数</h2><blockquote><p>异或 <code>^</code></p><p><code>a⊕0 = a</code></p><p><code>a⊕a = 0</code></p><p>满足交换律和结合律：<code>a⊕b⊕a</code> &#x3D; (a⊕a)⊕b &#x3D; 0⊕b &#x3D; <code>b</code></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> singleNumber = <span class="keyword">function</span>(<span class="params">nums</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> ans = <span class="number">0</span></span><br><span class="line">    nums.<span class="title function_">forEach</span>(<span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">        ans ^= num</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="148-排序链表（-）"><a href="#148-排序链表（-）" class="headerlink" title="148.排序链表（?）"></a>148.排序链表（?）</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 876. 链表的中间结点（快慢指针）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">middleNode</span>(<span class="params">head</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> pre = head, slow = head, fast = head;</span><br><span class="line">    <span class="keyword">while</span> (fast &amp;&amp; fast.<span class="property">next</span>) &#123;</span><br><span class="line">        pre = slow; <span class="comment">// 记录 slow 的前一个节点</span></span><br><span class="line">        slow = slow.<span class="property">next</span>;</span><br><span class="line">        fast = fast.<span class="property">next</span>.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pre.<span class="property">next</span> = <span class="literal">null</span>; <span class="comment">// 断开 slow 的前一个节点和 slow 的连接</span></span><br><span class="line">    <span class="keyword">return</span> slow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 21. 合并两个有序链表（双指针）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mergeTwoLists</span>(<span class="params">list1, list2</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dummy = <span class="keyword">new</span> <span class="title class_">ListNode</span>(); <span class="comment">// 用哨兵节点简化代码逻辑</span></span><br><span class="line">    <span class="keyword">let</span> cur = dummy; <span class="comment">// cur 指向新链表的末尾</span></span><br><span class="line">    <span class="keyword">while</span> (list1 &amp;&amp; list2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (list1.<span class="property">val</span> &lt; list2.<span class="property">val</span>) &#123;</span><br><span class="line">            cur.<span class="property">next</span> = list1; <span class="comment">// 把 list1 加到新链表中</span></span><br><span class="line">            list1 = list1.<span class="property">next</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 注：相等的情况加哪个节点都是可以的</span></span><br><span class="line">            cur.<span class="property">next</span> = list2; <span class="comment">// 把 list2 加到新链表中</span></span><br><span class="line">            list2 = list2.<span class="property">next</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cur = cur.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cur.<span class="property">next</span> = list1 ?? list2; <span class="comment">// 拼接剩余链表</span></span><br><span class="line">    <span class="keyword">return</span> dummy.<span class="property">next</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sortList = <span class="keyword">function</span>(<span class="params">head</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果链表为空或者只有一个节点，无需排序</span></span><br><span class="line">    <span class="keyword">if</span> (head === <span class="literal">null</span> || head.<span class="property">next</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 找到中间节点，并断开 head2 与其前一个节点的连接</span></span><br><span class="line">    <span class="comment">// 比如 head=[4,2,1,3]，那么 middleNode 调用结束后 head=[4,2] head2=[1,3]</span></span><br><span class="line">    <span class="keyword">let</span> head2 = <span class="title function_">middleNode</span>(head);</span><br><span class="line">    <span class="comment">// 分治</span></span><br><span class="line">    head = <span class="title function_">sortList</span>(head);</span><br><span class="line">    head2 = <span class="title function_">sortList</span>(head2);</span><br><span class="line">    <span class="comment">// 合并</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">mergeTwoLists</span>(head, head2);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="153-旋转排序最小值"><a href="#153-旋转排序最小值" class="headerlink" title="153.旋转排序最小值"></a>153.旋转排序最小值</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="160-相交链表"><a href="#160-相交链表" class="headerlink" title="160.相交链表"></a>160.相交链表</h2><blockquote><p>初始化两个指针 p&#x3D;headA, q&#x3D;headB。不断循环，直到 p&#x3D;q。</p><p>每次循环，p 和 q 各向后走一步。</p><p>如果 p 不是空节点，那么更新 p 为 p.next，否则更新 p 为 headB；</p><p>如果 q 不是空节点，那么更新 q 为 q.next，否则更新 q 为 headA。</p><p>循环结束时，如果两条链表相交，那么此时 p 和 q 都在相交的起始节点处，返回 p；</p><p>如果两条链表不相交，那么 p 和 q 都走到空节点，所以也可以返回 p，即空节点。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getIntersectionNode = <span class="keyword">function</span>(<span class="params">headA, headB</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> p = headA, q = headB;</span><br><span class="line">    <span class="keyword">while</span> (p !== q) &#123;</span><br><span class="line">        p = p ? p.<span class="property">next</span> : headB;</span><br><span class="line">        q = q ? q.<span class="property">next</span> : headA;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="226-翻转二叉树"><a href="#226-翻转二叉树" class="headerlink" title="226.翻转二叉树"></a>226.翻转二叉树</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> invertTree = <span class="keyword">function</span>(<span class="params">root</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (root === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> left = <span class="title function_">invertTree</span>(root.<span class="property">left</span>); <span class="comment">// 翻转左子树</span></span><br><span class="line">    <span class="keyword">const</span> right = <span class="title function_">invertTree</span>(root.<span class="property">right</span>); <span class="comment">// 翻转右子树</span></span><br><span class="line">    root.<span class="property">left</span> = right; <span class="comment">// 交换左右儿子</span></span><br><span class="line">    root.<span class="property">right</span> = left;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="283-移动零"><a href="#283-移动零" class="headerlink" title="283.移动零"></a>283.移动零</h2><blockquote><p>快慢双指针</p><p><strong>解构赋值</strong>交换变量值 <code>[a, b] = [b, a];</code></p><p>快指针位非0 &#x3D;&gt; 交换</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> moveZeroes = <span class="keyword">function</span>(<span class="params">nums</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> i0 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nums.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[i] !== <span class="number">0</span>) &#123;<span class="comment">//快指针位!=0</span></span><br><span class="line">            [nums[i], nums[i0]] = [nums[i0], nums[i]];</span><br><span class="line">            i0++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="543-二叉树直径"><a href="#543-二叉树直径" class="headerlink" title="543.二叉树直径"></a>543.二叉树直径</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> diameterOfBinaryTree = <span class="keyword">function</span>(<span class="params">root</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> ans = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">depth</span>(<span class="params">rootNode</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!rootNode) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> L = <span class="title function_">depth</span>(rootNode.<span class="property">left</span>);</span><br><span class="line">        <span class="keyword">let</span> R = <span class="title function_">depth</span>(rootNode.<span class="property">right</span>);</span><br><span class="line"></span><br><span class="line">        ans = <span class="title class_">Math</span>.<span class="title function_">max</span>(ans, L + R + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">max</span>(L, R) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">depth</span>(root);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ans - <span class="number">1</span>;</span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 资源 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>前端模块化规范</title>
      <link href="/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
      <url>/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="前端模块化规范"><a href="#前端模块化规范" class="headerlink" title="前端模块化规范"></a>前端模块化规范</h1><p>通常来说，<strong>一个文件就是一个模块，有自己的作用域，只向外暴露特定的变量和函数</strong>。目前流行的js模块化规范有CommonJS、AMD、CMD、UMD以及ES6的模块系统。</p><p><em><strong>AMD</strong></em>  &#x2F;  <em><strong>CMD</strong></em>  &#x2F; <em><strong>CommonJs</strong></em> 是JS模块化开发的标准规范，目前对应的实现是</p><p><em><strong>RequireJs</strong></em> &#x2F; <em><strong>SeaJs</strong></em> &#x2F; <em><strong>nodeJs</strong></em></p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a><strong>CommonJS</strong></h3><blockquote><p>CommonJS用<em><strong>同步</strong></em>的方式加载模块。<strong>在服务端，模块文件都存放在本地磁盘，读取非常快，所以这样做不会有问题。但是在浏览器端，限于网络原因，更合理的方案是使用异步加载。</strong></p><p><em><strong>NodeJS</strong></em> 是 CommonJS 规范的主要实践者</p></blockquote><p>有4个重要的环境变量为模块化实现提供支持</p><p> <code>module</code> </p><p> <code>exports</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义模块math.js</span></span><br><span class="line"><span class="keyword">var</span> total = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 需要向外暴露的函数、变量</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">add</span>: add,</span><br><span class="line">    <span class="attr">total</span>: total</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <code>require</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 必须加./路径，不加的话只会去node_modules文件找 **/</span></span><br><span class="line"><span class="comment">// 引用自定义的模块时，参数包含路径，可省略.js</span></span><br><span class="line"><span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">&#x27;./math&#x27;</span>);</span><br><span class="line">math.<span class="title function_">add</span>(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引用核心模块时，不需要带路径</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line">http.<span class="title function_">createService</span>(...).<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p> <code>global</code></p><h3 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h3><blockquote><p><strong>浏览器优先 , 异步加载</strong></p><p><strong>预加载</strong></p><p>所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/** 网页中引入require.js及main.js **/</span><br><span class="line">&lt;script src=&quot;js/require.js&quot; data-main=&quot;js/main&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">/** main.js 入口文件/主模块 **/</span><br><span class="line">// 首先用config()指定各模块路径和引用名</span><br><span class="line">require.config(&#123;</span><br><span class="line">  baseUrl: &quot;js/lib&quot;,</span><br><span class="line">  paths: &#123;</span><br><span class="line">    &quot;jquery&quot;: &quot;jquery.min&quot;,  //实际路径为js/lib/jquery.min.js</span><br><span class="line">    &quot;underscore&quot;: &quot;underscore.min&quot;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">// 执行基本操作</span><br><span class="line">require([&quot;jquery&quot;,&quot;underscore&quot;],function($,_)&#123;</span><br><span class="line">  // some code here</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 定义math.js模块</span><br><span class="line">define(function () &#123;</span><br><span class="line">    var basicNum = 0;</span><br><span class="line">    var add = function (x, y) &#123;</span><br><span class="line">        return x + y;</span><br><span class="line">    &#125;;</span><br><span class="line">    return &#123;</span><br><span class="line">        add: add,</span><br><span class="line">        basicNum :basicNum</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 定义一个依赖underscore.js的模块</span><br><span class="line">define([&#x27;underscore&#x27;],function(_)&#123;</span><br><span class="line">  var classify = function(list)&#123;</span><br><span class="line">    _.countBy(list,function(num)&#123;</span><br><span class="line">      return num &gt; 30 ? &#x27;old&#x27; : &#x27;young&#x27;;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;;</span><br><span class="line">  return &#123;</span><br><span class="line">    classify :classify</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 引用模块，将模块放在[]内</span><br><span class="line">require([&#x27;jquery&#x27;, &#x27;math&#x27;],function($, math)&#123;</span><br><span class="line">  var sum = math.add(10,20);</span><br><span class="line">  $(&quot;#sum&quot;).html(sum);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><blockquote><p><strong>异步加载</strong></p><p><strong>懒加载</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/** AMD写法 **/</span><br><span class="line">define([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;], function(a, b, c, d, e, f) &#123; </span><br><span class="line">     // 等于在最前面声明并初始化了要用到的所有模块</span><br><span class="line">    a.doSomething();</span><br><span class="line">    if (false) &#123;</span><br><span class="line">        // 即便没用到某个模块 b，但 b 还是提前执行了</span><br><span class="line">        b.doSomething()</span><br><span class="line">    &#125; </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">/** CMD写法 **/</span><br><span class="line">define(function(require, exports, module) &#123;</span><br><span class="line">    var a = require(&#x27;./a&#x27;); //在需要时申明</span><br><span class="line">    a.doSomething();</span><br><span class="line">    if (false) &#123;</span><br><span class="line">        var b = require(&#x27;./b&#x27;);</span><br><span class="line">        b.doSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">/** sea.js **/</span><br><span class="line">// 定义模块 math.js</span><br><span class="line">define(function(require, exports, module) &#123;</span><br><span class="line">    var $ = require(&#x27;jquery.js&#x27;);</span><br><span class="line">    var add = function(a,b)&#123;</span><br><span class="line">        return a+b;</span><br><span class="line">    &#125;</span><br><span class="line">    exports.add = add;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 加载模块</span><br><span class="line">seajs.use([&#x27;math.js&#x27;], function(math)&#123;</span><br><span class="line">    var sum = math.add(1+2);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="UMD"><a href="#UMD" class="headerlink" title="UMD"></a>UMD</h3><blockquote><p>UMD是AMD和CommonJS的一个糅合。AMD是浏览器优先，异步加载；CommonJS是服务器优先，同步加载。</p></blockquote><blockquote><p>先判断是否支持node.js的模块，存在就使用node.js；再判断是否支持AMD（define是否存在），存在则使用AMD的方式加载。这就是所谓的UMD</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">((root, factory) =&gt; &#123;</span><br><span class="line">  if (typeof define === &#x27;function&#x27; &amp;&amp; define.amd) &#123;</span><br><span class="line">    //AMD</span><br><span class="line">    define([&#x27;jquery&#x27;], factory);</span><br><span class="line">  &#125; else if (typeof exports === &#x27;object&#x27;) &#123;</span><br><span class="line">    //CommonJS</span><br><span class="line">    var $ = requie(&#x27;jquery&#x27;);</span><br><span class="line">    module.exports = factory($);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    //都不是，浏览器全局定义</span><br><span class="line">    root.testModule = factory(root.jQuery);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(this, ($) =&gt; &#123;</span><br><span class="line">  //do something...  这里是真正的函数体</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="ES6-Module"><a href="#ES6-Module" class="headerlink" title="ES6 Module"></a>ES6 Module</h3><p>模块功能主要由两个命令构成：</p><p><code>export</code> 规定模块的对外接口</p><p><code>import</code> 输入其他模块提供的功能</p><p>特征</p><blockquote><ul><li>严格模式：ES6 的模块自动采用严格模式</li><li><code>import</code> read-only特性： <code>import</code>的属性是只读的，不能赋值，类似于<code>const</code>的特性</li><li><code>export/import</code>提升： <code>import/export</code>必须位于模块顶级，不能位于作用域内；其次对于模块内的<code>import/export</code>会提升到模块顶部，这是在编译阶段完成的</li></ul></blockquote><h2 id="总结-区别"><a href="#总结-区别" class="headerlink" title="总结&#x2F;区别"></a>总结&#x2F;区别</h2><p><em><strong>CommonJs</strong></em>主要针对<strong>服务端</strong></p><blockquote><p>服务器端一般采用 <strong>同步加载</strong> 文件，也就是说需要某个模块，服务器端便停下来，等待它加载再执行。</p></blockquote><p><em><strong>AMD&#x2F;CMD</strong></em>主要针对<strong>浏览器端</strong></p><blockquote><p>而浏览器端要保证效率，需要采用 <strong>异步加载</strong> ，这就需要一个预处理，提前将所需要的模块文件并行加载好。</p></blockquote><blockquote><p><em><strong>AMD&#x2F;CMD</strong></em> 都是 <strong>并行加载</strong> js文件</p></blockquote><p><em><strong>AMD</strong></em>是<strong>预加载</strong>，在并行加载js文件同时，还会解析执行该模块（因为还需要执行，所以在加载某个模块前，这个模块的依赖模块需要先加载完成）</p><blockquote><p>加载快速，尤其遇到多个大文件，因为并行解析，所以同一时间可以解析多个文件</p><p>加载顺序不一定，可能会为程序埋下大坑</p></blockquote><p><em><strong>CMD</strong></em>是<strong>懒加载</strong>，虽然会一开始就并行加载js文件，但是不会执行，而是在需要的时候才执行。</p><blockquote><p>每个JS文件的执行顺序在代码中是有体现的，是可控的</p><p>多文件加载速度叠加</p></blockquote><p>JS是单线程，所有JS文件执行时间叠加在AMD和CMD中是一样的。</p><p>但CMD是懒加载，没法利用空闲时间，而AMD是文件加载好就执行，往往可以利用一些空闲时间。</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://zhuanlan.zhihu.com/p/467991875">前端模块化——彻底搞懂AMD、CMD、UMD、ESM和CommonJS - 知乎</a></p><p><a href="https://blog.csdn.net/u014445339/article/details/55517770">【新手入门 最精炼总结】AMD&#x2F;CMD&#x2F;CommonJs到底是什么？它们有什么区别？_amd与cmd-CSDN博客</a></p>]]></content>
      
      
      <categories>
          
          <category> 技术探索 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>nrm使用</title>
      <link href="/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/nrm%E4%BD%BF%E7%94%A8/"/>
      <url>/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/nrm%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="nrm"><a href="#nrm" class="headerlink" title="nrm"></a>nrm</h1><p>nrm（npm registry manager）是npm的镜像管理工具</p><p>能帮助你在加载国外的资源太慢时快速切换npm源</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><code>npm install -g nrm</code>，全局安装nrm</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="查看所有源"><a href="#查看所有源" class="headerlink" title="查看所有源"></a>查看所有源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm ls</span><br></pre></td></tr></table></figure><p>显示类似以下信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* npm ---------- https://registry.npmjs.org/</span><br><span class="line">  yarn --------- https://registry.yarnpkg.com/</span><br><span class="line">  tencent ------ https://mirrors.tencent.com/npm/</span><br><span class="line">  cnpm --------- https://r.cnpmjs.org/</span><br><span class="line">  taobao ------- https://registry.npmmirror.com/</span><br><span class="line">  npmMirror ---- https://skimdb.npmjs.com/registry/</span><br><span class="line">  huawei ------- https://repo.huaweicloud.com/repository/npm/</span><br></pre></td></tr></table></figure><p>其中 <code>*</code> 号表示当前使用的源。</p><h3 id="切换源"><a href="#切换源" class="headerlink" title="切换源"></a>切换源</h3><p>相比 <code>npm config set registry https://registry.yarnpkg.com/</code></p><p>我们只要 <code>nrm use yarn</code> 就🆗了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm use &lt;registry&gt;</span><br></pre></td></tr></table></figure><blockquote><p>切换源之后，我们安装依赖仍使用 <code>npm install &lt;package&gt;</code> 的方式来进行安装</p></blockquote><h3 id="添加源"><a href="#添加源" class="headerlink" title="添加源"></a>添加源</h3><p>对于企业内部定制的私有源</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm add &lt;registry&gt; &lt;url&gt;</span><br></pre></td></tr></table></figure><blockquote><p><code>&lt;registry&gt;</code> 源名称</p><p><code>&lt;url&gt;</code> 源地址</p></blockquote><h3 id="删除源"><a href="#删除源" class="headerlink" title="删除源"></a>删除源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm del &lt;registry&gt;</span><br></pre></td></tr></table></figure><h3 id="测试源的响应时间"><a href="#测试源的响应时间" class="headerlink" title="测试源的响应时间"></a>测试源的响应时间</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm test &lt;registry&gt;</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://juejin.cn/post/6931597891182002183">nrm 使用详解nrm（NPM registry manager）是 npm 的镜像源管理工具，使用它可以快速切换 np - 掘金</a></p>]]></content>
      
      
      <categories>
          
          <category> 技术探索 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue3文档精炼</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Vue3%E8%BF%9B%E9%98%B6API/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Vue3%E8%BF%9B%E9%98%B6API/</url>
      
        <content type="html"><![CDATA[<h1 id="我的-Vue3-文档"><a href="#我的-Vue3-文档" class="headerlink" title="我的 Vue3 文档"></a>我的 Vue3 文档</h1><h2 id="内置标签"><a href="#内置标签" class="headerlink" title="内置标签"></a>内置标签</h2><h3 id="component"><a href="#component" class="headerlink" title="component"></a>component</h3><blockquote><p>动态组件</p><p>根据 currentTabComponent 的值判断是否要渲染组件</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;component v-bind:is=&quot;currentTabComponent&quot;&gt;&lt;/component&gt;</span><br></pre></td></tr></table></figure><h3 id="keep-alive"><a href="#keep-alive" class="headerlink" title="keep-alive"></a>keep-alive</h3><blockquote><p>每次切换新标签的时候，Vue 都会创建一个新的 <code>currentTabComponent</code> 实例。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 失活的组件将会被缓存！--&gt;</span><br><span class="line">&lt;keep-alive&gt;</span><br><span class="line">  &lt;component v-bind:is=&quot;currentTabComponent&quot;&gt;&lt;/component&gt;</span><br><span class="line">&lt;/keep-alive&gt;</span><br></pre></td></tr></table></figure><h3 id="slot⭐"><a href="#slot⭐" class="headerlink" title="slot⭐"></a>slot⭐</h3><blockquote><p>子组件的占位符</p></blockquote><blockquote><p>在父组件引用的<Button>中 <strong>写入的内容</strong></p><p>会被 <strong>插进子组件<slot>内</strong> 并渲染回父组件</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 父组件 --&gt;</span><br><span class="line">&lt;Button&gt;</span><br><span class="line">  &lt;div&gt;这是默认插槽的内容&lt;/div&gt;</span><br><span class="line">&lt;/Button&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 子组件 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;子组件内容&lt;/div&gt;</span><br><span class="line">&lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>渲染结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;div&gt;子组件内容&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;这是默认插槽的内容&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h4 id="默认插槽"><a href="#默认插槽" class="headerlink" title="默认插槽"></a>默认插槽</h4><blockquote><p>当子组件只需要一个插槽，并且不需要区分不同部分的内容时，默认插槽是最佳选择</p></blockquote><p>父组件</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Button</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/button.vue&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">&lt;Button&gt; &lt;!--引用子组件--&gt;</span><br><span class="line">        &lt;div&gt;插槽内容，把这行div插到子组件的&quot;&lt;slot&gt;&quot;里&lt;/div&gt;</span><br><span class="line">    &lt;/Button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>子组件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;子组件内容&lt;/div&gt;</span><br><span class="line">&lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>渲染结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;div&gt;子组件内容&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;插槽内容，把这行div插到子组件的&quot;&lt;slot&gt;&quot;里&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h4 id="具名插槽"><a href="#具名插槽" class="headerlink" title="具名插槽"></a>具名插槽</h4><p>父组件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">&lt;Button&gt; &lt;!--引用子组件--&gt;</span><br><span class="line">        &lt;template #header&gt; &lt;!--插给header--&gt;</span><br><span class="line">        &lt;div&gt;插槽内容1&lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">        &lt;template v-slot:footer&gt; &lt;!--插给footer--&gt;</span><br><span class="line">        &lt;div&gt;插槽内容2&lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">    &lt;/Button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>子组件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;slot name=&quot;header&quot;&gt;&lt;/slot&gt;</span><br><span class="line">&lt;div&gt;子组件内容&lt;/div&gt;</span><br><span class="line">&lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>渲染结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;div&gt;插槽内容1&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;子组件内容&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;插槽内容2&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h4 id="条件插槽"><a href="#条件插槽" class="headerlink" title="条件插槽"></a>条件插槽</h4><p>父组件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">&lt;Button&gt; &lt;!--引用子组件--&gt;</span><br><span class="line">        &lt;template #header&gt; &lt;!--插给header--&gt;</span><br><span class="line">        &lt;div&gt;插槽内容1&lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">        &lt;template v-slot:footer&gt; &lt;!--插给footer--&gt;</span><br><span class="line">        &lt;div&gt;插槽内容2&lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">    &lt;/Button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>子组件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div v-if=&quot;$slots.header&quot;&gt;</span><br><span class="line">&lt;div&gt;标题&lt;/div&gt;</span><br><span class="line">&lt;slot name=&quot;header&quot;&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div v-if=&quot;$slots.footer&quot;&gt;</span><br><span class="line">&lt;div&gt;脚注&lt;/div&gt;</span><br><span class="line">&lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>渲染结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div&gt;标题&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;插槽内容1&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div&gt;脚注&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;插槽内容2&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h3 id="transition"><a href="#transition" class="headerlink" title="transition"></a>transition</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h3 id="transition-group"><a href="#transition-group" class="headerlink" title="transition-group"></a>transition-group</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h2><h3 id="defineProps⭐"><a href="#defineProps⭐" class="headerlink" title="defineProps⭐"></a>defineProps⭐</h3><blockquote><p>子获取父的传值</p></blockquote><p><strong>子组件</strong></p><blockquote><p>接口</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Props</span> &#123;</span><br><span class="line"><span class="attr">tag</span>?: <span class="built_in">string</span></span><br><span class="line"><span class="attr">type</span>?: <span class="string">&#x27;primary&#x27;</span> | <span class="string">&#x27;success&#x27;</span> | <span class="string">&#x27;warning&#x27;</span> | <span class="string">&#x27;danger&#x27;</span> | <span class="string">&#x27;info&#x27;</span></span><br><span class="line"><span class="attr">useThrottle</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = defineProps&lt;<span class="title class_">Props</span>&gt;()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;component</span><br><span class="line">:is=&quot;props.tag || &#x27;button&#x27;&quot;</span><br><span class="line">ref=&quot;_ref&quot;</span><br><span class="line">:type=&quot;props.nativeType || &#x27;button&#x27;&quot;</span><br><span class="line">@click=&quot;</span><br><span class="line">           (e: MouseEvent) =&gt;</span><br><span class="line">           props.useThrottle !== false ? handleBtneCLickThrottle(e) : handleBtnClick(e)&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/component&gt;</span><br></pre></td></tr></table></figure><p><strong>父组件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;vr-... tag=&quot;a&quot; type=&quot;primary&quot; :use-throttle=&quot;true&quot; /&gt;</span><br></pre></td></tr></table></figure><h3 id="withDefaults"><a href="#withDefaults" class="headerlink" title="withDefaults"></a>withDefaults</h3><blockquote><p>给 <code>defineProps</code> 绑定<strong>默认值</strong></p></blockquote><blockquote><p>接口</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> ...<span class="title class_">Props</span>&#123;</span><br><span class="line">    <span class="attr">tag</span>?: <span class="built_in">string</span> | <span class="title class_">Component</span></span><br><span class="line">    <span class="attr">size</span>?: <span class="string">&#x27;default&#x27;</span> | <span class="string">&#x27;large&#x27;</span> | <span class="string">&#x27;small&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">withDefaults</span>(defineProps&lt;...<span class="title class_">Props</span>&gt;(),&#123;</span><br><span class="line">    <span class="attr">tag</span>?: <span class="string">&quot;button&quot;</span></span><br><span class="line">    <span class="attr">size</span>?: <span class="keyword">default</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Emits"><a href="#Emits" class="headerlink" title="Emits"></a>Emits</h2><h3 id="defineEmits"><a href="#defineEmits" class="headerlink" title="defineEmits"></a>defineEmits</h3><blockquote><p>子向父发射事件</p></blockquote><blockquote><p>接口 (函数签名类型)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ...<span class="title class_">Emits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&#x27;click&#x27;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p><strong>子组件</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emits = defineEmits&lt;...<span class="title class_">Emits</span>&gt;()</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handle...<span class="title class_">Click</span> = <span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">MouseEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">emits</span>(<span class="string">&#x27;click&#x27;</span>, e)<span class="comment">//发射&#x27;click&#x27;事件 | 父组件通过@click响应到</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;component @click=&quot;(e: MouseEvent) =&gt; handle...Click(e)&quot;&gt;</span><br></pre></td></tr></table></figure><p><strong>父组件</strong> 用户使用组件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;vr-... @click=&quot;Click&quot; /&gt;</span><br><span class="line">//当接收到子组件发射过来的事件之后，触发父组件自己的&#x27;Click&#x27;函数</span><br></pre></td></tr></table></figure><blockquote><p>1.点击后 子组件的 <code>@click</code> 被触发，将一个 <code>MouseEvent</code> 类型事件传入 <code>handle...Click</code> 函数</p><p>2.<code>emits(&#39;click&#39;, e)</code> 向父组件发射 <code>&#39;click&#39;</code> 事件</p><p>3.父组件通过@click 响应到 <code>&#39;click&#39;</code> 事件, 开始执行父组件中自定义的 <code>Click</code> 事件</p></blockquote><h2 id="Slots"><a href="#Slots" class="headerlink" title="Slots"></a>Slots</h2><h3 id="defineSlots"><a href="#defineSlots" class="headerlink" title="defineSlots"></a>defineSlots</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> slots = <span class="title function_">defineSlots</span>()</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> iconStyle = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line"><span class="attr">marginRight</span>: slots.<span class="property">default</span> ? <span class="string">&#x27;6px&#x27;</span> : <span class="string">&#x27;0px&#x27;</span>,</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><blockquote><p>检测组件是否有<slot>默认插槽, 有则插入样式 <code>marginRight: 6px</code></p></blockquote><h2 id="Expose"><a href="#Expose" class="headerlink" title="Expose"></a>Expose</h2><h3 id="defineExporse"><a href="#defineExporse" class="headerlink" title="defineExporse"></a>defineExporse</h3><blockquote><p>暴露组件的内部状态和方法，供父组件通过 ref 访问</p><blockquote><p>在 <code>&lt;script setup&gt;</code> 中，如果不使用 <code>defineExpose</code>，父组件无法通过 <code>ref</code> 访问子组件的任何内部状态或方法</p></blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">defineExpose&lt;<span class="title class_">ButtonInstance</span>&gt;(&#123;</span><br><span class="line"><span class="attr">ref</span>: _ref,</span><br><span class="line">disabled,</span><br><span class="line">size,</span><br><span class="line"><span class="keyword">type</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>父组件可以通过 <code>ref</code> 访问这些暴露的属性：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;VrButton ref=&quot;buttonRef&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const buttonRef = ref(null)</span><br><span class="line"></span><br><span class="line">const checkButtonState = () =&gt; &#123;</span><br><span class="line">console.log(&#x27;按钮是否禁用:&#x27;, buttonRef.value.disabled)</span><br><span class="line">console.log(&#x27;按钮类型:&#x27;, buttonRef.value.type)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="专业名词"><a href="#专业名词" class="headerlink" title="专业名词"></a>专业名词</h2><h3 id="工具链"><a href="#工具链" class="headerlink" title="工具链"></a>工具链</h3><h4 id="构建工具"><a href="#构建工具" class="headerlink" title="构建工具"></a>构建工具</h4><ul><li><p><strong>Vite</strong> 或 <strong>Webpack</strong>:</p><blockquote><p>这些是模块打包工具</p><p>负责将你的 Vue 项目中的各种**<em>资源</em><strong>（如 JavaScript、CSS、图片等）</strong><em>打包成浏览器可以理解的形式</em>**。</p><p>Vite 作为新一代的构建工具，以其快速的冷启动和热更新特性而受到欢迎。</p></blockquote></li></ul><h4 id="编译器"><a href="#编译器" class="headerlink" title="编译器"></a>编译器</h4><ul><li><p><strong>Vue 编译器</strong>:</p><blockquote><p>Vue**<em>单文件组件</em><strong>（SFC, Single File Components）需要</strong><em>被编译为普通 JavaScript</em>**才能在浏览器中运行。Vue 提供了一个编译器来完成这项工作，它可以在构建时（通过构建工具配置）或运行时进行编译。</p></blockquote></li></ul><h4 id="Linter-和-Formatter"><a href="#Linter-和-Formatter" class="headerlink" title="Linter 和 Formatter"></a>Linter 和 Formatter</h4><ul><li><p><strong>ESLint</strong>, <strong>Prettier</strong>:</p><blockquote><p>这些工具帮助**<em>保持代码风格的一致性</em><strong>和</strong><em>捕获潜在的错误</em>**。</p><p>ESLint 是一个流行的 JavaScript linter，可以帮助你**<em>发现</em><strong>代码中的</strong><em>问题</em>**；</p><p>Prettier 则是一个代码格式化工具，能够**<em>自动格式化</em>**你的代码以符合预定义的风格指南。</p></blockquote></li></ul><h4 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h4><ul><li><p><strong>Vuex, Pinia</strong>:</p><blockquote><p>Vuex 是 Vue.js 的状态管理模式+库。</p><p>它充当应用中**<em>所有组件的集中存储</em>**，确保状态以一种可预测的方式发生变化。</p></blockquote></li></ul><h4 id="路由管理"><a href="#路由管理" class="headerlink" title="路由管理"></a>路由管理</h4><ul><li><p><strong>Vue Router</strong>:</p><blockquote><p>官方的路由管理器，与 Vue.js 核心深度集成。</p><p>用于实现 SPA（单页面应用）中的**<em>导航</em>**功能。</p></blockquote></li></ul><h4 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h4><ul><li><p><strong>Jest</strong>, <strong>Mocha</strong>, <strong>Vue Test Utils</strong>:</p><blockquote><p>使用这些工具可以对 Vue 组件进行**<em>单元测试</em>**，确保各个部分按预期工作。</p><p>Vue Test Utils 是由 Vue 官方提供的一个测试实用库，简化了 Vue 组件的测试过程。</p></blockquote></li></ul><h4 id="开发服务器"><a href="#开发服务器" class="headerlink" title="开发服务器"></a>开发服务器</h4><ul><li><p><strong>内置开发服务器</strong>:</p><blockquote><p>Vite 和 Webpack 都提供了内置的开发服务器，支持**<em>热重载</em>**（HMR, Hot Module Replacement）</p><p>这意味着当你修改代码时，浏览器会自动刷新显示最新的更改，无需手动刷新整个页面。</p></blockquote></li></ul><h4 id="CSS-预处理器"><a href="#CSS-预处理器" class="headerlink" title="CSS 预处理器"></a>CSS 预处理器</h4><ul><li><p><strong>Sass</strong>, <strong>Less</strong>, <strong>Stylus</strong>:</p><blockquote><p>流行的 CSS 预处理器，允许你**<em>用更强大的语法编写样式</em>**，并且通过构建工具集成到 Vue 项目中。</p></blockquote></li></ul><h3 id="SSR"><a href="#SSR" class="headerlink" title="SSR"></a>SSR</h3><h4 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h4><p>服务端渲染 (Server-Side Rendering)</p><p>相对传统客户端渲染(CSR, Client-Side Rendering)的 <strong>优势</strong></p><ol><li><strong>更好的 SEO</strong>：服务器端直接返回完整的 HTML，搜索引擎可以轻松抓取页面内容。</li><li><strong>更快的首屏加载</strong>：用户可以直接看到渲染好的 HTML，无需等待 JavaScript 加载完成。</li><li><strong>更一致的用户体验</strong>：无论用户的设备性能如何，都可以快速看到页面内容。</li></ol><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><blockquote><p>核心思想: 在服务器端生成 HTML，并将其发送到客户端</p></blockquote><table><thead><tr><th><strong><em>完整流程</em></strong></th></tr></thead><tbody><tr><td>用户访问一个 URL，<strong>请求</strong> → <strong>服务器</strong></td></tr><tr><td>服务器 render HTML，<strong>完整的 HTML 字符串</strong> → <strong>客户端</strong></td></tr><tr><td>用户立即可以看到页面内容（此时页面静态，无法响应用户的交互）</td></tr><tr><td>浏览器继续加载 Vue 应用的客户端 JS 文件(通常是 <code>client-bundle.js</code>), 这个文件包含了 Vue 的运行时代码以及应用的逻辑</td></tr><tr><td><strong>Hydration 水合阶段一</strong>：客户端 JS 解析 HTML，将现有的 <strong>DOM</strong> 节点 **匹配 Vue 组件模板 **</td></tr><tr><td><strong>Hydration 水合阶段二</strong>：Vue 在匹配的 <strong>DOM</strong> 节点上 <strong>绑定事件监听器</strong>（如 <code>click</code>、<code>input</code> 等），使页面能够响应用户的操作。</td></tr><tr><td>Vue 重新 <strong>初始化组件</strong> 的 <strong>状态</strong>（如 <code>data</code>、<code>computed</code>、<code>methods</code> 等），并将其与 DOM 关联起来。如果服务端已经预取了数据（如通过 Vuex 或 Pinia），这些数据会被同步到客户端，确保状态一致性。</td></tr><tr><td>页面上的每个元素从此都被 Vue 接管，用户可以与页面进行交互</td></tr></tbody></table><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ol><li><strong>高效利用现有 DOM</strong><ul><li>Hydration 不会重新创建 DOM 节点，而是直接复用服务器生成的 HTML。</li><li>这样可以避免重复渲染，提升性能。</li></ul></li><li><strong>依赖于一致的 HTML 结构</strong><ul><li>服务端生成的 HTML 必须与客户端的组件模板完全一致，否则 Hydration 会失败。</li><li>如果服务端和客户端的 HTML 不一致，Vue 会抛出警告或错误。</li></ul></li><li><strong>渐进式增强</strong><ul><li>Hydration 是一种渐进式增强的技术：即使 JavaScript 加载失败，用户仍然可以看到静态页面内容（虽然没有交互性）。</li></ul></li></ol><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4>]]></content>
      
      
      <categories>
          
          <category> 组件库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PostCSS</title>
      <link href="/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/PostCSS/"/>
      <url>/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/PostCSS/</url>
      
        <content type="html"><![CDATA[<h1 id="PostCSS"><a href="#PostCSS" class="headerlink" title="PostCSS"></a>PostCSS</h1><p><a href="https://www.postcss.com.cn/">PostCSS中文网</a></p><blockquote><p>处理CSS代码的工具，通过一系列的插件来实现最新的CSS特性</p></blockquote><h2 id="插件介绍"><a href="#插件介绍" class="headerlink" title="插件介绍"></a>插件介绍</h2><h3 id="Autoprefixer"><a href="#Autoprefixer" class="headerlink" title="Autoprefixer"></a>Autoprefixer</h3><blockquote><p>兼容各种浏览器特有的前缀</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">box-sizing: border-box;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-webkit-box-sizing</span><br><span class="line">-moz-box-sizing</span><br></pre></td></tr></table></figure><h3 id="PostCSS-Preset-Env"><a href="#PostCSS-Preset-Env" class="headerlink" title="PostCSS-Preset-Env"></a>PostCSS-Preset-Env</h3><blockquote><p>使用最新的CSS特性，转移为主流浏览器支持的版本</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#000000</span>;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">        <span class="attribute">background</span>: <span class="number">#000000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="number">#000000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Autoprefixer-1"><a href="#Autoprefixer-1" class="headerlink" title="Autoprefixer"></a>Autoprefixer</h3><blockquote><p>兼容各种浏览器特有的前缀</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">box-sizing: border-box;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-webkit-box-sizing</span><br><span class="line">-moz-box-sizing</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术探索 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Monorepo架构</title>
      <link href="/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/Monorepo%E6%9E%B6%E6%9E%84/"/>
      <url>/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/Monorepo%E6%9E%B6%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="Monorepo架构策略"><a href="#Monorepo架构策略" class="headerlink" title="Monorepo架构策略"></a>Monorepo架构策略</h1><blockquote><p>更高效的代码共享和管理</p></blockquote><h2 id="为什么使用"><a href="#为什么使用" class="headerlink" title="为什么使用"></a>为什么使用</h2><p><em><strong>项目不断膨胀 -&gt; 构建速度↓↓↓ -&gt; 包体积↑↑↑ -&gt; 性能越来越慢</strong></em></p><p>比如说想开发一个组件库，我在开发时需要启动 单组件测试、页面预览 两个服务，也就是需要在两个或多个项目中复用内部组件和逻辑，这时候我们就需要Monorepo架构来优化项目。</p><h2 id="简要概述"><a href="#简要概述" class="headerlink" title="简要概述"></a>简要概述</h2><p>项目结构 (以我的组件库项目为例)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line">├── node_modules/</span><br><span class="line">├── ......</span><br><span class="line">│</span><br><span class="line">├── packages</span><br><span class="line">│   ├── components（组件实现）</span><br><span class="line">│       ├── node_modules/</span><br><span class="line">│       ├── ......</span><br><span class="line">│       └── package.json</span><br><span class="line">│   ├── docs（项目一：组件库页面）</span><br><span class="line">│       ├── node_modules/</span><br><span class="line">│       ├── ......</span><br><span class="line">│       └── package.json</span><br><span class="line">│   └── play（项目二：组件测试页面）</span><br><span class="line">│       ├── node_modules/</span><br><span class="line">│       ├── ......</span><br><span class="line">│       └── package.json</span><br><span class="line">│</span><br><span class="line">├── ......</span><br><span class="line">├── pnpm-workspace.yaml</span><br><span class="line">└── package.json //依赖会</span><br></pre></td></tr></table></figure><blockquote><p>这样我们可以同时启动多个项目，并能合并所有子项目共用的包到根目录下，在减少整体项目包体积的前提下，packages下的各项目能做到相互独立互不影响。</p></blockquote><h2 id="如何初始化"><a href="#如何初始化" class="headerlink" title="如何初始化"></a>如何初始化</h2><h3 id="配置-pnpm-workspace-yaml"><a href="#配置-pnpm-workspace-yaml" class="headerlink" title="配置 pnpm-workspace.yaml"></a>配置 pnpm-workspace.yaml</h3><blockquote><p>PNPM 工作区的配置文件，用于管理多个包之间的依赖关系</p></blockquote><p><em><strong>基础代码</strong></em></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">packages:</span></span><br><span class="line">  <span class="string">-</span> <span class="string">&quot;packages/*&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>所有位于 <code>packages</code> 目录下的子目录都被视为独立的包，并且是工作区的一部分</p></blockquote><p><em><strong>扩展</strong></em></p><p>例如</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">packages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;packages/*&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;libs/*&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>同样的，<code>libs</code> 目录下的子目录也被视为独立的包，被视为工作区的一部分</p></blockquote><blockquote><p>如果你有一个包在 <code>packages</code> 文件夹中依赖了另一个位于 <code>libs</code> 文件夹中的包，PNPM 不会从远程仓库下载该依赖，而是创建一个符号链接指向该本地包的位置。</p></blockquote><blockquote><p>当你在一个工作区内的任意一个包中安装依赖时，PNPM 会将这些依赖安装在工作区根目录下的 <code>node_modules</code> 文件夹内。工作区内所有的包可以共享相同的依赖版本，减少了重复安装和存储空间的浪费</p></blockquote><h3 id="配置-package-json"><a href="#配置-package-json" class="headerlink" title="配置 package.json"></a>配置 package.json</h3><blockquote><p>位于根目录，我的组件库项目叫tyche</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tyche&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm --filter @tyche/play dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm --filter @tyche/components test&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;packageManager&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm@10.4.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//开发环境</span></span><br><span class="line">        ......</span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//生产环境</span></span><br><span class="line">        <span class="attr">&quot;@tyche/components&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;@tyche/hooks&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;@tyche/theme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;@tyche/utils&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tyche&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span></span><br><span class="line">        ......</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>&#x2F;&#x2F;&#x2F; <em>补充：peerDependencies</em> &#x2F;&#x2F;&#x2F;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">├── helloWorld</span><br><span class="line">│   └── node_modules</span><br><span class="line">│       ├── packageA</span><br><span class="line">│       ├── plugin1</span><br><span class="line">│       │   └── nodule_modules</span><br><span class="line">│       │       └── packageA</span><br><span class="line">│       └── plugin2</span><br><span class="line">│       │   └── nodule_modules</span><br><span class="line">│       │       └── packageA</span><br></pre></td></tr></table></figure><blockquote><p>packageA 核心依赖库被重复下载</p></blockquote><p>此时我们应该在</p><p><strong><code>plugin1 /package.json</code></strong>  <em>&amp;</em>  <strong><code>plugin2 /package.json</code></strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;peerDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;packageA&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong><code>/package.json</code></strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;packageA&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>结构就变成了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">├── helloWorld</span><br><span class="line">│   └── node_modules</span><br><span class="line">│       ├── packageA</span><br><span class="line">│       ├── plugin1</span><br><span class="line">│       └── plugin2</span><br></pre></td></tr></table></figure><blockquote><p>通常用于库或插件，这些库或插件不直接包含在最终应用中，但需要与其他包协同工作</p><p>当你安装一个包时，如果该包有peerDependencies，npm或yarn会检查这些依赖是否已经安装在项目中，如果没有，它会给出警告，但不会默认安装它们</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 技术探索 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue插件开发</title>
      <link href="/2025/04/03/%E5%A4%A7%E5%89%8D%E7%AB%AF/Vue%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
      <url>/2025/04/03/%E5%A4%A7%E5%89%8D%E7%AB%AF/Vue%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="Plugins-开发"><a href="#Plugins-开发" class="headerlink" title="Plugins 开发"></a>Plugins 开发</h1><p><a href="https://cn.vuejs.org/guide/reusability/plugins.html">插件 | Vue.js</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Vue3中，一个插件通常是一个对象</p><p>通常我们开发的插件通过全局导出</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> myPlugin</span><br></pre></td></tr></table></figure><p>从而在项目的入口文件中使用</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(myPlugin)</span><br></pre></td></tr></table></figure><h2 id="基础开发"><a href="#基础开发" class="headerlink" title="基础开发"></a>基础开发</h2><h3 id="plugins"><a href="#plugins" class="headerlink" title="plugins&#x2F;"></a>plugins&#x2F;</h3><h4 id="MyButton-vue"><a href="#MyButton-vue" class="headerlink" title="MyButton.vue"></a>MyButton.vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;button&gt;我的按钮&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="index-ts"><a href="#index-ts" class="headerlink" title="index.ts"></a>index.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">MyButton</span> <span class="keyword">from</span> <span class="string">&#x27;./MyButton.vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="attr">install</span>:<span class="function">(<span class="params">app,options</span>)=&gt;</span>&#123;</span><br><span class="line">        app.<span class="title function_">component</span>(<span class="string">&#x27;myButton&#x27;</span>, <span class="title class_">MyButton</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="main-js"><a href="#main-js" class="headerlink" title="main.js"></a>main.js</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">MyButton</span> <span class="keyword">from</span> <span class="string">&#x27;./plugins/MyButton.ts&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">create</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(<span class="title class_">MyButton</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Views"><a href="#Views" class="headerlink" title="Views&#x2F;"></a>Views&#x2F;</h3><h4 id="Helloworld-vue"><a href="#Helloworld-vue" class="headerlink" title="Helloworld.vue"></a>Helloworld.vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&quot;home&quot;&gt;</span><br><span class="line">        &lt;myButton&gt;&lt;/myButton&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h2 id="多插件开发"><a href="#多插件开发" class="headerlink" title="多插件开发"></a>多插件开发</h2><h3 id="components"><a href="#components" class="headerlink" title="components&#x2F;"></a>components&#x2F;</h3><h4 id="Button"><a href="#Button" class="headerlink" title="Button&#x2F;"></a>Button&#x2F;</h4><h5 id="MyButton-vue-1"><a href="#MyButton-vue-1" class="headerlink" title="MyButton.vue"></a>MyButton.vue</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;button&gt;我的按钮&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h5 id="MyButtonGroup-vue"><a href="#MyButtonGroup-vue" class="headerlink" title="MyButtonGroup.vue"></a>MyButtonGroup.vue</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;er-button-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="index-ts-1"><a href="#index-ts-1" class="headerlink" title="index.ts"></a>index.ts</h5><blockquote><p>导出 <code>MyButton</code> 和 <code>MyButtonGroup</code> 组件</p><p>使用 <code>withInstall</code> 函数为它们添加安装方法</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Button</span> <span class="keyword">from</span> <span class="string">&quot;./MyButton.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ButtonGroup</span> <span class="keyword">from</span> <span class="string">&quot;./MyButtonGroup.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@tyche/utils&quot;</span>; <span class="comment">//在 install.ts 里</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErButton</span> = <span class="title function_">withInstall</span>(<span class="title class_">Button</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErButtonGroup</span> = <span class="title function_">withInstall</span>(<span class="title class_">ButtonGroup</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="utils"><a href="#utils" class="headerlink" title="utils&#x2F;"></a>utils&#x2F;</h3><h4 id="install-ts"><a href="#install-ts" class="headerlink" title="install.ts"></a>install.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">App</span>, <span class="title class_">Plugin</span>, <span class="title class_">Directive</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="comment">//App（Vue 应用实例）、Plugin（插件接口）、Directive（自定义指令）</span></span><br><span class="line"><span class="keyword">import</span> &#123; noop &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="comment">//空函数，通常用于占位符</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt; = T &amp; <span class="title class_">Plugin</span>;<span class="comment">//将任意类型 T 与 Plugin 接口合并</span></span><br><span class="line"><span class="comment">//任何实现了这个类型的对象不仅具有原始类型 T 的所有属性和方法</span></span><br><span class="line"><span class="comment">//还需要实现 Plugin 接口中的 install 方法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withInstall = &lt;T&gt;<span class="function">(<span class="params"><span class="attr">component</span>: T</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//👇将传入的组件转换为 SFCWithInstall&lt;T&gt; 类型，并为其添加 install 方法</span></span><br><span class="line">    (component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;).<span class="property">install</span> = <span class="function">(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt;</span> &#123;<span class="comment">//为component添加install方法，该方法接收一个app应用实例</span></span><br><span class="line">        <span class="keyword">const</span> name = (component <span class="keyword">as</span> <span class="built_in">any</span>)?.<span class="property">name</span> || <span class="string">&quot;UnnamedComponent&quot;</span>;<span class="comment">//获取组件的名称。如果组件没有定义 name 属性，则默认使用 &quot;UnnamedComponent&quot;</span></span><br><span class="line">        app.<span class="title function_">component</span>(name, component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;);<span class="comment">//使用应用实例的方法 .component() 全局注册该组件后，就可以在应用的任何地方使用。</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;;<span class="comment">//返回经过扩展后的组件对象</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="style-ts"><a href="#style-ts" class="headerlink" title="style.ts"></a>style.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isNumber, isString &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; debugWarn &#125; <span class="keyword">from</span> <span class="string">&quot;./error&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SCOPE</span> = <span class="string">&quot;utils/style&quot;</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isStringNumber = (<span class="attr">val</span>: <span class="built_in">string</span>): <span class="function"><span class="params">boolean</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isString</span>(val)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> !<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="title class_">Number</span>(val));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">addUnit</span>(<span class="params"><span class="attr">value</span>?: <span class="built_in">string</span> | <span class="built_in">number</span>, defaultUnit = <span class="string">&quot;px&quot;</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!value) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isNumber</span>(value) || <span class="title function_">isStringNumber</span>(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;value&#125;</span><span class="subst">$&#123;defaultUnit&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isString</span>(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">debugWarn</span>(<span class="variable constant_">SCOPE</span>, <span class="string">&quot;binding value must be a string or number&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="error-ts"><a href="#error-ts" class="headerlink" title="error.ts"></a>error.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isString &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ErUIError</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">message</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(message);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;ErUIError&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">throwError</span>(<span class="params"><span class="attr">scope</span>: <span class="built_in">string</span>, <span class="attr">msg</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ErUIError</span>(<span class="string">`[<span class="subst">$&#123;scope&#125;</span>] <span class="subst">$&#123;msg&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debugWarn</span>(<span class="params"><span class="attr">error</span>: <span class="title class_">Error</span></span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debugWarn</span>(<span class="params"><span class="attr">scope</span>: <span class="built_in">string</span>, <span class="attr">msg</span>: <span class="built_in">string</span></span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debugWarn</span>(<span class="params"><span class="attr">scope</span>: <span class="built_in">string</span> | <span class="title class_">Error</span>, <span class="attr">msg</span>?: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&quot;production&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> err = <span class="title function_">isString</span>(scope) ? <span class="keyword">new</span> <span class="title class_">ErUIError</span>(<span class="string">`[<span class="subst">$&#123;scope&#125;</span>] <span class="subst">$&#123;msg&#125;</span>`</span>) : scope;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">warn</span>(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="index-ts-2"><a href="#index-ts-2" class="headerlink" title="index.ts"></a>index.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./install&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isFunction &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">RenderVnode</span> = <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">vNode</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: [<span class="title class_">String</span>, <span class="title class_">Object</span>, <span class="title class_">Function</span>],</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> (<span class="title function_">isFunction</span>(props.<span class="property">vNode</span>) ? props.<span class="title function_">vNode</span>() : props.<span class="property">vNode</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> typeIconMap = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">  [<span class="string">&quot;info&quot;</span>, <span class="string">&quot;circle-info&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;success&quot;</span>, <span class="string">&quot;check-circle&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;warning&quot;</span>, <span class="string">&quot;circle-exclamation&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;danger&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./install&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./error&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./style&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="core"><a href="#core" class="headerlink" title="core&#x2F;"></a>core&#x2F;</h3><h4 id="componens-ts"><a href="#componens-ts" class="headerlink" title="componens.ts"></a>componens.ts</h4><blockquote><p>集合所有需要全局注册的组件，并将其作为一个插件数组导出</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    <span class="title class_">ErButton</span>,</span><br><span class="line">    <span class="title class_">ErButtonGroup</span>,</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;@tyche/components&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Plugin</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">    <span class="title class_">ErButton</span>,</span><br><span class="line">    <span class="title class_">ErButtonGroup</span>,</span><br><span class="line">    ...</span><br><span class="line">] <span class="keyword">as</span> <span class="title class_">Plugin</span>[]</span><br></pre></td></tr></table></figure><h4 id="makeInstaller-ts"><a href="#makeInstaller-ts" class="headerlink" title="makeInstaller.ts"></a>makeInstaller.ts</h4><blockquote><p>创建一个通用的安装器，用于批量安装组件</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">App</span>, <span class="title class_">Plugin</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">INSTALLED_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@tyche/constants&quot;</span>;<span class="comment">//标记应用是否已经安装过组件库</span></span><br><span class="line"><span class="keyword">import</span> &#123; each, get, set &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="comment">//遍历/获取/设置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//传入组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">makeInstaller</span>(<span class="params"><span class="attr">components</span>: <span class="title class_">Plugin</span>[]</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">install</span> = (<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">get</span>(app, <span class="variable constant_">INSTALLED_KEY</span>)) <span class="keyword">return</span>;<span class="comment">//app 对象中存在 INSTALLED_KEY 属性，说明组件库已经安装过，直接返回</span></span><br><span class="line">        <span class="title function_">set</span>(app, <span class="variable constant_">INSTALLED_KEY</span>, <span class="literal">true</span>);<span class="comment">//使用 set 将 INSTALLED_KEY 设置为 true，标记该应用已经安装了组件库</span></span><br><span class="line"></span><br><span class="line">        <span class="title function_">each</span>(components, <span class="function">(<span class="params">c</span>) =&gt;</span> &#123;<span class="comment">//遍历传入的 components 数组</span></span><br><span class="line">            app.<span class="title function_">use</span>(c);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> install;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注:以下是constants&#x2F;index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">INSTALLED_KEY</span> = <span class="title class_">Symbol</span>(<span class="string">&quot;INSTALLED_KEY&quot;</span>);</span><br></pre></td></tr></table></figure></blockquote><h4 id="index-ts-3"><a href="#index-ts-3" class="headerlink" title="index.ts"></a>index.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; library &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/fontawesome-svg-core&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fas &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/free-solid-svg-icons&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> makeInstaller <span class="keyword">from</span> <span class="string">&#x27;./makeInstaller&#x27;</span></span><br><span class="line"><span class="keyword">import</span> components <span class="keyword">from</span> <span class="string">&#x27;./components&#x27;</span></span><br><span class="line"><span class="keyword">import</span> printLogo <span class="keyword">from</span> <span class="string">&quot;./pringLogo&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@tyche/theme/index.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">printLogo</span>();</span><br><span class="line"></span><br><span class="line">library.<span class="title function_">add</span>(fas);</span><br><span class="line"><span class="keyword">const</span> installer = <span class="title function_">makeInstaller</span>(components);<span class="comment">//通用的安装器，用来批量安装组件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;@tyche/components&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> installer</span><br></pre></td></tr></table></figure><h3 id="docs"><a href="#docs" class="headerlink" title="docs&#x2F;"></a>docs&#x2F;</h3><h4 id="components-1"><a href="#components-1" class="headerlink" title="components"></a>components</h4><h5 id="button-md"><a href="#button-md" class="headerlink" title="button.md"></a>button.md</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: Button</span><br><span class="line">description: Button 组件文档</span><br><span class="line"></span><br><span class="line">next:</span><br><span class="line">  link: /components/collapse</span><br><span class="line">  text: Collapse 折叠面板</span><br><span class="line"></span><br><span class="line">prev:</span><br><span class="line">  link: /get-started</span><br><span class="line"><span class="section">  text: 快速开始</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line"><span class="section"># Button 按钮</span></span><br><span class="line"></span><br><span class="line">常用的操作按钮。</span><br><span class="line"></span><br><span class="line"><span class="section">## 基础用法</span></span><br><span class="line"></span><br><span class="line">使用 <span class="code">`type`</span>、<span class="code">`plain`</span>、 <span class="code">`round`</span>和 <span class="code">`circle`</span>来定义按钮的样式。</span><br><span class="line"></span><br><span class="line">::: preview</span><br><span class="line">demo-preview=../demo/button/Basic.vue</span><br><span class="line">:::</span><br></pre></td></tr></table></figure><h4 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h4><h5 id="button"><a href="#button" class="headerlink" title="button"></a>button</h5><h6 id="Basic-vue"><a href="#Basic-vue" class="headerlink" title="Basic.vue"></a>Basic.vue</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    &lt;er-button&gt;Default&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;primary&quot;&gt;Primary&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;success&quot;&gt;Success&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;info&quot;&gt;Info&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;warning&quot;&gt;Warning&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;danger&quot;&gt;Danger&lt;/er-button&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    &lt;er-button plain&gt;Plain&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;primary&quot; plain&gt;Primary&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;success&quot; plain&gt;Success&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;info&quot; plain&gt;Info&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;warning&quot; plain&gt;Warning&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;danger&quot; plain&gt;Danger&lt;/er-button&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    &lt;er-button round&gt;Round&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;primary&quot; round&gt;Primary&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;success&quot; round&gt;Success&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;info&quot; round&gt;Info&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;warning&quot; round&gt;Warning&lt;/er-button&gt;</span><br><span class="line">    &lt;er-button type=&quot;danger&quot; round&gt;Danger&lt;/er-button&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    &lt;er-button icon=&quot;search&quot; circle /&gt;</span><br><span class="line">    &lt;er-button type=&quot;primary&quot; icon=&quot;edit&quot; circle /&gt;</span><br><span class="line">    &lt;er-button type=&quot;success&quot; icon=&quot;check&quot; circle /&gt;</span><br><span class="line">    &lt;er-button type=&quot;info&quot; icon=&quot;message&quot; circle /&gt;</span><br><span class="line">    &lt;er-button type=&quot;warning&quot; icon=&quot;star&quot; circle /&gt;</span><br><span class="line">    &lt;er-button type=&quot;danger&quot; icon=&quot;trash&quot; circle /&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>npm发布</title>
      <link href="/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84npm/"/>
      <url>/2025/04/03/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84npm/</url>
      
        <content type="html"><![CDATA[<h1 id="npm发布"><a href="#npm发布" class="headerlink" title="npm发布"></a>npm发布</h1><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>下载nrm</p><blockquote><p>详情见文章</p></blockquote><p>打开npm官网 <a href="https://www.npmjs.com/">npm | Home</a></p><blockquote><p>我们需要先注册一个账号</p></blockquote><h2 id="主流程"><a href="#主流程" class="headerlink" title="主流程"></a>主流程</h2><p>转换npm源</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm use npm</span><br></pre></td></tr></table></figure><p>连接npm账号</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm login</span><br></pre></td></tr></table></figure><p>确认账号登录状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm whoami</span><br></pre></td></tr></table></figure><p>cd到你需要发布的包&#x2F;构建产物</p><blockquote><p>比如说我的组件库项目产物位于packages\core</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd .\packages\core\</span><br></pre></td></tr></table></figure><p>至此，先确认我们即将发布的包</p><blockquote><p>packages\core\package.json</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;veyra&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;使用 Vue3 + Ts 构建的组件库&quot;</span><span class="punctuation">,</span></span><br><span class="line">...</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><em><strong>名称</strong></em></p><blockquote><p>不能和他人已发布过的包名重名</p></blockquote><p><em><strong>版本</strong></em></p><blockquote><p>如果是初次发布 “version”: “1.0.0” 即可</p><p>若是自己已发布过的包要更新版本 (如”1.0.1”)</p><p>详情请看到文章最后“关于版本号”</p></blockquote><p>在确认无误后，执行发包命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm publish</span><br></pre></td></tr></table></figure><h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>现在你已经掌握了最原始的发包流程，接下来我们使用更优雅的手段</p><p>在含有包的目录中下载</p><h3 id="rimraf"><a href="#rimraf" class="headerlink" title="rimraf"></a>rimraf</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add rimraf --save-dev</span><br></pre></td></tr></table></figure><blockquote><p>这是用来在每次打包前remove我们的dist文件夹的</p><p>这样我们就可以清理掉上次打包的残余产物</p></blockquote><p>在相应的package.json中添加脚本命令,并将clean放在build命令前</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;clean vite build ...&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;clean&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rimraf dist&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>此时我们尝试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm build</span><br></pre></td></tr></table></figure><p>就会先把上一次的构建产物(dist文件夹)删了，再重新生成了</p><h3 id="release-it"><a href="#release-it" class="headerlink" title="release-it"></a>release-it</h3><blockquote><p>一个交互式的命令行工具</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add release-it --save-dev</span><br></pre></td></tr></table></figure><p>同样的，添加脚本命令</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;release&quot;</span><span class="punctuation">:</span> <span class="string">&quot;release-it&quot;</span></span><br></pre></td></tr></table></figure><p><strong>注意</strong></p><p><code>release-it</code> 在发布过程中会自动在项目的根目录下执行 <code>git push</code> 和 <code>git push --tags</code>，如果本地分支未设置上游分支（upstream），这些操作会失败。</p><p>所以首先在根目录下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;嵌入release-it&quot;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --set-upstream origin main</span><br></pre></td></tr></table></figure><p>cd进你包的目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd .\packages\core\</span><br></pre></td></tr></table></figure><p>执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run release</span><br></pre></td></tr></table></figure><p>接下来即可根据需求选择相应的版本号等配置</p><h1 id="关于版本号"><a href="#关于版本号" class="headerlink" title="关于版本号"></a>关于版本号</h1><p>以下是版本号的组成部分，以及各部分增加的依据</p><p><strong>主版本号（Major Version）</strong>：</p><blockquote><p>发生了重大更改，或是做出了不兼容的API修改</p><p>意味着用户需要对代码进行相应的修改</p></blockquote><p><strong>次版本号（Minor Version）</strong>：</p><blockquote><p>添加了向下兼容的新功能，但现有的API保持不变</p><p>意味着用户不需要修改代码</p></blockquote><p><strong>修订版本号（Revision Number）</strong>：</p><blockquote><p>修复了一些问题，但没有引入新的功能</p><p>意味着用户可以获得更稳定的体验</p></blockquote><p><strong>编译版本号（Build Number）</strong>：</p><blockquote><p>表示软件的编译版本，通常由编译器在编译过程中自动生成，不进行人为控制。</p></blockquote><p><strong>预发布版本标识符</strong></p><blockquote><p>可以附加一个预发布版本标识符(如<code>alpha</code>，<code>beta</code>等)来标识开发中的版本，通常用于测试阶段。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 技术探索 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>组件库全文件解构</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/%E7%BB%84%E4%BB%B6%E5%BA%93%E9%A1%B9%E7%9B%AE%E5%85%A8%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%84/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/%E7%BB%84%E4%BB%B6%E5%BA%93%E9%A1%B9%E7%9B%AE%E5%85%A8%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br></pre></td><td class="code"><pre><span class="line">这是一个组件库项目，技术栈：Vue 3 + TypeScript + Vite，测试工具：Vitest + Storybook，打包工具：Rollup + Vue-Test-Utils，项目部署：VitePress站点生成 + GitHubPages页面托管 + github actions CI/CD 自动化部署</span><br><span class="line"></span><br><span class="line">Veyra</span><br><span class="line">├─ .nvmrc</span><br><span class="line">├─ env.d.ts</span><br><span class="line">├─ libs</span><br><span class="line">│  ├─ README.md</span><br><span class="line">│  ├─ vite-plugins</span><br><span class="line">│  │  ├─ hooksPlugin.ts</span><br><span class="line">│  │  ├─ index.ts</span><br><span class="line">│  │  ├─ package.json</span><br><span class="line">│  │  └─ vite.config.ts</span><br><span class="line">│  └─ vitepress-preview-component</span><br><span class="line">│     ├─ container</span><br><span class="line">│     │  ├─ ant-design-ui</span><br><span class="line">│     │  │  ├─ ant-design.scss</span><br><span class="line">│     │  │  └─ AntDesign.vue</span><br><span class="line">│     │  ├─ element-plus</span><br><span class="line">│     │  │  ├─ element-plus.scss</span><br><span class="line">│     │  │  └─ ElementPlus.vue</span><br><span class="line">│     │  └─ naive-ui</span><br><span class="line">│     │     ├─ naive-ui.scss</span><br><span class="line">│     │     └─ NaiveUI.vue</span><br><span class="line">│     ├─ hooks</span><br><span class="line">│     │  ├─ use-codecopy.ts</span><br><span class="line">│     │  ├─ use-codefold.ts</span><br><span class="line">│     │  └─ use-namespaces.ts</span><br><span class="line">│     ├─ icons</span><br><span class="line">│     │  ├─ code-close.vue</span><br><span class="line">│     │  ├─ code-copy.vue</span><br><span class="line">│     │  ├─ code-open.vue</span><br><span class="line">│     │  └─ copy-success.vue</span><br><span class="line">│     ├─ index.ts</span><br><span class="line">│     ├─ messages</span><br><span class="line">│     │  ├─ index.ts</span><br><span class="line">│     │  ├─ message-notice.scss</span><br><span class="line">│     │  └─ message-notice.vue</span><br><span class="line">│     ├─ package.json</span><br><span class="line">│     ├─ styles</span><br><span class="line">│     │  └─ various.scss</span><br><span class="line">│     ├─ tsconfig.json</span><br><span class="line">│     ├─ types.d.ts</span><br><span class="line">│     └─ vite.config.ts</span><br><span class="line">├─ package.json</span><br><span class="line">├─ packages</span><br><span class="line">│  ├─ components</span><br><span class="line">│  │  ├─ Alert</span><br><span class="line">│  │  │  ├─ Alert.test.tsx</span><br><span class="line">│  │  │  ├─ Alert.vue</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ Button</span><br><span class="line">│  │  │  ├─ Button.test.tsx</span><br><span class="line">│  │  │  ├─ Button.vue</span><br><span class="line">│  │  │  ├─ ButtonGroup.vue</span><br><span class="line">│  │  │  ├─ constants.ts</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ Collapse</span><br><span class="line">│  │  │  ├─ Collapse.test.tsx</span><br><span class="line">│  │  │  ├─ Collapse.vue</span><br><span class="line">│  │  │  ├─ CollapseItem.vue</span><br><span class="line">│  │  │  ├─ constants.ts</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  ├─ transitionEvents.ts</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ ConfigProvider</span><br><span class="line">│  │  │  ├─ ConfigProvider.vue</span><br><span class="line">│  │  │  ├─ constants.ts</span><br><span class="line">│  │  │  ├─ hooks.ts</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ Dropdown</span><br><span class="line">│  │  │  ├─ constants.ts</span><br><span class="line">│  │  │  ├─ Dropdown.test.tsx</span><br><span class="line">│  │  │  ├─ Dropdown.vue</span><br><span class="line">│  │  │  ├─ DropdownItem.vue</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ Form</span><br><span class="line">│  │  │  ├─ constants.ts</span><br><span class="line">│  │  │  ├─ Form.vue</span><br><span class="line">│  │  │  ├─ FormItem.vue</span><br><span class="line">│  │  │  ├─ hooks.ts</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ Icon</span><br><span class="line">│  │  │  ├─ Icon.vue</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ index.test.ts</span><br><span class="line">│  │  ├─ index.ts</span><br><span class="line">│  │  ├─ Input</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ Input.test.tsx</span><br><span class="line">│  │  │  ├─ Input.vue</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ Loading</span><br><span class="line">│  │  │  ├─ directive.ts</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ Loading.test.tsx</span><br><span class="line">│  │  │  ├─ Loading.vue</span><br><span class="line">│  │  │  ├─ service.ts</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ Message</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ Message.test.tsx</span><br><span class="line">│  │  │  ├─ Message.vue</span><br><span class="line">│  │  │  ├─ methods.ts</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ MessageBox</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ MessageBox.test.tsx</span><br><span class="line">│  │  │  ├─ MessageBox.vue</span><br><span class="line">│  │  │  ├─ methods.ts</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ Notification</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ methods.ts</span><br><span class="line">│  │  │  ├─ Notification.test.tsx</span><br><span class="line">│  │  │  ├─ Notification.vue</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ Overlay</span><br><span class="line">│  │  │  ├─ Overlay.vue</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ package.json</span><br><span class="line">│  │  ├─ Popconfirm</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ Popconfirm.test.tsx</span><br><span class="line">│  │  │  ├─ Popconfirm.vue</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ Select</span><br><span class="line">│  │  │  ├─ constants.ts</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ Option.vue</span><br><span class="line">│  │  │  ├─ Select.vue</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  ├─ types.ts</span><br><span class="line">│  │  │  └─ useKeyMap.ts</span><br><span class="line">│  │  ├─ Switch</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  ├─ Switch.test.tsx</span><br><span class="line">│  │  │  ├─ Switch.vue</span><br><span class="line">│  │  │  └─ types.ts</span><br><span class="line">│  │  ├─ Tooltip</span><br><span class="line">│  │  │  ├─ index.ts</span><br><span class="line">│  │  │  ├─ style.css</span><br><span class="line">│  │  │  ├─ Tooltip.test.tsx</span><br><span class="line">│  │  │  ├─ Tooltip.vue</span><br><span class="line">│  │  │  ├─ types.ts</span><br><span class="line">│  │  │  └─ useEventsToTiggerNode.ts</span><br><span class="line">│  │  └─ Upload</span><br><span class="line">│  │     ├─ index.ts</span><br><span class="line">│  │     ├─ types.ts</span><br><span class="line">│  │     ├─ Upload.vue</span><br><span class="line">│  │     └─ UploadList.vue</span><br><span class="line">│  ├─ constants</span><br><span class="line">│  │  ├─ index.ts</span><br><span class="line">│  │  ├─ key.ts</span><br><span class="line">│  │  └─ package.json</span><br><span class="line">│  ├─ core</span><br><span class="line">│  │  ├─ build</span><br><span class="line">│  │  │  ├─ vite.es.config.ts</span><br><span class="line">│  │  │  └─ vite.umd.config.ts</span><br><span class="line">│  │  ├─ componens.ts</span><br><span class="line">│  │  ├─ index.ts</span><br><span class="line">│  │  ├─ makeInstaller.ts</span><br><span class="line">│  │  ├─ package.json</span><br><span class="line">│  │  └─ pringLogo.ts</span><br><span class="line">│  ├─ docs</span><br><span class="line">│  │  ├─ .vitepress</span><br><span class="line">│  │  │  ├─ config.ts</span><br><span class="line">│  │  │  └─ theme</span><br><span class="line">│  │  │     └─ index.ts</span><br><span class="line">│  │  ├─ components</span><br><span class="line">│  │  │  ├─ alert.md</span><br><span class="line">│  │  │  ├─ button.md</span><br><span class="line">│  │  │  ├─ collapse.md</span><br><span class="line">│  │  │  ├─ dropdown.md</span><br><span class="line">│  │  │  ├─ form.md</span><br><span class="line">│  │  │  ├─ loading.md</span><br><span class="line">│  │  │  ├─ message.md</span><br><span class="line">│  │  │  ├─ messagebox.md</span><br><span class="line">│  │  │  ├─ notification.md</span><br><span class="line">│  │  │  ├─ popconfirm.md</span><br><span class="line">│  │  │  └─ tooltip.md</span><br><span class="line">│  │  ├─ demo</span><br><span class="line">│  │  │  ├─ alert</span><br><span class="line">│  │  │  │  ├─ Basic.vue</span><br><span class="line">│  │  │  │  ├─ Close.vue</span><br><span class="line">│  │  │  │  ├─ Desc.vue</span><br><span class="line">│  │  │  │  ├─ IconDesc.vue</span><br><span class="line">│  │  │  │  ├─ ShowIcon.vue</span><br><span class="line">│  │  │  │  ├─ TextCenter.vue</span><br><span class="line">│  │  │  │  └─ Theme.vue</span><br><span class="line">│  │  │  ├─ button</span><br><span class="line">│  │  │  │  ├─ Basic.vue</span><br><span class="line">│  │  │  │  ├─ Disabled.vue</span><br><span class="line">│  │  │  │  ├─ Group.vue</span><br><span class="line">│  │  │  │  ├─ Icon.vue</span><br><span class="line">│  │  │  │  ├─ Loading.vue</span><br><span class="line">│  │  │  │  ├─ Size.vue</span><br><span class="line">│  │  │  │  ├─ Tag.vue</span><br><span class="line">│  │  │  │  └─ Throttle.vue</span><br><span class="line">│  │  │  ├─ collapse</span><br><span class="line">│  │  │  │  ├─ Accordion.vue</span><br><span class="line">│  │  │  │  ├─ Basic.vue</span><br><span class="line">│  │  │  │  ├─ CustomTitle.vue</span><br><span class="line">│  │  │  │  └─ Disabled.vue</span><br><span class="line">│  │  │  ├─ dropdown</span><br><span class="line">│  │  │  │  ├─ Basic.vue</span><br><span class="line">│  │  │  │  ├─ Command.vue</span><br><span class="line">│  │  │  │  ├─ Disabled.vue</span><br><span class="line">│  │  │  │  ├─ HideOnClick.vue</span><br><span class="line">│  │  │  │  ├─ InstanceMethod.vue</span><br><span class="line">│  │  │  │  ├─ Size.vue</span><br><span class="line">│  │  │  │  ├─ SplitButton.vue</span><br><span class="line">│  │  │  │  └─ Trigger.vue</span><br><span class="line">│  │  │  ├─ form</span><br><span class="line">│  │  │  │  ├─ Basic.vue</span><br><span class="line">│  │  │  │  ├─ CustomValidate.vue</span><br><span class="line">│  │  │  │  ├─ Position.vue</span><br><span class="line">│  │  │  │  └─ Validate.vue</span><br><span class="line">│  │  │  ├─ loading</span><br><span class="line">│  │  │  │  ├─ Basic.vue</span><br><span class="line">│  │  │  │  ├─ Custom.vue</span><br><span class="line">│  │  │  │  └─ Fullscreen.vue</span><br><span class="line">│  │  │  ├─ message</span><br><span class="line">│  │  │  │  ├─ Basic.vue</span><br><span class="line">│  │  │  │  ├─ Center.vue</span><br><span class="line">│  │  │  │  ├─ Closeable.vue</span><br><span class="line">│  │  │  │  ├─ Test.vue</span><br><span class="line">│  │  │  │  └─ Type.vue</span><br><span class="line">│  │  │  ├─ messagebox</span><br><span class="line">│  │  │  │  ├─ Alert.vue</span><br><span class="line">│  │  │  │  ├─ Center.vue</span><br><span class="line">│  │  │  │  ├─ Confirm.vue</span><br><span class="line">│  │  │  │  ├─ Custom.vue</span><br><span class="line">│  │  │  │  ├─ Prompt.vue</span><br><span class="line">│  │  │  │  └─ VNode.vue</span><br><span class="line">│  │  │  ├─ notification</span><br><span class="line">│  │  │  │  ├─ Basic.vue</span><br><span class="line">│  │  │  │  ├─ Closeable.vue</span><br><span class="line">│  │  │  │  └─ Type.vue</span><br><span class="line">│  │  │  ├─ popconfirm</span><br><span class="line">│  │  │  │  ├─ Basic.vue</span><br><span class="line">│  │  │  │  ├─ Callback.vue</span><br><span class="line">│  │  │  │  └─ Custom.vue</span><br><span class="line">│  │  │  └─ tooltip</span><br><span class="line">│  │  │     ├─ Basic.vue</span><br><span class="line">│  │  │     ├─ Disabled.vue</span><br><span class="line">│  │  │     └─ Slot.vue</span><br><span class="line">│  │  ├─ get-started.md</span><br><span class="line">│  │  ├─ index.md</span><br><span class="line">│  │  └─ package.json</span><br><span class="line">│  ├─ hooks</span><br><span class="line">│  │  ├─ index.ts</span><br><span class="line">│  │  ├─ package.json</span><br><span class="line">│  │  ├─ useClickOutside.ts</span><br><span class="line">│  │  ├─ useDisabledStyle.ts</span><br><span class="line">│  │  ├─ useEventListener.ts</span><br><span class="line">│  │  ├─ useFocusController.ts</span><br><span class="line">│  │  ├─ useId.ts</span><br><span class="line">│  │  ├─ useLocale.ts</span><br><span class="line">│  │  ├─ useOffset.ts</span><br><span class="line">│  │  ├─ useProp.ts</span><br><span class="line">│  │  ├─ useZIndex.ts</span><br><span class="line">│  │  ├─ vite.config.ts</span><br><span class="line">│  │  └─ __test__</span><br><span class="line">│  │     ├─ index.test.tsx</span><br><span class="line">│  │     ├─ useClickOutset.test.tsx</span><br><span class="line">│  │     └─ useEventListener.test.tsx</span><br><span class="line">│  ├─ locale</span><br><span class="line">│  │  ├─ index.ts</span><br><span class="line">│  │  ├─ lang</span><br><span class="line">│  │  │  ├─ en.ts</span><br><span class="line">│  │  │  ├─ ja.ts</span><br><span class="line">│  │  │  ├─ ko.ts</span><br><span class="line">│  │  │  ├─ zh-cn.ts</span><br><span class="line">│  │  │  └─ zh-tw.ts</span><br><span class="line">│  │  └─ package.json</span><br><span class="line">│  ├─ play</span><br><span class="line">│  │  ├─ .storybook</span><br><span class="line">│  │  │  ├─ main.js</span><br><span class="line">│  │  │  └─ preview.js</span><br><span class="line">│  │  ├─ index.html</span><br><span class="line">│  │  ├─ package.json</span><br><span class="line">│  │  ├─ public</span><br><span class="line">│  │  │  └─ vite.svg</span><br><span class="line">│  │  ├─ README.md</span><br><span class="line">│  │  ├─ src</span><br><span class="line">│  │  │  ├─ App.vue</span><br><span class="line">│  │  │  ├─ main.ts</span><br><span class="line">│  │  │  ├─ stories</span><br><span class="line">│  │  │  │  ├─ Alert.stories.tsx</span><br><span class="line">│  │  │  │  ├─ Button.stories.ts</span><br><span class="line">│  │  │  │  └─ Collapse.stories.ts</span><br><span class="line">│  │  │  └─ vite-env.d.ts</span><br><span class="line">│  │  └─ vite.config.ts</span><br><span class="line">│  ├─ README.md</span><br><span class="line">│  ├─ theme</span><br><span class="line">│  │  ├─ index.css</span><br><span class="line">│  │  ├─ package.json</span><br><span class="line">│  │  └─ reset.css</span><br><span class="line">│  └─ utils</span><br><span class="line">│     ├─ error.ts</span><br><span class="line">│     ├─ index.ts</span><br><span class="line">│     ├─ install.ts</span><br><span class="line">│     ├─ package.json</span><br><span class="line">│     ├─ style.ts</span><br><span class="line">│     └─ __tests__</span><br><span class="line">│        ├─ error.test.tsx</span><br><span class="line">│        ├─ index.test.tsx</span><br><span class="line">│        └─ install.test.tsx</span><br><span class="line">├─ pnpm-lock.yaml</span><br><span class="line">├─ pnpm-workspace.yaml</span><br><span class="line">├─ postcss.config.cjs</span><br><span class="line">├─ tsconfig.build.json</span><br><span class="line">├─ tsconfig.json</span><br><span class="line">├─ tsconfig.node.json</span><br><span class="line">├─ vitest.config.ts</span><br><span class="line">└─ vitest.setup.ts</span><br></pre></td></tr></table></figure><h1 id="项目解构"><a href="#项目解构" class="headerlink" title="项目解构"></a>项目解构</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctrl+i</span><br><span class="line">alt+shift+5</span><br></pre></td></tr></table></figure><h1 id="├─-nvmrc"><a href="#├─-nvmrc" class="headerlink" title="├─ .nvmrc"></a>├─ .<em><del>nvmrc</del></em></h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v18.17.0</span><br></pre></td></tr></table></figure><p>控制nodejs版本的</p><h1 id="├─-env-d-ts"><a href="#├─-env-d-ts" class="headerlink" title="├─ env.d.ts"></a>├─ <em><del>env.d.ts</del></em></h1><blockquote><p>用来区分不同的运行环境：生产（production）、开发（development）和测试（test）</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">PROD</span>: <span class="built_in">boolean</span>; <span class="comment">//生产</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">DEV</span>: <span class="built_in">boolean</span>; <span class="comment">//开发</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">TEST</span>: <span class="built_in">boolean</span>; <span class="comment">//测试</span></span><br></pre></td></tr></table></figure><blockquote><p>在项目的构建脚本或配置文件中，会依据这些变量来决定是否启用某些调试工具、日志记录或者优化措施。</p></blockquote><ol><li><strong>生产环境 (Production)</strong>:<ul><li><strong>情景</strong>: 当你构建并部署你的应用到生产服务器上时（例如通过 CI&#x2F;CD 流程自动部署到 GitHub Pages 或者其他任何生产环境）。假设你在 Vite 配置文件中为生产环境设置了 <code>PROD=true</code>。</li><li><strong>操作</strong>: 执行构建命令如 <code>npm run build</code> 后，再将生成的静态资源部署到生产环境。</li><li><strong>结果</strong>: 在启动或加载应用程序的过程中，如果该函数被执行，那么将会看到那个带有渐变色效果的ASCII艺术logo出现在服务器日志或者浏览器控制台中。</li></ul></li><li><strong>开发模式 (Development)</strong>:<ul><li><strong>情景</strong>: 当你在本地开发环境中运行你的Vue 3 + TypeScript项目时，比如使用 <code>npm run serve</code> 或者类似的命令启动一个热重载的开发服务器。</li><li><strong>操作</strong>: 直接在终端执行 <code>npm run serve</code> 或者配置好的开发模式启动脚本。</li><li><strong>结果</strong>: 在控制台中你会看到简单的提示消息 <code>[EricUI]:dev mode...</code>，这表明现在正处于开发模式下，并且可以快速识别出当前的工作状态。</li></ul></li><li><strong>测试环境 (Testing)</strong>:<ul><li><strong>情景</strong>: 运行单元测试或集成测试时（例如使用 Vitest），通常不会设置 <code>PROD</code> 或 <code>DEV</code> 变量为 true。因此，在这种情况下，既不满足生产环境也不满足开发模式的条件。</li><li><strong>操作</strong>: 执行测试命令如 <code>npm test</code> 或 <code>vitest</code>。</li><li><strong>结果</strong>: 控制台上不会显示上述的ASCII艺术logo或开发模式的消息，以避免干扰测试输出。</li></ul></li></ol><h1 id="├─-libs"><a href="#├─-libs" class="headerlink" title="├─ libs"></a>├─ <em><del>libs</del></em></h1><blockquote><p>辅助库&amp;工具</p></blockquote><h2 id="├─-vite-plugins"><a href="#├─-vite-plugins" class="headerlink" title="├─ vite-plugins"></a>├─ vite-plugins</h2><blockquote><p>自定义vite插件</p></blockquote><h3 id="├─-hooksPlugin-ts"><a href="#├─-hooksPlugin-ts" class="headerlink" title="├─ hooksPlugin.ts"></a>├─ hooksPlugin.ts</h3><h3 id="├─-index-ts"><a href="#├─-index-ts" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h3><h3 id="├─-package-json"><a href="#├─-package-json" class="headerlink" title="├─ package.json"></a>├─ package.json</h3><h3 id="└─-vite-config-ts"><a href="#└─-vite-config-ts" class="headerlink" title="└─ vite.config.ts"></a>└─ vite.config.ts</h3><h2 id="└─-vitepress-preview-component"><a href="#└─-vitepress-preview-component" class="headerlink" title="└─ vitepress-preview-component"></a>└─ vitepress-preview-component</h2><blockquote><p>vitepress组件预览插件</p></blockquote><h3 id="├─-container"><a href="#├─-container" class="headerlink" title="├─ container"></a>├─ container</h3><p>│     │  ├─ ant-design-ui<br>│     │  │  ├─ ant-design.scss<br>│     │  │  └─ AntDesign.vue<br>│     │  ├─ element-plus<br>│     │  │  ├─ element-plus.scss<br>│     │  │  └─ ElementPlus.vue<br>│     │  └─ naive-ui<br>│     │     ├─ naive-ui.scss<br>│     │     └─ NaiveUI.vue</p><p>│     ├─ hooks<br>│     │  ├─ use-codecopy.ts<br>│     │  ├─ use-codefold.ts<br>│     │  └─ use-namespaces.ts</p><p>│     ├─ icons<br>│     │  ├─ code-close.vue<br>│     │  ├─ code-copy.vue<br>│     │  ├─ code-open.vue<br>│     │  └─ copy-success.vue</p><p>│     ├─ index.ts</p><p>│     ├─ messages<br>│     │  ├─ index.ts<br>│     │  ├─ message-notice.scss<br>│     │  └─ message-notice.vue</p><p>│     ├─ package.json<br>│     ├─ styles<br>│     │  └─ various.scss</p><p>│     ├─ tsconfig.json</p><p>│     ├─ types.d.ts</p><p>│     └─ vite.config.ts</p><h1 id="├─-packages"><a href="#├─-packages" class="headerlink" title="├─ packages"></a>├─ <em><del>packages</del></em></h1><blockquote><p>项目分包</p></blockquote><h2 id="├─-components"><a href="#├─-components" class="headerlink" title="├─ components"></a>├─ <em><del>components</del></em></h2><blockquote><p>所有的组件逻辑</p></blockquote><h3 id="├─-Alert"><a href="#├─-Alert" class="headerlink" title="├─ Alert"></a>├─ Alert</h3><blockquote><p>提示</p></blockquote><h4 id="–API–"><a href="#–API–" class="headerlink" title="–API–"></a>–API–</h4><table><thead><tr><th>Name</th><th>Description</th><th>Type</th><th>Default</th></tr></thead><tbody><tr><td>title</td><td>Alert 标题</td><td><code>string</code></td><td>—</td></tr><tr><td>type</td><td>Alert 类型</td><td><code>enum</code> - <code>&#39;success&#39;| &#39;warning&#39;| &#39;danger&#39;| &#39;info&#39;</code></td><td>info</td></tr><tr><td>description</td><td>描述性文本</td><td><code>string</code></td><td>—</td></tr><tr><td>closable</td><td>是否可以关闭</td><td><code>boolean</code></td><td>true</td></tr><tr><td>center</td><td>文字是否居中</td><td><code>boolean</code></td><td>false</td></tr><tr><td>show-icon</td><td>是否展示图标</td><td><code>boolean</code></td><td>false</td></tr><tr><td>effect</td><td>主题样式</td><td><code>enum</code> - <code>&#39;light&#39;| &#39;dark&#39;\</code></td><td>light</td></tr></tbody></table><table><thead><tr><th>Name</th><th>Description</th><th>Type</th></tr></thead><tbody><tr><td>close</td><td>关闭 Alert 时触发的事件</td><td><code>(event: MouseEvent)=&gt; void</code></td></tr></tbody></table><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>default</td><td>默认插槽，用于设置 Alert 的内容描述</td></tr><tr><td>title</td><td>标题的内容</td></tr></tbody></table><table><thead><tr><th>Name</th><th>Description</th><th>Type</th></tr></thead><tbody><tr><td>open</td><td>打开 Alert</td><td><code>() =&gt; void</code></td></tr><tr><td>close</td><td>关闭 Alert</td><td><code>() =&gt; void</code></td></tr></tbody></table><h4 id="├─-Alert-test-tsx"><a href="#├─-Alert-test-tsx" class="headerlink" title="├─ Alert.test.tsx"></a>├─ Alert.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, expect, vi &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">AlertType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Alert</span> <span class="keyword">from</span> <span class="string">&quot;./Alert.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Icon</span> <span class="keyword">from</span> <span class="string">&quot;../Icon/Icon.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Alert.vue&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> title = <span class="string">&quot;Test Alert&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> desc = <span class="string">&quot;This is a test description&quot;</span>;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should render the alert with default props&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        title,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: desc,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">global</span>: &#123;</span><br><span class="line">        <span class="attr">stubs</span>: [<span class="string">&quot;ErIcon&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(title);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(desc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// close icon</span></span><br><span class="line">    <span class="keyword">const</span> iconElement = wrapper.<span class="title function_">findComponent</span>(<span class="title class_">Icon</span>);</span><br><span class="line">    <span class="title function_">expect</span>(iconElement.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(iconElement.<span class="title function_">attributes</span>(<span class="string">&quot;icon&quot;</span>)).<span class="title function_">toBe</span>(<span class="string">&quot;xmark&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> wrapper2 = <span class="title function_">mount</span>(<span class="function">() =&gt;</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">Alert</span> <span class="attr">title</span>=<span class="string">&#123;title&#125;</span> <span class="attr">description</span>=<span class="string">&#123;desc&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Alert</span>&gt;</span></span></span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper2.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(title);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper2.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(desc);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it.<span class="title function_">each</span>([</span><br><span class="line">    [<span class="string">&quot;info&quot;</span>, <span class="string">&quot;circle-info&quot;</span>],</span><br><span class="line">    [<span class="string">&quot;success&quot;</span>, <span class="string">&quot;check-circle&quot;</span>],</span><br><span class="line">    [<span class="string">&quot;warning&quot;</span>, <span class="string">&quot;circle-exclamation&quot;</span>],</span><br><span class="line">    [<span class="string">&quot;danger&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">    [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">    [<span class="string">&quot;non-compliance&quot;</span>, <span class="string">&quot;circle-info&quot;</span>], <span class="comment">// 不符合 type 定义的</span></span><br><span class="line">  ])(<span class="string">&quot;should has the correct icon when props type is %s&quot;</span>, <span class="function">(<span class="params"><span class="keyword">type</span>, iconName</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        title,</span><br><span class="line">        <span class="attr">closable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">showIcon</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="keyword">type</span> <span class="keyword">as</span> <span class="title class_">AlertType</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: desc,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">global</span>: &#123;</span><br><span class="line">        <span class="attr">stubs</span>: [<span class="string">&quot;ErIcon&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> iconElement = wrapper.<span class="title function_">findComponent</span>(<span class="title class_">Icon</span>);</span><br><span class="line">    <span class="title function_">expect</span>(iconElement.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(iconElement.<span class="title function_">attributes</span>(<span class="string">&quot;icon&quot;</span>)).<span class="title function_">toBe</span>(iconName);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should emit close event when close icon is clicked&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> onClose = vi.<span class="title function_">fn</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        title,</span><br><span class="line">        <span class="attr">closable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">showIcon</span>: <span class="literal">false</span>,</span><br><span class="line">        onClose,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: desc,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">global</span>: &#123;</span><br><span class="line">        <span class="attr">stubs</span>: [<span class="string">&quot;ErIcon&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    wrapper.<span class="title function_">findComponent</span>(<span class="title class_">Icon</span>).<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onClose).<span class="title function_">toHaveBeenCalled</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should allow custom content via slots&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;test title&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: desc,</span><br><span class="line">        title,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(desc);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(title);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="property">not</span>.<span class="title function_">toContain</span>(<span class="string">&quot;test title&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should support centering text&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        title,</span><br><span class="line">        <span class="attr">description</span>: desc,</span><br><span class="line">        <span class="attr">center</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//class</span></span><br><span class="line">    <span class="keyword">const</span> rootNode = wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-alert&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(rootNode.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;text-center&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should not render close icon when closable is false&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; <span class="attr">closable</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-alert__close&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBe</span>(<span class="literal">false</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should toggle visibility when open and close methods are called&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Alert</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; title, <span class="attr">closable</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="property">vm</span>.<span class="title function_">close</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-alert&quot;</span>).<span class="title function_">attributes</span>().<span class="property">style</span>).<span class="title function_">toBe</span>(<span class="string">&quot;display: none;&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="property">vm</span>.<span class="title function_">open</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-alert&quot;</span>).<span class="title function_">attributes</span>().<span class="property">style</span>).<span class="title function_">toBe</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="├─-Alert-vue"><a href="#├─-Alert-vue" class="headerlink" title="├─ Alert.vue"></a>├─ Alert.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; AlertProps, AlertEmits, AlertInstance &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; ref, useSlots, computed &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; typeIconMap &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErAlert&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;AlertProps&gt;(), &#123;</span><br><span class="line">  effect: &quot;light&quot;,</span><br><span class="line">  type: &quot;info&quot;,</span><br><span class="line">  closable: true,</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;AlertEmits&gt;();</span><br><span class="line">const slots = useSlots();</span><br><span class="line"></span><br><span class="line">const visible = ref(true);</span><br><span class="line"></span><br><span class="line">const iconName = computed(() =&gt; typeIconMap.get(props.type) ?? &quot;circle-info&quot;);</span><br><span class="line">const withDescription = computed(() =&gt; props.description || slots.default);</span><br><span class="line"></span><br><span class="line">function close() &#123;</span><br><span class="line">  visible.value = false;</span><br><span class="line">  emits(&quot;close&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function open() &#123;</span><br><span class="line">  visible.value = true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defineExpose&lt;AlertInstance&gt;(&#123;</span><br><span class="line">  open,</span><br><span class="line">  close,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition name=&quot;er-alert-fade&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&quot;visible&quot;</span><br><span class="line">      class=&quot;er-alert&quot;</span><br><span class="line">      role=&quot;alert&quot;</span><br><span class="line">      :class=&quot;&#123;</span><br><span class="line">        [`er-alert__$&#123;type&#125;`]: type,</span><br><span class="line">        [`er-alert__$&#123;effect&#125;`]: effect,</span><br><span class="line">        &#x27;text-center&#x27;: center,</span><br><span class="line">      &#125;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;er-icon</span><br><span class="line">        v-if=&quot;showIcon&quot;</span><br><span class="line">        class=&quot;er-alert__icon&quot;</span><br><span class="line">        :class=&quot;&#123; &#x27;big-icon&#x27;: withDescription &#125;&quot;</span><br><span class="line">        :icon=&quot;iconName&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;div class=&quot;er-alert__content&quot;&gt;</span><br><span class="line">        &lt;span</span><br><span class="line">          class=&quot;er-alert__title&quot;</span><br><span class="line">          :class=&quot;&#123; &#x27;with-desc&#x27;: withDescription &#125;&quot;</span><br><span class="line">          :style=&quot;&#123; display: center &amp;&amp; !showIcon ? &#x27;flow&#x27; : &#x27;inline&#x27; &#125;&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;slot name=&quot;title&quot;&gt;&#123;&#123; title &#125;&#125;&lt;/slot&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">        &lt;p class=&quot;er-alert__description&quot;&gt;</span><br><span class="line">          &lt;slot&gt;&#123;&#123; description &#125;&#125;&lt;/slot&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;div class=&quot;er-alert__close&quot; v-if=&quot;closable&quot;&gt;</span><br><span class="line">          &lt;er-icon @click.stop=&quot;close&quot; icon=&quot;xmark&quot; /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-index-ts-1"><a href="#├─-index-ts-1" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Alert</span> <span class="keyword">from</span> <span class="string">&quot;./Alert.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErAlert</span> = <span class="title function_">withInstall</span>(<span class="title class_">Alert</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css"><a href="#├─-style-css" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-alert</span> &#123;</span><br><span class="line">  <span class="attr">--er-alert-padding</span>: <span class="number">8px</span> <span class="number">16px</span>;</span><br><span class="line">  <span class="attr">--er-alert-border-radius-base</span>: <span class="built_in">var</span>(--er-border-radius-base);</span><br><span class="line">  <span class="attr">--er-alert-bg-color</span>: <span class="built_in">var</span>(--er-color-white);</span><br><span class="line">  <span class="attr">--er-alert-title-font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attr">--er-alert-title-font-size-with-desc</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attr">--er-alert-desc-font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attr">--er-alert-text-color</span>: <span class="built_in">var</span>(--er-text-color-primary);</span><br><span class="line">  <span class="attr">--er-alert-top-margin</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attr">--er-alert-icon-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attr">--er-alert-icon-margin</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attr">--er-alert-big-icon-size</span>: <span class="number">28px</span>;</span><br><span class="line">  <span class="attr">--er-alert-big-icon-margin</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-alert</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="built_in">var</span>(--er-alert-padding);</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-alert-border-radius-base);</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-alert-bg-color);</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="built_in">var</span>(--er-alert-top-margin);</span><br><span class="line">  <span class="selector-class">.er-alert__icon</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-alert-text-color);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-alert-icon-size);</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">var</span>(--er-alert-icon-size);</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="built_in">var</span>(--er-alert-icon-margin);</span><br><span class="line">    &amp;<span class="selector-class">.big-icon</span>&#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-alert-big-icon-size);</span><br><span class="line">      <span class="attribute">width</span>: <span class="built_in">var</span>(--er-alert-big-icon-size);</span><br><span class="line">      <span class="attribute">margin-right</span>: <span class="built_in">var</span>(--er-alert-big-icon-margin);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-alert__content</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>:  <span class="built_in">var</span>(--er-alert-text-color);</span><br><span class="line">    <span class="attribute">vertical-align</span>: text-top;</span><br><span class="line">    <span class="selector-class">.er-alert__title</span>&#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-alert-title-font-size);</span><br><span class="line">      <span class="attribute">line-height</span>: <span class="number">24px</span>;</span><br><span class="line">      &amp;<span class="selector-class">.with-desc</span> &#123;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-alert-title-font-size-with-desc);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="selector-class">.er-alert__description</span>&#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-alert-desc-font-size);</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.er-alert__close</span> &#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-alert-close-font-size);</span><br><span class="line">      <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">      <span class="attribute">position</span>: absolute;</span><br><span class="line">      <span class="attribute">top</span>: <span class="number">12px</span>;</span><br><span class="line">      <span class="attribute">right</span>: <span class="number">15px</span>;</span><br><span class="line">      <span class="attribute">cursor</span>: pointer;</span><br><span class="line">      :<span class="built_in">deep</span>(.er-icon) &#123;</span><br><span class="line">        <span class="attribute">vertical-align</span>: top;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.er-alert__light</span> &#123;</span><br><span class="line">      <span class="selector-class">.er-alert__close</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="built_in">var</span>(--er-text-color-placeholder);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.er-alert__dark</span> &#123;</span><br><span class="line">      <span class="selector-class">.er-alert__close</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-white);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.text-center</span> &#123;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="selector-tag">span</span>,<span class="selector-tag">p</span> &#123;</span><br><span class="line">      <span class="attribute">text-align</span>: center;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-alert-fade-enter-from</span>,</span><br><span class="line"><span class="selector-class">.er-alert-fade-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@each</span> $val in success,warning,info,danger &#123; </span><br><span class="line">  <span class="selector-class">.er-alert__</span>$(val)<span class="selector-class">.er-alert__light</span> &#123;</span><br><span class="line">    <span class="attr">--er-alert-text-color</span>: <span class="built_in">var</span>(--er-color-$(val));</span><br><span class="line">    <span class="attr">--er-alert-bg-color</span>: <span class="built_in">var</span>(--er-color-$(val)-light-<span class="number">9</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-alert__</span>$(val)<span class="selector-class">.er-alert__dark</span> &#123;</span><br><span class="line">    <span class="attr">--er-alert-text-color</span>: <span class="built_in">var</span>(--er-color-white);</span><br><span class="line">    <span class="attr">--er-alert-bg-color</span>: <span class="built_in">var</span>(--er-color-$(val));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="└─-types-ts"><a href="#└─-types-ts" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">AlertType</span> = <span class="string">&quot;success&quot;</span> | <span class="string">&quot;info&quot;</span> | <span class="string">&quot;warning&quot;</span> | <span class="string">&quot;danger&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AlertProps</span> &#123;</span><br><span class="line">  <span class="attr">title</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">type</span>?: <span class="title class_">AlertType</span>;</span><br><span class="line">  <span class="attr">description</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">effect</span>?: <span class="string">&quot;light&quot;</span> | <span class="string">&quot;dark&quot;</span>;</span><br><span class="line">  <span class="attr">closable</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">center</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">showIcon</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AlertEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;close&quot;</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AlertInstance</span> &#123;</span><br><span class="line">  <span class="title function_">open</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">close</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-Button"><a href="#├─-Button" class="headerlink" title="├─ Button"></a>├─ Button</h3><h4 id="–API–-1"><a href="#–API–-1" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-Button-test-tsx"><a href="#├─-Button-test-tsx" class="headerlink" title="├─ Button.test.tsx"></a>├─ Button.test.tsx</h4><blockquote><p>单组件测试</p></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, expect &#125; <span class="keyword">from</span> <span class="string">&#x27;vitest&#x27;</span> <span class="comment">//vitest 是测试框架，提供 describe（定义测试套件）、it（定义单个测试用例）、expect（断言工具）</span></span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/test-utils&#x27;</span> <span class="comment">//Vue 的测试工具库，mount 函数用于挂载 Vue 组件以便测试</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Button</span> <span class="keyword">from</span> <span class="string">&#x27;./Button.vue&#x27;</span> <span class="comment">//引入需要测试的 Button.vue 组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ButtonProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span> <span class="comment">//引入组件的 props 类型定义，确保 props 的类型正确</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;Button.vue&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// type 属性的类名测试</span></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;type 属性被设置时，组件添加了对应的类名（如 er-button--primary）&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> types = [<span class="string">&#x27;primary&#x27;</span>, <span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;warning&#x27;</span>, <span class="string">&#x27;danger&#x27;</span>, <span class="string">&#x27;info&#x27;</span>] <span class="comment">//包含所有可能的 type 值</span></span><br><span class="line">types.<span class="title function_">forEach</span>(<span class="function">(<span class="params"><span class="keyword">type</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//遍历每个type类型</span></span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Button</span>, &#123;</span><br><span class="line"><span class="comment">//通过 mount 挂载 Button 组件，并传递当前 type 值作为 props</span></span><br><span class="line"><span class="attr">props</span>: &#123; <span class="attr">type</span>: <span class="keyword">type</span> <span class="keyword">as</span> <span class="title class_">ButtonProps</span>[<span class="string">&#x27;type&#x27;</span>] &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">`er-button--<span class="subst">$&#123;<span class="keyword">type</span>&#125;</span>`</span>) <span class="comment">//断言类名是否包含 er-button--$&#123;type&#125;</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// size 属性的类名测试</span></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;size 属性被设置时，组件添加了对应的类名（如 er-button--large）&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> sizes = [<span class="string">&#x27;large&#x27;</span>, <span class="string">&#x27;default&#x27;</span>, <span class="string">&#x27;small&#x27;</span>]</span><br><span class="line">sizes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">size</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Button</span>, &#123;</span><br><span class="line"><span class="attr">props</span>: &#123; <span class="attr">size</span>: size <span class="keyword">as</span> <span class="title class_">ButtonProps</span>[<span class="string">&#x27;size&#x27;</span>] &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">`er-button--<span class="subst">$&#123;size&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// plain、round 等布尔属性的类名测试</span></span><br><span class="line">it.<span class="title function_">each</span>([</span><br><span class="line"><span class="comment">//一个参数化测试，通过数组中的每一项（[prop, className]）生成多个测试用例</span></span><br><span class="line">[<span class="string">&#x27;plain&#x27;</span>, <span class="string">&#x27;is-plain&#x27;</span>],</span><br><span class="line">[<span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;is-round&#x27;</span>],</span><br><span class="line">[<span class="string">&#x27;circle&#x27;</span>, <span class="string">&#x27;is-circle&#x27;</span>],</span><br><span class="line">[<span class="string">&#x27;disabled&#x27;</span>, <span class="string">&#x27;is-disabled&#x27;</span>],</span><br><span class="line">[<span class="string">&#x27;loading&#x27;</span>, <span class="string">&#x27;is-loading&#x27;</span>],</span><br><span class="line">])(</span><br><span class="line"><span class="string">&#x27;当 prop（如 plain）被设置为 true 时，组件添加了对应的类名（如 is-plain）&#x27;</span>,</span><br><span class="line"><span class="function">(<span class="params">prop, className</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Button</span>, &#123;</span><br><span class="line"><span class="comment">//挂载组件</span></span><br><span class="line"><span class="attr">props</span>: &#123; [prop]: <span class="literal">true</span> &#125;, <span class="comment">//设置 props[prop] = true</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(className) <span class="comment">//断言类名是否包含 className</span></span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// nativeType 属性的 type 属性测试</span></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;当 tag 是 button 时，组件的 type 属性等于 nativeType（如 submit）&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Button</span>, &#123;</span><br><span class="line"><span class="attr">props</span>: &#123; <span class="attr">tag</span>: <span class="string">&#x27;button&#x27;</span>, <span class="attr">nativeType</span>: <span class="string">&#x27;submit&#x27;</span> &#125;, <span class="comment">//设置 tag 为 button，nativeType 为 submit</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">tagName</span>).<span class="title function_">toBe</span>(<span class="string">&#x27;BUTTON&#x27;</span>) <span class="comment">//标签名是否为 BUTTON</span></span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">type</span>).<span class="title function_">toBe</span>(<span class="string">&#x27;submit&#x27;</span>) <span class="comment">//type 属性是否为 submit</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// tag 属性的标签名测试</span></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;当 tag 被设置为 a 时，组件的根元素为 &lt;a&gt; 标签&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Button</span>, &#123;</span><br><span class="line"><span class="attr">props</span>: &#123; <span class="attr">tag</span>: <span class="string">&#x27;a&#x27;</span> &#125;, <span class="comment">//挂载组件并设置 tag 为 a</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">tagName</span>.<span class="title function_">toLowerCase</span>()).<span class="title function_">toBe</span>(<span class="string">&#x27;a&#x27;</span>) <span class="comment">//断言标签名是否为 a（小写）</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// click 事件测试</span></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;点击按钮时触发 click 事件&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Button</span>)</span><br><span class="line"><span class="keyword">await</span> wrapper.<span class="title function_">trigger</span>(<span class="string">&#x27;click&#x27;</span>) <span class="comment">//使用 trigger(&#x27;click&#x27;) 模拟点击事件（需 await 确保异步完成）</span></span><br><span class="line"><span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>().<span class="property">click</span>).<span class="title function_">toHaveLength</span>(<span class="number">1</span>) <span class="comment">//断言 emitted().click 是否有 1 次触发</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="├─-Button-vue"><a href="#├─-Button-vue" class="headerlink" title="├─ Button.vue"></a>├─ Button.vue</h4><blockquote><p>组件实现</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, computed, inject &#125; from &quot;vue&quot;;//响应式,计算,上下文依赖项注入</span><br><span class="line">import type &#123; ButtonProps, ButtonEmits, ButtonInstance &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; BUTTON_GROUP_CTX_KEY &#125; from &quot;./constants&quot;;//标识按钮组上下文</span><br><span class="line">import &#123; throttle &#125; from &quot;lodash-es&quot;;//节流事件处理</span><br><span class="line">import TyIcon from &quot;../Icon/Icon.vue&quot;;//自定义的图标组件TyIcon</span><br><span class="line">defineOptions(&#123;//定义组件的名称为 ErButton</span><br><span class="line">  name: &quot;ErButton&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;ButtonProps&gt;(), &#123;//定义组件的props+设置默认值</span><br><span class="line">  tag: &quot;button&quot;,//HTML 标签名</span><br><span class="line">  nativeType: &quot;button&quot;,//原生按钮类型</span><br><span class="line">  useThrottle: true,//启用节流</span><br><span class="line">  throttleDuration: 500,//节流持续时间</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;ButtonEmits&gt;();//事件发射器</span><br><span class="line">const slots = defineSlots();//插槽，用于动态渲染内容</span><br><span class="line">const buttonGroupCtx = inject(BUTTON_GROUP_CTX_KEY, void 0);//注入按钮组上下文（如果存在），用于继承按钮组的配置（如 size、type 等）</span><br><span class="line"></span><br><span class="line">const _ref = ref&lt;HTMLButtonElement&gt;();</span><br><span class="line">//计算属性 size，优先使用按钮组上下文中的 size，其次使用 props.size，最后为空字符串</span><br><span class="line">const size = computed(() =&gt; buttonGroupCtx?.size ?? props.size ?? &quot;&quot;);</span><br><span class="line">//计算属性 type，优先使用按钮组上下文中的 type，其次使用 props.type，最后为空字符串</span><br><span class="line">const type = computed(() =&gt; buttonGroupCtx?.type ?? props.type ?? &quot;&quot;);</span><br><span class="line">//定义计算属性 disabled，优先使用 props.disabled，其次使用按钮组上下文中的 disabled，最后为 false</span><br><span class="line">const disabled = computed(() =&gt; props.disabled || buttonGroupCtx?.disabled || false);</span><br><span class="line">//计算属性 iconStyle，当按钮有默认插槽内容时，图标右侧添加 6px 的间距，否则不添加间距</span><br><span class="line">const iconStyle = computed(() =&gt; (&#123;marginRight: slots.default ? &quot;6px&quot; : &quot;0px&quot;,&#125;));</span><br><span class="line"></span><br><span class="line">//触发 click 事件并将事件对象传递给父组件</span><br><span class="line">const handleBtnClick = (e: MouseEvent) =&gt; &#123;</span><br><span class="line">  emits(&quot;click&quot;, e);</span><br><span class="line">&#125;;</span><br><span class="line">//使用 throttle 对 handleBtnClick 进行节流，限制点击事件的触发频率</span><br><span class="line">const handlBtneCLickThrottle = throttle(handleBtnClick, props.throttleDuration);</span><br><span class="line"></span><br><span class="line">//暴露组件的内部状态和方法，供父组件通过 ref 访问</span><br><span class="line">defineExpose&lt;ButtonInstance&gt;(&#123;</span><br><span class="line">  ref: _ref,</span><br><span class="line">  disabled,</span><br><span class="line">  size,</span><br><span class="line">  type,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;component</span><br><span class="line">    :is=&quot;tag&quot;//动态决定组件的根标签类型（button/a）</span><br><span class="line">    ref=&quot;_ref&quot;//为组件实例绑定一个引用`ref`（可通过 `this.$refs._ref` 获取到该按钮的 DOM 元素）</span><br><span class="line">    class=&quot;er-button&quot;</span><br><span class="line">    :class=&quot;&#123;//使用对象语法动态绑定类名</span><br><span class="line">      [`er-button--$&#123;type&#125;`]: type, //当 `type` 存在时（如 `primary`、`success`），添加类名 `er-button--primary`</span><br><span class="line">      [`er-button--$&#123;size&#125;`]: size, //当 `size` 存在时（如 `large`、`small`），添加类名 `er-button--large`</span><br><span class="line">      &#x27;is-plain&#x27;: plain, //当 plain 为 true 时，添加类名 `is-plain`</span><br><span class="line">      &#x27;is-round&#x27;: round, //当 round 为 true 时，添加类名 `is-round`</span><br><span class="line">      &#x27;is-circle&#x27;: circle,</span><br><span class="line">      &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">      &#x27;is-loading&#x27;: loading,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">    :disabled=&quot;disabled || loading ? true : void 0&quot; //`disabled` 为 `true`，则渲染为 `&lt;button disabled&gt;`按钮被禁用</span><br><span class="line">    :type=&quot;tag === &#x27;button&#x27; ? nativeType : void 0&quot;</span><br><span class="line">    :autofocus=&quot;autofocus&quot; //当 `autofocus` 为 `true` 时，按钮自动获得焦点</span><br><span class="line">    @click=&quot;</span><br><span class="line">      (e: MouseEvent) =&gt;</span><br><span class="line">        useThrottle ? handlBtneCLickThrottle(e) : handleBtnClick(e)</span><br><span class="line">    &quot; //当 `useThrottle` 为 `true` 时，调用防抖的 `handlBtneCLickThrottle` 方法；否则调用普通点击事件 `handleBtnClick`</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;template v-if=&quot;loading&quot;&gt;//条件插槽</span><br><span class="line">      &lt;slot name=&quot;loading&quot;&gt;//默认 || 接收用户传来的&lt;er-icon&gt;标签</span><br><span class="line">        &lt;er-icon//默认提供spinner加载图标</span><br><span class="line">          class=&quot;loading-icon&quot;</span><br><span class="line">          :icon=&quot;loadingIcon ?? &#x27;spinner&#x27;&quot;//不是库中的Icon就默认图标为spinner</span><br><span class="line">          :style=&quot;iconStyle&quot;//默认style，用户可改</span><br><span class="line">          size=&quot;1x&quot;//锁定的大小</span><br><span class="line">          spin//</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;er-icon</span><br><span class="line">      :icon=&quot;icon&quot;</span><br><span class="line">      size=&quot;1x&quot;</span><br><span class="line">      :style=&quot;iconStyle&quot;</span><br><span class="line">      v-if=&quot;icon &amp;&amp; !loading&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/component&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-ButtonGroup-vue"><a href="#├─-ButtonGroup-vue" class="headerlink" title="├─ ButtonGroup.vue"></a>├─ ButtonGroup.vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; ButtonGroupProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; provide, reactive, toRef &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; BUTTON_GROUP_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErButtonGroup&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const props = defineProps&lt;ButtonGroupProps&gt;();</span><br><span class="line"></span><br><span class="line">provide(</span><br><span class="line">  BUTTON_GROUP_CTX_KEY,</span><br><span class="line">  reactive(&#123;</span><br><span class="line">    size: toRef(props, &quot;size&quot;),</span><br><span class="line">    type: toRef(props, &quot;type&quot;),</span><br><span class="line">    disabled: toRef(props, &quot;disabled&quot;),</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;er-button-group&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-constants-ts"><a href="#├─-constants-ts" class="headerlink" title="├─ constants.ts"></a>├─ constants.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ButtonGroupContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//注入键（Injection Key）（BUTTON_GROUP_CTX_KEY）</span></span><br><span class="line"><span class="comment">//主要作用是为按钮组组件（`ButtonGroup`）提供上下文（context），使得按钮组中的子按钮可以访问父级按钮组的相关信息。</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">BUTTON_GROUP_CTX_KEY</span>: </span><br><span class="line"><span class="title class_">InjectionKey</span>&lt;<span class="title class_">ButtonGroupContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;buttonGroupContext&quot;</span>);<span class="comment">//原始数据类型，用于创建唯一的标识符</span></span><br></pre></td></tr></table></figure><p>举个例子</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父组件</span></span><br><span class="line"><span class="comment">//会使用 `provide` 方法将某些数据或方法提供给子组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; provide &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>; </span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">BUTTON_GROUP_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constants&quot;</span>; </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; </span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123; </span><br><span class="line"><span class="keyword">const</span> buttonGroupContext = &#123; <span class="attr">size</span>: <span class="string">&quot;large&quot;</span>, <span class="attr">type</span>: <span class="string">&quot;primary&quot;</span>, &#125;; </span><br><span class="line"><span class="title function_">provide</span>(<span class="variable constant_">BUTTON_GROUP_CTX_KEY</span>, buttonGroupContext); <span class="comment">// 提供上下文 </span></span><br><span class="line"><span class="keyword">return</span> &#123;&#125;; </span><br><span class="line">&#125;, </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//子组件</span></span><br><span class="line"><span class="comment">//可以通过 `inject` 方法获取父组件提供的上下文</span></span><br><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">BUTTON_GROUP_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constants&quot;</span>; </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123; </span><br><span class="line"><span class="keyword">const</span> buttonGroupContext = <span class="title function_">inject</span>(<span class="variable constant_">BUTTON_GROUP_CTX_KEY</span>); <span class="comment">// 注入上下文 </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buttonGroupContext); <span class="comment">// 输出 &#123; size: &quot;large&quot;, type: &quot;primary&quot; &#125; </span></span><br><span class="line"><span class="keyword">return</span> &#123;&#125;; </span><br><span class="line">&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="├─-index-ts-2"><a href="#├─-index-ts-2" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote><p>用 <code>withInstall</code> 方法将组件注册为全局组件</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Button</span> <span class="keyword">from</span> <span class="string">&quot;./Button.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ButtonGroup</span> <span class="keyword">from</span> <span class="string">&quot;./ButtonGroup.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@tyche/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErButton</span> = <span class="title function_">withInstall</span>(<span class="title class_">Button</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErButtonGroup</span> = <span class="title function_">withInstall</span>(<span class="title class_">ButtonGroup</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-1"><a href="#├─-style-css-1" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-1"><a href="#└─-types-ts-1" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Component</span>, <span class="keyword">type</span> <span class="title class_">ComputedRef</span>, <span class="keyword">type</span> <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ButtonType</span> = <span class="string">&#x27;primary&#x27;</span> | <span class="string">&#x27;success&#x27;</span> | <span class="string">&#x27;warning&#x27;</span> | <span class="string">&#x27;danger&#x27;</span> | <span class="string">&#x27;info&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NativeType</span> = <span class="string">&#x27;button&#x27;</span> | <span class="string">&#x27;submit&#x27;</span> | <span class="string">&#x27;reset&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ButtonSize</span> = <span class="string">&#x27;default&#x27;</span> | <span class="string">&#x27;large&#x27;</span> | <span class="string">&#x27;small&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonProps</span> &#123;</span><br><span class="line"><span class="attr">tag</span>?: <span class="built_in">string</span> | <span class="title class_">Component</span></span><br><span class="line"><span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line"><span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line"><span class="attr">plain</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">round</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">circle</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">autofocus</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">nativeType</span>?: <span class="title class_">NativeType</span></span><br><span class="line"><span class="attr">icon</span>?: <span class="built_in">string</span></span><br><span class="line"><span class="attr">loading</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">loadingIcon</span>?: <span class="built_in">string</span></span><br><span class="line"><span class="attr">useThrottle</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">throttleDuration</span>?: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonGroupProps</span> &#123;</span><br><span class="line"><span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line"><span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line"><span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonGroupContext</span> &#123;</span><br><span class="line"><span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line"><span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line"><span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonEmits</span> &#123;</span><br><span class="line">(<span class="attr">e</span>: <span class="string">&#x27;click&#x27;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonInstance</span> &#123;</span><br><span class="line"><span class="attr">ref</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">HTMLButtonElement</span> | <span class="built_in">void</span>&gt;</span><br><span class="line"><span class="attr">disabled</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">boolean</span>&gt;</span><br><span class="line"><span class="attr">size</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line"><span class="attr">type</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-Collapse"><a href="#├─-Collapse" class="headerlink" title="├─ Collapse"></a>├─ Collapse</h3><blockquote><p>折叠面板</p></blockquote><h4 id="–API–-2"><a href="#–API–-2" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-Collapse-test-tsx"><a href="#├─-Collapse-test-tsx" class="headerlink" title="├─ Collapse.test.tsx"></a>├─ Collapse.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; beforeAll, describe, expect, test, vi &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DOMWrapper</span>, mount, <span class="keyword">type</span> <span class="title class_">VueWrapper</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> transitionEvents <span class="keyword">from</span> <span class="string">&quot;./transitionEvents&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Collapse</span> <span class="keyword">from</span> <span class="string">&quot;./Collapse.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CollapseItem</span> <span class="keyword">from</span> <span class="string">&quot;./CollapseItem.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> onChange = vi.<span class="title function_">fn</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">wrapper</span>: <span class="title class_">VueWrapper</span>,</span><br><span class="line">  <span class="attr">headers</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;[],</span><br><span class="line">  <span class="attr">contents</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;[];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">firstHeader</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;,</span><br><span class="line">  <span class="attr">secondHeader</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;,</span><br><span class="line">  <span class="attr">disabledHeader</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;,</span><br><span class="line">  <span class="attr">firstContent</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;,</span><br><span class="line">  <span class="attr">secondContent</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;,</span><br><span class="line">  <span class="attr">disabledContent</span>: <span class="title class_">DOMWrapper</span>&lt;<span class="title class_">Element</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Collapse.vue&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">beforeAll</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    wrapper = <span class="title function_">mount</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Collapse</span> <span class="attr">modelValue</span>=<span class="string">&#123;[</span>&quot;<span class="attr">a</span>&quot;]&#125; &#123;<span class="attr">...</span>&#123; <span class="attr">onChange</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title a&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content a</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;b&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title b&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content b</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;c&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title c&quot;</span> <span class="attr">disabled</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content c</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Collapse</span>&gt;</span></span></span><br><span class="line">      ),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">global</span>: &#123;</span><br><span class="line">          <span class="attr">stubs</span>: [<span class="string">&quot;ErIcon&quot;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">attachTo</span>: <span class="variable language_">document</span>.<span class="property">body</span>, <span class="comment">// 最新版本 jsdom 更新缓存 bug</span></span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    headers = wrapper.<span class="title function_">findAll</span>(<span class="string">&quot;.er-collapse-item__header&quot;</span>);</span><br><span class="line">    contents = wrapper.<span class="title function_">findAll</span>(<span class="string">&quot;.er-collapse-item__wapper&quot;</span>);</span><br><span class="line"></span><br><span class="line">    firstHeader = headers[<span class="number">0</span>];</span><br><span class="line">    secondHeader = headers[<span class="number">1</span>];</span><br><span class="line">    disabledHeader = headers[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    firstContent = contents[<span class="number">0</span>];</span><br><span class="line">    secondContent = contents[<span class="number">1</span>];</span><br><span class="line">    disabledContent = contents[<span class="number">2</span>];</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;测试基础结构以及对应文本&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// lenght</span></span><br><span class="line">    <span class="title function_">expect</span>(headers.<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="title function_">expect</span>(contents.<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// title</span></span><br><span class="line">    <span class="title function_">expect</span>(firstHeader.<span class="title function_">text</span>()).<span class="title function_">toBe</span>(<span class="string">&quot;title a&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// content</span></span><br><span class="line">    <span class="title function_">expect</span>(firstHeader.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(firstContent.<span class="title function_">isVisible</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(secondHeader.<span class="title function_">classes</span>()).<span class="property">not</span>.<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(secondContent.<span class="title function_">isVisible</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(firstContent.<span class="title function_">text</span>()).<span class="title function_">toBe</span>(<span class="string">&quot;content a&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(secondContent.<span class="title function_">text</span>()).<span class="title function_">toBe</span>(<span class="string">&quot;content b&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;点击标题展开/关闭内容&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// events</span></span><br><span class="line">    <span class="keyword">await</span> firstHeader.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(firstContent.<span class="title function_">isVisible</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="keyword">await</span> secondHeader.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(secondHeader.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(secondHeader.<span class="title function_">isVisible</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(firstHeader.<span class="title function_">classes</span>()).<span class="property">not</span>.<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(firstContent.<span class="title function_">isVisible</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;发送正确的事件&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(onChange).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onChange).<span class="title function_">toHaveBeenCalledWith</span>([]);</span><br><span class="line">    <span class="title function_">expect</span>(onChange).<span class="title function_">toHaveBeenLastCalledWith</span>([<span class="string">&quot;b&quot;</span>]);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;disabled 内容&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// disabled</span></span><br><span class="line">    <span class="title function_">expect</span>(disabledHeader.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-disabled&quot;</span>);</span><br><span class="line">    onChange.<span class="title function_">mockClear</span>();</span><br><span class="line">    <span class="keyword">await</span> disabledHeader.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(disabledContent.<span class="title function_">isVisible</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onChange).<span class="property">not</span>.<span class="title function_">toHaveBeenCalled</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;modelValue 变更&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    wrapper.<span class="title function_">setValue</span>([<span class="string">&quot;b&quot;</span>], <span class="string">&quot;modelValue&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="property">vm</span>.$nextTick();</span><br><span class="line">    <span class="title function_">expect</span>(secondHeader.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(firstHeader.<span class="title function_">classes</span>()).<span class="property">not</span>.<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;手风琴模式&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    wrapper = <span class="title function_">mount</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Collapse</span> <span class="attr">accordion</span> <span class="attr">modelValue</span>=<span class="string">&#123;[</span>&quot;<span class="attr">a</span>&quot;]&#125; &#123;<span class="attr">...</span>&#123; <span class="attr">onChange</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title a&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content a</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;b&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title b&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content b</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Collapse</span>&gt;</span></span></span><br><span class="line">      ),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">global</span>: &#123;</span><br><span class="line">          <span class="attr">stubs</span>: [<span class="string">&quot;ErIcon&quot;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">attachTo</span>: <span class="variable language_">document</span>.<span class="property">body</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    headers = wrapper.<span class="title function_">findAll</span>(<span class="string">&quot;.er-collapse-item__header&quot;</span>);</span><br><span class="line">    contents = wrapper.<span class="title function_">findAll</span>(<span class="string">&quot;.er-collapse-item__wapper&quot;</span>);</span><br><span class="line"></span><br><span class="line">    firstHeader = headers[<span class="number">0</span>];</span><br><span class="line">    secondHeader = headers[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    firstContent = contents[<span class="number">0</span>];</span><br><span class="line">    secondContent = contents[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">await</span> firstHeader.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> secondHeader.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onChange).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onChange).<span class="title function_">toHaveBeenCalledWith</span>([<span class="string">&quot;b&quot;</span>]);</span><br><span class="line">    <span class="title function_">expect</span>(firstHeader.<span class="title function_">classes</span>()).<span class="property">not</span>.<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(secondHeader.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-active&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;手风琴模式 错误处理&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> warn = vi.<span class="title function_">spyOn</span>(<span class="variable language_">console</span>, <span class="string">&quot;warn&quot;</span>).<span class="title function_">mockImplementation</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">    <span class="title function_">mount</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Collapse</span> <span class="attr">accordion</span> <span class="attr">modelValue</span>=<span class="string">&#123;[</span>&quot;<span class="attr">a</span>&quot;, &quot;<span class="attr">b</span>&quot;]&#125; &#123;<span class="attr">...</span>&#123; <span class="attr">onChange</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title a&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content a</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;b&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title b&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content b</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CollapseItem</span> <span class="attr">name</span>=<span class="string">&quot;c&quot;</span> <span class="attr">title</span>=<span class="string">&quot;title c&quot;</span> <span class="attr">disabled</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            content c</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CollapseItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Collapse</span>&gt;</span></span></span><br><span class="line">      ),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">global</span>: &#123;</span><br><span class="line">          <span class="attr">stubs</span>: [<span class="string">&quot;ErIcon&quot;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">    <span class="title function_">expect</span>(warn.<span class="property">mock</span>.<span class="property">calls</span>).<span class="title function_">toMatchInlineSnapshot</span>(</span><br><span class="line">      <span class="string">`</span></span><br><span class="line"><span class="string">        [</span></span><br><span class="line"><span class="string">          [</span></span><br><span class="line"><span class="string">            [ErUIError: [ErCollapse] accordion mode should only have one active item],</span></span><br><span class="line"><span class="string">          ],</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      `</span></span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Collapse/transitionEvents.ts&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;beforeEnter&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    transitionEvents.<span class="title function_">beforeEnter</span>(wrapper.<span class="property">element</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">height</span>).<span class="title function_">toBe</span>(<span class="string">&quot;0px&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">overflow</span>).<span class="title function_">toBe</span>(<span class="string">&quot;hidden&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;enter&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    transitionEvents.<span class="title function_">enter</span>(wrapper.<span class="property">element</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">height</span>).<span class="title function_">toBe</span>(</span><br><span class="line">      <span class="string">`<span class="subst">$&#123;wrapper.element.scrollHeight&#125;</span>px`</span></span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;afterEnter&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    transitionEvents.<span class="title function_">afterEnter</span>(wrapper.<span class="property">element</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">height</span>).<span class="title function_">toBe</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">overflow</span>).<span class="title function_">toBe</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;beforeLeave&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    transitionEvents.<span class="title function_">beforeLeave</span>(wrapper.<span class="property">element</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">height</span>).<span class="title function_">toBe</span>(</span><br><span class="line">      <span class="string">`<span class="subst">$&#123;wrapper.element.scrollHeight&#125;</span>px`</span></span><br><span class="line">    );</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">overflow</span>).<span class="title function_">toBe</span>(<span class="string">&quot;hidden&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;leave&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    transitionEvents.<span class="title function_">leave</span>(wrapper.<span class="property">element</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">height</span>).<span class="title function_">toBe</span>(<span class="string">&quot;0px&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;afterLeave&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    transitionEvents.<span class="title function_">afterLeave</span>(wrapper.<span class="property">element</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">height</span>).<span class="title function_">toBe</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="property">element</span>.<span class="property">style</span>.<span class="property">overflow</span>).<span class="title function_">toBe</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="├─-Collapse-vue"><a href="#├─-Collapse-vue" class="headerlink" title="├─ Collapse.vue"></a>├─ Collapse.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, provide, watch &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; each &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import type &#123;</span><br><span class="line">  CollapseItemName,</span><br><span class="line">  CollapseProps,</span><br><span class="line">  CollapseEmits,</span><br><span class="line">&#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; debugWarn &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import &#123; COLLAPSE_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line"></span><br><span class="line">const COMPONENT_NAME = &quot;ErCollapse&quot; as const;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: COMPONENT_NAME,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const props = defineProps&lt;CollapseProps&gt;();</span><br><span class="line">const emits = defineEmits&lt;CollapseEmits&gt;();</span><br><span class="line">const activeNames = ref&lt;CollapseItemName[]&gt;(props.modelValue);</span><br><span class="line"></span><br><span class="line">if (props.accordion &amp;&amp; activeNames.value.length &gt; 1) &#123;</span><br><span class="line">  debugWarn(COMPONENT_NAME, &quot;accordion mode should only have one active item&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleItemClick(item: CollapseItemName) &#123;</span><br><span class="line">  let _activeNames = [...activeNames.value];</span><br><span class="line">  // 手风琴模式</span><br><span class="line">  if (props.accordion) &#123;</span><br><span class="line">    _activeNames = [_activeNames[0] === item ? &quot;&quot; : item];</span><br><span class="line">    updateActiveNames(_activeNames);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const index = _activeNames.indexOf(item);</span><br><span class="line">  if (index &gt; -1) &#123;</span><br><span class="line">    // 存在，删除数组中的一项</span><br><span class="line">    _activeNames.splice(index, 1);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // 不存在，插入对应 name</span><br><span class="line">    _activeNames.push(item);</span><br><span class="line">  &#125;</span><br><span class="line">  updateActiveNames(_activeNames);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function updateActiveNames(val: CollapseItemName[]) &#123;</span><br><span class="line">  activeNames.value = val;</span><br><span class="line">  each([&quot;update:modelValue&quot;, &quot;change&quot;], (e) =&gt;</span><br><span class="line">    emits(e as &quot;update:modelValue&quot; &amp; &quot;change&quot;, val)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.modelValue,</span><br><span class="line">  (val) =&gt; updateActiveNames(val)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">provide(COLLAPSE_CTX_KEY, &#123;</span><br><span class="line">  activeNames,</span><br><span class="line">  handleItemClick,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;er-collapse&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-CollapseItem-vue"><a href="#├─-CollapseItem-vue" class="headerlink" title="├─ CollapseItem.vue"></a>├─ CollapseItem.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; type CollapseItemProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; inject, computed &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; COLLAPSE_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line">import transitionEvents from &quot;./transitionEvents&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErCollapseItem&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const props = defineProps&lt;CollapseItemProps&gt;();</span><br><span class="line"></span><br><span class="line">const ctx = inject(COLLAPSE_CTX_KEY);</span><br><span class="line"></span><br><span class="line">const isActive = computed(() =&gt; ctx?.activeNames.value?.includes(props.name));</span><br><span class="line"></span><br><span class="line">function handleClick() &#123;</span><br><span class="line">  if (props.disabled) return;</span><br><span class="line">  ctx?.handleItemClick(props.name);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;er-collapse-item&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;er-collapse-item__header&quot;</span><br><span class="line">      :id=&quot;`item-header-$&#123;name&#125;`&quot;</span><br><span class="line">      :class=&quot;&#123;</span><br><span class="line">        &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">        &#x27;is-active&#x27;: isActive,</span><br><span class="line">      &#125;&quot;</span><br><span class="line">      @click=&quot;handleClick&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;span class=&quot;er-collapse-item__title&quot;&gt;</span><br><span class="line">        &lt;slot name=&quot;title&quot;&gt;</span><br><span class="line">          &#123;&#123; title &#125;&#125;</span><br><span class="line">        &lt;/slot&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      &lt;er-icon icon=&quot;angle-right&quot; class=&quot;header-angle&quot; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;transition name=&quot;slide&quot; v-on=&quot;transitionEvents&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;er-collapse-item__wapper&quot; v-show=&quot;isActive&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;er-collapse-item__content&quot; :id=&quot;`item-content-$&#123;name&#125;`&quot;&gt;</span><br><span class="line">          &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-constants-ts-1"><a href="#├─-constants-ts-1" class="headerlink" title="├─ constants.ts"></a>├─ constants.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">CollapseContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">COLLAPSE_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">CollapseContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;collapseContext&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="├─-index-ts-3"><a href="#├─-index-ts-3" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Collapse</span> <span class="keyword">from</span> <span class="string">&quot;./Collapse.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CollapseItem</span> <span class="keyword">from</span> <span class="string">&quot;./CollapseItem.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErCollapse</span> = <span class="title function_">withInstall</span>(<span class="title class_">Collapse</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErCollapseItem</span> = <span class="title function_">withInstall</span>(<span class="title class_">CollapseItem</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-2"><a href="#├─-style-css-2" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-collapse</span> &#123;</span><br><span class="line">  <span class="attr">--er-collapse-border-color</span>: <span class="built_in">var</span>(--er-border-color-light);</span><br><span class="line">  <span class="attr">--er-collapse-header-height</span>: <span class="number">48px</span>;</span><br><span class="line">  <span class="attr">--er-collapse-header-bg-color</span>: <span class="built_in">var</span>(--er-fill-color-blank);</span><br><span class="line">  <span class="attr">--er-collapse-header-text-color</span>: <span class="built_in">var</span>(--er-text-color-primary);</span><br><span class="line">  <span class="attr">--er-collapse-header-font-size</span>: <span class="number">13px</span>;</span><br><span class="line">  <span class="attr">--er-collapse-content-bg-color</span>: <span class="built_in">var</span>(--er-fill-color-blank);</span><br><span class="line">  <span class="attr">--er-collapse-content-font-size</span>: <span class="number">13px</span>;</span><br><span class="line">  <span class="attr">--er-collapse-content-text-color</span>: <span class="built_in">var</span>(--er-text-color-primary);</span><br><span class="line">  <span class="attr">--er-collapse-disabled-text-color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">  <span class="attr">--er-collapse-disabled-border-color</span>: <span class="built_in">var</span>(--er-border-color-lighter);</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-collapse-border-color);</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-collapse-border-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-collapse-item__header</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">height</span>: <span class="built_in">var</span>(--er-collapse-header-height);</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="built_in">var</span>(--er-collapse-header-height);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-collapse-header-bg-color);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--er-collapse-header-text-color);</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-collapse-header-font-size);</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">  <span class="attribute">transition</span>: border-bottom-color <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-collapse-border-color);</span><br><span class="line">  &amp;<span class="selector-class">.is-disabled</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-collapse-disabled-text-color);</span><br><span class="line">    <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    <span class="attribute">background-image</span>: none;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-active</span> &#123;</span><br><span class="line">    <span class="attribute">border-bottom-color</span>: transparent;</span><br><span class="line">    <span class="selector-class">.header-angle</span> &#123;</span><br><span class="line">      <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">90deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.header-angle</span> &#123;</span><br><span class="line">    <span class="attribute">transition</span>: transform <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-collapse-item__content</span> &#123;</span><br><span class="line">  <span class="attribute">will-change</span>: height;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-collapse-content-bg-color);</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-collapse-content-font-size);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--er-collapse-content-text-color);</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-collapse-border-color);</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">25px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.slide-enter-active</span>,</span><br><span class="line"><span class="selector-class">.slide-leave-active</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: height <span class="built_in">var</span>(--er-transition-duration) ease-in-out;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="├─-transitionEvents-ts"><a href="#├─-transitionEvents-ts" class="headerlink" title="├─ transitionEvents.ts"></a>├─ transitionEvents.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">_setHeightZero</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;0px&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setHeightScroll</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt;</span><br><span class="line">  (el.<span class="property">style</span>.<span class="property">height</span> = <span class="string">`<span class="subst">$&#123;el.scrollHeight&#125;</span>px`</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setHeightEmpty</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setOverflowHidden</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&quot;hidden&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setOverflowEmpty</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">transitionEvents</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="function">(<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt;</span> <span class="built_in">void</span>&gt; = &#123;</span><br><span class="line">  <span class="title function_">beforeEnter</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightZero</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowHidden</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">enter</span>: <span class="function">(<span class="params">el</span>) =&gt;</span> <span class="title function_">_setHeightScroll</span>(el),</span><br><span class="line">  <span class="title function_">afterEnter</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightEmpty</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowEmpty</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeLeave</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightScroll</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowHidden</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">leave</span>: <span class="function">(<span class="params">el</span>) =&gt;</span> <span class="title function_">_setHeightZero</span>(el),</span><br><span class="line">  <span class="title function_">afterLeave</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightEmpty</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowEmpty</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> transitionEvents;</span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-2"><a href="#└─-types-ts-2" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CollapseItemName</span> = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseProps</span> &#123;</span><br><span class="line">  <span class="attr">modelValue</span>: <span class="title class_">CollapseItemName</span>[];</span><br><span class="line">  <span class="attr">accordion</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseItemProps</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="title class_">CollapseItemName</span>;</span><br><span class="line">  <span class="attr">title</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseContext</span> &#123;</span><br><span class="line">  <span class="attr">activeNames</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">CollapseItemName</span>[]&gt;;</span><br><span class="line">  <span class="title function_">handleItemClick</span>(<span class="attr">name</span>: <span class="title class_">CollapseItemName</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;update:modelValue&quot;</span>, <span class="attr">value</span>: <span class="title class_">CollapseItemName</span>[]): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;change&quot;</span>, <span class="attr">value</span>: <span class="title class_">CollapseItemName</span>[]): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-ConfigProvider"><a href="#├─-ConfigProvider" class="headerlink" title="├─ ConfigProvider"></a>├─ ConfigProvider</h3><blockquote><p>全局配置组件，用于设置组件库的全局属性</p></blockquote><h4 id="–API–-3"><a href="#–API–-3" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-ConfigProvider-vue"><a href="#├─-ConfigProvider-vue" class="headerlink" title="├─ ConfigProvider.vue"></a>├─ ConfigProvider.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; ConfigProviderProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; provideGlobalConfig &#125; from &quot;./hooks&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErConfigProvider&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const props = defineProps&lt;ConfigProviderProps&gt;();</span><br><span class="line">const config = provideGlobalConfig(props);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;slot name=&quot;default&quot; :config=&quot;config&quot;&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-constants-ts-2"><a href="#├─-constants-ts-2" class="headerlink" title="├─ constants.ts"></a>├─ constants.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ConfigProviderProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span>, <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ConfigProviderContext</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">ConfigProviderProps</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">configProviderContextKey</span>: <span class="title class_">InjectionKey</span>&lt;</span><br><span class="line">  <span class="title class_">Ref</span>&lt;<span class="title class_">ConfigProviderContext</span>&gt;</span><br><span class="line">&gt; = <span class="title class_">Symbol</span>()</span><br></pre></td></tr></table></figure><h4 id="├─-hooks-ts"><a href="#├─-hooks-ts" class="headerlink" title="├─ hooks.ts"></a>├─ hooks.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  ref,</span><br><span class="line">  getCurrentInstance,</span><br><span class="line">  inject,</span><br><span class="line">  computed,</span><br><span class="line">  provide,</span><br><span class="line">  unref,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">MaybeRef</span>, <span class="title class_">Ref</span>, <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  configProviderContextKey,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">ConfigProviderContext</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./constants&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createI18n, i18nSymbol &#125; <span class="keyword">from</span> <span class="string">&quot;vue3-i18n&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">TranslatePair</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/locale&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">English</span> <span class="keyword">from</span> <span class="string">&quot;@eric-ui/locale/lang/en&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; merge &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; debugWarn &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> globalConfig = ref&lt;<span class="title class_">ConfigProviderContext</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> useGlobalConfig&lt;</span><br><span class="line">  K <span class="keyword">extends</span> keyof <span class="title class_">ConfigProviderContext</span>,</span><br><span class="line">  D <span class="keyword">extends</span> <span class="title class_">ConfigProviderContext</span>[K],</span><br><span class="line">&gt;(<span class="attr">key</span>: K, <span class="attr">defaultVal</span>?: D): <span class="title class_">Ref</span>&lt;<span class="title class_">Exclude</span>&lt;<span class="title class_">ConfigProviderContext</span>[K], <span class="built_in">void</span>&gt;&gt;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useGlobalConfig</span>(<span class="params"></span>): <span class="title class_">Ref</span>&lt;<span class="title class_">ConfigProviderContext</span>&gt;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useGlobalConfig</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">key</span>?: keyof <span class="title class_">ConfigProviderContext</span>,</span></span><br><span class="line"><span class="params">  defaultVal = <span class="built_in">void</span> <span class="number">0</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> config = <span class="title function_">getCurrentInstance</span>()</span><br><span class="line">    ? <span class="title function_">inject</span>(configProviderContextKey, globalConfig)</span><br><span class="line">    : globalConfig;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> key ? <span class="title function_">computed</span>(<span class="function">() =&gt;</span> config.<span class="property">value</span>?.[key] ?? defaultVal) : config;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_createI18n</span> = (<span class="params"><span class="attr">opts</span>?: <span class="title class_">ConfigProviderContext</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">mergeMsg</span> = (<span class="params"><span class="attr">msg</span>: <span class="title class_">TranslatePair</span></span>) =&gt;</span><br><span class="line">    <span class="title function_">merge</span>(msg, opts?.<span class="property">extendsI18nMsg</span> ?? &#123;&#125;);</span><br><span class="line">  <span class="keyword">if</span> (!opts?.<span class="property">locale</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createI18n</span>(&#123;</span><br><span class="line">      <span class="attr">locale</span>: <span class="string">&quot;en&quot;</span>,</span><br><span class="line">      <span class="attr">messages</span>: <span class="title function_">mergeMsg</span>(&#123;</span><br><span class="line">        <span class="attr">en</span>: <span class="title class_">English</span>.<span class="property">el</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createI18n</span>(&#123;</span><br><span class="line">    <span class="attr">locale</span>: opts.<span class="property">locale</span>?.<span class="property">name</span> || <span class="string">&quot;en&quot;</span>,</span><br><span class="line">    <span class="attr">messages</span>: <span class="title function_">mergeMsg</span>(&#123;</span><br><span class="line">      [opts.<span class="property">locale</span>?.<span class="property">name</span> || <span class="string">&quot;en&quot;</span>]: opts.<span class="property">locale</span>?.<span class="property">el</span> || &#123;&#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">provideGlobalConfig</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">config</span>: <span class="title class_">MaybeRef</span>&lt;<span class="title class_">ConfigProviderContext</span>&gt; = &#123; locale: English &#125;,</span></span><br><span class="line"><span class="params">  <span class="attr">app</span>?: <span class="title class_">App</span>,</span></span><br><span class="line"><span class="params">  <span class="variable language_">global</span> = <span class="literal">false</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">getCurrentInstance</span>();</span><br><span class="line">  <span class="keyword">const</span> oldConfig = instance ? <span class="title function_">useGlobalConfig</span>() : <span class="built_in">void</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> provideFn = app?.<span class="property">provide</span> ?? (instance ? provide : <span class="built_in">void</span> <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!provideFn) &#123;</span><br><span class="line">    <span class="title function_">debugWarn</span>(</span><br><span class="line">      <span class="string">&quot;provideGlobalConfig&quot;</span>,</span><br><span class="line">      <span class="string">&quot;provideGlobalConfig() can only be used inside setup()&quot;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> context = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> cfg = <span class="title function_">unref</span>(config);</span><br><span class="line">    <span class="keyword">if</span> (!oldConfig?.<span class="property">value</span>) <span class="keyword">return</span> cfg;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(oldConfig.<span class="property">value</span>, cfg);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> i18n = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">_createI18n</span>(context.<span class="property">value</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">provideFn</span>(configProviderContextKey, context);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">provideFn</span>(i18nSymbol, i18n.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (app) app.<span class="title function_">use</span>(i18n.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">global</span> || !globalConfig.<span class="property">value</span>) globalConfig.<span class="property">value</span> = context.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="├─-index-ts-4"><a href="#├─-index-ts-4" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ConfigProvider</span> <span class="keyword">from</span> <span class="string">&quot;./ConfigProvider.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;withInstall&#125; <span class="keyword">from</span> <span class="string">&#x27;@eric-ui/utils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErConfigProvider</span> = <span class="title function_">withInstall</span>(<span class="title class_">ConfigProvider</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./hooks&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-3"><a href="#└─-types-ts-3" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Language</span>, <span class="title class_">TranslatePair</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/locale&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ConfigProviderProps</span> &#123;</span><br><span class="line">  <span class="attr">locale</span>?: <span class="title class_">Language</span>;</span><br><span class="line">  <span class="attr">extendsI18nMsg</span>?: <span class="title class_">TranslatePair</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-Dropdown"><a href="#├─-Dropdown" class="headerlink" title="├─ Dropdown"></a>├─ Dropdown</h3><blockquote><p>下拉菜单</p></blockquote><h4 id="–API–-4"><a href="#–API–-4" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-constants-ts-3"><a href="#├─-constants-ts-3" class="headerlink" title="├─ constants.ts"></a>├─ constants.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">DropdownContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">DROPDOWN_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">DropdownContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;dropdownContext&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="├─-Dropdown-test-tsx"><a href="#├─-Dropdown-test-tsx" class="headerlink" title="├─ Dropdown.test.tsx"></a>├─ Dropdown.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, test, expect, vi, beforeEach &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ErDropdown</span>, <span class="title class_">ErDropdownItem</span> &#125; <span class="keyword">from</span> <span class="string">&quot;.&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">DropdownItemProps</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Dropdown</span> <span class="keyword">from</span> <span class="string">&quot;./Dropdown.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">DropdownItem</span> <span class="keyword">from</span> <span class="string">&quot;./DropdownItem.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line">vi.<span class="title function_">mock</span>(<span class="string">&quot;@popperjs/core&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Dropdown/index.ts&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 测试 withInstall 函数是否被正确应用</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should be exported with withInstall()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErDropdown</span>.<span class="property">install</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErDropdownItem</span>.<span class="property">install</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 测试 Dropdown 组件是否被正确导出</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should be exported Dropdown component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErDropdown</span>).<span class="title function_">toBe</span>(<span class="title class_">Dropdown</span>);</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErDropdownItem</span>).<span class="title function_">toBe</span>(<span class="title class_">DropdownItem</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 可选：测试 withInstall 是否增强了 Tooltip 组件的功能</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;should enhance Dropdown component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> enhancedDropdown = <span class="title function_">withInstall</span>(<span class="title class_">Dropdown</span>);</span><br><span class="line">    <span class="title function_">expect</span>(enhancedDropdown).<span class="title function_">toBe</span>(<span class="title class_">ErDropdown</span>);</span><br><span class="line">    <span class="comment">// 这里可以添加更多测试，确保 withInstall 增强了组件的特定功能</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 可选：如果你的 withInstall 函数有特定的行为或属性，确保它们被正确应用</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;should apply specific enhancements&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> enhancedDropdown = <span class="title function_">withInstall</span>(<span class="title class_">Dropdown</span>);</span><br><span class="line">    <span class="comment">// 例如，如果你的 withInstall 增加了一个特定的方法或属性</span></span><br><span class="line">    <span class="title function_">expect</span>(enhancedDropdown).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;install&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Dropdown.vue&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    vi.<span class="title function_">useFakeTimers</span>();</span><br><span class="line">    vi.<span class="title function_">clearAllMocks</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should render slots correctly&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">items</span>: <span class="title class_">DropdownItemProps</span>[] = [</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&quot;Item 1&quot;</span>, <span class="attr">command</span>: <span class="string">&quot;item1&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&quot;Item 2&quot;</span>, <span class="attr">command</span>: <span class="string">&quot;item2&quot;</span> &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Dropdown</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">trigger</span>: <span class="string">&quot;click&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;trigger&quot;</span>&gt;</span>Default slot content<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>,</span><br><span class="line">        <span class="attr">dropdown</span>: <span class="function">() =&gt;</span> items.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">DropdownItem</span> &#123;<span class="attr">...item</span>&#125; /&gt;</span></span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;Default slot content&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-dropdown&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should emit command event when item is clicked&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">items</span>: <span class="title class_">DropdownItemProps</span>[] = [</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&quot;Item 1&quot;</span>, <span class="attr">disabled</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&quot;Item 2&quot;</span>, <span class="attr">command</span>: <span class="string">&quot;item2&quot;</span>, <span class="attr">divided</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">const</span> onCommand = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Dropdown</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">trigger</span>: <span class="string">&quot;click&quot;</span>,</span><br><span class="line">        onCommand,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;trigger&quot;</span>&gt;</span>Default slot content<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>,</span><br><span class="line">        <span class="attr">dropdown</span>: <span class="function">() =&gt;</span> items.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">DropdownItem</span> &#123;<span class="attr">...item</span>&#125; /&gt;</span></span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> triggerArea = wrapper.<span class="title function_">find</span>(<span class="string">&quot;#trigger&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(triggerArea.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-dropdown__menu&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">findAll</span>(<span class="string">&quot;li&quot;</span>).<span class="title function_">at</span>(<span class="number">0</span>)?.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onCommand).<span class="title function_">toBeCalledTimes</span>(<span class="number">0</span>); <span class="comment">// disabled</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">findAll</span>(<span class="string">&quot;li&quot;</span>).<span class="title function_">at</span>(<span class="number">2</span>)?.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onCommand).<span class="title function_">toBeCalled</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onCommand).<span class="title function_">toBeCalledWith</span>(<span class="string">&quot;item2&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should toggle visibility when split btn is clicked&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">items</span>: <span class="title class_">DropdownItemProps</span>[] = [</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&quot;Item 1&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&quot;Item 2&quot;</span>, <span class="attr">command</span>: <span class="string">&quot;item2&quot;</span> &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">const</span> onClick = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Dropdown</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">trigger</span>: <span class="string">&quot;click&quot;</span>,</span><br><span class="line">        <span class="attr">splitButton</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">items</span>: items,</span><br><span class="line">        onClick,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;trigger&quot;</span>&gt;</span>Default slot content<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> triggerArea = wrapper.<span class="title function_">find</span>(<span class="string">&quot;#trigger&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(triggerArea.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-dropdown__menu&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onClick).<span class="title function_">toBeCalled</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="├─-Dropdown-vue"><a href="#├─-Dropdown-vue" class="headerlink" title="├─ Dropdown.vue"></a>├─ Dropdown.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, computed, provide &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; omit, isNil &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import type &#123;</span><br><span class="line">  DropdownProps,</span><br><span class="line">  DropdownEmits,</span><br><span class="line">  DropdownInstance,</span><br><span class="line">  DropdownItemProps,</span><br><span class="line">  DropdownContext,</span><br><span class="line">&#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; useId, useDisabledStyle &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; DROPDOWN_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line">import type &#123; TooltipInstance &#125; from &quot;../Tooltip/types&quot;;</span><br><span class="line"></span><br><span class="line">import &#123; type ButtonInstance, ErButton, ErButtonGroup &#125; from &quot;../Button&quot;;</span><br><span class="line">import DropdownItem from &quot;./DropdownItem.vue&quot;;</span><br><span class="line">import Tooltip from &quot;../Tooltip/Tooltip.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErDropdown&quot;,</span><br><span class="line">  inheritAttrs: false,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;DropdownProps&gt;(), &#123;</span><br><span class="line">  hideOnClick: true,</span><br><span class="line">  items: () =&gt; [] as DropdownItemProps[],</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;DropdownEmits&gt;();</span><br><span class="line">const slots = defineSlots();</span><br><span class="line"></span><br><span class="line">const tooltipRef = ref&lt;TooltipInstance&gt;();</span><br><span class="line">const triggerRef = ref&lt;ButtonInstance&gt;();</span><br><span class="line"></span><br><span class="line">const tooltipProps = computed(() =&gt;</span><br><span class="line">  omit(props, [&quot;items&quot;, &quot;hideAfterClick&quot;, &quot;size&quot;, &quot;type&quot;, &quot;splitButton&quot;])</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">function handleItemClick(e: DropdownItemProps) &#123;</span><br><span class="line">  props.hideOnClick &amp;&amp; tooltipRef.value?.hide();</span><br><span class="line">  !isNil(e.command) &amp;&amp; emits(&quot;command&quot;, e.command);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">!TEST &amp;&amp; useDisabledStyle();</span><br><span class="line">defineExpose&lt;DropdownInstance&gt;(&#123;</span><br><span class="line">  open: () =&gt; tooltipRef.value?.show(),</span><br><span class="line">  close: () =&gt; tooltipRef.value?.hide(),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">provide&lt;DropdownContext&gt;(DROPDOWN_CTX_KEY, &#123;</span><br><span class="line">  handleItemClick,</span><br><span class="line">  size: computed(() =&gt; props.size),</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;er-dropdown&quot;</span><br><span class="line">    :id=&quot;`dropdown-$&#123;useId().value&#125;`&quot;</span><br><span class="line">    :class=&quot;&#123; &#x27;is-disabled&#x27;: props.disabled &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;tooltip</span><br><span class="line">      ref=&quot;tooltipRef&quot;</span><br><span class="line">      v-bind=&quot;tooltipProps&quot;</span><br><span class="line">      :virtual-triggering=&quot;splitButton&quot;</span><br><span class="line">      :virtual-ref=&quot;triggerRef&quot;</span><br><span class="line">      @visible-change=&quot;$emit(&#x27;visible-change&#x27;, $event)&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;er-button-group</span><br><span class="line">        :type=&quot;type&quot;</span><br><span class="line">        :size=&quot;size&quot;</span><br><span class="line">        :disabled=&quot;disabled&quot;</span><br><span class="line">        v-if=&quot;splitButton&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;er-button @click=&quot;$emit(&#x27;click&#x27;, $event)&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;default&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/er-button&gt;</span><br><span class="line">        &lt;er-button ref=&quot;triggerRef&quot; icon=&quot;angle-down&quot; /&gt;</span><br><span class="line">      &lt;/er-button-group&gt;</span><br><span class="line">      &lt;slot v-else name=&quot;default&quot;&gt;&lt;/slot&gt;</span><br><span class="line"></span><br><span class="line">      &lt;template #content&gt;</span><br><span class="line">        &lt;ul class=&quot;er-dropdown__menu&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;dropdown&quot;&gt;</span><br><span class="line">            &lt;template</span><br><span class="line">              v-for=&quot;item in items&quot;</span><br><span class="line">              :key=&quot;item.command ?? useId().value&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;dropdown-item v-bind=&quot;item&quot; /&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/slot&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/tooltip&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line"></span><br><span class="line">:deep(.er-button-group) &#123;</span><br><span class="line">  &amp; &gt; :last-child &#123;</span><br><span class="line">    padding: 5px 7px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-DropdownItem-vue"><a href="#├─-DropdownItem-vue" class="headerlink" title="├─ DropdownItem.vue"></a>├─ DropdownItem.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; type DropdownItemProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; DROPDOWN_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line">import &#123; useId &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; inject, computed &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErDropdownItem&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;DropdownItemProps&gt;(), &#123;</span><br><span class="line">  divided: false,</span><br><span class="line">  disabled: false,</span><br><span class="line">  command: useId().value,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const ctx = inject(DROPDOWN_CTX_KEY);</span><br><span class="line">const size = computed(() =&gt; ctx?.size.value);</span><br><span class="line"></span><br><span class="line">function handleClick() &#123;</span><br><span class="line">  if (props.disabled) return;</span><br><span class="line">  ctx?.handleItemClick(props);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;li v-if=&quot;divided&quot; role=&quot;separator&quot; class=&quot;divided-placeholder&quot;&gt;&lt;/li&gt;</span><br><span class="line">  &lt;li</span><br><span class="line">    :id=&quot;`dropdown-item-$&#123;command ?? useId().value&#125;`&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      &#x27;er-dropdown__item&#x27;: true,</span><br><span class="line">      [&#x27;er-dropdown__item--&#x27; + size]: size,</span><br><span class="line">      &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">      &#x27;is-divided&#x27;: divided,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">    @click=&quot;handleClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;slot&gt;</span><br><span class="line">      &#123;&#123; label &#125;&#125;</span><br><span class="line">    &lt;/slot&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-index-ts-5"><a href="#├─-index-ts-5" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Dropdown</span> <span class="keyword">from</span> <span class="string">&quot;./Dropdown.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">DropdownItem</span> <span class="keyword">from</span> <span class="string">&quot;./DropdownItem.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErDropdown</span> = <span class="title function_">withInstall</span>(<span class="title class_">Dropdown</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErDropdownItem</span> = <span class="title function_">withInstall</span>(<span class="title class_">DropdownItem</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-3"><a href="#├─-style-css-3" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-dropdown</span> <span class="selector-class">.er-dropdown__menu</span> &#123;</span><br><span class="line">  <span class="attr">--er-dropdown-menuItem-hover-fill</span>: <span class="built_in">var</span>(--er-color-primary-light-<span class="number">9</span>);</span><br><span class="line">  <span class="attr">--er-dropdown-menuItem-hover-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">  <span class="attr">--er-dropdown-menuItem-disabled-color</span>: <span class="built_in">var</span>(--er-border-color-lighter);</span><br><span class="line">  <span class="attr">--er-dropdown-menuItem-divided-color</span>: <span class="built_in">var</span>(--er-border-color-lighter);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-dropdown</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="selector-class">.er-tooltip</span> &#123;</span><br><span class="line">    <span class="attr">--er-popover-padding</span>: <span class="number">5px</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-disabled</span>&gt;*&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-text-color-placeholder) <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: not-allowed <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-dropdown__menu</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-type</span>: none;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="selector-class">.er-dropdown__item</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">22px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">outline</span>: none;</span><br><span class="line">    &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-dropdown-menuItem-hover-fill);</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-dropdown-menuItem-hover-color);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.is-disabled</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-dropdown-menuItem-disabled-color);</span><br><span class="line">      <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">      <span class="attribute">background-image</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.er-dropdown__item--large</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">7px</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">22px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-dropdown__item--small</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">2px</span> <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.divided-placeholder</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">6px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-dropdown-menuItem-divided-color);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-4"><a href="#└─-types-ts-4" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">VNode</span>, <span class="title class_">ComputedRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">TooltipProps</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../Tooltip/types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ButtonType</span>, <span class="title class_">ButtonSize</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../Button/types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">DropdownCommand</span> = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownItemProps</span> &#123;</span><br><span class="line">  <span class="attr">command</span>?: <span class="title class_">DropdownCommand</span>;</span><br><span class="line">  <span class="attr">label</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">divided</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownProps</span> <span class="keyword">extends</span> <span class="title class_">TooltipProps</span> &#123;</span><br><span class="line">  <span class="attr">type</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">  <span class="attr">size</span>?: <span class="title class_">ButtonSize</span>;</span><br><span class="line">  <span class="attr">items</span>?: <span class="title class_">DropdownItemProps</span>[];</span><br><span class="line">  <span class="attr">hideOnClick</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">splitButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;visible-change&quot;</span>, <span class="attr">value</span>: <span class="built_in">boolean</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;command&quot;</span>, <span class="attr">value</span>: <span class="title class_">DropdownCommand</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;click&quot;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownInstance</span> &#123;</span><br><span class="line">  <span class="title function_">open</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">close</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownContext</span> &#123;</span><br><span class="line">  <span class="title function_">handleItemClick</span>(<span class="attr">item</span>: <span class="title class_">DropdownItemProps</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="attr">size</span>: <span class="title class_">ComputedRef</span>&lt;<span class="title class_">ButtonSize</span> | <span class="built_in">void</span>&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-Form"><a href="#├─-Form" class="headerlink" title="├─ Form"></a>├─ Form</h3><blockquote><p>表单，用于收集用户输入</p></blockquote><h4 id="–API–-5"><a href="#–API–-5" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-constants-ts-4"><a href="#├─-constants-ts-4" class="headerlink" title="├─ constants.ts"></a>├─ constants.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">FormContext</span>, <span class="title class_">FormItemContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">FORM_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">FormContext</span>&gt; = <span class="title class_">Symbol</span>(<span class="string">&quot;formContext&quot;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">FORM_ITEM_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">FormItemContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;formItemContext&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="├─-Form-vue"><a href="#├─-Form-vue" class="headerlink" title="├─ Form.vue"></a>├─ Form.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; provide, reactive, toRefs &#125; from &quot;vue&quot;;</span><br><span class="line">import type &#123;</span><br><span class="line">  FormProps,</span><br><span class="line">  FormEmits,</span><br><span class="line">  FormItemContext,</span><br><span class="line">  FormContext,</span><br><span class="line">  FormInstance,</span><br><span class="line">  FormValidateCallback,</span><br><span class="line">&#125; from &quot;./types&quot;;</span><br><span class="line">import type &#123; ValidateFieldsError &#125; from &quot;async-validator&quot;;</span><br><span class="line">import &#123; FORM_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line">import &#123; each, filter, includes, size &#125; from &quot;lodash-es&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123; name: &quot;ErForm&quot; &#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;FormProps&gt;(), &#123;</span><br><span class="line">  showMessage: true,</span><br><span class="line">  hideRequiredAsterisk: false,</span><br><span class="line">  requiredAsteriskPosition: &quot;left&quot;,</span><br><span class="line">  labelPosition: &quot;right&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;FormEmits&gt;();</span><br><span class="line">const fields: FormItemContext[] = [];</span><br><span class="line"></span><br><span class="line">const addField: FormContext[&quot;addField&quot;] = function (field) &#123;</span><br><span class="line">  if (!field.prop) return;</span><br><span class="line">  fields.push(field);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const removeField: FormContext[&quot;removeField&quot;] = function (field) &#123;</span><br><span class="line">  if (!field.prop) return;</span><br><span class="line">  fields.splice(fields.indexOf(field), 1);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const validate: FormInstance[&quot;validate&quot;] = async function (</span><br><span class="line">  callback?: FormValidateCallback</span><br><span class="line">) &#123;</span><br><span class="line">  return validateField([], callback);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const validateField: FormInstance[&quot;validateField&quot;] = async function (</span><br><span class="line">  keys: string[] = [],</span><br><span class="line">  callback?: FormValidateCallback</span><br><span class="line">) &#123;</span><br><span class="line">  const filterArr = size(keys)</span><br><span class="line">    ? filter(fields, (field) =&gt; includes(keys, field.prop))</span><br><span class="line">    : fields;</span><br><span class="line"></span><br><span class="line">  try &#123;</span><br><span class="line">    const result = await doValidateField(filterArr);</span><br><span class="line">    if (result === true) &#123;</span><br><span class="line">      callback?.(result);</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    if (e instanceof Error) throw e;</span><br><span class="line">    const invalidFields = e as ValidateFieldsError;</span><br><span class="line"></span><br><span class="line">    callback?.(false, invalidFields);</span><br><span class="line">    return Promise.reject(invalidFields);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const resetFields: FormInstance[&quot;resetFields&quot;] = function (</span><br><span class="line">  keys: string[] = []</span><br><span class="line">) &#123;</span><br><span class="line">  each(filterFields(fields, keys), (field) =&gt; field.resetField());</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const clearValidate: FormInstance[&quot;clearValidate&quot;] = function (</span><br><span class="line">  keys: string[] = []</span><br><span class="line">) &#123;</span><br><span class="line">  each(filterFields(fields, keys), (field) =&gt; field.clearValidate());</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function filterFields(fields: FormItemContext[], props: string[]) &#123;</span><br><span class="line">  return size(props)</span><br><span class="line">    ? filter(fields, (field) =&gt; includes(props, field.prop))</span><br><span class="line">    : fields;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function doValidateField(fields: FormItemContext[] = []) &#123;</span><br><span class="line">  let validationErrors: ValidateFieldsError = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  for (const field of fields) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      await field.validate(&quot;&quot;);</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">      validationErrors = &#123;</span><br><span class="line">        ...validationErrors,</span><br><span class="line">        ...(e as ValidateFieldsError),</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  if (!size(Object.keys(validationErrors))) return true;</span><br><span class="line">  return Promise.reject(validationErrors);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const formCtx: FormContext = reactive(&#123;</span><br><span class="line">  ...toRefs(props),</span><br><span class="line">  emits,</span><br><span class="line">  addField,</span><br><span class="line">  removeField,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">provide&lt;FormContext&gt;(FORM_CTX_KEY, formCtx);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;FormInstance&gt;(&#123;</span><br><span class="line">  validate,</span><br><span class="line">  validateField,</span><br><span class="line">  resetFields,</span><br><span class="line">  clearValidate,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form class=&quot;er-form&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-FormItem-vue"><a href="#├─-FormItem-vue" class="headerlink" title="├─ FormItem.vue"></a>├─ FormItem.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;</span><br><span class="line">  type Ref,</span><br><span class="line">  computed,</span><br><span class="line">  provide,</span><br><span class="line">  inject,</span><br><span class="line">  onMounted,</span><br><span class="line">  onUnmounted,</span><br><span class="line">  ref,</span><br><span class="line">  nextTick,</span><br><span class="line">  watch,</span><br><span class="line">  reactive,</span><br><span class="line">  watchEffect,</span><br><span class="line">  toRefs,</span><br><span class="line">  useSlots,</span><br><span class="line">&#125; from &quot;vue&quot;;</span><br><span class="line">import Schema, &#123; type RuleItem &#125; from &quot;async-validator&quot;;</span><br><span class="line">import type &#123;</span><br><span class="line">  FormItemContext,</span><br><span class="line">  FormItemProps,</span><br><span class="line">  FormValidateFailuer,</span><br><span class="line">  FormValidateCallback,</span><br><span class="line">  ValidateStatus,</span><br><span class="line">  FormItemInstance,</span><br><span class="line">  FormItemRule,</span><br><span class="line">&#125; from &quot;./types&quot;;</span><br><span class="line">import &#123;</span><br><span class="line">  isNil,</span><br><span class="line">  get,</span><br><span class="line">  size,</span><br><span class="line">  filter,</span><br><span class="line">  some,</span><br><span class="line">  isString,</span><br><span class="line">  isNumber,</span><br><span class="line">  endsWith,</span><br><span class="line">  keys,</span><br><span class="line">  includes,</span><br><span class="line">  map,</span><br><span class="line">  cloneDeep,</span><br><span class="line">  isArray,</span><br><span class="line">&#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123; useId &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; FORM_CTX_KEY, FORM_ITEM_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123; name: &quot;ErFormItem&quot; &#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;FormItemProps&gt;(), &#123;</span><br><span class="line">  showMessage: true,</span><br><span class="line">  required: void 0,</span><br><span class="line">&#125;);</span><br><span class="line">const slots = useSlots();</span><br><span class="line">const ctx = inject(FORM_CTX_KEY);</span><br><span class="line"></span><br><span class="line">const labelId = useId().value;</span><br><span class="line"></span><br><span class="line">const validateStatus: Ref&lt;ValidateStatus&gt; = ref(&quot;init&quot;);</span><br><span class="line">const errMsg = ref(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">const inputIds = ref&lt;string[]&gt;([]);</span><br><span class="line"></span><br><span class="line">const getValByProp = (target: Record&lt;string, any&gt; | void) =&gt; &#123;</span><br><span class="line">  if (target &amp;&amp; props.prop &amp;&amp; !isNil(get(target, props.prop))) &#123;</span><br><span class="line">    return get(target, props.prop);</span><br><span class="line">  &#125;</span><br><span class="line">  return null;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const hasLabel = computed(() =&gt; !!(props.label || slots.label));</span><br><span class="line">const labelFor = computed(</span><br><span class="line">  () =&gt; props.for || (inputIds.value.length ? inputIds.value[0] : &quot;&quot;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const currentLabel = computed(</span><br><span class="line">  () =&gt; `$&#123;props.label ?? &quot;&quot;&#125;$&#123;ctx?.labelSuffix ?? &quot;&quot;&#125;`</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const innerVal = computed(() =&gt; &#123;</span><br><span class="line">  const model = ctx?.model;</span><br><span class="line">  return getValByProp(model);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const itemRules = computed(() =&gt; &#123;</span><br><span class="line">  const &#123; required &#125; = props;</span><br><span class="line"></span><br><span class="line">  const rules: FormItemRule[] = [];</span><br><span class="line">  if (props.rules) &#123;</span><br><span class="line">    rules.push(...props.rules);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const formRules = ctx?.rules;</span><br><span class="line">  if (formRules &amp;&amp; props.prop) &#123;</span><br><span class="line">    const _rules = getValByProp(formRules);</span><br><span class="line">    if (_rules) &#123;</span><br><span class="line">      rules.push(..._rules);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (!isNil(required)) &#123;</span><br><span class="line">    const requiredRules = filter(</span><br><span class="line">      map(rules, (rule, i) =&gt; [rule, i]),</span><br><span class="line">      (item: [FormItemRule, number]) =&gt; includes(keys(item[0]), &quot;required&quot;)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    if (size(requiredRules)) &#123;</span><br><span class="line">      for (const item of requiredRules) &#123;</span><br><span class="line">        const [rule, i] = item as [FormItemRule, number];</span><br><span class="line">        if (rule.required === required) continue;</span><br><span class="line">        rules[i] = &#123; ...rule, required &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      rules.push(&#123; required &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return rules;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const validateEnabled = computed(() =&gt; size(itemRules.value) &gt; 0);</span><br><span class="line">const isRequired = computed(</span><br><span class="line">  () =&gt;</span><br><span class="line">    !ctx?.hideRequiredAsterisk &amp;&amp;</span><br><span class="line">    (some(itemRules.value, &quot;required&quot;) || props?.required)</span><br><span class="line">);</span><br><span class="line">const isDisabled = computed(() =&gt; ctx?.disabled || props?.disabled);</span><br><span class="line">const propString = computed(() =&gt; &#123;</span><br><span class="line">  if (!props.prop) return &quot;&quot;;</span><br><span class="line">  return isString(props.prop) ? props.prop : props.prop.join(&quot;.&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const normalizeLabelWidth = computed(() =&gt; &#123;</span><br><span class="line">  const _normalizeStyle = (val: number | string) =&gt; &#123;</span><br><span class="line">    if (isNumber(val)) return `$&#123;val&#125;px`;</span><br><span class="line">    return endsWith(val, &quot;px&quot;) ? val : `$&#123;val&#125;px`;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  if (props.labelWidth) return _normalizeStyle(props.labelWidth);</span><br><span class="line">  if (ctx?.labelWidth) return _normalizeStyle(ctx.labelWidth);</span><br><span class="line">  return &quot;150px&quot;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">let initialVal: any = null;</span><br><span class="line">let isResetting = false;</span><br><span class="line"></span><br><span class="line">function getTriggeredRules(trigger?: string) &#123;</span><br><span class="line">  const rules = itemRules.value;</span><br><span class="line">  if (rules) &#123;</span><br><span class="line">    return filter(rules, (r) =&gt; &#123;</span><br><span class="line">      if (!r.trigger || !trigger) return true;</span><br><span class="line">      if (isArray(r.trigger)) &#123;</span><br><span class="line">        return r.trigger.includes(trigger);</span><br><span class="line">      &#125;</span><br><span class="line">      return r.trigger === trigger;</span><br><span class="line">    &#125;).map((&#123; trigger, ...rule &#125;) =&gt; rule as RuleItem);</span><br><span class="line">  &#125;</span><br><span class="line">  return [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function doValidate(rules: any[]) &#123;</span><br><span class="line">  const modelName = propString.value;</span><br><span class="line">  const validator = new Schema(&#123; [modelName]: rules &#125;);</span><br><span class="line">  return validator</span><br><span class="line">    .validate(&#123; [modelName]: innerVal.value &#125;, &#123; firstFields: true &#125;)</span><br><span class="line">    .then(() =&gt; &#123;</span><br><span class="line">      validateStatus.value = &quot;success&quot;;</span><br><span class="line">      ctx?.emits(&quot;validate&quot;, props, true, &quot;&quot;);</span><br><span class="line">      return true;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch((err: FormValidateFailuer) =&gt; &#123;</span><br><span class="line">      const &#123; errors &#125; = err;</span><br><span class="line">      validateStatus.value = &quot;error&quot;;</span><br><span class="line">      errMsg.value = errors &amp;&amp; size(errors) &gt; 0 ? errors[0].message ?? &quot;&quot; : &quot;&quot;;</span><br><span class="line">      ctx?.emits(&quot;validate&quot;, props, false, errMsg.value);</span><br><span class="line">      return Promise.reject(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const validate: FormItemInstance[&quot;validate&quot;] = async function (</span><br><span class="line">  trigger: string,</span><br><span class="line">  callback?: FormValidateCallback</span><br><span class="line">) &#123;</span><br><span class="line">  if (isResetting || !props.prop || isDisabled.value) return false;</span><br><span class="line"></span><br><span class="line">  if (!validateEnabled.value) &#123;</span><br><span class="line">    callback?.(false);</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const rules = getTriggeredRules(trigger);</span><br><span class="line">  if (!size(rules)) &#123;</span><br><span class="line">    callback?.(true);</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  validateStatus.value = &quot;validating&quot;;</span><br><span class="line"></span><br><span class="line">  return doValidate(rules)</span><br><span class="line">    .then(() =&gt; &#123;</span><br><span class="line">      callback?.(true);</span><br><span class="line">      return true;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch((err: FormValidateFailuer) =&gt; &#123;</span><br><span class="line">      const &#123; fields &#125; = err;</span><br><span class="line">      callback?.(false, fields);</span><br><span class="line">      return Promise.reject(fields);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">const resetField: FormItemInstance[&quot;resetField&quot;] = function () &#123;</span><br><span class="line">  const model = ctx?.model;</span><br><span class="line">  if (model &amp;&amp; propString.value &amp;&amp; !isNil(get(model, propString.value))) &#123;</span><br><span class="line">    isResetting = true;</span><br><span class="line">    model[propString.value] = cloneDeep(initialVal);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  nextTick(() =&gt; clearValidate());</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const clearValidate: FormItemInstance[&quot;clearValidate&quot;] = function () &#123;</span><br><span class="line">  validateStatus.value = &quot;init&quot;;</span><br><span class="line">  errMsg.value = &quot;&quot;;</span><br><span class="line">  isResetting = false;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const addInputId: FormItemContext[&quot;addInputId&quot;] = function (id) &#123;</span><br><span class="line">  if (!includes(inputIds.value, id)) inputIds.value.push(id);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const removeInputId: FormItemContext[&quot;removeInputId&quot;] = function (id) &#123;</span><br><span class="line">  inputIds.value = filter(inputIds.value, (i) =&gt; i != id);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const formItemCtx: FormItemContext = reactive(&#123;</span><br><span class="line">  ...toRefs(props),</span><br><span class="line">  disabled: isDisabled.value,</span><br><span class="line">  validate,</span><br><span class="line">  resetField,</span><br><span class="line">  clearValidate,</span><br><span class="line">  addInputId,</span><br><span class="line">  removeInputId,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  if (props.prop) &#123;</span><br><span class="line">    ctx?.addField(formItemCtx);</span><br><span class="line">    initialVal = innerVal.value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">onUnmounted(() =&gt; &#123;</span><br><span class="line">  if (props.prop) &#123;</span><br><span class="line">    ctx?.removeField(formItemCtx);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">watchEffect(() =&gt; (formItemCtx.disabled = isDisabled.value));</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.error,</span><br><span class="line">  (val) =&gt; &#123;</span><br><span class="line">    errMsg.value = val || &quot;&quot;;</span><br><span class="line">    validateStatus.value = val ? &quot;error&quot; : &quot;init&quot;;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; immediate: true &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">provide&lt;FormItemContext&gt;(FORM_ITEM_CTX_KEY, formItemCtx);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;FormItemInstance&gt;(&#123;</span><br><span class="line">  validateMessage: errMsg,</span><br><span class="line">  validateStatus,</span><br><span class="line">  validate,</span><br><span class="line">  resetField,</span><br><span class="line">  clearValidate,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;er-form-item&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      &#x27;is-error&#x27;: validateStatus === &#x27;error&#x27;,</span><br><span class="line">      &#x27;is-disabled&#x27;: isDisabled,</span><br><span class="line">      &#x27;is-required&#x27;: isRequired,</span><br><span class="line">      &#x27;asterisk-left&#x27;: ctx?.requiredAsteriskPosition === &#x27;left&#x27;,</span><br><span class="line">      &#x27;asterisk-right&#x27;: ctx?.requiredAsteriskPosition === &#x27;right&#x27;,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;component</span><br><span class="line">      v-if=&quot;hasLabel&quot;</span><br><span class="line">      class=&quot;er-form-item__label&quot;</span><br><span class="line">      :class=&quot;`position-$&#123;ctx?.labelPosition ?? &#x27;right&#x27;&#125;`&quot;</span><br><span class="line">      :is=&quot;labelFor ? &#x27;label&#x27; : &#x27;div&#x27;&quot;</span><br><span class="line">      :id=&quot;labelId&quot;</span><br><span class="line">      :for=&quot;labelFor&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;slot name=&quot;label&quot; :label=&quot;currentLabel&quot;&gt;</span><br><span class="line">        &#123;&#123; currentLabel &#125;&#125;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/component&gt;</span><br><span class="line">    &lt;div class=&quot;er-form-item__content&quot;&gt;</span><br><span class="line">      &lt;slot :validate=&quot;validate&quot;&gt;&lt;/slot&gt;</span><br><span class="line">      &lt;div class=&quot;er-form-item__error-msg&quot; v-if=&quot;validateStatus === &#x27;error&#x27;&quot;&gt;</span><br><span class="line">        &lt;template v-if=&quot;ctx?.showMessage &amp;&amp; showMessage&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;error&quot; :error=&quot;errMsg&quot;&gt;&#123;&#123; errMsg &#125;&#125;&lt;/slot&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line"></span><br><span class="line">.er-form-item &#123;</span><br><span class="line">  --er-form-label-width: v-bind(normalizeLabelWidth) !important;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-hooks-ts-1"><a href="#├─-hooks-ts-1" class="headerlink" title="├─ hooks.ts"></a>├─ hooks.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  computed,</span><br><span class="line">  inject,</span><br><span class="line">  unref,</span><br><span class="line">  ref,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">MaybeRef</span>,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">WatchStopHandle</span>,</span><br><span class="line">  onMounted,</span><br><span class="line">  watch,</span><br><span class="line">  toRef,</span><br><span class="line">  onUnmounted,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">FormItemContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FORM_CTX_KEY</span>, <span class="variable constant_">FORM_ITEM_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constants&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useProp, useId &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/hooks&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useFormItem</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> form = <span class="title function_">inject</span>(<span class="variable constant_">FORM_CTX_KEY</span>, <span class="built_in">void</span> <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> formItem = <span class="title function_">inject</span>(<span class="variable constant_">FORM_ITEM_CTX_KEY</span>, <span class="built_in">void</span> <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> &#123; form, formItem &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useFormDisabled</span>(<span class="params"><span class="attr">fallback</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">boolean</span> | <span class="built_in">void</span>&gt;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> disabled = useProp&lt;<span class="built_in">boolean</span>&gt;(<span class="string">&quot;disabled&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> form = <span class="title function_">inject</span>(<span class="variable constant_">FORM_CTX_KEY</span>, <span class="built_in">void</span> <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> formItem = <span class="title function_">inject</span>(<span class="variable constant_">FORM_ITEM_CTX_KEY</span>, <span class="built_in">void</span> <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">computed</span>(</span><br><span class="line">    <span class="function">() =&gt;</span></span><br><span class="line">      disabled.<span class="property">value</span> ||</span><br><span class="line">      <span class="title function_">unref</span>(fallback) ||</span><br><span class="line">      form?.<span class="property">disabled</span> ||</span><br><span class="line">      formItem?.<span class="property">disabled</span> ||</span><br><span class="line">      <span class="literal">false</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UseFormItemInputCommonProps</span> <span class="keyword">extends</span> <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="attr">id</span>?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useFormItemInputId</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">props</span>: <span class="title class_">UseFormItemInputCommonProps</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">formItemContext</span>?: <span class="title class_">FormItemContext</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputId = ref&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">unwatch</span>: <span class="title class_">WatchStopHandle</span> | <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    unwatch = <span class="title function_">watch</span>(</span><br><span class="line">      <span class="title function_">toRef</span>(<span class="function">() =&gt;</span> props.<span class="property">id</span>),</span><br><span class="line">      <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> newId = id ?? <span class="title function_">useId</span>().<span class="property">value</span>;</span><br><span class="line">        <span class="keyword">if</span> (newId !== inputId.<span class="property">value</span>) &#123;</span><br><span class="line">          inputId.<span class="property">value</span> &amp;&amp; formItemContext?.<span class="title function_">removeInputId</span>(inputId.<span class="property">value</span>);</span><br><span class="line">          formItemContext?.<span class="title function_">addInputId</span>(newId);</span><br><span class="line">          inputId.<span class="property">value</span> = newId;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">immediate</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    unwatch &amp;&amp; <span class="title function_">unwatch</span>();</span><br><span class="line">    inputId.<span class="property">value</span> &amp;&amp; formItemContext?.<span class="title function_">removeInputId</span>(inputId.<span class="property">value</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    inputId,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="├─-index-ts-6"><a href="#├─-index-ts-6" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Form</span> <span class="keyword">from</span> <span class="string">&quot;./Form.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">FormItem</span> <span class="keyword">from</span> <span class="string">&quot;./FormItem.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErForm</span> = <span class="title function_">withInstall</span>(<span class="title class_">Form</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErFormItem</span> = <span class="title function_">withInstall</span>(<span class="title class_">FormItem</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./hooks&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-4"><a href="#├─-style-css-4" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-form-item</span> &#123;</span><br><span class="line">  <span class="attr">--er-form-label-width</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attr">--er-form-label-font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">  <span class="attr">--er-form-content-font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-form-item</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">18px</span>;</span><br><span class="line">  &amp;<span class="selector-pseudo">:has</span>(&gt; <span class="selector-class">.position-top</span>)&#123;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-form-item__label</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">32px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">var</span>(--er-form-label-width);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">display</span>: inline-flex;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-form-label-font-size);    </span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">    &amp;<span class="selector-class">.position-right</span> &#123;</span><br><span class="line">      <span class="attribute">padding-left</span>: <span class="number">12px</span>;</span><br><span class="line">      <span class="attribute">justify-content</span>: flex-end;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.position-left</span> &#123;</span><br><span class="line">      <span class="attribute">padding-right</span>: <span class="number">12px</span>;</span><br><span class="line">      <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.position-top</span> &#123;</span><br><span class="line">      <span class="attribute">padding-bottom</span>: <span class="number">12px</span>;</span><br><span class="line">      <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-form-item__content</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">32px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-form-content-font-size);</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-form-item__error-msg</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.is-error</span> &#123;</span><br><span class="line">    :<span class="built_in">deep</span>(.er-input__wrapper)&#123;</span><br><span class="line">      <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-color-danger) inset;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.is-required</span><span class="selector-class">.asterisk-right</span> &gt; <span class="selector-class">.er-form-item__label</span><span class="selector-pseudo">::after</span>&#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">4px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.is-required</span><span class="selector-class">.asterisk-left</span> &gt; <span class="selector-class">.er-form-item__label</span><span class="selector-pseudo">::before</span>&#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">4px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.is-disabled</span> &gt; <span class="selector-class">.er-form-item__label</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">    <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    &amp;<span class="selector-pseudo">::before</span>,&amp;<span class="selector-pseudo">::after</span>&#123;</span><br><span class="line">      <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.is-disabled</span> &gt; <span class="selector-class">.er-form-item__content</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">    <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-5"><a href="#└─-types-ts-5" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;</span><br><span class="line">  <span class="title class_">RuleItem</span>,</span><br><span class="line">  <span class="title class_">ValidateError</span>,</span><br><span class="line">  <span class="title class_">ValidateFieldsError</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;async-validator&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormItemRule</span> <span class="keyword">extends</span> <span class="title class_">RuleItem</span> &#123;</span><br><span class="line">  <span class="attr">trigger</span>?: <span class="built_in">string</span> | <span class="built_in">string</span>[];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">FormRules</span> = <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">FormItemRule</span>[]&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">FormValidateResult</span> = <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">FormValidateCallback</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">isValid</span>: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">invalidFields</span>?: <span class="title class_">ValidateFieldsError</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ValidateStatus</span> = <span class="string">&quot;success&quot;</span> | <span class="string">&quot;error&quot;</span> | <span class="string">&quot;init&quot;</span> | <span class="string">&quot;validating&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormValidateFailuer</span> &#123;</span><br><span class="line">  <span class="attr">errors</span>?: <span class="title class_">ValidateError</span>[];</span><br><span class="line">  <span class="attr">fields</span>: <span class="title class_">ValidateFieldsError</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormProps</span> &#123;</span><br><span class="line">  <span class="attr">model</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;;</span><br><span class="line">  <span class="attr">rules</span>?: <span class="title class_">FormRules</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">labelWidth</span>?: <span class="built_in">number</span> | <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">labelPosition</span>?: <span class="string">&quot;left&quot;</span> | <span class="string">&quot;right&quot;</span> | <span class="string">&quot;top&quot;</span>;</span><br><span class="line">  <span class="attr">labelSuffix</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">showMessage</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">hideRequiredAsterisk</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">requiredAsteriskPosition</span>?: <span class="string">&quot;left&quot;</span> | <span class="string">&quot;right&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormEmits</span> &#123;</span><br><span class="line">  (</span><br><span class="line">    <span class="attr">event</span>: <span class="string">&quot;validate&quot;</span>,</span><br><span class="line">    <span class="attr">prop</span>: <span class="title class_">FormItemProps</span>,</span><br><span class="line">    <span class="attr">isValid</span>: <span class="built_in">boolean</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="built_in">string</span></span><br><span class="line">  ): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormItemProps</span> &#123;</span><br><span class="line">  <span class="attr">prop</span>?: <span class="built_in">string</span> | <span class="built_in">string</span>[];</span><br><span class="line">  <span class="attr">label</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">for</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">labelWidth</span>?: <span class="built_in">number</span> | <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">required</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">showMessage</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">error</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">rules</span>?: <span class="title class_">FormItemRule</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormInstance</span> &#123;</span><br><span class="line">  <span class="title function_">validate</span>(<span class="attr">callback</span>?: <span class="title class_">FormValidateCallback</span>): <span class="title class_">FormValidateResult</span>;</span><br><span class="line">  <span class="title function_">validateField</span>(</span><br><span class="line">    <span class="attr">keys</span>?: <span class="built_in">string</span>[],</span><br><span class="line">    <span class="attr">callback</span>?: <span class="title class_">FormValidateCallback</span></span><br><span class="line">  ): <span class="title class_">FormValidateResult</span>;</span><br><span class="line">  <span class="title function_">resetFields</span>(<span class="attr">keys</span>?: <span class="built_in">string</span>[]): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">clearValidate</span>(<span class="attr">keys</span>?: <span class="built_in">string</span>[]): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormItemInstance</span> &#123;</span><br><span class="line">  <span class="attr">validateStatus</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">ValidateStatus</span>&gt;;</span><br><span class="line">  <span class="attr">validateMessage</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">  <span class="title function_">validate</span>(</span><br><span class="line">    <span class="attr">trigger</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">callback</span>?: <span class="title class_">FormValidateCallback</span></span><br><span class="line">  ): <span class="title class_">FormValidateResult</span>;</span><br><span class="line">  <span class="title function_">resetField</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">clearValidate</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormContext</span> <span class="keyword">extends</span> <span class="title class_">FormProps</span> &#123;</span><br><span class="line">  <span class="attr">emits</span>: <span class="title class_">FormEmits</span>;</span><br><span class="line">  <span class="title function_">addField</span>(<span class="attr">field</span>: <span class="title class_">FormItemContext</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">removeField</span>(<span class="attr">field</span>: <span class="title class_">FormItemContext</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FormItemContext</span> <span class="keyword">extends</span> <span class="title class_">FormItemProps</span> &#123;</span><br><span class="line">  <span class="title function_">validate</span>(</span><br><span class="line">    <span class="attr">trigger</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">callback</span>?: <span class="title class_">FormValidateCallback</span></span><br><span class="line">  ): <span class="title class_">FormValidateResult</span>;</span><br><span class="line">  <span class="title function_">resetField</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">clearValidate</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">addInputId</span>(<span class="attr">id</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">removeInputId</span>(<span class="attr">id</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-Icon"><a href="#├─-Icon" class="headerlink" title="├─ Icon"></a>├─ Icon</h3><blockquote><p>图标组件</p></blockquote><h4 id="├─-Icon-vue"><a href="#├─-Icon-vue" class="headerlink" title="├─ Icon.vue"></a>├─ Icon.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; type IconProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; FontAwesomeIcon &#125; from &quot;@fortawesome/vue-fontawesome&quot;;</span><br><span class="line">import &#123; omit &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123; computed &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErIcon&quot;,</span><br><span class="line">  inheritAttrs: false,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const props = defineProps&lt;IconProps&gt;();</span><br><span class="line"></span><br><span class="line">const filterProps = computed(() =&gt; omit(props, [&quot;type&quot;, &quot;color&quot;]));</span><br><span class="line">const customStyles = computed(() =&gt; (&#123; color: props.color ?? void 0 &#125;));</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;i</span><br><span class="line">    class=&quot;er-icon&quot;</span><br><span class="line">    :class=&quot;&#123; [`er-icon--$&#123;type&#125;`]: type &#125;&quot;</span><br><span class="line">    :style=&quot;customStyles&quot;</span><br><span class="line">    v-bind=&quot;$attrs&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;font-awesome-icon v-bind=&quot;filterProps&quot; /&gt;</span><br><span class="line">  &lt;/i&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-index-ts-7"><a href="#├─-index-ts-7" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Icon</span> <span class="keyword">from</span> <span class="string">&quot;./Icon.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErIcon</span> = <span class="title function_">withInstall</span>(<span class="title class_">Icon</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-5"><a href="#├─-style-css-5" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-icon</span> &#123;</span><br><span class="line">  <span class="attr">--er-icon-color</span>: inherit;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">fill</span>: currentColor;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--er-icon-color);</span><br><span class="line">  <span class="attribute">font-size</span>: inherit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@each</span> $val in primary, info, success, warning, danger &#123;</span><br><span class="line">  <span class="selector-class">.er-icon--</span>$(val) &#123;</span><br><span class="line">    <span class="attr">--er-icon-color</span>: <span class="built_in">var</span>(--er-color-$(val));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-6"><a href="#└─-types-ts-6" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">IconDefinition</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/fontawesome-svg-core&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IconProps</span> &#123;</span><br><span class="line">  <span class="attr">border</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">fixedWidth</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">flip</span>?: <span class="string">&quot;horizontal&quot;</span> | <span class="string">&quot;vertical&quot;</span> | <span class="string">&quot;both&quot;</span>;</span><br><span class="line">  <span class="attr">icon</span>: <span class="built_in">object</span> | <span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt; | <span class="built_in">string</span> | <span class="title class_">IconDefinition</span>;</span><br><span class="line">  <span class="attr">mask</span>?: <span class="built_in">object</span> | <span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt; | <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">listItem</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">pull</span>?: <span class="string">&quot;right&quot;</span> | <span class="string">&quot;left&quot;</span>;</span><br><span class="line">  <span class="attr">pulse</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">rotation</span>?: <span class="number">90</span> | <span class="number">180</span> | <span class="number">270</span> | <span class="string">&quot;90&quot;</span> | <span class="string">&quot;180&quot;</span> | <span class="string">&quot;270&quot;</span>;</span><br><span class="line">  <span class="attr">swapOpacity</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">size</span>?:</span><br><span class="line">    | <span class="string">&quot;2xs&quot;</span></span><br><span class="line">    | <span class="string">&quot;xs&quot;</span></span><br><span class="line">    | <span class="string">&quot;sm&quot;</span></span><br><span class="line">    | <span class="string">&quot;lg&quot;</span></span><br><span class="line">    | <span class="string">&quot;xl&quot;</span></span><br><span class="line">    | <span class="string">&quot;2xl&quot;</span></span><br><span class="line">    | <span class="string">&quot;1x&quot;</span></span><br><span class="line">    | <span class="string">&quot;2x&quot;</span></span><br><span class="line">    | <span class="string">&quot;3x&quot;</span></span><br><span class="line">    | <span class="string">&quot;4x&quot;</span></span><br><span class="line">    | <span class="string">&quot;5x&quot;</span></span><br><span class="line">    | <span class="string">&quot;6x&quot;</span></span><br><span class="line">    | <span class="string">&quot;7x&quot;</span></span><br><span class="line">    | <span class="string">&quot;8x&quot;</span></span><br><span class="line">    | <span class="string">&quot;9x&quot;</span></span><br><span class="line">    | <span class="string">&quot;10x&quot;</span>;</span><br><span class="line">  <span class="attr">spin</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">transform</span>?: <span class="built_in">object</span> | <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">symbol</span>?: <span class="built_in">boolean</span> | <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">title</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">inverse</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">bounce</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">shake</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">beat</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">fade</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">beatFade</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">spinPulse</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">spinReverse</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">type</span>?: <span class="string">&quot;primary&quot;</span> | <span class="string">&quot;success&quot;</span> | <span class="string">&quot;warning&quot;</span> | <span class="string">&quot;danger&quot;</span> | <span class="string">&quot;info&quot;</span>;</span><br><span class="line">  <span class="attr">color</span>?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-Input"><a href="#├─-Input" class="headerlink" title="├─ Input"></a>├─ Input</h3><blockquote><p>输入框组件, 接收用户输入</p></blockquote><h4 id="–API–-6"><a href="#–API–-6" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-index-ts-8"><a href="#├─-index-ts-8" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Input</span> <span class="keyword">from</span> <span class="string">&quot;./Input.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErInput</span> = <span class="title function_">withInstall</span>(<span class="title class_">Input</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-Input-test-tsx"><a href="#├─-Input-test-tsx" class="headerlink" title="├─ Input.test.tsx"></a>├─ Input.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, expect, test &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Input</span> <span class="keyword">from</span> <span class="string">&quot;./Input.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Input.vue&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;render&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Input</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">size</span>: <span class="string">&quot;small&quot;</span>,</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">prepend</span>: <span class="string">&quot;prepend&quot;</span>,</span><br><span class="line">        <span class="attr">prefix</span>: <span class="string">&quot;prefix&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 针对动态 class 的测试</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;er-input&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;er-input--small&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;er-input--text&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-prefix&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">classes</span>()).<span class="title function_">toContain</span>(<span class="string">&quot;is-prepend&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 正确的标签和节点</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;input&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">get</span>(<span class="string">&quot;input&quot;</span>).<span class="title function_">attributes</span>(<span class="string">&quot;type&quot;</span>)).<span class="title function_">toBe</span>(<span class="string">&quot;text&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对 slots 的测试</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__prepend&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">get</span>(<span class="string">&quot;.er-input__prepend&quot;</span>).<span class="title function_">text</span>()).<span class="title function_">toBe</span>(<span class="string">&quot;prepend&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__prefix&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">get</span>(<span class="string">&quot;.er-input__prefix&quot;</span>).<span class="title function_">text</span>()).<span class="title function_">toBe</span>(<span class="string">&quot;prefix&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对 v-if 的测试</span></span><br><span class="line">    <span class="keyword">const</span> wrapper2 = <span class="title function_">mount</span>(<span class="title class_">Input</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;textarea&quot;</span>,</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper2.<span class="title function_">find</span>(<span class="string">&quot;textarea&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;v-model&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">wrapper</span>: <span class="built_in">any</span> = <span class="title function_">mount</span>(<span class="title class_">Input</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">        <span class="string">&quot;onUpdate:modelValue&quot;</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> wrapper.<span class="title function_">setProps</span>(&#123; <span class="attr">modelValue</span>: e &#125;),</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> input = wrapper.<span class="title function_">get</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始值</span></span><br><span class="line">    <span class="title function_">expect</span>(input.<span class="property">element</span>.<span class="property">value</span>).<span class="title function_">toBe</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新值</span></span><br><span class="line">    <span class="comment">// setValue 会触发 input 和 change 事件</span></span><br><span class="line">    <span class="keyword">await</span> input.<span class="title function_">setValue</span>(<span class="string">&quot;test2&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">props</span>(<span class="string">&quot;modelValue&quot;</span>)).<span class="title function_">toBe</span>(<span class="string">&quot;test2&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(input.<span class="property">element</span>.<span class="property">value</span>).<span class="title function_">toBe</span>(<span class="string">&quot;test2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;change&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> inputEvent = wrapper.<span class="title function_">emitted</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> changeEvent = wrapper.<span class="title function_">emitted</span>(<span class="string">&quot;change&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(inputEvent![<span class="number">0</span>]).<span class="title function_">toEqual</span>([<span class="string">&quot;test2&quot;</span>]);</span><br><span class="line">    <span class="title function_">expect</span>(changeEvent![<span class="number">0</span>]).<span class="title function_">toEqual</span>([<span class="string">&quot;test2&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// v-model 异步更新</span></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">setProps</span>(&#123; <span class="attr">modelValue</span>: <span class="string">&quot;test3&quot;</span> &#125;);</span><br><span class="line">    <span class="title function_">expect</span>(input.<span class="property">element</span>.<span class="property">value</span>).<span class="title function_">toBe</span>(<span class="string">&quot;test3&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;clearable&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Input</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">        <span class="attr">clearable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">global</span>: &#123;</span><br><span class="line">        <span class="attr">stubs</span>: [<span class="string">&quot;Icon&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不应该出现 Icon 区域</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__clear&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> input = wrapper.<span class="title function_">get</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> input.<span class="title function_">trigger</span>(<span class="string">&quot;focus&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;focus&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 出现 Icon 区域</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__clear&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点击 Icon 区域，触发 clear 事件</span></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">get</span>(<span class="string">&quot;.er-input__clear&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;clear&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;change&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> inputEvent = wrapper.<span class="title function_">emitted</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> changeEvent = wrapper.<span class="title function_">emitted</span>(<span class="string">&quot;change&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(inputEvent![<span class="number">0</span>]).<span class="title function_">toEqual</span>([<span class="string">&quot;&quot;</span>]);</span><br><span class="line">    <span class="title function_">expect</span>(changeEvent![<span class="number">0</span>]).<span class="title function_">toEqual</span>([<span class="string">&quot;&quot;</span>]);</span><br><span class="line">    <span class="title function_">expect</span>(input.<span class="property">element</span>.<span class="property">value</span>).<span class="title function_">toBe</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> input.<span class="title function_">trigger</span>(<span class="string">&quot;blur&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;blur&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;toggle password&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Input</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;password&quot;</span>,</span><br><span class="line">        <span class="attr">showPassword</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">global</span>: &#123;</span><br><span class="line">        <span class="attr">stubs</span>: [<span class="string">&quot;Icon&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不应该出现 Icon 区域</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__password&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="keyword">const</span> input = wrapper.<span class="title function_">get</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(input.<span class="property">element</span>.<span class="property">type</span>).<span class="title function_">toBe</span>(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> input.<span class="title function_">setValue</span>(<span class="string">&quot;123&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> eyeIcon = wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__password&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(eyeIcon.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(eyeIcon.<span class="title function_">attributes</span>(<span class="string">&quot;icon&quot;</span>)).<span class="title function_">toBe</span>(<span class="string">&quot;eye-slash&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点击 切换</span></span><br><span class="line">    <span class="keyword">await</span> eyeIcon.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(input.<span class="property">element</span>.<span class="property">type</span>).<span class="title function_">toBe</span>(<span class="string">&quot;text&quot;</span>);</span><br><span class="line">    <span class="comment">// 缓存 Icon</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-input__password&quot;</span>).<span class="title function_">attributes</span>(<span class="string">&quot;icon&quot;</span>)).<span class="title function_">toBe</span>(<span class="string">&quot;eye&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="├─-Input-vue"><a href="#├─-Input-vue" class="headerlink" title="├─ Input.vue"></a>├─ Input.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; computed, ref, watch, useAttrs, shallowRef, nextTick &#125; from &quot;vue&quot;;</span><br><span class="line">import type &#123; InputProps, InputEmits, InputInstance &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; useFormItem, useFormDisabled, useFormItemInputId &#125; from &quot;../Form&quot;;</span><br><span class="line">import &#123; debugWarn &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import &#123; useFocusController &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; each, noop &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import Icon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErInput&quot;,</span><br><span class="line">  inheritAttrs: false,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;InputProps&gt;(), &#123;</span><br><span class="line">  type: &quot;text&quot;,</span><br><span class="line">  autocomplete: &quot;off&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;InputEmits&gt;();</span><br><span class="line"></span><br><span class="line">const innerValue = ref(props.modelValue);</span><br><span class="line">const passwordVisible = ref(false);</span><br><span class="line"></span><br><span class="line">const inputRef = shallowRef&lt;HTMLInputElement&gt;();</span><br><span class="line">const textareaRef = shallowRef&lt;HTMLTextAreaElement&gt;();</span><br><span class="line"></span><br><span class="line">const showClear = computed(</span><br><span class="line">  () =&gt;</span><br><span class="line">    props.clearable &amp;&amp;</span><br><span class="line">    !!innerValue.value &amp;&amp;</span><br><span class="line">    !isDisabled.value &amp;&amp;</span><br><span class="line">    isFocused.value</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const showPasswordArea = computed(</span><br><span class="line">  () =&gt;</span><br><span class="line">    props.type === &quot;password&quot; &amp;&amp;</span><br><span class="line">    props.showPassword &amp;&amp;</span><br><span class="line">    !isDisabled.value &amp;&amp;</span><br><span class="line">    !!innerValue.value</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const _ref = computed(() =&gt; inputRef.value || textareaRef.value);</span><br><span class="line"></span><br><span class="line">const attrs = useAttrs();</span><br><span class="line">const isDisabled = useFormDisabled();</span><br><span class="line">const &#123; formItem &#125; = useFormItem();</span><br><span class="line">const &#123; inputId &#125; = useFormItemInputId(props, formItem);</span><br><span class="line">const &#123; wrapperRef, isFocused, handleFocus, handleBlur &#125; = useFocusController(</span><br><span class="line">  _ref,</span><br><span class="line">  &#123;</span><br><span class="line">    afterBlur() &#123;</span><br><span class="line">      formItem?.validate(&quot;blur&quot;).catch((err) =&gt; debugWarn(err));</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const clear: InputInstance[&quot;clear&quot;] = function () &#123;</span><br><span class="line">  innerValue.value = &quot;&quot;;</span><br><span class="line">  each([&quot;update:modelValue&quot;, &quot;input&quot;, &quot;change&quot;], (e) =&gt; emits(e as any, &quot;&quot;));</span><br><span class="line">  emits(&quot;clear&quot;);</span><br><span class="line">  formItem?.clearValidate();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const focus: InputInstance[&quot;focus&quot;] = async function () &#123;</span><br><span class="line">  await nextTick();</span><br><span class="line">  _ref.value?.focus();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const blur: InputInstance[&quot;blur&quot;] = function () &#123;</span><br><span class="line">  _ref.value?.blur();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const select: InputInstance[&quot;select&quot;] = function () &#123;</span><br><span class="line">  _ref.value?.select();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function handleInput() &#123;</span><br><span class="line">  emits(&quot;update:modelValue&quot;, innerValue.value);</span><br><span class="line">  emits(&quot;input&quot;, innerValue.value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleChange() &#123;</span><br><span class="line">  emits(&quot;change&quot;, innerValue.value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function togglePasswordVisible() &#123;</span><br><span class="line">  passwordVisible.value = !passwordVisible.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.modelValue,</span><br><span class="line">  (newValue) =&gt; &#123;</span><br><span class="line">    innerValue.value = newValue;</span><br><span class="line">    formItem?.validate(&quot;change&quot;).catch((err) =&gt; debugWarn(err));</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;InputInstance&gt;(&#123;</span><br><span class="line">  ref: _ref,</span><br><span class="line">  focus,</span><br><span class="line">  blur,</span><br><span class="line">  select,</span><br><span class="line">  clear,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;er-input&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      [`er-input--$&#123;type&#125;`]: type,</span><br><span class="line">      [`er-input--$&#123;size&#125;`]: size,</span><br><span class="line">      &#x27;is-disabled&#x27;: isDisabled,</span><br><span class="line">      &#x27;is-prepend&#x27;: $slots.prepend,</span><br><span class="line">      &#x27;is-append&#x27;: $slots.append,</span><br><span class="line">      &#x27;is-prefix&#x27;: $slots.prefix,</span><br><span class="line">      &#x27;is-suffix&#x27;: $slots.suffix,</span><br><span class="line">      &#x27;is-focus&#x27;: isFocused,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- input --&gt;</span><br><span class="line">    &lt;template v-if=&quot;type !== &#x27;textarea&#x27;&quot;&gt;</span><br><span class="line">      &lt;!-- prepend slot --&gt;</span><br><span class="line">      &lt;div v-if=&quot;$slots.prepend&quot; class=&quot;er-input__prepend&quot;&gt;</span><br><span class="line">        &lt;slot name=&quot;prepend&quot;&gt;&lt;/slot&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;er-input__wrapper&quot; ref=&quot;wrapperRef&quot;&gt;</span><br><span class="line">        &lt;!-- prefix slot --&gt;</span><br><span class="line">        &lt;span v-if=&quot;$slots.prefix&quot; class=&quot;er-input__prefix&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;prefix&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          class=&quot;er-input__inner&quot;</span><br><span class="line">          ref=&quot;inputRef&quot;</span><br><span class="line">          :id=&quot;inputId&quot;</span><br><span class="line">          :type=&quot;showPassword ? (passwordVisible ? &#x27;text&#x27; : &#x27;password&#x27;) : type&quot;</span><br><span class="line">          :disabled=&quot;isDisabled&quot;</span><br><span class="line">          :readonly=&quot;readonly&quot;</span><br><span class="line">          :autocomplete=&quot;autocomplete&quot;</span><br><span class="line">          :placeholder=&quot;placeholder&quot;</span><br><span class="line">          :autofocus=&quot;autofocus&quot;</span><br><span class="line">          :form=&quot;form&quot;</span><br><span class="line">          v-model=&quot;innerValue&quot;</span><br><span class="line">          v-bind=&quot;attrs&quot;</span><br><span class="line">          @input=&quot;handleInput&quot;</span><br><span class="line">          @change=&quot;handleChange&quot;</span><br><span class="line">          @focus=&quot;handleFocus&quot;</span><br><span class="line">          @blur=&quot;handleBlur&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;!-- suffix slot --&gt;</span><br><span class="line">        &lt;span</span><br><span class="line">          v-if=&quot;$slots.suffix || showClear || showPasswordArea&quot;</span><br><span class="line">          class=&quot;er-input__suffix&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;slot name=&quot;suffix&quot;&gt;&lt;/slot&gt;</span><br><span class="line">          &lt;Icon</span><br><span class="line">            icon=&quot;circle-xmark&quot;</span><br><span class="line">            v-if=&quot;showClear&quot;</span><br><span class="line">            class=&quot;er-input__clear&quot;</span><br><span class="line">            @click=&quot;clear&quot;</span><br><span class="line">            @mousedown.prevent=&quot;noop&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Icon</span><br><span class="line">            icon=&quot;eye&quot;</span><br><span class="line">            v-if=&quot;showPasswordArea &amp;&amp; passwordVisible&quot;</span><br><span class="line">            class=&quot;er-input__password&quot;</span><br><span class="line">            @click=&quot;togglePasswordVisible&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Icon</span><br><span class="line">            icon=&quot;eye-slash&quot;</span><br><span class="line">            v-if=&quot;showPasswordArea &amp;&amp; !passwordVisible&quot;</span><br><span class="line">            class=&quot;er-input__password&quot;</span><br><span class="line">            @click=&quot;togglePasswordVisible&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- append slot --&gt;</span><br><span class="line">      &lt;div v-if=&quot;$slots.append&quot; class=&quot;er-input__append&quot;&gt;</span><br><span class="line">        &lt;slot name=&quot;append&quot;&gt;&lt;/slot&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- textarea --&gt;</span><br><span class="line">    &lt;template v-else&gt;</span><br><span class="line">      &lt;textarea</span><br><span class="line">        class=&quot;er-textarea__wrapper&quot;</span><br><span class="line">        ref=&quot;textareaRef&quot;</span><br><span class="line">        :id=&quot;inputId&quot;</span><br><span class="line">        :disabled=&quot;isDisabled&quot;</span><br><span class="line">        :readonly=&quot;readonly&quot;</span><br><span class="line">        :autocomplete=&quot;autocomplete&quot;</span><br><span class="line">        :placeholder=&quot;placeholder&quot;</span><br><span class="line">        :autofocus=&quot;autofocus&quot;</span><br><span class="line">        :form=&quot;form&quot;</span><br><span class="line">        v-model=&quot;innerValue&quot;</span><br><span class="line">        v-bind=&quot;attrs&quot;</span><br><span class="line">        @input=&quot;handleInput&quot;</span><br><span class="line">        @change=&quot;handleChange&quot;</span><br><span class="line">        @focus=&quot;handleFocus&quot;</span><br><span class="line">        @blur=&quot;handleBlur&quot;</span><br><span class="line">      &gt;&lt;/textarea&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-6"><a href="#├─-style-css-6" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-input</span> &#123;</span><br><span class="line">  <span class="attr">--er-input-text-color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">  <span class="attr">--er-input-border</span>: <span class="built_in">var</span>(--er-border);</span><br><span class="line">  <span class="attr">--er-input-hover-border</span>: <span class="built_in">var</span>(--er-border-color-hover);</span><br><span class="line">  <span class="attr">--er-input-focus-border</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">  <span class="attr">--er-input-transparent-border</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> transparent inset;</span><br><span class="line">  <span class="attr">--er-input-border-color</span>: <span class="built_in">var</span>(--er-border-color);</span><br><span class="line">  <span class="attr">--er-input-border-radius</span>: <span class="built_in">var</span>(--er-border-radius-base);</span><br><span class="line">  <span class="attr">--er-input-bg-color</span>: <span class="built_in">var</span>(--er-fill-color-blank);</span><br><span class="line">  <span class="attr">--er-input-icon-color</span>: <span class="built_in">var</span>(--er-text-color-placeholder);</span><br><span class="line">  <span class="attr">--er-input-placeholder-color</span>: <span class="built_in">var</span>(--er-text-color-placeholder);</span><br><span class="line">  <span class="attr">--er-input-hover-border-color</span>: <span class="built_in">var</span>(--er-border-color-hover);</span><br><span class="line">  <span class="attr">--er-input-clear-hover-color</span>: <span class="built_in">var</span>(--er-text-color-secondary);</span><br><span class="line">  <span class="attr">--er-input-focus-border-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-input</span> &#123;</span><br><span class="line">  <span class="attr">--er-input-height</span>: <span class="built_in">var</span>(--er-component-size);</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="built_in">var</span>(--er-input-height);</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">  &amp;<span class="selector-class">.is-disabled</span> &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    <span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-disabled-bg-color);</span><br><span class="line">      <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-disabled-border-color) inset;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.er-input__inner</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">      -webkit-<span class="selector-tag">text</span>-<span class="attribute">fill</span>-<span class="attribute">color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">      <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.er-textarea__inner</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-disabled-bg-color);</span><br><span class="line">      <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-disabled-border-color) inset;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">      -webkit-<span class="selector-tag">text</span>-<span class="attribute">fill</span>-<span class="attribute">color</span>: <span class="built_in">var</span>(--er-disabled-text-color);</span><br><span class="line">      <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-prepend</span> &#123;</span><br><span class="line">    &gt;<span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">      <span class="attribute">border-top-left-radius</span>: <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">border-bottom-left-radius</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-append</span> &#123;</span><br><span class="line">    &gt;<span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">      <span class="attribute">border-top-right-radius</span>: <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">border-bottom-right-radius</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-focus</span> <span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-input-focus-border-color) inset<span class="meta">!important</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-input--large</span> &#123;</span><br><span class="line">  <span class="attr">--er-input-height</span>: <span class="built_in">var</span>(--er-component-size-large);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1px</span> <span class="number">15px</span>;</span><br><span class="line">    <span class="selector-class">.er-input__inner</span> &#123;</span><br><span class="line">      <span class="attr">--er-input-inner-height</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--er-input-height, <span class="number">40px</span>) - <span class="number">2px</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input--small</span> &#123;</span><br><span class="line">  <span class="attr">--er-input-height</span>: <span class="built_in">var</span>(--er-component-size-small);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1px</span> <span class="number">7px</span>;</span><br><span class="line">    <span class="selector-class">.er-input__inner</span> &#123;</span><br><span class="line">      <span class="attr">--er-input-inner-height</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--er-input-height, <span class="number">24px</span>) - <span class="number">2px</span>);</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__prefix</span>, <span class="selector-class">.er-input__suffix</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  <span class="attribute">flex-shrink</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: nowrap;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-icon-color, <span class="built_in">var</span>(--er-text-color-placeholder));</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__prefix</span> &#123;</span><br><span class="line">  &gt;<span class="selector-pseudo">:first-child</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  &gt;<span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">8px</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__suffix</span> &#123;</span><br><span class="line">  &gt;<span class="selector-pseudo">:first-child</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">8px</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  &gt;<span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__prepend</span>, <span class="selector-class">.er-input__append</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-fill-color-light);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-info);</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-input-border-radius);</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__prepend</span> &#123;</span><br><span class="line">  <span class="attribute">border-right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-top-right-radius</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-bottom-right-radius</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">1px</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">var</span>(--er-input-border-color) inset,<span class="number">0</span> <span class="number">1px</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">var</span>(--er-input-border-color) inset,<span class="number">0</span> -<span class="number">1px</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">var</span>(--er-input-border-color) inset;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__append</span> &#123;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-top-left-radius</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-bottom-left-radius</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">1px</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">var</span>(--er-input-border-color) inset,<span class="number">0</span> -<span class="number">1px</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">var</span>(--er-input-border-color) inset,-<span class="number">1px</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">var</span>(--er-input-border-color) inset;</span><br><span class="line">  &amp; &gt;<span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">border-top-left-radius</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border-bottom-left-radius</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-input--textarea</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">vertical-align</span>: bottom;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-textarea__wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">resize</span>: vertical;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">11px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.5</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: inherit;</span><br><span class="line">  <span class="attribute">font-family</span>: inherit;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-text-color, <span class="built_in">var</span>(--er-text-color-regular));</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-input-bg-color, <span class="built_in">var</span>(--er-fill-color-blank));</span><br><span class="line">  <span class="attribute">background-image</span>: none;</span><br><span class="line">  -webkit-<span class="attribute">appearance</span>: none;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-input-border-color, <span class="built_in">var</span>(--er-border-color)) inset;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-input-border-radius, <span class="built_in">var</span>(--er-border-radius-base));</span><br><span class="line">  <span class="attribute">transition</span>: <span class="built_in">var</span>(--er-transition-box-shadow);</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  &amp;<span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">    <span class="attribute">outline</span>: none;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-input-focus-border-color) inset;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-pseudo">::placeholder</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-placeholder-color);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-input__wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">flex-grow</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">1px</span> <span class="number">11px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-input-bg-color, <span class="built_in">var</span>(--er-fill-color-blank));</span><br><span class="line">  <span class="attribute">background-image</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-input-border-radius, <span class="built_in">var</span>(--er-border-radius-base));</span><br><span class="line">  <span class="attribute">transition</span>: <span class="built_in">var</span>(--er-transition-box-shadow);</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-input-border-color, <span class="built_in">var</span>(--er-border-color)) inset;</span><br><span class="line">  &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-input-hover-border-color) inset;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-focus</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">var</span>(--er-input-focus-border-color) inset;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-input__inner</span> &#123;</span><br><span class="line">    <span class="attr">--er-input-inner-height</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--er-input-height, <span class="number">32px</span>) - <span class="number">2px</span>);</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">flex-grow</span>: <span class="number">1</span>;</span><br><span class="line">    -webkit-<span class="attribute">appearance</span>: none;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-text-color, <span class="built_in">var</span>(--er-text-color-regular));</span><br><span class="line">    <span class="attribute">font-size</span>: inherit;</span><br><span class="line">    <span class="attribute">height</span>: <span class="built_in">var</span>(--er-input-inner-height);</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="built_in">var</span>(--er-input-inner-height);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">outline</span>: none;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">background</span>: none;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    &amp;<span class="selector-pseudo">::placeholder</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-placeholder-color);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="selector-class">.er-icon</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: inherit;</span><br><span class="line">    <span class="attribute">line-height</span>: inherit;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">8px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-input__clear</span>, <span class="selector-class">.er-input__password</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-icon-color);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">     <span class="attribute">color</span>: <span class="built_in">var</span>(--er-input-clear-hover-color);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-7"><a href="#└─-types-ts-7" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">InputProps</span> &#123;</span><br><span class="line">  <span class="attr">id</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">modelValue</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">type</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">size</span>?: <span class="string">&quot;large&quot;</span> | <span class="string">&quot;small&quot;</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">clearable</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">showPassword</span>?: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">placeholder</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">readonly</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">autocomplete</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">autofocus</span>?: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">form</span>?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">InputEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;update:modelValue&quot;</span>, <span class="attr">value</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;input&quot;</span>, <span class="attr">value</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="comment">// 修改值且 失去焦点 才触发&#x27;change&#x27;</span></span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;change&quot;</span>, <span class="attr">value</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;focus&quot;</span>, <span class="attr">value</span>: <span class="title class_">FocusEvent</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;blur&quot;</span>, <span class="attr">value</span>: <span class="title class_">FocusEvent</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;clear&quot;</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">InputInstance</span> &#123;</span><br><span class="line">  <span class="attr">ref</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">HTMLInputElement</span> | <span class="title class_">HTMLTextAreaElement</span> | <span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="title function_">focus</span>(): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="title function_">blur</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">select</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">clear</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-Loading"><a href="#├─-Loading" class="headerlink" title="├─ Loading"></a>├─ Loading</h3><blockquote><p>显示加载状态</p></blockquote><h4 id="–API–-7"><a href="#–API–-7" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-directive-ts"><a href="#├─-directive-ts" class="headerlink" title="├─ directive.ts"></a>├─ directive.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Directive</span>, <span class="keyword">type</span> <span class="title class_">DirectiveBinding</span>, <span class="keyword">type</span> <span class="title class_">MaybeRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">LoadingOptions</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">LoadingInstance</span>, <span class="title class_">Loading</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./service&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">INSTANCE_KEY</span> = <span class="title class_">Symbol</span>(<span class="string">&quot;loading&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ElementLoading</span> <span class="keyword">extends</span> <span class="title class_">HTMLElement</span> &#123;</span><br><span class="line">  [<span class="variable constant_">INSTANCE_KEY</span>]?: &#123;</span><br><span class="line">    <span class="attr">instance</span>: <span class="title class_">LoadingInstance</span>;</span><br><span class="line">    <span class="attr">options</span>: <span class="title class_">LoadingOptions</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">el</span>: <span class="title class_">ElementLoading</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">binding</span>: <span class="title class_">DirectiveBinding</span>&lt;<span class="built_in">boolean</span>&gt;</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> getProp = &lt;K <span class="keyword">extends</span> keyof <span class="title class_">LoadingOptions</span>&gt;<span class="function">(<span class="params"><span class="attr">name</span>: K</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> el.<span class="title function_">getAttribute</span>(<span class="string">`er-loading-<span class="subst">$&#123;name&#125;</span>`</span>) <span class="keyword">as</span> <span class="title class_">MaybeRef</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getModifier = &lt;K <span class="keyword">extends</span> keyof <span class="title class_">LoadingOptions</span>&gt;<span class="function">(<span class="params"><span class="attr">name</span>: K</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> binding.<span class="property">modifiers</span>[name];</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fullscreen = <span class="title function_">getModifier</span>(<span class="string">&quot;fullscreen&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">options</span>: <span class="title class_">LoadingOptions</span> = &#123;</span><br><span class="line">    <span class="attr">text</span>: <span class="title function_">getProp</span>(<span class="string">&quot;text&quot;</span>),</span><br><span class="line">    <span class="attr">spinner</span>: <span class="title function_">getProp</span>(<span class="string">&quot;spinner&quot;</span>),</span><br><span class="line">    <span class="attr">background</span>: <span class="title function_">getProp</span>(<span class="string">&quot;background&quot;</span>),</span><br><span class="line">    <span class="attr">target</span>: fullscreen ? <span class="built_in">void</span> <span class="number">0</span> : el,</span><br><span class="line">    <span class="attr">body</span>: <span class="title function_">getModifier</span>(<span class="string">&quot;body&quot;</span>),</span><br><span class="line">    <span class="attr">lock</span>: <span class="title function_">getModifier</span>(<span class="string">&quot;lock&quot;</span>),</span><br><span class="line">    fullscreen,</span><br><span class="line">  &#125;;</span><br><span class="line">  el[<span class="variable constant_">INSTANCE_KEY</span>] = &#123;</span><br><span class="line">    options,</span><br><span class="line">    <span class="attr">instance</span>: <span class="title class_">Loading</span>(options),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">vLoading</span>: <span class="title class_">Directive</span>&lt;<span class="title class_">ElementLoading</span>, <span class="built_in">boolean</span>&gt; = &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (binding.<span class="property">value</span>) <span class="title function_">createInstance</span>(el, binding);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">updated</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (binding.<span class="property">oldValue</span> === binding.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (binding.<span class="property">value</span> &amp;&amp; !binding.<span class="property">oldValue</span>) &#123;</span><br><span class="line">      <span class="title function_">createInstance</span>(el, binding);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    el[<span class="variable constant_">INSTANCE_KEY</span>]?.<span class="property">instance</span>?.<span class="title function_">close</span>();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">unmounted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    el[<span class="variable constant_">INSTANCE_KEY</span>]?.<span class="property">instance</span>.<span class="title function_">close</span>();</span><br><span class="line">    el[<span class="variable constant_">INSTANCE_KEY</span>] = <span class="built_in">void</span> <span class="number">0</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="├─-index-ts-9"><a href="#├─-index-ts-9" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; vLoading &#125; <span class="keyword">from</span> <span class="string">&quot;./directive&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Loading</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./service&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErLoading</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&#x27;ErLoading&#x27;</span>,</span><br><span class="line">  <span class="title function_">install</span>(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) &#123;</span><br><span class="line">    app.<span class="title function_">directive</span>(<span class="string">&quot;loading&quot;</span>, vLoading);</span><br><span class="line">    app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$loading</span> = <span class="title class_">Loading</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">directive</span>: vLoading,</span><br><span class="line">  <span class="attr">service</span>: <span class="title class_">Loading</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ErLoading</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  vLoading,</span><br><span class="line">  vLoading <span class="keyword">as</span> <span class="title class_">ErLoadingDirective</span>,</span><br><span class="line">  <span class="title class_">Loading</span> <span class="keyword">as</span> <span class="title class_">ErLoadingService</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-Loading-test-tsx"><a href="#├─-Loading-test-tsx" class="headerlink" title="├─ Loading.test.tsx"></a>├─ Loading.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, expect &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; nextTick &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Loading</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./service&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">rAF</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">requestAnimationFrame</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="title function_">res</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">nextTick</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Loading&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should creat Loading instance&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> instance = <span class="title class_">Loading</span>();</span><br><span class="line">    <span class="title function_">expect</span>(instance).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should render mask&#x27;</span>,<span class="title function_">async</span>()=&gt;&#123;</span><br><span class="line">    <span class="title class_">Loading</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.er-loading__mask&#x27;</span>)).<span class="title function_">toBeTruthy</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should close Loading and remove it from DOM&#x27;</span>,<span class="title function_">async</span>()=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> instance = <span class="title class_">Loading</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.er-loading&#x27;</span>)).<span class="title function_">toBeTruthy</span>()</span><br><span class="line">    instance.<span class="title function_">close</span>()</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.er-loading&#x27;</span>)).<span class="title function_">toBeFalsy</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="├─-Loading-vue"><a href="#├─-Loading-vue" class="headerlink" title="├─ Loading.vue"></a>├─ Loading.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; LoadingOptions &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; computed, type Ref &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; isString &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErLoading&quot;,</span><br><span class="line">  inheritAttrs: false,</span><br><span class="line">&#125;);</span><br><span class="line">const props = defineProps&lt;LoadingOptions&gt;();</span><br><span class="line"></span><br><span class="line">const iconName = computed(() =&gt; &#123;</span><br><span class="line">  if (isString(props.spinner)) &#123;</span><br><span class="line">    return props.spinner;</span><br><span class="line">  &#125;</span><br><span class="line">  return &quot;spinner&quot;; // &#x27;circle-notch&#x27; 也很好看</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition name=&quot;fade-in-linear&quot; @after-leave=&quot;onAfterLeave&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&quot;(props.visible as Ref).value&quot;</span><br><span class="line">      class=&quot;er-loading er-loading__mask&quot;</span><br><span class="line">      :class=&quot;&#123; &#x27;is-fullscreen&#x27;: fullscreen &#125;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div class=&quot;er-loading__spinner&quot;&gt;</span><br><span class="line">        &lt;er-icon v-if=&quot;props.spinner !== false&quot; :icon=&quot;iconName&quot; spin /&gt;</span><br><span class="line">        &lt;p v-if=&quot;text&quot; class=&quot;er-loading-text&quot;&gt;&#123;&#123; text &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">.er-loading &#123;</span><br><span class="line">  --er-loading-bg-color: v-bind(background) !important;</span><br><span class="line">  --er-loading-z-index: v-bind(zIndex) !important;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-service-ts"><a href="#├─-service-ts" class="headerlink" title="├─ service.ts"></a>├─ service.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">LoadingOptions</span>, <span class="title class_">LoadingOptionsResolved</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, createApp, reactive, nextTick &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useZIndex &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/hooks&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">LoadingComp</span> <span class="keyword">from</span> <span class="string">&quot;./Loading.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; delay, isNil, isString &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">RELATIVE_CLASS</span> = <span class="string">&quot;er-loading-parent--relative&quot;</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">HIDDEN_CLASS</span> = <span class="string">&quot;er-loading-parent--hiden&quot;</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">LOADING_NUMB_KEY</span> = <span class="string">&quot;er-loading-numb&quot;</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">instanceMap</span>: <span class="title class_">Map</span>&lt;<span class="title class_">HTMLElement</span>, <span class="title class_">LoadingInstance</span>&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; nextZIndex &#125; = <span class="title function_">useZIndex</span>(<span class="number">30000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createLoadingComponent</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">LoadingOptionsResolved</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> afterLeaveFlag = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleAfterLeave</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!afterLeaveFlag.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="title function_">destroy</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> data = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    ...options,</span><br><span class="line">    <span class="attr">onAfterLeave</span>: handleAfterLeave,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">setText</span> = (<span class="params"><span class="attr">text</span>: <span class="built_in">string</span></span>) =&gt; (data.<span class="property">text</span> = text);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">destroy</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> target = data.<span class="property">parent</span>;</span><br><span class="line">    <span class="title function_">subtLoadingNumb</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">getLoadingNumb</span>(target)) <span class="keyword">return</span>;</span><br><span class="line">    <span class="title function_">delay</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">removeRelativeClass</span>(target);</span><br><span class="line">      <span class="title function_">removeHiddenClass</span>(target);</span><br><span class="line">    &#125;, <span class="number">1</span>);</span><br><span class="line">    instanceMap.<span class="title function_">delete</span>(target ?? <span class="variable language_">document</span>.<span class="property">body</span>);</span><br><span class="line">    vm.<span class="property">$el</span>?.<span class="property">parentNode</span>?.<span class="title function_">removeChild</span>(vm.<span class="property">$el</span>);</span><br><span class="line">    app.<span class="title function_">unmount</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">afterLeaveTimer</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">close</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">beforeClose</span> &amp;&amp; !options.<span class="title function_">beforeClose</span>()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    afterLeaveFlag.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(afterLeaveTimer);</span><br><span class="line">    afterLeaveTimer = <span class="title function_">delay</span>(handleAfterLeave, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">    visible.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">    options.<span class="property">closed</span>?.();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">LoadingComp</span>, &#123;</span><br><span class="line">    ...data,</span><br><span class="line">    <span class="attr">zIndex</span>: data.<span class="property">fullscreen</span> ? <span class="title function_">nextZIndex</span>() : <span class="built_in">void</span> <span class="number">0</span>,</span><br><span class="line">    visible,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> vm = app.<span class="title function_">mount</span>(<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">$el</span>(): <span class="title class_">HTMLElement</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> vm.<span class="property">$el</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    vm,</span><br><span class="line">    close,</span><br><span class="line">    visible,</span><br><span class="line">    setText,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolveOptions</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">LoadingOptions</span></span>): <span class="title class_">LoadingOptionsResolved</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">target</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isString</span>(options.<span class="property">target</span>)) &#123;</span><br><span class="line">    target = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(options.<span class="property">target</span>) ?? <span class="variable language_">document</span>.<span class="property">body</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    target = options.<span class="property">target</span> || <span class="variable language_">document</span>.<span class="property">body</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">parent</span>: target === <span class="variable language_">document</span>.<span class="property">body</span> || options.<span class="property">body</span> ? <span class="variable language_">document</span>.<span class="property">body</span> : target,</span><br><span class="line">    <span class="attr">background</span>: options.<span class="property">background</span> ?? <span class="string">&quot;rgba(0, 0, 0, 0.5)&quot;</span>,</span><br><span class="line">    <span class="attr">spinner</span>: options.<span class="property">spinner</span>,</span><br><span class="line">    <span class="attr">text</span>: options.<span class="property">text</span>,</span><br><span class="line">    <span class="attr">fullscreen</span>: target === <span class="variable language_">document</span>.<span class="property">body</span> &amp;&amp; (options.<span class="property">fullscreen</span> ?? <span class="literal">true</span>),</span><br><span class="line">    <span class="attr">lock</span>: options.<span class="property">lock</span> ?? <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">visible</span>: options.<span class="property">visible</span> ?? <span class="literal">true</span>,</span><br><span class="line">    target,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addRelativeClass</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  target.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="variable constant_">RELATIVE_CLASS</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">removeRelativeClass</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  target.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="variable constant_">RELATIVE_CLASS</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addHiddenClass</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  target.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="variable constant_">HIDDEN_CLASS</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">removeHiddenClass</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  target.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="variable constant_">HIDDEN_CLASS</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getLoadingNumb</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> target.<span class="title function_">getAttribute</span>(<span class="variable constant_">LOADING_NUMB_KEY</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">removeLoadingNumb</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  target.<span class="title function_">removeAttribute</span>(<span class="variable constant_">LOADING_NUMB_KEY</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addLoadingNumb</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> numb = <span class="title function_">getLoadingNumb</span>(target) ?? <span class="string">&quot;0&quot;</span>;</span><br><span class="line">  target.<span class="title function_">setAttribute</span>(<span class="variable constant_">LOADING_NUMB_KEY</span>, <span class="string">`<span class="subst">$&#123;<span class="built_in">Number</span>.<span class="built_in">parseInt</span>(numb) + <span class="number">1</span>&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">subtLoadingNumb</span>(<span class="params"><span class="attr">target</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> numb = <span class="title function_">getLoadingNumb</span>(target);</span><br><span class="line">  <span class="keyword">if</span> (numb) &#123;</span><br><span class="line">    <span class="keyword">const</span> newNumb = <span class="title class_">Number</span>.<span class="built_in">parseInt</span>(numb) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (newNumb === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="title function_">removeLoadingNumb</span>(target);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      target.<span class="title function_">setAttribute</span>(<span class="variable constant_">LOADING_NUMB_KEY</span>, <span class="string">`<span class="subst">$&#123;newNumb&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addClass</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">options</span>: <span class="title class_">LoadingOptions</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">parent</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.body</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (options.<span class="property">lock</span>) &#123;</span><br><span class="line">    <span class="title function_">addHiddenClass</span>(parent);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">removeHiddenClass</span>(parent);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addRelativeClass</span>(parent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">fullscreenInstance</span>: <span class="title class_">LoadingInstance</span> | <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">LoadingInstance</span> = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> createLoadingComponent&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">Loading</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">LoadingOptions</span> = &#123;&#125;</span>): <span class="title class_">LoadingInstance</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> resolved = <span class="title function_">resolveOptions</span>(options);</span><br><span class="line">  <span class="keyword">const</span> target = resolved.<span class="property">parent</span> ?? <span class="variable language_">document</span>.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (resolved.<span class="property">fullscreen</span> &amp;&amp; !<span class="title function_">isNil</span>(fullscreenInstance)) &#123;</span><br><span class="line">    <span class="keyword">return</span> fullscreenInstance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addLoadingNumb</span>(resolved?.<span class="property">parent</span>);</span><br><span class="line">  <span class="keyword">if</span> (instanceMap.<span class="title function_">has</span>(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> instanceMap.<span class="title function_">get</span>(target)!;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">createLoadingComponent</span>(&#123;</span><br><span class="line">    ...resolved,</span><br><span class="line">    <span class="attr">closed</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolved.<span class="property">closed</span>?.();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (resolved.<span class="property">fullscreen</span>) &#123;</span><br><span class="line">        fullscreenInstance = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addClass</span>(options, resolved?.<span class="property">parent</span>);</span><br><span class="line"></span><br><span class="line">  resolved.<span class="property">parent</span>?.<span class="title function_">appendChild</span>(instance.<span class="property">$el</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> (instance.<span class="property">visible</span>.<span class="property">value</span> = !!resolved.<span class="property">visible</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (resolved.<span class="property">fullscreen</span>) &#123;</span><br><span class="line">    fullscreenInstance = instance;</span><br><span class="line">  &#125;</span><br><span class="line">  instanceMap.<span class="title function_">set</span>(target, instance);</span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-7"><a href="#├─-style-css-7" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-loading</span> &#123;</span><br><span class="line">  <span class="attr">--er-loading-icon-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">  <span class="attr">--er-loading-mask-margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attr">--er-loading-mask-size</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attr">--er-loading-icon-size</span>: <span class="number">42px</span>;</span><br><span class="line">  <span class="attr">--er-loading-font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attr">--er-loading-z-index</span>: <span class="number">20000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-loading</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  &amp;<span class="selector-class">.er-loading__mask</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="built_in">var</span>(--er-loading-mask-margin);</span><br><span class="line">    <span class="attribute">top</span>: <span class="built_in">var</span>(--er-loading-mask-margin);</span><br><span class="line">    <span class="attribute">right</span>: <span class="built_in">var</span>(--er-loading-mask-margin);</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="built_in">var</span>(--er-loading-mask-margin);</span><br><span class="line">    <span class="attribute">left</span>: <span class="built_in">var</span>(--er-loading-mask-margin);</span><br><span class="line">    <span class="attribute">height</span>: <span class="built_in">var</span>(--er-loading-mask-size);</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">var</span>(--er-loading-mask-size);</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="built_in">var</span>(--er-loading-z-index);</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--er-loading-bg-color);</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    &amp;<span class="selector-class">.is-fullscreen</span> &#123;</span><br><span class="line">      <span class="attribute">position</span>: fixed;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-loading__spinner</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-loading-icon-color);</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="selector-class">.er-loading-text</span> &#123;</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">3px</span> <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-loading-font-size);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">i</span> &#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-loading-icon-size);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fade-in-linear-enter-from</span>,</span><br><span class="line"><span class="selector-class">.fade-in-linear-leave-to</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-loading-parent--relative</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-loading-parent--hiden</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-8"><a href="#└─-types-ts-8" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">MaybeRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">LoadingOptionsResolved</span> &#123;</span><br><span class="line">  <span class="attr">parent</span>?: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="attr">target</span>?: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="attr">visible</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">  <span class="attr">background</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">  <span class="attr">spinner</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">boolean</span> | <span class="built_in">string</span>&gt;;</span><br><span class="line">  <span class="attr">text</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">  <span class="attr">fullscreen</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">  <span class="attr">lock</span>?: <span class="title class_">MaybeRef</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">  beforeClose?(): <span class="built_in">boolean</span>;</span><br><span class="line">  closed?(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">LoadingOptions</span> = <span class="title class_">Partial</span>&lt;</span><br><span class="line">  <span class="title class_">Omit</span>&lt;<span class="title class_">LoadingOptionsResolved</span>, <span class="string">&quot;parent&quot;</span> | <span class="string">&quot;target&quot;</span>&gt; &amp; &#123;</span><br><span class="line">    <span class="attr">target</span>: <span class="title class_">HTMLElement</span> | <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">body</span>: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">zIndex</span>?: <span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">onAfterLeave</span>(): <span class="built_in">void</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&gt;;</span><br></pre></td></tr></table></figure><h3 id="├─-Message"><a href="#├─-Message" class="headerlink" title="├─ Message"></a>├─ Message</h3><blockquote><p>顶部消息弹出框</p></blockquote><h4 id="–API–-8"><a href="#–API–-8" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-index-ts-10"><a href="#├─-index-ts-10" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Message</span> <span class="keyword">from</span> <span class="string">&quot;./methods&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstallFunction &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErMessage</span> = <span class="title function_">withInstallFunction</span>(<span class="title class_">Message</span>, <span class="string">&quot;$message&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-Message-test-tsx"><a href="#├─-Message-test-tsx" class="headerlink" title="├─ Message.test.tsx"></a>├─ Message.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, test, expect &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; nextTick &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; message, closeAll &#125; <span class="keyword">from</span> <span class="string">&quot;./methods&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">rAF</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">requestAnimationFrame</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="title function_">res</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">nextTick</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTopValue</span>(<span class="params"><span class="attr">element</span>: <span class="title class_">Element</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> styles = <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(element);</span><br><span class="line">  <span class="keyword">const</span> topValue = styles.<span class="title function_">getPropertyValue</span>(<span class="string">&quot;top&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Number</span>.<span class="built_in">parseFloat</span>(topValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;createMessage&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;调用方法应该创建对应的 Message 组件&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="title function_">message</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-message&quot;</span>)).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    handler.<span class="title function_">close</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-message&quot;</span>)).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;多次调用应该创建多个实例&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="title function_">message</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span> &#125;);</span><br><span class="line">    <span class="title function_">message</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg2&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.er-message&quot;</span>).<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="title function_">closeAll</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.er-message&quot;</span>).<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;创建多个实例应该设置正确的 offset&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="title function_">message</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span>, <span class="attr">offset</span>: <span class="number">100</span> &#125;);</span><br><span class="line">    <span class="title function_">message</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg2&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span>, <span class="attr">offset</span>: <span class="number">50</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="keyword">const</span> elements = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.er-message&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(elements.<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// https://github.com/jsdom/jsdom/issues/1590</span></span><br><span class="line">    <span class="comment">// jsdom 中获取height的数值都为 0</span></span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">getTopValue</span>(elements[<span class="number">0</span>])).<span class="title function_">toBe</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">getTopValue</span>(elements[<span class="number">1</span>])).<span class="title function_">toBe</span>(<span class="number">150</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="├─-Message-vue"><a href="#├─-Message-vue" class="headerlink" title="├─ Message.vue"></a>├─ Message.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; MessageProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; computed, onMounted, ref, watch &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; getLastBottomOffset &#125; from &quot;./methods&quot;;</span><br><span class="line">import &#123; delay, bind &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123; useEventListener, useOffset &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; RenderVnode, typeIconMap &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErMessage&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const props = withDefaults(defineProps&lt;MessageProps&gt;(), &#123;</span><br><span class="line">  type: &quot;info&quot;,</span><br><span class="line">  duration: 3000,</span><br><span class="line">  offset: 10,</span><br><span class="line">  transitionName: &quot;fade-up&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const visible = ref(false);</span><br><span class="line">const messageRef = ref&lt;HTMLDivElement&gt;();</span><br><span class="line"></span><br><span class="line">const iconName = computed(() =&gt; typeIconMap.get(props.type) ?? &quot;circle-info&quot;);</span><br><span class="line"></span><br><span class="line">// div 的高度</span><br><span class="line">const boxHeight = ref(0);</span><br><span class="line"></span><br><span class="line">const &#123; topOffset, bottomOffset &#125; = useOffset(&#123;</span><br><span class="line">  getLastBottomOffset: bind(getLastBottomOffset, props),</span><br><span class="line">  offset: props.offset,</span><br><span class="line">  boxHeight,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const cssStyle = computed(() =&gt; (&#123;</span><br><span class="line">  top: topOffset.value + &quot;px&quot;,</span><br><span class="line">  zIndex: props.zIndex,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">let timer: number;</span><br><span class="line">function startTimmer() &#123;</span><br><span class="line">  if (props.duration === 0) return;</span><br><span class="line">  timer = delay(close, props.duration);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function clearTimer() &#123;</span><br><span class="line">  clearTimeout(timer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function close() &#123;</span><br><span class="line">  visible.value = false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  visible.value = true;</span><br><span class="line">  startTimmer();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">useEventListener(document, &quot;keydown&quot;, (e: Event) =&gt; &#123;</span><br><span class="line">  const &#123; code &#125; = e as KeyboardEvent;</span><br><span class="line">  if (code === &quot;Escape&quot;) &#123;</span><br><span class="line">    close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">watch(visible, (val) =&gt; &#123;</span><br><span class="line">  if (!val) boxHeight.value = -props.offset; // 退出动画更流畅</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">defineExpose(&#123;</span><br><span class="line">  bottomOffset,</span><br><span class="line">  close,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Transition</span><br><span class="line">    :name=&quot;transitionName&quot;</span><br><span class="line">    @enter=&quot;boxHeight = messageRef!.getBoundingClientRect().height&quot;</span><br><span class="line">    @after-leave=&quot;!visible &amp;&amp; onDestory()&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      ref=&quot;messageRef&quot;</span><br><span class="line">      class=&quot;er-message&quot;</span><br><span class="line">      :class=&quot;&#123;</span><br><span class="line">        [`er-message--$&#123;type&#125;`]: type,</span><br><span class="line">        &#x27;is-close&#x27;: showClose,</span><br><span class="line">        &#x27;text-center&#x27;: center,</span><br><span class="line">      &#125;&quot;</span><br><span class="line">      :style=&quot;cssStyle&quot;</span><br><span class="line">      v-show=&quot;visible&quot;</span><br><span class="line">      role=&quot;alert&quot;</span><br><span class="line">      @mouseenter=&quot;clearTimer&quot;</span><br><span class="line">      @mouseleave=&quot;startTimmer&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;er-icon class=&quot;er-message__icon&quot; :icon=&quot;iconName&quot; /&gt;</span><br><span class="line">      &lt;div class=&quot;er-message__content&quot;&gt;</span><br><span class="line">        &lt;slot&gt;</span><br><span class="line">          &lt;render-vnode v-if=&quot;message&quot; :vNode=&quot;message&quot; /&gt;</span><br><span class="line">        &lt;/slot&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;er-message__close&quot; v-if=&quot;showClose&quot;&gt;</span><br><span class="line">        &lt;er-icon icon=&quot;xmark&quot; @click.stop=&quot;close&quot; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/Transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-methods-ts"><a href="#├─-methods-ts" class="headerlink" title="├─ methods.ts"></a>├─ methods.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;</span><br><span class="line">  <span class="title class_">CreateMessageProps</span>,</span><br><span class="line">  <span class="title class_">MessageInstance</span>,</span><br><span class="line">  <span class="title class_">MessageFn</span>,</span><br><span class="line">  <span class="title class_">Message</span>,</span><br><span class="line">  <span class="title class_">MessageParams</span>,</span><br><span class="line">  <span class="title class_">MessageHandler</span>,</span><br><span class="line">  <span class="title class_">MessageProps</span>,</span><br><span class="line">  messageType,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; messageTypes &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render, h, shallowReactive, isVNode &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; findIndex, get, each, set, isString &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useZIndex, useId &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/hooks&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MessageConstructor</span> <span class="keyword">from</span> <span class="string">&quot;./Message.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">instances</span>: <span class="title class_">MessageInstance</span>[] = <span class="title function_">shallowReactive</span>([]);</span><br><span class="line"><span class="keyword">const</span> &#123; nextZIndex &#125; = <span class="title function_">useZIndex</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> messageDefaults = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">  <span class="attr">duration</span>: <span class="number">3000</span>,</span><br><span class="line">  <span class="attr">offset</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">transitionName</span>: <span class="string">&quot;fade-up&quot;</span>,</span><br><span class="line">&#125; <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeOptions</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageParams</span></span>): <span class="title class_">CreateMessageProps</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result =</span><br><span class="line">    !options || <span class="title function_">isVNode</span>(options) || <span class="title function_">isString</span>(options)</span><br><span class="line">      ? &#123;</span><br><span class="line">          <span class="attr">message</span>: options,</span><br><span class="line">        &#125;</span><br><span class="line">      : options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; ...messageDefaults, ...result &#125; <span class="keyword">as</span> <span class="title class_">CreateMessageProps</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createMessage</span>(<span class="params"><span class="attr">props</span>: <span class="title class_">CreateMessageProps</span></span>): <span class="title class_">MessageInstance</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> id = <span class="title function_">useId</span>().<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">destory</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> idx = <span class="title function_">findIndex</span>(instances, &#123; id &#125;);</span><br><span class="line">    <span class="keyword">if</span> (idx === -<span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    instances.<span class="title function_">splice</span>(idx, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="literal">null</span>, container);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> _props = &#123;</span><br><span class="line">    ...props,</span><br><span class="line">    id,</span><br><span class="line">    <span class="attr">zIndex</span>: <span class="title function_">nextZIndex</span>(),</span><br><span class="line">    <span class="attr">onDestory</span>: destory,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> vnode = <span class="title function_">h</span>(<span class="title class_">MessageConstructor</span>, _props);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(vnode, container);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(container.<span class="property">firstElementChild</span>!);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> vm = vnode.<span class="property">component</span>!;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">handler</span>: <span class="title class_">MessageHandler</span> = &#123;</span><br><span class="line">    <span class="attr">close</span>: <span class="function">() =&gt;</span> vm.<span class="property">exposed</span>!.<span class="title function_">close</span>(),</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">instance</span>: <span class="title class_">MessageInstance</span> = &#123;</span><br><span class="line">    <span class="attr">props</span>: _props,</span><br><span class="line">    id,</span><br><span class="line">    vm,</span><br><span class="line">    vnode,</span><br><span class="line">    handler,</span><br><span class="line">  &#125;;</span><br><span class="line">  instances.<span class="title function_">push</span>(instance);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">message</span>: <span class="title class_">MessageFn</span> &amp; <span class="title class_">Partial</span>&lt;<span class="title class_">Message</span>&gt; = <span class="keyword">function</span> (<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> normalized = <span class="title function_">normalizeOptions</span>(options);</span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">createMessage</span>(normalized);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> instance.<span class="property">handler</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getLastBottomOffset</span>(<span class="params"><span class="attr">this</span>: <span class="title class_">MessageProps</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> idx = <span class="title function_">findIndex</span>(instances, &#123; <span class="attr">id</span>: <span class="variable language_">this</span>.<span class="property">id</span> &#125;);</span><br><span class="line">  <span class="keyword">if</span> (idx &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">get</span>(instances, [idx - <span class="number">1</span>, <span class="string">&quot;vm&quot;</span>, <span class="string">&quot;exposed&quot;</span>, <span class="string">&quot;bottomOffset&quot;</span>, <span class="string">&quot;value&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">closeAll</span>(<span class="params"><span class="attr">type</span>?: messageType</span>) &#123;</span><br><span class="line">  <span class="title function_">each</span>(instances, <span class="function">(<span class="params">instance</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">type</span>) &#123;</span><br><span class="line">      instance.<span class="property">props</span>.<span class="property">type</span> === <span class="keyword">type</span> &amp;&amp; instance.<span class="property">handler</span>.<span class="title function_">close</span>();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    instance.<span class="property">handler</span>.<span class="title function_">close</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">each</span>(messageTypes, <span class="function">(<span class="params"><span class="keyword">type</span></span>) =&gt;</span></span><br><span class="line">  <span class="title function_">set</span>(message, <span class="keyword">type</span>, <span class="function">(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageParams</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> normalized = <span class="title function_">normalizeOptions</span>(options);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">message</span>(&#123; ...normalized, <span class="keyword">type</span> &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">message.<span class="property">closeAll</span> = closeAll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> message <span class="keyword">as</span> <span class="title class_">Message</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-8"><a href="#├─-style-css-8" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-message</span> &#123;</span><br><span class="line">  <span class="attr">--er-message-bg-color</span>: <span class="built_in">var</span>(--er-color-info-light-<span class="number">9</span>);</span><br><span class="line">  <span class="attr">--er-message-border-color</span>: <span class="built_in">var</span>(--er-border-color-lighter);</span><br><span class="line">  <span class="attr">--er-message-padding</span>: <span class="number">15px</span> <span class="number">19px</span>;</span><br><span class="line">  <span class="attr">--er-message-close-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attr">--er-message-close-icon-color</span>: <span class="built_in">var</span>(--er-text-color-placeholder);</span><br><span class="line">  <span class="attr">--er-message-close-hover-color</span>: <span class="built_in">var</span>(--er-text-color-secondary);</span><br><span class="line">  <span class="attr">--er-message-icon-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attr">--er-message-icon-margin</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-message</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: fit-content;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">32px</span>);</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-border-radius-base);</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="built_in">var</span>(--er-border-width);</span><br><span class="line">  <span class="attribute">border-style</span>: <span class="built_in">var</span>(--er-border-style);</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="built_in">var</span>(--er-message-border-color);</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-message-bg-color);</span><br><span class="line">  <span class="attribute">padding</span>: <span class="built_in">var</span>(--er-message-padding);</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">transition</span>: top <span class="built_in">var</span>(--er-transition-duration), opacity <span class="built_in">var</span>(--er-transition-duration),</span><br><span class="line">    transform <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  <span class="selector-class">.er-message__icon</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-message-text-color);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-message-icon-size);</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">var</span>(--er-message-icon-size);</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="built_in">var</span>(--er-message-icon-margin);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-message__content</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-message-text-color);</span><br><span class="line">    <span class="attribute">overflow-wrap</span>: break-word;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-close</span> <span class="selector-class">.er-message__content</span> &#123;</span><br><span class="line">    <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.text-center</span> &#123;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-message__close</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-message__close</span> <span class="selector-class">.er-icon</span> &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@each</span> $val in info, success, warning, danger &#123;</span><br><span class="line">  <span class="selector-class">.er-message--</span>$(val) &#123;</span><br><span class="line">    <span class="attr">--er-message-bg-color</span>: <span class="built_in">var</span>(--er-color-$(val)-light-<span class="number">9</span>);</span><br><span class="line">    <span class="attr">--er-message-border-color</span>: <span class="built_in">var</span>(--er-color-$(val)-light-<span class="number">8</span>);</span><br><span class="line">    <span class="attr">--er-message-text-color</span>: <span class="built_in">var</span>(--er-color-$(val));</span><br><span class="line">    <span class="selector-class">.er-message__close</span> &#123;</span><br><span class="line">      <span class="attr">--er-icon-color</span>: <span class="built_in">var</span>(--er-color-$(val));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-message--error</span> &#123;</span><br><span class="line">  <span class="attr">--er-message-bg-color</span>: <span class="built_in">var</span>(--er-color-danger-light-<span class="number">9</span>);</span><br><span class="line">  <span class="attr">--er-message-border-color</span>: <span class="built_in">var</span>(--er-color-danger-light-<span class="number">8</span>);</span><br><span class="line">  <span class="attr">--er-message-text-color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">  <span class="selector-class">.er-message__close</span> &#123;</span><br><span class="line">    <span class="attr">--er-icon-color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-message</span><span class="selector-class">.fade-up-enter-from</span>,</span><br><span class="line"><span class="selector-class">.er-message</span><span class="selector-class">.fade-up-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">100%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-9"><a href="#└─-types-ts-9" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">VNode</span>, <span class="title class_">ComponentInternalInstance</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> messageTypes = [</span><br><span class="line">  <span class="string">&quot;info&quot;</span>,</span><br><span class="line">  <span class="string">&quot;success&quot;</span>,</span><br><span class="line">  <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">  <span class="string">&quot;danger&quot;</span>,</span><br><span class="line">  <span class="string">&quot;error&quot;</span>,</span><br><span class="line">] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> messageType = (<span class="keyword">typeof</span> messageTypes)[<span class="built_in">number</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageHandler</span> &#123;</span><br><span class="line">  <span class="title function_">close</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageFn</span> = &#123;</span><br><span class="line">  (<span class="attr">props</span>: <span class="title class_">MessageParams</span>): <span class="title class_">MessageHandler</span>;</span><br><span class="line">  <span class="title function_">closeAll</span>(<span class="attr">type</span>?: messageType): <span class="built_in">void</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageTypeFn</span> = <span class="function">(<span class="params"><span class="attr">props</span>: <span class="title class_">MessageParams</span></span>) =&gt;</span> <span class="title class_">MessageHandler</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Message</span> <span class="keyword">extends</span> <span class="title class_">MessageFn</span> &#123;</span><br><span class="line">  <span class="attr">success</span>: <span class="title class_">MessageTypeFn</span>;</span><br><span class="line">  <span class="attr">warning</span>: <span class="title class_">MessageTypeFn</span>;</span><br><span class="line">  <span class="attr">info</span>: <span class="title class_">MessageTypeFn</span>;</span><br><span class="line">  <span class="attr">danger</span>: <span class="title class_">MessageTypeFn</span>;</span><br><span class="line">  <span class="attr">error</span>: <span class="title class_">MessageTypeFn</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageProps</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">message</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span> | (<span class="function">() =&gt;</span> <span class="title class_">VNode</span>);</span><br><span class="line">  <span class="attr">duration</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">showClose</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">center</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">type</span>?: messageType;</span><br><span class="line">  <span class="attr">offset</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">zIndex</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">transitionName</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">onDestory</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageOptions</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">Omit</span>&lt;<span class="title class_">MessageProps</span>, <span class="string">&quot;id&quot;</span>&gt;&gt;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageParams</span> = <span class="built_in">string</span> | <span class="title class_">VNode</span> | <span class="title class_">MessageOptions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageInstance</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">vnode</span>: <span class="title class_">VNode</span>;</span><br><span class="line">  <span class="attr">props</span>: <span class="title class_">MessageProps</span>;</span><br><span class="line">  <span class="attr">vm</span>: <span class="title class_">ComponentInternalInstance</span>;</span><br><span class="line">  <span class="attr">handler</span>: <span class="title class_">MessageHandler</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CreateMessageProps</span> = <span class="title class_">Omit</span>&lt;</span><br><span class="line">  <span class="title class_">MessageProps</span>,</span><br><span class="line">  <span class="string">&quot;onDestory&quot;</span> | <span class="string">&quot;id&quot;</span> | <span class="string">&quot;zIndex&quot;</span></span><br><span class="line">&gt;;</span><br></pre></td></tr></table></figure><h3 id="├─-MessageBox"><a href="#├─-MessageBox" class="headerlink" title="├─ MessageBox"></a>├─ MessageBox</h3><blockquote><p>中心弹出框</p></blockquote><h4 id="–API–-9"><a href="#–API–-9" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-index-ts-11"><a href="#├─-index-ts-11" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">MessageBox</span> <span class="keyword">from</span> <span class="string">&quot;./methods&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; set &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErMessageBox</span> = <span class="title class_">MessageBox</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">set</span>(<span class="title class_">ErMessageBox</span>, <span class="string">&quot;install&quot;</span>, <span class="function">(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt;</span> &#123;</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$msgbox</span> = <span class="title class_">MessageBox</span>;</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$messageBox</span> = <span class="title class_">MessageBox</span>;</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$alert</span> = <span class="title class_">MessageBox</span>.<span class="property">alert</span>;</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$confirm</span> = <span class="title class_">MessageBox</span>.<span class="property">confirm</span>;</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$prompt</span> = <span class="title class_">MessageBox</span>.<span class="property">prompt</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ErMessageBox</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-MessageBox-test-tsx"><a href="#├─-MessageBox-test-tsx" class="headerlink" title="├─ MessageBox.test.tsx"></a>├─ MessageBox.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, expect, vi &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; nextTick &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">MessageBoxType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MessageBox</span> <span class="keyword">from</span> <span class="string">&quot;./methods&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">rAF</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">requestAnimationFrame</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="title function_">res</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">nextTick</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;MessageBox Component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;renders correctly&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> props = &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Test Title&quot;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;Test Message&quot;</span>,</span><br><span class="line">      <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">closeOnClickModal</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">confirmButtonText</span>: <span class="string">&quot;Confirm&quot;</span>,</span><br><span class="line">      <span class="attr">cancelButtonText</span>: <span class="string">&quot;Cancel&quot;</span>,</span><br><span class="line">      <span class="attr">showConfirmButton</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">MessageBox</span>(props);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="keyword">const</span> header = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-message-box__header&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> title = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-message-box__title&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> message = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-message-box__message&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(title).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(header).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(message).<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title class_">MessageBox</span>.<span class="title function_">close</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;closes on close button click&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> props = &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Test Title&quot;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;Test Message&quot;</span>,</span><br><span class="line">      <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> doAction = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="title class_">MessageBox</span>(props).<span class="title function_">catch</span>(<span class="function">(<span class="params">action</span>) =&gt;</span> <span class="title function_">doAction</span>(action));</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> closeBtn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span><br><span class="line">      <span class="string">&quot;.er-message-box__header-btn&quot;</span></span><br><span class="line">    ) <span class="keyword">as</span> <span class="title class_">HTMLButtonElement</span>;</span><br><span class="line">    closeBtn.<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(doAction).<span class="title function_">toHaveBeenCalledWith</span>(<span class="string">&quot;close&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;triggers confirm action on confirm button click&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> props = &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Test Title&quot;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;Test Message&quot;</span>,</span><br><span class="line">      <span class="attr">showConfirmButton</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">showCancelButton</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> doAction = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="title class_">MessageBox</span>(props)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">action</span>) =&gt;</span> <span class="title function_">doAction</span>(action))</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmBtn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span><br><span class="line">      <span class="string">&quot;.er-message-box__footer-btn&quot;</span></span><br><span class="line">    ) <span class="keyword">as</span> <span class="title class_">HTMLButtonElement</span>;</span><br><span class="line">    confirmBtn.<span class="title function_">click</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(doAction).<span class="title function_">toBeCalledWith</span>(<span class="string">&#x27;confirm&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;triggers cancel action on cancel button click&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> props = &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Test Title&quot;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;Test Message&quot;</span>,</span><br><span class="line">      <span class="attr">showConfirmButton</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">showCancelButton</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> doAction = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="title class_">MessageBox</span>(props).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title function_">doAction</span>(err));</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cancelBtn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span><br><span class="line">      <span class="string">&quot;.er-message-box__cancel-btn&quot;</span></span><br><span class="line">    ) <span class="keyword">as</span> <span class="title class_">HTMLButtonElement</span>;</span><br><span class="line">    cancelBtn.<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(doAction).<span class="title function_">toHaveBeenCalledWith</span>(<span class="string">&quot;cancel&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;handles input in prompt mode&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> props = &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Test Title&quot;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;Test Message&quot;</span>,</span><br><span class="line">      <span class="attr">boxType</span>: <span class="string">&quot;prompt&quot;</span> <span class="keyword">as</span> <span class="title class_">MessageBoxType</span>,</span><br><span class="line">      <span class="attr">showInput</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> doAction = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="title class_">MessageBox</span>(props).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="title function_">doAction</span>(res));</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;input&quot;</span>) <span class="keyword">as</span> <span class="title class_">HTMLInputElement</span>;</span><br><span class="line">    input.<span class="property">value</span> = <span class="string">&quot;Test Input&quot;</span>;</span><br><span class="line">    input.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&quot;input&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmBtn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span><br><span class="line">      <span class="string">&quot;.er-message-box__confirm-btn&quot;</span></span><br><span class="line">    ) <span class="keyword">as</span> <span class="title class_">HTMLButtonElement</span>;</span><br><span class="line">    confirmBtn.<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(doAction).<span class="title function_">toHaveBeenCalledWith</span>(&#123;</span><br><span class="line">      <span class="attr">value</span>: <span class="string">&quot;Test Input&quot;</span>,</span><br><span class="line">      <span class="attr">action</span>: <span class="string">&quot;confirm&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="├─-MessageBox-vue"><a href="#├─-MessageBox-vue" class="headerlink" title="├─ MessageBox.vue"></a>├─ MessageBox.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, reactive, computed, watch, nextTick, type Ref &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; isFunction, isNil &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import type &#123; MessageBoxProps, MessageBoxAction &#125; from &quot;./types&quot;;</span><br><span class="line">import type &#123; InputInstance &#125; from &quot;../Input/types&quot;;</span><br><span class="line"></span><br><span class="line">import ErOverlay from &quot;../Overlay/Overlay.vue&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line">import ErButton from &quot;../Button/Button.vue&quot;;</span><br><span class="line">import ErInput from &quot;../Input/Input.vue&quot;;</span><br><span class="line"></span><br><span class="line">import &#123; useId, useZIndex &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; typeIconMap &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123; name: &quot;ErMessageBox&quot;, inheritAttrs: false &#125;);</span><br><span class="line"></span><br><span class="line">const props = withDefaults(defineProps&lt;MessageBoxProps&gt;(), &#123;</span><br><span class="line">  lockScroll: true,</span><br><span class="line">  showClose: true,</span><br><span class="line">  closeOnClickModal: true,</span><br><span class="line">  confirmButtonType: &quot;primary&quot;,</span><br><span class="line">  roundButton: false,</span><br><span class="line">  boxType: &quot;&quot;,</span><br><span class="line">  inputValue: &quot;&quot;,</span><br><span class="line">  inputPlaceholder:&#x27;Please input...&#x27;,</span><br><span class="line">  confirmButtonText: &quot;Ok&quot;,</span><br><span class="line">  cancelButtonText: &quot;Cancel&quot;,</span><br><span class="line">  showConfirmButton: true,</span><br><span class="line">&#125;);</span><br><span class="line">const &#123; doAction &#125; = props;</span><br><span class="line"></span><br><span class="line">const headerRef = ref&lt;HTMLElement&gt;();</span><br><span class="line">const inputRef = ref&lt;InputInstance&gt;();</span><br><span class="line"></span><br><span class="line">const inputId = useId();</span><br><span class="line">const &#123; nextZIndex &#125; = useZIndex();</span><br><span class="line"></span><br><span class="line">const state = reactive(&#123;</span><br><span class="line">  ...props,</span><br><span class="line">  zIndex: nextZIndex(),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const hasMessage = computed(() =&gt; !!state.message);</span><br><span class="line">const iconComponent = computed(</span><br><span class="line">  () =&gt; state.icon ?? typeIconMap.get(state.type ?? &quot;&quot;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.visible?.value,</span><br><span class="line">  (val) =&gt; &#123;</span><br><span class="line">    if (val) state.zIndex = nextZIndex();</span><br><span class="line"></span><br><span class="line">    if (props.boxType !== &quot;prompt&quot;) return;</span><br><span class="line"></span><br><span class="line">    if (!val) return;</span><br><span class="line"></span><br><span class="line">    nextTick(() =&gt; &#123;</span><br><span class="line">      inputRef.value &amp;&amp; inputRef.value.focus();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">function handleWrapperClick() &#123;</span><br><span class="line">  props.closeOnClickModal &amp;&amp; handleAction(&quot;close&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleInputEnter(e: KeyboardEvent) &#123;</span><br><span class="line">  if (state.inputType === &quot;textarea&quot;) return;</span><br><span class="line">  e.preventDefault();</span><br><span class="line">  return handleAction(&quot;confirm&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleAction(action: MessageBoxAction) &#123;</span><br><span class="line">  isFunction(props.beforeClose)</span><br><span class="line">    ? props.beforeClose(action, state, () =&gt; doAction(action, state.inputValue))</span><br><span class="line">    : doAction(action, state.inputValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleClose() &#123;</span><br><span class="line">  handleAction(&quot;close&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition name=&quot;fade-in-linear&quot; @after-leave=&quot;destroy&quot;&gt;</span><br><span class="line">    &lt;er-overlay v-show=&quot;(visible as Ref).value&quot; :z-index=&quot;state.zIndex&quot; mask&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        role=&quot;dialog&quot;</span><br><span class="line">        class=&quot;er-overlay-message-box&quot;</span><br><span class="line">        @click=&quot;handleWrapperClick&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          ref=&quot;rootRef&quot;</span><br><span class="line">          :class=&quot;[</span><br><span class="line">            &#x27;er-message-box&#x27;,</span><br><span class="line">            &#123;</span><br><span class="line">              &#x27;is-center&#x27;: state.center,</span><br><span class="line">            &#125;,</span><br><span class="line">          ]&quot;</span><br><span class="line">          @click.stop</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;div</span><br><span class="line">            v-if=&quot;!isNil(state.title)&quot;</span><br><span class="line">            ref=&quot;headerRef&quot;</span><br><span class="line">            class=&quot;er-message-box__header&quot;</span><br><span class="line">            :class=&quot;&#123; &#x27;show-close&#x27;: state.showClose &#125;&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;div class=&quot;er-message-box__title&quot;&gt;</span><br><span class="line">              &lt;er-icon</span><br><span class="line">                v-if=&quot;iconComponent &amp;&amp; state.center&quot;</span><br><span class="line">                :class=&quot;&#123;</span><br><span class="line">                  [`er-icon-$&#123;state.type&#125;`]: state.type,</span><br><span class="line">                &#125;&quot;</span><br><span class="line">                :icon=&quot;iconComponent&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">              &#123;&#123; state.title &#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;button</span><br><span class="line">              v-if=&quot;showClose&quot;</span><br><span class="line">              class=&quot;er-message-box__header-btn&quot;</span><br><span class="line">              @click.stop=&quot;handleClose&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;er-icon icon=&quot;xmark&quot; /&gt;</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class=&quot;er-message-box__content&quot;&gt;</span><br><span class="line">            &lt;er-icon</span><br><span class="line">              v-if=&quot;iconComponent &amp;&amp; !state.center &amp;&amp; hasMessage&quot;</span><br><span class="line">              :class=&quot;&#123;</span><br><span class="line">                [`er-icon-$&#123;state.type&#125;`]: state.type,</span><br><span class="line">              &#125;&quot;</span><br><span class="line">              :icon=&quot;iconComponent&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;div v-if=&quot;hasMessage&quot; class=&quot;er-message-box__message&quot;&gt;</span><br><span class="line">              &lt;slot&gt;</span><br><span class="line">                &lt;component</span><br><span class="line">                  :is=&quot;state.showInput ? &#x27;label&#x27; : &#x27;p&#x27;&quot;</span><br><span class="line">                  :for=&quot;state.showInput ? inputId : void 0&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                  &#123;&#123; state.message &#125;&#125;</span><br><span class="line">                &lt;/component&gt;</span><br><span class="line">              &lt;/slot&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div v-show=&quot;state.showInput&quot; class=&quot;er-message-box__input&quot;&gt;</span><br><span class="line">            &lt;er-input</span><br><span class="line">              v-model=&quot;state.inputValue&quot;</span><br><span class="line">              ref=&quot;inputRef&quot;</span><br><span class="line">              :placeholder=&quot;state.inputPlaceholder&quot;</span><br><span class="line">              :type=&quot;state.inputType&quot;</span><br><span class="line">              @keyup.enter=&quot;handleInputEnter&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class=&quot;er-message-box__footer&quot;&gt;</span><br><span class="line">            &lt;er-button</span><br><span class="line">              v-if=&quot;state.showCancelButton&quot;</span><br><span class="line">              class=&quot;er-message-box__footer-btn er-message-box__cancel-btn&quot;</span><br><span class="line">              :type=&quot;state.cancelButtonType&quot;</span><br><span class="line">              :round=&quot;state.roundButton&quot;</span><br><span class="line">              :loading=&quot;state.cancelButtonLoading&quot;</span><br><span class="line">              @click=&quot;handleAction(&#x27;cancel&#x27;)&quot;</span><br><span class="line">              @keydown.prevent.enter=&quot;handleAction(&#x27;cancel&#x27;)&quot;</span><br><span class="line">              &gt;&#123;&#123; state.cancelButtonText &#125;&#125;&lt;/er-button</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;er-button</span><br><span class="line">              v-show=&quot;state.showConfirmButton&quot;</span><br><span class="line">              class=&quot;er-message-box__footer-btn er-message-box__confirm-btn&quot;</span><br><span class="line">              :type=&quot;state.confirmButtonType ?? &#x27;primary&#x27;&quot;</span><br><span class="line">              :round=&quot;state.roundButton&quot;</span><br><span class="line">              :loading=&quot;state.confirmButtonLoading&quot;</span><br><span class="line">              @click=&quot;handleAction(&#x27;confirm&#x27;)&quot;</span><br><span class="line">              @keydown.prevent.enter=&quot;handleAction(&#x27;confirm&#x27;)&quot;</span><br><span class="line">              &gt;&#123;&#123; state.confirmButtonText &#125;&#125;&lt;/er-button</span><br><span class="line">            &gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/er-overlay&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-methods-ts-1"><a href="#├─-methods-ts-1" class="headerlink" title="├─ methods.ts"></a>├─ methods.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  createVNode,</span><br><span class="line">  isVNode,</span><br><span class="line">  ref,</span><br><span class="line">  render,</span><br><span class="line">  nextTick,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">ComponentPublicInstance</span>,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">VNode</span>,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">VNodeProps</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;</span><br><span class="line">  <span class="title class_">MessageBoxAction</span>,</span><br><span class="line">  <span class="title class_">MessageBoxOptions</span>,</span><br><span class="line">  <span class="title class_">MessageBoxData</span>,</span><br><span class="line">  <span class="title class_">MessageBoxCallback</span>,</span><br><span class="line">  <span class="title class_">MessageBoxProps</span>,</span><br><span class="line">  <span class="title class_">IErMessageBox</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MessageBoxConstructor</span> <span class="keyword">from</span> <span class="string">&quot;./MessageBox.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  assign,</span><br><span class="line">  each,</span><br><span class="line">  isFunction,</span><br><span class="line">  isObject,</span><br><span class="line">  isString,</span><br><span class="line">  isUndefined,</span><br><span class="line">  set,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> messageInstanceMap = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;</span><br><span class="line">  <span class="title class_">ComponentPublicInstance</span>&lt;&#123; <span class="attr">doClose</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125;&gt;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span>;</span><br><span class="line">    <span class="attr">callback</span>: <span class="title class_">MessageBoxCallback</span> | <span class="built_in">void</span>;</span><br><span class="line">    <span class="attr">resolve</span>: <span class="function">(<span class="params"><span class="attr">res</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">    <span class="attr">reject</span>: <span class="function">(<span class="params"><span class="attr">res</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initInstance</span>(<span class="params"><span class="attr">props</span>: <span class="title class_">MessageBoxProps</span>, <span class="attr">container</span>: <span class="title class_">HTMLElement</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> isVNodeMsg = <span class="title function_">isFunction</span>(props?.<span class="property">message</span>) || <span class="title function_">isVNode</span>(props?.<span class="property">message</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">genDefaultSlot</span> = (<span class="params"><span class="attr">message</span>: <span class="title class_">VNode</span> | (() =&gt; VNode)</span>) =&gt;</span><br><span class="line">    <span class="title function_">isFunction</span>(message) ? message : <span class="function">() =&gt;</span> message;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> vnode = <span class="title function_">createVNode</span>(</span><br><span class="line">    <span class="title class_">MessageBoxConstructor</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      ...props,</span><br><span class="line">      visible,</span><br><span class="line">    &#125; <span class="keyword">as</span> <span class="title class_">VNodeProps</span>,</span><br><span class="line">    isVNodeMsg ? &#123; <span class="attr">default</span>: <span class="title function_">genDefaultSlot</span>(props.<span class="property">message</span> <span class="keyword">as</span> <span class="title class_">VNode</span>) &#125; : <span class="built_in">void</span> <span class="number">0</span></span><br><span class="line">  );</span><br><span class="line">  <span class="title function_">render</span>(vnode, container);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(container.<span class="property">firstElementChild</span>!);</span><br><span class="line">  <span class="keyword">return</span> vnode.<span class="property">component</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">genContainer</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showMessage</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> container = <span class="title function_">genContainer</span>();</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">props</span>: <span class="title class_">MessageBoxProps</span> = &#123;</span><br><span class="line">    ...options,</span><br><span class="line">    <span class="attr">doClose</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      vm.<span class="property">visible</span>.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">doAction</span>: <span class="function">(<span class="params"><span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>, <span class="attr">inputVal</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> currentMsg = messageInstanceMap.<span class="title function_">get</span>(vm);</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">resolve</span>:</span><br><span class="line">        | <span class="title class_">MessageBoxAction</span></span><br><span class="line">        | &#123; <span class="attr">value</span>: <span class="built_in">string</span>; <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span> &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> vm.<span class="title function_">doClose</span>());</span><br><span class="line">      <span class="keyword">if</span> (options.<span class="property">showInput</span>) &#123;</span><br><span class="line">        resolve = &#123; <span class="attr">value</span>: inputVal, <span class="attr">action</span>: action &#125;;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resolve = action;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (options.<span class="property">callback</span>) &#123;</span><br><span class="line">        options.<span class="title function_">callback</span>(resolve);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (action === <span class="string">&quot;cancel&quot;</span> || action === <span class="string">&quot;close&quot;</span>) &#123;</span><br><span class="line">        currentMsg?.<span class="title function_">reject</span>(action);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      currentMsg?.<span class="title function_">resolve</span>(resolve);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">destroy</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">render</span>(<span class="literal">null</span>, container);</span><br><span class="line">      messageInstanceMap.<span class="title function_">delete</span>(vm);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">initInstance</span>(props <span class="keyword">as</span> <span class="title class_">MessageBoxProps</span>, container);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> vm = instance?.<span class="property">proxy</span> <span class="keyword">as</span> <span class="title class_">ComponentPublicInstance</span>&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line"></span><br><span class="line">  vm.<span class="property">visible</span>.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> vm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">MessageBox</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span></span>): <span class="title class_">Promise</span>&lt;<span class="title class_">MessageBoxData</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MessageBox</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span> | <span class="built_in">string</span> | <span class="title class_">VNode</span></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">callback</span>: <span class="title class_">MessageBoxCallback</span> | <span class="built_in">void</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isString</span>(options) || <span class="title function_">isVNode</span>(options)) &#123;</span><br><span class="line">    options = &#123;</span><br><span class="line">      <span class="attr">message</span>: options,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    callback = options.<span class="property">callback</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="title function_">showMessage</span>(options);</span><br><span class="line">    messageInstanceMap.<span class="title function_">set</span>(vm, &#123; options, callback, resolve, reject &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MESSAGE_BOX_VARIANTS</span> = [<span class="string">&quot;alert&quot;</span>, <span class="string">&quot;confirm&quot;</span>, <span class="string">&quot;prompt&quot;</span>] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">MESSAGE_BOX_DEFAULT_OPTS</span>: <span class="title class_">Record</span>&lt;</span><br><span class="line">  (<span class="keyword">typeof</span> <span class="variable constant_">MESSAGE_BOX_VARIANTS</span>)[<span class="built_in">number</span>],</span><br><span class="line">  <span class="title class_">Partial</span>&lt;<span class="title class_">MessageBoxOptions</span>&gt;</span><br><span class="line">&gt; = &#123;</span><br><span class="line">  <span class="attr">alert</span>: &#123; <span class="attr">closeOnClickModal</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  <span class="attr">confirm</span>: &#123; <span class="attr">showCancelButton</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  <span class="attr">prompt</span>: &#123; <span class="attr">showCancelButton</span>: <span class="literal">true</span>, <span class="attr">showInput</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">each</span>(<span class="variable constant_">MESSAGE_BOX_VARIANTS</span>, <span class="function">(<span class="params"><span class="keyword">type</span></span>) =&gt;</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="title class_">MessageBox</span>, <span class="keyword">type</span>, <span class="title function_">messageBoxFactory</span>(<span class="keyword">type</span>))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">messageBoxFactory</span>(<span class="params"><span class="attr">boxType</span>: (<span class="keyword">typeof</span> MESSAGE_BOX_VARIANTS)[<span class="built_in">number</span>]</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">message</span>: <span class="built_in">string</span> | <span class="title class_">VNode</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">title</span>: <span class="built_in">string</span> | <span class="title class_">MessageBoxOptions</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span></span></span></span><br><span class="line"><span class="params"><span class="function">  </span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> titleOrOpts = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isObject</span>(title)) &#123;</span><br><span class="line">      options = title <span class="keyword">as</span> <span class="title class_">MessageBoxOptions</span>;</span><br><span class="line">      titleOrOpts = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isUndefined</span>(title)) &#123;</span><br><span class="line">      titleOrOpts = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      titleOrOpts = title <span class="keyword">as</span> <span class="built_in">string</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">MessageBox</span>(</span><br><span class="line">      <span class="title function_">assign</span>(</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">title</span>: titleOrOpts,</span><br><span class="line">          message,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          boxType,</span><br><span class="line">          ...<span class="variable constant_">MESSAGE_BOX_DEFAULT_OPTS</span>[boxType],</span><br><span class="line">        &#125;,</span><br><span class="line">        options</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">set</span>(<span class="title class_">MessageBox</span>, <span class="string">&quot;close&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  messageInstanceMap.<span class="title function_">forEach</span>(<span class="function">(<span class="params">_, vm</span>) =&gt;</span> &#123;</span><br><span class="line">    vm.<span class="title function_">doClose</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  messageInstanceMap.<span class="title function_">clear</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MessageBox</span> <span class="keyword">as</span> <span class="title class_">IErMessageBox</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-9"><a href="#├─-style-css-9" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-message-box</span> &#123;</span><br><span class="line">  <span class="attr">--er-message-box-title-color</span>: <span class="built_in">var</span>(--er-text-color-primary);</span><br><span class="line">  <span class="attr">--er-message-box-width</span>: <span class="number">420px</span>;</span><br><span class="line">  <span class="attr">--er-message-box-border-radius</span>: <span class="built_in">var</span>(--er-border-radius-base);</span><br><span class="line">  <span class="attr">--er-message-box-font-size</span>: <span class="built_in">var</span>(--er-font-size-large);</span><br><span class="line">  <span class="attr">--er-message-box-content-font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">  <span class="attr">--er-message-box-content-color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">  <span class="attr">--er-message-box-padding-primary</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attr">--er-message-box-font-line-height</span>: <span class="built_in">var</span>(--er-font-size-medium);</span><br><span class="line">  <span class="attr">--er-message-box-close-size</span>: <span class="built_in">var</span>(--er-message-close-size, <span class="number">16px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-overlay-message-box</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: auto;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-message-box</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">position</span>: relative; </span><br><span class="line">  <span class="attribute">max-width</span>: <span class="built_in">var</span>(--er-message-box-width);</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="built_in">var</span>(--er-message-box-padding-primary);</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-bg-color);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-message-box-border-radius);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-message-box-font-size);</span><br><span class="line">  <span class="attribute">text-align</span>: left;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">backface-visibility</span>: hidden;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">overflow-wrap</span>: break-word;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">    <span class="attribute">outline</span>: none <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &amp;<span class="selector-class">.is-center</span> &#123;</span><br><span class="line">    <span class="selector-class">.er-message-box__title</span> &#123;</span><br><span class="line">      <span class="attribute">display</span>: flex;</span><br><span class="line">      <span class="attribute">align-items</span>: center;</span><br><span class="line">      <span class="attribute">justify-content</span>: center;</span><br><span class="line">      <span class="attribute">gap</span>: <span class="number">6px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.er-message-box__footer</span>,<span class="selector-class">.er-message-box__content</span> &#123;</span><br><span class="line">      <span class="attribute">justify-content</span>: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  :<span class="built_in">deep</span>(.er-icon)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">@each</span> $val in info, success, warning, danger &#123;</span><br><span class="line">      &amp;<span class="selector-class">.er-icon-</span>$(val) &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-$(val))<span class="meta">!important</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.er-icon-error</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-danger)<span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-message-box__header</span> &#123;</span><br><span class="line">    <span class="attribute">padding-bottom</span>: <span class="built_in">var</span>(--er-message-box-padding-primary);</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.er-message-box__title</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-message-box-title-color);</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-message-box-font-size);</span><br><span class="line">      <span class="attribute">line-height</span>: <span class="built_in">var</span>(--er-message-box-font-line-height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.er-message-box__header-btn</span> &#123;</span><br><span class="line">      <span class="attribute">position</span>: absolute;</span><br><span class="line">      <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">border</span>: none;</span><br><span class="line">      <span class="attribute">outline</span>: none;</span><br><span class="line">      <span class="attribute">background</span>: transparent;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-message-box-close-size);</span><br><span class="line">      <span class="attribute">cursor</span>: pointer;</span><br><span class="line"></span><br><span class="line">      <span class="selector-tag">i</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-info);</span><br><span class="line">        <span class="attribute">font-size</span>: inherit; </span><br><span class="line">      &#125;</span><br><span class="line">      &amp;<span class="selector-pseudo">:focus</span>,</span><br><span class="line">      &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">        <span class="selector-tag">i</span> &#123;</span><br><span class="line">          <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-class">.show-close</span> &#123;</span><br><span class="line">      <span class="attribute">padding-right</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--er-message-box-padding-primary) + <span class="built_in">var</span>(--er-message-box-close-size));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-message-box__content</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-message-box-content-font-size);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-message-box-content-color);</span><br><span class="line">    <span class="selector-class">.er-message-box__message</span> &#123;</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">      &amp; <span class="selector-tag">p</span> &#123;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">line-height</span>: <span class="built_in">var</span>(--er-message-box-font-line-height);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-message-box__input</span> &#123;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">12px</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-message-box__footer</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">    <span class="attribute">justify-content</span>: flex-end;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="built_in">var</span>(--er-message-box-padding-primary);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.fade-in-linear-enter-active</span> &#123;</span><br><span class="line">  <span class="selector-class">.er-overlay-message-box</span> &#123;</span><br><span class="line">    <span class="attribute">animation</span>: msgbox-fade-in <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.fade-in-linear-leave-active</span> &#123;</span><br><span class="line">  <span class="selector-class">.er-overlay-message-box</span> &#123;</span><br><span class="line">    <span class="attribute">animation</span>: msgbox-fade-in <span class="built_in">var</span>(--er-transition-duration) reverse;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> msgbox-fade-in &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, -<span class="number">20px</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-10"><a href="#└─-types-ts-10" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Ref</span>, <span class="keyword">type</span> <span class="title class_">VNode</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> messageType &#125; <span class="keyword">from</span> <span class="string">&quot;../Message/types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">ButtonType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../Button/types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxAction</span> = <span class="string">&quot;confirm&quot;</span> | <span class="string">&quot;cancel&quot;</span> | <span class="string">&quot;close&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxType</span> = <span class="string">&quot;&quot;</span> | <span class="string">&quot;prompt&quot;</span> | <span class="string">&quot;alert&quot;</span> | <span class="string">&quot;confirm&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxCallback</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span> | &#123; value: <span class="built_in">string</span>; action: MessageBoxAction &#125;</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxInputData</span> = &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxData</span> = <span class="title class_">MessageBoxInputData</span> &amp; <span class="title class_">MessageBoxAction</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageBoxOptions</span> &#123;</span><br><span class="line">  <span class="attr">title</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">message</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span> | (<span class="function">() =&gt;</span> <span class="title class_">VNode</span>);</span><br><span class="line">  <span class="attr">type</span>?: messageType;</span><br><span class="line">  <span class="attr">boxType</span>?: <span class="title class_">MessageBoxType</span>;</span><br><span class="line">  <span class="attr">icon</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">callback</span>?: <span class="title class_">MessageBoxCallback</span>;</span><br><span class="line">  <span class="attr">showClose</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">showInput</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">showCancelButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">showConfirmButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">cancelButtonText</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">confirmButtonText</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">cancelButtonLoading</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">confirmButtonLoading</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">cancelButtonDisabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">confirmButtonDisabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">cancelButtonType</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">  <span class="attr">confirmButtonType</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">  <span class="attr">roundButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">center</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">lockScroll</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">closeOnClickModal</span>?: <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">inputPlaceholder</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">inputValue</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">inputType</span>?: <span class="string">&quot;text&quot;</span> | <span class="string">&quot;textarea&quot;</span> | <span class="string">&quot;password&quot;</span> | <span class="string">&quot;number&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">buttonSize</span>?: <span class="string">&quot;default&quot;</span> | <span class="string">&quot;small&quot;</span> | <span class="string">&quot;large&quot;</span>;</span><br><span class="line">  <span class="attr">beforeClose</span>?: <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">instance</span>: <span class="title class_">MessageBoxOptions</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">done</span>: () =&gt; <span class="built_in">void</span></span></span></span><br><span class="line"><span class="params"><span class="function">  </span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageBoxProps</span> <span class="keyword">extends</span> <span class="title class_">MessageBoxOptions</span> &#123;</span><br><span class="line">  <span class="attr">visible</span>?: <span class="title class_">Ref</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">  <span class="title function_">doClose</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">doAction</span>(<span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>, <span class="attr">inputVal</span>?: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">destroy</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxShortcutMethod</span> = (<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">message</span>: <span class="title class_">MessageBoxOptions</span>[<span class="string">&quot;message&quot;</span>],</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">title</span>: <span class="title class_">MessageBoxOptions</span>[<span class="string">&quot;title&quot;</span>],</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">options</span>?: <span class="title class_">MessageBoxOptions</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="title class_">MessageBoxData</span>&gt;) &amp;</span><br><span class="line">  (<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">message</span>: <span class="title class_">MessageBoxOptions</span>[<span class="string">&quot;message&quot;</span>],</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">options</span>?: <span class="title class_">MessageBoxOptions</span></span></span></span><br><span class="line"><span class="params"><span class="function">  </span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="title class_">MessageBoxData</span>&gt;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IErMessageBox</span> &#123;</span><br><span class="line">  (<span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span> | <span class="built_in">string</span> | <span class="title class_">VNode</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="attr">alert</span>: <span class="title class_">MessageBoxShortcutMethod</span>;</span><br><span class="line">  <span class="attr">confirm</span>: <span class="title class_">MessageBoxShortcutMethod</span>;</span><br><span class="line">  <span class="attr">prompt</span>: <span class="title class_">MessageBoxShortcutMethod</span>;</span><br><span class="line">  <span class="title function_">close</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-Notification"><a href="#├─-Notification" class="headerlink" title="├─ Notification"></a>├─ Notification</h3><blockquote><p>角落弹出通知框</p></blockquote><h4 id="–API–-10"><a href="#–API–-10" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-index-ts-12"><a href="#├─-index-ts-12" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Notification</span> <span class="keyword">from</span> <span class="string">&quot;./methods&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstallFunction &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErNotification</span> = <span class="title function_">withInstallFunction</span>(</span><br><span class="line">  <span class="title class_">Notification</span>,</span><br><span class="line">  <span class="string">&quot;$notify&quot;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-methods-ts-2"><a href="#├─-methods-ts-2" class="headerlink" title="├─ methods.ts"></a>├─ methods.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;</span><br><span class="line">  <span class="title class_">CreateNotificationProps</span>,</span><br><span class="line">  <span class="title class_">NotificationInstance</span>,</span><br><span class="line">  <span class="title class_">NotificationFn</span>,</span><br><span class="line">  <span class="title class_">Notification</span>,</span><br><span class="line">  <span class="title class_">NotificationParams</span>,</span><br><span class="line">  <span class="title class_">NotificationHandler</span>,</span><br><span class="line">  <span class="title class_">NotificationProps</span>,</span><br><span class="line">  notificationType,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; notificationTypes, notificationPosition &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; shallowReactive, isVNode, render, h &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; each, findIndex, isString, set, get &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useZIndex, useId &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/hooks&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NotificationConstructor</span> <span class="keyword">from</span> <span class="string">&quot;./Notification.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; nextZIndex &#125; = <span class="title function_">useZIndex</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> notificationDefaults = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">  <span class="attr">position</span>: <span class="string">&quot;top-right&quot;</span>,</span><br><span class="line">  <span class="attr">duration</span>: <span class="number">3000</span>,</span><br><span class="line">  <span class="attr">offset</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">transitionName</span>: <span class="string">&quot;fade&quot;</span>,</span><br><span class="line">  <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line">&#125; <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">instancesMap</span>: <span class="title class_">Map</span>&lt;<span class="title class_">NotificationProps</span>[<span class="string">&quot;position&quot;</span>], <span class="title class_">NotificationInstance</span>[]&gt; =</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="title function_">each</span>(notificationPosition, <span class="function">(<span class="params">key</span>) =&gt;</span> instancesMap.<span class="title function_">set</span>(key, <span class="title function_">shallowReactive</span>([])));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getInstancesByPosition = (</span><br><span class="line">  <span class="attr">position</span>: <span class="title class_">NotificationProps</span>[<span class="string">&quot;position&quot;</span>]</span><br><span class="line">): <span class="title class_">NotificationInstance</span>[] =&gt; instancesMap.<span class="title function_">get</span>(position)!;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeOptions</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">options</span>: <span class="title class_">NotificationParams</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">CreateNotificationProps</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result =</span><br><span class="line">    !options || <span class="title function_">isVNode</span>(options) || <span class="title function_">isString</span>(options)</span><br><span class="line">      ? &#123; <span class="attr">message</span>: options &#125;</span><br><span class="line">      : options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; ...notificationDefaults, ...result &#125; <span class="keyword">as</span> <span class="title class_">CreateNotificationProps</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createNotification</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">props</span>: <span class="title class_">CreateNotificationProps</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">NotificationInstance</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> id = <span class="title function_">useId</span>().<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> instances = <span class="title function_">getInstancesByPosition</span>(props.<span class="property">position</span> || <span class="string">&quot;top-right&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">destory</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> idx = <span class="title function_">findIndex</span>(instances, &#123; id &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (idx === -<span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    instances.<span class="title function_">splice</span>(idx, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="literal">null</span>, container);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> _props = &#123;</span><br><span class="line">    ...props,</span><br><span class="line">    id,</span><br><span class="line">    <span class="attr">zIndex</span>: <span class="title function_">nextZIndex</span>(),</span><br><span class="line">    <span class="attr">onDestory</span>: destory,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> vnode = <span class="title function_">h</span>(<span class="title class_">NotificationConstructor</span>, _props);</span><br><span class="line">  <span class="title function_">render</span>(vnode, container);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(container.<span class="property">firstElementChild</span>!);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> vm = vnode.<span class="property">component</span>!;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">handler</span>: <span class="title class_">NotificationHandler</span> = &#123;</span><br><span class="line">    <span class="attr">close</span>: <span class="function">() =&gt;</span> vm.<span class="property">exposed</span>?.<span class="title function_">close</span>(),</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">instance</span>: <span class="title class_">NotificationInstance</span> = &#123;</span><br><span class="line">    <span class="attr">props</span>: _props,</span><br><span class="line">    id,</span><br><span class="line">    vm,</span><br><span class="line">    vnode,</span><br><span class="line">    handler,</span><br><span class="line">  &#125;;</span><br><span class="line">  instances.<span class="title function_">push</span>(instance);</span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">notification</span>: <span class="title class_">NotificationFn</span> &amp; <span class="title class_">Partial</span>&lt;<span class="title class_">Notification</span>&gt; = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  options = &#123;&#125;</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> normalized = <span class="title function_">normalizeOptions</span>(options);</span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">createNotification</span>(normalized);</span><br><span class="line">  <span class="keyword">return</span> instance.<span class="property">handler</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">closeAll</span>(<span class="params"><span class="attr">type</span>?: notificationType</span>) &#123;</span><br><span class="line">  instancesMap.<span class="title function_">forEach</span>(<span class="function">(<span class="params">instances</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">each</span>(instances, <span class="function">(<span class="params">instance</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">type</span>) &#123;</span><br><span class="line">        instance.<span class="property">props</span>.<span class="property">type</span> === <span class="keyword">type</span> &amp;&amp; instance.<span class="property">handler</span>.<span class="title function_">close</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      instance.<span class="property">handler</span>.<span class="title function_">close</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getLastBottomOffset</span>(<span class="params"><span class="attr">this</span>: <span class="title class_">NotificationProps</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> instances = <span class="title function_">getInstancesByPosition</span>(<span class="variable language_">this</span>.<span class="property">position</span> || <span class="string">&quot;top-right&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> idx = <span class="title function_">findIndex</span>(instances, &#123; <span class="attr">id</span>: <span class="variable language_">this</span>.<span class="property">id</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (idx &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">get</span>(instances, [idx - <span class="number">1</span>, <span class="string">&quot;vm&quot;</span>, <span class="string">&quot;exposed&quot;</span>, <span class="string">&quot;bottomOffset&quot;</span>, <span class="string">&quot;value&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">each</span>(notificationTypes, <span class="function">(<span class="params"><span class="keyword">type</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">set</span>(notification, <span class="keyword">type</span>, <span class="function">(<span class="params"><span class="attr">options</span>: <span class="title class_">NotificationParams</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> normalized = <span class="title function_">normalizeOptions</span>(options);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">notification</span>(&#123; ...normalized, <span class="keyword">type</span> &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">notification.<span class="property">closeAll</span> = closeAll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> notification <span class="keyword">as</span> <span class="title class_">Notification</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-Notification-test-tsx"><a href="#├─-Notification-test-tsx" class="headerlink" title="├─ Notification.test.tsx"></a>├─ Notification.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, test, expect &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; nextTick &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; notification, closeAll &#125; <span class="keyword">from</span> <span class="string">&quot;./methods&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">rAF</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">requestAnimationFrame</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="title function_">res</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">nextTick</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTopValue</span>(<span class="params"><span class="attr">element</span>: <span class="title class_">Element</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> styles = <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(element);</span><br><span class="line">  <span class="keyword">const</span> topValue = styles.<span class="title function_">getPropertyValue</span>(<span class="string">&quot;top&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Number</span>.<span class="built_in">parseFloat</span>(topValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;createMessage&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;call notification()&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="title function_">notification</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-notification&quot;</span>)).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    handler.<span class="title function_">close</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.er-notification&quot;</span>)).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&#x27;call notification() more times&#x27;</span>,<span class="title function_">async</span>()=&gt; &#123;</span><br><span class="line">    <span class="title function_">notification</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span> &#125;);</span><br><span class="line">    <span class="title function_">notification</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.er-notification&quot;</span>).<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">2</span>);</span><br><span class="line">    notification.<span class="title function_">closeAll</span>()</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>();</span><br><span class="line">    <span class="title function_">expect</span>(<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.er-notification&quot;</span>).<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&#x27;offset&#x27;</span>,<span class="title function_">async</span>()=&gt;&#123;</span><br><span class="line">    <span class="title function_">notification</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span>,<span class="attr">offset</span>:<span class="number">100</span> &#125;);</span><br><span class="line">    <span class="title function_">notification</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;hello msg&quot;</span>, <span class="attr">duration</span>: <span class="number">0</span>,<span class="attr">offset</span>:<span class="number">50</span> &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">rAF</span>()</span><br><span class="line">    <span class="keyword">const</span> elements = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.er-notification&quot;</span>)</span><br><span class="line">    <span class="title function_">expect</span>(elements.<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">getTopValue</span>(elements[<span class="number">0</span>])).<span class="title function_">toBe</span>(<span class="number">100</span>)</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">getTopValue</span>(elements[<span class="number">1</span>])).<span class="title function_">toBe</span>(<span class="number">150</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="├─-Notification-vue"><a href="#├─-Notification-vue" class="headerlink" title="├─ Notification.vue"></a>├─ Notification.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; NotificationProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; ref, computed, onMounted &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; getLastBottomOffset &#125; from &quot;./methods&quot;;</span><br><span class="line">import &#123; bind, delay, isString &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123; RenderVnode, typeIconMap &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import &#123; useOffset &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line"></span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line"></span><br><span class="line">const props = withDefaults(defineProps&lt;NotificationProps&gt;(), &#123;</span><br><span class="line">  type: &quot;info&quot;,</span><br><span class="line">  duration: 3000,</span><br><span class="line">  offset: 20,</span><br><span class="line">  transitionName: &quot;fade&quot;,</span><br><span class="line">  showClose: true,</span><br><span class="line">&#125;);</span><br><span class="line">const visible = ref(false);</span><br><span class="line">const notifyRef = ref&lt;HTMLDivElement&gt;();</span><br><span class="line"></span><br><span class="line">// 这个 div 的高度</span><br><span class="line">const boxHeight = ref(0);</span><br><span class="line"></span><br><span class="line">const &#123; topOffset, bottomOffset &#125; = useOffset(&#123;</span><br><span class="line">  getLastBottomOffset: bind(getLastBottomOffset, props),</span><br><span class="line">  offset: props.offset,</span><br><span class="line">  boxHeight,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const iconName = computed(() =&gt; &#123;</span><br><span class="line">  if (isString(props.icon)) return props.icon;</span><br><span class="line">  return typeIconMap.get(props.type);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const horizontalClass = computed(() =&gt;</span><br><span class="line">  props.position.endsWith(&quot;right&quot;) ? &quot;right&quot; : &quot;left&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const verticalProperty = computed(() =&gt;</span><br><span class="line">  props.position.startsWith(&quot;top&quot;) ? &quot;top&quot; : &quot;bottom&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const cssStyle = computed(() =&gt; (&#123;</span><br><span class="line">  [verticalProperty.value]: topOffset.value + &quot;px&quot;,</span><br><span class="line">  zIndex: props.zIndex,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">let timer: number;</span><br><span class="line"></span><br><span class="line">function startTimer() &#123;</span><br><span class="line">  if (props.duration === 0) return;</span><br><span class="line">  timer = delay(close, props.duration);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function clearTimer() &#123;</span><br><span class="line">  clearTimeout(timer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function close() &#123;</span><br><span class="line">  visible.value = false;</span><br><span class="line">  props?.onClose?.();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  visible.value = true;</span><br><span class="line">  startTimer();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">defineExpose(&#123;</span><br><span class="line">  close,</span><br><span class="line">  bottomOffset,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition</span><br><span class="line">    :name=&quot;`er-notification-$&#123;transitionName&#125;`&quot;</span><br><span class="line">    @after-leave=&quot;!visible &amp;&amp; onDestory()&quot;</span><br><span class="line">    @enter=&quot;boxHeight = notifyRef!.getBoundingClientRect().height&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      ref=&quot;notifyRef&quot;</span><br><span class="line">      class=&quot;er-notification&quot;</span><br><span class="line">      :class=&quot;&#123;</span><br><span class="line">        [`er-notification--$&#123;type&#125;`]: type,</span><br><span class="line">        &#x27;show-close&#x27;: showClose,</span><br><span class="line">        [horizontalClass]: true,</span><br><span class="line">      &#125;&quot;</span><br><span class="line">      :style=&quot;cssStyle&quot;</span><br><span class="line">      v-show=&quot;visible&quot;</span><br><span class="line">      role=&quot;alert&quot;</span><br><span class="line">      @click=&quot;onClick&quot;</span><br><span class="line">      @mouseenter=&quot;clearTimer&quot;</span><br><span class="line">      @mouseleave=&quot;startTimer&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;er-icon v-if=&quot;iconName&quot; :icon=&quot;iconName&quot; class=&quot;er-notification__icon&quot; /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class=&quot;er-notification__text&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;er-notification__title&quot;&gt;&#123;&#123; title &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;er-notification__content&quot;&gt;</span><br><span class="line">          &lt;slot&gt;</span><br><span class="line">            &lt;render-vnode v-if=&quot;message&quot; :vNode=&quot;message&quot; /&gt;</span><br><span class="line">          &lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;er-notification__close&quot; v-if=&quot;showClose&quot;&gt;</span><br><span class="line">        &lt;er-icon icon=&quot;xmark&quot; @click.stop=&quot;close&quot; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-10"><a href="#├─-style-css-10" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-notification</span> &#123;</span><br><span class="line">  <span class="attr">--er-notification-width</span>: <span class="number">330px</span>;</span><br><span class="line">  <span class="attr">--er-notification-padding</span>: <span class="number">14px</span> <span class="number">26px</span> <span class="number">14px</span> <span class="number">13px</span>;</span><br><span class="line">  <span class="attr">--er-notification-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attr">--er-notification-shadow</span>: <span class="built_in">var</span>(--er-box-shadow-light);</span><br><span class="line">  <span class="attr">--er-notification-border-color</span>: <span class="built_in">var</span>(--er-border-color-lighter);</span><br><span class="line">  <span class="attr">--er-notification-icon-size</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attr">--er-notification-close-font-size</span>: <span class="built_in">var</span>(--er-message-close-size, <span class="number">16px</span>);</span><br><span class="line">  <span class="attr">--er-notification-content-font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">  <span class="attr">--er-notification-content-color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">  <span class="attr">--er-notification-title-font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attr">--er-notification-title-color</span>: <span class="built_in">var</span>(--er-text-color-primary);</span><br><span class="line">  <span class="attr">--er-notification-close-color</span>: <span class="built_in">var</span>(--er-text-color-secondary);</span><br><span class="line">  <span class="attr">--er-notification-close-hover-color</span>: <span class="built_in">var</span>(--er-text-color-regular)</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-notification</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">var</span>(--er-notification-width);</span><br><span class="line">  <span class="attribute">padding</span>: <span class="built_in">var</span>(--er-notification-padding);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-notification-radius);</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-notification-border-color);</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-bg-color-overlay);</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--er-notification-shadow);</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="built_in">var</span>(--er-transition-duration),transform <span class="built_in">var</span>(--er-transition-duration),right <span class="built_in">var</span>(--er-transition-duration),top .<span class="number">4s</span>,bottom <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  <span class="attribute">overflow-wrap</span>: anywhere;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">9999</span>;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-notification__text</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-notification__icon</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="built_in">var</span>(--er-notification-icon-size);</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">var</span>(--er-notification-icon-size);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-notification-icon-size);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-notification-icon-color);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-notification__title</span> &#123;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-notification-title-font-size);</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="built_in">var</span>(--er-notification-icon-size);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-notification-title-color);</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-notification__content</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-notification-content-font-size);</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">24px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">6px</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-notification-content-color);</span><br><span class="line">    <span class="attribute">text-align</span>: justify</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-notification__close</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">18px</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-notification-close-color);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-notification-close-font-size)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@each</span> $val in info,success,warning,danger &#123; </span><br><span class="line">  <span class="selector-class">.er-notification--</span>$(val) &#123;</span><br><span class="line">    <span class="attr">--er-notification-icon-color</span>: <span class="built_in">var</span>(--er-color-$(val));</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--el-notification-icon-color);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-notification--error</span> &#123;</span><br><span class="line">  <span class="attr">--er-notification-icon-color</span>: <span class="built_in">var</span>(--er-color-danger);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--el-notification-icon-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-notification-fade-enter-from</span> &#123;</span><br><span class="line">  &amp;<span class="selector-class">.right</span>&#123;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">100%</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.left</span>&#123;</span><br><span class="line">    <span class="attribute">left</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">100%</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-notification-fade-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-11"><a href="#└─-types-ts-11" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">VNode</span>, <span class="title class_">ComponentInternalInstance</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> notificationTypes = [</span><br><span class="line">  <span class="string">&quot;info&quot;</span>,</span><br><span class="line">  <span class="string">&quot;success&quot;</span>,</span><br><span class="line">  <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">  <span class="string">&quot;danger&quot;</span>,</span><br><span class="line">] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> notificationType = (<span class="keyword">typeof</span> notificationTypes)[<span class="built_in">number</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> notificationPosition = [</span><br><span class="line">  <span class="string">&quot;top-right&quot;</span>,</span><br><span class="line">  <span class="string">&quot;top-left&quot;</span>,</span><br><span class="line">  <span class="string">&quot;bottom-right&quot;</span>,</span><br><span class="line">  <span class="string">&quot;bottom-left&quot;</span>,</span><br><span class="line">] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NotificationPosition</span> = (<span class="keyword">typeof</span> notificationPosition)[<span class="built_in">number</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">NotificationProps</span> &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">zIndex</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">position</span>: <span class="title class_">NotificationPosition</span>;</span><br><span class="line">  <span class="attr">type</span>?: <span class="string">&quot;success&quot;</span> | <span class="string">&quot;info&quot;</span> | <span class="string">&quot;warning&quot;</span> | <span class="string">&quot;danger&quot;</span> | <span class="string">&quot;error&quot;</span>;</span><br><span class="line">  <span class="attr">message</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span>;</span><br><span class="line">  <span class="attr">duration</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">showClose</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">offset</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">transitionName</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">icon</span>?: <span class="built_in">string</span>;</span><br><span class="line">  onClick?(): <span class="built_in">void</span>;</span><br><span class="line">  onClose?(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">onDestory</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">NotificationInstance</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">vnode</span>: <span class="title class_">VNode</span>;</span><br><span class="line">  <span class="attr">vm</span>: <span class="title class_">ComponentInternalInstance</span>;</span><br><span class="line">  <span class="attr">props</span>: <span class="title class_">NotificationProps</span>;</span><br><span class="line">  <span class="attr">handler</span>: <span class="title class_">NotificationHandler</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CreateNotificationProps</span> = <span class="title class_">Omit</span>&lt;</span><br><span class="line">  <span class="title class_">NotificationProps</span>,</span><br><span class="line">  <span class="string">&quot;onDestory&quot;</span> | <span class="string">&quot;id&quot;</span> | <span class="string">&quot;zIndex&quot;</span></span><br><span class="line">&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">NotificationHandler</span> &#123;</span><br><span class="line">  <span class="title function_">close</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NotificationOptions</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">Omit</span>&lt;<span class="title class_">NotificationProps</span>, <span class="string">&quot;id&quot;</span>&gt;&gt;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NotificationParams</span> = <span class="built_in">string</span> | <span class="title class_">VNode</span> | <span class="title class_">NotificationOptions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NotificationFn</span> = &#123;</span><br><span class="line">  (<span class="attr">props</span>: <span class="title class_">NotificationParams</span>): <span class="title class_">NotificationHandler</span>;</span><br><span class="line">  <span class="title function_">closeAll</span>(<span class="attr">type</span>?: notificationType): <span class="built_in">void</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NotificationTypeFn</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">props</span>: <span class="title class_">NotificationParams</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="title class_">NotificationHandler</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Notification</span> <span class="keyword">extends</span> <span class="title class_">NotificationFn</span> &#123;</span><br><span class="line">  <span class="attr">success</span>: <span class="title class_">NotificationTypeFn</span>;</span><br><span class="line">  <span class="attr">warning</span>: <span class="title class_">NotificationTypeFn</span>;</span><br><span class="line">  <span class="attr">info</span>: <span class="title class_">NotificationTypeFn</span>;</span><br><span class="line">  <span class="attr">danger</span>: <span class="title class_">NotificationTypeFn</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-Overlay"><a href="#├─-Overlay" class="headerlink" title="├─ Overlay"></a>├─ Overlay</h3><blockquote><p>遮罩层组件，用于覆盖页面内容</p></blockquote><h4 id="–API–-11"><a href="#–API–-11" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-Overlay-vue"><a href="#├─-Overlay-vue" class="headerlink" title="├─ Overlay.vue"></a>├─ Overlay.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; OverlayProps, OverlayEmits &#125; from &quot;./types&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123; name: &quot;ErOverlay&quot; &#125;);</span><br><span class="line">withDefaults(defineProps&lt;OverlayProps&gt;(), &#123;</span><br><span class="line">  mask: true,</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;OverlayEmits&gt;();</span><br><span class="line"></span><br><span class="line">function onMaskClick(e: MouseEvent) &#123;</span><br><span class="line">  emits(&quot;click&quot;, e);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    v-if=&quot;mask&quot;</span><br><span class="line">    class=&quot;er-overlay&quot;</span><br><span class="line">    :class=&quot;overlayClass&quot;</span><br><span class="line">    :style=&quot;&#123; zIndex: zIndex &#125;&quot;</span><br><span class="line">    @click=&quot;onMaskClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    v-else</span><br><span class="line">    :class=&quot;overlayClass&quot;</span><br><span class="line">    :style=&quot;&#123;</span><br><span class="line">      zIndex: zIndex,</span><br><span class="line">      position: &#x27;fixed&#x27;,</span><br><span class="line">      top: 0,</span><br><span class="line">      left: 0,</span><br><span class="line">      right: 0,</span><br><span class="line">      bottom: 0,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.er-overlay &#123;</span><br><span class="line">  position: fixed;</span><br><span class="line">  top: 0;</span><br><span class="line">  left: 0;</span><br><span class="line">  right: 0;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  height: 100%;</span><br><span class="line">  background-color: rgba(0, 0, 0, 0.5);</span><br><span class="line">  overflow: auto;</span><br><span class="line">  z-index: 2000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-12"><a href="#└─-types-ts-12" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">OverlayProps</span> &#123;</span><br><span class="line">  <span class="attr">mask</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">zIndex</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">overlayClass</span>?: <span class="built_in">string</span> | <span class="built_in">string</span>[] | <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">boolean</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">OverlayEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;click&quot;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-Popconfirm"><a href="#├─-Popconfirm" class="headerlink" title="├─ Popconfirm"></a>├─ Popconfirm</h3><blockquote><p>气泡确认框</p></blockquote><h4 id="–API–-12"><a href="#–API–-12" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-index-ts-13"><a href="#├─-index-ts-13" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Popconfirm</span> <span class="keyword">from</span> <span class="string">&quot;./Popconfirm.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErPopconfirm</span> = <span class="title function_">withInstall</span>(<span class="title class_">Popconfirm</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-Popconfirm-test-tsx"><a href="#├─-Popconfirm-test-tsx" class="headerlink" title="├─ Popconfirm.test.tsx"></a>├─ Popconfirm.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, test, expect, vi, beforeEach &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; each, get &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">PopconfirmProps</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ErPopconfirm</span> &#125; <span class="keyword">from</span> <span class="string">&quot;.&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Popconfirm</span> <span class="keyword">from</span> <span class="string">&quot;./Popconfirm.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> onConfirm = vi.<span class="title function_">fn</span>();</span><br><span class="line"><span class="keyword">const</span> onCancel = vi.<span class="title function_">fn</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Popconfirm/index.ts&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 测试 withInstall 函数是否被正确应用</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should be exported with withInstall()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErPopconfirm</span>.<span class="property">install</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 测试 Popconfirm 组件是否被正确导出</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should be exported Popconfirm component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErPopconfirm</span>).<span class="title function_">toBe</span>(<span class="title class_">Popconfirm</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 可选：测试 withInstall 是否增强了 Popconfirm 组件的功能</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;should enhance Popconfirm component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> enhancedPopconfirm = <span class="title function_">withInstall</span>(<span class="title class_">Popconfirm</span>);</span><br><span class="line">    <span class="title function_">expect</span>(enhancedPopconfirm).<span class="title function_">toBe</span>(<span class="title class_">ErPopconfirm</span>);</span><br><span class="line">    <span class="comment">// 这里可以添加更多测试，确保 withInstall 增强了组件的特定功能</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 可选：如果你的 withInstall 函数有特定的行为或属性，确保它们被正确应用</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;should apply specific enhancements&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span>  enhancedPopconfirm  = <span class="title function_">withInstall</span>(<span class="title class_">Popconfirm</span>);</span><br><span class="line">    <span class="comment">// 例如，如果你的 withInstall 增加了一个特定的方法或属性</span></span><br><span class="line">    <span class="title function_">expect</span>(enhancedPopconfirm).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;install&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试组件是否能够接收所有 props</span></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Popconfirm.vue&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> props = &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;Test Title&quot;</span>,</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&quot;Confirm&quot;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&quot;Cancel&quot;</span>,</span><br><span class="line">    <span class="attr">confirmButtonType</span>: <span class="string">&quot;primary&quot;</span>,</span><br><span class="line">    <span class="attr">cancelButtonType</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&quot;check-circle&quot;</span>,</span><br><span class="line">    <span class="attr">iconColor</span>: <span class="string">&quot;green&quot;</span>,</span><br><span class="line">    <span class="attr">hideIcon</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">hideAfter</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="number">200</span>,</span><br><span class="line">  &#125; <span class="keyword">as</span> <span class="title class_">PopconfirmProps</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    vi.<span class="title function_">useFakeTimers</span>();</span><br><span class="line">    vi.<span class="title function_">clearAllMocks</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should accept all props&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Popconfirm</span>, &#123;</span><br><span class="line">      props,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查 props 是否被正确设置</span></span><br><span class="line">    <span class="title function_">each</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(props), <span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">get</span>(wrapper.<span class="title function_">props</span>(), key)).<span class="title function_">toBe</span>(<span class="title function_">get</span>(props, key));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 测试插槽内容</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should renders slot content correctly&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> slotContent = <span class="string">&quot;Slot Content&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Popconfirm</span>, &#123;</span><br><span class="line">      props,</span><br><span class="line">      <span class="attr">slots</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: slotContent,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">text</span>()).<span class="title function_">toContain</span>(slotContent);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;popconfirm emits&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="function">() =&gt;</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;outside&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Popconfirm</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">title</span>=<span class="string">&quot;Test Title&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">hideIcon</span>=<span class="string">&#123;true&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onConfirm</span>=<span class="string">&#123;onConfirm&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onCancel</span>=<span class="string">&#123;onCancel&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;trigger&quot;</span>&gt;</span>trigger<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Popconfirm</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    ));</span><br><span class="line">    <span class="keyword">const</span> triggerArea = wrapper.<span class="title function_">find</span>(<span class="string">&quot;#trigger&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(triggerArea.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 弹出层是否出现</span></span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-popconfirm&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="keyword">const</span> confirmButton = wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-popconfirm__confirm&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(confirmButton.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">    confirmButton.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-popconfirm&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onConfirm).<span class="title function_">toBeCalled</span>();</span><br><span class="line"></span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-popconfirm&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="keyword">const</span> cancelButton = wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-popconfirm__cancel&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(cancelButton.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    cancelButton.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-popconfirm&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onCancel).<span class="title function_">toBeCalled</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="├─-Popconfirm-vue"><a href="#├─-Popconfirm-vue" class="headerlink" title="├─ Popconfirm.vue"></a>├─ Popconfirm.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; ref, computed &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; addUnit &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import type &#123; PopconfirmProps, PopconfirmEmits &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; useLocale &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import type &#123; TooltipInstance &#125; from &quot;../Tooltip&quot;;</span><br><span class="line"></span><br><span class="line">import ErButton from &quot;../Button/Button.vue&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line">import ErTooltip from &quot;../Tooltip/Tooltip.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErPopconfirm&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const props = withDefaults(defineProps&lt;PopconfirmProps&gt;(), &#123;</span><br><span class="line">  title: &quot;&quot;,</span><br><span class="line">  confirmButtonType: &quot;primary&quot;,</span><br><span class="line">  icon: &quot;question-circle&quot;,</span><br><span class="line">  iconColor: &quot;#f90&quot;,</span><br><span class="line">  hideAfter: 200,</span><br><span class="line">  width: 150,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const emits = defineEmits&lt;PopconfirmEmits&gt;();</span><br><span class="line">const tooltipRef = ref&lt;TooltipInstance&gt;();</span><br><span class="line">const style = computed(() =&gt; (&#123; width: addUnit(props.width) &#125;));</span><br><span class="line"></span><br><span class="line">const &#123; t &#125; = useLocale();</span><br><span class="line"></span><br><span class="line">function hidePopper() &#123;</span><br><span class="line">  tooltipRef.value?.hide();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function confirm(e: MouseEvent) &#123;</span><br><span class="line">  emits(&quot;confirm&quot;, e);</span><br><span class="line">  hidePopper();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function cancel(e: MouseEvent) &#123;</span><br><span class="line">  emits(&quot;cancel&quot;, e);</span><br><span class="line">  hidePopper();</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;er-tooltip ref=&quot;tooltipRef&quot; trigger=&quot;click&quot; :hide-timeout=&quot;hideAfter&quot;&gt;</span><br><span class="line">    &lt;template #content&gt;</span><br><span class="line">      &lt;div class=&quot;er-popconfirm&quot; :style=&quot;style&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;er-popconfirm__main&quot;&gt;</span><br><span class="line">          &lt;er-icon v-if=&quot;!hideIcon &amp;&amp; icon&quot; :icon=&quot;icon&quot; :color=&quot;iconColor&quot; /&gt;</span><br><span class="line">          &#123;&#123; title &#125;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;er-popconfirm__action&quot;&gt;</span><br><span class="line">          &lt;er-button</span><br><span class="line">            size=&quot;small&quot;</span><br><span class="line">            class=&quot;er-popconfirm__cancel&quot;</span><br><span class="line">            :type=&quot;cancelButtonType&quot;</span><br><span class="line">            @click=&quot;cancel&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &#123;&#123; cancelButtonText || t(&quot;popconfirm.cancelButtonText&quot;) &#125;&#125;</span><br><span class="line">          &lt;/er-button&gt;</span><br><span class="line">          &lt;er-button</span><br><span class="line">            size=&quot;small&quot;</span><br><span class="line">            class=&quot;er-popconfirm__confirm&quot;</span><br><span class="line">            :type=&quot;confirmButtonType&quot;</span><br><span class="line">            @click=&quot;confirm&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &#123;&#123; confirmButtonText || t(&quot;popconfirm.confirmButtonText&quot;) &#125;&#125;</span><br><span class="line">          &lt;/er-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;template v-if=&quot;$slots.default&quot; #default&gt;</span><br><span class="line">      &lt;slot name=&quot;default&quot;&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;template v-if=&quot;$slots.reference&quot; #default&gt;</span><br><span class="line">      &lt;slot name=&quot;reference&quot;&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/er-tooltip&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-11"><a href="#├─-style-css-11" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-popconfirm</span> &#123;</span><br><span class="line">  <span class="selector-class">.er-popconfirm__main</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="selector-tag">i</span> &#123;</span><br><span class="line">      <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-popconfirm__action</span> &#123;</span><br><span class="line">    <span class="attribute">text-align</span>: right;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">8px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-13"><a href="#└─-types-ts-13" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ButtonType</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../Button&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">PopconfirmProps</span> &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">confirmButtonText</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">cancelButtonText</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">confirmButtonType</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">  <span class="attr">cancelButtonType</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">  <span class="attr">icon</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">iconColor</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">hideIcon</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">hideAfter</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">width</span>?: <span class="built_in">number</span> | <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">PopconfirmEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;confirm&quot;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;cancel&quot;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-Select"><a href="#├─-Select" class="headerlink" title="├─ Select"></a>├─ Select</h3><blockquote><p>下拉选择框组件，用于从一组选项中选择一个或多个值</p></blockquote><h4 id="–API–-13"><a href="#–API–-13" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-constants-ts-5"><a href="#├─-constants-ts-5" class="headerlink" title="├─ constants.ts"></a>├─ constants.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">SelectContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">SELECT_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">SelectContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;selectContext&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">POPPER_OPTIONS</span>: <span class="built_in">any</span> = &#123;</span><br><span class="line">  <span class="attr">modifiers</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;offset&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">offset</span>: [<span class="number">0</span>, <span class="number">9</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;sameWidth&quot;</span>,</span><br><span class="line">      <span class="attr">enabled</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">fn</span>: <span class="function">(<span class="params">&#123; state &#125;: &#123; state: <span class="built_in">any</span> &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        state.<span class="property">styles</span>.<span class="property">popper</span>.<span class="property">width</span> = <span class="string">`<span class="subst">$&#123;state.rects.reference.width&#125;</span>px`</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">phase</span>: <span class="string">&quot;beforeWrite&quot;</span>,</span><br><span class="line">      <span class="attr">requires</span>: [<span class="string">&quot;computeStyles&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125; <span class="keyword">as</span> <span class="keyword">const</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-index-ts-14"><a href="#├─-index-ts-14" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Select</span> <span class="keyword">from</span> <span class="string">&quot;./Select.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Option</span> <span class="keyword">from</span> <span class="string">&quot;./Option.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErSelect</span> = <span class="title function_">withInstall</span>(<span class="title class_">Select</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErOption</span> = <span class="title function_">withInstall</span>(<span class="title class_">Option</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-Option-vue"><a href="#├─-Option-vue" class="headerlink" title="├─ Option.vue"></a>├─ Option.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; SelectOptionProps &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; SELECT_CTX_KEY &#125; from &quot;./constants&quot;;</span><br><span class="line">import &#123; get, eq, every &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123; computed, inject &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; RenderVnode &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErOption&quot;,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;SelectOptionProps&gt;(), &#123;</span><br><span class="line">  disabled: false,</span><br><span class="line">&#125;);</span><br><span class="line">const ctx = inject(SELECT_CTX_KEY);</span><br><span class="line">const selected = computed(</span><br><span class="line">  () =&gt; ctx?.selectStates?.selectedOption?.value === props.value</span><br><span class="line">);</span><br><span class="line">const isHighlighted = computed(() =&gt;</span><br><span class="line">  every([&quot;label&quot;, &quot;value&quot;], (key) =&gt;</span><br><span class="line">    eq(get(ctx, [&quot;highlightedLine&quot;, &quot;value&quot;, key]), get(props, key))</span><br><span class="line">  )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">function handleClick() &#123;</span><br><span class="line">  if (props.disabled) return;</span><br><span class="line">  ctx?.handleSelect(props);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;li</span><br><span class="line">    class=&quot;er-select__menu-item&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">      &#x27;is-selected&#x27;: selected,</span><br><span class="line">      &#x27;is-highlighted&#x27;: isHighlighted,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">    :id=&quot;`select-item-$&#123;value&#125;`&quot;</span><br><span class="line">    @click.stop=&quot;handleClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;slot&gt;</span><br><span class="line">      &lt;render-vnode</span><br><span class="line">        :vNode=&quot;ctx?.renderLabel ? ctx?.renderLabel(props) : label&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/slot&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-Select-vue"><a href="#├─-Select-vue" class="headerlink" title="├─ Select.vue"></a>├─ Select.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;</span><br><span class="line">  assign,</span><br><span class="line">  find,</span><br><span class="line">  get,</span><br><span class="line">  each,</span><br><span class="line">  noop,</span><br><span class="line">  isFunction,</span><br><span class="line">  filter,</span><br><span class="line">  isNil,</span><br><span class="line">  isBoolean,</span><br><span class="line">  includes,</span><br><span class="line">  map,</span><br><span class="line">  size,</span><br><span class="line">  eq,</span><br><span class="line">  debounce,</span><br><span class="line">&#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123;</span><br><span class="line">  ref,</span><br><span class="line">  reactive,</span><br><span class="line">  computed,</span><br><span class="line">  onMounted,</span><br><span class="line">  provide,</span><br><span class="line">  useSlots,</span><br><span class="line">  watch,</span><br><span class="line">  h,</span><br><span class="line">  nextTick,</span><br><span class="line">  type Ref,</span><br><span class="line">  type VNode,</span><br><span class="line">&#125; from &quot;vue&quot;;</span><br><span class="line">import type &#123;</span><br><span class="line">  SelectProps,</span><br><span class="line">  SelectEmits,</span><br><span class="line">  SelectOptionProps,</span><br><span class="line">  SelectContext,</span><br><span class="line">  SelectInstance,</span><br><span class="line">  SelectStates,</span><br><span class="line">&#125; from &quot;./types&quot;;</span><br><span class="line">import type &#123; TooltipInstance &#125; from &quot;../Tooltip/types&quot;;</span><br><span class="line">import type &#123; InputInstance &#125; from &quot;../Input/types&quot;;</span><br><span class="line">import &#123; RenderVnode, debugWarn &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import &#123; useFocusController, useClickOutside &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import &#123; SELECT_CTX_KEY, POPPER_OPTIONS &#125; from &quot;./constants&quot;;</span><br><span class="line">import &#123; useFormItem, useFormDisabled, useFormItemInputId &#125; from &quot;../Form&quot;;</span><br><span class="line"></span><br><span class="line">import useKeyMap from &quot;./useKeyMap&quot;;</span><br><span class="line">import ErTooltip from &quot;../Tooltip/Tooltip.vue&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line">import ErInput from &quot;../Input/Input.vue&quot;;</span><br><span class="line">import ErOption from &quot;./Option.vue&quot;;</span><br><span class="line"></span><br><span class="line">const COMPONENT_NAME = &quot;ErSelect&quot; as const;</span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: COMPONENT_NAME,</span><br><span class="line">&#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;SelectProps&gt;(), &#123;</span><br><span class="line">  options: () =&gt; [],</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;SelectEmits&gt;();</span><br><span class="line"></span><br><span class="line">const initialOption = findOption(props.modelValue);</span><br><span class="line"></span><br><span class="line">const selectRef = ref&lt;HTMLElement&gt;();</span><br><span class="line">const tooltipRef = ref&lt;TooltipInstance&gt;();</span><br><span class="line">const inputRef = ref&lt;InputInstance&gt;();</span><br><span class="line"></span><br><span class="line">const isDropdownVisible = ref(false);</span><br><span class="line">const filteredOptions = ref(props.options ?? []);</span><br><span class="line">const filteredChilds: Ref&lt;Map&lt;VNode, SelectOptionProps&gt;&gt; = ref(new Map());</span><br><span class="line"></span><br><span class="line">const selectStates = reactive&lt;SelectStates&gt;(&#123;</span><br><span class="line">  inputValue: initialOption?.label ?? &quot;&quot;,</span><br><span class="line">  selectedOption: initialOption,</span><br><span class="line">  mouseHover: false,</span><br><span class="line">  loading: false,</span><br><span class="line">  highlightedIndex: -1,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const slots = useSlots();</span><br><span class="line">const isDisabled = useFormDisabled();</span><br><span class="line">const &#123; formItem &#125; = useFormItem();</span><br><span class="line">const &#123; inputId &#125; = useFormItemInputId(props, formItem);</span><br><span class="line">const &#123;</span><br><span class="line">  wrapperRef: inputWrapperRef,</span><br><span class="line">  isFocused,</span><br><span class="line">  handleBlur,</span><br><span class="line">  handleFocus,</span><br><span class="line">&#125; = useFocusController(inputRef);</span><br><span class="line"></span><br><span class="line">useClickOutside(selectRef, (e) =&gt; handleClickOutsie(e));</span><br><span class="line"></span><br><span class="line">const highlightedLine = computed(() =&gt; &#123;</span><br><span class="line">  let result: SelectOptionProps | void;</span><br><span class="line">  if (hasChildren.value) &#123;</span><br><span class="line">    const node = [...filteredChilds.value][selectStates.highlightedIndex]?.[0];</span><br><span class="line">    result = filteredChilds.value.get(node);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    result = filteredOptions.value[selectStates.highlightedIndex];</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const children = computed(() =&gt;</span><br><span class="line">  filter(slots?.default?.(), (child) =&gt; eq(child.type, ErOption))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const hasChildren = computed(() =&gt; size(children.value) &gt; 0);</span><br><span class="line">const childrenOptsions = computed(() =&gt; &#123;</span><br><span class="line">  if (!hasChildren.value) return [];</span><br><span class="line">  return map(children.value, (item) =&gt; (&#123;</span><br><span class="line">    vNode: h(item),</span><br><span class="line">    props: assign(item.props, &#123;</span><br><span class="line">      disabled:</span><br><span class="line">        item.props?.disabled === true ||</span><br><span class="line">        (!isNil(item.props?.disabled) &amp;&amp; !isBoolean(item.props?.disabled)),</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const filterPlaceholder = computed(() =&gt; &#123;</span><br><span class="line">  return props.filterable &amp;&amp;</span><br><span class="line">    selectStates.selectedOption &amp;&amp;</span><br><span class="line">    isDropdownVisible.value</span><br><span class="line">    ? selectStates.selectedOption.label</span><br><span class="line">    : props.placeholder;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const timeout = computed(() =&gt; (props.remote ? 300 : 0));</span><br><span class="line"></span><br><span class="line">const hasData = computed(</span><br><span class="line">  () =&gt;</span><br><span class="line">    (hasChildren.value &amp;&amp; filteredChilds.value.size &gt; 0) ||</span><br><span class="line">    (!hasChildren.value &amp;&amp; size(filteredOptions.value) &gt; 0)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const isNoData = computed(() =&gt; &#123;</span><br><span class="line">  if (!props.filterable) return false;</span><br><span class="line">  if (!hasData.value) return true;</span><br><span class="line">  return false;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const lastIndex = computed(() =&gt;</span><br><span class="line">  hasChildren.value</span><br><span class="line">    ? filteredChilds.value.size - 1</span><br><span class="line">    : size(filteredOptions.value) - 1</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const showClear = computed(</span><br><span class="line">  () =&gt;</span><br><span class="line">    props.clearable &amp;&amp; selectStates.mouseHover &amp;&amp; selectStates.inputValue !== &quot;&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const handleFilterDebounce = debounce(handleFilter, timeout.value);</span><br><span class="line"></span><br><span class="line">const keyMap = useKeyMap(&#123;</span><br><span class="line">  isDropdownVisible,</span><br><span class="line">  controlVisible,</span><br><span class="line">  selectStates,</span><br><span class="line">  highlightedLine,</span><br><span class="line">  handleSelect,</span><br><span class="line">  hasData,</span><br><span class="line">  lastIndex,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const focus: SelectInstance[&quot;focus&quot;] = function () &#123;</span><br><span class="line">  inputRef.value?.focus();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const blur: SelectInstance[&quot;blur&quot;] = function () &#123;</span><br><span class="line">  handleClickOutsie();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function setFilteredChilds(opts: typeof childrenOptsions.value) &#123;</span><br><span class="line">  filteredChilds.value.clear();</span><br><span class="line">  each(opts, (item) =&gt; &#123;</span><br><span class="line">    filteredChilds.value.set(item.vNode, item.props as SelectOptionProps);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function renderLabel(opt: SelectOptionProps): VNode | string &#123;</span><br><span class="line">  if (isFunction(props.renderLabel)) &#123;</span><br><span class="line">    return props.renderLabel(opt);</span><br><span class="line">  &#125;</span><br><span class="line">  return opt.label;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function controlVisible(visible: boolean) &#123;</span><br><span class="line">  if (!tooltipRef.value) return;</span><br><span class="line">  get(tooltipRef, [&quot;value&quot;, visible ? &quot;show&quot; : &quot;hide&quot;])?.();</span><br><span class="line">  props.filterable &amp;&amp; controlInputVal(visible);</span><br><span class="line">  isDropdownVisible.value = visible;</span><br><span class="line">  emits(&quot;visible-change&quot;, visible);</span><br><span class="line"></span><br><span class="line">  selectStates.highlightedIndex = -1;</span><br><span class="line">&#125;</span><br><span class="line">function controlInputVal(visible: boolean) &#123;</span><br><span class="line">  if (!props.filterable) return;</span><br><span class="line">  if (visible) &#123;</span><br><span class="line">    if (selectStates.selectedOption) selectStates.inputValue = &quot;&quot;;</span><br><span class="line">    handleFilterDebounce();</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    selectStates.inputValue = selectStates.selectedOption?.label || &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">function toggleVisible() &#123;</span><br><span class="line">  if (isDisabled.value) return;</span><br><span class="line">  controlVisible(!isDropdownVisible.value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function findOption(value: string) &#123;</span><br><span class="line">  return find(props.options, (option) =&gt; option.value === value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleClickOutsie(e?: Event) &#123;</span><br><span class="line">  if (isFocused.value) &#123;</span><br><span class="line">    nextTick(() =&gt; handleBlur(new FocusEvent(&quot;focus&quot;, e)));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleSelect(o: SelectOptionProps) &#123;</span><br><span class="line">  if (o.disabled) return;</span><br><span class="line"></span><br><span class="line">  selectStates.inputValue = o.label;</span><br><span class="line">  selectStates.selectedOption = o;</span><br><span class="line">  each([&quot;change&quot;, &quot;update:modelValue&quot;], (k) =&gt; emits(k as any, o.value));</span><br><span class="line">  controlVisible(false);</span><br><span class="line">  inputRef.value?.focus();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function setSelected() &#123;</span><br><span class="line">  const option = findOption(props.modelValue);</span><br><span class="line">  if (!option) return;</span><br><span class="line">  selectStates.inputValue = option.label;</span><br><span class="line">  selectStates.selectedOption = option;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleClear() &#123;</span><br><span class="line">  inputRef.value?.clear();</span><br><span class="line">  selectStates.inputValue = &quot;&quot;;</span><br><span class="line">  selectStates.selectedOption = null;</span><br><span class="line"></span><br><span class="line">  emits(&quot;clear&quot;);</span><br><span class="line">  each([&quot;change&quot;, &quot;update:modelValue&quot;], (k) =&gt; emits(k as any, &quot;&quot;));</span><br><span class="line">  formItem?.clearValidate();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function callRemoteMethod(method: Function, search: string) &#123;</span><br><span class="line">  if (!method || !isFunction(method)) return;</span><br><span class="line"></span><br><span class="line">  selectStates.loading = true;</span><br><span class="line">  let result;</span><br><span class="line">  try &#123;</span><br><span class="line">    result = await method(search);</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    debugWarn(error as Error);</span><br><span class="line">    debugWarn(COMPONENT_NAME, &quot;callRemoteMethod error&quot;);</span><br><span class="line">    result = [];</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    selectStates.loading = false;</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function genFilterOptions(search: string) &#123;</span><br><span class="line">  if (!props.filterable) return;</span><br><span class="line"></span><br><span class="line">  if (props.remote &amp;&amp; props.remoteMethod &amp;&amp; isFunction(props.remoteMethod)) &#123;</span><br><span class="line">    filteredOptions.value = await callRemoteMethod(props.remoteMethod, search);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (props.filterMethod &amp;&amp; isFunction(props.filterMethod)) &#123;</span><br><span class="line">    filteredOptions.value = props.filterMethod(search);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  filteredOptions.value = filter(props.options, (opt) =&gt;</span><br><span class="line">    includes(opt.label, search)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function genFilterChilds(search: string) &#123;</span><br><span class="line">  if (!props.filterable) return;</span><br><span class="line"></span><br><span class="line">  if (props.remote &amp;&amp; props.remoteMethod &amp;&amp; isFunction(props.remoteMethod)) &#123;</span><br><span class="line">    await callRemoteMethod(props.remoteMethod, search);</span><br><span class="line">    setFilteredChilds(childrenOptsions.value);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  if (props.filterMethod &amp;&amp; isFunction(props.filterMethod)) &#123;</span><br><span class="line">    const options = map(props.filterMethod(search), &quot;value&quot;);</span><br><span class="line">    setFilteredChilds(</span><br><span class="line">      filter(childrenOptsions.value, (item) =&gt;</span><br><span class="line">        includes(options, get(item, [&quot;props&quot;, &quot;value&quot;]))</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  setFilteredChilds(</span><br><span class="line">    filter(childrenOptsions.value, (item) =&gt;</span><br><span class="line">      includes(get(item, [&quot;props&quot;, &quot;label&quot;]), search)</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleFilter() &#123;</span><br><span class="line">  const searchKey = selectStates.inputValue;</span><br><span class="line">  selectStates.highlightedIndex = -1;</span><br><span class="line"></span><br><span class="line">  if (hasChildren.value) &#123;</span><br><span class="line">    genFilterChilds(searchKey);</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  genFilterOptions(searchKey);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleKeyDown(e: KeyboardEvent) &#123;</span><br><span class="line">  keyMap.has(e.key) &amp;&amp; keyMap.get(e.key)?.(e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.options,</span><br><span class="line">  (newOpts) =&gt; &#123;</span><br><span class="line">    filteredOptions.value = newOpts ?? [];</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; childrenOptsions.value,</span><br><span class="line">  (newOpts) =&gt; setFilteredChilds(newOpts),</span><br><span class="line">  &#123; immediate: true &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.modelValue,</span><br><span class="line">  (newVal, oldVal) =&gt; &#123;</span><br><span class="line">    if (newVal !== oldVal) &#123;</span><br><span class="line">      formItem?.validate(&quot;change&quot;).catch((err) =&gt; debugWarn(err));</span><br><span class="line">    &#125;</span><br><span class="line">    setSelected();</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  setSelected();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">provide&lt;SelectContext&gt;(SELECT_CTX_KEY, &#123;</span><br><span class="line">  handleSelect,</span><br><span class="line">  selectStates,</span><br><span class="line">  renderLabel,</span><br><span class="line">  highlightedLine,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;SelectInstance&gt;(&#123;</span><br><span class="line">  focus,</span><br><span class="line">  blur,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    ref=&quot;selectRef&quot;</span><br><span class="line">    class=&quot;er-select&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      &#x27;is-disabled&#x27;: isDisabled,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">    @click.stop=&quot;toggleVisible&quot;</span><br><span class="line">    @mouseenter=&quot;selectStates.mouseHover = true&quot;</span><br><span class="line">    @mouseleave=&quot;selectStates.mouseHover = false&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;er-tooltip</span><br><span class="line">      ref=&quot;tooltipRef&quot;</span><br><span class="line">      placement=&quot;bottom-start&quot;</span><br><span class="line">      :popper-options=&quot;POPPER_OPTIONS&quot;</span><br><span class="line">      @click-outside=&quot;controlVisible(false)&quot;</span><br><span class="line">      manual</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template #default&gt;</span><br><span class="line">        &lt;div ref=&quot;inputWrapperRef&quot;&gt;</span><br><span class="line">          &lt;er-input</span><br><span class="line">            ref=&quot;inputRef&quot;</span><br><span class="line">            v-model=&quot;selectStates.inputValue&quot;</span><br><span class="line">            :id=&quot;inputId&quot;</span><br><span class="line">            :disabled=&quot;isDisabled&quot;</span><br><span class="line">            :placeholder=&quot;filterable ? filterPlaceholder : placeholder&quot;</span><br><span class="line">            :readonly=&quot;!filterable || !isDropdownVisible&quot;</span><br><span class="line">            @focus=&quot;handleFocus&quot;</span><br><span class="line">            @blur=&quot;handleBlur&quot;</span><br><span class="line">            @input=&quot;handleFilterDebounce&quot;</span><br><span class="line">            @keydown=&quot;handleKeyDown&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;template #suffix&gt;</span><br><span class="line">              &lt;er-icon</span><br><span class="line">                v-if=&quot;showClear&quot;</span><br><span class="line">                icon=&quot;circle-xmark&quot;</span><br><span class="line">                class=&quot;er-input__clear&quot;</span><br><span class="line">                @click.stop=&quot;handleClear&quot;</span><br><span class="line">                @mousedown.prevent=&quot;noop&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">              &lt;er-icon</span><br><span class="line">                v-else</span><br><span class="line">                class=&quot;header-angle&quot;</span><br><span class="line">                icon=&quot;angle-down&quot;</span><br><span class="line">                :class=&quot;&#123; &#x27;is-active&#x27;: isDropdownVisible &#125;&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/er-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">      &lt;template #content&gt;</span><br><span class="line">        &lt;div class=&quot;er-select__loading&quot; v-if=&quot;selectStates.loading&quot;&gt;</span><br><span class="line">          &lt;er-icon icon=&quot;spinner&quot; spin /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;er-select__nodata&quot; v-else-if=&quot;filterable &amp;&amp; isNoData&quot;&gt;</span><br><span class="line">          No data</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;ul class=&quot;er-select__menu&quot; v-else&gt;</span><br><span class="line">          &lt;template v-if=&quot;!hasChildren&quot;&gt;</span><br><span class="line">            &lt;er-option</span><br><span class="line">              v-for=&quot;item in filteredOptions&quot;</span><br><span class="line">              :key=&quot;item.value&quot;</span><br><span class="line">              v-bind=&quot;item&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">          &lt;template v-else&gt;</span><br><span class="line">            &lt;template</span><br><span class="line">              v-for=&quot;[vNode, _props] in filteredChilds&quot;</span><br><span class="line">              :key=&quot;_props.value&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;render-vnode :vNode=&quot;vNode&quot; /&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/er-tooltip&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-12"><a href="#├─-style-css-12" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-select</span> &#123;</span><br><span class="line">  <span class="attr">--er-select-item-hover-bg-color</span>: <span class="built_in">var</span>(--er-fill-color-light);</span><br><span class="line">  <span class="attr">--er-select-item-font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">  <span class="attr">--er-select-item-font-color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">  <span class="attr">--er-select-item-selected-font-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">  <span class="attr">--er-select-item-disabled-font-color</span>: <span class="built_in">var</span>(--er-text-color-placeholder);</span><br><span class="line">  <span class="attr">--er-select-input-focus-border-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-select</span>&#123;</span><br><span class="line"> <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">32px</span>;</span><br><span class="line">  :<span class="built_in">deep</span>(.er-tooltip__popper) &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  :<span class="built_in">deep</span>(.er-input)&#123;</span><br><span class="line">    <span class="selector-class">.header-angle</span> &#123;</span><br><span class="line">      <span class="attribute">transition</span>: transform <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">      &amp;<span class="selector-class">.is-active</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">180deg</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-select__nodata</span>, <span class="selector-class">.er-select__loading</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-text-color-secondary);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-select-font-size);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-select__menu</span> &#123;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">6px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-select__menu-item</span> &#123; </span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-select-item-font-size);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">32px</span> <span class="number">0</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-select-item-font-color);</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">34px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">34px</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-select-item-hover-bg-color);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.is-selected</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-select-item-selected-font-color);</span><br><span class="line">      <span class="attribute">font-weight</span>: <span class="number">700</span>;    </span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.is-highlighted</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-select-item-hover-bg-color);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-class">.is-disabled</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-select-item-disabled-font-color);</span><br><span class="line">      <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">      &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">        <span class="attribute">background-color</span>: transparent;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  :<span class="built_in">deep</span>(.er-input__inner) &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="├─-types-ts"><a href="#├─-types-ts" class="headerlink" title="├─ types.ts"></a>├─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">VNode</span>, <span class="title class_">ComputedRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">RenderLabelFunc</span> = <span class="function">(<span class="params"><span class="attr">option</span>: <span class="title class_">SelectOptionProps</span></span>) =&gt;</span> <span class="title class_">VNode</span> | <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CustomFilterFunc</span> = <span class="function">(<span class="params"><span class="attr">value</span>: <span class="built_in">string</span></span>) =&gt;</span> <span class="title class_">SelectOptionProps</span>[];</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CustomFilterRemoteFunc</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">value</span>: <span class="built_in">string</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="title class_">SelectOptionProps</span>[] | <span class="built_in">void</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SelectOptionProps</span> &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">label</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SelectProps</span> &#123;</span><br><span class="line">  <span class="attr">modelValue</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">id</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">options</span>?: <span class="title class_">SelectOptionProps</span>[];</span><br><span class="line">  <span class="attr">placeholder</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">clearable</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">renderLabel</span>?: <span class="title class_">RenderLabelFunc</span>;</span><br><span class="line">  <span class="attr">filterable</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">filterMethod</span>?: <span class="title class_">CustomFilterFunc</span>;</span><br><span class="line">  <span class="attr">remote</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">remoteMethod</span>?: <span class="title class_">CustomFilterRemoteFunc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SelectStates</span> &#123;</span><br><span class="line">  <span class="attr">inputValue</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">selectedOption</span>: <span class="title class_">SelectOptionProps</span> | <span class="built_in">void</span> | <span class="literal">null</span>;</span><br><span class="line">  <span class="attr">mouseHover</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">loading</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">highlightedIndex</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SelectEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;update:modelValue&quot;</span>, <span class="attr">value</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;change&quot;</span>, <span class="attr">value</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;visible-change&quot;</span>, <span class="attr">vlaue</span>: <span class="built_in">boolean</span>): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;clear&quot;</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;focus&quot;</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;blur&quot;</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SelectContext</span> &#123;</span><br><span class="line">  <span class="attr">selectStates</span>: <span class="title class_">SelectStates</span>;</span><br><span class="line">  <span class="attr">renderLabel</span>?: <span class="title class_">RenderLabelFunc</span>;</span><br><span class="line">  <span class="attr">highlightedLine</span>?: <span class="title class_">ComputedRef</span>&lt;<span class="title class_">SelectOptionProps</span> | <span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="title function_">handleSelect</span>(<span class="attr">item</span>: <span class="title class_">SelectOptionProps</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SelectInstance</span> &#123;</span><br><span class="line">  <span class="title function_">focus</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">blur</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="└─-useKeyMap-ts"><a href="#└─-useKeyMap-ts" class="headerlink" title="└─ useKeyMap.ts"></a>└─ useKeyMap.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Ref</span>, <span class="title class_">ComputedRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">SelectOptionProps</span>, <span class="title class_">SelectStates</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">KeyMapParams</span> &#123;</span><br><span class="line">  <span class="attr">isDropdownVisible</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">  <span class="attr">highlightedLine</span>: <span class="title class_">ComputedRef</span>&lt;<span class="title class_">SelectOptionProps</span> | <span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="attr">hasData</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">  <span class="attr">lastIndex</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line">  <span class="attr">selectStates</span>: <span class="title class_">SelectStates</span>;</span><br><span class="line">  <span class="title function_">controlVisible</span>(<span class="attr">visible</span>: <span class="built_in">boolean</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">handleSelect</span>(<span class="attr">option</span>: <span class="title class_">SelectOptionProps</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useKeyMap</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  isDropdownVisible,</span></span><br><span class="line"><span class="params">  controlVisible,</span></span><br><span class="line"><span class="params">  selectStates,</span></span><br><span class="line"><span class="params">  highlightedLine,</span></span><br><span class="line"><span class="params">  handleSelect,</span></span><br><span class="line"><span class="params">  hasData,</span></span><br><span class="line"><span class="params">  lastIndex,</span></span><br><span class="line"><span class="params">&#125;: <span class="title class_">KeyMapParams</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">keyMap</span>: <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">Function</span>&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">  keyMap.<span class="title function_">set</span>(<span class="string">&quot;Enter&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isDropdownVisible.<span class="property">value</span>) &#123;</span><br><span class="line">      <span class="title function_">controlVisible</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (selectStates.<span class="property">highlightedIndex</span> &gt;= <span class="number">0</span> &amp;&amp; highlightedLine.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="title function_">handleSelect</span>(highlightedLine.<span class="property">value</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">controlVisible</span>(<span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  keyMap.<span class="title function_">set</span>(</span><br><span class="line">    <span class="string">&quot;Escape&quot;</span>,</span><br><span class="line">    <span class="function">() =&gt;</span> isDropdownVisible.<span class="property">value</span> &amp;&amp; <span class="title function_">controlVisible</span>(!isDropdownVisible.<span class="property">value</span>)</span><br><span class="line">  );</span><br><span class="line">  keyMap.<span class="title function_">set</span>(<span class="string">&quot;ArrowUp&quot;</span>, <span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">KeyboardEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="keyword">if</span> (!hasData.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      selectStates.<span class="property">highlightedIndex</span> === -<span class="number">1</span> ||</span><br><span class="line">      selectStates.<span class="property">highlightedIndex</span> === <span class="number">0</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      selectStates.<span class="property">highlightedIndex</span> = lastIndex.<span class="property">value</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    selectStates.<span class="property">highlightedIndex</span>--;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  keyMap.<span class="title function_">set</span>(<span class="string">&quot;ArrowDown&quot;</span>, <span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">KeyboardEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="keyword">if</span> (!hasData.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      selectStates.<span class="property">highlightedIndex</span> === -<span class="number">1</span> ||</span><br><span class="line">      selectStates.<span class="property">highlightedIndex</span> === lastIndex.<span class="property">value</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      selectStates.<span class="property">highlightedIndex</span> = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    selectStates.<span class="property">highlightedIndex</span>++;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> keyMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-Switch"><a href="#├─-Switch" class="headerlink" title="├─ Switch"></a>├─ Switch</h3><blockquote><p>开关组件，用于在两种状态之间切换</p></blockquote><h4 id="–API–-14"><a href="#–API–-14" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-index-ts-15"><a href="#├─-index-ts-15" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Switch</span> <span class="keyword">from</span> <span class="string">&quot;./Switch.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErSwitch</span> = <span class="title function_">withInstall</span>(<span class="title class_">Switch</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-13"><a href="#├─-style-css-13" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-switch</span> &#123;</span><br><span class="line">  <span class="attr">--er-switch-on-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">  <span class="attr">--er-switch-off-color</span>: <span class="built_in">var</span>(--er-border-color);</span><br><span class="line">  <span class="attr">--er-switch-on-border-color</span>: <span class="built_in">var</span>(--er-color-primary);</span><br><span class="line">  <span class="attr">--er-switch-off-border-color</span>: <span class="built_in">var</span>(--er-border-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-switch</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="selector-class">.er-switch__input</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    &amp;<span class="selector-pseudo">:focus-visible</span>&#123;</span><br><span class="line">      &amp; ~ <span class="selector-class">.er-switch__core</span>&#123;</span><br><span class="line">        <span class="attribute">outline</span>: <span class="number">2px</span> solid <span class="built_in">var</span>(--er-switch-on-color);</span><br><span class="line">        <span class="attribute">outline-offset</span>: <span class="number">1px</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-disabled</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: .<span class="number">6</span>;</span><br><span class="line">    <span class="selector-class">.er-switch__core</span> &#123;</span><br><span class="line">      <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-checked</span>&#123;</span><br><span class="line">    <span class="selector-class">.er-switch__core</span>&#123;</span><br><span class="line">      <span class="attribute">border-color</span>: <span class="built_in">var</span>(--er-switch-on-border-color);</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-switch-on-color);</span><br><span class="line">      <span class="selector-class">.er-switch__core-action</span>&#123;</span><br><span class="line">        <span class="attribute">left</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">17px</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="selector-class">.er-switch__core-inner</span> &#123;</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">18px</span> <span class="number">0</span> <span class="number">4px</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-switch--large</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="selector-class">.er-switch__core</span> &#123;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">24px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="selector-class">.er-switch__core-action</span> &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">20px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-checked</span> &#123;</span><br><span class="line">    <span class="selector-class">.er-switch__core</span> <span class="selector-class">.er-switch__core-action</span> &#123;</span><br><span class="line">      <span class="attribute">left</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">21px</span>);</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-switch-on-color);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-switch--small</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="selector-class">.er-switch__core</span> &#123;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="selector-class">.er-switch__core-action</span> &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">12px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">12px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-class">.is-checked</span> &#123;</span><br><span class="line">    <span class="selector-class">.er-switch__core</span> <span class="selector-class">.er-switch-core-action</span> &#123;</span><br><span class="line">      <span class="attribute">left</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">13px</span>);</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-switch-on-color);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.er-switch__core</span>&#123;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="built_in">var</span>(--er-switch-off-border-color);</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--er-switch-off-color);</span><br><span class="line">  <span class="attribute">transition</span>: border-color <span class="built_in">var</span>(--er-transition-duration),background-color <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  <span class="selector-class">.er-switch__core-action</span>&#123;</span><br><span class="line">     <span class="attribute">position</span>: absolute;</span><br><span class="line">     <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-border-radius-circle);</span><br><span class="line">     <span class="attribute">left</span>: <span class="number">1px</span>;</span><br><span class="line">     <span class="attribute">width</span>: <span class="number">16px</span>;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">16px</span>;</span><br><span class="line">     <span class="attribute">background-color</span>: <span class="built_in">var</span>(--er-color-white);</span><br><span class="line">     <span class="attribute">transition</span>: all <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.er-switch__core-inner</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">0</span> <span class="number">18px</span>;</span><br><span class="line">    <span class="selector-class">.er-switch__core-inner-text</span>&#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">      <span class="attribute">color</span>: <span class="built_in">var</span>(--er-color-white);</span><br><span class="line">      <span class="attribute">user-select</span>: none;</span><br><span class="line">      <span class="attribute">overflow</span>: hidden;</span><br><span class="line">      <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">      <span class="attribute">white-space</span>: nowrap;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="├─-Switch-test-tsx"><a href="#├─-Switch-test-tsx" class="headerlink" title="├─ Switch.test.tsx"></a>├─ Switch.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, it, expect &#125; <span class="keyword">from</span> <span class="string">&#x27;vitest&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/test-utils&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Switch</span> <span class="keyword">from</span> <span class="string">&#x27;./Switch.vue&#x27;</span>; <span class="comment">// 确保这是你的 Switch 组件的路径</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;Switch.vue&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should render correctly with default props&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Switch</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&#x27;.er-switch&#x27;</span>)).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should handle click event and toggle the checked state&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Switch</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">trigger</span>(<span class="string">&#x27;click&#x27;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()[<span class="string">&#x27;update:modelValue&#x27;</span>][<span class="number">0</span>]).<span class="title function_">toEqual</span>([<span class="literal">true</span>]);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()[<span class="string">&#x27;change&#x27;</span>][<span class="number">0</span>]).<span class="title function_">toEqual</span>([<span class="literal">true</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">trigger</span>(<span class="string">&#x27;click&#x27;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()[<span class="string">&#x27;update:modelValue&#x27;</span>][<span class="number">1</span>]).<span class="title function_">toEqual</span>([<span class="literal">false</span>]);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()[<span class="string">&#x27;change&#x27;</span>][<span class="number">1</span>]).<span class="title function_">toEqual</span>([<span class="literal">false</span>]);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should not toggle when disabled&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Switch</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">modelValue</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">disabled</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">trigger</span>(<span class="string">&#x27;click&#x27;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="property">not</span>.<span class="title function_">toHaveProperty</span>(<span class="string">&#x27;update:modelValue&#x27;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">emitted</span>()).<span class="property">not</span>.<span class="title function_">toHaveProperty</span>(<span class="string">&#x27;change&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="├─-Switch-vue"><a href="#├─-Switch-vue" class="headerlink" title="├─ Switch.vue"></a>├─ Switch.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, computed, onMounted, watch &#125; from &quot;vue&quot;;</span><br><span class="line">import type &#123; SwitchEmits, SwitchProps, SwitchInstance &#125; from &quot;./types&quot;;</span><br><span class="line">import &#123; debugWarn &#125; from &quot;@eric-ui/utils&quot;;</span><br><span class="line">import &#123; useFormItem, useFormDisabled, useFormItemInputId &#125; from &quot;../Form&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123; name: &quot;ErSwitch&quot;, inheritAttrs: false &#125;);</span><br><span class="line">const props = withDefaults(defineProps&lt;SwitchProps&gt;(), &#123;</span><br><span class="line">  activeValue: true,</span><br><span class="line">  inactiveValue: false,</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;SwitchEmits&gt;();</span><br><span class="line">const isDisabled = useFormDisabled();</span><br><span class="line">const &#123; formItem &#125; = useFormItem();</span><br><span class="line">const &#123; inputId &#125; = useFormItemInputId(props, formItem);</span><br><span class="line"></span><br><span class="line">const innerValue = ref(props.modelValue);</span><br><span class="line">const inputRef = ref&lt;HTMLInputElement | null&gt;(null);</span><br><span class="line">const checked = computed(() =&gt; innerValue.value === props.activeValue);</span><br><span class="line"></span><br><span class="line">const focus: SwitchInstance[&quot;focus&quot;] = function () &#123;</span><br><span class="line">  inputRef.value?.focus();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function handleChange() &#123;</span><br><span class="line">  if (isDisabled.value) return;</span><br><span class="line"></span><br><span class="line">  const newVal = checked.value ? props.inactiveValue : props.activeValue;</span><br><span class="line"></span><br><span class="line">  innerValue.value = newVal;</span><br><span class="line">  emits(&quot;update:modelValue&quot;, newVal);</span><br><span class="line">  emits(&quot;change&quot;, newVal);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  inputRef.value!.checked = checked.value;</span><br><span class="line">&#125;);</span><br><span class="line">watch(checked, (val) =&gt; &#123;</span><br><span class="line">  inputRef.value!.checked = val;</span><br><span class="line">  formItem?.validate(&quot;change&quot;).catch((err) =&gt; debugWarn(err));</span><br><span class="line">&#125;);</span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.modelValue,</span><br><span class="line">  (val) =&gt; (innerValue.value = val)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;SwitchInstance&gt;(&#123;</span><br><span class="line">  focus,</span><br><span class="line">  checked,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;er-switch&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      [`er-switch--$&#123;size&#125;`]: size,</span><br><span class="line">      &#x27;is-disabled&#x27;: isDisabled,</span><br><span class="line">      &#x27;is-checked&#x27;: checked,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">    @click=&quot;handleChange&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;input</span><br><span class="line">      class=&quot;er-switch__input&quot;</span><br><span class="line">      type=&quot;checkbox&quot;</span><br><span class="line">      role=&quot;switch&quot;</span><br><span class="line">      ref=&quot;inputRef&quot;</span><br><span class="line">      :id=&quot;inputId&quot;</span><br><span class="line">      :name=&quot;name&quot;</span><br><span class="line">      :disabled=&quot;isDisabled&quot;</span><br><span class="line">      :checked=&quot;checked&quot;</span><br><span class="line">      @keydown.enter=&quot;handleChange&quot;</span><br><span class="line">      @blur=&quot;formItem?.validate(&#x27;blur&#x27;).catch((err) =&gt; debugWarn(err))&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;div class=&quot;er-switch__core&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;er-switch__core-inner&quot;&gt;</span><br><span class="line">        &lt;span</span><br><span class="line">          v-if=&quot;activeText || inactiveText&quot;</span><br><span class="line">          class=&quot;er-switch__core-inner-text&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;&#123; checked ? activeText : inactiveText &#125;&#125;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;er-switch__core-action&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="└─-types-ts-14"><a href="#└─-types-ts-14" class="headerlink" title="└─ types.ts"></a>└─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ComputedRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">SwitchValueType</span> = <span class="built_in">boolean</span> | <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SwitchProps</span> &#123;</span><br><span class="line">  <span class="attr">modelValue</span>: <span class="title class_">SwitchValueType</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">activeText</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">inactiveText</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">activeValue</span>?: <span class="title class_">SwitchValueType</span>;</span><br><span class="line">  <span class="attr">inactiveValue</span>?: <span class="title class_">SwitchValueType</span>;</span><br><span class="line">  <span class="attr">name</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">id</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">size</span>?: <span class="string">&quot;small&quot;</span> | <span class="string">&quot;large&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SwitchEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;update:modelValue&quot;</span>, <span class="attr">value</span>: <span class="title class_">SwitchValueType</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;change&quot;</span>, <span class="attr">value</span>: <span class="title class_">SwitchValueType</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SwitchInstance</span> &#123;</span><br><span class="line">  <span class="title function_">focus</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="attr">checked</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">boolean</span>&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-Tooltip"><a href="#├─-Tooltip" class="headerlink" title="├─ Tooltip"></a>├─ Tooltip</h3><blockquote><p>hover文字提示, 显示额外的信息</p></blockquote><h4 id="–API–-15"><a href="#–API–-15" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-index-ts-16"><a href="#├─-index-ts-16" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Tooltip</span> <span class="keyword">from</span> <span class="string">&quot;./Tooltip.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErTooltip</span> = <span class="title function_">withInstall</span>(<span class="title class_">Tooltip</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-style-css-14"><a href="#├─-style-css-14" class="headerlink" title="├─ style.css"></a>├─ style.css</h4><blockquote></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.er-tooltip</span> &#123;</span><br><span class="line">  <span class="attr">--er-popover-bg-color</span>: <span class="built_in">var</span>(--er-bg-color-overlay);</span><br><span class="line">  <span class="attr">--er-popover-font-size</span>: <span class="built_in">var</span>(--er-font-size-base);</span><br><span class="line">  <span class="attr">--er-popover-border-color</span>: <span class="built_in">var</span>(--er-border-color-lighter);</span><br><span class="line">  <span class="attr">--er-popover-padding</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attr">--er-popover-border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.er-tooltip</span> &#123;</span><br><span class="line">  <span class="selector-class">.fade-enter-active</span>,</span><br><span class="line">  <span class="selector-class">.fade-leave-active</span> &#123;</span><br><span class="line">    <span class="attribute">transition</span>: opacity <span class="built_in">var</span>(--er-transition-duration);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.fade-enter-from</span>,</span><br><span class="line">  <span class="selector-class">.fade-leave-to</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.er-tooltip__popper</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--er-popover-bg-color);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--er-popover-border-radius);</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="built_in">var</span>(--er-popover-padding);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--er-text-color-regular);</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.4</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: justify;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--er-popover-font-size);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--er-box-shadow-light);</span><br><span class="line">    <span class="attribute">word-break</span>: break-all;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">1000</span>;</span><br><span class="line">    <span class="selector-id">#arrow</span>,</span><br><span class="line">    <span class="selector-id">#arrow</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">      <span class="attribute">position</span>: absolute;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">8px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">8px</span>;</span><br><span class="line">      <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">      <span class="attribute">background</span>: <span class="built_in">var</span>(--er-popover-bg-color);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#arrow</span> &#123;</span><br><span class="line">      <span class="attribute">visibility</span>: hidden;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#arrow</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">      <span class="attribute">visibility</span>: visible;</span><br><span class="line">      <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;top&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span> &#123;</span><br><span class="line">      <span class="attribute">bottom</span>: -<span class="number">5px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;bottom&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span> &#123;</span><br><span class="line">      <span class="attribute">top</span>: -<span class="number">5px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;left&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span> &#123;</span><br><span class="line">      <span class="attribute">right</span>: -<span class="number">5px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;right&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span> &#123;</span><br><span class="line">      <span class="attribute">left</span>: -<span class="number">5px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;top&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">      <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">      <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;bottom&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">      <span class="attribute">border-left</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">      <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;left&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">      <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">      <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;<span class="selector-attr">[data-popper-placement^=<span class="string">&#x27;right&#x27;</span>]</span> &gt; <span class="selector-id">#arrow</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">      <span class="attribute">border-left</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">      <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--er-popover-border-color);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="├─-Tooltip-test-tsx"><a href="#├─-Tooltip-test-tsx" class="headerlink" title="├─ Tooltip.test.tsx"></a>├─ Tooltip.test.tsx</h4><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, test,it, expect, vi, beforeEach &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ErTooltip</span> &#125; <span class="keyword">from</span> <span class="string">&quot;.&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Tooltip</span> <span class="keyword">from</span> <span class="string">&quot;./Tooltip.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line">vi.<span class="title function_">mock</span>(<span class="string">&quot;@popperjs/core&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> onVisibleChange = vi.<span class="title function_">fn</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Tooltip/index.ts&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 测试 withInstall 函数是否被正确应用</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should be exported with withInstall()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErTooltip</span>.<span class="property">install</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 测试 Tooltip 组件是否被正确导出</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should be exported Tooltip component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErTooltip</span>).<span class="title function_">toBe</span>(<span class="title class_">Tooltip</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 可选：测试 withInstall 是否增强了 Tooltip 组件的功能</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;should enhance Tooltip component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> enhancedTooltip = <span class="title function_">withInstall</span>(<span class="title class_">Tooltip</span>);</span><br><span class="line">    <span class="title function_">expect</span>(enhancedTooltip).<span class="title function_">toBe</span>(<span class="title class_">ErTooltip</span>);</span><br><span class="line">    <span class="comment">// 这里可以添加更多测试，确保 withInstall 增强了组件的特定功能</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 可选：如果你的 withInstall 函数有特定的行为或属性，确保它们被正确应用</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;should apply specific enhancements&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> enhancedTooltip = <span class="title function_">withInstall</span>(<span class="title class_">Tooltip</span>);</span><br><span class="line">    <span class="comment">// 例如，如果你的 withInstall 增加了一个特定的方法或属性</span></span><br><span class="line">    <span class="title function_">expect</span>(enhancedTooltip).<span class="title function_">toHaveProperty</span>(<span class="string">&quot;install&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;Tooltip.vue&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    vi.<span class="title function_">useFakeTimers</span>();</span><br><span class="line">    vi.<span class="title function_">clearAllMocks</span>()</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;basic tooltip&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;outside&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Tooltip</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">content</span>=<span class="string">&quot;hello tooltip&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">trigger</span>=<span class="string">&quot;click&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;<span class="attr">...</span>&#123; <span class="attr">onVisibleChange</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;trigger&quot;</span>&gt;</span>trigger<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Tooltip</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      ),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">attachTo</span>: <span class="variable language_">document</span>.<span class="property">body</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">const</span> triggerArea = wrapper.<span class="title function_">find</span>(<span class="string">&quot;#trigger&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(triggerArea.<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 弹出层是否出现</span></span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">get</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">text</span>()).<span class="title function_">toBe</span>(<span class="string">&quot;hello tooltip&quot;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(onVisibleChange).<span class="title function_">toHaveBeenCalledWith</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 再次点击</span></span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onVisibleChange).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 等待动画</span></span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line"></span><br><span class="line">    triggerArea.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="comment">// 区域外点击关闭 tooltip</span></span><br><span class="line">    wrapper.<span class="title function_">get</span>(<span class="string">&quot;#outside&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(onVisibleChange).<span class="title function_">toHaveBeenCalledTimes</span>(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注销流程</span></span><br><span class="line">    wrapper.<span class="title function_">unmount</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;tooltip with hover trigger&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// ... 省略其他设置</span></span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Tooltip</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; <span class="attr">trigger</span>: <span class="string">&quot;hover&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;test&quot;</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 测试悬停显示</span></span><br><span class="line">    wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__trigger&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;mouseenter&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="comment">// 测试悬外隐藏</span></span><br><span class="line">    wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;mouseleave&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 右键菜单触发的测试</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;tooltip with contextmenu trigger&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// ... 省略其他设置</span></span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Tooltip</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; <span class="attr">trigger</span>: <span class="string">&quot;contextmenu&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;test&quot;</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 测试右键菜单显示</span></span><br><span class="line">    wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__trigger&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;contextmenu&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="comment">// 测试右键菜单隐藏（可以模拟点击外部区域）</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 手动模式的测试</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;tooltip with manual trigger&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// ... 省略其他设置</span></span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Tooltip</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; <span class="attr">manual</span>: <span class="literal">true</span>, <span class="attr">content</span>: <span class="string">&quot;test&quot;</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 测试手动触发显示和隐藏</span></span><br><span class="line">    wrapper.<span class="property">vm</span>.<span class="title function_">show</span>(); <span class="comment">// 假设 show 方法可以通过某种方式访问</span></span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    wrapper.<span class="property">vm</span>.<span class="title function_">hide</span>();</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 禁用状态的测试</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;disabled tooltip&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// ... 省略其他设置</span></span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Tooltip</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; <span class="attr">disabled</span>: <span class="literal">true</span>, <span class="attr">content</span>: <span class="string">&quot;test&quot;</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 测试禁用状态下点击不会触发显示</span></span><br><span class="line">    wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__trigger&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 虚拟触发节点的测试</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;tooltip with virtual trigger node&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// ... 省略其他设置</span></span><br><span class="line">    <span class="keyword">const</span> virtualRef = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(<span class="title class_">Tooltip</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123; virtualRef, <span class="attr">virtualTriggering</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 测试虚拟节点的事件触发</span></span><br><span class="line">    virtualRef.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&quot;mouseenter&quot;</span>));</span><br><span class="line">    <span class="keyword">await</span> vi.<span class="title function_">runAllTimers</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wrapper.<span class="title function_">find</span>(<span class="string">&quot;.er-tooltip__popper&quot;</span>).<span class="title function_">exists</span>()).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="├─-Tooltip-vue"><a href="#├─-Tooltip-vue" class="headerlink" title="├─ Tooltip.vue"></a>├─ Tooltip.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; createPopper, type Instance &#125; from &quot;@popperjs/core&quot;;</span><br><span class="line">import &#123; ref, watch, watchEffect, onUnmounted, computed, type Ref &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; bind, debounce, type DebouncedFunc &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import &#123; useClickOutside &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line"></span><br><span class="line">import type &#123; TooltipProps, TooltipEmits, TooltipInstance &#125; from &quot;./types&quot;;</span><br><span class="line">import type &#123; ButtonInstance &#125; from &quot;../Button&quot;;</span><br><span class="line"></span><br><span class="line">import useEvenstToTiggerNode from &quot;./useEventsToTiggerNode&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErTooltip&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">interface _TooltipProps extends TooltipProps &#123;</span><br><span class="line">  virtualRef?: HTMLElement | ButtonInstance | void;</span><br><span class="line">  virtualTriggering?: boolean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const props = withDefaults(defineProps&lt;_TooltipProps&gt;(), &#123;</span><br><span class="line">  placement: &quot;bottom&quot;,</span><br><span class="line">  trigger: &quot;hover&quot;,</span><br><span class="line">  transition: &quot;fade&quot;,</span><br><span class="line">  showTimeout: 0,</span><br><span class="line">  hideTimeout: 200,</span><br><span class="line">&#125;);</span><br><span class="line">const emits = defineEmits&lt;TooltipEmits&gt;();</span><br><span class="line">const visible = ref(false);</span><br><span class="line"></span><br><span class="line">const events: Ref&lt;Record&lt;string, EventListener&gt;&gt; = ref(&#123;&#125;);</span><br><span class="line">const outerEvents: Ref&lt;Record&lt;string, EventListener&gt;&gt; = ref(&#123;&#125;);</span><br><span class="line">const dropdownEvents: Ref&lt;Record&lt;string, EventListener&gt;&gt; = ref(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">const containerNode = ref&lt;HTMLElement&gt;();</span><br><span class="line">const popperNode = ref&lt;HTMLElement&gt;();</span><br><span class="line">const _triggerNode = ref&lt;HTMLElement&gt;();</span><br><span class="line"></span><br><span class="line">const triggerNode = computed(() =&gt; &#123;</span><br><span class="line">  if (props.virtualTriggering)</span><br><span class="line">    return (</span><br><span class="line">      // @tips any 为了 fix 一个初始设计上的小失误 （后续重构 &quot;虚拟目标节点&quot; 时解决）</span><br><span class="line">      ((props.virtualRef as ButtonInstance)?.ref as any) ??</span><br><span class="line">      (props.virtualRef as HTMLElement) ??</span><br><span class="line">      _triggerNode.value</span><br><span class="line">    );</span><br><span class="line">  return _triggerNode.value as HTMLElement;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const popperOptions = computed(() =&gt; (&#123;</span><br><span class="line">  placement: props.placement,</span><br><span class="line">  modifiers: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &quot;offset&quot;,</span><br><span class="line">      options: &#123;</span><br><span class="line">        offset: [0, 9],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  ...props.popperOptions,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">const openDelay = computed(() =&gt;</span><br><span class="line">  props.trigger === &quot;hover&quot; ? props.showTimeout : 0</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const closeDelay = computed(() =&gt;</span><br><span class="line">  props.trigger === &quot;hover&quot; ? props.hideTimeout : 0</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const triggerStrategyMap: Map&lt;string, () =&gt; void&gt; = new Map();</span><br><span class="line">triggerStrategyMap.set(&quot;hover&quot;, () =&gt; &#123;</span><br><span class="line">  events.value[&quot;mouseenter&quot;] = openFinal;</span><br><span class="line">  outerEvents.value[&quot;mouseleave&quot;] = closeFinal;</span><br><span class="line">  dropdownEvents.value[&quot;mouseenter&quot;] = openFinal;</span><br><span class="line">&#125;);</span><br><span class="line">triggerStrategyMap.set(&quot;click&quot;, () =&gt; &#123;</span><br><span class="line">  events.value[&quot;click&quot;] = togglePopper;</span><br><span class="line">&#125;);</span><br><span class="line">triggerStrategyMap.set(&quot;contextmenu&quot;, () =&gt; &#123;</span><br><span class="line">  events.value[&quot;contextmenu&quot;] = (e) =&gt; &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    openFinal();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">let openDebounce: DebouncedFunc&lt;() =&gt; void&gt; | void;</span><br><span class="line">let closeDebounce: DebouncedFunc&lt;() =&gt; void&gt; | void;</span><br><span class="line"></span><br><span class="line">function openFinal() &#123;</span><br><span class="line">  closeDebounce?.cancel();</span><br><span class="line">  openDebounce?.();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function closeFinal() &#123;</span><br><span class="line">  openDebounce?.cancel();</span><br><span class="line">  closeDebounce?.();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function togglePopper() &#123;</span><br><span class="line">  visible.value ? closeFinal() : openFinal();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function setVisible(val: boolean) &#123;</span><br><span class="line">  if (props.disabled) return;</span><br><span class="line">  visible.value = val;</span><br><span class="line">  emits(&quot;visible-change&quot;, val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function attachEvents() &#123;</span><br><span class="line">  if (props.disabled || props.manual) return;</span><br><span class="line">  triggerStrategyMap.get(props.trigger)?.();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let popperInstance: null | Instance;</span><br><span class="line">function destroyPopperInstance() &#123;</span><br><span class="line">  popperInstance?.destroy();</span><br><span class="line">  popperInstance = null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function resetEvents() &#123;</span><br><span class="line">  events.value = &#123;&#125;;</span><br><span class="line">  outerEvents.value = &#123;&#125;;</span><br><span class="line">  dropdownEvents.value = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  attachEvents();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (!props.manual) &#123;</span><br><span class="line">  attachEvents();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const show: TooltipInstance[&quot;show&quot;] = openFinal;</span><br><span class="line"></span><br><span class="line">const hide: TooltipInstance[&quot;hide&quot;] = function () &#123;</span><br><span class="line">  openDebounce?.cancel();</span><br><span class="line">  setVisible(false);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">useClickOutside(containerNode, () =&gt; &#123;</span><br><span class="line">  emits(&quot;click-outside&quot;);</span><br><span class="line">  if (props.trigger === &quot;hover&quot; || props.manual) return;</span><br><span class="line">  visible.value &amp;&amp; closeFinal();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  visible,</span><br><span class="line">  (val) =&gt; &#123;</span><br><span class="line">    if (!val) return;</span><br><span class="line"></span><br><span class="line">    if (triggerNode.value &amp;&amp; popperNode.value) &#123;</span><br><span class="line">      popperInstance = createPopper(</span><br><span class="line">        triggerNode.value,</span><br><span class="line">        popperNode.value,</span><br><span class="line">        popperOptions.value</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; flush: &quot;post&quot; &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.manual,</span><br><span class="line">  (isManual) =&gt; &#123;</span><br><span class="line">    if (isManual) &#123;</span><br><span class="line">      events.value = &#123;&#125;;</span><br><span class="line">      outerEvents.value = &#123;&#125;;</span><br><span class="line">      dropdownEvents.value = &#123;&#125;;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    attachEvents();</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.trigger,</span><br><span class="line">  (newTrigger, oldTrigger) =&gt; &#123;</span><br><span class="line">    if (newTrigger === oldTrigger) return;</span><br><span class="line">    resetEvents();</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.disabled,</span><br><span class="line">  (val, oldVal) =&gt; &#123;</span><br><span class="line">    if (val === oldVal) return;</span><br><span class="line">    openDebounce?.cancel();</span><br><span class="line">    visible.value = false;</span><br><span class="line">    emits(&quot;visible-change&quot;, false);</span><br><span class="line">    resetEvents();</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">watchEffect(() =&gt; &#123;</span><br><span class="line">  openDebounce = debounce(bind(setVisible, null, true), openDelay.value);</span><br><span class="line">  closeDebounce = debounce(bind(setVisible, null, false), closeDelay.value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">useEvenstToTiggerNode(props, triggerNode, events, () =&gt; &#123;</span><br><span class="line">  openDebounce?.cancel();</span><br><span class="line">  setVisible(false);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">onUnmounted(() =&gt; &#123;</span><br><span class="line">  destroyPopperInstance();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;TooltipInstance&gt;(&#123;</span><br><span class="line">  show,</span><br><span class="line">  hide,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;er-tooltip&quot; ref=&quot;containerNode&quot; v-on=&quot;outerEvents&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;er-tooltip__trigger&quot;</span><br><span class="line">      ref=&quot;_triggerNode&quot;</span><br><span class="line">      v-on=&quot;events&quot;</span><br><span class="line">      v-if=&quot;!virtualTriggering&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;slot name=&quot;default&quot; v-else&gt;&lt;/slot&gt;</span><br><span class="line"></span><br><span class="line">    &lt;transition :name=&quot;transition&quot; @after-leave=&quot;destroyPopperInstance&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;er-tooltip__popper&quot;</span><br><span class="line">        ref=&quot;popperNode&quot;</span><br><span class="line">        v-on=&quot;dropdownEvents&quot;</span><br><span class="line">        v-if=&quot;visible&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;slot name=&quot;content&quot;&gt;</span><br><span class="line">          &#123;&#123; content &#125;&#125;</span><br><span class="line">        &lt;/slot&gt;</span><br><span class="line">        &lt;div id=&quot;arrow&quot; data-popper-arrow&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">@import &quot;./style.css&quot;;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="├─-types-ts-1"><a href="#├─-types-ts-1" class="headerlink" title="├─ types.ts"></a>├─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Placement</span>, <span class="title class_">Options</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@popperjs/core&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">TooltipProps</span> &#123;</span><br><span class="line">  <span class="attr">content</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">trigger</span>?: <span class="string">&quot;hover&quot;</span> | <span class="string">&quot;click&quot;</span> | <span class="string">&quot;contextmenu&quot;</span>;</span><br><span class="line">  <span class="attr">placement</span>?: <span class="title class_">Placement</span>;</span><br><span class="line">  <span class="attr">manual</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">popperOptions</span>?: <span class="title class_">Partial</span>&lt;<span class="title class_">Options</span>&gt;;</span><br><span class="line">  <span class="attr">transition</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">showTimeout</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">hideTimeout</span>?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">TooltipEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;visible-change&quot;</span>, <span class="attr">value</span>: <span class="built_in">boolean</span>): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;click-outside&quot;</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">TooltipInstance</span> &#123;</span><br><span class="line">  <span class="title function_">show</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">hide</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="└─-useEventsToTiggerNode-ts"><a href="#└─-useEventsToTiggerNode-ts" class="headerlink" title="└─ useEventsToTiggerNode.ts"></a>└─ useEventsToTiggerNode.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; each, isElement &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; onMounted, onUnmounted, watch &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ComputedRef</span>, <span class="title class_">Ref</span>, <span class="title class_">WatchStopHandle</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">TooltipProps</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useEvenstToTiggerNode</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">props</span>: <span class="title class_">TooltipProps</span> &amp; &#123; virtualTriggering?: <span class="built_in">boolean</span> &#125;,</span></span><br><span class="line"><span class="params">  <span class="attr">triggerNode</span>: <span class="title class_">ComputedRef</span>&lt;<span class="title class_">HTMLElement</span> | <span class="literal">undefined</span>&gt;,</span></span><br><span class="line"><span class="params">  <span class="attr">events</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">EventListener</span>&gt;&gt;,</span></span><br><span class="line"><span class="params">  <span class="attr">closeMethod</span>: () =&gt; <span class="built_in">void</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">watchEventsStopHandle</span>: <span class="title class_">WatchStopHandle</span> | <span class="built_in">void</span>;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">watchTriggerNodeStopHandle</span>: <span class="title class_">WatchStopHandle</span> | <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> _eventHandleMap = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">_bindEventToVirtualTiggerNode</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> el = triggerNode.<span class="property">value</span>;</span><br><span class="line">    <span class="title function_">isElement</span>(el) &amp;&amp;</span><br><span class="line">      <span class="title function_">each</span>(events.<span class="property">value</span>, <span class="function">(<span class="params">fn, event</span>) =&gt;</span> &#123;</span><br><span class="line">        _eventHandleMap.<span class="title function_">set</span>(event, fn);</span><br><span class="line">        el?.<span class="title function_">addEventListener</span>(event <span class="keyword">as</span> keyof <span class="title class_">HTMLElementEventMap</span>, fn);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">_unbindEventToVirtualTiggerNode</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> el = triggerNode.<span class="property">value</span>;</span><br><span class="line">    <span class="title function_">isElement</span>(el) &amp;&amp;</span><br><span class="line">      <span class="title function_">each</span>(</span><br><span class="line">        [<span class="string">&quot;mouseenter&quot;</span>, <span class="string">&quot;click&quot;</span>, <span class="string">&quot;contextmenu&quot;</span>],</span><br><span class="line">        <span class="function">(<span class="params">key</span>) =&gt;</span></span><br><span class="line">          _eventHandleMap.<span class="title function_">has</span>(key) &amp;&amp;</span><br><span class="line">          el?.<span class="title function_">removeEventListener</span>(key, _eventHandleMap.<span class="title function_">get</span>(key))</span><br><span class="line">      );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    watchTriggerNodeStopHandle = <span class="title function_">watch</span>(</span><br><span class="line">      triggerNode,</span><br><span class="line">      <span class="function">() =&gt;</span> props.<span class="property">virtualTriggering</span> &amp;&amp; <span class="title function_">_bindEventToVirtualTiggerNode</span>(),</span><br><span class="line">      &#123; <span class="attr">immediate</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    watchEventsStopHandle = <span class="title function_">watch</span>(</span><br><span class="line">      events,</span><br><span class="line">      <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!props.<span class="property">virtualTriggering</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="title function_">_unbindEventToVirtualTiggerNode</span>();</span><br><span class="line">        <span class="title function_">_bindEventToVirtualTiggerNode</span>();</span><br><span class="line">        <span class="title function_">closeMethod</span>();</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    watchTriggerNodeStopHandle?.();</span><br><span class="line">    watchEventsStopHandle?.();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useEvenstToTiggerNode;</span><br></pre></td></tr></table></figure><h3 id="├─-Upload"><a href="#├─-Upload" class="headerlink" title="├─ Upload"></a>├─ Upload</h3><blockquote><p>上传组件，用于上传文件</p></blockquote><h4 id="–API–-16"><a href="#–API–-16" class="headerlink" title="–API–"></a>–API–</h4><h4 id="├─-index-ts-17"><a href="#├─-index-ts-17" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Upload</span> <span class="keyword">from</span> <span class="string">&quot;./Upload.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErUpload</span> = <span class="title function_">withInstall</span>(<span class="title class_">Upload</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="├─-types-ts-2"><a href="#├─-types-ts-2" class="headerlink" title="├─ types.ts"></a>├─ types.ts</h4><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">UploadFileStatus</span> = <span class="string">&quot;ready&quot;</span> | <span class="string">&quot;uploading&quot;</span> | <span class="string">&quot;success&quot;</span> | <span class="string">&quot;error&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">UploadFile</span> &#123;</span><br><span class="line">  <span class="attr">uid</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">size</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">status</span>?: <span class="title class_">UploadFileStatus</span>;</span><br><span class="line">  <span class="attr">percent</span>?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">raw</span>?: <span class="title class_">File</span>;</span><br><span class="line">  <span class="attr">response</span>?: <span class="built_in">any</span>;</span><br><span class="line">  <span class="attr">error</span>?: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">UploadProps</span> &#123;</span><br><span class="line">  <span class="attr">action</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">defaultFileList</span>?: <span class="title class_">UploadFile</span>[];</span><br><span class="line">  beforeUpload?(<span class="attr">file</span>: <span class="title class_">File</span>): <span class="built_in">boolean</span> | <span class="title class_">Promise</span>&lt;<span class="title class_">File</span>&gt;;</span><br><span class="line">  onChange?(<span class="attr">file</span>: <span class="title class_">File</span>): <span class="built_in">void</span>;</span><br><span class="line">  onProgress?(<span class="attr">percentage</span>: <span class="built_in">number</span>, <span class="attr">file</span>: <span class="title class_">File</span>): <span class="built_in">void</span>;</span><br><span class="line">  onSuccess?(<span class="attr">data</span>: <span class="built_in">any</span>, <span class="attr">file</span>: <span class="title class_">File</span>): <span class="built_in">void</span>;</span><br><span class="line">  onError?(<span class="attr">err</span>: <span class="built_in">any</span>, <span class="attr">file</span>: <span class="title class_">File</span>): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  onRemove?(<span class="attr">file</span>: <span class="title class_">UploadFile</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">UploadListProps</span> &#123;</span><br><span class="line">  <span class="attr">fileList</span>: <span class="title class_">UploadFile</span>[];</span><br><span class="line">  onRemove?(<span class="attr">file</span>: <span class="title class_">UploadFile</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="├─-Upload-vue"><a href="#├─-Upload-vue" class="headerlink" title="├─ Upload.vue"></a>├─ Upload.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; UploadProps, UploadFile &#125; from &quot;./types&quot;;</span><br><span class="line">import ErButton from &quot;../Button/Button.vue&quot;;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; cloneDeep, each, isFunction &#125; from &quot;lodash-es&quot;;</span><br><span class="line">import axios, &#123; type AxiosProgressEvent &#125; from &quot;axios&quot;;</span><br><span class="line">import &#123; useId &#125; from &quot;@eric-ui/hooks&quot;;</span><br><span class="line">import UploadList from &quot;./UploadList.vue&quot;;</span><br><span class="line"></span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErUpload&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const props = defineProps&lt;UploadProps&gt;();</span><br><span class="line"></span><br><span class="line">const fileInputRef = ref&lt;HTMLInputElement&gt;();</span><br><span class="line">const fileList = ref&lt;UploadFile[]&gt;(props.defaultFileList ?? []);</span><br><span class="line"></span><br><span class="line">function setFileListItem(item: UploadFile) &#123;</span><br><span class="line">  const index = fileList.value.findIndex((file) =&gt; file.uid === item.uid);</span><br><span class="line">  if (index !== -1) &#123;</span><br><span class="line">    fileList.value.splice(index, 1, cloneDeep(item));</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    fileList.value.unshift(cloneDeep(item));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleClick() &#123;</span><br><span class="line">  fileInputRef.value?.click();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleFileChange(e: Event) &#123;</span><br><span class="line">  const files = (e.target as HTMLInputElement)?.files;</span><br><span class="line">  if (!files) return;</span><br><span class="line">  uploadFiles(files);</span><br><span class="line">  if (fileInputRef.value) &#123;</span><br><span class="line">    fileInputRef.value.value = &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function uploadFiles(files: FileList) &#123;</span><br><span class="line">  const postFiles = Array.from(files);</span><br><span class="line">  each(postFiles, (file) =&gt; &#123;</span><br><span class="line">    if (!props?.beforeUpload) &#123;</span><br><span class="line">      post(file);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      const result = props.beforeUpload(file);</span><br><span class="line">      if (result &amp;&amp; result instanceof Promise) &#123;</span><br><span class="line">        result.then((processFile) =&gt; &#123;</span><br><span class="line">          post(processFile);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; else if (result !== false) &#123;</span><br><span class="line">        post(file);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function post(file: File) &#123;</span><br><span class="line">  const _file: UploadFile = &#123;</span><br><span class="line">    uid: useId().value + &quot;_upload-file_&quot; + Date.now(),</span><br><span class="line">    status: &quot;ready&quot;,</span><br><span class="line">    name: file.name,</span><br><span class="line">    size: file.size,</span><br><span class="line">    percent: 0,</span><br><span class="line">    raw: file,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  setFileListItem(_file);</span><br><span class="line"></span><br><span class="line">  const formData = new FormData();</span><br><span class="line">  formData.append(file.name, file);</span><br><span class="line">  axios</span><br><span class="line">    .postForm(props.action, formData, &#123;</span><br><span class="line">      headers: &#123;</span><br><span class="line">        &quot;Content-Type&quot;: &quot;multipart/form-data&quot;,</span><br><span class="line">      &#125;,</span><br><span class="line">      onUploadProgress: (e: AxiosProgressEvent) =&gt; &#123;</span><br><span class="line">        let percent = Math.round((e.loaded * 100) / e.total!) || 0;</span><br><span class="line"></span><br><span class="line">        _file.percent = percent;</span><br><span class="line">        if (percent &lt; 100) &#123;</span><br><span class="line">          _file.status = &quot;uploading&quot;;</span><br><span class="line">          setFileListItem(_file);</span><br><span class="line">        &#125;</span><br><span class="line">        isFunction(props.onProgress) &amp;&amp; props.onProgress(percent, file);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    .then((resp: any) =&gt; &#123;</span><br><span class="line">      _file.status = &quot;success&quot;;</span><br><span class="line">      _file.response = resp.data;</span><br><span class="line">      isFunction(props.onSuccess) &amp;&amp; props.onSuccess(resp.data, file);</span><br><span class="line">      setFileListItem(_file);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch((err) =&gt; &#123;</span><br><span class="line">      _file.status = &quot;error&quot;;</span><br><span class="line">      isFunction(props.onError) &amp;&amp; props.onError(err, file);</span><br><span class="line">      setFileListItem(_file);</span><br><span class="line">    &#125;)</span><br><span class="line">    .finally(() =&gt; &#123;</span><br><span class="line">      isFunction(props.onChange) &amp;&amp; props.onChange(file);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleRemove(file: UploadFile) &#123;</span><br><span class="line">  fileList.value = fileList.value.filter((item) =&gt; item.uid !== file.uid);</span><br><span class="line">  isFunction(props.onRemove) &amp;&amp; props.onRemove(file);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;er-upload&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;er-upload__content&quot; @click=&quot;handleClick&quot;&gt;</span><br><span class="line">      &lt;slot&gt;</span><br><span class="line">        &lt;er-button type=&quot;primary&quot;&gt;Upload File&lt;/er-button&gt;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;input</span><br><span class="line">      ref=&quot;fileInputRef&quot;</span><br><span class="line">      class=&quot;er-file-input&quot;</span><br><span class="line">      type=&quot;file&quot;</span><br><span class="line">      @change=&quot;handleFileChange&quot;</span><br><span class="line">      style=&quot;display: none&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;upload-list :file-list=&quot;fileList&quot; :on-remove=&quot;handleRemove&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="└─-UploadList-vue"><a href="#└─-UploadList-vue" class="headerlink" title="└─ UploadList.vue"></a>└─ UploadList.vue</h4><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import type &#123; UploadListProps &#125; from &quot;./types&quot;;</span><br><span class="line">import ErIcon from &quot;../Icon/Icon.vue&quot;;</span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &quot;ErUploadList&quot;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">defineProps&lt;UploadListProps&gt;();</span><br><span class="line"></span><br><span class="line">const statusIconMap = new Map([</span><br><span class="line">  [&quot;success&quot;, &quot;check-circle&quot;],</span><br><span class="line">  [&quot;error&quot;, &quot;times-circle&quot;],</span><br><span class="line">  [&quot;uploading&quot;, &quot;spinner&quot;],</span><br><span class="line">]);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;ul class=&quot;er-upload-list&quot;&gt;</span><br><span class="line">    &lt;li v-for=&quot;item in fileList&quot; :key=&quot;item.uid&quot; class=&quot;er-upload-list__item&quot;&gt;</span><br><span class="line">      &lt;span class=&quot;file-name&quot; :class=&quot;&#123; [`file-name-$&#123;item.status&#125;`]: true &#125;&quot;&gt;</span><br><span class="line">        &lt;er-icon icon=&quot;file-alt&quot; /&gt;</span><br><span class="line">        &#123;&#123; item.name &#125;&#125;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      &lt;span</span><br><span class="line">        class=&quot;file-status&quot;</span><br><span class="line">        :class=&quot;&#123; [`file-status-$&#123;item.status&#125;`]: true &#125;&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;er-icon</span><br><span class="line">          :icon=&quot;statusIconMap.get(item.status || &#x27;&#x27;) ?? &#x27;&#x27;&quot;</span><br><span class="line">          :spin=&quot;item.status === &#x27;uploading&#x27;&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      &lt;span class=&quot;file-action&quot;&gt;</span><br><span class="line">        &lt;er-icon icon=&quot;times&quot; @click=&quot;onRemove?.(item)&quot; /&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.er-upload-list &#123;</span><br><span class="line">  margin: 0;</span><br><span class="line">  padding: 0;</span><br><span class="line">  list-style-type: none;</span><br><span class="line">  .er-upload-list__item &#123;</span><br><span class="line">    transition: all 0.5s cubic-bezier(0.55, 0, 0.1, 1);</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    line-height: 1.8;</span><br><span class="line">    margin-top: 5px;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">    min-width: 200px;</span><br><span class="line">    position: relative;</span><br><span class="line">    &amp;:first-child &#123;</span><br><span class="line">      margin-top: 10px;</span><br><span class="line">    &#125;</span><br><span class="line">    .file-name &#123;</span><br><span class="line">      margin-left: 5px;</span><br><span class="line">      margin-right: 40px;</span><br><span class="line">      color: var(--er-text-color-regular);</span><br><span class="line">      svg &#123;</span><br><span class="line">        margin-right: 5px;</span><br><span class="line">        color: var(--er-text-color-regular);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .file-name-error &#123;</span><br><span class="line">      color: var(--er-color-danger);</span><br><span class="line">    &#125;</span><br><span class="line">    .file-status-success &#123;</span><br><span class="line">      color: var(--er-color-success);</span><br><span class="line">    &#125;</span><br><span class="line">    .file-status-error &#123;</span><br><span class="line">      color: var(--er-color-danger);</span><br><span class="line">    &#125;</span><br><span class="line">    .file-status &#123;</span><br><span class="line">      display: block;</span><br><span class="line">      position: absolute;</span><br><span class="line">      right: 5px;</span><br><span class="line">      top: 0;</span><br><span class="line">      line-height: inherit;</span><br><span class="line">    &#125;</span><br><span class="line">    .file-action &#123;</span><br><span class="line">      display: none;</span><br><span class="line">      position: absolute;</span><br><span class="line">      right: 7px;</span><br><span class="line">      top: 0;</span><br><span class="line">      line-height: inherit;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;:hover &#123;</span><br><span class="line">      background-color: var(--er-fill-color-light);</span><br><span class="line">      .file-status &#123;</span><br><span class="line">        display: none;</span><br><span class="line">      &#125;</span><br><span class="line">      .file-action &#123;</span><br><span class="line">        display: block;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="├─-index-test-ts"><a href="#├─-index-test-ts" class="headerlink" title="├─ index.test.ts"></a>├─ index.test.ts</h3><blockquote></blockquote><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Plugin</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; describe, it, expect &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">ErAlert</span>,</span><br><span class="line">  <span class="title class_">ErButton</span>,</span><br><span class="line">  <span class="title class_">ErButtonGroup</span>,</span><br><span class="line">  <span class="title class_">ErCollapse</span>,</span><br><span class="line">  <span class="title class_">ErCollapseItem</span>,</span><br><span class="line">  <span class="title class_">ErDropdown</span>,</span><br><span class="line">  <span class="title class_">ErDropdownItem</span>,</span><br><span class="line">  <span class="title class_">ErForm</span>,</span><br><span class="line">  <span class="title class_">ErFormItem</span>,</span><br><span class="line">  <span class="title class_">ErIcon</span>,</span><br><span class="line">  <span class="title class_">ErInput</span>,</span><br><span class="line">  <span class="title class_">ErLoading</span>,</span><br><span class="line">  <span class="title class_">ErLoadingDirective</span>,</span><br><span class="line">  <span class="title class_">ErLoadingService</span>,</span><br><span class="line">  <span class="title class_">ErMessage</span>,</span><br><span class="line">  <span class="title class_">ErMessageBox</span>,</span><br><span class="line">  <span class="title class_">ErNotification</span>,</span><br><span class="line">  <span class="title class_">ErOption</span>,</span><br><span class="line">  <span class="title class_">ErPopconfirm</span>,</span><br><span class="line">  <span class="title class_">ErSelect</span>,</span><br><span class="line">  <span class="title class_">ErSwitch</span>,</span><br><span class="line">  <span class="title class_">ErTooltip</span>,</span><br><span class="line">  <span class="title class_">ErUpload</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./index&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; map, get &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> components = [</span><br><span class="line">  <span class="title class_">ErButton</span>,</span><br><span class="line">  <span class="title class_">ErButtonGroup</span>,</span><br><span class="line">  <span class="title class_">ErCollapse</span>,</span><br><span class="line">  <span class="title class_">ErCollapseItem</span>,</span><br><span class="line">  <span class="title class_">ErIcon</span>,</span><br><span class="line">  <span class="title class_">ErDropdown</span>,</span><br><span class="line">  <span class="title class_">ErDropdownItem</span>,</span><br><span class="line">  <span class="title class_">ErTooltip</span>,</span><br><span class="line">  <span class="title class_">ErMessage</span>,</span><br><span class="line">  <span class="title class_">ErInput</span>,</span><br><span class="line">  <span class="title class_">ErSwitch</span>,</span><br><span class="line">  <span class="title class_">ErSelect</span>,</span><br><span class="line">  <span class="title class_">ErOption</span>,</span><br><span class="line">  <span class="title class_">ErForm</span>,</span><br><span class="line">  <span class="title class_">ErFormItem</span>,</span><br><span class="line">  <span class="title class_">ErAlert</span>,</span><br><span class="line">  <span class="title class_">ErNotification</span>,</span><br><span class="line">  <span class="title class_">ErLoading</span>,</span><br><span class="line">  <span class="title class_">ErUpload</span>,</span><br><span class="line">  <span class="title class_">ErPopconfirm</span>,</span><br><span class="line">  <span class="title class_">ErMessageBox</span>,</span><br><span class="line">] <span class="keyword">as</span> <span class="title class_">Plugin</span>[];</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;components/index.ts&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it.<span class="title function_">each</span>(<span class="title function_">map</span>(components, <span class="function">(<span class="params">c</span>) =&gt;</span> [<span class="title function_">get</span>(c, <span class="string">&quot;name&quot;</span>) ?? <span class="string">&quot;&quot;</span>, c]))(<span class="string">&quot;%s should be exported&quot;</span>, <span class="function">(<span class="params">_, component</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(component).<span class="title function_">toBeDefined</span>();</span><br><span class="line">    <span class="title function_">expect</span>(component.<span class="property">install</span>).<span class="title function_">toBeDefined</span>()</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;ErLoadingService and ErLoadingDirective should be exported&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErLoadingService</span>).<span class="title function_">toBeDefined</span>()</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title class_">ErLoadingDirective</span>).<span class="title function_">toBeDefined</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="├─-index-ts-18"><a href="#├─-index-ts-18" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h3><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./ConfigProvider&#x27;</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Icon&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Button&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Collapse&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Dropdown&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Message&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Tooltip&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Input&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Switch&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Select&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Form&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Alert&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Notification&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Loading&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Upload&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./Popconfirm&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./MessageBox&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="└─-package-json"><a href="#└─-package-json" class="headerlink" title="└─ package.json"></a>└─ package.json</h3><p><strong>项目依赖</strong></p><blockquote><p>无</p></blockquote><p><strong>开发依赖</strong></p><blockquote><ul><li><code>axios</code>：HTTP 客户端（用于测试或示例）。</li></ul></blockquote><h2 id="├─-constants"><a href="#├─-constants" class="headerlink" title="├─ constants"></a>├─ <em><del>constants</del></em></h2><blockquote><p>常量系统</p></blockquote><h3 id="├─-index-ts-19"><a href="#├─-index-ts-19" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h3><h3 id="├─-key-ts"><a href="#├─-key-ts" class="headerlink" title="├─ key.ts"></a>├─ key.ts</h3><h3 id="└─-package-json-1"><a href="#└─-package-json-1" class="headerlink" title="└─ package.json"></a>└─ package.json</h3><p><strong>项目依赖</strong></p><blockquote><p>空包</p></blockquote><p><strong>开发依赖</strong></p><blockquote><p><code>axios</code>：HTTP 客户端（用于测试或示例）。</p></blockquote><h2 id="├─-core"><a href="#├─-core" class="headerlink" title="├─ core"></a>├─ core</h2><blockquote><p>核心包托管模式</p><p>npm包的入口，同时作为 components 的唯一出口</p><p>负责聚合所有子模块（如 <code>components</code>, <code>hooks</code>, <code>theme</code>, <code>utils</code> 等）的功能，并提供给外部使用</p></blockquote><h3 id="├─-build"><a href="#├─-build" class="headerlink" title="├─ build"></a>├─ build</h3><blockquote><p>构建入口</p><p>放vite的两个配置文件</p></blockquote><h4 id="├─-vite-es-config-ts"><a href="#├─-vite-es-config-ts" class="headerlink" title="├─ vite.es.config.ts"></a>├─ vite.es.config.ts</h4><blockquote><p>ES Module 构建</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; readdirSync, readdir &#125; <span class="keyword">from</span> <span class="string">&quot;fs&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defer, delay, filter, map, includes &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; visualizer &#125; <span class="keyword">from</span> <span class="string">&quot;rollup-plugin-visualizer&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hooksPlugin <span class="keyword">as</span> hooks &#125; <span class="keyword">from</span> <span class="string">&quot;@tyche/vite-plugins&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> shell <span class="keyword">from</span> <span class="string">&quot;shelljs&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> dts <span class="keyword">from</span> <span class="string">&quot;vite-plugin-dts&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> terser <span class="keyword">from</span> <span class="string">&quot;@rollup/plugin-terser&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TRY_MOVE_STYLES_DELAY</span> = <span class="number">750</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isProd = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> isDev = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;development&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> isTest = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;test&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDirectoriesSync</span>(<span class="params"><span class="attr">basePath</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = <span class="title function_">readdirSync</span>(basePath, &#123; <span class="attr">withFileTypes</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">map</span>(</span><br><span class="line">    <span class="title function_">filter</span>(entries, <span class="function">(<span class="params">entry</span>) =&gt;</span> entry.<span class="title function_">isDirectory</span>()),</span><br><span class="line">    <span class="function">(<span class="params">entry</span>) =&gt;</span> entry.<span class="property">name</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">moveStyles</span>(<span class="params"></span>) &#123; <span class="comment">//在构建完成后，将 dist/es/theme 目录移动到 dist 目录</span></span><br><span class="line">  <span class="title function_">readdir</span>(<span class="string">&quot;./dist/es/theme&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="title function_">delay</span>(moveStyles, <span class="variable constant_">TRY_MOVE_STYLES_DELAY</span>);</span><br><span class="line">    <span class="title function_">defer</span>(<span class="function">() =&gt;</span> shell.<span class="title function_">mv</span>(<span class="string">&quot;./dist/es/theme&quot;</span>, <span class="string">&quot;./dist&quot;</span>));<span class="comment">//使用 shell.mv 命令执行移动操作，通过 defer 和 delay 处理异步操作</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>(),<span class="comment">//支持 Vue 3 的单文件组件</span></span><br><span class="line">    <span class="title function_">visualizer</span>(&#123;<span class="comment">//生成构建性能分析报告（dist/stats.es.html</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;dist/stats.es.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">dts</span>(&#123;<span class="comment">//生成 TypeScript 类型定义文件（dist/types/core/index.d.ts）</span></span><br><span class="line">      <span class="attr">tsconfigPath</span>: <span class="string">&quot;../../tsconfig.build.json&quot;</span>,</span><br><span class="line">      <span class="attr">outDir</span>: <span class="string">&quot;dist/types&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">terser</span>(&#123;<span class="comment">//压缩代码（仅生产环境启用）</span></span><br><span class="line">      <span class="attr">compress</span>: &#123;</span><br><span class="line">        <span class="attr">sequences</span>: isProd,</span><br><span class="line">        <span class="attr">arguments</span>: isProd,</span><br><span class="line">        <span class="attr">drop_console</span>: isProd &amp;&amp; [<span class="string">&quot;log&quot;</span>],</span><br><span class="line">        <span class="attr">drop_debugger</span>: isProd,</span><br><span class="line">        <span class="attr">passes</span>: isProd ? <span class="number">4</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">global_defs</span>: &#123;</span><br><span class="line">          <span class="string">&quot;@DEV&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isDev),</span><br><span class="line">          <span class="string">&quot;@PROD&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isProd),</span><br><span class="line">          <span class="string">&quot;@TEST&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isTest),</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">format</span>: &#123;</span><br><span class="line">        <span class="attr">semicolons</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">shorthand</span>: isProd,</span><br><span class="line">        <span class="attr">braces</span>: !isProd,</span><br><span class="line">        <span class="attr">beautify</span>: !isProd,</span><br><span class="line">        <span class="attr">comments</span>: !isProd,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">mangle</span>: &#123;</span><br><span class="line">        <span class="attr">toplevel</span>: isProd,</span><br><span class="line">        <span class="attr">eval</span>: isProd,</span><br><span class="line">        <span class="attr">keep_classnames</span>: isDev,</span><br><span class="line">        <span class="attr">keep_fnames</span>: isDev,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">hooks</span>(&#123;<span class="comment">//自定义构建钩子，如清理文件和移动 CSS 文件</span></span><br><span class="line">      <span class="attr">rmFiles</span>: [</span><br><span class="line">        <span class="string">&quot;./dist/es&quot;</span>,</span><br><span class="line">        <span class="string">&quot;./dist/theme&quot;</span>,</span><br><span class="line">        <span class="string">&quot;./dist/types&quot;</span>,</span><br><span class="line">        <span class="string">&quot;./dist/stats.es.html&quot;</span>,</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">afterBuild</span>: moveStyles,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">outDir</span>: <span class="string">&quot;dist/es&quot;</span>,<span class="comment">//输出目录为 dist/es</span></span><br><span class="line">    <span class="attr">minify</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">cssCodeSplit</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">sourcemap</span>: !isProd,</span><br><span class="line">    <span class="attr">lib</span>: &#123;<span class="comment">//配置库的</span></span><br><span class="line">      <span class="attr">entry</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../index.ts&quot;</span>),<span class="comment">//入口文件</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;EricUI&quot;</span>,<span class="comment">//名称</span></span><br><span class="line">      <span class="attr">fileName</span>: <span class="string">&quot;index&quot;</span>,<span class="comment">//文件名</span></span><br><span class="line">      <span class="attr">formats</span>: [<span class="string">&quot;es&quot;</span>],<span class="comment">//格式</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">      <span class="attr">external</span>: [<span class="comment">//声明外部依赖，避免打包到最终输出中。</span></span><br><span class="line">        <span class="string">&quot;vue&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@fortawesome/fontawesome-svg-core&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@fortawesome/free-solid-svg-icons&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@fortawesome/vue-fontawesome&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@popperjs/core&quot;</span>,</span><br><span class="line">        <span class="string">&quot;async-validator&quot;</span>,</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">assetFileNames</span>: <span class="function">(<span class="params">chunkInfo</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (chunkInfo.<span class="property">name</span> === <span class="string">&quot;style.css&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;index.css&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (</span><br><span class="line">            chunkInfo.<span class="property">type</span> === <span class="string">&quot;asset&quot;</span> &amp;&amp;</span><br><span class="line">            <span class="regexp">/\.(css)$/i</span>.<span class="title function_">test</span>(chunkInfo.<span class="property">name</span> <span class="keyword">as</span> <span class="built_in">string</span>)</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;theme/[name].[ext]&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> chunkInfo.<span class="property">name</span> <span class="keyword">as</span> <span class="built_in">string</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">manualChunks</span>(<span class="params">id</span>) &#123;<span class="comment">//手动分块策略</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">includes</span>(id, <span class="string">&quot;node_modules&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;vendor&quot;</span>;<span class="comment">//第三方库</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">includes</span>(id, <span class="string">&quot;/packages/hooks&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;hooks&quot;</span>;<span class="comment">//自定义钩子</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">includes</span>(id, <span class="string">&quot;/packages/utils&quot;</span>) || <span class="title function_">includes</span>(id, <span class="string">&quot;plugin-vue:export-helper&quot;</span>)) <span class="keyword">return</span> <span class="string">&quot;utils&quot;</span>;<span class="comment">//工具函数</span></span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="title function_">getDirectoriesSync</span>(<span class="string">&quot;../components&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">//组件目录（如 components/xxx） → 对应组件名称的分块</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">includes</span>(id, <span class="string">`/packages/components/<span class="subst">$&#123;item&#125;</span>`</span>)) <span class="keyword">return</span> item;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="└─-vite-umd-config-ts"><a href="#└─-vite-umd-config-ts" class="headerlink" title="└─ vite.umd.config.ts"></a>└─ vite.umd.config.ts</h4><blockquote><p>UMD 构建</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; readFile &#125; <span class="keyword">from</span> <span class="string">&quot;fs&quot;</span>;<span class="comment">//同步读取（文件）</span></span><br><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defer, delay &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; visualizer &#125; <span class="keyword">from</span> <span class="string">&quot;rollup-plugin-visualizer&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hooksPlugin <span class="keyword">as</span> hooks &#125; <span class="keyword">from</span> <span class="string">&quot;@tyche/vite-plugins&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> shell <span class="keyword">from</span> <span class="string">&quot;shelljs&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> compression <span class="keyword">from</span> <span class="string">&quot;vite-plugin-compression&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> terser <span class="keyword">from</span> <span class="string">&quot;@rollup/plugin-terser&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TRY_MOVE_STYLES_DELAY</span> = <span class="number">750</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isProd = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> isDev = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;development&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> isTest = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;test&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">moveStyles</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">readFile</span>(<span class="string">&quot;./dist/umd/index.css.gz&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="title function_">delay</span>(moveStyles, <span class="variable constant_">TRY_MOVE_STYLES_DELAY</span>);</span><br><span class="line">    <span class="title function_">defer</span>(<span class="function">() =&gt;</span> shell.<span class="title function_">cp</span>(<span class="string">&quot;./dist/umd/index.css&quot;</span>, <span class="string">&quot;./dist/index.css&quot;</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>(),</span><br><span class="line">    <span class="title function_">compression</span>(&#123;</span><br><span class="line">      <span class="attr">filter</span>: <span class="regexp">/.(cjs|css)$/i</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">visualizer</span>(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;dist/stats.umd.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">terser</span>(&#123;</span><br><span class="line">      <span class="attr">compress</span>: &#123;</span><br><span class="line">        <span class="attr">drop_console</span>: [<span class="string">&quot;log&quot;</span>],</span><br><span class="line">        <span class="attr">drop_debugger</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">passes</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">global_defs</span>: &#123;</span><br><span class="line">          <span class="string">&quot;@DEV&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isDev),</span><br><span class="line">          <span class="string">&quot;@PROD&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isProd),</span><br><span class="line">          <span class="string">&quot;@TEST&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(isTest),</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">hooks</span>(&#123;</span><br><span class="line">      <span class="attr">rmFiles</span>: [<span class="string">&quot;./dist/umd&quot;</span>, <span class="string">&quot;./dist/index.css&quot;</span>, <span class="string">&quot;./dist/stats.umd.html&quot;</span>],</span><br><span class="line">      <span class="attr">afterBuild</span>: moveStyles,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">outDir</span>: <span class="string">&quot;dist/umd&quot;</span>,</span><br><span class="line">    <span class="attr">lib</span>: &#123;</span><br><span class="line">      <span class="attr">entry</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../index.ts&quot;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;EricUI&quot;</span>,</span><br><span class="line">      <span class="attr">fileName</span>: <span class="string">&quot;index&quot;</span>,</span><br><span class="line">      <span class="attr">formats</span>: [<span class="string">&quot;umd&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">      <span class="attr">external</span>: [<span class="string">&quot;vue&quot;</span>],</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">exports</span>: <span class="string">&quot;named&quot;</span>,</span><br><span class="line">        <span class="attr">globals</span>: &#123;</span><br><span class="line">          <span class="attr">vue</span>: <span class="string">&quot;Vue&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">assetFileNames</span>: <span class="function">(<span class="params">chunkInfo</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (chunkInfo.<span class="property">name</span> === <span class="string">&quot;style.css&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;index.css&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> chunkInfo.<span class="property">name</span> <span class="keyword">as</span> <span class="built_in">string</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="├─-componens-ts"><a href="#├─-componens-ts" class="headerlink" title="├─ componens.ts"></a>├─ <em><del>componens.ts</del></em></h3><blockquote><p>集中导出组件</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ErButton</span>, <span class="title class_">ErButtonGroup</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@tyche/components&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Plugin</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [<span class="title class_">ErButton</span>, <span class="title class_">ErButtonGroup</span>] <span class="keyword">as</span> <span class="title class_">Plugin</span>[]</span><br></pre></td></tr></table></figure><blockquote><p>将组件注册为 Vue 插件，用户通过 <code>app.use(Tyche)</code> 可以一次性安装所有组件。</p></blockquote><h3 id="├─-index-ts-20"><a href="#├─-index-ts-20" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h3><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; library &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/fontawesome-svg-core&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fas &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/free-solid-svg-icons&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; makeInstaller &#125; <span class="keyword">from</span> <span class="string">&#x27;@tyche/utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> components <span class="keyword">from</span> <span class="string">&#x27;./components&#x27;</span></span><br><span class="line"><span class="keyword">import</span> printLogo <span class="keyword">from</span> <span class="string">&quot;./pringLogo&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@tyche/theme/index.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">printLogo</span>();</span><br><span class="line"></span><br><span class="line">library.<span class="title function_">add</span>(fas);</span><br><span class="line"><span class="keyword">const</span> installer = <span class="title function_">makeInstaller</span>(components);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;@tyche/components&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> installer</span><br></pre></td></tr></table></figure><h3 id="├─-makeInstaller-ts"><a href="#├─-makeInstaller-ts" class="headerlink" title="├─ makeInstaller.ts"></a>├─ <em><del>makeInstaller.ts</del></em></h3><blockquote><p>全局注册+构建配置</p><p><strong>插件安装器</strong>：将组件集合转换为 Vue 插件，并支持全局配置（如主题、国际化）</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">makeInstaller</span>(<span class="params"><span class="attr">components</span>: <span class="title class_">Plugin</span>[]</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">install</span> = (<span class="params"><span class="attr">app</span>: <span class="title class_">App</span>, <span class="attr">options</span>?: <span class="title class_">ConfigProviderProps</span></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">get</span>(app, <span class="variable constant_">INSTALLED_KEY</span>)) <span class="keyword">return</span>;</span><br><span class="line">        <span class="title function_">set</span>(app, <span class="variable constant_">INSTALLED_KEY</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="title function_">each</span>(components, <span class="function">(<span class="params">c</span>) =&gt;</span> app.<span class="title function_">use</span>(c));</span><br><span class="line">        <span class="keyword">if</span> (options) <span class="title function_">provideGlobalConfig</span>(options, app, <span class="literal">true</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> install;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>防止重复安装插件。</li><li>通过 <code>app.use</code> 注册所有组件。</li><li>支持全局配置（如通过 <code>provideGlobalConfig</code> 提供主题或默认选项）。</li></ul></blockquote><h3 id="├─-package-json-1"><a href="#├─-package-json-1" class="headerlink" title="├─ package.json"></a>├─ <em><del>package.json</del></em></h3><p><strong>项目依赖</strong></p><blockquote><ul><li><code>@fortawesome/fontawesome-svg-core</code></li><li><code>@fortawesome/free-solid-svg-icons</code></li><li><code>@fortawesome/vue-fontawesome</code></li><li><code>@popperjs/core</code></li><li><code>async-validator</code></li></ul></blockquote><p><strong>开发依赖</strong></p><blockquote><ul><li><code>@rollup/plugin-terser</code>：Rollup 压缩插件</li><li><code>rollup-plugin-visualizer</code>：打包分析插件</li><li><code>vite-plugin-compression</code>：文件压缩插件</li></ul></blockquote><p><strong>项目元数据与依赖管理</strong>：定义构建目标、入口文件、依赖关系等</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tyche&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;使用 Vue3 + Ts 构建的组件库&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;module&quot;</span><span class="punctuation">,</span><span class="comment">//指定使用 ES 模块</span></span><br><span class="line">    <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;dist&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sideEffects&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;./dist/index.css&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;./dist/theme/*.css&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/umd/index.umd.cjs&quot;</span><span class="punctuation">,</span><span class="comment">//CommonJS 格式的入口文件</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/es/index.js&quot;</span><span class="punctuation">,</span><span class="comment">//ESM 格式的入口文件</span></span><br><span class="line">    <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/types/core/index.d.ts&quot;</span><span class="punctuation">,</span><span class="comment">//TypeScript 类型定义文件的位置</span></span><br><span class="line">    <span class="attr">&quot;exports&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//定义模块导出路径</span></span><br><span class="line">        <span class="attr">&quot;.&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//分别指向不同环境的入口文件</span></span><br><span class="line">            <span class="attr">&quot;import&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/es/index.js&quot;</span><span class="punctuation">,</span> <span class="comment">//ESM 入口</span></span><br><span class="line">            <span class="attr">&quot;require&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/umd/index.umd.cjs&quot;</span><span class="punctuation">,</span> <span class="comment">//CommonJS 入口</span></span><br><span class="line">            <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/types/core/index.d.ts&quot;</span> <span class="comment">//TypeScript 类型定义</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;./dist/&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//额外指定了对 dist 目录下资源的导入规则</span></span><br><span class="line">            <span class="attr">&quot;import&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;require&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;run-p build-es build-umd&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build:watch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;run-p build-es:watch build-umd:watch&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build-es&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build --config build/vite.es.config.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build-umd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build --config build/vite.umd.config.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build-es:watch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build --watch --config build/vite.es.config.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build-umd:watch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build --watch --config build/vite.umd.config.ts&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;keywords&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Breezli&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span><span class="punctuation">,</span><span class="comment">//许可证类型为 ISC，一个简化的开源许可证</span></span><br><span class="line">    <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//开发环境</span></span><br><span class="line">        <span class="attr">&quot;@rollup/plugin-terser&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.4.4&quot;</span><span class="punctuation">,</span><span class="comment">//Rollup 插件，用于压缩代码</span></span><br><span class="line">        <span class="attr">&quot;rollup-plugin-visualizer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.12.0&quot;</span><span class="punctuation">,</span><span class="comment">//提供构建结果的可视化分析</span></span><br><span class="line">        <span class="attr">&quot;terser&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.31.0&quot;</span><span class="punctuation">,</span><span class="comment">//JavaScript 解析器和压缩工具</span></span><br><span class="line">        <span class="attr">&quot;vite-plugin-compression&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.5.1&quot;</span><span class="comment">//Vite 插件，用于压缩资源文件</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;@fortawesome/fontawesome-svg-core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.5.1&quot;</span><span class="punctuation">,</span><span class="comment">//FontAwesome 图标集</span></span><br><span class="line">        <span class="attr">&quot;@fortawesome/free-solid-svg-icons&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.5.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;@fortawesome/vue-fontawesome&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;@popperjs/core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.11.8&quot;</span><span class="punctuation">,</span><span class="comment">//Popper.js 核心库，通常用于定位提示框、菜单等元素</span></span><br><span class="line">        <span class="attr">&quot;async-validator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.2.5&quot;</span><span class="comment">//异步表单验证库</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;peerDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.4.27&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>&#x2F;&#x2F;&#x2F; <em>补充：peerDependencies</em> &#x2F;&#x2F;&#x2F;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">├── helloWorld</span><br><span class="line">│   └── node_modules</span><br><span class="line">│       ├── packageA</span><br><span class="line">│       ├── plugin1</span><br><span class="line">│       │   └── nodule_modules</span><br><span class="line">│       │       └── packageA</span><br><span class="line">│       └── plugin2</span><br><span class="line">│       │   └── nodule_modules</span><br><span class="line">│       │       └── packageA</span><br></pre></td></tr></table></figure><blockquote><p>packageA 核心依赖库被重复下载</p></blockquote><p>此时我们应该在</p><p><strong><code>plugin1 /package.json</code></strong>  <em>&amp;</em>  <strong><code>plugin2 /package.json</code></strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;peerDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;packageA&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong><code>/package.json</code></strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;packageA&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>结构就变成了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">├── helloWorld</span><br><span class="line">│   └── node_modules</span><br><span class="line">│       ├── packageA</span><br><span class="line">│       ├── plugin1</span><br><span class="line">│       └── plugin2</span><br></pre></td></tr></table></figure><blockquote><p>通常用于库或插件，这些库或插件不直接包含在最终应用中，但需要与其他包协同工作</p><p>当你安装一个包时，如果该包有peerDependencies，npm或yarn会检查这些依赖是否已经安装在项目中，如果没有，它会给出警告，但不会默认安装它们</p></blockquote><h3 id="└─-pringLogo-ts"><a href="#└─-pringLogo-ts" class="headerlink" title="└─ pringLogo.ts"></a>└─ <em><del>pringLogo.ts</del></em></h3><blockquote><p><strong>构建时输出 Logo 和提示信息</strong>：在生产环境构建时打印彩色 Logo，在开发环境提示当前模式。</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable constant_">PROD</span>) &#123; <span class="comment">// 项目正在`生产环境`中运行</span></span><br><span class="line">    <span class="keyword">const</span> logo = <span class="string">`...`</span>; <span class="comment">// 彩色渐变的 EricUI Logo 文字</span></span><br><span class="line">    <span class="keyword">const</span> rainbowGradient = <span class="string">`...`</span>; <span class="comment">// CSS 样式</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`%c<span class="subst">$&#123;logo&#125;</span>`</span>, rainbowGradient);</span><br><span class="line">      <span class="comment">//%c 是占位符，表示接下来的一个参数 (rainbowGradient) 应该被解释为CSS样式。</span></span><br><span class="line">      <span class="comment">//$&#123;logo&#125; 是实际要打印到控制台的文字内容（即那个ASCII艺术风格的logo）。</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable constant_">DEV</span>) &#123; <span class="comment">// 项目处于`开发模式`下</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[EricUI]:dev mode...&quot;</span>); <span class="comment">// 简单地向控制台输出一条 &quot;[EricUI]:dev mode...&quot;。有助于开发者快速识别项目的当前状态是处于开发阶段</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="├─-docs"><a href="#├─-docs" class="headerlink" title="├─ docs"></a>├─ <em><del>docs</del></em></h2><blockquote><p>组件库项目文档，vitepress站点</p></blockquote><h3 id="├─-vitepress"><a href="#├─-vitepress" class="headerlink" title="├─ .vitepress"></a>├─ .vitepress</h3><h4 id="├─-config-ts"><a href="#├─-config-ts" class="headerlink" title="├─ config.ts"></a>├─ config.ts</h4><h4 id="└─-theme"><a href="#└─-theme" class="headerlink" title="└─ theme"></a>└─ theme</h4><h5 id="└─-index-ts"><a href="#└─-index-ts" class="headerlink" title="└─ index.ts"></a>└─ index.ts</h5><h3 id="├─-components-1"><a href="#├─-components-1" class="headerlink" title="├─ components"></a>├─ components</h3><h4 id="├─-alert-md"><a href="#├─-alert-md" class="headerlink" title="├─ alert.md"></a>├─ alert.md</h4><h4 id="├─-button-md"><a href="#├─-button-md" class="headerlink" title="├─ button.md"></a>├─ button.md</h4><h4 id="├─-collapse-md"><a href="#├─-collapse-md" class="headerlink" title="├─ collapse.md"></a>├─ collapse.md</h4><h4 id="├─-dropdown-md"><a href="#├─-dropdown-md" class="headerlink" title="├─ dropdown.md"></a>├─ dropdown.md</h4><h4 id="├─-form-md"><a href="#├─-form-md" class="headerlink" title="├─ form.md"></a>├─ form.md</h4><h4 id="├─-loading-md"><a href="#├─-loading-md" class="headerlink" title="├─ loading.md"></a>├─ loading.md</h4><h4 id="├─-message-md"><a href="#├─-message-md" class="headerlink" title="├─ message.md"></a>├─ message.md</h4><h4 id="├─-messagebox-md"><a href="#├─-messagebox-md" class="headerlink" title="├─ messagebox.md"></a>├─ messagebox.md</h4><h4 id="├─-notification-md"><a href="#├─-notification-md" class="headerlink" title="├─ notification.md"></a>├─ notification.md</h4><h4 id="├─-popconfirm-md"><a href="#├─-popconfirm-md" class="headerlink" title="├─ popconfirm.md"></a>├─ popconfirm.md</h4><h4 id="└─-tooltip-md"><a href="#└─-tooltip-md" class="headerlink" title="└─ tooltip.md"></a>└─ tooltip.md</h4><h3 id="├─-demo"><a href="#├─-demo" class="headerlink" title="├─ demo"></a>├─ demo</h3><h4 id="├─-alert"><a href="#├─-alert" class="headerlink" title="├─ alert"></a>├─ alert</h4><p>├─ Basic.vue<br>├─ Close.vue<br>├─ Desc.vue<br>├─ IconDesc.vue<br>├─ ShowIcon.vue<br>├─ TextCenter.vue<br>└─ Theme.vue</p><h4 id="├─-button"><a href="#├─-button" class="headerlink" title="├─ button"></a>├─ button</h4><p>├─ Basic.vue<br>├─ Disabled.vue<br>├─ Group.vue<br>├─ Icon.vue<br>├─ Loading.vue<br>├─ Size.vue<br>├─ Tag.vue<br>└─ Throttle.vue</p><h4 id="├─-collapse"><a href="#├─-collapse" class="headerlink" title="├─ collapse"></a>├─ collapse</h4><p>├─ Accordion.vue<br>├─ Basic.vue<br>├─ CustomTitle.vue<br>└─ Disabled.vue</p><h4 id="│-│-│-├─-dropdown"><a href="#│-│-│-├─-dropdown" class="headerlink" title="│  │  │  ├─ dropdown"></a>│  │  │  ├─ dropdown</h4><p>├─ Basic.vue<br>├─ Command.vue<br>├─ Disabled.vue<br>├─ HideOnClick.vue<br>├─ InstanceMethod.vue<br>├─ Size.vue<br>├─ SplitButton.vue<br>└─ Trigger.vue</p><h4 id="├─-form"><a href="#├─-form" class="headerlink" title="├─ form"></a>├─ form</h4><p>├─ Basic.vue<br>├─ CustomValidate.vue<br>├─ Position.vue<br>└─ Validate.vue</p><h4 id="├─-loading"><a href="#├─-loading" class="headerlink" title="├─ loading"></a>├─ loading</h4><p>├─ Basic.vue<br>├─ Custom.vue<br>└─ Fullscreen.vue</p><h4 id="├─-message"><a href="#├─-message" class="headerlink" title="├─ message"></a>├─ message</h4><p>├─ Basic.vue<br>├─ Center.vue<br>├─ Closeable.vue<br>├─ Test.vue<br>└─ Type.vue</p><h4 id="├─-messagebox"><a href="#├─-messagebox" class="headerlink" title="├─ messagebox"></a>├─ messagebox</h4><p>├─ Alert.vue<br>├─ Center.vue<br>├─ Confirm.vue<br>├─ Custom.vue<br>├─ Prompt.vue<br>└─ VNode.vue</p><h4 id="├─-notification"><a href="#├─-notification" class="headerlink" title="├─ notification"></a>├─ notification</h4><p>├─ Basic.vue<br>├─ Closeable.vue<br>└─ Type.vue</p><h4 id="├─-popconfirm"><a href="#├─-popconfirm" class="headerlink" title="├─ popconfirm"></a>├─ popconfirm</h4><p>├─ Basic.vue<br>├─ Callback.vue<br>└─ Custom.vue</p><h4 id="└─-tooltip"><a href="#└─-tooltip" class="headerlink" title="└─ tooltip"></a>└─ tooltip</h4><p>├─ Basic.vue<br>├─ Disabled.vue<br>└─ Slot.vue</p><h3 id="├─-get-started-md"><a href="#├─-get-started-md" class="headerlink" title="├─ get-started.md"></a>├─ get-started.md</h3><h3 id="├─-index-md"><a href="#├─-index-md" class="headerlink" title="├─ index.md"></a>├─ index.md</h3><h3 id="└─-package-json-2"><a href="#└─-package-json-2" class="headerlink" title="└─ package.json"></a>└─ package.json</h3><p><strong>依赖（dependencies）</strong></p><blockquote><p><strong>无</strong>（通过根目录继承）。</p></blockquote><p><strong>开发依赖（devDependencies）</strong></p><blockquote><ul><li><code>@vitepress-demo-preview/component</code>：VitePress 组件预览插件</li><li><code>@vitepress-demo-preview/plugin</code>：VitePress 插件</li><li><code>vitepress</code>：文档框架</li></ul></blockquote><h2 id="├─-hooks"><a href="#├─-hooks" class="headerlink" title="├─ hooks"></a>├─ <em><del>hooks</del></em></h2><blockquote><p>钩子函数, 自定义的 Vue 组合式 API</p><p>逻辑复用, 用于处理各种功能需求</p></blockquote><h3 id="├─-index-ts-21"><a href="#├─-index-ts-21" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h3><blockquote><p><code>hooks</code> 的入口文件，导出所有 API</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useClickOutside <span class="keyword">from</span> <span class="string">&quot;./useClickOutside&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useEventListener <span class="keyword">from</span> <span class="string">&quot;./useEventListener&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useFocusController <span class="keyword">from</span> <span class="string">&quot;./useFocusController&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useZIndex <span class="keyword">from</span> <span class="string">&quot;./useZIndex&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useProp <span class="keyword">from</span> <span class="string">&quot;./useProp&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useDisabledStyle <span class="keyword">from</span> <span class="string">&quot;./useDisabledStyle&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useId <span class="keyword">from</span> <span class="string">&quot;./useId&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useLocale <span class="keyword">from</span> <span class="string">&quot;./useLocale&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useOffset <span class="keyword">from</span> <span class="string">&quot;./useOffset&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  useClickOutside,</span><br><span class="line">  useEventListener,</span><br><span class="line">  useZIndex,</span><br><span class="line">  useProp,</span><br><span class="line">  useFocusController,</span><br><span class="line">  useDisabledStyle,</span><br><span class="line">  useLocale,</span><br><span class="line">  useOffset,</span><br><span class="line">  useId,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="├─-package-json-2"><a href="#├─-package-json-2" class="headerlink" title="├─ package.json"></a>├─ package.json</h3><p><strong>依赖</strong></p><blockquote><p>无</p></blockquote><p><strong>peerDependencies（必须由用户安装）</strong></p><blockquote><ul><li><code>vue</code>：Vue 3 核心库</li><li><code>lodash-es</code>：Lodash 的 ES 模块版本</li></ul></blockquote><h3 id="├─-useClickOutside-ts"><a href="#├─-useClickOutside-ts" class="headerlink" title="├─ useClickOutside.ts"></a>├─ useClickOutside.ts</h3><blockquote><p>监听用户是否点击了某个 DOM 元素之外的区域</p></blockquote><blockquote><p>实现 <strong>下拉菜单</strong>、<strong>弹窗</strong> 等需要点击外部关闭的功能</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> useEventListener <span class="keyword">from</span> <span class="string">&#x27;./useEventListener&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useClickOutside</span> (<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">elementRef</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">HTMLElement</span> | <span class="built_in">void</span>&gt;,</span></span><br><span class="line"><span class="params">  <span class="attr">callback</span>: (e: MouseEvent) =&gt; <span class="built_in">void</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">useEventListener</span>(<span class="variable language_">document</span>, <span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params"><span class="attr">e</span>: <span class="title class_">Event</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (elementRef.<span class="property">value</span> &amp;&amp; e.<span class="property">target</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!elementRef.<span class="property">value</span>.<span class="title function_">contains</span>(e.<span class="property">target</span> <span class="keyword">as</span> <span class="title class_">HTMLElement</span>)) &#123;</span><br><span class="line">        <span class="title function_">callback</span>(e <span class="keyword">as</span> <span class="title class_">MouseEvent</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-useDisabledStyle-ts"><a href="#├─-useDisabledStyle-ts" class="headerlink" title="├─ useDisabledStyle.ts"></a>├─ useDisabledStyle.ts</h3><blockquote><p>动态控制组件的禁用样式</p></blockquote><blockquote><p>可以根据 <code>disabled</code> 属性动态添加或移除样式类</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; each, isFunction, cloneDeep, assign &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; watchEffect, useSlots, getCurrentInstance, <span class="keyword">type</span> <span class="title class_">VNode</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_dfs</span> = (<span class="params"><span class="attr">nodes</span>: <span class="title class_">VNode</span>[], <span class="attr">cb</span>: (node: VNode) =&gt; <span class="built_in">void</span></span>) =&gt;</span><br><span class="line">  <span class="title function_">each</span>(nodes, <span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">isFunction</span>(cb) &amp;&amp; <span class="title function_">cb</span>(node);</span><br><span class="line">    node.<span class="property">children</span> &amp;&amp; <span class="title function_">_dfs</span>(node.<span class="property">children</span> <span class="keyword">as</span> <span class="title class_">VNode</span>[], cb);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useDisabledStyle</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> nodePropsMap = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">getCurrentInstance</span>()!;</span><br><span class="line">  <span class="keyword">const</span> children = <span class="title function_">useSlots</span>()?.<span class="property">default</span>?.();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!instance.<span class="property">props</span>?.<span class="property">disabled</span>) &#123;</span><br><span class="line">      <span class="title function_">_dfs</span>(children ?? [], <span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!nodePropsMap.<span class="title function_">has</span>(node)) <span class="keyword">return</span>;</span><br><span class="line">        node.<span class="property">props</span> = nodePropsMap.<span class="title function_">get</span>(node);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">_dfs</span>(children ?? [], <span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!node?.<span class="property">props</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      nodePropsMap.<span class="title function_">set</span>(node, <span class="title function_">cloneDeep</span>(node.<span class="property">props</span>));</span><br><span class="line">      node.<span class="property">props</span> = <span class="title function_">assign</span>(node?.<span class="property">props</span>, &#123;</span><br><span class="line">        <span class="attr">style</span>: &#123;</span><br><span class="line">          <span class="attr">cursor</span>: <span class="string">&quot;not-allowed&quot;</span>,</span><br><span class="line">          <span class="attr">color</span>: <span class="string">&quot;var(--er-text-color-placeholder)&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useDisabledStyle;</span><br></pre></td></tr></table></figure><h3 id="├─-useEventListener-ts"><a href="#├─-useEventListener-ts" class="headerlink" title="├─ useEventListener.ts"></a>├─ useEventListener.ts</h3><blockquote><p>封装了一个通用的 <strong>事件监听器</strong></p></blockquote><blockquote><p>支持在组件生命周期内</p><p>自动绑定和解绑事件</p><p>避免内存泄漏</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  onMounted,</span><br><span class="line">  onBeforeUnmount,</span><br><span class="line">  watch,</span><br><span class="line">  isRef,</span><br><span class="line">  unref,</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">MaybeRef</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useEventListener</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">target</span>: <span class="title class_">MaybeRef</span>&lt;<span class="title class_">EventTarget</span> | <span class="title class_">HTMLElement</span> | <span class="built_in">void</span>&gt;,</span></span><br><span class="line"><span class="params">  <span class="attr">event</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">handler</span>: (e: Event) =&gt; <span class="built_in">any</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isRef</span>(target)) &#123;</span><br><span class="line">    <span class="title function_">watch</span>(target, <span class="function">(<span class="params">val, oldVal</span>) =&gt;</span> &#123;</span><br><span class="line">      oldVal?.<span class="title function_">removeEventListener</span>(event, handler);</span><br><span class="line">      val?.<span class="title function_">addEventListener</span>(event, handler);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> target?.<span class="title function_">addEventListener</span>(event, handler));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> <span class="title function_">unref</span>(target)?.<span class="title function_">removeEventListener</span>(event, handler));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-useFocusController-ts"><a href="#├─-useFocusController-ts" class="headerlink" title="├─ useFocusController.ts"></a>├─ useFocusController.ts</h3><blockquote><p>对焦点的管理功能</p></blockquote><blockquote><p>聚焦某个元素或在多个元素之间切换焦点</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isFunction &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getCurrentInstance, ref, <span class="keyword">type</span> <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useEventListener <span class="keyword">from</span> <span class="string">&quot;./useEventListener&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UseFocusControllerOptions</span> &#123;</span><br><span class="line">  afterFocus?(): <span class="built_in">void</span>;</span><br><span class="line">  beforeBlur?(<span class="attr">event</span>: <span class="title class_">FocusEvent</span>): <span class="built_in">boolean</span> | <span class="built_in">void</span>;</span><br><span class="line">  afterBlur?(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> useFocusController&lt;T <span class="keyword">extends</span> <span class="title class_">HTMLElement</span> | &#123; <span class="title function_">focus</span>(): <span class="built_in">void</span> &#125;&gt;(</span><br><span class="line">  <span class="attr">target</span>: <span class="title class_">Ref</span>&lt;T | <span class="built_in">void</span>&gt;,</span><br><span class="line">  &#123; afterFocus, beforeBlur, afterBlur &#125;: <span class="title class_">UseFocusControllerOptions</span> = &#123;&#125;</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">getCurrentInstance</span>()!;</span><br><span class="line">  <span class="keyword">const</span> &#123; emit &#125; = instance;</span><br><span class="line">  <span class="keyword">const</span> wrapperRef = ref&lt;<span class="title class_">HTMLElement</span>&gt;();</span><br><span class="line">  <span class="keyword">const</span> isFocused = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleFocus</span> = (<span class="params"><span class="attr">event</span>: <span class="title class_">FocusEvent</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (isFocused.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line">    isFocused.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="title function_">emit</span>(<span class="string">&quot;focus&quot;</span>, event);</span><br><span class="line">    afterFocus?.();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleBlur</span> = (<span class="params"><span class="attr">event</span>: <span class="title class_">FocusEvent</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> cancelBlur = <span class="title function_">isFunction</span>(beforeBlur) ? <span class="title function_">beforeBlur</span>(event) : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      cancelBlur ||</span><br><span class="line">      (event.<span class="property">relatedTarget</span> &amp;&amp;</span><br><span class="line">        wrapperRef.<span class="property">value</span>?.<span class="title function_">contains</span>(event.<span class="property">relatedTarget</span> <span class="keyword">as</span> <span class="title class_">Node</span>))</span><br><span class="line">    )</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    isFocused.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="title function_">emit</span>(<span class="string">&quot;blur&quot;</span>, event);</span><br><span class="line">    afterBlur?.();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    target.<span class="property">value</span>?.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEventListener</span>(wrapperRef, <span class="string">&quot;click&quot;</span>, handleClick);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    wrapperRef,</span><br><span class="line">    isFocused,</span><br><span class="line">    handleFocus,</span><br><span class="line">    handleBlur,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useFocusController;</span><br></pre></td></tr></table></figure><h3 id="├─-useId-ts"><a href="#├─-useId-ts" class="headerlink" title="├─ useId.ts"></a>├─ useId.ts</h3><blockquote><p>生成唯一的 ID</p></blockquote><blockquote><p>通常用于组件内部需要唯一标识符的场景</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Ref</span>, computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultIdInjection = &#123;</span><br><span class="line">  <span class="attr">prefix</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10000</span>),</span><br><span class="line">  <span class="attr">current</span>: <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useId</span>(<span class="params"><span class="attr">namespace</span>: <span class="built_in">string</span> = <span class="string">&quot;er&quot;</span></span>): <span class="title class_">Ref</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> idRef = <span class="title function_">computed</span>(</span><br><span class="line">    <span class="function">() =&gt;</span></span><br><span class="line">      <span class="string">`<span class="subst">$&#123;namespace&#125;</span>-id-<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        defaultIdInjection.prefix</span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;</span>-<span class="subst">$&#123;defaultIdInjection.current++&#125;</span>`</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> idRef;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useId;</span><br></pre></td></tr></table></figure><h3 id="├─-useLocale-ts"><a href="#├─-useLocale-ts" class="headerlink" title="├─ useLocale.ts"></a>├─ useLocale.ts</h3><blockquote><p>提供国际化（i18n）支持</p></blockquote><blockquote><p>动态获取当前语言环境下的文本内容</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; inject, <span class="keyword">type</span> <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; omit &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createI18n, i18nSymbol, <span class="keyword">type</span> I18nInstance &#125; <span class="keyword">from</span> <span class="string">&quot;vue3-i18n&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Language</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/locale&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">English</span> <span class="keyword">from</span> <span class="string">&quot;@eric-ui/locale/lang/en&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useLocale</span>(<span class="params"><span class="attr">localeOverrides</span>?: <span class="title class_">Ref</span>&lt;<span class="title class_">Language</span>&gt;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!localeOverrides) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">omit</span>(</span><br><span class="line">      &lt;I18nInstance&gt;(</span><br><span class="line">        <span class="title function_">inject</span>(</span><br><span class="line">          i18nSymbol,</span><br><span class="line">          <span class="title function_">createI18n</span>(&#123; <span class="attr">locale</span>: <span class="title class_">English</span>.<span class="property">name</span>, <span class="attr">messages</span>: &#123; <span class="attr">en</span>: <span class="title class_">English</span>.<span class="property">el</span> &#125; &#125;)</span><br><span class="line">        )</span><br><span class="line">      ),</span><br><span class="line">      <span class="string">&quot;install&quot;</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">omit</span>(</span><br><span class="line">    <span class="title function_">createI18n</span>(&#123;</span><br><span class="line">      <span class="attr">locale</span>: localeOverrides.<span class="property">value</span>.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">messages</span>: &#123;</span><br><span class="line">        <span class="attr">en</span>: <span class="title class_">English</span>.<span class="property">el</span>,</span><br><span class="line">        [localeOverrides.<span class="property">value</span>.<span class="property">name</span>]: localeOverrides.<span class="property">value</span>.<span class="property">el</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="string">&quot;install&quot;</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useLocale;</span><br></pre></td></tr></table></figure><h3 id="├─-useOffset-ts"><a href="#├─-useOffset-ts" class="headerlink" title="├─ useOffset.ts"></a>├─ useOffset.ts</h3><blockquote><p>计算某个 DOM 元素相对于视口或其他父级元素的偏移量</p></blockquote><blockquote><p>实现 <strong>悬浮层</strong>、**弹出框 **等需要精确定位的功能</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Ref</span>, computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> useOffsetOptions &#123;</span><br><span class="line">  <span class="comment">// id: string;</span></span><br><span class="line">  <span class="attr">offset</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">boxHeight</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line">  <span class="attr">getLastBottomOffset</span>: <span class="function">() =&gt;</span> <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> useOffsetResult &#123;</span><br><span class="line">  <span class="attr">topOffset</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line">  <span class="attr">bottomOffset</span>: <span class="title class_">Ref</span>&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useOffset</span>(<span class="params"><span class="attr">opts</span>: useOffsetOptions</span>): useOffsetResult &#123;</span><br><span class="line">  <span class="comment">// 上一个实例最下面的坐标，第一个是0</span></span><br><span class="line">  <span class="keyword">const</span> lastBottomOffset = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> opts.<span class="title function_">getLastBottomOffset</span>());</span><br><span class="line">  <span class="comment">// 本元素应该的 top</span></span><br><span class="line">  <span class="keyword">const</span> topOffset = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> opts.<span class="property">offset</span> + lastBottomOffset.<span class="property">value</span>);</span><br><span class="line">  <span class="comment">// 为下一个实例预留的底部 offset</span></span><br><span class="line">  <span class="keyword">const</span> bottomOffset = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> topOffset.<span class="property">value</span> + opts.<span class="property">boxHeight</span>.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    topOffset,</span><br><span class="line">    bottomOffset,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useOffset;</span><br></pre></td></tr></table></figure><h3 id="├─-useProp-ts"><a href="#├─-useProp-ts" class="headerlink" title="├─ useProp.ts"></a>├─ useProp.ts</h3><blockquote><p>封装了对组件 <code>props</code> 的处理逻辑</p></blockquote><blockquote><p>提供更安全的默认值和类型检查</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; computed, getCurrentInstance, <span class="keyword">type</span> <span class="title class_">ComputedRef</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> useProp&lt;T&gt;(<span class="attr">propName</span>: <span class="built_in">string</span>): <span class="title class_">ComputedRef</span>&lt;T | <span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title function_">getCurrentInstance</span>();</span><br><span class="line">  <span class="keyword">if</span> (!instance) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;useProp must be used within a component&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">computed</span>(<span class="function">() =&gt;</span> (instance?.<span class="property">proxy</span>?.<span class="property">$props</span> <span class="keyword">as</span> <span class="built_in">any</span>)?.[propName] <span class="keyword">as</span> T);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-useZIndex-ts"><a href="#├─-useZIndex-ts" class="headerlink" title="├─ useZIndex.ts"></a>├─ useZIndex.ts</h3><blockquote><p>管理弹窗的 <code>z-index</code>层级,确保组件的层级关系正确</p></blockquote><blockquote><p>如 <strong>弹窗</strong>、**加载遮罩 **等</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; computed, ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> zIndex = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useZIndex</span>(<span class="params">initialValue = <span class="number">2000</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> _initialValue = <span class="title function_">ref</span>(initialValue);</span><br><span class="line">  <span class="keyword">const</span> currentZindex = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> zIndex.<span class="property">value</span> + _initialValue.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">nextZIndex</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    zIndex.<span class="property">value</span>++;</span><br><span class="line">    <span class="keyword">return</span> currentZindex.<span class="property">value</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">initialValue</span>: _initialValue,</span><br><span class="line">    currentZindex,</span><br><span class="line">    nextZIndex,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-vite-config-ts"><a href="#├─-vite-config-ts" class="headerlink" title="├─ vite.config.ts"></a>├─ vite.config.ts</h3><blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; last, split, first, includes &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hooksPlugin <span class="keyword">as</span> hooks &#125; <span class="keyword">from</span> <span class="string">&quot;@eric-ui/vite-plugins&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dts <span class="keyword">from</span> <span class="string">&quot;vite-plugin-dts&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">dts</span>(&#123;</span><br><span class="line">      <span class="attr">include</span>: [<span class="string">&quot;./**/*.ts&quot;</span>],</span><br><span class="line">      <span class="attr">exclude</span>: [<span class="string">&quot;./vite.config.ts&quot;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">hooks</span>(&#123;</span><br><span class="line">      <span class="attr">rmFiles</span>: [<span class="string">&quot;./dist&quot;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">minify</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">lib</span>: &#123;</span><br><span class="line">      <span class="attr">entry</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./index.ts&quot;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;hooks&quot;</span>,</span><br><span class="line">      <span class="attr">fileName</span>: <span class="string">&quot;index&quot;</span>,</span><br><span class="line">      <span class="attr">formats</span>: [<span class="string">&quot;es&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">      <span class="attr">external</span>: [<span class="string">&quot;vue&quot;</span>, <span class="string">&quot;lodash-es&quot;</span>, <span class="string">&quot;vue3-i18n&quot;</span>],</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="title function_">manualChunks</span>(<span class="params">id</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">includes</span>(id, <span class="string">&quot;/packages/hooks/use&quot;</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">first</span>(<span class="title function_">split</span>(<span class="title function_">last</span>(<span class="title function_">split</span>(id, <span class="string">&quot;/&quot;</span>)), <span class="string">&quot;.&quot;</span>));</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="└─-test"><a href="#└─-test" class="headerlink" title="└─ test"></a>└─ <strong>test</strong></h3><blockquote><p>测试文件</p></blockquote><h4 id="├─-index-test-tsx"><a href="#├─-index-test-tsx" class="headerlink" title="├─ index.test.tsx"></a>├─ index.test.tsx</h4><blockquote><p>对 <code>hooks</code> 入口文件的单元测试</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, expect, it &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useClickOutside,useEventListener&#125; <span class="keyword">from</span> <span class="string">&#x27;..&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;hooks/index&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;useEventListener should be exported&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">expect</span>(useEventListener).<span class="title function_">toBeDefined</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;useClickOutside should be exported&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">expect</span>(useClickOutside).<span class="title function_">toBeDefined</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="├─-useClickOutset-test-tsx"><a href="#├─-useClickOutset-test-tsx" class="headerlink" title="├─ useClickOutset.test.tsx"></a>├─ useClickOutset.test.tsx</h4><blockquote><p>对 <code>useClickOutside</code> 的单元测试</p></blockquote><blockquote><p>验证其点击外部区域的行为是否符合预期</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, expect, it, vi &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, defineComponent &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useClickOutside <span class="keyword">from</span> <span class="string">&quot;../useClickOutside&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;hooks/useClickOutside&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should add &quot;click-outside&quot; listener&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> target = ref&lt;<span class="title class_">HTMLElement</span> | <span class="built_in">void</span>&gt;();</span><br><span class="line">    <span class="keyword">const</span> btnRef = ref&lt;<span class="title class_">HTMLButtonElement</span> | <span class="built_in">void</span>&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handler = vi.<span class="title function_">fn</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">mount</span>(</span><br><span class="line">      <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">        <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="title function_">useClickOutside</span>(target, handler);</span><br><span class="line">          <span class="keyword">return</span> <span class="function">() =&gt;</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;target&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">ref</span>=<span class="string">&#123;btnRef&#125;</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">          );</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> btnRef.<span class="property">value</span>?.<span class="title function_">click</span>();</span><br><span class="line">    <span class="title function_">expect</span>(handler).<span class="property">not</span>.<span class="title function_">toHaveBeenCalled</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">click</span>();</span><br><span class="line">    <span class="title function_">expect</span>(handler).<span class="title function_">toHaveBeenCalled</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="└─-useEventListener-test-tsx"><a href="#└─-useEventListener-test-tsx" class="headerlink" title="└─ useEventListener.test.tsx"></a>└─ useEventListener.test.tsx</h4><blockquote><p>对 <code>useEventListener</code> 的单元测试</p></blockquote><blockquote><p>验证事件监听器的绑定和解绑是否正常</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, expect, it, vi &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, defineComponent &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useEventListener <span class="keyword">from</span> <span class="string">&quot;../useEventListener&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;hooks/useEventListener&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should add and remove event listener when target is HTMLElement&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> target = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> handler = vi.<span class="title function_">fn</span>();</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">mount</span>(</span><br><span class="line">      <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">        <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="title function_">useEventListener</span>(target, <span class="string">&quot;click&quot;</span>, handler);</span><br><span class="line">          <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">    wrapper.<span class="title function_">get</span>(<span class="string">&quot;#container&quot;</span>).<span class="property">element</span>.<span class="title function_">appendChild</span>(target);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> target.<span class="title function_">click</span>();</span><br><span class="line">    <span class="title function_">expect</span>(handler).<span class="title function_">toHaveBeenCalledOnce</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> wrapper.<span class="title function_">unmount</span>();</span><br><span class="line">    <span class="keyword">await</span> target.<span class="title function_">click</span>();</span><br><span class="line">    <span class="title function_">expect</span>(handler).<span class="title function_">toHaveBeenCalledOnce</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should add and remove event listener when target is Ref&lt;HTMLElement&gt;&quot;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> target = ref&lt;<span class="title class_">HTMLElement</span> | <span class="built_in">void</span>&gt;();</span><br><span class="line">    <span class="keyword">const</span> handler = vi.<span class="title function_">fn</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">mount</span>(</span><br><span class="line">      <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">        <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="title function_">useEventListener</span>(target, <span class="string">&quot;click&quot;</span>, handler);</span><br><span class="line">          <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;target&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;container&#x27;</span>)?.<span class="title function_">click</span>()</span><br><span class="line">    <span class="keyword">await</span> target.<span class="property">value</span>?.<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(handler).<span class="title function_">toHaveBeenCalledOnce</span>();</span><br><span class="line"></span><br><span class="line">    target.<span class="property">value</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;container&#x27;</span>)?.<span class="title function_">click</span>()</span><br><span class="line">    <span class="title function_">expect</span>(handler).<span class="title function_">toHaveBeenCalledOnce</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="├─-locale"><a href="#├─-locale" class="headerlink" title="├─ locale"></a>├─ <em><del>locale</del></em></h2><blockquote><p>国际化</p></blockquote><h3 id="├─-index-ts-22"><a href="#├─-index-ts-22" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h3><h3 id="├─-lang"><a href="#├─-lang" class="headerlink" title="├─ lang"></a>├─ lang</h3><blockquote><p>语言包</p></blockquote><h4 id="├─-en-ts"><a href="#├─-en-ts" class="headerlink" title="├─ en.ts"></a>├─ en.ts</h4><h4 id="├─-ja-ts"><a href="#├─-ja-ts" class="headerlink" title="├─ ja.ts"></a>├─ ja.ts</h4><h4 id="├─-ko-ts"><a href="#├─-ko-ts" class="headerlink" title="├─ ko.ts"></a>├─ ko.ts</h4><h4 id="├─-zh-cn-ts"><a href="#├─-zh-cn-ts" class="headerlink" title="├─ zh-cn.ts"></a>├─ zh-cn.ts</h4><h4 id="└─-zh-tw-ts"><a href="#└─-zh-tw-ts" class="headerlink" title="└─ zh-tw.ts"></a>└─ zh-tw.ts</h4><h3 id="└─-package-json-3"><a href="#└─-package-json-3" class="headerlink" title="└─ package.json"></a>└─ package.json</h3><blockquote><p>空包</p></blockquote><h2 id="├─-play"><a href="#├─-play" class="headerlink" title="├─ play"></a>├─ <em><del>play</del></em></h2><blockquote><p>storybook实验室</p></blockquote><h3 id="├─-storybook"><a href="#├─-storybook" class="headerlink" title="├─ .storybook"></a>├─ .storybook</h3><h4 id="├─-main-js"><a href="#├─-main-js" class="headerlink" title="├─ main.js"></a>├─ main.js</h4><h4 id="└─-preview-js"><a href="#└─-preview-js" class="headerlink" title="└─ preview.js"></a>└─ preview.js</h4><h3 id="├─-index-html"><a href="#├─-index-html" class="headerlink" title="├─ index.html"></a>├─ index.html</h3><h3 id="├─-public"><a href="#├─-public" class="headerlink" title="├─ public"></a>├─ public</h3><h4 id="└─-vite-svg"><a href="#└─-vite-svg" class="headerlink" title="└─ vite.svg"></a>└─ vite.svg</h4><h3 id="├─-src"><a href="#├─-src" class="headerlink" title="├─ src"></a>├─ src</h3><h4 id="├─-App-vue"><a href="#├─-App-vue" class="headerlink" title="├─ App.vue"></a>├─ App.vue</h4><h4 id="├─-main-ts"><a href="#├─-main-ts" class="headerlink" title="├─ main.ts"></a>├─ main.ts</h4><h4 id="├─-stories"><a href="#├─-stories" class="headerlink" title="├─ stories"></a>├─ stories</h4><h5 id="├─-Alert-stories-tsx"><a href="#├─-Alert-stories-tsx" class="headerlink" title="├─ Alert.stories.tsx"></a>├─ Alert.stories.tsx</h5><h5 id="├─-Button-stories-ts"><a href="#├─-Button-stories-ts" class="headerlink" title="├─ Button.stories.ts"></a>├─ Button.stories.ts</h5><h5 id="└─-Collapse-stories-ts"><a href="#└─-Collapse-stories-ts" class="headerlink" title="└─ Collapse.stories.ts"></a>└─ Collapse.stories.ts</h5><h4 id="└─-vite-env-d-ts"><a href="#└─-vite-env-d-ts" class="headerlink" title="└─ vite-env.d.ts"></a>└─ vite-env.d.ts</h4><h3 id="├─-vite-config-ts-1"><a href="#├─-vite-config-ts-1" class="headerlink" title="├─ vite.config.ts"></a>├─ vite.config.ts</h3><h3 id="├─-README-md"><a href="#├─-README-md" class="headerlink" title="├─ README.md"></a>├─ README.md</h3><h3 id="└─-package-json-4"><a href="#└─-package-json-4" class="headerlink" title="└─ package.json"></a>└─ package.json</h3><p><strong>项目依赖</strong></p><blockquote><p>无，通过根目录继承</p></blockquote><p><strong>开发依赖</strong></p><blockquote><ul><li><code>@chromatic-com/storybook</code>：Chromatic 截图测试工具</li><li><code>@storybook/addon-*</code>：Storybook 的扩展插件</li><li><code>@storybook/vue3</code>：Storybook 的 Vue 3 支持</li><li><code>@storybook/vue3-vite</code>：Storybook 的 Vite 集成</li><li><code>@vitejs/plugin-vue</code>：Vite 的 Vue 插件</li><li><code>chromatic</code>：Chromatic 命令行工具</li><li><code>storybook</code>：Storybook 核心</li></ul></blockquote><h2 id="├─-theme"><a href="#├─-theme" class="headerlink" title="├─ theme"></a>├─ <em><del>theme</del></em></h2><blockquote><p>样式系统</p><p><strong>样式构建流程集中在 <code>core</code> 包</strong></p><p>采用 <strong>核心包托管模式</strong></p><p><code>theme</code> 包仅作为源码存在</p></blockquote><h3 id="├─-index-css"><a href="#├─-index-css" class="headerlink" title="├─ index.css"></a>├─ index.css</h3><h3 id="├─-package-json-3"><a href="#├─-package-json-3" class="headerlink" title="├─ package.json"></a>├─ package.json</h3><p><strong>项目依赖</strong></p><blockquote><p>无</p></blockquote><h3 id="└─-reset-css"><a href="#└─-reset-css" class="headerlink" title="└─ reset.css"></a>└─ reset.css</h3><h2 id="└─-utils"><a href="#└─-utils" class="headerlink" title="└─ utils"></a>└─ <em><del>utils</del></em></h2><blockquote><p>工具函数和辅助方法，支持组件库的底层逻辑</p></blockquote><h3 id="├─-error-ts"><a href="#├─-error-ts" class="headerlink" title="├─ error.ts"></a>├─ error.ts</h3><blockquote><p>错误处理相关的工具函数</p><p>例如 <strong>抛出错误</strong>、<strong>捕获异常</strong> 等</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isString &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ErUIError</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">message</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(message);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;ErUIError&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">throwError</span>(<span class="params"><span class="attr">scope</span>: <span class="built_in">string</span>, <span class="attr">msg</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ErUIError</span>(<span class="string">`[<span class="subst">$&#123;scope&#125;</span>] <span class="subst">$&#123;msg&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debugWarn</span>(<span class="params"><span class="attr">error</span>: <span class="title class_">Error</span></span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debugWarn</span>(<span class="params"><span class="attr">scope</span>: <span class="built_in">string</span>, <span class="attr">msg</span>: <span class="built_in">string</span></span>): <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debugWarn</span>(<span class="params"><span class="attr">scope</span>: <span class="built_in">string</span> | <span class="title class_">Error</span>, <span class="attr">msg</span>?: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&quot;production&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> err = <span class="title function_">isString</span>(scope) ? <span class="keyword">new</span> <span class="title class_">ErUIError</span>(<span class="string">`[<span class="subst">$&#123;scope&#125;</span>] <span class="subst">$&#123;msg&#125;</span>`</span>) : scope;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">warn</span>(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="├─-index-ts-23"><a href="#├─-index-ts-23" class="headerlink" title="├─ index.ts"></a>├─ index.ts</h3><blockquote><p>导出公共类型或接口</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isFunction &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">RenderVnode</span> = <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">vNode</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: [<span class="title class_">String</span>, <span class="title class_">Object</span>, <span class="title class_">Function</span>],</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> (<span class="title function_">isFunction</span>(props.<span class="property">vNode</span>) ? props.<span class="title function_">vNode</span>() : props.<span class="property">vNode</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> typeIconMap = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">  [<span class="string">&quot;info&quot;</span>, <span class="string">&quot;circle-info&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;success&quot;</span>, <span class="string">&quot;check-circle&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;warning&quot;</span>, <span class="string">&quot;circle-exclamation&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;danger&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./install&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./error&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./style&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="├─-install-ts"><a href="#├─-install-ts" class="headerlink" title="├─ install.ts"></a>├─ install.ts</h3><blockquote><p>给install附加一些方法和对象</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">App</span>, <span class="title class_">Plugin</span>, <span class="title class_">Directive</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; noop &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt; = T &amp; <span class="title class_">Plugin</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withInstall = &lt;T&gt;<span class="function">(<span class="params"><span class="attr">component</span>: T</span>) =&gt;</span> &#123;</span><br><span class="line">  (component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;).<span class="property">install</span> = <span class="function">(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> name = (component <span class="keyword">as</span> <span class="built_in">any</span>)?.<span class="property">name</span> || <span class="string">&quot;UnnamedComponent&quot;</span>;</span><br><span class="line">    app.<span class="title function_">component</span>(name, component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withInstallFunction = &lt;T&gt;<span class="function">(<span class="params"><span class="attr">fn</span>: T, <span class="attr">name</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  (fn <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;).<span class="property">install</span> = <span class="function">(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt;</span> &#123;</span><br><span class="line">    app.<span class="property">config</span>.<span class="property">globalProperties</span>[name] = fn;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> fn <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withInstallDirective = &lt;T <span class="keyword">extends</span> <span class="title class_">Directive</span>&gt;(</span><br><span class="line">  <span class="attr">directive</span>: T,</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">): <span class="title class_">SFCWithInstall</span>&lt;T&gt; =&gt; &#123;</span><br><span class="line">  (directive <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;).<span class="property">install</span> = <span class="function">(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt;</span> &#123;</span><br><span class="line">    app.<span class="title function_">directive</span>(name, directive);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> directive <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withNoopInstall = &lt;T&gt;<span class="function">(<span class="params"><span class="attr">component</span>: T</span>) =&gt;</span> &#123;</span><br><span class="line">  (component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;).<span class="property">install</span> = noop;</span><br><span class="line">  <span class="keyword">return</span> component <span class="keyword">as</span> <span class="title class_">SFCWithInstall</span>&lt;T&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>使用举例</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErButton</span> = <span class="title function_">withInstall</span>(<span class="title class_">Button</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ErButtonGroup</span> = <span class="title function_">withInstall</span>(<span class="title class_">ButtonGroup</span>);</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h3 id="├─-package-json-4"><a href="#├─-package-json-4" class="headerlink" title="├─ package.json"></a>├─ package.json</h3><p><strong>依赖</strong></p><blockquote><p>无</p></blockquote><h3 id="├─-style-ts"><a href="#├─-style-ts" class="headerlink" title="├─ style.ts"></a>├─ style.ts</h3><blockquote><p>处理动态样式或 CSS 变量</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isNumber, isString &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; debugWarn &#125; <span class="keyword">from</span> <span class="string">&quot;./error&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SCOPE</span> = <span class="string">&quot;utils/style&quot;</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isStringNumber = (<span class="attr">val</span>: <span class="built_in">string</span>): <span class="function"><span class="params">boolean</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isString</span>(val)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> !<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="title class_">Number</span>(val));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">addUnit</span>(<span class="params"><span class="attr">value</span>?: <span class="built_in">string</span> | <span class="built_in">number</span>, defaultUnit = <span class="string">&quot;px&quot;</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!value) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isNumber</span>(value) || <span class="title function_">isStringNumber</span>(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;value&#125;</span><span class="subst">$&#123;defaultUnit&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isString</span>(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">debugWarn</span>(<span class="variable constant_">SCOPE</span>, <span class="string">&quot;binding value must be a string or number&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="└─-tests"><a href="#└─-tests" class="headerlink" title="└─ tests"></a>└─ <strong>tests</strong></h3><h4 id="├─-error-test-tsx"><a href="#├─-error-test-tsx" class="headerlink" title="├─ error.test.tsx"></a>├─ error.test.tsx</h4><blockquote><p>对 <code>error.ts</code> 的单元测试，验证错误处理逻辑是否正确</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;describe,expect,it,vi&#125; <span class="keyword">from</span> <span class="string">&#x27;vitest&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;debugWarn,throwError&#125; <span class="keyword">from</span> <span class="string">&#x27;../error&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;error&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;throwError should work&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="title function_">throwError</span>(<span class="string">&#x27;scope&#x27;</span>, <span class="string">&#x27;message&#x27;</span>)</span><br><span class="line">    &#125;).<span class="title function_">toThrowError</span>(<span class="string">&#x27;[scope] message&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;debugWarn should work&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> warn = vi.<span class="title function_">spyOn</span>(<span class="variable language_">console</span>, <span class="string">&#x27;warn&#x27;</span>).<span class="title function_">mockImplementation</span>(<span class="function">()=&gt;</span> vi.<span class="property">fn</span>)</span><br><span class="line">    <span class="title function_">debugWarn</span>(<span class="string">&#x27;scope&#x27;</span>,<span class="string">&#x27;message&#x27;</span>)</span><br><span class="line">    <span class="title function_">debugWarn</span>(<span class="keyword">new</span> <span class="title class_">SyntaxError</span>(<span class="string">&#x27;custom error&#x27;</span>))</span><br><span class="line">    <span class="title function_">expect</span>(warn.<span class="property">mock</span>.<span class="property">calls</span>).<span class="title function_">toMatchInlineSnapshot</span>(<span class="string">`</span></span><br><span class="line"><span class="string">      [</span></span><br><span class="line"><span class="string">        [</span></span><br><span class="line"><span class="string">          [ErUIError: [scope] message],</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">        [</span></span><br><span class="line"><span class="string">          [SyntaxError: custom error],</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    `</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="├─-index-test-tsx-1"><a href="#├─-index-test-tsx-1" class="headerlink" title="├─ index.test.tsx"></a>├─ index.test.tsx</h4><blockquote><p>对 <code>utils</code> 入口文件的单元测试</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, expect, it &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  debugWarn,</span><br><span class="line">  throwError,</span><br><span class="line">  withInstall,</span><br><span class="line">  typeIconMap,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; each &#125; <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;utils/index&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;debugWarn should be exported&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(debugWarn).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;throwError should be exported&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(throwError).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;withInstall should be exported&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(withInstall).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;typeIconMap should be worked&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(typeIconMap).<span class="title function_">toBeDefined</span>();</span><br><span class="line">    <span class="title function_">each</span>(</span><br><span class="line">      [</span><br><span class="line">        [<span class="string">&quot;info&quot;</span>, <span class="string">&quot;circle-info&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;success&quot;</span>, <span class="string">&quot;check-circle&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;warning&quot;</span>, <span class="string">&quot;circle-exclamation&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;danger&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">        [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;circle-xmark&quot;</span>],</span><br><span class="line">      ],</span><br><span class="line">      <span class="function">(<span class="params">[<span class="keyword">type</span>, icon]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">expect</span>(typeIconMap.<span class="title function_">get</span>(<span class="keyword">type</span>)).<span class="title function_">toBe</span>(icon);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="└─-install-test-tsx"><a href="#└─-install-test-tsx" class="headerlink" title="└─ install.test.tsx"></a>└─ install.test.tsx</h4><blockquote><p>对 <code>install.ts</code> 的单元测试，验证组件注册逻辑是否正常</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; describe, expect, it &#125; <span class="keyword">from</span> <span class="string">&quot;vitest&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent, createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;@vue/test-utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&quot;../install&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AppComp</span> = <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>app<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> componentA = <span class="title function_">withInstall</span>(</span><br><span class="line">  <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> componentB = <span class="title function_">withInstall</span>(</span><br><span class="line">  <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;test2&quot;</span>,</span><br><span class="line">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>test2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;install&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;withInstall should be worked&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wapper = <span class="title function_">mount</span>(<span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>);</span><br><span class="line">    <span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">AppComp</span>);</span><br><span class="line"></span><br><span class="line">    app.<span class="title function_">use</span>(componentA).<span class="title function_">use</span>(componentB).<span class="title function_">mount</span>(wapper.<span class="property">element</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expect</span>(componentA.<span class="property">install</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">    <span class="title function_">expect</span>(componentB.<span class="property">install</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wapper.<span class="title function_">findComponent</span>(componentA)).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">    <span class="title function_">expect</span>(wapper.<span class="title function_">findComponent</span>(componentB)).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="├─-package-json-5"><a href="#├─-package-json-5" class="headerlink" title="├─ package.json"></a>├─ <em><del>package.json</del></em></h1><blockquote><p>根目录依赖</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tyche&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm --filter @tyche/play dev&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;story&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm --filter @tyche/play storybook&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;docs:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm --filter @tyche/docs dev&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;docs:build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm --filter @tyche/docs build&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm --filter @tyche/components test&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;run-s build-hooks build-components&quot;</span><span class="punctuation">,</span><span class="comment">//构建 @tyche/docs 子项目的静态文档站点</span></span><br><span class="line"><span class="attr">&quot;build-components&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cross-env NODE_ENV=production pnpm --filter tyche build&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;build-hooks&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cross-env NODE_ENV=production pnpm --filter @tyche/hooks build&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;build:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;run-s build-hooks:dev build-components:dev&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;build-components:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cross-env NODE_ENV=development pnpm --filter tyche build:watch&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;build-hooks:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cross-env NODE_ENV=development pnpm --filter @tyche/hooks build&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;keywords&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;packageManager&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pnpm@10.4.1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//开发依赖</span></span><br><span class="line"><span class="attr">&quot;@types/lodash-es&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.17.12&quot;</span><span class="punctuation">,</span><span class="comment">//Lodash 的 TypeScript 类型定义</span></span><br><span class="line"><span class="attr">&quot;@types/node&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^20.12.12&quot;</span><span class="punctuation">,</span><span class="comment">//Node.js 的 TypeScript 类型定义</span></span><br><span class="line"><span class="attr">&quot;@types/shelljs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.8.15&quot;</span><span class="punctuation">,</span><span class="comment">//Shell.js 的 TypeScript 类型定义</span></span><br><span class="line"><span class="attr">&quot;@vitejs/plugin-vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.2.3&quot;</span><span class="punctuation">,</span><span class="comment">//Vite 的 Vue 插件</span></span><br><span class="line"><span class="attr">&quot;@vitejs/plugin-vue-jsx&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.1.0&quot;</span><span class="punctuation">,</span><span class="comment">//Vite 的 Vue JSX 插件</span></span><br><span class="line"><span class="attr">&quot;@vitest/coverage-v8&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.6.1&quot;</span><span class="punctuation">,</span><span class="comment">//Vitest 的覆盖率插件</span></span><br><span class="line"><span class="attr">&quot;@vue/test-utils&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.4.5&quot;</span><span class="punctuation">,</span><span class="comment">//Vue 测试工具</span></span><br><span class="line"><span class="attr">&quot;@vue/tsconfig&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.5.1&quot;</span><span class="punctuation">,</span><span class="comment">//Vue 的 TypeScript 配置</span></span><br><span class="line"><span class="attr">&quot;cross-env&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.0.3&quot;</span><span class="punctuation">,</span><span class="comment">//跨平台环境变量设置</span></span><br><span class="line"><span class="attr">&quot;cssnano&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.0.1&quot;</span><span class="punctuation">,</span><span class="comment">//CSS 压缩工具</span></span><br><span class="line"><span class="attr">&quot;jsdom&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^24.0.0&quot;</span><span class="punctuation">,</span><span class="comment">//JavaScript DOM 环境模拟</span></span><br><span class="line"><span class="attr">&quot;npm-run-all&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.1.5&quot;</span><span class="punctuation">,</span><span class="comment">//并行运行脚本</span></span><br><span class="line"><span class="attr">&quot;postcss-color-mix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.1.0&quot;</span><span class="punctuation">,</span><span class="comment">//PostCSS 插件</span></span><br><span class="line"><span class="attr">&quot;postcss-each&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;postcss-each-variables&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.3.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;postcss-for&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.1.1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;postcss-nested&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;prettier&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.2.5&quot;</span><span class="punctuation">,</span><span class="comment">//代码格式化工具</span></span><br><span class="line"><span class="attr">&quot;rollup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.18.0&quot;</span><span class="punctuation">,</span><span class="comment">//打包工具</span></span><br><span class="line"><span class="attr">&quot;shelljs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.8.5&quot;</span><span class="punctuation">,</span><span class="comment">//Shell 命令封装</span></span><br><span class="line"><span class="attr">&quot;typescript&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.4.5&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.4.14&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vite-plugin-dts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.9.1&quot;</span><span class="punctuation">,</span><span class="comment">//生成 TypeScript 声明文件</span></span><br><span class="line"><span class="attr">&quot;vitest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.6.1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vue-tsc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.8.27&quot;</span><span class="comment">//Vue 的 TypeScript 编译器</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;@fortawesome/fontawesome-svg-core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.5.2&quot;</span><span class="punctuation">,</span><span class="comment">//Font Awesome 图标库核心</span></span><br><span class="line"><span class="attr">&quot;@fortawesome/free-solid-svg-icons&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.5.2&quot;</span><span class="punctuation">,</span><span class="comment">//Font Awesome 实体图标</span></span><br><span class="line"><span class="attr">&quot;@fortawesome/vue-fontawesome&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.8&quot;</span><span class="punctuation">,</span><span class="comment">//Vue 3 的 Font Awesome 集成</span></span><br><span class="line"><span class="attr">&quot;@popperjs/core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.11.8&quot;</span><span class="punctuation">,</span><span class="comment">//用于弹窗定位的 Popper.js</span></span><br><span class="line"><span class="attr">&quot;@tyche/components&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span><span class="comment">//工作区内的组件库</span></span><br><span class="line"><span class="attr">&quot;@tyche/hooks&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span><span class="comment">//工作区内的钩子库</span></span><br><span class="line"><span class="attr">&quot;@tyche/theme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span><span class="comment">//工作区内的主题库</span></span><br><span class="line"><span class="attr">&quot;@tyche/utils&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span><span class="comment">//工作区内的工具库</span></span><br><span class="line"><span class="attr">&quot;@tyche/locale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span><span class="comment">//工作区内的国际化库</span></span><br><span class="line"><span class="attr">&quot;@tyche/constants&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span><span class="comment">//工作区内的常量库</span></span><br><span class="line"><span class="attr">&quot;async-validator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.2.5&quot;</span><span class="punctuation">,</span><span class="comment">//表单验证库</span></span><br><span class="line"><span class="attr">&quot;lodash-es&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.17.21&quot;</span><span class="punctuation">,</span><span class="comment">//Lodash 的 ES 模块版本</span></span><br><span class="line"><span class="attr">&quot;tyche&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workspace:*&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.5.13&quot;</span><span class="comment">//Vue3核心库</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>开发依赖</strong></p><blockquote><ul><li><code>vue3-i18n</code>：Vue 国际化库</li></ul></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">总结</span><br><span class="line">核心依赖：</span><br><span class="line">vue：所有 Vue 3 相关包的依赖。</span><br><span class="line">@fortawesome/fontawesome-svg-core：图标库。</span><br><span class="line">async-validator：表单验证。</span><br><span class="line">开发依赖：</span><br><span class="line">测试：vitest, @vue/test-utils。</span><br><span class="line">构建：vite, rollup。</span><br><span class="line">工具：typescript, prettier。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pnpm ls &lt;package-name&gt;  # 查看依赖树</span><br><span class="line">pnpm why &lt;package-name&gt; # 查看依赖原因</span><br></pre></td></tr></table></figure><h1 id="├─-pnpm-lock-yaml"><a href="#├─-pnpm-lock-yaml" class="headerlink" title="├─ pnpm-lock.yaml"></a>├─ <em><del>pnpm-lock.yaml</del></em></h1><blockquote><p>环境🔒</p></blockquote><h1 id="├─-pnpm-workspace-yaml"><a href="#├─-pnpm-workspace-yaml" class="headerlink" title="├─ pnpm-workspace.yaml"></a>├─ <em><del>pnpm-workspace.yaml</del></em></h1><blockquote><p>PNPM 工作区的配置文件，用于管理多个包之间的依赖关系</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">packages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;packages/*&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;libs/*&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>所有位于 <code>packages</code> 目录下的子目录都被视为独立的包，并且是工作区的一部分</p><p>同样的，<code>libs</code> 目录下的子目录也被视为独立的包，被视为工作区的一部分</p></blockquote><blockquote><p>如果你有一个包在 <code>packages</code> 文件夹中依赖了另一个位于 <code>libs</code> 文件夹中的包，PNPM 不会从远程仓库下载该依赖，而是创建一个符号链接指向该本地包的位置。</p></blockquote><blockquote><p>当你在一个工作区内的任意一个包中安装依赖时，PNPM 会将这些依赖安装在工作区根目录下的 <code>node_modules</code> 文件夹内。工作区内所有的包可以共享相同的依赖版本，减少了重复安装和存储空间的浪费</p></blockquote><h1 id="├─-postcss-config-cjs"><a href="#├─-postcss-config-cjs" class="headerlink" title="├─ postcss.config.cjs"></a>├─ <em><del>postcss.config.cjs</del></em></h1><blockquote><p><em>PostCSS</em> 是一个使用 JavaScript 转换 CSS 的工具</p><p>该文件是 <em>PostCSS</em> 的配置文件</p><p>详情见文档 <a href="https://www.postcss.com.cn/">PostCSS中文网</a>  或  <a href="https://github.com/postcss/postcss#usage">Github&#x2F;postcss</a></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-env node */</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"><span class="comment">// publicPath: process.env.NODE_ENV === &#x27;production&#x27; ? &#x27;/Tyche/&#x27; : &#x27;/&#x27;,</span></span><br><span class="line"><span class="attr">plugins</span>: [<span class="comment">//一系列 PostCSS 插件</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;postcss-nested&#x27;</span>),<span class="comment">//支持嵌套</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;postcss-each-variables&#x27;</span>),<span class="comment">//循环功能</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;postcss-each&#x27;</span>)(&#123;</span><br><span class="line"><span class="attr">plugins</span>: &#123;</span><br><span class="line"><span class="attr">beforeEach</span>: [<span class="built_in">require</span>(<span class="string">&#x27;postcss-for&#x27;</span>), <span class="built_in">require</span>(<span class="string">&#x27;postcss-color-mix&#x27;</span>)],<span class="comment">//for：循环控制；color-mix：颜色混合</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;),</span><br><span class="line">],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="├─-tsconfig-build-json"><a href="#├─-tsconfig-build-json" class="headerlink" title="├─ tsconfig.build.json"></a>├─ tsconfig.build.json</h1><blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h1 id="├─-tsconfig-json"><a href="#├─-tsconfig-json" class="headerlink" title="├─ tsconfig.json"></a>├─ <em><del>tsconfig.json</del></em></h1><blockquote><p>TypeScript 编译器的配置文件，定义如何编译项目中的 TypeScript 文件</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;extends&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@vue/tsconfig/tsconfig.dom.json&quot;</span><span class="punctuation">,</span><span class="comment">//使用 Vue 提供的基础 TypeScript 配置，并在其基础上进行扩展。</span></span><br><span class="line">    <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//包含一系列编译选项</span></span><br><span class="line">        <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ES2020&quot;</span><span class="punctuation">,</span><span class="comment">//编译后的 JavaScript 目标版本为 ES2020</span></span><br><span class="line">        <span class="attr">&quot;useDefineForClassFields&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span><span class="comment">//使用 &quot;ESNext&quot; 模块系统为了支持最新的 ECMAScript 模块标准</span></span><br><span class="line">        <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ES2020&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DOM&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DOM.Iterable&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="comment">//列出了编译过程中需要包含的库文件</span></span><br><span class="line">        <span class="attr">&quot;skipLibCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="comment">//忽略所有声明文件（.d.ts）的类型检查，加快编译速度</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Bundler mode */</span></span><br><span class="line">        <span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bundler&quot;</span><span class="punctuation">,</span><span class="comment">//适应现代构建工具如 Vite 的模块解析机制</span></span><br><span class="line">        <span class="attr">&quot;allowImportingTsExtensions&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;resolveJsonModule&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;isolatedModules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;noEmit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;jsx&quot;</span><span class="punctuation">:</span> <span class="string">&quot;preserve&quot;</span><span class="punctuation">,</span><span class="comment">//JSX 将被保留以便后续处理</span></span><br><span class="line">        <span class="attr">&quot;jsxImportSource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Linting */</span></span><br><span class="line">        <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="comment">//严格模式</span></span><br><span class="line">        <span class="attr">&quot;noUnusedLocals&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="comment">//禁止未使用的局部变量</span></span><br><span class="line">        <span class="attr">&quot;noUnusedParameters&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="comment">//禁止未使用的函数参数</span></span><br><span class="line">        <span class="attr">&quot;noFallthroughCasesInSwitch&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="comment">//应被包含在编译过程中的文件</span></span><br><span class="line">        <span class="string">&quot;env.d.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;packages/**/*.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;packages/**/*.tsx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;packages/**/*.vue&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;packages/play/src/stories/*.stories.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;vitest.config.ts&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;packages/components/vitest.config.ts&quot;</span><span class="punctuation">,</span><span class="string">&quot;packages/components/index.test.ts&quot;</span><span class="punctuation">]</span><span class="comment">//应被排除在编译过程中的文件</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="├─-tsconfig-node-json"><a href="#├─-tsconfig-node-json" class="headerlink" title="├─ tsconfig.node.json"></a>├─ <em><del>tsconfig.node.json</del></em></h1><blockquote><p>专门为 Node.js 环境下的 TypeScript 配置文件</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;extends&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@tsconfig/node18/tsconfig.json&quot;</span><span class="punctuation">,</span><span class="comment">//基于 Node.js 18 版本的标准配置</span></span><br><span class="line"><span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;packages/**/**.config.ts&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="comment">//所有以 .config.ts 结尾的文件都应该被包含进来</span></span><br><span class="line"><span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;composite&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="comment">//该项目是一个复合项目，可以与其他项目共享编译输出</span></span><br><span class="line"><span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span><span class="comment">//使用 &quot;ESNext&quot; 模块系统为了支持最新的 ECMAScript 模块标准</span></span><br><span class="line"><span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bundler&quot;</span><span class="punctuation">,</span><span class="comment">//适应现代构建工具如 Vite 的模块解析机制</span></span><br><span class="line"><span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;node&quot;</span><span class="punctuation">]</span><span class="comment">//指定要包含的类型声明，确保 Node.js 的全局变量和模块都能被正确识别</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="├─-vitest-config-ts"><a href="#├─-vitest-config-ts" class="headerlink" title="├─ vitest.config.ts"></a>├─ <em><del>vitest.config.ts</del></em></h1><blockquote><p>Vitest 测试框架的配置文件</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;vitest&quot; /&gt; //引用类型声明:告诉TypeScript编译器包含Vitest的类型定义</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>; <span class="comment">//定义配置对象函数</span></span><br><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> vueJsx <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-vue-jsx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [<span class="title function_">vue</span>(), <span class="title function_">vueJsx</span>()],<span class="comment">//被应用到 Vite 构建过程中的插件[对 Vue 单文件组件的支持 &amp; JSX 语法的支持]</span></span><br><span class="line">    <span class="attr">define</span>: &#123; <span class="comment">//定义全局常量(PROD, DEV, TEST)</span></span><br><span class="line">        <span class="attr">PROD</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="literal">false</span>),</span><br><span class="line">        <span class="attr">DEV</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="literal">false</span>),</span><br><span class="line">        <span class="attr">TEST</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="literal">true</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">test</span>: &#123;</span><br><span class="line">        <span class="attr">globals</span>: <span class="literal">true</span>, <span class="comment">//将测试框架暴露为全局变量,可以直接使用 describe, it, expect 等而无需每次都导入</span></span><br><span class="line">        <span class="attr">environment</span>: <span class="string">&quot;jsdom&quot;</span>, <span class="comment">//测试将在模拟的浏览器环境中运行，对标需要 DOM 操作的测试</span></span><br><span class="line">        <span class="attr">setupFiles</span>:[<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./vitest.setup.ts&#x27;</span>)] <span class="comment">//指定vitest.setup.ts在所有测试之前自动运行，用于全局的初始化工作</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="└─-vitest-setup-ts"><a href="#└─-vitest-setup-ts" class="headerlink" title="└─ vitest.setup.ts"></a>└─ <em><del>vitest.setup.ts</del></em></h1><blockquote><p>通常用于在运行测试之前执行一些初始化逻辑</p><p>在这个项目中，初始化 FontAwesome 图标库，整个测试过程中使用 Solid 风格的图标</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; library &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/fontawesome-svg-core&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fas &#125; <span class="keyword">from</span> <span class="string">&quot;@fortawesome/free-solid-svg-icons&quot;</span>;<span class="comment">//所有的 Solid 风格图标集</span></span><br><span class="line"></span><br><span class="line">library.<span class="title function_">add</span>(fas);<span class="comment">//将 Solid 图标添加到了 FontAwesome 的库中</span></span><br><span class="line"><span class="comment">//任何需要使用 Solid 图标的组件或测试都可以直接访问这些图标，而不需要再次单独引入它们</span></span><br></pre></td></tr></table></figure><blockquote><p>避免了由于图标未加载而导致的测试失败</p></blockquote><p><em>扩展</em></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; library &#125; <span class="keyword">from</span> <span class="string">&#x27;@fortawesome/fontawesome-svg-core&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fas &#125; <span class="keyword">from</span> <span class="string">&#x27;@fortawesome/free-solid-svg-icons&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; far &#125; <span class="keyword">from</span> <span class="string">&#x27;@fortawesome/free-regular-svg-icons&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fab &#125; <span class="keyword">from</span> <span class="string">&#x27;@fortawesome/free-brands-svg-icons&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FontAwesomeIcon</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@fortawesome/vue-fontawesome&#x27;</span></span><br><span class="line">library.<span class="title function_">add</span>(fas,far,fab)</span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">component</span>(<span class="string">&#x27;font-awesome-icon&#x27;</span>, <span class="title class_">FontAwesomeIcon</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//大小</span></span><br><span class="line">&lt;font-awesome-icon icon=<span class="string">&quot;fa-solid fa-house&quot;</span> size=<span class="string">&quot;xs&quot;</span>/&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">size</span>=<span class="string">&quot;lg&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">size</span>=<span class="string">&quot;2x&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">size</span>=<span class="string">&quot;4x&quot;</span>/&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//旋转</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">rotation</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">rotation</span>=<span class="string">&quot;90&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">rotation</span>=<span class="string">&quot;180&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font-awesome-icon</span> <span class="attr">icon</span>=<span class="string">&quot;fa-solid fa-house&quot;</span> <span class="attr">rotation</span>=<span class="string">&quot;270&quot;</span>/&gt;</span></span></span><br></pre></td></tr></table></figure><h1 id="各工作区依赖环境详情"><a href="#各工作区依赖环境详情" class="headerlink" title="各工作区依赖环境详情"></a>各工作区依赖环境详情</h1><h2 id="根目录"><a href="#根目录" class="headerlink" title="根目录"></a>根目录</h2><ul><li><strong>生产环境依赖</strong><ul><li>@tyche&#x2F;components: workspace:*</li><li>@tyche&#x2F;hooks: workspace:*</li><li>@tyche&#x2F;theme: workspace:*</li><li>@tyche&#x2F;utils: workspace:*</li><li>@tyche&#x2F;locale: workspace:*</li><li>@tyche&#x2F;constants: workspace:*</li><li>@tyche&#x2F;vite-plugins: workspace:*</li><li>@fortawesome&#x2F;fontawesome-svg-core: ^6.5.2</li><li>@fortawesome&#x2F;free-solid-svg-icons: ^6.5.2</li><li>@fortawesome&#x2F;vue-fontawesome: ^3.0.8</li><li>@popperjs&#x2F;core: ^2.11.8</li><li>@vitepress-preview&#x2F;component: workspace:*</li><li>async-validator: ^4.2.5</li><li>eric-ui: workspace:*</li><li>lodash-es: ^4.17.21</li><li>vue: ^3.4.27</li></ul></li><li><strong>开发环境依赖</strong><ul><li>@types&#x2F;lodash-es: ^4.17.12</li><li>@types&#x2F;node: ^20.12.12</li><li>@types&#x2F;shelljs: ^0.8.15</li><li>@vitejs&#x2F;plugin-vue: ^5.0.4</li><li>@vitejs&#x2F;plugin-vue-jsx: ^3.1.0</li><li>@vitest&#x2F;coverage-v8: ^1.4.0</li><li>@vue&#x2F;test-utils: ^2.4.5</li><li>@vue&#x2F;tsconfig: ^0.5.1</li><li>cross-env: ^7.0.3</li><li>cssnano: ^7.0.1</li><li>jsdom: ^24.0.0</li><li>npm-run-all: ^4.1.5</li><li>postcss-color-mix: ^1.1.0</li><li>postcss-each: ^1.1.0</li><li>postcss-each-variables: ^0.3.0</li><li>postcss-for: ^2.1.1</li><li>postcss-nested: ^6.0.1</li><li>prettier: ^3.2.5</li><li>rollup: ^4.18.0</li><li>shelljs: ^0.8.5</li><li>typescript: ^5.4.5</li><li>vite: ^5.2.11</li><li>vite-plugin-dts: ^3.9.1</li><li>vitest: ^1.6.0</li><li>vue-tsc: ^1.8.27</li><li>vue3-i18n: ^1.1.5</li></ul></li></ul><h3 id="packages-utils"><a href="#packages-utils" class="headerlink" title="&#x2F;packages&#x2F;utils"></a>&#x2F;packages&#x2F;utils</h3><ul><li><strong>生产环境依赖</strong>: 无明确声明</li><li>开发环境依赖<ul><li>无（仅包含一个测试脚本）</li></ul></li></ul><h3 id="packages-components"><a href="#packages-components" class="headerlink" title="&#x2F;packages&#x2F;components"></a>&#x2F;packages&#x2F;components</h3><ul><li>生产环境依赖<ul><li>axios: ^1.6.8 (在 devDependencies 中, 可能是误置)</li></ul></li><li>开发环境依赖<ul><li>无明确声明（除了 axios 外）</li></ul></li></ul><h3 id="packages-constants"><a href="#packages-constants" class="headerlink" title="&#x2F;packages&#x2F;constants"></a>&#x2F;packages&#x2F;constants</h3><ul><li><strong>生产环境依赖</strong>: 无</li><li><strong>开发环境依赖</strong>: 无</li></ul><h3 id="packages-core"><a href="#packages-core" class="headerlink" title="&#x2F;packages&#x2F;core"></a>&#x2F;packages&#x2F;core</h3><ul><li>生产环境依赖<ul><li>@fortawesome&#x2F;fontawesome-svg-core: ^6.5.1</li><li>@fortawesome&#x2F;free-solid-svg-icons: ^6.5.1</li><li>@fortawesome&#x2F;vue-fontawesome: ^3.0.6</li><li>@popperjs&#x2F;core: ^2.11.8</li><li>async-validator: ^4.2.5</li></ul></li><li>开发环境依赖<ul><li>@rollup&#x2F;plugin-terser: ^0.4.4</li><li>rollup-plugin-visualizer: ^5.12.0</li><li>terser: ^5.31.0</li><li>vite-plugin-compression: ^0.5.1</li></ul></li></ul><h3 id="packages-docs"><a href="#packages-docs" class="headerlink" title="&#x2F;packages&#x2F;docs"></a>&#x2F;packages&#x2F;docs</h3><ul><li><strong>生产环境依赖</strong>: 无</li><li>开发环境依赖<ul><li>@vitepress-demo-preview&#x2F;component: ^2.3.2</li><li>@vitepress-demo-preview&#x2F;plugin: ^1.2.3</li><li>vitepress: 1.1.4</li></ul></li></ul><h3 id="packages-hooks"><a href="#packages-hooks" class="headerlink" title="&#x2F;packages&#x2F;hooks"></a>&#x2F;packages&#x2F;hooks</h3><ul><li><strong>生产环境依赖</strong>: 无</li><li>开发环境依赖<ul><li>无（但有 peerDependencies）</li><li>peerDependencies:<ul><li>vue: ^3.4.27</li><li>lodash-es: ^4.17.21</li></ul></li></ul></li></ul><h3 id="packages-locale"><a href="#packages-locale" class="headerlink" title="&#x2F;packages&#x2F;locale"></a>&#x2F;packages&#x2F;locale</h3><ul><li><strong>生产环境依赖</strong>: 无</li><li><strong>开发环境依赖</strong>: 无</li></ul><h3 id="packages-play"><a href="#packages-play" class="headerlink" title="&#x2F;packages&#x2F;play"></a>&#x2F;packages&#x2F;play</h3><ul><li><strong>生产环境依赖</strong>: 无</li><li><strong>开发环境依赖</strong>: 无</li></ul><h3 id="packages-theme"><a href="#packages-theme" class="headerlink" title="&#x2F;packages&#x2F;theme"></a>&#x2F;packages&#x2F;theme</h3><ul><li><strong>生产环境依赖</strong>: 无</li><li>开发环境依赖<ul><li>@chromatic-com&#x2F;storybook: 1.3.3</li><li>@storybook&#x2F;addon-essentials: ^8.0.10</li><li>@storybook&#x2F;addon-interactions: ^8.0.10</li><li>@storybook&#x2F;addon-links: ^8.0.10</li><li>@storybook&#x2F;blocks: ^8.0.10</li><li>@storybook&#x2F;test: ^8.0.10</li><li>@storybook&#x2F;vue3: ^8.0.10</li><li>@storybook&#x2F;vue3-vite: ^8.0.10</li><li>@vitejs&#x2F;plugin-vue: ^5.0.4</li><li>chromatic: ^11.3.1</li><li>storybook: ^8.0.10</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请注意，对于 `/packages/components`，其中 `axios` 被放置在 `devDependencies` 中，这可能是错误配置，除非它确实只用于开发环境。此外，某些包如 `/packages/hooks` 使用了 `peerDependencies` 来定义其对其他包的依赖关系，这些依赖需要由使用者提供。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 组件库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Tooltip 文字组件</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Tooltip%20%E6%96%87%E5%AD%97%E6%8F%90%E7%A4%BA/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Tooltip%20%E6%96%87%E5%AD%97%E6%8F%90%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<hr><h1 id="Tooltip-文字组件"><a href="#Tooltip-文字组件" class="headerlink" title="Tooltip 文字组件"></a>Tooltip 文字组件</h1><hr><h2 id="导出的类型"><a href="#导出的类型" class="headerlink" title="导出的类型"></a>导出的类型</h2><h3 id="1-TooltipProps"><a href="#1-TooltipProps" class="headerlink" title="1. TooltipProps"></a>1. <code>TooltipProps</code></h3><ul><li><strong>描述</strong>: Tooltip 组件的 props 配置。</li><li><strong>字段</strong>:<ul><li><code>content?</code>: <code>string</code><br>提示框显示的内容文本。</li><li><code>trigger?</code>: <code>&#39;hover&#39; | &#39;click&#39; | &#39;contextmenu&#39;</code><br>触发方式（默认 <code>&#39;hover&#39;</code>）。</li><li><code>placement?</code>: <code>Placement</code><br>Popper.js 的定位策略（如 <code>&#39;bottom&#39;</code>）。</li><li><code>manual?</code>: <code>boolean</code><br>是否手动控制显示（默认 <code>false</code>）。</li><li><code>disabled?</code>: <code>boolean</code><br>是否禁用组件（默认 <code>false</code>）。</li><li><code>popperOptions?</code>: <code>Partial&lt;Options&gt;</code><br>Popper.js 的配置选项。</li><li><code>transition?</code>: <code>string</code><br>过渡动画名称（默认 <code>&#39;fade&#39;</code>）。</li><li><code>showTimeout?</code>: <code>number</code><br>显示延迟（默认 <code>0</code>）。</li><li><code>hideTimeout?</code>: <code>number</code><br>隐藏延迟（默认 <code>200</code>）。</li></ul></li></ul><hr><h3 id="2-TooltipEmits"><a href="#2-TooltipEmits" class="headerlink" title="2. TooltipEmits"></a>2. <code>TooltipEmits</code></h3><ul><li><strong>描述</strong>: Tooltip 组件的事件类型。</li><li><strong>字段</strong>:<ul><li><code>&#39;visible-change&#39;</code>: <code>(value: boolean) =&gt; void</code><br>提示框显示状态变化时触发。</li><li><code>&#39;click-outside&#39;</code>: <code>() =&gt; void</code><br>点击外部区域时触发。</li></ul></li></ul><hr><h3 id="3-TooltipInstance"><a href="#3-TooltipInstance" class="headerlink" title="3. TooltipInstance"></a>3. <code>TooltipInstance</code></h3><ul><li><strong>描述</strong>: Tooltip 组件暴露给外部的接口。</li><li><strong>字段</strong>:<ul><li><code>show()</code>: 手动显示提示框。</li><li><code>hide()</code>: 手动隐藏提示框。</li></ul></li></ul><hr><hr><h2 id="关键代码解释"><a href="#关键代码解释" class="headerlink" title="关键代码解释"></a>关键代码解释</h2><h3 id="1-defineOptions"><a href="#1-defineOptions" class="headerlink" title="1. defineOptions"></a>1. <code>defineOptions</code></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;VrTooltip&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>: 定义组件名称为 <code>VrTooltip</code>，在全局注册时可通过 <code>&lt;vr-tooltip&gt;</code> 使用。</li><li><strong>使用场景</strong>: 在 <code>packages/core/components.ts</code> 中通过以下方式导入并注册：<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">VrTooltip</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/components&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> components = [<span class="title class_">VrTooltip</span>];</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="2-withDefaults-设置默认值"><a href="#2-withDefaults-设置默认值" class="headerlink" title="2. withDefaults 设置默认值"></a>2. <code>withDefaults</code> 设置默认值</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;_TooltipProps&gt;(), &#123;</span><br><span class="line">    <span class="attr">placement</span>: <span class="string">&#x27;bottom&#x27;</span>,</span><br><span class="line">    <span class="attr">trigger</span>: <span class="string">&#x27;hover&#x27;</span>,</span><br><span class="line">    <span class="attr">transition</span>: <span class="string">&#x27;fade&#x27;</span>,</span><br><span class="line">    <span class="attr">showTimeout</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">hideTimeout</span>: <span class="number">200</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>示例</strong>:<ul><li><code>placement</code> 默认为 <code>&#39;bottom&#39;</code>。</li><li><code>trigger</code> 默认为 <code>&#39;hover&#39;</code>。</li></ul></li></ul><hr><h3 id="3-事件策略映射"><a href="#3-事件策略映射" class="headerlink" title="3. 事件策略映射"></a>3. <strong>事件策略映射</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">triggerStrategyMap</span>: <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="function">() =&gt;</span> <span class="built_in">void</span>&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">triggerStrategyMap.<span class="title function_">set</span>(<span class="string">&#x27;hover&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    events.<span class="property">value</span>[<span class="string">&#x27;mouseenter&#x27;</span>] = openFinal;</span><br><span class="line">    outerEvents.<span class="property">value</span>[<span class="string">&#x27;mouseleave&#x27;</span>] = closeFinal;</span><br><span class="line">    dropdownEvents.<span class="property">value</span>[<span class="string">&#x27;mouseenter&#x27;</span>] = openFinal;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 其他策略类似</span></span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>: 根据 <code>trigger</code> 类型绑定不同事件（如 <code>&#39;hover&#39;</code> 绑定鼠标悬停事件）。</li></ul><hr><h3 id="4-防抖逻辑"><a href="#4-防抖逻辑" class="headerlink" title="4. 防抖逻辑"></a>4. <strong>防抖逻辑</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    openDebounce = <span class="title function_">debounce</span>(<span class="title function_">bind</span>(setVisible, <span class="literal">null</span>, <span class="literal">true</span>), openDelay.<span class="property">value</span>);</span><br><span class="line">    closeDebounce = <span class="title function_">debounce</span>(<span class="title function_">bind</span>(setVisible, <span class="literal">null</span>, <span class="literal">false</span>), closeDelay.<span class="property">value</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>: 通过 <code>debounce</code> 实现显示和隐藏的延迟控制（如 <code>showTimeout</code> 和 <code>hideTimeout</code>）。</li></ul><hr><h3 id="5-Popper-js-集成"><a href="#5-Popper-js-集成" class="headerlink" title="5. Popper.js 集成"></a>5. <strong>Popper.js 集成</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(visible, <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!val) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (triggerNode.<span class="property">value</span> &amp;&amp; popperNode.<span class="property">value</span>) &#123;</span><br><span class="line">        popperInstance = <span class="title function_">createPopper</span>(</span><br><span class="line">            triggerNode.<span class="property">value</span>,</span><br><span class="line">            popperNode.<span class="property">value</span>,</span><br><span class="line">            popperOptions.<span class="property">value</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123; <span class="attr">flush</span>: <span class="string">&#x27;post&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>: 根据 <code>placement</code> 和 <code>popperOptions</code> 动态定位提示框的位置。</li></ul><hr><h3 id="6-虚拟触发节点处理"><a href="#6-虚拟触发节点处理" class="headerlink" title="6. 虚拟触发节点处理"></a>6. <strong>虚拟触发节点处理</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> triggerNode = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">virtualTriggering</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            ((props.<span class="property">virtualRef</span> <span class="keyword">as</span> <span class="title class_">ButtonInstance</span>)?.<span class="property">ref</span> <span class="keyword">as</span> <span class="built_in">any</span>) ??</span><br><span class="line">            (props.<span class="property">virtualRef</span> <span class="keyword">as</span> <span class="title class_">HTMLElement</span>) ??</span><br><span class="line">            _triggerNode.<span class="property">value</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _triggerNode.<span class="property">value</span> <span class="keyword">as</span> <span class="title class_">HTMLElement</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>: 支持通过 <code>virtualRef</code> 绑定外部组件（如按钮）作为触发器，而非直接渲染的节点。</li></ul><hr><h3 id="7-事件监听与清理"><a href="#7-事件监听与清理" class="headerlink" title="7. 事件监听与清理"></a>7. <strong>事件监听与清理</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">destroyPopperInstance</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>: 在组件卸载时销毁 Popper 实例并清理事件监听器，避免内存泄漏。</li></ul><hr><h3 id="8-自定义钩子-useEventsToTiggerNode"><a href="#8-自定义钩子-useEventsToTiggerNode" class="headerlink" title="8. 自定义钩子 useEventsToTiggerNode"></a>8. <strong>自定义钩子 <code>useEventsToTiggerNode</code></strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useEvenstToTiggerNode</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">props</span>: <span class="title class_">TooltipProps</span> &amp; &#123; virtualTriggering?: <span class="built_in">boolean</span> &#125;,</span></span><br><span class="line"><span class="params">  <span class="attr">triggerNode</span>: <span class="title class_">ComputedRef</span>&lt;<span class="title class_">HTMLElement</span> | <span class="literal">undefined</span>&gt;,</span></span><br><span class="line"><span class="params">  <span class="attr">events</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">EventListener</span>&gt;&gt;,</span></span><br><span class="line"><span class="params">  <span class="attr">closeMethod</span>: () =&gt; <span class="built_in">void</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 内部实现绑定/解绑事件到虚拟触发节点</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>: 当 <code>virtualTriggering</code> 为 <code>true</code> 时，将事件绑定到外部提供的虚拟触发节点（如按钮组件的 <code>ref</code>）。</li></ul><hr><h3 id="9-模板中的动态渲染"><a href="#9-模板中的动态渲染" class="headerlink" title="9. 模板中的动态渲染"></a>9. <strong>模板中的动态渲染</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template v-if=&quot;!virtualTriggering&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;vr-tooltip__trigger&quot; ref=&quot;_triggerNode&quot; v-on=&quot;events&quot;&gt;</span><br><span class="line">        &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;slot name=&quot;default&quot; v-else&gt;&lt;/slot&gt;</span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>: 根据 <code>virtualTriggering</code> 决定是否渲染默认触发节点，或使用外部提供的虚拟触发节点。</li></ul><hr><h3 id="10-过渡动画与-Popper-销毁"><a href="#10-过渡动画与-Popper-销毁" class="headerlink" title="10. 过渡动画与 Popper 销毁"></a>10. <strong>过渡动画与 Popper 销毁</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;transition :name=&quot;transition&quot; @after-leave=&quot;destroyPopperInstance&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;vr-tooltip__popper&quot; v-if=&quot;visible&quot;&gt;</span><br><span class="line">        &lt;slot name=&quot;content&quot;&gt;&#123;&#123; content &#125;&#125;&lt;/slot&gt;</span><br><span class="line">        &lt;div id=&quot;arrow&quot; data-popper-arrow&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/transition&gt;</span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>: 使用 Vue 过渡动画（如 <code>fade</code>），并在动画结束后销毁 Popper 实例。</li></ul><hr><h3 id="11-点击外部区域关闭"><a href="#11-点击外部区域关闭" class="headerlink" title="11. 点击外部区域关闭"></a>11. <strong>点击外部区域关闭</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useClickOutside</span>(containerNode, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">emits</span>(<span class="string">&#x27;click-outside&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">trigger</span> === <span class="string">&#x27;hover&#x27;</span> || props.<span class="property">manual</span>) <span class="keyword">return</span>;</span><br><span class="line">    visible.<span class="property">value</span> &amp;&amp; <span class="title function_">closeFinal</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>: 当点击外部区域时触发 <code>click-outside</code> 事件，并在非手动控制且非悬停模式下隐藏提示框。</li></ul><hr><h3 id="12-手动控制模式"><a href="#12-手动控制模式" class="headerlink" title="12. 手动控制模式"></a>12. <strong>手动控制模式</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (props.<span class="property">manual</span>) &#123;</span><br><span class="line">    events.<span class="property">value</span> = &#123;&#125;;</span><br><span class="line">    outerEvents.<span class="property">value</span> = &#123;&#125;;</span><br><span class="line">    dropdownEvents.<span class="property">value</span> = &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>: 当 <code>manual</code> 为 <code>true</code> 时，禁用自动触发逻辑，需通过 <code>show()</code> 和 <code>hide()</code> 手动控制。</li></ul><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li><strong>核心功能</strong>: 提供可定制的提示框组件，支持多种触发方式、位置定位和虚拟触发节点。</li><li><strong>扩展性</strong>: 通过 <code>popperOptions</code> 和 <code>transition</code> 自定义定位和动画。</li><li><strong>交互</strong>: 支持防抖、手动控制、虚拟触发节点和外部事件监听。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 组件库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MessageBox 对话框组件</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/MessageBox%20%E5%AF%B9%E8%AF%9D%E5%BC%B9%E5%87%BA%E6%A1%86/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/MessageBox%20%E5%AF%B9%E8%AF%9D%E5%BC%B9%E5%87%BA%E6%A1%86/</url>
      
        <content type="html"><![CDATA[<h1 id="MessageBox-对话框组件"><a href="#MessageBox-对话框组件" class="headerlink" title="MessageBox 对话框组件"></a>MessageBox 对话框组件</h1><hr><h2 id="MessageBox-vue"><a href="#MessageBox-vue" class="headerlink" title="MessageBox.vue"></a>MessageBox.vue</h2><h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, reactive, computed, watch, nextTick, <span class="keyword">type</span> <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isFunction, isNil &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash-es&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">MessageBoxProps</span>, <span class="title class_">MessageBoxAction</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrOverlay</span> <span class="keyword">from</span> <span class="string">&#x27;../Overlay/Overlay.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrIcon</span> <span class="keyword">from</span> <span class="string">&#x27;../Icon/Icon.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrButton</span> <span class="keyword">from</span> <span class="string">&#x27;../Button/Button.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useId, useZIndex &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/hooks&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; typeIconMap &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/utils&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;VrMessageBox&#x27;</span>, <span class="comment">// 定义组件名称</span></span><br><span class="line">    <span class="attr">inheritAttrs</span>: <span class="literal">false</span>, <span class="comment">// 禁用继承属性</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">MessageBoxProps</span>&gt;(), &#123;</span><br><span class="line">    <span class="attr">lockScroll</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">closeOnClickModal</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">confirmButtonType</span>: <span class="string">&#x27;primary&#x27;</span>,</span><br><span class="line">    <span class="attr">roundButton</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">boxType</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">inputValue</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">inputPlaceholder</span>: <span class="string">&#x27;Please input...&#x27;</span>,</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&#x27;Ok&#x27;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&#x27;Cancel&#x27;</span>,</span><br><span class="line">    <span class="attr">showConfirmButton</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; doAction &#125; = props;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> inputId = <span class="title function_">useId</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; nextZIndex &#125; = <span class="title function_">useZIndex</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    ...props,</span><br><span class="line">    <span class="attr">zIndex</span>: <span class="title function_">nextZizonIndex</span>(),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hasMessage = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> !!state.<span class="property">message</span>);</span><br><span class="line"><span class="keyword">const</span> iconComponent = <span class="title function_">computed</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> state.<span class="property">icon</span> ?? typeIconMap.<span class="title function_">get</span>(state.<span class="property">type</span> ?? <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听 visible 变化，更新 zIndex 并聚焦输入框</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> props.<span class="property">visible</span>?.<span class="property">value</span>,</span><br><span class="line">    <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (val) state.<span class="property">zIndex</span> = <span class="title function_">nextZIndex</span>();</span><br><span class="line">        <span class="keyword">if</span> (props.<span class="property">boxType</span> !== <span class="string">&#x27;prompt&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (!val) <span class="keyword">return</span>;</span><br><span class="line">        <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// inputRef.value?.focus();</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 点击遮罩层触发关闭</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleWrapperClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    props.<span class="property">closeOnClickModal</span> &amp;&amp; <span class="title function_">handleAction</span>(<span class="string">&#x27;close&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输入框回车触发确认</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleInputEnter</span>(<span class="params"><span class="attr">e</span>: <span class="title class_">KeyboardEvent</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (state.<span class="property">inputType</span> === <span class="string">&#x27;textarea&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="title function_">handleAction</span>(<span class="string">&#x27;confirm&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发操作（确认/取消/关闭）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleAction</span>(<span class="params"><span class="attr">action</span>: <span class="title class_">MessageBoxAction</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isFunction</span>(props.<span class="property">beforeClose</span>)) &#123;</span><br><span class="line">        props.<span class="title function_">beforeClose</span>(action, state, <span class="function">() =&gt;</span> <span class="title function_">doAction</span>(action, state.<span class="property">inputValue</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">doAction</span>(action, state.<span class="property">inputValue</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭对话框</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleClose</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">handleAction</span>(<span class="string">&#x27;close&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="关键解释"><a href="#关键解释" class="headerlink" title="关键解释"></a><em><strong>关键解释</strong></em></h3><blockquote><p><code>defineOptions</code></p><ul><li>定义组件名称为 <code>VrMessageBox</code>，禁用属性继承：<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;VrMessageBox&#x27;</span>,</span><br><span class="line">    <span class="attr">inheritAttrs</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul></blockquote><hr><blockquote><p><code>withDefaults</code></p><p>为 <code>props</code> 设置默认值：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">MessageBoxProps</span>&gt;(), &#123;</span><br><span class="line"> <span class="attr">lockScroll</span>: <span class="literal">true</span>,</span><br><span class="line"> <span class="attr">showClose</span>: <span class="literal">true</span>,</span><br><span class="line"> <span class="attr">closeOnClickModal</span>: <span class="literal">true</span>,</span><br><span class="line"> <span class="attr">confirmButtonType</span>: <span class="string">&#x27;primary&#x27;</span>,</span><br><span class="line"> <span class="attr">roundButton</span>: <span class="literal">false</span>,</span><br><span class="line"> <span class="attr">boxType</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"> <span class="attr">inputValue</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"> <span class="attr">inputPlaceholder</span>: <span class="string">&#x27;Please input...&#x27;</span>,</span><br><span class="line"> <span class="attr">confirmButtonText</span>: <span class="string">&#x27;Ok&#x27;</span>,</span><br><span class="line"> <span class="attr">cancelButtonText</span>: <span class="string">&#x27;Cancel&#x27;</span>,</span><br><span class="line"> <span class="attr">showConfirmButton</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote><hr><blockquote><p><code>useZIndex</code></p><p>通过 <code>useZIndex</code> 管理对话框层级：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; nextZIndex &#125; = <span class="title function_">useZIndex</span>();</span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; ...props, <span class="attr">zIndex</span>: <span class="title function_">nextZIndex</span>() &#125;);</span><br></pre></td></tr></table></figure></blockquote><hr><blockquote><p><code>handleAction</code></p><p>统一处理按钮点击和输入回车操作：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleAction</span>(<span class="params"><span class="attr">action</span>: <span class="title class_">MessageBoxAction</span></span>) &#123;</span><br><span class="line"> <span class="keyword">if</span> (<span class="title function_">isFunction</span>(props.<span class="property">beforeClose</span>)) &#123;</span><br><span class="line">     props.<span class="title function_">beforeClose</span>(action, state, <span class="function">() =&gt;</span> <span class="title function_">doAction</span>(action, state.<span class="property">inputValue</span>));</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="title function_">doAction</span>(action, state.<span class="property">inputValue</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><hr><h3 id="template"><a href="#template" class="headerlink" title="template"></a>template</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Transition</span><br><span class="line">    name=&quot;fade-in-linear&quot;</span><br><span class="line">    @after-leave=&quot;destroy&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;VrOverlay</span><br><span class="line">      v-show=&quot;(visible as Ref).value&quot;</span><br><span class="line">      :z-index=&quot;state.zIndex&quot;</span><br><span class="line">      mask</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        role=&quot;dialog&quot;</span><br><span class="line">        class=&quot;vr-overlay-message-box&quot;</span><br><span class="line">        @click=&quot;handleWrapperClick&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          ref=&quot;rootRef&quot;</span><br><span class="line">          class=&quot;vr-message-box&quot;</span><br><span class="line">          :class=&quot;&#123; &#x27;is-center&#x27;: state.center &#125;&quot;</span><br><span class="line">          @click.stop</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;!-- 标题栏 --&gt;</span><br><span class="line">          &lt;div</span><br><span class="line">            v-if=&quot;!isNil(state.title)&quot;</span><br><span class="line">            ref=&quot;headerRef&quot;</span><br><span class="line">            class=&quot;vr-message-box__header&quot;</span><br><span class="line">            :class=&quot;&#123; &#x27;show-close&#x27;: state.showClose &#125;&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;div class=&quot;vr-message-box__title&quot;&gt;</span><br><span class="line">              &lt;VrIcon</span><br><span class="line">                v-if=&quot;iconComponent &amp;&amp; state.center&quot;</span><br><span class="line">                :class=&quot;&#123; [`vr-icon-$&#123;state.type&#125;`]: state.type &#125;&quot;</span><br><span class="line">                :icon=&quot;iconComponent&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">              &#123;&#123; state.title &#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;button</span><br><span class="line">              v-if=&quot;showClose&quot;</span><br><span class="line">              class=&quot;vr-message-box__header-btn&quot;</span><br><span class="line">              @click.stop=&quot;handleClose&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;VrIcon icon=&quot;xmark&quot; /&gt;</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- 内容区 --&gt;</span><br><span class="line">          &lt;div class=&quot;vr-message-box__content&quot;&gt;</span><br><span class="line">            &lt;VrIcon</span><br><span class="line">              v-if=&quot;iconComponent &amp;&amp; !state.center &amp;&amp; hasMessage&quot;</span><br><span class="line">              :class=&quot;&#123; [`vr-icon-$&#123;state.type&#125;`]: state.type &#125;&quot;</span><br><span class="line">              :icon=&quot;iconComponent&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;div v-if=&quot;hasMessage&quot; class=&quot;vr-message-box__message&quot;&gt;</span><br><span class="line">              &lt;slot&gt;</span><br><span class="line">                &lt;component</span><br><span class="line">                  :is=&quot;state.showInput ? &#x27;label&#x27; : &#x27;p&#x27;&quot;</span><br><span class="line">                  :for=&quot;state.showInput ? inputId : void 0&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                  &#123;&#123; state.message &#125;&#125;</span><br><span class="line">                &lt;/component&gt;</span><br><span class="line">              &lt;/slot&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- 输入框 --&gt;</span><br><span class="line">          &lt;div v-show=&quot;state.showInput&quot; class=&quot;vr-message-box__input&quot;&gt;</span><br><span class="line">            &lt;VrInput</span><br><span class="line">              v-model=&quot;state.inputValue&quot;</span><br><span class="line">              :placeholder=&quot;state.inputPlaceholder&quot;</span><br><span class="line">              :type=&quot;state.inputType&quot;</span><br><span class="line">              @keyup.enter=&quot;handleInputEnter&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- 按钮区 --&gt;</span><br><span class="line">          &lt;div class=&quot;vr-message-box__footer&quot;&gt;</span><br><span class="line">            &lt;VrButton</span><br><span class="line">              v-if=&quot;state.showCancelButton&quot;</span><br><span class="line">              class=&quot;vr-message-box__footer-btn vr-message-box__cancel-btn&quot;</span><br><span class="line">              :type=&quot;state.cancelButtonType&quot;</span><br><span class="line">              :round=&quot;state.roundButton&quot;</span><br><span class="line">              :loading=&quot;state.cancelButtonLoading&quot;</span><br><span class="line">              @click=&quot;handleAction(&#x27;cancel&#x27;)&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &#123;&#123; state.cancelButtonText &#125;&#125;</span><br><span class="line">            &lt;/VrButton&gt;</span><br><span class="line">            &lt;VrButton</span><br><span class="line">              v-show=&quot;state.showConfirmButton&quot;</span><br><span class="line">              class=&quot;vr-message-box__footer-btn vr-message-box__confirm-btn&quot;</span><br><span class="line">              :type=&quot;state.confirmButtonType&quot;</span><br><span class="line">              :round=&quot;state.roundButton&quot;</span><br><span class="line">              :loading=&quot;state.confirmButtonLoading&quot;</span><br><span class="line">              @click=&quot;handleAction(&#x27;confirm&#x27;)&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &#123;&#123; state.confirmButtonText &#125;&#125;</span><br><span class="line">            &lt;/VrButton&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/VrOverlay&gt;</span><br><span class="line">  &lt;/Transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="关键解释-1"><a href="#关键解释-1" class="headerlink" title="关键解释"></a><em><strong>关键解释</strong></em></h3><blockquote><p><code>Transition</code></p><ul><li>使用 <code>fade-in-linear</code> 动画，动画结束后触发 <code>destroy</code> 移除 DOM。</li></ul></blockquote><hr><blockquote><p><code>VrOverlay</code></p><ul><li>包裹对话框的遮罩层，支持 <code>mask</code> 属性控制遮罩是否可点击。</li></ul></blockquote><hr><blockquote><p>输入框与按钮</p><ul><li><code>state.showInput</code> 控制输入框显示（如 <code>prompt</code> 类型）。</li><li>按钮根据 <code>showCancelButton</code>&#x2F;<code>showConfirmButton</code> 动态显示。</li></ul></blockquote><hr><blockquote><p>标题与内容</p><ul><li><code>center</code> 模式下图标居中显示在标题栏内。</li><li><code>hasMessage</code> 检测是否存在消息内容。</li></ul></blockquote><hr><h3 id="methods-ts"><a href="#methods-ts" class="headerlink" title="methods.ts"></a>methods.ts</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    createVNode,</span><br><span class="line">    isVNode,</span><br><span class="line">    ref,</span><br><span class="line">    render,</span><br><span class="line">    nextTick,</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">ComponentPublicInstance</span>,</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">VNode</span>,</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">VNodeProps</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;</span><br><span class="line">    <span class="title class_">MessageBoxAction</span>,</span><br><span class="line">    <span class="title class_">MessageBoxOptions</span>,</span><br><span class="line">    <span class="title class_">MessageBoxData</span>,</span><br><span class="line">    <span class="title class_">MessageBoxCallback</span>,</span><br><span class="line">    <span class="title class_">MessageBoxProps</span>,</span><br><span class="line">    <span class="title class_">IVrMessageBox</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MessageBoxConstructor</span> <span class="keyword">from</span> <span class="string">&#x27;./MessageBox.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; assign, each, isFunction, isObject, isString, isUndefined, set &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash-es&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> messageInstanceMap = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;</span><br><span class="line">    <span class="title class_">ComponentPublicInstance</span>&lt;&#123; <span class="attr">doClose</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125;&gt;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span>;</span><br><span class="line">        <span class="attr">callback</span>: <span class="title class_">MessageBoxCallback</span> | <span class="built_in">void</span>;</span><br><span class="line">        <span class="attr">resolve</span>: <span class="function">(<span class="params"><span class="attr">res</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">        <span class="attr">reject</span>: <span class="function">(<span class="params"><span class="attr">res</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建对话框实例</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initInstance</span>(<span class="params"><span class="attr">props</span>: <span class="title class_">MessageBoxProps</span>, <span class="attr">container</span>: <span class="title class_">HTMLElement</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> isVNodeMsg = <span class="title function_">isFunction</span>(props?.<span class="property">message</span>) || <span class="title function_">isVNode</span>(props?.<span class="property">message</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">genDefaultSlot</span> = (<span class="params"><span class="attr">message</span>: <span class="title class_">VNode</span> | (() =&gt; VNode)</span>) =&gt;</span><br><span class="line">        <span class="title function_">isFunction</span>(message) ? message : <span class="function">() =&gt;</span> message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> vnode = <span class="title function_">createVNode</span>(</span><br><span class="line">        <span class="title class_">MessageBoxConstructor</span>,</span><br><span class="line">        &#123; ...props, visible &#125; <span class="keyword">as</span> <span class="title class_">VNodeProps</span>,</span><br><span class="line">        isVNodeMsg ? &#123; <span class="attr">default</span>: <span class="title function_">genDefaultSlot</span>(props.<span class="property">message</span> <span class="keyword">as</span> <span class="title class_">VNode</span>) &#125; : <span class="built_in">void</span> <span class="number">0</span></span><br><span class="line">    );</span><br><span class="line">    <span class="title function_">render</span>(vnode, container);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(container.<span class="property">firstElementChild</span>!);</span><br><span class="line">    <span class="keyword">return</span> vnode.<span class="property">component</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建容器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">genContainer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示对话框</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showMessage</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> container = <span class="title function_">genContainer</span>();</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">props</span>: <span class="title class_">MessageBoxProps</span> = &#123;</span><br><span class="line">        ...options,</span><br><span class="line">        <span class="attr">doClose</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            vm.<span class="property">visible</span>.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">doAction</span>: <span class="function">(<span class="params"><span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>, <span class="attr">inputVal</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> currentMsg = messageInstanceMap.<span class="title function_">get</span>(vm);</span><br><span class="line">            <span class="keyword">const</span> resolve = options.<span class="property">showInput</span></span><br><span class="line">                ? &#123; <span class="attr">value</span>: inputVal, action &#125;</span><br><span class="line">                : action;</span><br><span class="line">            <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> vm.<span class="title function_">doClose</span>());</span><br><span class="line">            <span class="keyword">if</span> (options.<span class="property">callback</span>) &#123;</span><br><span class="line">                options.<span class="title function_">callback</span>(resolve);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (action === <span class="string">&#x27;cancel&#x27;</span> || action === <span class="string">&#x27;close&#x27;</span>) &#123;</span><br><span class="line">                currentMsg?.<span class="title function_">reject</span>(action);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            currentMsg?.<span class="title function_">resolve</span>(resolve);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">destroy</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">render</span>(<span class="literal">null</span>, container);</span><br><span class="line">            messageInstanceMap.<span class="title function_">delete</span>(vm);</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> instance = <span class="title function_">initInstance</span>(props <span class="keyword">as</span> <span class="title class_">MessageBoxProps</span>, container);</span><br><span class="line">    <span class="keyword">const</span> vm = instance?.<span class="property">proxy</span> <span class="keyword">as</span> <span class="title class_">ComponentPublicInstance</span>&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line">    vm.<span class="property">visible</span>.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> vm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MessageBox</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span> | <span class="built_in">string</span> | <span class="title class_">VNode</span></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">callback</span>: <span class="title class_">MessageBoxCallback</span> | <span class="built_in">void</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isString</span>(options) || <span class="title function_">isVNode</span>(options)) &#123;</span><br><span class="line">        options = &#123; <span class="attr">message</span>: options &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        callback = options.<span class="property">callback</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> vm = <span class="title function_">showMessage</span>(options);</span><br><span class="line">        messageInstanceMap.<span class="title function_">set</span>(vm, &#123; options, callback, resolve, reject &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预定义对话框类型</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MESSAGE_BOX_VARIANTS</span> = [<span class="string">&#x27;alert&#x27;</span>, <span class="string">&#x27;confirm&#x27;</span>, <span class="string">&#x27;prompt&#x27;</span>] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">MESSAGE_BOX_DEFAULT_OPTS</span>: <span class="title class_">Record</span>&lt;</span><br><span class="line">    (<span class="keyword">typeof</span> <span class="variable constant_">MESSAGE_BOX_VARIANTS</span>)[<span class="built_in">number</span>],</span><br><span class="line">    <span class="title class_">Partial</span>&lt;<span class="title class_">MessageBoxOptions</span>&gt;</span><br><span class="line">&gt; = &#123;</span><br><span class="line">    <span class="attr">alert</span>: &#123; <span class="attr">closeOnClickModal</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    <span class="attr">confirm</span>: &#123; <span class="attr">showCancelButton</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    <span class="attr">prompt</span>: &#123; <span class="attr">showCancelButton</span>: <span class="literal">true</span>, <span class="attr">showInput</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">each</span>(<span class="variable constant_">MESSAGE_BOX_VARIANTS</span>, <span class="function">(<span class="params"><span class="keyword">type</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="title class_">MessageBox</span>, <span class="keyword">type</span>, <span class="title function_">messageBoxFactory</span>(<span class="keyword">type</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂函数生成不同类型的对话框</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">messageBoxFactory</span>(<span class="params"><span class="attr">boxType</span>: (<span class="keyword">typeof</span> MESSAGE_BOX_VARIANTS)[<span class="built_in">number</span>]</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="attr">message</span>: <span class="built_in">string</span> | <span class="title class_">VNode</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="attr">title</span>: <span class="built_in">string</span> | <span class="title class_">MessageBoxOptions</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span> = &#123;&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">    </span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> titleOrOpts = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isObject</span>(title)) &#123;</span><br><span class="line">            options = title <span class="keyword">as</span> <span class="title class_">MessageBoxOptions</span>;</span><br><span class="line">            titleOrOpts = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isUndefined</span>(title)) &#123;</span><br><span class="line">            titleOrOpts = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            titleOrOpts = title <span class="keyword">as</span> <span class="built_in">string</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">MessageBox</span>(</span><br><span class="line">            <span class="title function_">assign</span>(</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">title</span>: titleOrOpts,</span><br><span class="line">                    message,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                    boxType,</span><br><span class="line">                    ...<span class="variable constant_">MESSAGE_BOX_DEFAULT_OPTS</span>[boxType],</span><br><span class="line">                &#125;,</span><br><span class="line">                options</span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭所有实例</span></span><br><span class="line"><span class="title function_">set</span>(<span class="title class_">MessageBox</span>, <span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    messageInstanceMap.<span class="title function_">forEach</span>(<span class="function">(<span class="params">_, vm</span>) =&gt;</span> &#123;</span><br><span class="line">        vm.<span class="title function_">doClose</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    messageInstanceMap.<span class="title function_">clear</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MessageBox</span> <span class="keyword">as</span> <span class="title class_">IVrMessageBox</span>;</span><br></pre></td></tr></table></figure><hr><h3 id="关键解释-2"><a href="#关键解释-2" class="headerlink" title="关键解释"></a><em><strong>关键解释</strong></em></h3><blockquote><p><code>messageInstanceMap</code></p><p>存储所有对话框实例，支持批量操作：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> messageInstanceMap = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;</span><br><span class="line"> <span class="title class_">ComponentPublicInstance</span>&lt;&#123; <span class="attr">doClose</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125;&gt;,</span><br><span class="line"> &#123;</span><br><span class="line">     <span class="attr">options</span>: <span class="title class_">MessageBoxOptions</span>;</span><br><span class="line">     <span class="attr">resolve</span>: <span class="function">(<span class="params"><span class="attr">res</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">     <span class="attr">reject</span>: <span class="function">(<span class="params"><span class="attr">res</span>: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&gt;();</span><br></pre></td></tr></table></figure></blockquote><hr><blockquote><p><code>showMessage</code></p><ul><li>根据 <code>options</code> 生成对话框实例。</li><li><code>doAction</code> 处理用户操作并触发 <code>resolve/reject</code>。</li></ul></blockquote><hr><blockquote><p>预定义对话框类型</p><ul><li><code>alert</code>：默认禁用遮罩层关闭。</li><li><code>confirm</code>：默认显示取消按钮。</li><li><code>prompt</code>：默认显示输入框和取消按钮。</li></ul></blockquote><hr><h3 id="types-ts"><a href="#types-ts" class="headerlink" title="types.ts"></a>types.ts</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">VNode</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; messageType &#125; <span class="keyword">from</span> <span class="string">&#x27;../Message/types&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ButtonType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../Button/types&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxAction</span> = <span class="string">&#x27;confirm&#x27;</span> | <span class="string">&#x27;cancel&#x27;</span> | <span class="string">&#x27;close&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxType</span> = <span class="string">&#x27;&#x27;</span> | <span class="string">&#x27;prompt&#x27;</span> | <span class="string">&#x27;alert&#x27;</span> | <span class="string">&#x27;confirm&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxCallback</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span> | &#123; value: <span class="built_in">string</span>; action: MessageBoxAction &#125;</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxInputData</span> = &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageBoxData</span> = <span class="title class_">MessageBoxInputData</span> &amp; <span class="title class_">MessageBoxAction</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageBoxOptions</span> &#123;</span><br><span class="line">    <span class="attr">title</span>?: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">message</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span> | (<span class="function">() =&gt;</span> <span class="title class_">VNode</span>);</span><br><span class="line">    <span class="attr">type</span>?: messageType;</span><br><span class="line">    <span class="attr">boxType</span>?: <span class="title class_">MessageBoxType</span>;</span><br><span class="line">    <span class="attr">icon</span>?: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">callback</span>?: <span class="title class_">MessageBoxCallback</span>;</span><br><span class="line">    <span class="attr">showClose</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">showInput</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">showCancelButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">showConfirmButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">cancelButtonText</span>?: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">confirmButtonText</span>?: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">cancelButtonLoading</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">confirmButtonLoading</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">cancelButtonDisabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">confirmButtonDisabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">cancelButtonType</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">    <span class="attr">confirmButtonType</span>?: <span class="title class_">ButtonType</span>;</span><br><span class="line">    <span class="attr">roundButton</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">center</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">lockScroll</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">closeOnClickModal</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">beforeClose</span>?: <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="attr">action</span>: <span class="title class_">MessageBoxAction</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="attr">instance</span>: <span class="built_in">any</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="attr">done</span>: () =&gt; <span class="built_in">void</span></span></span></span><br><span class="line"><span class="params"><span class="function">    </span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="关键解释-3"><a href="#关键解释-3" class="headerlink" title="关键解释"></a><em><strong>关键解释</strong></em></h3><blockquote><p><code>MessageBoxOptions</code></p><ul><li><code>boxType</code>：指定对话框类型（<code>alert/confirm/prompt</code>）。</li><li><code>showInput</code>：是否显示输入框（通常用于 <code>prompt</code> 类型）。</li><li><code>beforeClose</code>：关闭前的钩子函数，需调用 <code>done()</code> 完成关闭。</li></ul></blockquote><hr><h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; MessageBox &#125; from &#x27;veyra-ui&#x27;;</span><br><span class="line"></span><br><span class="line">// 基础 Alert</span><br><span class="line">MessageBox.alert(&#x27;操作成功&#x27;, &#x27;提示&#x27;, &#123;</span><br><span class="line">    type: &#x27;success&#x27;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 确认对话框</span><br><span class="line">MessageBox.confirm(&#x27;确定删除该文件？&#x27;, &#x27;警告&#x27;, &#123;</span><br><span class="line">    type: &#x27;warning&#x27;,</span><br><span class="line">    confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">    cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">&#125;).then(() =&gt; &#123;</span><br><span class="line">    console.log(&#x27;已确认&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 输入对话框</span><br><span class="line">MessageBox.prompt(&#x27;请输入用户名&#x27;, &#x27;输入框&#x27;, &#123;</span><br><span class="line">    inputPlaceholder: &#x27;请输入...&#x27;,</span><br><span class="line">    inputType: &#x27;text&#x27;,</span><br><span class="line">&#125;).then((&#123; value, action &#125;) =&gt; &#123;</span><br><span class="line">    if (action === &#x27;confirm&#x27;) &#123;</span><br><span class="line">        console.log(&#x27;输入内容:&#x27;, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 关闭所有对话框</span><br><span class="line">MessageBox.close();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="核心-API"><a href="#核心-API" class="headerlink" title="核心 API"></a>核心 API</h3><h4 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h4><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>title</code></td><td><code>string</code></td><td>-</td><td>对话框标题</td></tr><tr><td><code>message</code></td><td>&#96;string</td><td>VNode</td><td>(() &#x3D;&gt; VNode)&#96;</td></tr><tr><td><code>type</code></td><td><code>messageType</code></td><td><code>&#39;&#39;</code></td><td>消息类型（<code>info/success/warning/danger/error</code>）</td></tr><tr><td><code>boxType</code></td><td><code>MessageBoxType</code></td><td><code>&#39;&#39;</code></td><td>对话框类型（<code>alert/confirm/prompt</code>）</td></tr><tr><td><code>showClose</code></td><td><code>boolean</code></td><td><code>true</code></td><td>是否显示关闭按钮</td></tr><tr><td><code>showInput</code></td><td><code>boolean</code></td><td><code>false</code></td><td>是否显示输入框（<code>prompt</code> 类型默认开启）</td></tr><tr><td><code>showCancelButton</code></td><td><code>boolean</code></td><td><code>false</code></td><td>是否显示取消按钮</td></tr><tr><td><code>showConfirmButton</code></td><td><code>boolean</code></td><td><code>true</code></td><td>是否显示确认按钮</td></tr><tr><td><code>confirmButtonText</code></td><td><code>string</code></td><td><code>&#39;Ok&#39;</code></td><td>确认按钮文字</td></tr><tr><td><code>cancelButtonText</code></td><td><code>string</code></td><td><code>&#39;Cancel&#39;</code></td><td>取消按钮文字</td></tr><tr><td><code>lockScroll</code></td><td><code>boolean</code></td><td><code>true</code></td><td>是否锁定页面滚动</td></tr><tr><td><code>closeOnClickModal</code></td><td><code>boolean</code></td><td><code>true</code></td><td>是否允许点击遮罩层关闭</td></tr></tbody></table><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><table><thead><tr><th>方法名</th><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>MessageBox()</code></td><td><code>options: MessageBoxOptions</code></td><td>显示自定义对话框</td></tr><tr><td><code>alert()</code></td><td>&#96;message: string</td><td>VNode, title?: string, options?: MessageBoxOptions&#96;</td></tr><tr><td><code>confirm()</code></td><td>&#96;message: string</td><td>VNode, title?: string, options?: MessageBoxOptions&#96;</td></tr><tr><td><code>prompt()</code></td><td>&#96;message: string</td><td>VNode, title?: string, options?: MessageBoxOptions&#96;</td></tr><tr><td><code>close()</code></td><td>-</td><td>关闭所有对话框</td></tr></tbody></table><h4 id="回调参数"><a href="#回调参数" class="headerlink" title="回调参数"></a>回调参数</h4><table><thead><tr><th>场景</th><th>返回值类型</th><th>说明</th></tr></thead><tbody><tr><td><code>alert</code></td><td><code>string</code> (<code>&#39;confirm&#39;</code>&#x2F;<code>&#39;close&#39;</code>)</td><td>用户操作类型</td></tr><tr><td><code>confirm/prompt</code></td><td><code>&#123; value: string; action: &#39;confirm&#39; &#125;</code> 或 <code>&#39;cancel&#39;</code>&#x2F;<code>&#39;close&#39;</code></td><td>包含输入值和操作类型（<code>prompt</code> 时返回输入值）</td></tr></tbody></table><hr><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li><p><strong>类型与默认配置</strong>：</p><ul><li><code>alert</code> 默认禁用遮罩层关闭，<code>confirm</code> 默认显示取消按钮，<code>prompt</code> 默认显示输入框和取消按钮。</li></ul></li><li><p><strong>异步处理</strong>：</p><ul><li><code>MessageBox</code> 返回 <code>Promise</code>，需通过 <code>.then()</code> 或 <code>await</code> 处理用户操作结果。</li></ul></li><li><p><strong>输入验证</strong>：</p><ul><li><code>prompt</code> 类型可通过 <code>beforeClose</code> 钩子验证输入内容，阻止无效提交。</li></ul></li><li><p><strong>样式扩展</strong>：</p><ul><li>按钮样式支持通过 <code>confirmButtonType</code>&#x2F;<code>cancelButtonType</code> 指定类型（如 <code>&#39;primary&#39;</code>&#x2F;<code>&#39;danger&#39;</code>）。</li></ul></li><li><p><strong>锁屏滚动</strong>：</p><ul><li><code>lockScroll</code> 启用时，页面滚动将被禁用，对话框居中显示。</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> 组件库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Message 消息提示组件</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Message%20%E6%B6%88%E6%81%AF%E6%8F%90%E7%A4%BA/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Message%20%E6%B6%88%E6%81%AF%E6%8F%90%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="Message-消息提示组件"><a href="#Message-消息提示组件" class="headerlink" title="Message 消息提示组件"></a>Message 消息提示组件</h1><hr><h2 id="Message-vue"><a href="#Message-vue" class="headerlink" title="Message.vue"></a>Message.vue</h2><h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">MessageProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; computed, onMounted, ref, watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useOffset &#125; <span class="keyword">from</span> <span class="string">&#x27;./methods&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; typeIconMap &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/utils&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrIcon</span> <span class="keyword">from</span> <span class="string">&#x27;../Icon/Icon.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;VrMessage&#x27;</span>, <span class="comment">// 定义组件名称</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">MessageProps</span>&gt;(), &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>, <span class="comment">// 默认类型</span></span><br><span class="line">    <span class="attr">duration</span>: <span class="number">3000</span>, <span class="comment">// 默认自动关闭时间</span></span><br><span class="line">    <span class="attr">offset</span>: <span class="number">10</span>, <span class="comment">// 消息间距</span></span><br><span class="line">    <span class="attr">transitionName</span>: <span class="string">&#x27;fade-up&#x27;</span>, <span class="comment">// 默认过渡动画</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">false</span>); <span class="comment">// 控制消息可见性</span></span><br><span class="line"><span class="keyword">const</span> messageRef = ref&lt;<span class="title class_">HTMLDivElement</span>&gt;(); <span class="comment">// 消息 DOM 引用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 图标映射（根据 type 映射图标）</span></span><br><span class="line"><span class="keyword">const</span> iconName = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> typeIconMap.<span class="title function_">get</span>(props.<span class="property">type</span>) ?? <span class="string">&#x27;circle-info&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算消息垂直位置</span></span><br><span class="line"><span class="keyword">const</span> &#123; topOffset, bottomOffset &#125; = <span class="title function_">useOffset</span>(&#123;</span><br><span class="line">    <span class="attr">getLastBottomOffset</span>: getLastBottomOffset.<span class="title function_">bind</span>(props),</span><br><span class="line">    <span class="attr">offset</span>: props.<span class="property">offset</span>,</span><br><span class="line">    <span class="attr">boxHeight</span>: <span class="title function_">computed</span>(<span class="function">() =&gt;</span> messageRef.<span class="property">value</span>?.<span class="property">offsetHeight</span> ?? <span class="number">0</span>),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态样式绑定</span></span><br><span class="line"><span class="keyword">const</span> cssStyle = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;topOffset.value&#125;</span>px`</span>,</span><br><span class="line">    <span class="attr">zIndex</span>: props.<span class="property">zIndex</span>,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">timer</span>: <span class="built_in">number</span>;</span><br><span class="line"><span class="comment">// 启动自动关闭定时器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">startTimer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">duration</span> === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(close, props.<span class="property">duration</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清除定时器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clearTimer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭消息</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">close</span>(<span class="params"></span>) &#123;</span><br><span class="line">    visible.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件挂载时初始化</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    visible.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="title function_">startTimer</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听 visible 变化触发销毁逻辑</span></span><br><span class="line"><span class="title function_">watch</span>(visible, <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!val) props.<span class="title function_">onDestory</span>(); <span class="comment">// 触发销毁回调</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 暴露方法给外部</span></span><br><span class="line"><span class="title function_">defineExpose</span>(&#123;</span><br><span class="line">    bottomOffset,</span><br><span class="line">    close,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="关键解释"><a href="#关键解释" class="headerlink" title="关键解释"></a><em><strong>关键解释</strong></em></h3><blockquote><p><code>defineOptions</code></p><p>定义组件名称为 <code>VrMessage</code>，在全局注册时需通过 <code>VrMessage</code> 调用。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line"> <span class="attr">name</span>: <span class="string">&#x27;VrMessage&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote><hr><blockquote><p><code>withDefaults</code></p><p>为 <code>props</code> 设置默认值：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">MessageProps</span>&gt;(), &#123;</span><br><span class="line"> <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line"> <span class="attr">duration</span>: <span class="number">3000</span>,</span><br><span class="line"> <span class="attr">offset</span>: <span class="number">10</span>,</span><br><span class="line"> <span class="attr">transitionName</span>: <span class="string">&#x27;fade-up&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote><hr><blockquote><p><code>useOffset</code></p><p>动态计算消息垂直位置：</p><ul><li><code>topOffset</code>：根据前一个消息的 <code>bottomOffset</code> 和 <code>offset</code> 累加计算当前消息的 <code>top</code> 值。</li><li><code>boxHeight</code>：通过 <code>messageRef</code> 获取当前消息的高度，用于计算后续消息的偏移。</li></ul></blockquote><hr><blockquote><p><code>Transition</code></p><p>通过 <code>transitionName</code> 控制入场&#x2F;离开动画：</p><ul><li><code>@after-leave</code>：动画结束后触发 <code>onDestory</code> 移除 DOM。</li></ul></blockquote><hr><blockquote><p><code>defineExpose</code></p><p>暴露以下属性和方法给外部：</p><ul><li><code>bottomOffset</code>：当前消息底部位置，供后续消息计算偏移。</li><li><code>close</code>：手动关闭消息的方法。</li></ul></blockquote><hr><h3 id="template"><a href="#template" class="headerlink" title="template"></a>template</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Transition</span><br><span class="line">    :name=&quot;transitionName&quot;</span><br><span class="line">    @after-leave=&quot;props.onDestory()&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&quot;visible&quot;</span><br><span class="line">      :style=&quot;cssStyle&quot;</span><br><span class="line">      class=&quot;vr-message&quot;</span><br><span class="line">      :class=&quot;&#123;</span><br><span class="line">        [`vr-message--$&#123;type&#125;`]: type, // 类型样式（如 vr-message--success）</span><br><span class="line">        &#x27;is-close&#x27;: showClose, // 是否显示关闭按钮</span><br><span class="line">        &#x27;text-center&#x27;: center, // 文字居中</span><br><span class="line">      &#125;&quot;</span><br><span class="line">      role=&quot;alert&quot;</span><br><span class="line">      @mouseenter=&quot;clearTimer&quot; // 鼠标进入暂停定时器</span><br><span class="line">      @mouseleave=&quot;startTimer&quot; // 鼠标离开重启定时器</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- 图标 --&gt;</span><br><span class="line">      &lt;vr-icon</span><br><span class="line">        v-if=&quot;type !== &#x27;text&#x27;&quot;</span><br><span class="line">        class=&quot;vr-message__icon&quot;</span><br><span class="line">        :icon=&quot;iconName&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;!-- 内容 --&gt;</span><br><span class="line">      &lt;div class=&quot;vr-message__content&quot;&gt;</span><br><span class="line">        &lt;slot&gt;</span><br><span class="line">          &lt;render-vnode v-if=&quot;message&quot; :vNode=&quot;message&quot; /&gt;</span><br><span class="line">        &lt;/slot&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 关闭按钮 --&gt;</span><br><span class="line">      &lt;div v-if=&quot;showClose&quot; class=&quot;vr-message__close&quot;&gt;</span><br><span class="line">        &lt;vr-icon icon=&quot;xmark&quot; @click.stop=&quot;close&quot; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/Transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="关键解释-1"><a href="#关键解释-1" class="headerlink" title="关键解释"></a><em><strong>关键解释</strong></em></h3><blockquote><p><code>Transition</code></p><ul><li><code>name=&quot;transitionName&quot;</code>：绑定动画名称（如 <code>fade-up</code>）。</li><li><code>@after-leave</code>：动画结束后触发 <code>onDestory</code> 移除 DOM。</li></ul></blockquote><hr><blockquote><p><code>v-show=&quot;visible&quot;</code></p><p>控制消息的显示&#x2F;隐藏，由 <code>visible</code> 响应式变量驱动。</p></blockquote><hr><blockquote><p><code>@mouseenter</code>&#x2F;<code>@mouseleave</code></p><ul><li>鼠标悬停时暂停自动关闭，移出后恢复定时器。</li></ul></blockquote><hr><blockquote><p>图标与内容</p><ul><li><code>type !== &#39;text&#39;</code>：文本类型不显示图标。</li><li><code>&lt;render-vnode&gt;</code>：渲染 <code>message</code> 属性传递的 VNode 内容（兼容字符串或自定义 VNode）。</li></ul></blockquote><hr><h3 id="methods-ts"><a href="#methods-ts" class="headerlink" title="methods.ts"></a>methods.ts</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">CreateMessageProps</span>, <span class="title class_">MessageInstance</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render, h, shallowReactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useZIndex &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/hooks&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instances = shallowReactive&lt;<span class="title class_">MessageInstance</span>[]&gt;([]);</span><br><span class="line"><span class="keyword">const</span> &#123; nextZIndex &#125; = <span class="title function_">useZIndex</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> messageDefaults = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="attr">offset</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">transitionName</span>: <span class="string">&#x27;fade-up&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建消息实例</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createMessage</span>(<span class="params"><span class="attr">props</span>: <span class="title class_">CreateMessageProps</span></span>): <span class="title class_">MessageInstance</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="string">`message-<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">destory</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> idx = instances.<span class="title function_">findIndex</span>(<span class="function"><span class="params">i</span> =&gt;</span> i.<span class="property">id</span> === id);</span><br><span class="line">        <span class="keyword">if</span> (idx !== -<span class="number">1</span>) &#123;</span><br><span class="line">            instances.<span class="title function_">splice</span>(idx, <span class="number">1</span>);</span><br><span class="line">            <span class="title function_">render</span>(<span class="literal">null</span>, container);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> _props = &#123;</span><br><span class="line">        ...props,</span><br><span class="line">        id,</span><br><span class="line">        <span class="attr">zIndex</span>: <span class="title function_">nextZIndex</span>(),</span><br><span class="line">        <span class="attr">onDestory</span>: destory,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> vnode = <span class="title function_">h</span>(<span class="title class_">MessageConstructor</span>, _props);</span><br><span class="line">    <span class="title function_">render</span>(vnode, container);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(container.<span class="property">firstElementChild</span>!);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        id,</span><br><span class="line">        vnode,</span><br><span class="line">        <span class="attr">props</span>: _props,</span><br><span class="line">        <span class="attr">handler</span>: &#123;</span><br><span class="line">            <span class="attr">close</span>: <span class="function">() =&gt;</span> vnode.<span class="property">component</span>!.<span class="property">exposed</span>!.<span class="title function_">close</span>(),</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取前一个消息的底部偏移</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getLastBottomOffset</span>(<span class="params"><span class="attr">this</span>: <span class="title class_">MessageProps</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> prevInstance = instances.<span class="title function_">find</span>(</span><br><span class="line">        <span class="function"><span class="params">i</span> =&gt;</span> i.<span class="property">id</span> &lt; <span class="variable language_">this</span>.<span class="property">id</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> prevInstance?.<span class="property">exposed</span>?.<span class="property">bottomOffset</span> ?? <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭所有消息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">closeAll</span>(<span class="params"><span class="attr">type</span>?: messageType</span>) &#123;</span><br><span class="line">    instances.<span class="title function_">forEach</span>(<span class="function"><span class="params">instance</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">type</span> || instance.<span class="property">props</span>.<span class="property">type</span> === <span class="keyword">type</span>) &#123;</span><br><span class="line">            instance.<span class="property">handler</span>.<span class="title function_">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="关键解释-2"><a href="#关键解释-2" class="headerlink" title="关键解释"></a><em><strong>关键解释</strong></em></h3><blockquote><p><code>createMessage</code></p><ul><li>生成唯一 <code>id</code>，并创建消息 DOM。</li><li>通过 <code>useZIndex</code> 管理层级，确保新消息始终在最上层。</li><li>将实例存入 <code>instances</code> 数组，支持批量操作。</li></ul></blockquote><hr><blockquote><p><code>getLastBottomOffset</code></p><p>根据当前消息的 <code>id</code>，查找前一个消息的 <code>bottomOffset</code>，用于计算当前消息的 <code>top</code> 值。</p></blockquote><hr><blockquote><p><code>closeAll</code></p><p>关闭指定类型或所有消息：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">message.<span class="title function_">closeAll</span>(<span class="string">&#x27;warning&#x27;</span>); <span class="comment">// 关闭所有警告类型消息</span></span><br><span class="line">message.<span class="title function_">closeAll</span>(); <span class="comment">// 关闭所有消息</span></span><br></pre></td></tr></table></figure></blockquote><hr><h3 id="types-ts"><a href="#types-ts" class="headerlink" title="types.ts"></a>types.ts</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">VNode</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> messageTypes = [<span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;warning&#x27;</span>, <span class="string">&#x27;danger&#x27;</span>, <span class="string">&#x27;error&#x27;</span>] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> messageType = (<span class="keyword">typeof</span> messageTypes)[<span class="built_in">number</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageProps</span> &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">message</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span> | (<span class="function">() =&gt;</span> <span class="title class_">VNode</span>);</span><br><span class="line">    <span class="attr">duration</span>?: <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">showClose</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">center</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">type</span>?: messageType;</span><br><span class="line">    <span class="attr">offset</span>?: <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">zIndex</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">transitionName</span>?: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">onDestory</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MessageOptions</span> = <span class="title class_">Partial</span>&lt;<span class="title class_">Omit</span>&lt;<span class="title class_">MessageProps</span>, <span class="string">&#x27;id&#x27;</span> | <span class="string">&#x27;onDestory&#x27;</span>&gt;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">MessageInstance</span> &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">vnode</span>: <span class="title class_">VNode</span>;</span><br><span class="line">    <span class="attr">props</span>: <span class="title class_">MessageProps</span>;</span><br><span class="line">    <span class="attr">handler</span>: &#123;</span><br><span class="line">        <span class="attr">close</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CreateMessageProps</span> = <span class="title class_">Omit</span>&lt;</span><br><span class="line">    <span class="title class_">MessageProps</span>,</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span> | <span class="string">&#x27;zIndex&#x27;</span> | <span class="string">&#x27;onDestory&#x27;</span></span><br><span class="line">&gt;;</span><br></pre></td></tr></table></figure><hr><h3 id="关键解释-3"><a href="#关键解释-3" class="headerlink" title="关键解释"></a><em><strong>关键解释</strong></em></h3><blockquote><p><code>messageTypes</code></p><p>定义支持的消息类型枚举：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> messageTypes = [</span><br><span class="line"> <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;warning&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;danger&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br></pre></td></tr></table></figure></blockquote><hr><blockquote><p><code>MessageProps</code></p><ul><li><code>id</code>: 消息唯一标识。</li><li><code>message</code>: 支持字符串、VNode 或返回 VNode 的函数。</li><li><code>showClose</code>: 是否显示关闭按钮。</li><li><code>center</code>: 内容是否居中。</li></ul></blockquote><hr><h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; message &#125; from &#x27;veyra-ui&#x27;;</span><br><span class="line"></span><br><span class="line">// 基础用法</span><br><span class="line">message(&#x27;操作成功&#x27;, &#123;</span><br><span class="line">    type: &#x27;success&#x27;,</span><br><span class="line">    duration: 2000,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 自定义内容</span><br><span class="line">message(&#123;</span><br><span class="line">    message: () =&gt; h(&#x27;div&#x27;, &#123; style: &#x27;color: red&#x27; &#125;, &#x27;自定义内容&#x27;),</span><br><span class="line">    showClose: true,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 关闭所有警告消息</span><br><span class="line">message.closeAll(&#x27;warning&#x27;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="核心-API"><a href="#核心-API" class="headerlink" title="核心 API"></a>核心 API</h3><h4 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h4><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>type</code></td><td><code>messageType</code></td><td><code>info</code></td><td>消息类型（<code>info/success/warning/danger/error</code>）</td></tr><tr><td><code>message</code></td><td>&#96;string</td><td>VNode</td><td>(() &#x3D;&gt; VNode)&#96;</td></tr><tr><td><code>duration</code></td><td><code>number</code></td><td><code>3000</code></td><td>自动关闭时间（毫秒），0 表示不关闭</td></tr><tr><td><code>showClose</code></td><td><code>boolean</code></td><td><code>false</code></td><td>是否显示关闭按钮</td></tr><tr><td><code>offset</code></td><td><code>number</code></td><td><code>10</code></td><td>消息垂直间距</td></tr><tr><td><code>transitionName</code></td><td><code>string</code></td><td><code>fade-up</code></td><td>过渡动画名称</td></tr></tbody></table><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><table><thead><tr><th>方法名</th><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>message()</code></td><td><code>MessageOptions</code></td><td>创建并显示消息</td></tr><tr><td><code>success()</code></td><td><code>MessageOptions</code></td><td>创建成功类型的消息</td></tr><tr><td><code>closeAll()</code></td><td><code>type?: messageType</code></td><td>关闭指定类型或所有消息</td></tr></tbody></table><h4 id="插槽"><a href="#插槽" class="headerlink" title="插槽"></a>插槽</h4><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>默认插槽</td><td>自定义消息内容（覆盖 <code>message</code> 属性）</td></tr></tbody></table><hr><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li><p><strong>位置堆叠</strong>：</p><ul><li>新消息会堆叠在前一个消息下方，通过 <code>offset</code> 控制间距。</li><li>首个消息从顶部 <code>offset</code> 开始布局。</li></ul></li><li><p><strong>动画与销毁</strong>：</p><ul><li><code>transitionName</code> 需配合 CSS 过渡类（如 <code>fade-up-enter-active</code>）。</li><li><code>@after-leave</code> 触发后自动移除 DOM。</li></ul></li><li><p><strong>类型扩展</strong>：</p><ul><li>通过 <code>messageTypes</code> 扩展支持的类型，需同步更新 <code>typeIconMap</code> 图标映射。</li></ul></li><li><p><strong>关闭逻辑</strong>：</p><ul><li>点击关闭按钮、Escape 键、或超出 <code>duration</code> 时间后自动关闭。</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> 组件库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Dropdown 下拉菜单</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Dropdown%20%E4%B8%8B%E6%8B%89%E8%8F%9C%E5%8D%95/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Dropdown%20%E4%B8%8B%E6%8B%89%E8%8F%9C%E5%8D%95/</url>
      
        <content type="html"><![CDATA[<h3 id="Dropdown-下拉菜单"><a href="#Dropdown-下拉菜单" class="headerlink" title="Dropdown 下拉菜单"></a>Dropdown 下拉菜单</h3><hr><h4 id="Dropdown-vue"><a href="#Dropdown-vue" class="headerlink" title="Dropdown.vue"></a><strong>Dropdown.vue</strong></h4><hr><h3 id="Script-部分"><a href="#Script-部分" class="headerlink" title="Script 部分"></a><strong>Script 部分</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, computed, provide &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; omit, isNil &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash-es&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">DropdownProps</span>, <span class="title class_">DropdownEmits</span>, <span class="title class_">DropdownContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useId, useDisabledStyle &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DROPDOWN_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrButton</span> <span class="keyword">from</span> <span class="string">&#x27;../Button/index.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrButtonGroup</span> <span class="keyword">from</span> <span class="string">&#x27;../ButtonGroup/index.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">DropdownItem</span> <span class="keyword">from</span> <span class="string">&#x27;./DropdownItem.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Tooltip</span> <span class="keyword">from</span> <span class="string">&#x27;../Tooltip/Tooltip.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;VrDropdown&#x27;</span>,</span><br><span class="line">  <span class="attr">inheritAttrs</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">DropdownProps</span>&gt;(), &#123;</span><br><span class="line">  <span class="attr">hideOnClick</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">items</span>: <span class="function">() =&gt;</span> [] <span class="keyword">as</span> <span class="title class_">DropdownItemProps</span>[],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emits = defineEmits&lt;<span class="title class_">DropdownEmits</span>&gt;()</span><br><span class="line"><span class="keyword">const</span> slots = <span class="title function_">defineSlots</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tooltipRef = ref&lt;<span class="title class_">TooltipInstance</span>&gt;()</span><br><span class="line"><span class="keyword">const</span> triggerRef = ref&lt;<span class="keyword">typeof</span> <span class="title class_">VrButton</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tooltipProps = <span class="title function_">computed</span>(<span class="function">() =&gt;</span></span><br><span class="line">  <span class="title function_">omit</span>(props, [<span class="string">&#x27;items&#x27;</span>, <span class="string">&#x27;hideAfterClick&#x27;</span>, <span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;splitButton&#x27;</span>])</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleItemClick</span>(<span class="params"><span class="attr">item</span>: <span class="title class_">DropdownItemProps</span></span>) &#123;</span><br><span class="line">  props.<span class="property">hideOnClick</span> &amp;&amp; tooltipRef.<span class="property">value</span>?.<span class="title function_">hide</span>()</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isNil</span>(item.<span class="property">command</span>)) <span class="title function_">emits</span>(<span class="string">&#x27;command&#x27;</span>, item.<span class="property">command</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">useDisabledStyle</span>()</span><br><span class="line"></span><br><span class="line">defineExpose&lt;<span class="title class_">DropdownInstance</span>&gt;(&#123;</span><br><span class="line">  <span class="attr">open</span>: <span class="function">() =&gt;</span> tooltipRef.<span class="property">value</span>?.<span class="title function_">show</span>(),</span><br><span class="line">  <span class="attr">close</span>: <span class="function">() =&gt;</span> tooltipRef.<span class="property">value</span>?.<span class="title function_">hide</span>(),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">provide</span>(<span class="variable constant_">DROPDOWN_CTX_KEY</span>, &#123;</span><br><span class="line">  handleItemClick,</span><br><span class="line">  <span class="attr">size</span>: <span class="title function_">computed</span>(<span class="function">() =&gt;</span> props.<span class="property">size</span>),</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h4 id="关键点解释"><a href="#关键点解释" class="headerlink" title="关键点解释"></a><strong>关键点解释</strong></h4><ol><li><p><strong>组件结构</strong></p><ul><li>继承自 <code>Tooltip</code>，通过 <code>tooltipProps</code> 传递配置，支持弹出位置、触发方式等。</li><li>支持 <code>splitButton</code> 模式：组合主按钮和下拉按钮（如 <code>VrButtonGroup</code>）。</li><li>提供 <code>open</code> 和 <code>close</code> 方法，通过 <code>defineExpose</code> 暴露给外部调用。</li></ul></li><li><p><strong>Props &amp; 默认值</strong></p><ul><li><code>items</code>：下拉项数组，每个项需包含 <code>command</code>、<code>label</code>、<code>disabled</code>、<code>divided</code> 等属性。</li><li><code>splitButton</code>：启用分体按钮模式（主按钮 + 下拉按钮）。</li><li><code>hideOnClick</code>：点击下拉项后自动关闭菜单。</li></ul></li><li><p><strong>事件处理</strong></p><ul><li><code>command</code>：当点击有 <code>command</code> 的项时触发，传递 <code>command</code> 值。</li><li><code>visible-change</code>：弹出层显示&#x2F;隐藏时触发，传递布尔值。</li></ul></li><li><p><strong>提供上下文（Provide&#x2F;Inject）</strong></p><ul><li>通过 <code>DROPDOWN_CTX_KEY</code> 向子组件 <code>DropdownItem</code> 提供 <code>handleItemClick</code> 和 <code>size</code>。</li><li><code>size</code> 用于子项样式适配。</li></ul></li></ol><hr><h3 id="Template-部分"><a href="#Template-部分" class="headerlink" title="Template 部分"></a><strong>Template 部分</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;vr-dropdown&quot; :id=&quot;`dropdown-$&#123;useId().value&#125;`&quot; :class=&quot;&#123; &#x27;is-disabled&#x27;: props.disabled &#125;&quot;&gt;</span><br><span class="line">    &lt;tooltip</span><br><span class="line">      ref=&quot;tooltipRef&quot;</span><br><span class="line">      v-bind=&quot;tooltipProps&quot;</span><br><span class="line">      :virtual-triggering=&quot;splitButton&quot;</span><br><span class="line">      :virtual-ref=&quot;triggerRef&quot;</span><br><span class="line">      @visible-change=&quot;$emit(&#x27;visible-change&#x27;, $event)&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- 触发器 --&gt;</span><br><span class="line">      &lt;vr-button-group</span><br><span class="line">        v-if=&quot;splitButton&quot;</span><br><span class="line">        :type=&quot;type&quot;</span><br><span class="line">        :size=&quot;size&quot;</span><br><span class="line">        :disabled=&quot;disabled&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;vr-button @click=&quot;$emit(&#x27;click&#x27;, $event)&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;default&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/vr-button&gt;</span><br><span class="line">        &lt;vr-button ref=&quot;triggerRef&quot; icon=&quot;angle-down&quot; /&gt;</span><br><span class="line">      &lt;/vr-button-group&gt;</span><br><span class="line">      &lt;!-- 单一触发器 --&gt;</span><br><span class="line">      &lt;slot v-else name=&quot;default&quot;&gt;&lt;/slot&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 下拉内容 --&gt;</span><br><span class="line">      &lt;template #content&gt;</span><br><span class="line">        &lt;ul class=&quot;vr-dropdown__menu&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;dropdown&quot;&gt;</span><br><span class="line">            &lt;template v-for=&quot;item in items&quot; :key=&quot;item.command ?? useId().value&quot;&gt;</span><br><span class="line">              &lt;dropdown-item v-bind=&quot;item&quot; /&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/slot&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/tooltip&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><hr><h4 id="关键点解释-1"><a href="#关键点解释-1" class="headerlink" title="关键点解释"></a><strong>关键点解释</strong></h4><ol><li><p><strong>触发器模式</strong></p><ul><li><strong>分体按钮模式（splitButton）</strong>：<ul><li>使用 <code>VrButtonGroup</code> 包含主按钮和下拉箭头按钮。</li><li>主按钮点击触发 <code>click</code> 事件，下拉箭头按钮控制弹出层。</li></ul></li><li><strong>普通模式</strong>：<ul><li>直接使用插槽内容作为触发器（如自定义按钮或图标）。</li></ul></li></ul></li><li><p><strong>下拉内容渲染</strong></p><ul><li>通过 <code>#content</code> 插槽渲染下拉菜单，优先使用 <code>slot=&quot;dropdown&quot;</code> 的自定义内容。</li><li>默认遍历 <code>items</code> 数组，渲染 <code>DropdownItem</code> 组件。</li></ul></li><li><p><strong>样式与禁用状态</strong></p><ul><li><code>is-disabled</code> 类控制禁用状态样式。</li><li>分体按钮模式下，按钮组的最后一个按钮（箭头）样式通过 <code>:deep</code> 进行 CSS 覆盖。</li></ul></li></ol><hr><h4 id="DropdownItem-vue"><a href="#DropdownItem-vue" class="headerlink" title="DropdownItem.vue"></a><strong>DropdownItem.vue</strong></h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; inject, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useId &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/hooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DROPDOWN_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">DropdownItemProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;VrDropdownItem&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">DropdownItemProps</span>&gt;(), &#123;</span><br><span class="line">  <span class="attr">command</span>: <span class="title function_">useId</span>().<span class="property">value</span>,</span><br><span class="line">  <span class="attr">divided</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">disabled</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ctx = <span class="title function_">inject</span>(<span class="variable constant_">DROPDOWN_CTX_KEY</span>)</span><br><span class="line"><span class="keyword">const</span> size = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> ctx?.<span class="property">size</span>.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="property">disabled</span>) <span class="keyword">return</span></span><br><span class="line">  ctx?.<span class="title function_">handleItemClick</span>(props)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-if</span>=<span class="string">&quot;divided&quot;</span> <span class="attr">role</span>=<span class="string">&quot;separator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;divided-placeholder&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">li</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">:id</span>=<span class="string">&quot;`dropdown-item-$&#123;command ?? useId().value&#125;`&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">:class</span>=<span class="string">&quot;&#123;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">      &#x27;vr-dropdown__item&#x27;: true,</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">      [`vr-dropdown__item--$&#123;size&#125;`]: size,</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">      &#x27;is-disabled&#x27;: disabled,</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">      &#x27;is-divided&#x27;: divided,</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">    &#125;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    @<span class="attr">click</span>=<span class="string">&quot;handleClick&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  &gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span>&#123;&#123; label &#125;&#125;<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure><hr><h4 id="关键点解释-2"><a href="#关键点解释-2" class="headerlink" title="关键点解释"></a><strong>关键点解释</strong></h4><ol><li><p><strong>项的渲染</strong></p><ul><li><code>divided</code> 属性：当为 <code>true</code> 时渲染分隔符（<code>role=&quot;separator&quot;</code> 的 <code>li</code> 元素）。</li><li><code>command</code>：唯一标识符，用于触发 <code>command</code> 事件。</li></ul></li><li><p><strong>样式适配</strong></p><ul><li>根据父组件的 <code>size</code> 动态添加类名（如 <code>vr-dropdown__item--large</code>）。</li><li><code>is-disabled</code> 和 <code>is-divided</code> 控制禁用和分隔符样式。</li></ul></li><li><p><strong>事件触发</strong></p><ul><li>点击非禁用项时，调用父组件的 <code>handleItemClick</code> 方法，并传递自身 <code>props</code>。</li></ul></li></ol><hr><h4 id="辅助文件"><a href="#辅助文件" class="headerlink" title="辅助文件"></a><strong>辅助文件</strong></h4><ol><li><p><strong>constants.ts</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">DropdownContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">DROPDOWN_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">DropdownContext</span>&gt; = <span class="title class_">Symbol</span>(<span class="string">&quot;dropdownContext&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li>定义注入键 <code>DROPDOWN_CTX_KEY</code>，用于在子组件中注入上下文。</li></ul></li><li><p><strong>types.ts</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownItemProps</span> &#123;</span><br><span class="line">  <span class="attr">command</span>?: <span class="built_in">string</span> | <span class="built_in">number</span></span><br><span class="line">  <span class="attr">label</span>?: <span class="built_in">string</span> | <span class="title class_">VNode</span></span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line">  <span class="attr">divided</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownProps</span> <span class="keyword">extends</span> <span class="title class_">TooltipProps</span> &#123;</span><br><span class="line">  <span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line">  <span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line">  <span class="attr">items</span>?: <span class="title class_">DropdownItemProps</span>[]</span><br><span class="line">  <span class="attr">hideOnClick</span>?: <span class="built_in">boolean</span></span><br><span class="line">  <span class="attr">splitButton</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">DropdownEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;visible-change&quot;</span>, <span class="attr">value</span>: <span class="built_in">boolean</span>): <span class="title function_">void</span></span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;command&quot;</span>, <span class="attr">value</span>: <span class="title class_">DropdownCommand</span>): <span class="title function_">void</span></span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;click&quot;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>DropdownProps</strong>：继承 <code>TooltipProps</code>，支持 <code>placement</code>、<code>trigger</code> 等属性。</li><li><strong>DropdownItemProps</strong>：定义下拉项属性，如 <code>command</code>、<code>disabled</code>、<code>divided</code>。</li></ul></li></ol><hr><h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a><strong>使用示例</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;vr-dropdown</span><br><span class="line">    v-model:visible=&quot;visible&quot;</span><br><span class="line">    :items=&quot;items&quot;</span><br><span class="line">    split-button</span><br><span class="line">    type=&quot;primary&quot;</span><br><span class="line">    @command=&quot;handleCommand&quot;</span><br><span class="line">    @visible-change=&quot;handleVisibleChange&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;template #default&gt;</span><br><span class="line">      &lt;vr-button&gt;自定义触发器&lt;/vr-button&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;template #dropdown&gt;</span><br><span class="line">      &lt;ul class=&quot;custom-menu&quot;&gt;</span><br><span class="line">        &lt;vr-dropdown-item command=&quot;custom1&quot;&gt;自定义项1&lt;/vr-dropdown-item&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/vr-dropdown&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const items = ref([</span><br><span class="line">  &#123; label: &#x27;选项1&#x27;, command: &#x27;cmd1&#x27; &#125;,</span><br><span class="line">  &#123; label: &#x27;选项2&#x27;, command: &#x27;cmd2&#x27;, divided: true &#125;,</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">const handleCommand = (command: string) =&gt; &#123;</span><br><span class="line">  console.log(&#x27;Command:&#x27;, command)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="核心机制总结"><a href="#核心机制总结" class="headerlink" title="核心机制总结"></a><strong>核心机制总结</strong></h3><ol><li><strong>弹出层集成</strong>：基于 <code>Tooltip</code> 实现，支持位置、触发方式等配置。</li><li><strong>分体按钮模式</strong>：通过 <code>splitButton</code> 展示主按钮和下拉按钮组合。</li><li><strong>动态项渲染</strong>：通过 <code>items</code> 数组或 <code>slot=&quot;dropdown&quot;</code> 自定义下拉内容。</li><li><strong>事件交互</strong>：<ul><li><code>command</code>：点击带 <code>command</code> 的项时触发。</li><li><code>visible-change</code>：弹出层状态变化时触发。</li></ul></li><li><strong>样式适配</strong>：通过 <code>size</code> 和 <code>type</code> 继承按钮样式，支持分隔符和禁用状态。</li></ol><p>通过 <code>provide/inject</code> 实现父子组件通信，确保下拉项点击能触发父组件的事件。</p>]]></content>
      
      
      <categories>
          
          <category> 组件库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Collapse 折叠面板</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Collapse%20%E6%8A%98%E5%8F%A0%E9%9D%A2%E6%9D%BF/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Collapse%20%E6%8A%98%E5%8F%A0%E9%9D%A2%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<h1 id="Collapse-折叠面板"><a href="#Collapse-折叠面板" class="headerlink" title="Collapse 折叠面板"></a>Collapse 折叠面板</h1><h2 id="Collapse-vue"><a href="#Collapse-vue" class="headerlink" title="Collapse.vue"></a>Collapse.vue</h2><h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, provide, watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; each &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash-es&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">CollapseItemName</span>, <span class="title class_">CollapseProps</span>, <span class="title class_">CollapseEmits</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; debugWarn &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">COLLAPSE_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">COMPONENT_NAME</span> = <span class="string">&#x27;VrCollapse&#x27;</span> <span class="keyword">as</span> <span class="keyword">const</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="variable constant_">COMPONENT_NAME</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = defineProps&lt;<span class="title class_">CollapseProps</span>&gt;()</span><br><span class="line"><span class="keyword">const</span> emits = defineEmits&lt;<span class="title class_">CollapseEmits</span>&gt;()</span><br><span class="line"><span class="keyword">const</span> activeNames = ref&lt;<span class="title class_">CollapseItemName</span>[]&gt;(props.<span class="property">modelValue</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (props.<span class="property">accordion</span> &amp;&amp; activeNames.<span class="property">value</span>.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="title function_">debugWarn</span>(<span class="variable constant_">COMPONENT_NAME</span>, <span class="string">&#x27;accordion mode should only have one active item&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleItemClick</span>(<span class="params"><span class="attr">item</span>: <span class="title class_">CollapseItemName</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> _activeNames = [...activeNames.<span class="property">value</span>]</span><br><span class="line">    <span class="comment">// 手风琴模式</span></span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">accordion</span>) &#123;</span><br><span class="line">        _activeNames = [_activeNames[<span class="number">0</span>] === item ? <span class="string">&#x27;&#x27;</span> : item]</span><br><span class="line">        <span class="title function_">updateActiveNames</span>(_activeNames)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> index = _activeNames.<span class="title function_">indexOf</span>(item)</span><br><span class="line">    <span class="keyword">if</span> (index &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 存在，删除数组中的一项</span></span><br><span class="line">        _activeNames.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 不存在，插入对应 name</span></span><br><span class="line">        _activeNames.<span class="title function_">push</span>(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">updateActiveNames</span>(_activeNames)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateActiveNames</span>(<span class="params"><span class="attr">val</span>: <span class="title class_">CollapseItemName</span>[]</span>) &#123;</span><br><span class="line">    activeNames.<span class="property">value</span> = val</span><br><span class="line">    <span class="title function_">each</span>([<span class="string">&#x27;update:modelValue&#x27;</span>, <span class="string">&#x27;change&#x27;</span>], <span class="function">(<span class="params">e</span>) =&gt;</span></span><br><span class="line">        <span class="title function_">emits</span>(e <span class="keyword">as</span> <span class="string">&#x27;update:modelValue&#x27;</span> &amp; <span class="string">&#x27;change&#x27;</span>, val)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> props.<span class="property">modelValue</span>,</span><br><span class="line">    <span class="function">(<span class="params">val</span>) =&gt;</span> <span class="title function_">updateActiveNames</span>(val)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="title function_">provide</span>(<span class="variable constant_">COLLAPSE_CTX_KEY</span>, &#123;</span><br><span class="line">    activeNames,</span><br><span class="line">    handleItemClick,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><em><strong>关键解释</strong></em></p><blockquote><p><code>defineOptions</code></p><blockquote><p>最终导出组件名为 <code>VrCollapse</code>，在 <code>packages\core\components.ts</code> 中以以下形式导入</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">VrCollapse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/components&#x27;</span></span><br></pre></td></tr></table></figure></blockquote></blockquote><blockquote><p><code>props</code> 和 <code>modelValue</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">const</span> props = defineProps&lt;<span class="title class_">CollapseProps</span>&gt;()</span><br></pre></td></tr></table></figure><p>接口定义：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseProps</span> &#123;</span><br><span class="line">&gt;<span class="attr">modelValue</span>: <span class="title class_">CollapseItemName</span>[] <span class="comment">// 必须是数组</span></span><br><span class="line">&gt;<span class="attr">accordion</span>?: <span class="built_in">boolean</span> <span class="comment">// 是否为手风琴模式</span></span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><p><code>modelValue</code> 通过 <code>v-model</code> 实现双向绑定，<code>watch</code> 监听其变化并同步到 <code>activeNames</code></p></blockquote><blockquote><p><code>provide</code> 上下文</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="title function_">provide</span>(<span class="variable constant_">COLLAPSE_CTX_KEY</span>, &#123;</span><br><span class="line">&gt;activeNames,</span><br><span class="line">&gt;handleItemClick,</span><br><span class="line">&gt;&#125;)</span><br></pre></td></tr></table></figure><p>通过注入键 <code>COLLAPSE_CTX_KEY</code>，子组件 <code>CollapseItem</code> 可以通过 <code>inject</code> 获取父组件的状态和方法</p></blockquote><blockquote><p><code>handleItemClick</code> 逻辑</p><ul><li><strong>手风琴模式</strong>：仅允许一个展开项，点击时切换为当前项或清空</li><li><strong>普通模式</strong>：点击时切换项的展开&#x2F;收起状态</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">if</span> (props.<span class="property">accordion</span>) &#123;</span><br><span class="line"> _activeNames = [_activeNames[<span class="number">0</span>] === item ? <span class="string">&#x27;&#x27;</span> : item]</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><code>updateActiveNames</code> 和 <code>emits</code></p><p>同时触发 <code>update:modelValue</code>（双向绑定）和 <code>change</code> 事件</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="title function_">each</span>([<span class="string">&#x27;update:modelValue&#x27;</span>, <span class="string">&#x27;change&#x27;</span>], <span class="function">(<span class="params">e</span>) =&gt;</span></span><br><span class="line">&gt;<span class="title function_">emits</span>(e <span class="keyword">as</span> ..., val)</span><br><span class="line">&gt;)</span><br></pre></td></tr></table></figure></blockquote><hr><h3 id="template"><a href="#template" class="headerlink" title="template"></a>template</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;vr-collapse&quot;&gt;</span><br><span class="line">  &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><em><strong>关键解释</strong></em></p><blockquote><p>容器组件</p><p>通过 <code>&lt;slot&gt;</code> 插入 <code>CollapseItem</code> 子组件，内容由子组件自行渲染</p></blockquote><hr><h2 id="CollapseItem-vue"><a href="#CollapseItem-vue" class="headerlink" title="CollapseItem.vue"></a>CollapseItem.vue</h2><h3 id="script-1"><a href="#script-1" class="headerlink" title="script"></a>script</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; inject, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">COLLAPSE_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> transitionEvents <span class="keyword">from</span> <span class="string">&#x27;./transitionEvents&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrIcon</span> <span class="keyword">from</span> <span class="string">&#x27;../Icon/Icon.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;VrCollapseItem&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = defineProps&lt;<span class="title class_">CollapseItemProps</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ctx = <span class="title function_">inject</span>(<span class="variable constant_">COLLAPSE_CTX_KEY</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isActive = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> ctx?.<span class="property">activeNames</span>.<span class="property">value</span>?.<span class="title function_">includes</span>(props.<span class="property">name</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">disabled</span>) <span class="keyword">return</span></span><br><span class="line">    ctx?.<span class="title function_">handleItemClick</span>(props.<span class="property">name</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em><strong>关键解释</strong></em></p><blockquote><p><code>inject</code> 获取父组件上下文</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">const</span> ctx = <span class="title function_">inject</span>(<span class="variable constant_">COLLAPSE_CTX_KEY</span>)</span><br></pre></td></tr></table></figure><p>通过 <code>COLLAPSE_CTX_KEY</code> 注入键，获取父组件的 <code>activeNames</code> 和 <code>handleItemClick</code> 方法</p></blockquote><blockquote><p><code>isActive</code> 计算属性</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">const</span> isActive = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> ctx?.<span class="property">activeNames</span>.<span class="property">value</span>?.<span class="title function_">includes</span>(props.<span class="property">name</span>))</span><br></pre></td></tr></table></figure><p>根据父组件的 <code>activeNames</code> 判断当前项是否处于展开状态</p></blockquote><blockquote><p><code>handleClick</code> 点击事件</p><ul><li>检查 <code>disabled</code> 属性，禁用项不可点击</li><li>通过 <code>ctx?.handleItemClick</code> 通知父组件更新选中状态</li></ul></blockquote><hr><h3 id="template-1"><a href="#template-1" class="headerlink" title="template"></a>template</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">    class=&quot;vr-collapse-item&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">        &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">    &#125;&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">        class=&quot;vr-collapse-item__header&quot;</span><br><span class="line">        :id=&quot;`item-header-$&#123;name&#125;`&quot;</span><br><span class="line">        :class=&quot;&#123;</span><br><span class="line">            &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">            &#x27;is-active&#x27;: isActive,</span><br><span class="line">        &#125;&quot;</span><br><span class="line">        @click=&quot;handleClick&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;vr-collapse-item__title&quot;&gt;</span><br><span class="line">            &lt;slot name=&quot;title&quot;&gt;</span><br><span class="line">                &#123;&#123; title &#125;&#125;</span><br><span class="line">            &lt;/slot&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">        &lt;vr-icon icon=&quot;angle-right&quot; class=&quot;header-angle&quot; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;transition name=&quot;slide&quot; v-on=&quot;transitionEvents&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;vr-collapse-item__wapper&quot; v-show=&quot;isActive&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;vr-collapse-item__content&quot; :id=&quot;`item-content-$&#123;name&#125;`&quot;&gt;</span><br><span class="line">                &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><em><strong>关键解释</strong></em></p><blockquote><p><code>transition</code> 动画</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&lt;transition name=&quot;slide&quot; v-on=&quot;transitionEvents&quot;&gt;</span><br></pre></td></tr></table></figure><p>引入 <code>transitionEvents.ts</code> 中定义的过渡钩子函数，控制高度变化实现折叠动画</p></blockquote><blockquote><p><code>v-show=&quot;isActive&quot;</code></p><p>根据 <code>isActive</code> 状态决定是否显示内容区域</p></blockquote><blockquote><p><code>header-angle</code> 图标</p><p>默认使用 <code>angle-right</code> 图标，方向可通过自定义图标修改</p></blockquote><hr><h2 id="constants-ts"><a href="#constants-ts" class="headerlink" title="constants.ts"></a>constants.ts</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">CollapseContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">COLLAPSE_CTX_KEY</span>: <span class="title class_">InjectionKey</span>&lt;<span class="title class_">CollapseContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;collapseContext&quot;</span>);</span><br></pre></td></tr></table></figure><p><em><strong>关键解释</strong></em></p><blockquote><p>注入键 <code>COLLAPSE_CTX_KEY</code></p><p>允许 <code>CollapseItem</code> 通过 <code>inject</code> 获取父组件的 <code>CollapseContext</code>，包含 <code>activeNames</code> 和 <code>handleItemClick</code> 方法</p></blockquote><hr><h2 id="transitionEvents-ts"><a href="#transitionEvents-ts" class="headerlink" title="transitionEvents.ts"></a>transitionEvents.ts</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">_setHeightZero</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;0px&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setHeightScroll</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt;</span><br><span class="line">  (el.<span class="property">style</span>.<span class="property">height</span> = <span class="string">`<span class="subst">$&#123;el.scrollHeight&#125;</span>px`</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setHeightEmpty</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setOverflowHidden</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&quot;hidden&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_setOverflowEmpty</span> = (<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt; (el.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">transitionEvents</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="function">(<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span></span>) =&gt;</span> <span class="built_in">void</span>&gt; = &#123;</span><br><span class="line">  <span class="title function_">beforeEnter</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightZero</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowHidden</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">enter</span>: <span class="function">(<span class="params">el</span>) =&gt;</span> <span class="title function_">_setHeightScroll</span>(el),</span><br><span class="line">  <span class="title function_">afterEnter</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightEmpty</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowEmpty</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeLeave</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightScroll</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowHidden</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">leave</span>: <span class="function">(<span class="params">el</span>) =&gt;</span> <span class="title function_">_setHeightZero</span>(el),</span><br><span class="line">  <span class="title function_">afterLeave</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="title function_">_setHeightEmpty</span>(el);</span><br><span class="line">    <span class="title function_">_setOverflowEmpty</span>(el);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> transitionEvents;</span><br></pre></td></tr></table></figure><p><em><strong>关键解释</strong></em></p><blockquote><p>过渡动画实现</p><ul><li><strong>beforeEnter&#x2F;afterEnter</strong>：控制元素高度从 <code>0</code> 到 <code>scrollHeight</code> 再恢复默认</li><li><strong>beforeLeave&#x2F;afterLeave</strong>：控制元素高度从 <code>scrollHeight</code> 到 <code>0</code> 再恢复默认</li><li><strong>overflow</strong>：过渡过程中设置 <code>overflow: hidden</code> 避免内容溢出</li></ul></blockquote><hr><h2 id="types-ts"><a href="#types-ts" class="headerlink" title="types.ts"></a>types.ts</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">CollapseItemName</span> = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseProps</span> &#123;</span><br><span class="line">  <span class="attr">modelValue</span>: <span class="title class_">CollapseItemName</span>[];</span><br><span class="line">  <span class="attr">accordion</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseItemProps</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="title class_">CollapseItemName</span>;</span><br><span class="line">  <span class="attr">title</span>?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">disabled</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseContext</span> &#123;</span><br><span class="line">  <span class="attr">activeNames</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">CollapseItemName</span>[]&gt;;</span><br><span class="line">  <span class="title function_">handleItemClick</span>(<span class="attr">name</span>: <span class="title class_">CollapseItemName</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseEmits</span> &#123;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;update:modelValue&quot;</span>, <span class="attr">value</span>: <span class="title class_">CollapseItemName</span>[]): <span class="built_in">void</span>;</span><br><span class="line">  (<span class="attr">e</span>: <span class="string">&quot;change&quot;</span>, <span class="attr">value</span>: <span class="title class_">CollapseItemName</span>[]): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em><strong>关键解释</strong></em></p><blockquote><p><code>CollapseContext</code> 接口</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CollapseContext</span> &#123;</span><br><span class="line">&gt;<span class="attr">activeNames</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">CollapseItemName</span>[]&gt;</span><br><span class="line">&gt;<span class="title function_">handleItemClick</span>(<span class="attr">name</span>: <span class="title class_">CollapseItemName</span>): <span class="built_in">void</span></span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><p>定义父组件通过 <code>provide</code> 暴露给子组件的上下文数据和方法</p></blockquote><blockquote><p><code>CollapseItemProps</code> 必要属性</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="attr">name</span>: <span class="title class_">CollapseItemName</span> <span class="comment">// 必须唯一标识符</span></span><br></pre></td></tr></table></figure><p>用于判断是否被选中，支持字符串或数字类型</p></blockquote><blockquote><p><code>emits</code> 事件说明</p><ul><li><code>update:modelValue</code>：双向绑定更新值</li><li><code>change</code>：选中状态变化时触发</li></ul></blockquote><hr><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>Collapse 组件通过以下核心机制实现折叠面板功能：</p><ol><li><strong>双向绑定</strong>：通过 <code>v-model</code> 绑定 <code>modelValue</code>，结合 <code>update:modelValue</code> 和 <code>change</code> 事件同步状态</li><li><strong>手风琴模式</strong>：通过 <code>accordion</code> 属性限制仅展开一个项</li><li><strong>状态共享</strong>：通过 <code>provide/inject</code> 实现父组件与子组件的状态和方法传递</li><li><strong>动画效果</strong>：通过 <code>transitionEvents</code> 控制高度变化实现平滑过渡</li></ol><p>使用示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;vr-collapse v-model=&quot;activeNames&quot; :accordion=&quot;true&quot;&gt;</span><br><span class="line">  &lt;vr-collapse-item </span><br><span class="line">    v-for=&quot;item in items&quot; </span><br><span class="line">    :key=&quot;item.id&quot; </span><br><span class="line">    :name=&quot;item.id&quot;</span><br><span class="line">    :title=&quot;item.title&quot;&gt;</span><br><span class="line">    &#123;&#123; item.content &#125;&#125;</span><br><span class="line">  &lt;/vr-collapse-item&gt;</span><br><span class="line">&lt;/vr-collapse&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 组件库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Button 按钮</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Button%20%E6%8C%89%E9%92%AE/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Button%20%E6%8C%89%E9%92%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="Button-按钮"><a href="#Button-按钮" class="headerlink" title="Button 按钮"></a>Button 按钮</h1><h2 id="Button-vue"><a href="#Button-vue" class="headerlink" title="Button.vue"></a>Button.vue</h2><h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, computed, inject &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ButtonProps</span>, <span class="title class_">ButtonEmits</span>, <span class="title class_">ButtonInstance</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">BUTTON_GROUP_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; throttle &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash-es&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrIcon</span> <span class="keyword">from</span> <span class="string">&#x27;../Icon/Icon.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;VrButton&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">ButtonProps</span>&gt;(), &#123;</span><br><span class="line">    <span class="attr">tag</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">    <span class="attr">nativeType</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">    <span class="attr">useThrottle</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">throttleDuration</span>: <span class="number">500</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emits = defineEmits&lt;<span class="title class_">ButtonEmits</span>&gt;();</span><br><span class="line"><span class="keyword">const</span> slots = <span class="title function_">defineSlots</span>();</span><br><span class="line"><span class="keyword">const</span> buttonGroupCtx = <span class="title function_">inject</span>(<span class="variable constant_">BUTTON_GROUP_CTX_KEY</span>, <span class="built_in">void</span> <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _ref = ref&lt;<span class="title class_">HTMLElement</span>&gt;();</span><br><span class="line"><span class="keyword">const</span> size = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> buttonGroupCtx?.<span class="property">size</span> ?? props.<span class="property">size</span> ?? <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">type</span> = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> buttonGroupCtx?.<span class="property">type</span> ?? props.<span class="property">type</span> ?? <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> disabled = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> props.<span class="property">disabled</span> || buttonGroupCtx?.<span class="property">disabled</span> || <span class="literal">false</span>);</span><br><span class="line"><span class="keyword">const</span> hasDefaultSlot = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> !!slots.<span class="property">default</span>);</span><br><span class="line"><span class="keyword">const</span> iconStyle = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">marginRight</span>: hasDefaultSlot.<span class="property">value</span> ? <span class="string">&#x27;6px&#x27;</span> : <span class="string">&#x27;0px&#x27;</span>,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleBtnClick</span> = (<span class="params"><span class="attr">e</span>: <span class="title class_">MouseEvent</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">emits</span>(<span class="string">&#x27;click&#x27;</span>, e);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleBtnClickThrottle = <span class="title function_">throttle</span>(</span><br><span class="line">    handleBtnClick,</span><br><span class="line">    props.<span class="property">throttleDuration</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">defineExpose&lt;<span class="title class_">ButtonInstance</span>&gt;(&#123;</span><br><span class="line">    <span class="attr">ref</span>: _ref,</span><br><span class="line">    disabled,</span><br><span class="line">    size,</span><br><span class="line">    <span class="keyword">type</span>,</span><br><span class="line">    <span class="attr">loading</span>: <span class="title function_">computed</span>(<span class="function">() =&gt;</span> props.<span class="property">loading</span>),</span><br><span class="line">    <span class="attr">click</span>: handleBtnClick,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><em><strong>关键解释</strong></em></p><blockquote><p><code>defineOptions</code></p><blockquote><p>最终导出组件名为 <code>VrButton</code>，在 packages\core\components.ts 中以以下形式导入</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">VrButton</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/components&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><blockquote><p><code>withDefaults</code></p><blockquote><p>给 <code>defineProps</code> 绑定<strong>默认值</strong></p></blockquote><blockquote><p>接口</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">ButtonProps</span>&#123;</span><br><span class="line">    <span class="attr">tag</span>?: <span class="built_in">string</span> | <span class="title class_">Component</span></span><br><span class="line">    <span class="attr">size</span>?: <span class="string">&#x27;default&#x27;</span> | <span class="string">&#x27;large&#x27;</span> | <span class="string">&#x27;small&#x27;</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">ButtonProps</span>&gt;(), &#123;</span><br><span class="line">   <span class="attr">tag</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">   <span class="attr">nativeType</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">   <span class="attr">useThrottle</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">throttleDuration</span>: <span class="number">500</span>,</span><br><span class="line">&gt;&#125;)</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><code>defineEmits</code></p><blockquote><p>子向父发射事件</p></blockquote><p><strong>子组件</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emits = defineEmits&lt;<span class="title class_">ButtonEmits</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleBtnClick</span> = (<span class="params"><span class="attr">e</span>: <span class="title class_">MouseEvent</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">emits</span>(<span class="string">&#x27;click&#x27;</span>, e)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> handleBtneCLickThrottle = <span class="title function_">throttle</span>(</span><br><span class="line">    handleBtnClick,</span><br><span class="line">    props.<span class="property">throttleDuration</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>父组件</strong> 用户使用组件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;vr-... @click=&quot;Click&quot; /&gt; //当接收到子组件发射过来的事件之后，触发父组件自己的&#x27;Click&#x27;函数</span><br></pre></td></tr></table></figure><blockquote><p>1.点击后 子组件的 <code>@click</code> 被触发，将一个 <code>MouseEvent</code> 类型事件传入 <code>handleBtnClick</code> 或 <code>handleBtneCLickThrottle</code> 函数</p><p>2.<code>emits(&#39;click&#39;, e)</code> 向父组件发射 <code>&#39;click&#39;</code> 事件</p><p>3.父组件通过@click响应到 <code>&#39;click&#39;</code> 事件, 开始执行父组件中自定义的 <code>Click</code> 事件</p></blockquote></blockquote><blockquote><p><code>defineSlots</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> slots = <span class="title function_">defineSlots</span>()</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> iconStyle = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">marginRight</span>: slots.<span class="property">default</span> ? <span class="string">&#x27;6px&#x27;</span> : <span class="string">&#x27;0px&#x27;</span>,</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><blockquote><p>检测组件是否有<slot>默认插槽, 有则插入样式 <code>marginRight: 6px</code></p></blockquote></blockquote><h3 id="template"><a href="#template" class="headerlink" title="template"></a>template</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;component</span><br><span class="line">    :is=&quot;tag&quot;</span><br><span class="line">    ref=&quot;_ref&quot;</span><br><span class="line">    class=&quot;vr-button&quot;</span><br><span class="line">    :class=&quot;&#123;</span><br><span class="line">      [`vr-button--$&#123;type&#125;`]: type,</span><br><span class="line">      [`vr-button--$&#123;size&#125;`]: size,</span><br><span class="line">      &#x27;is-plain&#x27;: plain,</span><br><span class="line">      &#x27;is-round&#x27;: round,</span><br><span class="line">      &#x27;is-circle&#x27;: circle,</span><br><span class="line">      &#x27;is-disabled&#x27;: disabled,</span><br><span class="line">      &#x27;is-loading&#x27;: loading,</span><br><span class="line">    &#125;&quot;</span><br><span class="line">    :disabled=&quot;disabled || loading&quot;</span><br><span class="line">    :type=&quot;tag === &#x27;button&#x27; ? nativeType : void 0&quot;</span><br><span class="line">    :autofocus=&quot;autofocus&quot;</span><br><span class="line">    @click=&quot;useThrottle ? handleBtnClickThrottle : handleBtnClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;template v-if=&quot;loading&quot;&gt;</span><br><span class="line">      &lt;slot name=&quot;loading&quot;&gt;</span><br><span class="line">        &lt;vr-icon</span><br><span class="line">          class=&quot;loading-icon&quot;</span><br><span class="line">          :icon=&quot;loadingIcon ?? &#x27;spinner&#x27;&quot;</span><br><span class="line">          :style=&quot;iconStyle&quot;</span><br><span class="line">          size=&quot;1x&quot;</span><br><span class="line">          spin</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;vr-icon</span><br><span class="line">      v-if=&quot;icon &amp;&amp; !loading&quot;</span><br><span class="line">      :icon=&quot;icon&quot;</span><br><span class="line">      size=&quot;1x&quot;</span><br><span class="line">      :style=&quot;iconStyle&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">&lt;/component&gt;</span><br></pre></td></tr></table></figure><p><em><strong>关键解释</strong></em></p><blockquote><p><code>&lt;component&gt;&lt;/component&gt;</code>是vue内置的动态组件<br>通过:is可控制组件的最终类型</p><p>例如<code>&lt;component :is=&quot;button&quot;&gt;&lt;/component&gt;</code>的最终渲染结果为<code>&lt;button&gt;&lt;/button&gt;</code></p></blockquote><blockquote><p><code>ref=&quot;_ref&quot;</code></p><p>首先，<code>ref</code> 属性的作用是将 **DOM 元素 **或 <strong>子组件实例</strong> <em><strong>绑定</strong></em> 到对应的 <strong>响应式变量</strong> 上</p><blockquote><p><code>ref=&quot;_ref&quot;</code> 将渲染的 DOM 元素（例如 <code>&lt;button&gt;</code> 或 <code>&lt;a&gt;</code>）绑定到 <code>_ref</code> 变量</p><p>组件挂载后，<code>_ref.value</code> 就会指向这个 DOM 元素</p></blockquote><p>使用 <code>defineExpose</code> 将 <code>_ref</code> 暴露给父组件，允许父组件访问子组件的 DOM 元素</p><p>例如，父组件可以调用子组件按钮的 <code>focus()</code> 方法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&lt;vr-button ref=&quot;myButton&quot; /&gt;</span><br><span class="line">&gt;&lt;button @click=&quot;focus&quot;&gt;focus vr-button&lt;/button&gt;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">const</span> myButton = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">function</span> <span class="title function_">focus</span>(<span class="params"></span>) &#123;</span><br><span class="line">   myButton.<span class="property">value</span>.<span class="property">ref</span>.<span class="title function_">focus</span>() <span class="comment">// 调用子组件的 DOM 元素的 focus 方法</span></span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>当用户点击父组件的按钮时，子组件的按钮会获得焦点</p></blockquote></blockquote><blockquote><p><code>:class</code></p><p>使用对象语法动态绑定类名</p><p>例如文中两种</p><blockquote><p>当 <code>type</code> 存在时（如 <code>primary</code>、<code>success</code>），添加类名 <code>er-button--primary</code></p></blockquote><blockquote><p><code>&#39;is-plain&#39;: plain</code></p><p>当 plain 为 true 时，添加类名 <code>is-plain</code></p></blockquote></blockquote><h2 id="constants-ts"><a href="#constants-ts" class="headerlink" title="constants.ts"></a>constants.ts</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">InjectionKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ButtonGroupContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//注入键（Injection Key）（BUTTON_GROUP_CTX_KEY）</span></span><br><span class="line"><span class="comment">//主要作用是为按钮组组件（`ButtonGroup`）提供上下文（context），使得按钮组中的子按钮可以访问父级按钮组的相关信息。</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">BUTTON_GROUP_CTX_KEY</span>: </span><br><span class="line"><span class="title class_">InjectionKey</span>&lt;<span class="title class_">ButtonGroupContext</span>&gt; =</span><br><span class="line">  <span class="title class_">Symbol</span>(<span class="string">&quot;buttonGroupContext&quot;</span>);<span class="comment">//原始数据类型，用于创建唯一的标识符</span></span><br></pre></td></tr></table></figure><p><em><strong>关键解释</strong></em></p><blockquote><p>举个例子</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父组件</span></span><br><span class="line"><span class="comment">//使用 `provide` 方法将某些数据或方法提供给子组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; provide &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>; </span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">BUTTON_GROUP_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constants&quot;</span>; </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; </span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123; </span><br><span class="line"><span class="keyword">const</span> buttonGroupContext = &#123; <span class="attr">size</span>: <span class="string">&quot;large&quot;</span>, <span class="attr">type</span>: <span class="string">&quot;primary&quot;</span>, &#125;; </span><br><span class="line"><span class="title function_">provide</span>(<span class="variable constant_">BUTTON_GROUP_CTX_KEY</span>, buttonGroupContext); <span class="comment">// 提供上下文 </span></span><br><span class="line"><span class="keyword">return</span> &#123;&#125;; </span><br><span class="line">&#125;, </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//子组件</span></span><br><span class="line"><span class="comment">//通过 `inject` 方法获取父组件提供的上下文</span></span><br><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">BUTTON_GROUP_CTX_KEY</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constants&quot;</span>; </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123; </span><br><span class="line"><span class="keyword">const</span> buttonGroupContext = <span class="title function_">inject</span>(<span class="variable constant_">BUTTON_GROUP_CTX_KEY</span>); <span class="comment">// 注入上下文 </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buttonGroupContext); <span class="comment">// 输出 &#123; size: &quot;large&quot;, type: &quot;primary&quot; &#125; </span></span><br><span class="line"><span class="keyword">return</span> &#123;&#125;; </span><br><span class="line">&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></blockquote><h2 id="types-ts"><a href="#types-ts" class="headerlink" title="types.ts"></a>types.ts</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">type</span> <span class="title class_">Component</span>, <span class="keyword">type</span> <span class="title class_">ComputedRef</span>, <span class="keyword">type</span> <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ButtonType</span> = <span class="string">&#x27;primary&#x27;</span> | <span class="string">&#x27;success&#x27;</span> | <span class="string">&#x27;warning&#x27;</span> | <span class="string">&#x27;danger&#x27;</span> | <span class="string">&#x27;info&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">NativeType</span> = <span class="string">&#x27;button&#x27;</span> | <span class="string">&#x27;submit&#x27;</span> | <span class="string">&#x27;reset&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">ButtonSize</span> = <span class="string">&#x27;default&#x27;</span> | <span class="string">&#x27;large&#x27;</span> | <span class="string">&#x27;small&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonProps</span> &#123;</span><br><span class="line"><span class="attr">tag</span>?: <span class="built_in">string</span> | <span class="title class_">Component</span></span><br><span class="line"><span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line"><span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line"><span class="attr">plain</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">round</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">circle</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">autofocus</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">nativeType</span>?: <span class="title class_">NativeType</span></span><br><span class="line"><span class="attr">icon</span>?: <span class="built_in">string</span></span><br><span class="line"><span class="attr">loading</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">loadingIcon</span>?: <span class="built_in">string</span></span><br><span class="line"><span class="attr">useThrottle</span>?: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">throttleDuration</span>?: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonGroupProps</span> &#123;</span><br><span class="line"><span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line"><span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line"><span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonGroupContext</span> &#123;</span><br><span class="line"><span class="attr">size</span>?: <span class="title class_">ButtonSize</span></span><br><span class="line"><span class="attr">type</span>?: <span class="title class_">ButtonType</span></span><br><span class="line"><span class="attr">disabled</span>?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonEmits</span> &#123;</span><br><span class="line">(<span class="attr">e</span>: <span class="string">&#x27;click&#x27;</span>, <span class="attr">value</span>: <span class="title class_">MouseEvent</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ButtonInstance</span> &#123;</span><br><span class="line"><span class="attr">ref</span>: <span class="title class_">Ref</span>&lt;<span class="title class_">HTMLButtonElement</span> | <span class="built_in">void</span>&gt;</span><br><span class="line"><span class="attr">disabled</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">boolean</span>&gt;</span><br><span class="line"><span class="attr">size</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line"><span class="attr">type</span>: <span class="title class_">ComputedRef</span>&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 组件库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Alert 提示组件</title>
      <link href="/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Alert%20%E6%8F%90%E7%A4%BA/"/>
      <url>/2025/04/03/%E7%BB%84%E4%BB%B6%E5%BA%93/Alert%20%E6%8F%90%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<h3 id="Alert-警告提示组件分析"><a href="#Alert-警告提示组件分析" class="headerlink" title="Alert 警告提示组件分析"></a>Alert 警告提示组件分析</h3><hr><h4 id="组件功能概述"><a href="#组件功能概述" class="headerlink" title="组件功能概述"></a><strong>组件功能概述</strong></h4><p>Alert 组件用于显示不同类型（如成功、警告等）的提示信息，支持关闭、图标、居中对齐等功能，通过 <code>v-model</code> 或 <code>v-show</code> 控制显示状态。</p><hr><h4 id="核心代码解析"><a href="#核心代码解析" class="headerlink" title="核心代码解析"></a><strong>核心代码解析</strong></h4><hr><h3 id="Script-部分"><a href="#Script-部分" class="headerlink" title="Script 部分"></a><strong>Script 部分</strong></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">AlertProps</span>, <span class="title class_">AlertEmits</span>, <span class="title class_">AlertInstance</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; typeIconMap &#125; <span class="keyword">from</span> <span class="string">&#x27;@veyra/utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VrIcon</span> <span class="keyword">from</span> <span class="string">&#x27;../Icon/Icon.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;VrAlert&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">AlertProps</span>&gt;(), &#123;</span><br><span class="line">  <span class="attr">effect</span>: <span class="string">&#x27;light&#x27;</span>,      <span class="comment">// 默认视觉效果</span></span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,         <span class="comment">// 默认类型</span></span><br><span class="line">  <span class="attr">closable</span>: <span class="literal">true</span>,       <span class="comment">// 默认显示关闭按钮</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emits = defineEmits&lt;<span class="title class_">AlertEmits</span>&gt;()</span><br><span class="line"><span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">true</span>) <span class="comment">// 控制显示状态</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iconName = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> </span><br><span class="line">  typeIconMap.<span class="title function_">get</span>(props.<span class="property">type</span>) ?? <span class="string">&#x27;circle-info&#x27;</span> <span class="comment">// 根据类型获取图标</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> withDescription = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> </span><br><span class="line">  props.<span class="property">description</span> || !!<span class="title function_">useSlots</span>().<span class="property">default</span> <span class="comment">// 判断是否有描述内容</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">close</span>(<span class="params"></span>) &#123;</span><br><span class="line">  visible.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">  <span class="title function_">emits</span>(<span class="string">&#x27;close&#x27;</span>) <span class="comment">// 触发关闭事件</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">open</span>(<span class="params"></span>) &#123;</span><br><span class="line">  visible.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defineExpose&lt;<span class="title class_">AlertInstance</span>&gt;(&#123;</span><br><span class="line">  open,</span><br><span class="line">  close,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h4 id="关键点解释"><a href="#关键点解释" class="headerlink" title="关键点解释"></a><strong>关键点解释</strong></h4><ol><li><p><strong>Props 默认值</strong></p><ul><li><code>effect</code>：默认 <code>light</code>（浅色背景）</li><li><code>type</code>：默认 <code>info</code>（信息类型）</li><li><code>closable</code>：默认显示关闭按钮</li></ul></li><li><p><strong>图标逻辑</strong></p><ul><li>通过 <code>typeIconMap</code> 映射类型到图标（如 <code>success → check-circle</code>）</li><li>默认图标为 <code>circle-info</code>（当类型未匹配时）</li></ul></li><li><p><strong>内容判断</strong></p><ul><li><code>withDescription</code>：若存在 <code>description</code> 或默认插槽内容，则认为有描述，调整图标大小</li></ul></li><li><p><strong>状态控制</strong></p><ul><li><code>visible</code>：通过 <code>v-show</code> 控制组件显示</li><li><code>close</code> 方法触发 <code>close</code> 事件并隐藏组件</li><li><code>open</code> 方法暴露给外部调用</li></ul></li></ol><hr><h3 id="Template-部分"><a href="#Template-部分" class="headerlink" title="Template 部分"></a><strong>Template 部分</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition name=&quot;vr-alert-fade&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&quot;visible&quot;</span><br><span class="line">      class=&quot;vr-alert&quot;</span><br><span class="line">      role=&quot;alert&quot;</span><br><span class="line">      :class=&quot;&#123;</span><br><span class="line">        [`vr-alert__$&#123;type&#125;`]: type,</span><br><span class="line">        [`vr-alert__$&#123;effect&#125;`]: effect,</span><br><span class="line">        &#x27;text-center&#x27;: center,</span><br><span class="line">      &#125;&quot;&gt;</span><br><span class="line">      &lt;!-- 图标 --&gt;</span><br><span class="line">      &lt;vr-icon</span><br><span class="line">        v-if=&quot;showIcon&quot;</span><br><span class="line">        class=&quot;vr-alert__icon&quot;</span><br><span class="line">        :class=&quot;&#123; &#x27;big-icon&#x27;: withDescription &#125;&quot;</span><br><span class="line">        :icon=&quot;iconName&quot; /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 内容区域 --&gt;</span><br><span class="line">      &lt;div class=&quot;vr-alert__content&quot;&gt;</span><br><span class="line">        &lt;span</span><br><span class="line">          class=&quot;vr-alert__title&quot;</span><br><span class="line">          :class=&quot;&#123; &#x27;with-desc&#x27;: withDescription &#125;&quot;</span><br><span class="line">          :style=&quot;&#123; display: center &amp;&amp; !showIcon ? &#x27;flow&#x27; : &#x27;inline&#x27; &#125;&quot;&gt;</span><br><span class="line">          &lt;slot name=&quot;title&quot;&gt;&#123;&#123; title &#125;&#125;&lt;/slot&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 描述内容 --&gt;</span><br><span class="line">        &lt;p class=&quot;vr-alert__description&quot;&gt;</span><br><span class="line">          &lt;slot&gt;&#123;&#123; description &#125;&#125;&lt;/slot&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 关闭按钮 --&gt;</span><br><span class="line">        &lt;div v-if=&quot;closable&quot; class=&quot;vr-alert__close&quot; @click.stop=&quot;close&quot;&gt;</span><br><span class="line">          &lt;vr-icon icon=&quot;xmark&quot; /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><hr><h4 id="关键点解释-1"><a href="#关键点解释-1" class="headerlink" title="关键点解释"></a><strong>关键点解释</strong></h4><ol><li><p><strong>过渡动画</strong></p><ul><li>使用 <code>vr-alert-fade</code> 实现渐隐效果（需在样式中定义过渡类）</li></ul></li><li><p><strong>类名控制</strong></p><ul><li><code>vr-alert__type</code>：根据 <code>type</code> 添加类型样式（如 <code>vr-alert__success</code>）</li><li><code>vr-alert__effect</code>：根据 <code>effect</code> 添加视觉效果样式</li><li><code>text-center</code>：居中对齐内容</li></ul></li><li><p><strong>图标显示</strong></p><ul><li><code>showIcon</code> 控制是否显示图标</li><li><code>big-icon</code> 类在有描述时增大图标尺寸</li></ul></li><li><p><strong>标题与描述</strong></p><ul><li>标题支持自定义插槽，使用 <code>slot=&quot;title&quot;</code></li><li>描述内容使用默认插槽或 <code>description</code> 属性</li><li>当 <code>center</code> 为 <code>true</code> 且无图标时，标题采用 <code>flex</code> 布局（可能存在 <code>flow</code> 拼写错误）</li></ul></li><li><p><strong>关闭按钮</strong></p><ul><li>点击关闭时阻止事件冒泡（<code>@click.stop</code>）</li><li>图标使用 <code>xmark</code>（叉号）</li></ul></li></ol><hr><h3 id="核心机制总结"><a href="#核心机制总结" class="headerlink" title="核心机制总结"></a><strong>核心机制总结</strong></h3><ol><li><p><strong>类型与图标映射</strong></p><ul><li>通过 <code>typeIconMap</code> 将 <code>AlertType</code> 映射到具体图标（如 <code>success → check-circle</code>）。</li></ul></li><li><p><strong>内容与布局</strong></p><ul><li>支持标题、描述、关闭按钮的组合显示。</li><li><code>center</code> 属性使内容居中，需配合无图标时的 <code>flex</code> 布局调整。</li></ul></li><li><p><strong>状态控制</strong></p><ul><li><code>visible</code> 控制显示，通过 <code>v-show</code> 和 <code>transition</code> 实现渐隐动画。</li><li>外部可通过 <code>alertRef.close()</code> 或 <code>v-model</code> 控制显示。</li></ul></li><li><p><strong>视觉效果</strong></p><ul><li><code>effect</code> 控制背景色和边框色（<code>light</code> 或 <code>dark</code>）。</li><li><code>type</code> 决定颜色主题（如成功、警告等）。</li></ul></li></ol><hr><h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a><strong>使用示例</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;vr-alert</span><br><span class="line">    v-model:visible=&quot;alertVisible&quot;</span><br><span class="line">    type=&quot;success&quot;</span><br><span class="line">    closable</span><br><span class="line">    center</span><br><span class="line">    show-icon</span><br><span class="line">    @close=&quot;handleClose&quot;&gt;</span><br><span class="line">    &lt;template #title&gt;操作成功&lt;/template&gt;</span><br><span class="line">    &lt;p&gt;您的操作已成功完成！&lt;/p&gt;</span><br><span class="line">  &lt;/vr-alert&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const alertVisible = ref(true)</span><br><span class="line">const handleClose = () =&gt; &#123;</span><br><span class="line">  alertVisible.value = false</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="API-文档"><a href="#API-文档" class="headerlink" title="API 文档"></a><strong>API 文档</strong></h3><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>type</code></td><td><code>AlertType</code></td><td><code>info</code></td><td>提示类型（success&#x2F;info&#x2F;warning&#x2F;danger）</td></tr><tr><td><code>effect</code></td><td><code>string</code></td><td><code>light</code></td><td>视觉效果（light&#x2F;dark）</td></tr><tr><td><code>closable</code></td><td><code>boolean</code></td><td><code>true</code></td><td>是否显示关闭按钮</td></tr><tr><td><code>center</code></td><td><code>boolean</code></td><td><code>false</code></td><td>内容是否居中</td></tr><tr><td><code>showIcon</code></td><td><code>boolean</code></td><td><code>true</code></td><td>是否显示图标</td></tr><tr><td><code>title</code></td><td><code>string</code></td><td>-</td><td>标题文本</td></tr><tr><td><code>description</code></td><td><code>string</code></td><td>-</td><td>描述文本</td></tr></tbody></table><table><thead><tr><th>插槽</th><th>说明</th></tr></thead><tbody><tr><td><code>title</code></td><td>自定义标题内容</td></tr><tr><td><code>default</code></td><td>自定义描述内容</td></tr></tbody></table><table><thead><tr><th>事件</th><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>close</code></td><td>无</td><td>关闭时触发</td></tr></tbody></table><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><code>open()</code></td><td>显示提示</td></tr><tr><td><code>close()</code></td><td>隐藏提示</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 组件库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>通俗版Promise解释</title>
      <link href="/2025/03/08/JS/%E9%80%9A%E4%BF%97%E7%89%88Promise%E8%A7%A3%E9%87%8A/"/>
      <url>/2025/03/08/JS/%E9%80%9A%E4%BF%97%E7%89%88Promise%E8%A7%A3%E9%87%8A/</url>
      
        <content type="html"><![CDATA[<h1 id="通俗版Promise解释"><a href="#通俗版Promise解释" class="headerlink" title="通俗版Promise解释"></a>通俗版Promise解释</h1><p><strong>首先要理解前端的同步异步任务流程</strong></p><h2 id="同步-vs-异步任务"><a href="#同步-vs-异步任务" class="headerlink" title="同步 vs 异步任务"></a>同步 vs 异步任务</h2><h3 id="同步任务（排队买奶茶）"><a href="#同步任务（排队买奶茶）" class="headerlink" title="同步任务（排队买奶茶）"></a><strong>同步任务（排队买奶茶）</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 你站在柜台前干等，不做其他事</span><br><span class="line">console.log(&quot;1. 点单：我要珍珠奶茶&quot;);</span><br><span class="line">console.log(&quot;2. 等店员制作...（干等5秒）&quot;);</span><br><span class="line">// 模拟同步等待</span><br><span class="line">const start = Date.now();</span><br><span class="line">while (Date.now() - start &lt; 5000) &#123;&#125; // 直接阻断后面的进程，阻塞5秒</span><br><span class="line">console.log(&quot;3. 拿到奶茶，开心喝！&quot;);</span><br></pre></td></tr></table></figure><hr><h3 id="异步任务（外卖通知）"><a href="#异步任务（外卖通知）" class="headerlink" title="异步任务（外卖通知）"></a><strong>异步任务（外卖通知）</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">console.log(&quot;1. 手机下单奶茶&quot;);</span><br><span class="line">// 异步操作：下单后先做其他事，等通知</span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  console.log(&quot;3. 外卖员通知：奶茶到啦！&quot;);</span><br><span class="line">&#125;, 5000); // 5秒后才触发回调，不阻塞主进程</span><br><span class="line">console.log(&quot;2. 下单成功，先去打游戏~&quot;);</span><br></pre></td></tr></table></figure><p><strong>输出顺序</strong>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 手机下单奶茶  </span><br><span class="line">2. 下单成功，先去打游戏~  </span><br><span class="line">3. 外卖员通知：奶茶到啦！  </span><br></pre></td></tr></table></figure><h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>**可以把 <strong><strong>Promise</strong> 想象成一张 <strong>订餐时的订单小票</strong>。</strong> **你点了一份外卖（发起一个异步操作），这时候服务员不会让你干等着，而是给你一张订单小票（Promise对象），告诉你：“餐好了会通知你”。</p><hr><h3 id="通俗版解释："><a href="#通俗版解释：" class="headerlink" title="通俗版解释："></a><strong>通俗版解释：</strong></h3><ol><li><strong>下单（Pending状态）</strong><ul><li>**你点了餐，但饭还没做好 → **<code>new Promise()</code> 创建时处于 <strong>进行中（Pending）</strong>。</li><li><strong>此时你（代码）可以继续做其他事（比如玩手机），不用一直盯着厨房。（异步）</strong></li></ul></li><li><strong>餐好了（Fulfilled状态）</strong><ul><li>**厨房通知你：“餐好了，来取吧！” → Promise **<strong>成功（Resolved）</strong>。</li><li>**你拿到饭后开始吃 → 用 **<code>.then()</code> 处理成功的结果：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order.then(food =&gt; eat(food)); // 拿到饭就吃</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>餐出问题了（Rejected状态）</strong><ul><li>**厨房说：“抱歉，没食材了” → Promise **<strong>失败（Rejected）</strong>。</li><li>**你决定泡面 → 用 **<code>.catch()</code> 处理失败：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order.catch(error =&gt; eatInstantNoodles()); // 失败就吃泡面</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>无论如何都要收拾桌子（Finally）</strong><ul><li>**不管吃没吃到外卖，你都要擦桌子 → **<code>.finally()</code>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order.finally(() =&gt; cleanTable()); // 无论成败都执行</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h3 id="为什么比-“回调函数”-更好？"><a href="#为什么比-“回调函数”-更好？" class="headerlink" title="为什么比 “回调函数” 更好？"></a><strong>为什么比 “回调函数” 更好？</strong></h3><ul><li><strong>回调地狱（Callback Hell）</strong>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">// 传统回调写法</span><br><span class="line">function orderMilkTea(callback) &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        console.log(&quot;1. 拿到基础奶茶&quot;);</span><br><span class="line">        callback(null, &quot;🍵基础奶茶&quot;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addPearl(tea, callback) &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        console.log(&quot;2. 加珍珠&quot;);</span><br><span class="line">        callback(null, tea + &quot; + 🎱珍珠&quot;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addCheeseFoam(tea, callback) &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        console.log(&quot;3. 加奶盖&quot;);</span><br><span class="line">        callback(null, tea + &quot; + 🧀奶盖&quot;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 使用回调地狱</span><br><span class="line">orderMilkTea((error, tea) =&gt; &#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(&quot;失败：&quot;, error);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        addPearl(tea, (error, teaWithPearl) =&gt; &#123;</span><br><span class="line">            if (error) &#123;</span><br><span class="line">                console.log(&quot;失败：&quot;, error);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                addCheeseFoam(teaWithPearl, (error, finalTea) =&gt; &#123;</span><br><span class="line">                    if (error) &#123;</span><br><span class="line">                        console.log(&quot;失败：&quot;, error);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        console.log(&quot;最终奶茶：&quot;, finalTea);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><strong>Promise链式调用</strong>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">// 用Promise包装异步操作</span><br><span class="line">function orderMilkTea() &#123;</span><br><span class="line">    return new Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&quot;1. 拿到基础奶茶&quot;);</span><br><span class="line">            resolve(&quot;🍵基础奶茶&quot;);</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addPearl(tea) &#123;</span><br><span class="line">    return new Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&quot;2. 加珍珠&quot;);</span><br><span class="line">            resolve(tea + &quot; + 🧋珍珠&quot;);</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addCheeseFoam(tea) &#123;</span><br><span class="line">    return new Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&quot;3. 加奶盖&quot;);</span><br><span class="line">            resolve(tea + &quot; + 🧀奶盖&quot;);</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 链式调用</span><br><span class="line">orderMilkTea()</span><br><span class="line">    .then(tea =&gt; addPearl(tea))</span><br><span class="line">    .then(teaWithPearl =&gt; addCheeseFoam(teaWithPearl))</span><br><span class="line">    .then(finalTea =&gt; &#123;</span><br><span class="line">    console.log(&quot;最终奶茶：&quot;, finalTea);</span><br><span class="line">&#125;)</span><br><span class="line">    .catch(error =&gt; &#123;</span><br><span class="line">    console.log(&quot;失败：&quot;, error);</span><br><span class="line">&#125;)</span><br><span class="line">    .finally(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;流程结束，清理操作&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="一句话总结："><a href="#一句话总结：" class="headerlink" title="一句话总结："></a><strong>一句话总结：</strong></h3><p>**Promise 就是一张 ****“未来事件保证书”**，告诉程序：“别干等，先忙你的，事情成了或黄了，我都会给你个交代！”</p>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>项目中z-index规划设计</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E4%B8%ADz-index%E7%9A%84%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E4%B8%ADz-index%E7%9A%84%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="项目中z-index的规划设计"><a href="#项目中z-index的规划设计" class="headerlink" title="项目中z-index的规划设计"></a>项目中z-index的规划设计</h2><p><strong>技术规范：夹层模型</strong></p><p><strong>整个结构分为APP层和页面组件层。APP只有一个，但页面有很多。</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1~999：都是页面内比较正常的元素</span><br><span class="line"></span><br><span class="line">1000~1999：弹窗的灰色遮罩背景之类的组件，或者是能够遮住全屏的加载动画</span><br><span class="line"></span><br><span class="line">2000~2999：弹窗面板，比如突然弹出来一个界面提示框，登录框、警告框之类的</span><br><span class="line"></span><br><span class="line">3000~3999：页面鼠标交互层：比如在这个界面，会有一个鼠标点击一下就能让屏幕上多出来一个小桃心的上浮动画，这个小桃心就可以用绝对定位一个div来实现。但他的z-index必须很高，比弹窗组件还要高。</span><br></pre></td></tr></table></figure><p><strong>有了界面层，其实还应该有个全局的APP层，APP层是完全高于界面层的一种层。和界面一样，也有遮罩层、弹窗面板层和鼠标交互层。为了方便记忆，直接设定APP层为四位数上万。</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">也就是10000~~19999,20000~~29999,30000~39999。</span><br></pre></td></tr></table></figure><p><strong>值得注意的是，该模型中不仅有向上的考虑，还有0以下的考虑</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可以设定一个页面背景层，让z-index：-1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">然后再设计一个APP通用背景层，z-index：-2。</span><br></pre></td></tr></table></figure><p><strong>总结</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1000以内都是正常页面，上千级别是页面级别的东西，上万级别是APP级别的东西。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1xxx+是弹窗背景，2xxx+是弹窗，3xxx+是鼠标交互层。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>快速上手EChart(Vue项目)</title>
      <link href="/2025/03/08/%E5%B7%A5%E5%85%B7/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BEChart%E5%90%AB%E5%9B%BE%E8%A1%A8%E6%A8%A1%E6%9D%BF_vue%E9%A1%B9%E7%9B%AE%E5%86%99%E6%B3%95/"/>
      <url>/2025/03/08/%E5%B7%A5%E5%85%B7/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BEChart%E5%90%AB%E5%9B%BE%E8%A1%A8%E6%A8%A1%E6%9D%BF_vue%E9%A1%B9%E7%9B%AE%E5%86%99%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>本文是基于 EChart 官方文档进行的简化</p><p><a href="https://echarts.apache.org/handbook/zh/get-started/" title="快速上手 - 使用手册 - Apache ECharts">快速上手 - 使用手册 - Apache ECharts</a></p><h2 id="ECharts"><a href="#ECharts" class="headerlink" title="ECharts"></a>ECharts</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install echarts --save</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><h4 id="全局导入"><a href="#全局导入" class="headerlink" title="全局导入"></a>全局导入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 引入 ECharts 核心模块</span><br><span class="line">import * as echarts from &#x27;echarts/core&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h4 id="按需导入"><a href="#按需导入" class="headerlink" title="按需导入"></a>按需导入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">由于不同图表类型需要导入的东西非常杂乱，以下为导入分类总结</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><p>渲染器（必）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 引入 Canvas 渲染器</span><br><span class="line">import &#123; CanvasRenderer &#125; from &#x27;echarts/renderers&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><p>图表类型</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 引入柱状图图表</span><br><span class="line">import &#123; BarChart &#125; from &#x27;echarts/charts&#x27;;</span><br><span class="line"></span><br><span class="line">// 引入折线图图表</span><br><span class="line">import &#123; LineChart &#125; from &#x27;echarts/charts&#x27;;</span><br><span class="line"></span><br><span class="line">// 引入饼图图表</span><br><span class="line">import &#123; PieChart &#125; from &#x27;echarts/charts&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><p>组件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 引入标题组件</span><br><span class="line">import &#123; TitleComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// 引入提示框组件</span><br><span class="line">import &#123; TooltipComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// 引入直角坐标系组件（用于柱状图、折线图等）</span><br><span class="line">import &#123; GridComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// 引入数据集组件</span><br><span class="line">import &#123; DatasetComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// 引入内置数据转换器组件</span><br><span class="line">import &#123; TransformComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// 引入图例组件（用于饼图等）</span><br><span class="line">import &#123; LegendComponent &#125; from &#x27;echarts/components&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><p>特性</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 引入标签自动布局特性</span><br><span class="line">import &#123; LabelLayout &#125; from &#x27;echarts/features&#x27;;</span><br><span class="line"></span><br><span class="line">// 引入全局过渡动画特性</span><br><span class="line">import &#123; UniversalTransition &#125; from &#x27;echarts/features&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><p>注册组件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 注册必须的组件和特性</span><br><span class="line">echarts.use([</span><br><span class="line">  TitleComponent,      // 标题组件</span><br><span class="line">  TooltipComponent,    // 提示框组件</span><br><span class="line">  GridComponent,       // 直角坐标系组件</span><br><span class="line">  DatasetComponent,    // 数据集组件</span><br><span class="line">  TransformComponent,  // 内置数据转换器组件</span><br><span class="line">  BarChart,            // 柱状图</span><br><span class="line">  LineChart,           // 折线图</span><br><span class="line">  PieChart,            // 饼图</span><br><span class="line">  LabelLayout,         // 标签自动布局特性</span><br><span class="line">  UniversalTransition, // 全局过渡动画特性</span><br><span class="line">  CanvasRenderer,      // Canvas 渲染器</span><br><span class="line">  LegendComponent,     // 图例组件</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h5 id="完整示例模板"><a href="#完整示例模板" class="headerlink" title="完整示例模板"></a>完整示例模板</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import &#123; onMounted &#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">// 引入 ECharts 核心模块</span><br><span class="line">import * as echarts from &#x27;echarts/core&#x27;;</span><br><span class="line"></span><br><span class="line">// 引入图表类型</span><br><span class="line">import &#123; BarChart &#125; from &#x27;echarts/charts&#x27;;        // 柱状图</span><br><span class="line">import &#123; LineChart &#125; from &#x27;echarts/charts&#x27;;       // 折线图</span><br><span class="line">import &#123; PieChart &#125; from &#x27;echarts/charts&#x27;;        // 饼图</span><br><span class="line"></span><br><span class="line">// 引入组件</span><br><span class="line">import &#123; TitleComponent &#125; from &#x27;echarts/components&#x27;;      // 标题组件</span><br><span class="line">import &#123; TooltipComponent &#125; from &#x27;echarts/components&#x27;;    // 提示框组件</span><br><span class="line">import &#123; GridComponent &#125; from &#x27;echarts/components&#x27;;       // 直角坐标系组件</span><br><span class="line">import &#123; DatasetComponent &#125; from &#x27;echarts/components&#x27;;    // 数据集组件</span><br><span class="line">import &#123; TransformComponent &#125; from &#x27;echarts/components&#x27;;  // 内置数据转换器组件</span><br><span class="line">import &#123; LegendComponent &#125; from &#x27;echarts/components&#x27;;     // 图例组件</span><br><span class="line"></span><br><span class="line">// 引入特性</span><br><span class="line">import &#123; LabelLayout &#125; from &#x27;echarts/features&#x27;;           // 标签自动布局特性</span><br><span class="line">import &#123; UniversalTransition &#125; from &#x27;echarts/features&#x27;;   // 全局过渡动画特性</span><br><span class="line"></span><br><span class="line">// 引入渲染器</span><br><span class="line">import &#123; CanvasRenderer &#125; from &#x27;echarts/renderers&#x27;;       // Canvas 渲染器</span><br><span class="line"></span><br><span class="line">// 注册必须的组件和特性</span><br><span class="line">echarts.use([</span><br><span class="line">  TitleComponent,      // 标题组件</span><br><span class="line">  TooltipComponent,    // 提示框组件</span><br><span class="line">  GridComponent,       // 直角坐标系组件</span><br><span class="line">  DatasetComponent,    // 数据集组件</span><br><span class="line">  TransformComponent,  // 内置数据转换器组件</span><br><span class="line">  BarChart,            // 柱状图</span><br><span class="line">  LineChart,           // 折线图</span><br><span class="line">  PieChart,            // 饼图</span><br><span class="line">  LabelLayout,         // 标签自动布局特性</span><br><span class="line">  UniversalTransition, // 全局过渡动画特性</span><br><span class="line">  CanvasRenderer,      // Canvas 渲染器</span><br><span class="line">  LegendComponent,     // 图例组件</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>容器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">        &lt;div id=&quot;main&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><p>样式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#main &#123;</span><br><span class="line">    width: 600px;</span><br><span class="line">    height: 400px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><p>引入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import &#123; onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">// 引入 echarts 核心模块，核心模块提供了 echarts 使用必须要的接口。</span><br><span class="line">import * as echarts from &#x27;echarts/core&#x27;</span><br><span class="line">// 引入柱状图图表，图表后缀都为 Chart</span><br><span class="line">import &#123; BarChart &#125; from &#x27;echarts/charts&#x27;</span><br><span class="line">// 引入标题，提示框，直角坐标系，数据集，内置数据转换器组件，组件后缀都为 Component</span><br><span class="line">import &#123;</span><br><span class="line">TitleComponent,</span><br><span class="line">TooltipComponent,</span><br><span class="line">GridComponent,</span><br><span class="line">DatasetComponent,</span><br><span class="line">TransformComponent,</span><br><span class="line">&#125; from &#x27;echarts/components&#x27;</span><br><span class="line">// 标签自动布局、全局过渡动画等特性</span><br><span class="line">import &#123; LabelLayout, UniversalTransition &#125; from &#x27;echarts/features&#x27;</span><br><span class="line">// 引入 Canvas 渲染器，注意引入 CanvasRenderer 或者 SVGRenderer 是必须的一步</span><br><span class="line">import &#123; CanvasRenderer &#125; from &#x27;echarts/renderers&#x27;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><p>注册组件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">echarts.use([</span><br><span class="line">    TitleComponent,</span><br><span class="line">    TooltipComponent,</span><br><span class="line">    GridComponent,</span><br><span class="line">    DatasetComponent,</span><br><span class="line">    TransformComponent,</span><br><span class="line">    BarChart,</span><br><span class="line">    LabelLayout,</span><br><span class="line">    UniversalTransition,</span><br><span class="line">    CanvasRenderer,</span><br><span class="line">])</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h3 id="图表配置"><a href="#图表配置" class="headerlink" title="图表配置"></a>图表配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">    // 基于准备好的dom，初始化echarts实例</span><br><span class="line">    const myChart = echarts.init(document.getElementById(&#x27;main&#x27;))</span><br><span class="line"></span><br><span class="line">    // 颜色数组</span><br><span class="line">    let colors = [</span><br><span class="line">        &#x27;#5470c6&#x27;,</span><br><span class="line">        &#x27;#91cc75&#x27;,</span><br><span class="line">        &#x27;#fac858&#x27;,</span><br><span class="line">        &#x27;#ee6666&#x27;,</span><br><span class="line">        &#x27;#73c0de&#x27;,</span><br><span class="line">        &#x27;#3ba272&#x27;,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    const option = &#123;</span><br><span class="line">        // 标题</span><br><span class="line">        title: &#123;</span><br><span class="line">            text: &#x27;ECharts 入门示例&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">        // 提示框</span><br><span class="line">        tooltip: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">        // x轴</span><br><span class="line">        xAxis: &#123;</span><br><span class="line">            data: [&#x27;衬衫&#x27;, &#x27;羊毛衫&#x27;, &#x27;雪纺衫&#x27;, &#x27;裤子&#x27;, &#x27;高跟鞋&#x27;, &#x27;袜子&#x27;],</span><br><span class="line">        &#125;,</span><br><span class="line">        // y轴</span><br><span class="line">        yAxis: &#123;</span><br><span class="line">            data: [&#x27;0&#x27;, &#x27;50&#x27;, &#x27;100&#x27;, &#x27;150&#x27;, &#x27;200&#x27;, &#x27;250&#x27;],</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        // 数据系列</span><br><span class="line">        series: [</span><br><span class="line">            &#123;</span><br><span class="line">                name: &#x27;销量&#x27;,</span><br><span class="line">                type: &#x27;bar&#x27;,</span><br><span class="line">                data: [5, 20, 36, 10, 10, 20],</span><br><span class="line">                itemStyle: &#123;</span><br><span class="line">                    color: (params) =&gt; colors[params.dataIndex] || &#x27;#fac858&#x27;,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //loding预加载</span><br><span class="line">    myChart.showLoading()</span><br><span class="line">    $.get(&#x27;data.json&#x27;).done(function () &#123;</span><br><span class="line">        myChart.hideLoading()</span><br><span class="line">        myChart.setOption(option)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    myChart.setOption(option)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h3 id="拆分组件"><a href="#拆分组件" class="headerlink" title="拆分组件"></a>拆分组件</h3><h4 id="series-图表"><a href="#series-图表" class="headerlink" title="series &#x2F; 图表"></a>series &#x2F; 图表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">series: [</span><br><span class="line">    &#123;</span><br><span class="line">        name: &#x27;销量&#x27;,//单位量</span><br><span class="line">        type: &#x27;bar&#x27;,//图表类型</span><br><span class="line">        data: [5, 20, 36, 10, 10, 20],//图表数据</span><br><span class="line">        itemStyle: &#123;//样式配置</span><br><span class="line">            color: (params) =&gt; option.color[params.dataIndex] || &#x27;#fac858&#x27;, // 使用全局颜色</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h5 id="type-类型"><a href="#type-类型" class="headerlink" title="type &#x2F; 类型"></a>type &#x2F; 类型</h5><h6 id="柱状图（bar）"><a href="#柱状图（bar）" class="headerlink" title="柱状图（bar）"></a>柱状图（<code>bar</code>）</h6><p>需求</p><ul><li><strong>坐标轴</strong>：需要 <code>xAxis</code> 和 <code>yAxis</code> 配置。</li><li><strong>数据格式</strong>：数据通常是简单的数值数组或对象数组。</li><li><strong>其他配置</strong>：可以添加 <code>tooltip</code>、<code>title</code>、<code>legend</code> 等组件来增强图表的可读性和交互性。</li></ul><p>配置示例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: &#x27;ECharts 销量统计&#x27;,</span><br><span class="line">    subtext: &#x27;示例数据&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;</span><br><span class="line">    trigger: &#x27;axis&#x27;, // 触发类型为坐标轴触发</span><br><span class="line">  &#125;,</span><br><span class="line">  xAxis: &#123;</span><br><span class="line">    type: &#x27;category&#x27;, // 类目轴</span><br><span class="line">    data: [&#x27;衬衫&#x27;, &#x27;羊毛衫&#x27;, &#x27;雪纺衫&#x27;, &#x27;裤子&#x27;, &#x27;高跟鞋&#x27;, &#x27;袜子&#x27;], // x轴数据</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // 标签颜色</span><br><span class="line">      fontSize: 14,  // 标签字体大小</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        color: &#x27;#ccc&#x27;, // 轴线颜色</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    axisTick: &#123;</span><br><span class="line">      show: false, // 是否显示刻度线</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  yAxis: &#123;</span><br><span class="line">    type: &#x27;value&#x27;, // 数值轴</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // 标签颜色</span><br><span class="line">      formatter: &#x27;&#123;value&#125; 件&#x27;, // 标签格式化</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      show: false, // 是否显示轴线</span><br><span class="line">    &#125;,</span><br><span class="line">    splitLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        type: &#x27;dashed&#x27;, // 分割线样式</span><br><span class="line">        color: &#x27;#eee&#x27;,  // 分割线颜色</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;销量&#x27;,</span><br><span class="line">      type: &#x27;bar&#x27;, // 柱状图</span><br><span class="line">      data: [5, 20, 36, 10, 10, 20], // 数据</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: (params) =&gt; [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;][params.dataIndex] || &#x27;#fac858&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h6 id="折线图（line）"><a href="#折线图（line）" class="headerlink" title="折线图（line）"></a>折线图（<code>line</code>）</h6><p>需求</p><ul><li><strong>坐标轴</strong>：需要 <code>xAxis</code> 和 <code>yAxis</code> 配置。</li><li><strong>数据格式</strong>：数据通常是简单的数值数组或对象数组。</li><li><strong>其他配置</strong>：可以添加 <code>tooltip</code>、<code>title</code>、<code>legend</code> 等组件来增强图表的可读性和交互性。</li></ul><p>配置示例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: &#x27;ECharts 销量趋势&#x27;,</span><br><span class="line">    subtext: &#x27;示例数据&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;</span><br><span class="line">    trigger: &#x27;axis&#x27;, // 触发类型为坐标轴触发</span><br><span class="line">  &#125;,</span><br><span class="line">  xAxis: &#123;</span><br><span class="line">    type: &#x27;category&#x27;, // 类目轴</span><br><span class="line">    data: [&#x27;衬衫&#x27;, &#x27;羊毛衫&#x27;, &#x27;雪纺衫&#x27;, &#x27;裤子&#x27;, &#x27;高跟鞋&#x27;, &#x27;袜子&#x27;], // x轴数据</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // 标签颜色</span><br><span class="line">      fontSize: 14,  // 标签字体大小</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        color: &#x27;#ccc&#x27;, // 轴线颜色</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    axisTick: &#123;</span><br><span class="line">      show: false, // 是否显示刻度线</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  yAxis: &#123;</span><br><span class="line">    type: &#x27;value&#x27;, // 数值轴</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // 标签颜色</span><br><span class="line">      formatter: &#x27;&#123;value&#125; 件&#x27;, // 标签格式化</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      show: false, // 是否显示轴线</span><br><span class="line">    &#125;,</span><br><span class="line">    splitLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        type: &#x27;dashed&#x27;, // 分割线样式</span><br><span class="line">        color: &#x27;#eee&#x27;,  // 分割线颜色</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;销量&#x27;,</span><br><span class="line">      type: &#x27;line&#x27;, // 折线图</span><br><span class="line">      data: [5, 20, 36, 10, 10, 20], // 数据</span><br><span class="line">      smooth: true, // 平滑曲线</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: &#x27;#5470c6&#x27;, // 线条颜色</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h6 id="饼图（pie）"><a href="#饼图（pie）" class="headerlink" title="饼图（pie）"></a>饼图（<code>pie</code>）</h6><p>需求</p><ul><li><strong>坐标轴</strong>：不需要 <code>xAxis</code> 和 <code>yAxis</code>，因为饼图是基于圆形的。</li><li><strong>数据格式</strong>：数据通常是包含 <code>value</code> 和 <code>name</code> 的对象数组。</li><li><strong>其他配置</strong>：可以添加 <code>tooltip</code>、<code>title</code>、<code>legend</code> 等组件来增强图表的可读性和交互性。</li></ul><p>配置示例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: &#x27;ECharts 销量分布&#x27;,</span><br><span class="line">    subtext: &#x27;示例数据&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;</span><br><span class="line">    trigger: &#x27;item&#x27;, // 触发类型为单个数据点触发</span><br><span class="line">  &#125;,</span><br><span class="line">  legend: &#123;</span><br><span class="line">    orient: &#x27;vertical&#x27;, // 图例方向</span><br><span class="line">    left: &#x27;left&#x27;,       // 图例位置</span><br><span class="line">  &#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;销量&#x27;,</span><br><span class="line">      type: &#x27;pie&#x27;, // 饼图</span><br><span class="line">      radius: &#x27;50%&#x27;, // 饼图的半径</span><br><span class="line">      data: [</span><br><span class="line">        &#123; value: 5, name: &#x27;衬衫&#x27; &#125;,</span><br><span class="line">        &#123; value: 20, name: &#x27;羊毛衫&#x27; &#125;,</span><br><span class="line">        &#123; value: 36, name: &#x27;雪纺衫&#x27; &#125;,</span><br><span class="line">        &#123; value: 10, name: &#x27;裤子&#x27; &#125;,</span><br><span class="line">        &#123; value: 10, name: &#x27;高跟鞋&#x27; &#125;,</span><br><span class="line">        &#123; value: 20, name: &#x27;袜子&#x27; &#125;,</span><br><span class="line">      ], // 数据</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: (params) =&gt; [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;][params.dataIndex] || &#x27;#fac858&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h6 id="散点图（scatter）"><a href="#散点图（scatter）" class="headerlink" title="散点图（scatter）"></a>散点图（<code>scatter</code>）</h6><p>需求</p><ul><li><strong>坐标轴</strong>：需要 <code>xAxis</code> 和 <code>yAxis</code> 配置。</li><li><strong>数据格式</strong>：数据通常是二维数组，每个数据点包含两个值 <code>[x, y]</code>。</li><li><strong>其他配置</strong>：可以添加 <code>tooltip</code>、<code>title</code>、<code>legend</code> 等组件来增强图表的可读性和交互性。</li></ul><p>配置示例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: &#x27;ECharts 散点图示例&#x27;,</span><br><span class="line">    subtext: &#x27;随机生成的数据&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;</span><br><span class="line">    trigger: &#x27;item&#x27;, // 触发类型为单个数据点触发</span><br><span class="line">  &#125;,</span><br><span class="line">  xAxis: &#123;</span><br><span class="line">    type: &#x27;value&#x27;, // 数值轴</span><br><span class="line">    name: &#x27;X轴&#x27;,</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // 标签颜色</span><br><span class="line">      fontSize: 14,  // 标签字体大小</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        color: &#x27;#ccc&#x27;, // 轴线颜色</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  yAxis: &#123;</span><br><span class="line">    type: &#x27;value&#x27;, // 数值轴</span><br><span class="line">    name: &#x27;Y轴&#x27;,</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // 标签颜色</span><br><span class="line">      fontSize: 14,  // 标签字体大小</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        color: &#x27;#ccc&#x27;, // 轴线颜色</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;散点&#x27;,</span><br><span class="line">      type: &#x27;scatter&#x27;, // 散点图</span><br><span class="line">      data: [</span><br><span class="line">        [10, 20],</span><br><span class="line">        [20, 30],</span><br><span class="line">        [30, 40],</span><br><span class="line">        [40, 50],</span><br><span class="line">        [50, 60],</span><br><span class="line">        [60, 70],</span><br><span class="line">      ], // 数据</span><br><span class="line">      symbolSize: 20, // 散点大小</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: &#x27;#5470c6&#x27;, // 散点颜色</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h5 id="itemStyle-样式"><a href="#itemStyle-样式" class="headerlink" title="itemStyle &#x2F; 样式"></a>itemStyle &#x2F; 样式</h5><p>！注意：颜色的配置只能在</p><p><strong>1.series 外（全局）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  // ... 其他配置</span><br><span class="line">  color: [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;], // 全局颜色</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;销量&#x27;,</span><br><span class="line">      type: &#x27;bar&#x27;,</span><br><span class="line">      data: [5, 20, 36, 10, 10, 20],</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: (params) =&gt; option.color[params.dataIndex] || &#x27;#fac858&#x27;, // 使用全局颜色</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  // ... 其他配置</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><p><strong>2.<code>itemStyle</code> 内部（局部）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">series: [</span><br><span class="line">  &#123;</span><br><span class="line">    name: &#x27;销量&#x27;,</span><br><span class="line">    type: &#x27;bar&#x27;,</span><br><span class="line">    data: [5, 20, 36, 10, 10, 20],</span><br><span class="line">    itemStyle: &#123;</span><br><span class="line">      color: (params) =&gt; &#123;</span><br><span class="line">        const colors = [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;];</span><br><span class="line">        return colors[params.dataIndex] || &#x27;#fac858&#x27;; // 直接使用本地定义的 colors 数组</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><p><strong><em>不能在 series 中配置颜色数组</em></strong></p><p>渐变色（内部配置）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">itemStyle: &#123;</span><br><span class="line">    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [</span><br><span class="line">        &#123; offset: 0, color: &#x27;#5470c6&#x27; &#125;,</span><br><span class="line">        &#123; offset: 0.2, color: &#x27;#91cc75&#x27; &#125;,</span><br><span class="line">        &#123; offset: 0.5, color: &#x27;#91cc75&#x27; &#125;,</span><br><span class="line">        &#123; offset: 0.7, color: &#x27;#fac858&#x27; &#125;,</span><br><span class="line">        &#123; offset: 1, color: &#x27;#91cc75&#x27; &#125;,</span><br><span class="line">    ]),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h4 id="title-标题"><a href="#title-标题" class="headerlink" title="title | 标题"></a>title | 标题</h4><p>自定义标题</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">title: &#123;</span><br><span class="line">    text: &#x27;ECharts 销量统计&#x27;,</span><br><span class="line">    subtext: &#x27;示例数据&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">    textStyle: &#123;</span><br><span class="line">       fontSize: 20,</span><br><span class="line">       color: &#x27;#333&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h4 id="color-颜色"><a href="#color-颜色" class="headerlink" title="color | 颜色"></a>color | 颜色</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">color: [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;], // 全局颜色</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h4 id="tooltip-提示框"><a href="#tooltip-提示框" class="headerlink" title="tooltip | 提示框"></a>tooltip | 提示框</h4><p>自定义提示框</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tooltip: &#123;</span><br><span class="line">  trigger: &#x27;axis&#x27;, // 触发类型，可以是 &#x27;item&#x27; 或 &#x27;axis&#x27;</span><br><span class="line">  axisPointer: &#123;</span><br><span class="line">    type: &#x27;shadow&#x27;, // 默认为 &#x27;line&#x27;，也可以是 &#x27;shadow&#x27; 或 &#x27;cross&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  formatter: function (params) &#123;</span><br><span class="line">    return `$&#123;params[0].name&#125;: $&#123;params[0].value&#125;`;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h4 id="x-yAxis-坐标轴"><a href="#x-yAxis-坐标轴" class="headerlink" title="x&#x2F;yAxis | 坐标轴"></a>x&#x2F;yAxis | 坐标轴</h4><p>适用于</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">柱状图 bar</span><br><span class="line">折线图 line</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><p>坐标轴样式</p><p>自定义 x 轴</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">xAxis: &#123;</span><br><span class="line">  type: &#x27;category&#x27;,</span><br><span class="line">  data: [&#x27;衬衫&#x27;, &#x27;羊毛衫&#x27;, &#x27;雪纺衫&#x27;, &#x27;裤子&#x27;, &#x27;高跟鞋&#x27;, &#x27;袜子&#x27;],</span><br><span class="line">  axisLabel: &#123;</span><br><span class="line">    color: &#x27;#333&#x27;, // 标签颜色</span><br><span class="line">    fontSize: 14,  // 标签字体大小</span><br><span class="line">  &#125;,</span><br><span class="line">  axisLine: &#123;</span><br><span class="line">    lineStyle: &#123;</span><br><span class="line">      color: &#x27;#ccc&#x27;, // 轴线颜色</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  axisTick: &#123;</span><br><span class="line">    show: false, // 是否显示刻度线</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><p>自定义 y 轴</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">yAxis: &#123;</span><br><span class="line">  type: &#x27;value&#x27;,</span><br><span class="line">  axisLabel: &#123;</span><br><span class="line">    color: &#x27;#333&#x27;, // 标签颜色</span><br><span class="line">    formatter: &#x27;&#123;value&#125; 件&#x27;, // 标签格式化</span><br><span class="line">  &#125;,</span><br><span class="line">  axisLine: &#123;</span><br><span class="line">    show: false, // 是否显示轴线</span><br><span class="line">  &#125;,</span><br><span class="line">  splitLine: &#123;</span><br><span class="line">    lineStyle: &#123;</span><br><span class="line">      type: &#x27;dashed&#x27;, // 分割线样式</span><br><span class="line">      color: &#x27;#eee&#x27;,  // 分割线颜色</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h4 id="animation-动画"><a href="#animation-动画" class="headerlink" title="animation | 动画"></a>animation | 动画</h4><p>动画样式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">animation: true, // 是否开启动画</span><br><span class="line">animationDuration: 1000, // 动画持续时间</span><br><span class="line">animationEasing: &#x27;elasticOut&#x27;, // 动画缓动效果</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><h3 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h3><h4 id="loding-预加载"><a href="#loding-预加载" class="headerlink" title="loding | 预加载"></a>loding | 预加载</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm i --save-dev @types/jquery</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="点击并拖拽以移动"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myChart.showLoading()</span><br><span class="line">$.get(&#x27;data.json&#x27;).done(function (data) &#123;</span><br><span class="line">    myChart.hideLoading()</span><br><span class="line">    myChart.setOption(option)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>键盘乱键问题解决</title>
      <link href="/2025/03/08/%E5%B7%A5%E5%85%B7/%E9%94%AE%E7%9B%98%E4%B9%B1%E9%94%AE%E9%97%AE%E9%A2%98/"/>
      <url>/2025/03/08/%E5%B7%A5%E5%85%B7/%E9%94%AE%E7%9B%98%E4%B9%B1%E9%94%AE%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="键盘乱键问题"><a href="#键盘乱键问题" class="headerlink" title="键盘乱键问题"></a>键盘乱键问题</h1><p><strong>真的很崩溃，机械键盘的乱键问题居然还能连带到本机的键盘上😅</strong></p><p><strong>最后发现步骤其实很简单，然后我乱修了两个小时🙃</strong></p><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p><strong>机械+本机键盘出厂设置</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fn + esc 长按五秒以上</span><br></pre></td></tr></table></figure><p><strong>重启电脑</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">还有我电脑开机是有一个键盘驱动选项的，直接给拒了</span><br></pre></td></tr></table></figure><p><strong>重新配置机械键盘（蓝牙啊啥的）</strong></p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BFC与IFC</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8A%E4%B8%8B%E6%96%87--BFC%E4%B8%8EIFC/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8A%E4%B8%8B%E6%96%87--BFC%E4%B8%8EIFC/</url>
      
        <content type="html"><![CDATA[<h3 id="盒子"><a href="#盒子" class="headerlink" title="盒子"></a>盒子</h3><h5 id="格式化上下文"><a href="#格式化上下文" class="headerlink" title="格式化上下文"></a>格式化上下文</h5><p><strong>外部显示类型（display-outside）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">规定盒子如何与统一格式上下文中的其他元素一起显示</span><br></pre></td></tr></table></figure><p><strong>内部显示类型（ display-inside  ）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">规定盒子内部布局方式，比如</span><br><span class="line">display:    flex    (外部显示为block ) 参与BFC（块级格式化上下文）</span><br><span class="line">display:inline-flex (外部显示为inline) 参与IFC（内联级格式化上下文）</span><br></pre></td></tr></table></figure><h5 id="BFC"><a href="#BFC" class="headerlink" title="BFC"></a>BFC</h5><p><strong>块级格式化上下文</strong></p><p><em><strong>FC</strong></em>（Formatting Context）（<em><strong>格式化上下文</strong></em>）</p><p><strong>所有的盒子都属于FC</strong></p><p><strong>可能属于一个BFC（block）(div&#x2F;p&#x2F;h1)、也可能是IFC（inline）(a&#x2F;span&#x2F;i&#x2F;img)</strong></p><h6 id="会生成BFC的情况"><a href="#会生成BFC的情况" class="headerlink" title="会生成BFC的情况"></a><strong>会生成BFC的情况</strong></h6><p><img src="/upload/image-20241104160610394.png" alt="image-20241104160610394.png"></p><h6 id="BFC的作用"><a href="#BFC的作用" class="headerlink" title="BFC的作用"></a><strong>BFC的作用</strong></h6><p><strong>帮助盒子一个挨着一个沿着垂直方向排布</strong></p><p><strong>margin就是由BFC来解析的</strong></p><p><strong>两个盒子都设置margin时候会折叠，就是BFC在起作用</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在同一个BFC里，两个盒子的margin才会折叠</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTML可以形成标准流，因为本身就是一个独立的BFC环境</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在BFC中，每个元素的左边缘是紧挨着包含块的左边缘的</span><br></pre></td></tr></table></figure><p><strong>BFC可以解决</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">margin的折叠问题</span><br><span class="line">浮动的高度塌陷问题</span><br></pre></td></tr></table></figure><h6 id="形成新的BFC"><a href="#形成新的BFC" class="headerlink" title="形成新的BFC"></a>形成新的BFC</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//只要overflow: !!不是!! visible</span><br><span class="line">可以是 auto/hidden/scroll</span><br></pre></td></tr></table></figure><p><strong>解决折叠问题</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//父级包裹两个元素</span><br><span class="line">div content</span><br><span class="line">    div item</span><br><span class="line">    div item</span><br><span class="line">div</span><br><span class="line">//css创建BFC</span><br><span class="line">.content&#123;</span><br><span class="line">    overflow: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>解决浮动高度塌陷</strong></p><p><strong>条件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//父元素触发BFC，形成独立块级格式化上下文</span><br><span class="line">//父元素高度为auto</span><br></pre></td></tr></table></figure><p><em>BFC的计算方式</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.如果只有inline-level，是行高的顶部和底部的距离</span><br><span class="line">2.如果有block-level，是由最底层的块上边缘和最底层块盒子的下边缘之间的距离</span><br><span class="line">3.如果有绝对定位元素，将被忽略;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4.如果有浮动元素，那么会增加高度以包括这些浮动元素的下边缘</span><br></pre></td></tr></table></figure><h6 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">overflow: visible;  //可见</span><br><span class="line">overflow: hidden;   //隐藏(可滚动的容器)</span><br><span class="line">overflow: clip;     //剪辑(禁止滚动)</span><br><span class="line">overflow: scroll;   //滚动(浏览器总是显示滚动条)</span><br><span class="line">overflow: auto;     //自动(如果内容溢出，则浏览器提供滚动条)</span><br><span class="line">overflow: hidden;   //覆盖(滚动条绘制在内容之上，而不是占据空间)</span><br></pre></td></tr></table></figure><h5 id="IFC"><a href="#IFC" class="headerlink" title="IFC"></a>IFC</h5><p><strong>内联级格式化上下文</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">盒子会从包含块的顶部开始，按水平排列</span><br><span class="line">这些盒子可以以不同的方式对齐</span><br><span class="line">包含一串盒子的矩形区域就是一个 “线条框(line box)”</span><br></pre></td></tr></table></figure><h6 id="对齐方式"><a href="#对齐方式" class="headerlink" title="对齐方式"></a>对齐方式</h6><p><img src="/upload/image-20241110155405765.png" alt="image-20241110155405765.png"></p><p><img src="/upload/image-20241110155807497.png" alt="image-20241110155807497.png"></p><p><img src="/upload/image-20241110160000770.png" alt="image-20241110160000770.png"></p><h5 id="层叠上下文"><a href="#层叠上下文" class="headerlink" title="层叠上下文"></a>层叠上下文</h5><p><strong>对HTML元素的三维构想，基于用户界面z轴的上下排布</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对于浏览器渲染过程的“渲染层(render layer)”</span><br></pre></td></tr></table></figure><h6 id="层叠水平"><a href="#层叠水平" class="headerlink" title="层叠水平"></a>层叠水平</h6><p><strong>也就是层叠顺序</strong></p><p><img src="/upload/image-20241110164351519.png" alt="image-20241110164351519.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">z-index只能在同一个层叠上下文比较</span><br><span class="line">子元素的z-index无法超过父元素的z-index顺序</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Electron实现桌面端计时器</title>
      <link href="/2025/03/08/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%B0%9D%E8%AF%95%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E6%A1%8C%E9%9D%A2%E7%AB%AF%E8%AE%A1%E6%97%B6%E5%99%A8%EF%BC%88%E5%8D%8A%E6%88%90%E5%93%81%E7%89%88%EF%BC%89/"/>
      <url>/2025/03/08/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%B0%9D%E8%AF%95%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E6%A1%8C%E9%9D%A2%E7%AB%AF%E8%AE%A1%E6%97%B6%E5%99%A8%EF%BC%88%E5%8D%8A%E6%88%90%E5%93%81%E7%89%88%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="吐槽"><a href="#吐槽" class="headerlink" title="吐槽"></a>吐槽</h2><p><strong>最初技术栈为Vue+Electron+TS，太甜美的难了。。。配置报错问题一大堆，一路报错问AI一路改，长达三个小时把文件改的乱七八糟无法收尾忍痛放弃新开项目</strong></p><p>**最后技术栈选择为 **<strong>Vue+Electron+Vite+JS</strong> ，包管理工具选择为 <strong>pnpm</strong></p><p><del>完整代码见github仓库</del> <code>......</code>(还没推，因为dist文件太大的原因没办法传，目前还在寻找更合理的推送方案)</p><h2 id="主步骤"><a href="#主步骤" class="headerlink" title="主步骤"></a>主步骤</h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p><strong>创建</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm create vite Tclick --template vue</span><br></pre></td></tr></table></figure><p><strong>依赖</strong></p><p><strong>package.json 直享版</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;clock&quot;,</span><br><span class="line">    &quot;private&quot;: true,</span><br><span class="line">    &quot;version&quot;: &quot;0.0.0&quot;,</span><br><span class="line">    &quot;description&quot;: &quot;An Timer application.&quot;,//描述</span><br><span class="line">    &quot;author&quot;: &quot;none &lt;你的邮箱&gt;&quot;,//作者</span><br><span class="line">    &quot;homepage&quot;: &quot;./&quot;,</span><br><span class="line">    &quot;main&quot;: &quot;main.js&quot;,</span><br><span class="line">    &quot;scripts&quot;: &#123;</span><br><span class="line">        &quot;dev&quot;: &quot;vite&quot;,</span><br><span class="line">        &quot;build&quot;: &quot;vite build&quot;,</span><br><span class="line">        &quot;serve&quot;: &quot;vite preview&quot;,</span><br><span class="line">        &quot;electron:dev&quot;: &quot;concurrently \&quot;cross-env NODE_ENV=development wait-on http://localhost:5173 &amp;&amp; electron .\&quot; \&quot;npm run dev\&quot;&quot;,</span><br><span class="line">        &quot;electron:build&quot;: &quot;npm run build &amp;&amp; electron-builder &amp;&amp; node post-build.js&quot;,</span><br><span class="line">        &quot;start&quot;: &quot;npm run electron:dev&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;dependencies&quot;: &#123;</span><br><span class="line">        &quot;vue&quot;: &quot;^3.5.13&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;devDependencies&quot;: &#123;</span><br><span class="line">        &quot;@vitejs/plugin-vue&quot;: &quot;^5.2.1&quot;,</span><br><span class="line">        &quot;concurrently&quot;: &quot;^9.1.2&quot;,</span><br><span class="line">        &quot;cross-env&quot;: &quot;^7.0.3&quot;,</span><br><span class="line">        &quot;electron&quot;: &quot;^33.3.1&quot;,</span><br><span class="line">        &quot;electron-builder&quot;: &quot;^25.1.8&quot;,</span><br><span class="line">        &quot;vite&quot;: &quot;^6.0.5&quot;,</span><br><span class="line">        &quot;vite-plugin-html&quot;: &quot;^3.2.2&quot;,</span><br><span class="line">        &quot;wait-on&quot;: &quot;^8.0.2&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;build&quot;: &#123;</span><br><span class="line">        &quot;productName&quot;: &quot;Clock&quot;,</span><br><span class="line">        &quot;appId&quot;: &quot;com.example.clock&quot;,</span><br><span class="line">        &quot;directories&quot;: &#123;</span><br><span class="line">            &quot;output&quot;: &quot;release&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;files&quot;: [</span><br><span class="line">            &quot;dist/**/*&quot;,</span><br><span class="line">            &quot;node_modules/**/*&quot;,</span><br><span class="line">            &quot;main.js&quot;,</span><br><span class="line">            &quot;preload.js&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;mac&quot;: &#123;</span><br><span class="line">            &quot;target&quot;: &quot;dmg&quot;,</span><br><span class="line">            &quot;icon&quot;: &quot;dist/installer-icon-256.ico&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;win&quot;: &#123;</span><br><span class="line">            &quot;target&quot;: &quot;nsis&quot;,</span><br><span class="line">            &quot;icon&quot;: &quot;dist/installer-icon-256.ico&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;linux&quot;: &#123;</span><br><span class="line">            &quot;target&quot;: &quot;AppImage&quot;,</span><br><span class="line">            &quot;icon&quot;: &quot;dist/installer-icon-256.ico&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;nsis&quot;: &#123;</span><br><span class="line">            &quot;installerIcon&quot;: &quot;./public/installer-icon.ico&quot;,//这里的ico是我下的时钟图标，替换软件图标</span><br><span class="line">            &quot;oneClick&quot;: false,</span><br><span class="line">            &quot;allowToChangeInstallationDirectory&quot;: true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install</span><br></pre></td></tr></table></figure><h3 id="补充项目结构"><a href="#补充项目结构" class="headerlink" title="补充项目结构"></a>补充项目结构</h3><p><code>public/icon</code>（图标）</p><p><code>main.js</code>（Electron主进程）</p><p><code>preload.js</code>（Electron预加载脚本）</p><p><code>post-build.js</code>（文件操作，生成dist）</p><h3 id="核心配置"><a href="#核心配置" class="headerlink" title="核心配置"></a>核心配置</h3><p><code>index.html</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">        &lt;link rel=&quot;icon&quot; type=&quot;image/svg+xml&quot; href=&quot;./dist/installer-icon.ico&quot; /&gt;</span><br><span class="line">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">        &lt;title&gt;Clock&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;script type=&quot;module&quot; src=&quot;/src/main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><code>main.js</code>（Electron主进程）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">const &#123; app, BrowserWindow &#125; = require(&#x27;electron&#x27;)</span><br><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line"></span><br><span class="line">function createWindow() &#123;</span><br><span class="line">    const win = new BrowserWindow(&#123;</span><br><span class="line">        width: 500,</span><br><span class="line">        height: 210,</span><br><span class="line">        x: 800, // 指定初始 x 坐标</span><br><span class="line">        y: 20, // 指定初始 y 坐标</span><br><span class="line">        webPreferences: &#123;</span><br><span class="line">            preload: path.join(__dirname, &#x27;preload.js&#x27;),</span><br><span class="line">            nodeIntegration: false,</span><br><span class="line">            contextIsolation: true,</span><br><span class="line">            // 设置 CSP</span><br><span class="line">            additionalArguments: [&#x27;--disable-features=ElectronSandbox&#x27;], // 根据需要调整</span><br><span class="line">            webviewTag: false, // 禁止使用 &lt;webview&gt; 标签</span><br><span class="line">            webSecurity: true,</span><br><span class="line">            sandbox: true,</span><br><span class="line">            contentSecurityPolicy: `</span><br><span class="line">        default-src &#x27;self&#x27;;</span><br><span class="line">        script-src &#x27;self&#x27;;</span><br><span class="line">        connect-src &#x27;self&#x27;;</span><br><span class="line">        style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; /* 如果需要内联样式 */</span><br><span class="line">        img-src &#x27;self&#x27; data:;</span><br><span class="line">        font-src &#x27;self&#x27;;</span><br><span class="line">      `,</span><br><span class="line">        &#125;,</span><br><span class="line">        title: &#x27;Clock&#x27;, // 设置窗口标题</span><br><span class="line">        icon: path.join(__dirname, &#x27;dist&#x27;, &#x27;installer-icon.ico&#x27;), // 设置窗口图标</span><br><span class="line">        autoHideMenuBar: true, //自动隐藏菜单栏</span><br><span class="line">        alwaysOnTop: true, // 确保窗口始终在顶部</span><br><span class="line">        // frame: false, // 隐藏窗口边框</span><br><span class="line">        // resizable: false, // 禁止调整窗口大小</span><br><span class="line">        transparent: true, // 使窗口透明</span><br><span class="line">        // skipTaskbar: true, // 跳过任务栏显示</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    if (process.env.NODE_ENV === &#x27;development&#x27;) &#123;</span><br><span class="line">        win.loadURL(&#x27;http://localhost:5173&#x27;)</span><br><span class="line">        // win.loadFile(&#x27;dist/index.html&#x27;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        win.loadFile(path.resolve(__dirname, &#x27;dist&#x27;, &#x27;index.html&#x27;))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.whenReady().then(() =&gt; &#123;</span><br><span class="line">    createWindow()</span><br><span class="line"></span><br><span class="line">    app.on(&#x27;activate&#x27;, function () &#123;</span><br><span class="line">        if (BrowserWindow.getAllWindows().length === 0) createWindow()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 其他事件监听器...</span><br><span class="line"></span><br><span class="line">app.on(&#x27;window-all-closed&#x27;, () =&gt; &#123;</span><br><span class="line">    if (process.platform !== &#x27;darwin&#x27;) &#123;</span><br><span class="line">        app.quit()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.on(&#x27;activate&#x27;, () =&gt; &#123;</span><br><span class="line">    if (BrowserWindow.getAllWindows().length === 0) &#123;</span><br><span class="line">        createWindow()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>preload.js</code>（Electron预加载脚本）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// preload.js</span><br><span class="line">window.addEventListener(&#x27;DOMContentLoaded&#x27;, () =&gt; &#123;</span><br><span class="line">    // 这里可以添加与DOM交互的代码</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>post-build.js</code>（文件操作，生成dist）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;)</span><br><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line"></span><br><span class="line">const htmlFilePath = path.resolve(__dirname, &#x27;dist&#x27;, &#x27;index.html&#x27;)</span><br><span class="line"></span><br><span class="line">fs.readFile(htmlFilePath, &#x27;utf8&#x27;, (err, data) =&gt; &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        return console.log(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const result = data.replace(/&lt;title&gt;.*?&lt;\/title&gt;/, &#x27;&lt;title&gt;Clock&lt;/title&gt;&#x27;)</span><br><span class="line"></span><br><span class="line">    fs.writeFile(htmlFilePath, result, &#x27;utf8&#x27;, (err) =&gt; &#123;</span><br><span class="line">        if (err) return console.log(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="简陋的组件"><a href="#简陋的组件" class="headerlink" title="简陋的组件"></a>简陋的组件</h3><p><code>App.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=&quot;app&quot; class=&quot;hide-scrollbar&quot;&gt;</span><br><span class="line">        &lt;Main /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    import Main from &#x27;./components/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .hide-scrollbar &#123;</span><br><span class="line">        scrollbar-width: none; /* Firefox */</span><br><span class="line">        -ms-overflow-style: none; /* IE 和 Edge */</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .hide-scrollbar::-webkit-scrollbar &#123;</span><br><span class="line">        display: none;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style</span><br></pre></td></tr></table></figure><p><code>utils/timeUtils.js</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">export const getFormattedTime = () =&gt; &#123;</span><br><span class="line">    const now = new Date();</span><br><span class="line">    </span><br><span class="line">    // 获取当前时间的小时、分钟和秒数，并确保它们都是两位数</span><br><span class="line">    const padZero = (num) =&gt; num.toString().padStart(2, &#x27;0&#x27;);</span><br><span class="line">    const hours = padZero(now.getHours());</span><br><span class="line">    const minutes = padZero(now.getMinutes());</span><br><span class="line">    const seconds = padZero(now.getSeconds());</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">        hoursFirstChar: hours[0],</span><br><span class="line">        hoursSecondChar: hours[1],</span><br><span class="line">        minutesFirstChar: minutes[0],</span><br><span class="line">        minutesSecondChar: minutes[1],</span><br><span class="line">        secondsFirstChar: seconds[0],</span><br><span class="line">        secondsSecondChar: seconds[1],</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>components / index.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;layouts&quot;&gt;</span><br><span class="line">        &lt;div v-for=&quot;(title, index) in titles&quot; :key=&quot;index&quot; class=&quot;layout&quot;&gt;</span><br><span class="line">            &lt;div&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;top&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;title&quot;&gt;&#123;&#123; title &#125;&#125;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;btn&quot; @click=&quot;start(index)&quot; :disabled=&quot;timers[index].isRunning&quot;&gt;开始&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;btn&quot; @click=&quot;stop(index)&quot; :disabled=&quot;!timers[index].isRunning&quot;&gt;停止&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;btn&quot; @click=&quot;reset(index)&quot; :disabled=&quot;timers[index].elapsedTime === 0&quot;&gt;重置&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;!-- &lt;Flip</span><br><span class="line">                :hours=&quot;timers[index].formattedTime.hours&quot;</span><br><span class="line">                :minutes=&quot;timers[index].formattedTime.minutes&quot;</span><br><span class="line">                :seconds=&quot;timers[index].formattedTime.seconds&quot; /&gt; --&gt;</span><br><span class="line">            &lt;Timer /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    import &#123; ref, computed &#125; from &#x27;vue&#x27;</span><br><span class="line">    import Flip from &#x27;./Flip/index.vue&#x27;</span><br><span class="line">    import Timer from &#x27;./Timer/index.vue&#x27;</span><br><span class="line"></span><br><span class="line">    const titles = [&#x27;学习时长&#x27;, &#x27;英语时长&#x27;, &#x27;看书时长&#x27;, &#x27;博客时长&#x27;]</span><br><span class="line">    const timers = ref([])</span><br><span class="line"></span><br><span class="line">    for (let i = 0; i &lt; 4; i++) &#123;</span><br><span class="line">        timers.value.push(&#123;</span><br><span class="line">            startTime: null,</span><br><span class="line">            elapsedTime: 0,</span><br><span class="line">            isRunning: false,</span><br><span class="line">            formattedTime: &#123; hours: &#x27;00&#x27;, minutes: &#x27;00&#x27;, seconds: &#x27;00&#x27; &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const start = (index) =&gt; &#123;</span><br><span class="line">        if (!timers.value[index].isRunning) &#123;</span><br><span class="line">            timers.value[index].startTime = Date.now() - (timers.value[index].startTime ? timers.value[index].startTime : 0)</span><br><span class="line">            timers.value[index].isRunning = true</span><br><span class="line">            updateElapsedTime(index)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const stop = (index) =&gt; &#123;</span><br><span class="line">        timers.value[index].isRunning = false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const reset = (index) =&gt; &#123;</span><br><span class="line">        timers.value[index].startTime = null</span><br><span class="line">        timers.value[index].elapsedTime = 0</span><br><span class="line">        timers.value[index].isRunning = false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const updateElapsedTime = (index) =&gt; &#123;</span><br><span class="line">        if (timers.value[index].isRunning) &#123;</span><br><span class="line">            timers.value[index].elapsedTime = Math.floor((Date.now() - timers.value[index].startTime) / 1000)</span><br><span class="line">            updateFormattedTime(index)</span><br><span class="line">            setTimeout(() =&gt; updateElapsedTime(index), 1000)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const updateFormattedTime = (index) =&gt; &#123;</span><br><span class="line">        const hours = Math.floor(timers.value[index].elapsedTime / 3600).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        const minutes = Math.floor((timers.value[index].elapsedTime % 3600) / 60).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        const seconds = (timers.value[index].elapsedTime % 60).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        timers.value[index].formattedTime = &#123; hours, minutes, seconds &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .layouts &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: row;</span><br><span class="line">        gap: 20px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        align-items: center;</span><br><span class="line">        width: 25%;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout .top &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: space-between;</span><br><span class="line">        align-items: center;</span><br><span class="line">        width: 100%;</span><br><span class="line">        background: #fff;</span><br><span class="line">        border-radius: 20px;</span><br><span class="line">        padding: 10px;</span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout .top .title &#123;</span><br><span class="line">        font-size: 20px;</span><br><span class="line">        font-weight: 700;</span><br><span class="line">        color: #333;</span><br><span class="line">        margin-right: auto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout .top .btn &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        align-items: center;</span><br><span class="line">        width: 50px;</span><br><span class="line">        height: 24px;</span><br><span class="line">        border-radius: 10px;</span><br><span class="line">        border: 1px solid #333;</span><br><span class="line">        font-size: 14px;</span><br><span class="line">        font-weight: 700;</span><br><span class="line">        color: #333;</span><br><span class="line">        padding: 0px 3px;</span><br><span class="line">        cursor: pointer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout .top .btn:hover &#123;</span><br><span class="line">        background: #333;</span><br><span class="line">        color: #fff;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><code>components / Flip / index.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;clock&quot;&gt;</span><br><span class="line">        &lt;!-- 小时 --&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;hoursFirstChar&quot;&gt;&#123;&#123; hoursFirstChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;hoursSecondChar&quot;&gt;&#123;&#123; hoursSecondChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;em class=&quot;divider&quot;&gt;:&lt;/em&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 分钟 --&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;minutesFirstChar&quot;&gt;&#123;&#123; minutesFirstChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;minutesSecondChar&quot;&gt;&#123;&#123; minutesSecondChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;em class=&quot;divider&quot;&gt;:&lt;/em&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 秒 --&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;secondsFirstChar&quot;&gt;&#123;&#123; secondsFirstChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;secondsSecondChar&quot;&gt;&#123;&#123; secondsSecondChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    import &#123; ref, onMounted, watch &#125; from &#x27;vue&#x27;;</span><br><span class="line">    import &#123; getFormattedTime &#125; from &#x27;../../utils/timeUtils&#x27;; // 确保路径正确</span><br><span class="line"></span><br><span class="line">    const hoursFirstChar = ref(&#x27;&#x27;);</span><br><span class="line">    const hoursSecondChar = ref(&#x27;&#x27;);</span><br><span class="line">    const minutesFirstChar = ref(&#x27;&#x27;);</span><br><span class="line">    const minutesSecondChar = ref(&#x27;&#x27;);</span><br><span class="line">    const secondsFirstChar = ref(&#x27;&#x27;);</span><br><span class="line">    const secondsSecondChar = ref(&#x27;&#x27;);</span><br><span class="line"></span><br><span class="line">    const updateTime = () =&gt; &#123;</span><br><span class="line">        const time = getFormattedTime();</span><br><span class="line">        hoursFirstChar.value = time.hoursFirstChar;</span><br><span class="line">        hoursSecondChar.value = time.hoursSecondChar;</span><br><span class="line">        minutesFirstChar.value = time.minutesFirstChar;</span><br><span class="line">        minutesSecondChar.value = time.minutesSecondChar;</span><br><span class="line">        secondsFirstChar.value = time.secondsFirstChar;</span><br><span class="line">        secondsSecondChar.value = time.secondsSecondChar;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">        updateTime(); // 初始化时更新时间</span><br><span class="line">        setInterval(updateTime, 1000); // 每秒更新一次时间</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        align-items: center;</span><br><span class="line">        height: 100vh;</span><br><span class="line">        width: 100vw;</span><br><span class="line">        background-color: #2c3e50; /* 添加背景色以便于查看 */</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .clock &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 时钟的分隔 */</span><br><span class="line">    .clock .divider &#123;</span><br><span class="line">        font-size: 30px;</span><br><span class="line">        line-height: 60px;</span><br><span class="line">        font-style: normal;</span><br><span class="line">        color: rgb(255, 255, 255); /* 更改为白色以便于查看 */</span><br><span class="line">        margin: 0 5px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 时钟的卡片 */</span><br><span class="line">    .clock .flip &#123;</span><br><span class="line">        position: relative;</span><br><span class="line">        width: 40px; /* 稍微增加宽度以确保数字完全显示 */</span><br><span class="line">        height: 60px; /* 增加高度以确保数字完全显示 */</span><br><span class="line">        margin: 2px;</span><br><span class="line">        font-size: 48px; /* 增加字体大小以便于查看 */</span><br><span class="line">        font-weight: 700;</span><br><span class="line">        line-height: 60px; /* 确保文本垂直居中 */</span><br><span class="line">        text-align: center;</span><br><span class="line">        background: rgb(46, 45, 45);</span><br><span class="line">        border: 1px solid rgb(34, 33, 33);</span><br><span class="line">        border-radius: 10px;</span><br><span class="line">        box-shadow: 0 0 6px rgba(54, 54, 54, 0.5);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* 时钟上的数字 */</span><br><span class="line">    .clock .flip .digital &#123;</span><br><span class="line">        position: absolute;</span><br><span class="line">        top: 0;</span><br><span class="line">        left: 0;</span><br><span class="line">        right: 0;</span><br><span class="line">        bottom: 0;</span><br><span class="line">        color: white; /* 数字颜色为白色 */</span><br><span class="line">        background: transparent; /* 背景透明 */</span><br><span class="line">        border-radius: 10px;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">        justify-content: center;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><code>components / Timer / index.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;&#123;&#123; formattedTime &#125;&#125;&lt;/h1&gt;</span><br><span class="line">        &lt;button @click=&quot;start&quot; :disabled=&quot;isRunning&quot;&gt;开始&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;stop&quot; :disabled=&quot;!isRunning&quot;&gt;停止&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;reset&quot; :disabled=&quot;elapsedTime === 0&quot;&gt;重置&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    import &#123; ref, computed, onMounted, onUnmounted &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">    const startTime = ref(null)</span><br><span class="line">    const elapsedTime = ref(0)</span><br><span class="line">    const isRunning = ref(false)</span><br><span class="line"></span><br><span class="line">    const formattedTime = computed(() =&gt; &#123;</span><br><span class="line">        const hours = Math.floor(elapsedTime.value / 3600).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        const minutes = Math.floor((elapsedTime.value % 3600) / 60).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        const seconds = (elapsedTime.value % 60).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        return `$&#123;hours&#125;:$&#123;minutes&#125;:$&#123;seconds&#125;`</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    let intervalId = null</span><br><span class="line"></span><br><span class="line">    function start() &#123;</span><br><span class="line">        if (!isRunning.value) &#123;</span><br><span class="line">            startTime.value = Date.now() - (startTime.value ? startTime.value : 0)</span><br><span class="line">            isRunning.value = true</span><br><span class="line">            intervalId = setInterval(updateElapsedTime, 1000)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function stop() &#123;</span><br><span class="line">        clearInterval(intervalId)</span><br><span class="line">        isRunning.value = false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function reset() &#123;</span><br><span class="line">        clearInterval(intervalId)</span><br><span class="line">        startTime.value = null</span><br><span class="line">        elapsedTime.value = 0</span><br><span class="line">        isRunning.value = false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function updateElapsedTime() &#123;</span><br><span class="line">        elapsedTime.value = Math.floor((Date.now() - startTime.value) / 1000)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">        document.addEventListener(&#x27;visibilitychange&#x27;, handleVisibilityChange)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    onUnmounted(() =&gt; &#123;</span><br><span class="line">        document.removeEventListener(&#x27;visibilitychange&#x27;, handleVisibilityChange)</span><br><span class="line">        clearInterval(intervalId)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    function handleVisibilityChange() &#123;</span><br><span class="line">        if (document.visibilityState === &#x27;hidden&#x27;) &#123;</span><br><span class="line">            if (isRunning.value) &#123;</span><br><span class="line">                stop()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else if (document.visibilityState === &#x27;visible&#x27;) &#123;</span><br><span class="line">            if (isRunning.value) &#123;</span><br><span class="line">                start()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="启动项目"><a href="#启动项目" class="headerlink" title="启动项目"></a>启动项目</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run build</span><br></pre></td></tr></table></figure><p><strong>网页端开发环境</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run dev</span><br></pre></td></tr></table></figure><p><strong>桌面端开发环境</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run start</span><br></pre></td></tr></table></figure><h3 id="exe文件生成位置"><a href="#exe文件生成位置" class="headerlink" title=".exe文件生成位置"></a>.exe文件生成位置</h3><p><code>release</code>文件夹中的 Setup.exe（文件有70多m!!!不理解）</p><h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a><em>TODO</em></h3><p><strong>1.桌面软件图标还是Electron的，需要修改为下好的ico</strong></p><p><strong>2.git大文件提交问题（可能是需要改动gitignore？没有接触过）</strong></p><p><strong>3.第一版Vue+Electron+TS项目提到过自动发布版本工作流，还有检测标签啥的，还没弄懂这周探索一下，没记错的话github主页的贪吃蛇好像也和这个有关系</strong></p><p><strong>4.简单UI排布</strong></p><p><strong>5.交互功能：用户可自行添加多个计时器，且独立计时</strong></p><p><strong>6.考虑到挂后台会有计时误差，添加新的计时逻辑（begin记录时间戳，从后台调出时通过时间戳相减更新时间）</strong></p>]]></content>
      
      
      <categories>
          
          <category> 技术探索 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WebSocket</title>
      <link href="/2025/03/08/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/WebSocket/"/>
      <url>/2025/03/08/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/WebSocket/</url>
      
        <content type="html"><![CDATA[<h1 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h1><blockquote><p><strong>低延迟，双向实时通信(双全工)，长期运行</strong></p></blockquote><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><strong>相比HTTP协议，WebSocket是一种****实时通信</strong>协议</p><p><strong>在实时通讯前，HTTP通过****轮询</strong>解决实时问题</p><blockquote><p><strong>轮询：客户端定期向服务器发送请求</strong></p><blockquote><p><strong>长轮询：客户端发出请求后，保持连接打开，等待新数据响应后再关闭连接</strong></p></blockquote><blockquote><p><strong>Comet：保持长连接，返回请求后继续保持连接打开</strong></p></blockquote></blockquote><p><strong>WebSocket的连接只需要建立一次</strong></p><h2 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h2><h3 id="理论须知"><a href="#理论须知" class="headerlink" title="理论须知"></a>理论须知</h3><p><strong>需要HTTP向服务器发起一次常规Get请求，并在这个请求头上携带</strong><em><strong>Upgrade</strong></em></p><blockquote><p><strong>Upgrade作为升级请求将传递给服务器，协议从HTTP升级为WebSocket</strong></p></blockquote><p><strong>在此之后客户端和服务器即可随时向彼此发送消息</strong></p><h3 id="具体代码"><a href="#具体代码" class="headerlink" title="具体代码"></a>具体代码</h3><p><strong>前端</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const socket = new WebSocket(&quot;ws://localhost:8080&quot;);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">socket.onopen =function(event)&#123;</span><br><span class="line">    console.log(&quot;Websocket连接已打开&quot;)</span><br><span class="line">&#125;</span><br><span class="line">socket.onmessage =function(event)&#123;</span><br><span class="line">    console.log(&quot;收到了回复:&quot;event.data)</span><br><span class="line">&#125;</span><br><span class="line">socket.onclose = function(event)&#123;</span><br><span class="line">    console.log(&quot;Websocket连接已关闭&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function click()&#123;//发送消息</span><br><span class="line">    socket.send(&quot;Hello World!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>后端</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&#x27;http&#x27;);//引入模块</span><br><span class="line">const WebSocket = require(&#x27;ws&#x27;);</span><br><span class="line"></span><br><span class="line">const server = http.createServer();//HTTP服务器实例</span><br><span class="line">const wss = new WebSocket.Server(&#123; server &#125;);//根据服务器实例创建WebSocket实例</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wss.on(&#x27;connection&#x27;,(socket) =&gt; &#123;//客户端连入Websocket服务器</span><br><span class="line">    socket.on(&#x27;message&#x27;,(message)=&gt;&#123;</span><br><span class="line">        console.log(&#x27;收到消息:&#x27;+ message)</span><br><span class="line">        socket.send(&#x27;Hello FireUG&#x27;);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    socket.on(&#x27;close&#x27;,() =&gt; &#123;</span><br><span class="line">        console.log(&#x27;Websocket连接已关闭&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server.on(&#x27;request&#x27;,(request,response)=&gt;&#123;</span><br><span class="line">    response.writeHead(200,&#123;&#x27;Content-Type&#x27;:&#x27;text/plain&#x27;&#125;)</span><br><span class="line">    response.end(&#x27;Hello, World!&#x27;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.listen(8080，() =&gt; &#123;</span><br><span class="line">    console.log(&#x27;服务器已启动，端口号为 8080&#x27;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="心跳机制"><a href="#心跳机制" class="headerlink" title="心跳机制"></a>心跳机制</h2><blockquote><p><strong>为了保持长连接，服务端和客户端之间通过</strong> <code>心跳包</code>保持连接状态，防止长时间没有数据传输而被切断</p></blockquote><p><code>心跳包</code></p><blockquote><p><strong>一种数据包，不包含任何实际数据</strong></p><p><strong>客户端和服务端定期发送一个空的数据包，确保链接仍然有效</strong></p><p><strong>如果一段时间没有收到对方的心跳包，就可认为连接已经断开</strong></p></blockquote><h2 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h2><p><strong>安全</strong></p><blockquote><p><strong>不提供加密功能，需采用其他方式来确保安全性</strong></p><blockquote><p><strong>SSL协议：可对WebSocket连接进行加密防止敏感信息被窃听和篡改</strong></p></blockquote><blockquote><p><strong>设置黑白名单：在服务端设置，只允许特定IP地址或域名的客户端进行连接</strong></p></blockquote></blockquote><p><strong>支持</strong></p><blockquote><p><strong>小于IE10的浏览器不支持</strong></p></blockquote><p><strong>优化</strong></p><blockquote><p><strong>保持长连接需要服务器不断地维护和处理连接状态，需要优化性能，不然会过度地消耗服务器资源</strong></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 技术探索 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Node.js</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Node.js%E5%9F%BA%E7%A1%80/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Node.js%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="Node-js基础"><a href="#Node-js基础" class="headerlink" title="Node.js基础"></a>Node.js基础</h1><h2 id="模块系统"><a href="#模块系统" class="headerlink" title="模块系统"></a>模块系统</h2><h3 id="require-module"><a href="#require-module" class="headerlink" title="require &amp; module"></a>require &amp; module</h3><blockquote><p><strong>CommonJS规范</strong></p><p><strong>模块化:把代码按功能分开(可复用性强)</strong></p></blockquote><p><strong>举例</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function sayHello(name) &#123;</span><br><span class="line">    return `Hello, $&#123;name&#125;`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);//引入express模块</span><br><span class="line">const sayHello = require(&#x27;./myModule&#x27;);//引入自定义模块</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, (req, res) =&gt; &#123;</span><br><span class="line">    res.send(sayHello(&#x27;World&#x27;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="npm包管理"><a href="#npm包管理" class="headerlink" title="npm包管理"></a>npm包管理</h3><blockquote><p><strong>就是前端常见的 npm install 下包</strong></p></blockquote><h2 id="异步编程"><a href="#异步编程" class="headerlink" title="异步编程"></a>异步编程</h2><h3 id="回调函数Promise"><a href="#回调函数Promise" class="headerlink" title="回调函数Promise"></a>回调函数Promise</h3><blockquote><p><strong>可以通过</strong> <code>util.promisify</code>将基于回调的API转换为返回Promise的形式</p><p><code>async</code>关键字定义一个返回Promise的函数，<code>await</code>等待一个Promise对象的结果</p></blockquote><h3 id="fs-readFile"><a href="#fs-readFile" class="headerlink" title="fs.readFile"></a>fs.readFile</h3><blockquote><p><strong>Node.js的文件系统模块（fs）提供了同步和异步两种版本的API，如</strong> <code>fs.readFile</code>和 <code>fs.readFileSync</code>。</p></blockquote><p><strong>四种写法</strong></p><p><img src="/upload/image-20250207162038459.png" alt="image-20250207162038459.png"></p><h2 id="HTTP服务器"><a href="#HTTP服务器" class="headerlink" title="HTTP服务器"></a>HTTP服务器</h2><h3 id="引入nodejs内置模块"><a href="#引入nodejs内置模块" class="headerlink" title="引入nodejs内置模块"></a>引入nodejs内置模块</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&#x27;http&#x27;);</span><br><span class="line">const url = require(&#x27;url&#x27;);</span><br></pre></td></tr></table></figure><h3 id="创建服务器"><a href="#创建服务器" class="headerlink" title="创建服务器"></a>创建服务器</h3><blockquote><p><code>http.createServer()</code>函数创建一个新的HTTP服务器实例</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const server = http.createServer((req, res) =&gt; &#123;</span><br><span class="line">  // 处理请求和响应</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>当有请求到达服务器时，回调函数会被触发</strong></p><p><code>req</code>是请求对象，<code>res</code>是响应对象</p></blockquote><h3 id="解析URL"><a href="#解析URL" class="headerlink" title="解析URL"></a>解析URL</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const parsedUrl = url.parse(req.url, true);</span><br></pre></td></tr></table></figure><blockquote><p><strong><code>req.url</code></strong>：获取请求的URL（比如 <code>/hello?name=Qwen</code>）</p><p><strong><code>url.parse()</code></strong>：将URL拆解成对象，第二个参数 <code>true</code>表示将查询参数（如 <code>?name=Qwen</code>）解析为对象（<code>parsedUrl.query</code>）</p></blockquote><h3 id="设置响应头"><a href="#设置响应头" class="headerlink" title="设置响应头"></a>设置响应头</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.writeHead(200, &#123;&#x27;Content-Type&#x27;: &#x27;text/plain&#x27;&#125;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>状态码200</strong>：表示请求成功</p><p><strong><code>Content-Type: text/plain</code></strong>：告诉浏览器返回的内容是纯文本</p></blockquote><h3 id="处理请求"><a href="#处理请求" class="headerlink" title="处理请求"></a>处理请求</h3><p><strong>req.url</strong></p><p><strong>req.method</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if (req.method === &#x27;GET&#x27;) &#123;</span><br><span class="line">  if (parsedUrl.pathname === &#x27;/hello&#x27;) &#123;//http://localhost:3000/hello?...=...</span><br><span class="line">    // 处理/hello路径</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // 处理其他路径</span><br><span class="line">  &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  // 处理非GET请求</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>路径是</strong> <code>/hello</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let name = parsedUrl.query.name || &quot;World&quot;;</span><br><span class="line">res.end(`Hello $&#123;name&#125;!\n`);</span><br></pre></td></tr></table></figure><blockquote><p><strong>获取查询参数</strong>：从 <code>parsedUrl.query</code>中读取 <code>name</code>参数（如 <code>?name=Qwen</code>）</p><p><strong>如果未提供</strong> <code>name</code>，默认值为 <code>World</code></p><p><strong>示例</strong>：访问 <code>http://localhost:3000/hello?name=Qwen</code>会返回 <code>Hello Qwen!</code></p></blockquote><p><strong>其他路径</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.end(&#x27;Welcome to the simple HTTP server!\n&#x27;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>根路径示例</strong>：访问 <code>http://localhost:3000/</code>会返回欢迎消息</p></blockquote><h3 id="非get请求"><a href="#非get请求" class="headerlink" title="非get请求"></a>非get请求</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.writeHead(405, &#123;&#x27;Content-Type&#x27;: &#x27;text/plain&#x27;&#125;);</span><br><span class="line">res.end(&#x27;Method Not Allowed\n&#x27;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>状态码405</strong>：表示服务器不支持该请求方法（如POST、PUT等）</p><p><strong>会返回错误信息</strong> <code>Method Not Allowed</code></p></blockquote><h3 id="启动服务器"><a href="#启动服务器" class="headerlink" title="启动服务器"></a>启动服务器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.listen(3000, () =&gt; &#123;</span><br><span class="line">  console.log(&#x27;Server is listening on port 3000&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>服务器监听本地的3000端口，启动后打印日志。</strong></p></blockquote><h2 id="调试与部署"><a href="#调试与部署" class="headerlink" title="调试与部署"></a>调试与部署</h2><h3 id="nodemon热重载"><a href="#nodemon热重载" class="headerlink" title="nodemon热重载"></a>nodemon热重载</h3><blockquote><p><code>nodemon</code>是一个用于Node.js应用的工具，它可以监听文件变化并在文件被修改时自动重启服务，这大大提高了开发效率</p></blockquote><h3 id="PM2进程管理"><a href="#PM2进程管理" class="headerlink" title="PM2进程管理"></a>PM2进程管理</h3><blockquote><p><strong>它可以保证你的应用程序始终在线，即使遇到崩溃也能自动重启</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start app.js --name &quot;MyApi&quot;</span><br></pre></td></tr></table></figure><blockquote><p><code>app.js</code>就是你Node.js应用的入口文件</p></blockquote><p><strong>安装</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express nodemon pm2 --save</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mini-vue搭建笔记</title>
      <link href="/2025/03/08/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/mini-vue%E6%90%AD%E5%BB%BA%E7%AC%94%E8%AE%B0/"/>
      <url>/2025/03/08/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/mini-vue%E6%90%AD%E5%BB%BA%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="mini-vue搭建笔记"><a href="#mini-vue搭建笔记" class="headerlink" title="mini-vue搭建笔记"></a>mini-vue搭建笔记</h1><h1 id="原理概况"><a href="#原理概况" class="headerlink" title="原理概况"></a>原理概况</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/cuixiaorui/mini-vue</span><br></pre></td></tr></table></figure><h2 id="Vue3模块组织方式"><a href="#Vue3模块组织方式" class="headerlink" title="Vue3模块组织方式"></a>Vue3模块组织方式</h2><h3 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h3><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250219223855962.png?lastModify=1740547033" alt="image-20250219223855962"></p><h3 id="简单来说"><a href="#简单来说" class="headerlink" title="简单来说"></a>简单来说</h3><h4 id="处理编译"><a href="#处理编译" class="headerlink" title="处理编译"></a>处理编译</h4><blockquote><p><code>compiler-sfc</code>专门解析sfc (使用rollup-vue<em><strong>把App.vue单文件组件编译成JS</strong></em>)</p><p><code>compiler-dom</code>依赖core，处理template标签，<em><strong>把template编译转化成一个render函数</strong></em></p><p><code>compiler-core</code>给dom提供依赖</p></blockquote><h4 id="处理运行时"><a href="#处理运行时" class="headerlink" title="处理运行时"></a>处理运行时</h4><blockquote><p><code>runtime-dom</code>依赖core</p><p><code>runtime-core</code><em><strong>最重点的核心代码</strong></em></p><p><code>runtime-reactivity</code>实现vue的<em><strong>响应式</strong></em></p></blockquote><h3 id="更为详细的"><a href="#更为详细的" class="headerlink" title="更为详细的"></a>更为详细的</h3><h4 id="runtime-reactivity-响应式系统"><a href="#runtime-reactivity-响应式系统" class="headerlink" title="runtime-reactivity 响应式系统"></a>runtime-reactivity 响应式系统</h4><blockquote><p><strong>提供了诸如 reactive、ref 等 API 来创建响应式对象或变量。</strong> <strong>使用 WeakMap 数据结构来跟踪依赖关系，确保当数据变化时能够通知相关的观察者进行更新。</strong> <strong>实现了 effect 函数机制，用于自动追踪和触发副作用函数的执行。</strong></p></blockquote><h4 id="runtime-core-跨平台渲染"><a href="#runtime-core-跨平台渲染" class="headerlink" title="runtime-core 跨平台渲染"></a>runtime-core 跨平台渲染</h4><blockquote><p><strong>Vue3 的运行时核心模块，提供了跨平台的渲染能力。它的主要职责包括：</strong> <strong>定义了通用的渲染器接口 createRenderer，允许开发者自定义渲染逻辑。</strong> <strong>实现了组件生命周期管理、插槽机制以及其他运行时所需的基础功能。</strong> <strong>提供了诸如 h 函数这样的工具，用于创建虚拟 DOM 节点。</strong> <strong>包含了与平台无关的运行时核心实现（如虚拟 DOM 的渲染器、组件实现和一些全局的 JS API）。</strong></p></blockquote><h4 id="runtime-dom-DOM方法"><a href="#runtime-dom-DOM方法" class="headerlink" title="runtime-dom DOM方法"></a>runtime-dom DOM方法</h4><blockquote><p><strong>runtime-dom 模块针对浏览器环境实现了具体的运行时逻辑。其主要任务是：</strong> <strong>封装了一系列与 DOM 操作相关的实用方法，如创建元素、插入节点等。</strong> <strong>提供了一个基于 runtime-core 的默认渲染器实例，用于将虚拟 DOM 节点渲染到真实的 DOM 容器中。</strong> <strong>处理特定于浏览器的行为，比如属性绑定、事件监听器添加等。</strong> <strong>对原生 DOM API、属性、样式、事件等进行管理。</strong></p></blockquote><h4 id="compiler-sfc-解析-vue组件"><a href="#compiler-sfc-解析-vue组件" class="headerlink" title="compiler-sfc 解析.vue组件"></a>compiler-sfc 解析.vue组件</h4><blockquote><p><strong>compiler-sfc 模块负责解析单文件组件（.vue 文件），它将 .vue 文件中的 <strong><template></strong>、</strong><script>** 和 <strong><style></strong> 部分分别提取出来，并对它们进行相应的处理。具体而言：** <strong>对于 <strong><template></strong> 部分，会调用 compiler-dom 来将其编译为渲染函数。</strong> <strong>对于 <strong><script></strong> 部分，可能会做一些额外的处理，比如注入上下文或处理 TypeScript 类型声明。</strong> <strong>对于 <strong><style></strong> 部分，则可能涉及 CSS 模块化处理或者其他样式相关的转换。</strong></p></blockquote><h4 id="compiler-core-编译逻辑和算法"><a href="#compiler-core-编译逻辑和算法" class="headerlink" title="compiler-core 编译逻辑和算法"></a>compiler-core 编译逻辑和算法</h4><blockquote><p><strong>作为 Vue 编译的核心模块，compiler-core 是平台无关的，提供了基础的编译逻辑和算法。它的职责是定义了编译的基本流程，包括但不限于：</strong> <strong>提供 baseParse 函数用于解析模板字符串到 AST。</strong> <strong>定义了 transform 方法来对 AST 进行转换。</strong> <strong>实现了 generate 函数用来从 AST 生成最终的渲染函数代码。</strong> <strong>提供了与平台无关的代码转换插件，适用于不同类型的编译需求。</strong></p></blockquote><h4 id="compiler-dom-浏览器模板编译"><a href="#compiler-dom-浏览器模板编译" class="headerlink" title="compiler-dom 浏览器模板编译"></a>compiler-dom 浏览器模板编译</h4><blockquote><p><strong>该模块专注于浏览器端的模板编译工作。它的主要功能包括：</strong> <strong>接收 Vue 的模板字符串作为输入，通过调用 baseCompile 函数来执行实际的编译过程。</strong> <strong>将模板字符串解析为抽象语法树（AST）。</strong> <strong>对 AST 进行必要的转换和优化。</strong> <strong>最终生成可执行的 JavaScript 渲染函数代码，以便在浏览器环境中运行。</strong></p></blockquote><h1 id="runtime-reactivity-响应式系统-1"><a href="#runtime-reactivity-响应式系统-1" class="headerlink" title="runtime-reactivity 响应式系统"></a>runtime-reactivity 响应式系统</h1><h2 id="主流程-脑图"><a href="#主流程-脑图" class="headerlink" title="主流程 | 脑图"></a>主流程 | 脑图</h2><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250220163321605.png?lastModify=1740547033" alt="image-20250220163321605"></p><h3 id="reactive-响应式设置"><a href="#reactive-响应式设置" class="headerlink" title="reactive 响应式设置"></a>reactive 响应式设置</h3><blockquote><p><em><strong>reactivity核心API</strong></em></p><p><strong><code>reactive()</code><strong>创建</strong>对象类型</strong>的响应式数据：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive &#125; from &#x27;vue&#x27;;</span><br><span class="line">const state = reactive(&#123; count: 0 &#125;);</span><br><span class="line">state.count++; // 修改后视图自动更新</span><br></pre></td></tr></table></figure><p><strong><code>ref()</code><strong>创建</strong>任意类型</strong>的响应式数据（通过 <code>.value</code> 访问）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">const num = ref(0);</span><br><span class="line">num.value = 10; // 修改需使用 .value</span><br></pre></td></tr></table></figure><p>**<code>computed()</code>**创建依赖其他数据的计算属性：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const doubleCount = computed(() =&gt; state.count * 2);</span><br></pre></td></tr></table></figure><p>**<code>watch()</code> 和 <code>watchEffect()</code>**监听数据变化执行副作用：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">watch(num, (newVal) =&gt; console.log(&#x27;num变化:&#x27;, newVal));</span><br><span class="line">watchEffect(() =&gt; console.log(&#x27;count变化:&#x27;, state.count));</span><br></pre></td></tr></table></figure></blockquote><h4 id="reactive-单测"><a href="#reactive-单测" class="headerlink" title="reactive 单测"></a>reactive 单测</h4><p><strong>reactivity / tests / reactive.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive, isReactive, toRaw, reactiveMap &#125; from &quot;../src/reactive&quot;;</span><br></pre></td></tr></table></figure><blockquote><p><code>reactive</code>: 将普通对象转换为响应式对象。** <strong><code>isReactive</code>: 检查一个对象是否是响应式对象。</strong> <strong><code>toRaw</code>: 获取响应式对象对应的原始对象。</strong> **<code>reactiveMap</code>: 内部使用的 Map 数据结构，用于存储原始对象和响应式对象之间的映射关系。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">describe(&quot;reactive&quot;, () =&gt; &#123;</span><br><span class="line">  test(&quot;Object&quot;, () =&gt; &#123;//测试用例1 | 基本功能：确保 reactive 方法能够正确地将普通对象转换为响应式对象。</span><br><span class="line">    const original = &#123; foo: 1 &#125;;</span><br><span class="line">    const observed = reactive(original);//将普通对象转换为响应式对象</span><br><span class="line">    expect(observed).not.toBe(original);//确保 reactive 返回的对象与原始对象不是同一个引用</span><br><span class="line">    expect(isReactive(observed)).toBe(true);//验证 observed 是响应式对象</span><br><span class="line">    expect(isReactive(original)).toBe(false);//而 original 不是</span><br><span class="line">    expect(observed.foo).toBe(1);//可读取</span><br><span class="line">    expect(&quot;foo&quot; in observed).toBe(true);//存在</span><br><span class="line">    expect(Object.keys(observed)).toEqual([&quot;foo&quot;]);//自有属性键名</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  test(&quot;nested reactives&quot;, () =&gt; &#123;//测试用例2 | 嵌套对象支持：确保嵌套对象和数组也能被正确转换为响应式对象。</span><br><span class="line">    const original = &#123;//定义一个复杂对象</span><br><span class="line">      nested: &#123;//嵌套对象</span><br><span class="line">        foo: 1,</span><br><span class="line">      &#125;,</span><br><span class="line">      array: [&#123; bar: 2 &#125;],//数组</span><br><span class="line">    &#125;;</span><br><span class="line">    const observed = reactive(original);//将复杂对象转换为响应式对象</span><br><span class="line">    expect(isReactive(observed.nested)).toBe(true);</span><br><span class="line">    expect(isReactive(observed.array)).toBe(true);</span><br><span class="line">    expect(isReactive(observed.array[0])).toBe(true);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  test(&quot;toRaw&quot;, () =&gt; &#123;//测试用例3 | toRaw 方法：确保可以正确地从响应式对象中获取原始对象。</span><br><span class="line">    const original = &#123; foo: 1 &#125;;</span><br><span class="line">    const observed = reactive(original);</span><br><span class="line">    expect(toRaw(observed)).toBe(original);//确保通过 toRaw 方法可以从响应式对象 observed 中获取原始对象 original</span><br><span class="line">    expect(toRaw(original)).toBe(original);//如果直接对原始对象调用 toRaw，应该返回原始对象本身</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="reactive-源码实现（Proxy）"><a href="#reactive-源码实现（Proxy）" class="headerlink" title="reactive 源码实现（Proxy）"></a>reactive 源码实现（<em>Proxy</em>）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function reactive(target) &#123;</span><br><span class="line">  return createReactiveObject(target, reactiveMap, mutableHandlers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>👇</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function createReactiveObject(target, proxyMap, baseHandlers) &#123;//原理是JS创建的Proxy对象，目的是可以侦听到用户 get 或者 set 的动作</span><br><span class="line">    </span><br><span class="line">  const existingProxy = proxyMap.get(target);//先检查 proxyMap 中是否已经存在与当前 target 对应的代理对象。</span><br><span class="line">  if (existingProxy) &#123;//存在则直接返回缓存中的代理对象，避免重复创建。</span><br><span class="line">    return existingProxy;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //target 被代理的目标对象</span><br><span class="line">  //baseHandlers 一个拦截器对象，定义了代理的行为（例如如何处理 get 和 set 操作）</span><br><span class="line">  const proxy = new Proxy(target, baseHandlers);</span><br><span class="line"></span><br><span class="line">  proxyMap.set(target, proxy);//把创建好的 proxy 给存起来</span><br><span class="line">  return proxy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>另：回顾Proxy功能 | 可在用户对目标对象的</strong>***访问(get)<em><strong>和</strong></em>修改(set)***操作中，自定义逻辑（如触发依赖更新）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 定义一个目标对象</span><br><span class="line">const target = &#123; count: 0 &#125;;</span><br><span class="line"></span><br><span class="line">// 创建一个 Proxy 对象</span><br><span class="line">const reactiveObj = new Proxy(target, &#123;</span><br><span class="line">get(target, key, receiver) &#123;</span><br><span class="line">console.log(`Getting $&#123;key&#125;`);</span><br><span class="line">return Reflect.get(target, key, receiver);</span><br><span class="line">&#125;,</span><br><span class="line">set(target, key, value, receiver) &#123;</span><br><span class="line">console.log(`Setting $&#123;key&#125; to $&#123;value&#125;`);</span><br><span class="line">const result = Reflect.set(target, key, value, receiver);</span><br><span class="line">if (result) &#123;</span><br><span class="line">console.log(&quot;Trigger updates...&quot;);</span><br><span class="line">&#125;</span><br><span class="line">return result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 测试</span><br><span class="line">console.log(reactiveObj.count); // 输出: Getting count</span><br><span class="line">reactiveObj.count++; // 输出: Setting count to 1 和 Trigger updates...</span><br></pre></td></tr></table></figure></blockquote><h3 id="init-初始化"><a href="#init-初始化" class="headerlink" title="init 初始化"></a>init 初始化</h3><h4 id="effect-单测"><a href="#effect-单测" class="headerlink" title="effect 单测"></a>effect 单测</h4><blockquote><p><em><strong>effect 函数功能</strong></em></p><p><strong>当依赖的数据发生变化时，自动重新执行指定的函数。</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive, effect &#125; from &#x27;@vue/reactivity&#x27;;</span><br><span class="line"></span><br><span class="line">const state = reactive(&#123; count: 0 &#125;);</span><br><span class="line"></span><br><span class="line">// effect函数</span><br><span class="line">effect(() =&gt; &#123;</span><br><span class="line">console.log(`Count is $&#123;state.count&#125;`);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 修改状态</span><br><span class="line">state.count++; // 输出: Count is 1</span><br><span class="line">state.count++; // 输出: Count is 2</span><br></pre></td></tr></table></figure><p>**手动停止 **<code>effect</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 创建一个 effect 并获取停止函数</span><br><span class="line">const stop = effect(() =&gt; &#123;</span><br><span class="line">console.log(`Count is $&#123;state.count&#125;`);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 修改状态</span><br><span class="line">state.count++; // 输出: Count is 1</span><br><span class="line">// 停止 effect</span><br><span class="line">stop();</span><br><span class="line">// 再次修改状态，但 effect 不再触发</span><br><span class="line">state.count++; // 无输出</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive &#125; from &quot;../src/reactive&quot;;</span><br><span class="line">import &#123; effect, stop &#125; from &quot;../src/effect&quot;;</span><br><span class="line">import &#123; vi &#125; from &quot;vitest&quot;;</span><br><span class="line"></span><br><span class="line">describe(&quot;effect&quot;, () =&gt; &#123;</span><br><span class="line">  it(&quot;should run the passed function once (wrapped by a effect)&quot;, () =&gt; &#123; //验证 effect 函数是否会立即执行传入的函数一次</span><br><span class="line">    const fnSpy = vi.fn(() =&gt; &#123;&#125;);//创建一个间谍函数fnSpy</span><br><span class="line">    effect(fnSpy);//fnSpy作为参数传递给effect函数</span><br><span class="line">    expect(fnSpy).toHaveBeenCalledTimes(1);//验证fnSpy是否被调用了一次</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should observe basic properties&quot;, () =&gt; &#123;//验证 effect 函数是否能够观察到响应式对象的基本属性的变化</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; num: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = counter.num));//使用 effect 函数包裹一个箭头函数，该函数将 counter.num 的值赋给 dummy。</span><br><span class="line">    </span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.num = 7;</span><br><span class="line">    expect(dummy).toBe(7);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should observe multiple properties&quot;, () =&gt; &#123;//验证 effect 函数是否能够观察到响应式对象的多个属性的变化</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; num1: 0, num2: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = counter.num1 + counter.num1 + counter.num2));</span><br><span class="line">    </span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.num1 = counter.num2 = 7;</span><br><span class="line">    expect(dummy).toBe(21);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should handle multiple effects&quot;, () =&gt; &#123;//验证 effect 函数是否能够处理多个响应式依赖</span><br><span class="line">    let dummy1, dummy2;</span><br><span class="line">    const counter = reactive(&#123; num: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy1 = counter.num));</span><br><span class="line">    effect(() =&gt; (dummy2 = counter.num));</span><br><span class="line"></span><br><span class="line">    expect(dummy1).toBe(0);</span><br><span class="line">    expect(dummy2).toBe(0);</span><br><span class="line">    counter.num++;</span><br><span class="line">    expect(dummy1).toBe(1);</span><br><span class="line">    expect(dummy2).toBe(1);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should observe nested properties&quot;, () =&gt; &#123;//验证 effect 函数是否能够观察到嵌套属性的变化</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; nested: &#123; num: 0 &#125; &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = counter.nested.num));</span><br><span class="line"></span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.nested.num = 8;</span><br><span class="line">    expect(dummy).toBe(8);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should observe function call chains&quot;, () =&gt; &#123;//验证 effect 函数是否能够观察到函数调用链的变化</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; num: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = getNum()));</span><br><span class="line"></span><br><span class="line">    function getNum() &#123;</span><br><span class="line">      return counter.num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.num = 2;</span><br><span class="line">    expect(dummy).toBe(2);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;scheduler&quot;, () =&gt; &#123;//验证 effect 函数是否能够正确地调用 scheduler 函数</span><br><span class="line">    let dummy;</span><br><span class="line">    let run: any;</span><br><span class="line">    const scheduler = vi.fn(() =&gt; &#123;</span><br><span class="line">      run = runner;</span><br><span class="line">    &#125;);</span><br><span class="line">    const obj = reactive(&#123; foo: 1 &#125;);</span><br><span class="line">    const runner = effect(</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        dummy = obj.foo;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; scheduler &#125;</span><br><span class="line">    );</span><br><span class="line">    expect(scheduler).not.toHaveBeenCalled();</span><br><span class="line">    expect(dummy).toBe(1);</span><br><span class="line">    // should be called on first trigger</span><br><span class="line">    obj.foo++;</span><br><span class="line">    expect(scheduler).toHaveBeenCalledTimes(1);</span><br><span class="line">    // // should not run yet</span><br><span class="line">    expect(dummy).toBe(1);</span><br><span class="line">    // // manually run</span><br><span class="line">    run();</span><br><span class="line">    // // should have run</span><br><span class="line">    expect(dummy).toBe(2);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;stop&quot;, () =&gt; &#123;//验证 effect 函数是否能够正确地停止观察</span><br><span class="line">    let dummy;</span><br><span class="line">    const obj = reactive(&#123; prop: 1 &#125;);</span><br><span class="line">    const runner = effect(() =&gt; &#123;</span><br><span class="line">      dummy = obj.prop;</span><br><span class="line">    &#125;);</span><br><span class="line">    obj.prop = 2;</span><br><span class="line">    expect(dummy).toBe(2);</span><br><span class="line">    stop(runner);</span><br><span class="line">    // obj.prop = 3</span><br><span class="line">    obj.prop++;</span><br><span class="line">    expect(dummy).toBe(2);</span><br><span class="line"></span><br><span class="line">    // stopped effect should still be manually callable</span><br><span class="line">    runner();</span><br><span class="line">    expect(dummy).toBe(3);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;events: onStop&quot;, () =&gt; &#123;//验证 effect 函数是否能够正确地触发 onStop 事件</span><br><span class="line">    const onStop = vi.fn();</span><br><span class="line">    const runner = effect(() =&gt; &#123;&#125;, &#123;</span><br><span class="line">      onStop,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    stop(runner);</span><br><span class="line">    expect(onStop).toHaveBeenCalled();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="effect-源码实现"><a href="#effect-源码实现" class="headerlink" title="effect 源码实现"></a>effect 源码实现</h4><p><strong>effect函数</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">export function effect(fn, options = &#123;&#125;) &#123;</span><br><span class="line">    //fn：用户传入的副作用函数，该函数内部通常会访问响应式数据，当这些响应式数据发生变化时，fn 会被重新执行。</span><br><span class="line">    //options：一个可选的配置对象，默认值为空对象 &#123;&#125;。</span><br><span class="line">    const _effect = new ReactiveEffect(fn);</span><br><span class="line"></span><br><span class="line">    extend(_effect, options);//将用户传入的 options 配置对象合并到_effect 实例上，但不容易直接看出 _effect 实例上有哪些额外的属性</span><br><span class="line">    _effect.run();//调用内部run方法</span><br><span class="line"></span><br><span class="line">    // 将 _effect.run 方法绑定到 _effect 实例上，创建一个新的函数 runner</span><br><span class="line">    // 当调用 runner 函数时，实际上是调用 _effect.run 方法</span><br><span class="line">    const runner: any = _effect.run.bind(_effect);</span><br><span class="line">    //在 runner 函数上添加一个 effect 属性，指向 _effect 实例</span><br><span class="line">    runner.effect = _effect;</span><br><span class="line">    return runner;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="执行fn"><a href="#执行fn" class="headerlink" title="执行fn"></a>执行fn</h5><p><strong>ReactiveEffect类</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">export class ReactiveEffect &#123;</span><br><span class="line">  active = true; //标记该副作用函数是否处于活跃状态</span><br><span class="line">  deps = []; //存储该副作用函数的所有依赖项</span><br><span class="line">  public onStop?: () =&gt; void; //副作用函数停止时的回调</span><br><span class="line">  constructor(public fn, public scheduler?) &#123;</span><br><span class="line">    console.log(&quot;创建 ReactiveEffect 对象&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  run() &#123;</span><br><span class="line">    console.log(&quot;run&quot;);</span><br><span class="line">      </span><br><span class="line">    //如果 this.active 为 false，表示该副作用函数已经被停止（调用了 stop 方法），此时直接执行 this.fn() 并返回结果，不进行依赖收集。</span><br><span class="line">    if (!this.active) &#123;</span><br><span class="line">      return this.fn();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    shouldTrack = true;//全局变量，控制是否进行依赖收集。true表示开始收集依赖。</span><br><span class="line">    activeEffect = this as any;//全局变量，存储当前正在执行的副作用函数。this表示当前正在执行的副作用函数是 ReactiveEffect 的实例。</span><br><span class="line">      </span><br><span class="line">    console.log(&quot;执行用户传入的 fn&quot;);</span><br><span class="line">    const result = this.fn();</span><br><span class="line"></span><br><span class="line">    shouldTrack = false;//停止依赖收集。</span><br><span class="line">    activeEffect = undefined;//当前没有正在执行的副作用函数。</span><br><span class="line"></span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  stop() &#123;</span><br><span class="line">    if (this.active) &#123;//该副作用函数已经被停止</span><br><span class="line">      // 如果第一次执行 stop 后 active 就 false 了，这是为了防止重复的调用，执行 stop 逻辑</span><br><span class="line">      cleanupEffect(this);//从所有依赖该副作用函数的响应式对象中移除该副作用函数，从而停止响应式追踪</span><br><span class="line">      if (this.onStop) &#123;//this.onStop 存在，则调用该回调函数，允许用户在副作用函数停止时执行自定义逻辑</span><br><span class="line">        this.onStop();</span><br><span class="line">      &#125;</span><br><span class="line">      this.active = false;//副作用函数已经停止</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="触发get-访问"><a href="#触发get-访问" class="headerlink" title="触发get(访问)"></a>触发get(访问)</h5><h5 id="执行track-收集依赖"><a href="#执行track-收集依赖" class="headerlink" title="执行track(收集依赖)"></a>执行track(收集依赖)</h5><h5 id="把effect收集起来作为依赖"><a href="#把effect收集起来作为依赖" class="headerlink" title="把effect收集起来作为依赖"></a>把effect收集起来作为依赖</h5><h3 id="update-更新"><a href="#update-更新" class="headerlink" title="update 更新"></a>update 更新</h3><h4 id="例：effect-单测"><a href="#例：effect-单测" class="headerlink" title="例：effect 单测"></a>例：effect 单测</h4><h5 id="触发set-修改"><a href="#触发set-修改" class="headerlink" title="触发set(修改)"></a>触发set(修改)</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">it(&quot;should observe basic properties&quot;, () =&gt; &#123;//验证 effect 函数是否能够观察到响应式对象的基本属性的变化</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; num: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = counter.num));</span><br><span class="line"></span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.num = 7;// 更新时触发set操作</span><br><span class="line">    expect(dummy).toBe(7);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="执行trigger-触发依赖"><a href="#执行trigger-触发依赖" class="headerlink" title="执行trigger(触发依赖)"></a>执行trigger(触发依赖)</h5><p><strong>baseHandlers.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function createSetter() &#123;</span><br><span class="line">    return function set(target, key, value, receiver) &#123;</span><br><span class="line">        const result = Reflect.set(target, key, value, receiver)</span><br><span class="line"></span><br><span class="line">        trigger(target, &#x27;set&#x27;, key)// 触发trigger后重新运行effect函数</span><br><span class="line"></span><br><span class="line">        return result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="effect重新运行"><a href="#effect重新运行" class="headerlink" title="effect重新运行"></a>effect重新运行</h5><blockquote><p><strong>执行fn-&gt;触发get(访问)-&gt;执行track(收集依赖)-&gt;把effect收集起来作为依赖</strong></p></blockquote><h2 id="baseHandlers-脑图"><a href="#baseHandlers-脑图" class="headerlink" title="baseHandlers | 脑图"></a>baseHandlers | 脑图</h2><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250220164149032.png?lastModify=1740547033" alt="image-20250220164149032"></p><p><strong>直达src / baseHandlers.ts</strong></p><h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">function createGetter(isReadonly = false, shallow = false) &#123;</span><br><span class="line">  return function get(target, key, receiver) &#123;</span><br><span class="line">    //这些辅助函数用于检查 key 是否为 ReactiveFlags.RAW，并且 receiver 是否与相应的映射表（reactiveMap、readonlyMap 或 shallowReadonlyMap）中的目标对象匹配。</span><br><span class="line">    const isExistInReactiveMap = () =&gt;</span><br><span class="line">      key === ReactiveFlags.RAW &amp;&amp; receiver === reactiveMap.get(target);</span><br><span class="line"></span><br><span class="line">    const isExistInReadonlyMap = () =&gt;</span><br><span class="line">      key === ReactiveFlags.RAW &amp;&amp; receiver === readonlyMap.get(target);</span><br><span class="line"></span><br><span class="line">    const isExistInShallowReadonlyMap = () =&gt;</span><br><span class="line">      key === ReactiveFlags.RAW &amp;&amp; receiver === shallowReadonlyMap.get(target);</span><br><span class="line"></span><br><span class="line">    if (key === ReactiveFlags.IS_REACTIVE) &#123;//表示对象是否为响应式对象。</span><br><span class="line">      return !isReadonly;</span><br><span class="line">    &#125; else if (key === ReactiveFlags.IS_READONLY) &#123;</span><br><span class="line">      return isReadonly;</span><br><span class="line">    &#125; else if (//表示对象是否为只读对象。</span><br><span class="line">      isExistInReactiveMap() ||</span><br><span class="line">      isExistInReadonlyMap() ||</span><br><span class="line">      isExistInShallowReadonlyMap()</span><br><span class="line">    ) &#123;</span><br><span class="line">      return target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //假设obj=&#123;foo:1&#125; key:foo -&gt; res = 1 res就是目标对象的属性值//</span><br><span class="line">    const res = Reflect.get(target, key, receiver);</span><br><span class="line"></span><br><span class="line">    if (!isReadonly) &#123;//如果对象不是只读的，调用 track 函数进行依赖收集。只读对象不会被修改，也就不会触发 trigger 函数，所以不需要收集依赖。</span><br><span class="line">      // 在触发 get 的时候进行依赖收集</span><br><span class="line">      track(target, &quot;get&quot;, key);//触发track</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (shallow) &#123;//如果是浅响应式模式，直接返回属性值，不进行递归处理</span><br><span class="line">      return res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (isObject(res)) &#123;//如果属性值是一个对象，根据 isReadonly 的值，将其转换为只读响应式对象或普通响应式对象</span><br><span class="line">      // res 等于 target[key]</span><br><span class="line">      return isReadonly ? readonly(res) : reactive(res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return res;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function createSetter() &#123;</span><br><span class="line">    return function set(target, key, value, receiver) &#123;</span><br><span class="line">         //假设obj=&#123;foo:1&#125; key:foo -&gt; value可变2//</span><br><span class="line">         //obj=&#123;foo:2&#125;//</span><br><span class="line">        const result = Reflect.set(target, key, value, receiver)//设置对象的属性值</span><br><span class="line"></span><br><span class="line">        trigger(target, &#x27;set&#x27;, key)//trigger函数会通知所有依赖该属性的副作用函数重新执行，以确保响应式系统能够正确更新相关的视图或数据。</span><br><span class="line"></span><br><span class="line">        return result//设置完成，返回结果</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="deleteProperty"><a href="#deleteProperty" class="headerlink" title="deleteProperty"></a>deleteProperty</h3><h3 id="has"><a href="#has" class="headerlink" title="has"></a>has</h3><h3 id="ownKeys"><a href="#ownKeys" class="headerlink" title="ownKeys"></a>ownKeys</h3><h2 id="track-收集依赖-脑图"><a href="#track-收集依赖-脑图" class="headerlink" title="track(收集依赖) | 脑图"></a>track(收集依赖) | 脑图</h2><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250220212111915.png?lastModify=1740547033" alt="image-20250220212111915"></p><h3 id="初始化dep"><a href="#初始化dep" class="headerlink" title="初始化dep"></a>初始化dep</h3><p><strong>src / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">export function track(target, type, key) &#123;</span><br><span class="line">    //target：响应式对象，即被代理的原始对象。</span><br><span class="line">    //type：操作类型，例如 GET、SET 等，不过在当前代码中，type 参数未被使用。</span><br><span class="line">    //key：响应式对象的属性名。</span><br><span class="line">    if (!isTracking()) &#123;//当前是否允许进行依赖收集</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(`触发 track -&gt; target: $&#123;target&#125; type:$&#123;type&#125; key:$&#123;key&#125;`);</span><br><span class="line">    </span><br><span class="line">    let depsMap = targetMap.get(target);//targetMap 是一个 WeakMap，用于存储每个响应式对象对应的 depsMap</span><br><span class="line">    if (!depsMap) &#123;// 如果是第一次的话，初始化 depsMap 的逻辑</span><br><span class="line">        depsMap = new Map();// 创建一个新的 Map 实例</span><br><span class="line">        targetMap.set(target, depsMap);//存储到 targetMap 中</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let dep = depsMap.get(key);//depsMap 是一个 Map，存储每个属性对应的 dep</span><br><span class="line">    if (!dep) &#123;</span><br><span class="line">        dep = createDep();//创建一个新的 dep 实例</span><br><span class="line">        depsMap.set(key, dep);//存储到 depsMap 中</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    trackEffects(dep);//将当前的副作用函数（activeEffect）添加到 dep 中，并将 dep 添加到 activeEffect 的 deps 数组中</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="基于activeEffect获取当前依赖-dep-push-activeEffect"><a href="#基于activeEffect获取当前依赖-dep-push-activeEffect" class="headerlink" title="基于activeEffect获取当前依赖 &amp; dep.push(activeEffect)"></a>基于activeEffect获取当前依赖 &amp; dep.push(activeEffect)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export function trackEffects(dep) &#123;</span><br><span class="line">    // 将当前活跃的副作用函数（activeEffect）添加到对应的依赖集合（dep）中，同时将该依赖集合添加到副作用函数的依赖列表（deps）里。</span><br><span class="line">    if (!dep.has(activeEffect)) &#123;//检查是否已收集副函数</span><br><span class="line">        dep.add(activeEffect);//添加</span><br><span class="line">        (activeEffect as any).deps.push(dep);//添加依赖集合到副作用函数的依赖列表</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="trigger-触发依赖-脑图"><a href="#trigger-触发依赖-脑图" class="headerlink" title="trigger(触发依赖) | 脑图"></a>trigger(触发依赖) | 脑图</h2><p><strong>src / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">export function trigger(target, type, key) &#123;</span><br><span class="line">    // target：响应式对象，即被代理的原始对象。</span><br><span class="line">    // type：操作类型，例如 GET、SET 等。不过在当前代码中，暂时只处理了 GET 类型。</span><br><span class="line">    // key：响应式对象的属性名。</span><br><span class="line">    let deps: Array&lt;any&gt; = [];//存储所有依赖该属性的依赖集合（dep）</span><br><span class="line"></span><br><span class="line">    const depsMap = targetMap.get(target);//从 targetMap 中获取 target 对应的 depsMap</span><br><span class="line"></span><br><span class="line">    if (!depsMap) return;</span><br><span class="line"></span><br><span class="line">    // 暂时只实现了 GET 类型</span><br><span class="line">    // get 类型只需要取出来就可以</span><br><span class="line">    const dep = depsMap.get(key);</span><br><span class="line"></span><br><span class="line">    deps.push(dep);// 最后收集到 deps 内</span><br><span class="line"></span><br><span class="line">    const effects: Array&lt;any&gt; = [];</span><br><span class="line">    deps.forEach((dep) =&gt; &#123; // 这里解构 dep 得到的是 dep 内部存储的 effect</span><br><span class="line">        effects.push(...dep);</span><br><span class="line">    &#125;);</span><br><span class="line">    // 这里的目的是只有一个 dep ，这个dep 里面包含所有的 effect</span><br><span class="line">    // 这里的目前应该是为了 triggerEffects 这个函数的复用</span><br><span class="line">    triggerEffects(createDep(effects));// 触发该依赖集合中的所有副作用函数重新执行</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>src / dep.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export function createDep(effects?) &#123;</span><br><span class="line">    // Set 是 JavaScript 中的一种数据结构，类似于数组，但成员的值都是唯一的，没有重复的值。</span><br><span class="line">    const dep = new Set(effects);// 将传入的 effects 作为初始值填充到这个 Set 中</span><br><span class="line">    return dep;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>src / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export function triggerEffects(dep) &#123; // dep 是一个存储副作用函数的集合，通常是一个 Set 类型，用于记录依赖于某个响应式对象属性的所有副作用函数。</span><br><span class="line">    for (const effect of dep) &#123;// 遍历 dep 集合中的每个副作用函数 effect</span><br><span class="line">        if (effect.scheduler) &#123;// effect.scheduler存在</span><br><span class="line">            // scheduler 可以让用户自己选择调用的时机，这样就可以灵活的控制调用了</span><br><span class="line">            // 在 runtime-core 中，就是使用了 scheduler 实现了在 next ticker 中调用的逻辑</span><br><span class="line">            effect.scheduler();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            effect.run();// 直接调用 effect.run() 方法，执行副作用函数。</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="runtime-core-初始化核心"><a href="#runtime-core-初始化核心" class="headerlink" title="runtime-core 初始化核心"></a>runtime-core 初始化核心</h1><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p><strong>example / helloWorld</strong></p><p><strong>index.html</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script src=&quot;main.js&quot; type=&quot;module&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><strong>main.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &quot;../../dist/mini-vue.esm-bundler.js&quot;;</span><br><span class="line">import App from &quot;./App.js&quot;;</span><br><span class="line"></span><br><span class="line">const rootContainer = document.querySelector(&quot;#root&quot;);//获取根标签节点</span><br><span class="line">createApp(App).mount(rootContainer); //createApp(传入根组件).mount(传入根容器)</span><br></pre></td></tr></table></figure><p><strong>App.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;//一个对象</span><br><span class="line">    name: &quot;App&quot;,//标记当前组件的名字</span><br><span class="line">    setup(props,context) &#123;&#125;,//一个在组件创建之前执行的函数，可使用响应式数据、生命周期钩子、计算属性等</span><br><span class="line"></span><br><span class="line">    render() &#123;//把template转化成render函数，代表这个组件想要渲染出来的视图</span><br><span class="line">        //tag标签名(div)  props属性对象  children数据包含了(div 元素的子节点)</span><br><span class="line">        return h(&quot;div&quot;, &#123; tId: 1 &#125;, [h(&quot;p&quot;, &#123;&#125;, &quot;主页&quot;), h(HelloWorld)]);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="渲染流程详解"><a href="#渲染流程详解" class="headerlink" title="渲染流程详解"></a>渲染流程详解</h2><h3 id="mount-初始化流程"><a href="#mount-初始化流程" class="headerlink" title="mount 初始化流程"></a>mount 初始化流程</h3><blockquote><p><strong>先进入main.js---获取到根容器---触发createApp函数---调用createApp内部App对象的mount函数---mount内部基于传来的根容器生成虚拟节点vnode(一个普通对象但有几个关键的key，最关键的是有type对象[和传入的对象是一样的name|setup|render])</strong></p><p><strong>调用mount内部的render---调用内部patch方法---解构出type对象---switch判断type的类型从而用不同的方法处理</strong></p><blockquote><p><strong>component</strong> 组件类型---调用processComponent---根据!n1分成初始化or更新</p></blockquote><blockquote><blockquote><p><strong>mountComponent</strong> 初始化---模板初始化对象+把vnode虚拟节点挂在到该对象上---<em><strong>setupComponent</strong></em>---initProps+initSlots+setupStatefulComponent初始化props/slots/setup&amp;处理组件---在setupStatefulComponent创建一个代理对象[还是那个传来的type对象]将其绑定到instance对象上---传入instance触发setcurrentinstance---handlesetupResult基于setup中的props和context做出一定的处理---1.setup返回一个函数[会把它当成render函数去写] 2.setup返回一个对象[赋值,调用finishComponentSetup,如果没有render会将Component的render赋值给它]</p></blockquote></blockquote><blockquote><blockquote><p><strong>往回走走到</strong><em><strong>setupComponent</strong></em>，instance.update使用effect调用componentUpdateFn---该函数中要调用传来对象里的render函数获取vnode子组件生成好的虚拟节点---在componentUpdateFn触发<em><strong>patch</strong></em>(递归回去了)【!此时已经变成<strong>element</strong>元素类型了!】</p></blockquote></blockquote><blockquote><blockquote><p><strong>updateComponent</strong> 更新</p></blockquote></blockquote><blockquote><p><strong>element</strong> 元素类型---调用processElement---根据!n1分成初始化or更新</p></blockquote><blockquote><blockquote><p><strong>mountElement</strong> 初始化(把虚拟节点转化成一个真实的dom元素)---创建el(真实的element)---[文本类型调用hostcreateElement]---[数组类型调用mountChildren]传入childer节点,el---遍历数组触发<em><strong>patch</strong></em>(递归)【!此时数组元素就是<strong>element</strong>类型!】</p></blockquote></blockquote><blockquote><blockquote><p><strong>仍然位于mountElement函数中,如果元素props存在,遍历调用****hostPatchProp</strong>(传入el,key,null,val)---分类,内部处理还是调用了dom内部的API</p></blockquote></blockquote><blockquote><blockquote><p><strong>返回mountElement函数,下一步调用****hostInsert</strong>(el,container[根组件])[将所有的一切插回#root根元素组件]到此所有元素就都在页面上展示出来了，也就是初始化的全过程</p></blockquote></blockquote><blockquote><blockquote><p><strong>patchElement</strong></p></blockquote></blockquote></blockquote><blockquote><p>**通俗来说：**<em><strong>调用render就是“拆箱”的过程</strong></em>直到把内部所有的组件渲染到浏览器上</p></blockquote><h3 id="update-更新流程"><a href="#update-更新流程" class="headerlink" title="update 更新流程"></a>update 更新流程</h3><p><strong>App.js 样例变动</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;//一个对象</span><br><span class="line">    name: &quot;App&quot;,//标记当前组件的名字</span><br><span class="line">    setup(props,context) &#123;//一个在组件创建之前执行的函数，可使用响应式数据、生命周期钩子、计算属性等</span><br><span class="line">        const count = ref(10)</span><br><span class="line">        window.count = count</span><br><span class="line">        </span><br><span class="line">        return&#123;</span><br><span class="line">            count,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    render() &#123;//把template转化成render函数，代表这个组件想要渲染出来的视图</span><br><span class="line">        //tag标签名(div)  props属性对象  children数据包含了(div 元素的子节点)</span><br><span class="line">        return h(&quot;div&quot;, &#123; tId: 1 &#125;, [h(&quot;p&quot;, &#123;&#125;, &quot;主页&quot; + this.count)]);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p><strong>响应式的值发生改变(响应式对象都在render函数内)---执行用户传入的fn---判断是否初始化---触发当前组件的effect函数执行(instance,update)---调用render函数(获取前后虚拟节点树节点)---触发</strong><em><strong>patch</strong></em>(前后虚拟节点树节点)---根据!n2分成<strong>component</strong>组件类型or<strong>element</strong>元素类型</p><p><em><em>更新逻辑：<strong><em><strong>processXXX</strong></em>中n1存在---进入</strong></em>updateXXX</em>**(n1,n2)---取出新(n1&amp;n2)老(n2&amp;{})props---n2.el=n1.el---对比props(patchProps)---对比children(patchChild)双端对比算法实现</p></blockquote><h1 id="逐步搭建"><a href="#逐步搭建" class="headerlink" title="逐步搭建"></a>逐步搭建</h1><h2 id="初始化项目-搭建环境"><a href="#初始化项目-搭建环境" class="headerlink" title="初始化项目+搭建环境"></a>初始化项目+搭建环境</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm install --save-dev jest</span><br><span class="line">pnpm add typescript --save-dev</span><br><span class="line">npx tsc --init</span><br><span class="line">pnpm add --save-dev jest</span><br><span class="line">pnpm i --save-dev @types/node</span><br></pre></td></tr></table></figure><p><strong>替换 package.json &amp; tsconfig.json</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;jest&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&quot;types&quot;: [&quot;jest&quot;],</span><br><span class="line">&quot;noImplicitAny&quot;: false,//把any报错忽略掉</span><br></pre></td></tr></table></figure><p><strong>配置bable环境</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add --save-dev babel-jest @babel/core @babel/preset-env @babel/preset-typescript</span><br></pre></td></tr></table></figure><p><strong>根目录下创建一个</strong> <code>babel.config.js</code>文件</p><blockquote><p><strong>以当前node版本做一个转换 | 支持TS</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  presets: [</span><br><span class="line">    [&#x27;@babel/preset-env&#x27;, &#123;targets: &#123;node: &#x27;current&#x27;&#125;&#125;],</span><br><span class="line">    &#x27;@babel/preset-typescript&#x27;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>编写测试文件</strong></p><p><strong>reactivity / index.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function sum(a, b) &#123;</span><br><span class="line">    return a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>reactivity / tests / index.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;index&#x27;, () =&gt; &#123;</span><br><span class="line">    expect(1).toBe(1)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>单测运行</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm test</span><br></pre></td></tr></table></figure><h2 id="runtime-reactivity-响应式系统实现"><a href="#runtime-reactivity-响应式系统实现" class="headerlink" title="runtime-reactivity 响应式系统实现"></a>runtime-reactivity 响应式系统实现</h2><h3 id="编写单测"><a href="#编写单测" class="headerlink" title="编写单测"></a>编写单测</h3><h4 id="effect"><a href="#effect" class="headerlink" title="effect"></a>effect</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import &#123; effect &#125; from &#x27;../effect&#x27;</span><br><span class="line">import &#123; reactive &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;effect&#x27;, () =&gt; &#123;</span><br><span class="line">    it.skip(&#x27;effect&#x27;, () =&gt; &#123;</span><br><span class="line">        const user = reactive(&#123;// 响应式对象</span><br><span class="line">            age: 10,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        let nextAge</span><br><span class="line">        effect(() =&gt; &#123;//收集依赖 接收fn 触发get操作</span><br><span class="line">            nextAge = user.age + 1</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        expect(nextAge).toBe(11)</span><br><span class="line"></span><br><span class="line">        // update 触发set操作</span><br><span class="line">        user.age++</span><br><span class="line">        expect(nextAge).toBe(12)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h4><p><strong>reactivity / texts / reactive.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;reactive&#x27;, () =&gt; &#123;</span><br><span class="line">    it(&#x27;reactive&#x27;, () =&gt; &#123;</span><br><span class="line">        const original = &#123; age: 1 &#125;</span><br><span class="line">        const observed = reactive(original)</span><br><span class="line">        expect(observed).not.toBe(original)</span><br><span class="line">        expect(observed.age).toBe(1)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="实现reactive"><a href="#实现reactive" class="headerlink" title="实现reactive"></a>实现reactive</h3><p><strong>tsconfig.json</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;lib&quot;: [&quot;DOM&quot;,&quot;ES6&quot;], </span><br></pre></td></tr></table></figure><p><strong>reactivity / reactive.ts</strong></p><blockquote><p><strong>传入一个对象，返回一个Proxy对象，实现 get &amp; set 函数</strong></p><blockquote><p><strong>详解 假设对象为 { foo : 1 }</strong></p></blockquote><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target: &#123; foo : 1 &#125;</span><br><span class="line">key: foo</span><br><span class="line">value: 1</span><br></pre></td></tr></table></figure></blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">export function reactive(raw) &#123;</span><br><span class="line">    return new Proxy(raw, &#123;</span><br><span class="line">        get(target, key) &#123;</span><br><span class="line">            const res = Reflect.get(target, key)</span><br><span class="line"></span><br><span class="line">            // TODO:收集依赖</span><br><span class="line"></span><br><span class="line">            return res</span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br><span class="line">        set(target, key, value) &#123;</span><br><span class="line">            const res = Reflect.set(target, key, value)</span><br><span class="line">            </span><br><span class="line">            // TODO:触发依赖</span><br><span class="line"></span><br><span class="line">            return res</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>测试 pnpm test reactive</strong></p></blockquote><h3 id="实现effect"><a href="#实现effect" class="headerlink" title="实现effect"></a>实现effect</h3><p><strong>reactivity / effect.ts</strong></p><blockquote><p><strong>传入一个副作用函数fn，响应式数据发生变化时，重新执行fn</strong></p><blockquote><p>**封装类，将 **<code>_fn</code> 私有属性和 <code>run</code> 方法封装在一起，外部代码只能通过 <code>run</code> 方法来执行 <code>_fn</code>，隐藏内部实现细节，提高代码的安全性和可维护性</p></blockquote><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class ReactiveEffect &#123;</span><br><span class="line">private _fn: any</span><br><span class="line"> constructor(fn) &#123;</span><br><span class="line">     this._fn = fn</span><br><span class="line"> &#125;</span><br><span class="line"> run() &#123;</span><br><span class="line">     this._fn()</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export function effect(fn) &#123;</span><br><span class="line">    const _effect = new ReactiveEffect(fn)</span><br><span class="line"></span><br><span class="line">    _effect.run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>测试 pnpm test effect</strong></p></blockquote><h3 id="实现reactive-get"><a href="#实现reactive-get" class="headerlink" title="实现reactive-get"></a>实现reactive-get</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">get(target, key) &#123;</span><br><span class="line">    const res = Reflect.get(target, key)</span><br><span class="line"></span><br><span class="line">    track(target, key) //传入对象和key</span><br><span class="line"></span><br><span class="line">    return res</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="track-依赖收集"><a href="#track-依赖收集" class="headerlink" title="track 依赖收集"></a>track 依赖收集</h4><p><strong>reactivity / effect.ts</strong></p><blockquote><p><strong>构建一个容器，存储依赖</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const targetMap = new Map() // 存储依赖关系</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const targetMap = new Map() // 存所有依赖</span><br><span class="line">export function track(target, key) &#123;</span><br><span class="line">    let depsMap = targetMap.get(target)</span><br><span class="line">    if (!depsMap) &#123;</span><br><span class="line">        depsMap = new Map()</span><br><span class="line">        targetMap.set(target, depsMap)//targetMap结构[target&lt;obj&gt;, depsMap&lt;map&gt;]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let dep = depsMap.get(key)</span><br><span class="line">    if (!dep) &#123;</span><br><span class="line">        dep = new Set()</span><br><span class="line">        depsMap.set(key, dep)//depsMap结构[key&lt;key&gt;, dep&lt;ReactiveEffect&gt;]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dep.add(？)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>如何拿到fn</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//全局对象</span><br><span class="line">let activeEffect</span><br><span class="line"></span><br><span class="line">//ReactiveEffect类内</span><br><span class="line">run() &#123;</span><br><span class="line">    activeEffect = this</span><br><span class="line">    this._fn()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//传入effect</span><br><span class="line">dep.add(activeEffect)</span><br></pre></td></tr></table></figure><h3 id="实现reactive-set"><a href="#实现reactive-set" class="headerlink" title="实现reactive-set"></a>实现reactive-set</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">set(target, key, value) &#123;</span><br><span class="line">    const res = Reflect.set(target, key, value)</span><br><span class="line"></span><br><span class="line">    trigger(target, key) //传入对象和key</span><br><span class="line">    </span><br><span class="line">    return res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="trigger-依赖触发"><a href="#trigger-依赖触发" class="headerlink" title="trigger 依赖触发"></a>trigger 依赖触发</h4><p><strong>reactivity / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">export function trigger(target, key) &#123;</span><br><span class="line">    let depsMap = targetMap.get(target)</span><br><span class="line">    if (!depsMap) &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let dep = depsMap.get(key)</span><br><span class="line">    if (!dep) &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dep.forEach((effect) =&gt; &#123;</span><br><span class="line">        effect.run()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>测试 pnpm test effect</strong></p></blockquote><h3 id="完善effect功能"><a href="#完善effect功能" class="headerlink" title="完善effect功能"></a>完善effect功能</h3><h4 id="功能单测1"><a href="#功能单测1" class="headerlink" title="功能单测1"></a>功能单测1</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;返回runner可以触发effect&#x27;, () =&gt; &#123;</span><br><span class="line">    let foo = 10</span><br><span class="line">    const runner = effect(() =&gt; &#123;</span><br><span class="line">        foo++</span><br><span class="line">        return foo</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    expect(foo).toBe(11)//创建effect - foo++</span><br><span class="line">    const r = runner()//调用runner - foo++</span><br><span class="line">    expect(foo).toBe(12)</span><br><span class="line">    expect(r).toBe(foo)//调用runner - foo++</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>修改effect逻辑</strong></p><p><em>实现创建实例时run一次</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export function effect(fn) &#123;</span><br><span class="line">const _effect = new ReactiveEffect(fn)</span><br><span class="line"></span><br><span class="line">_effect.run() //先执行一次</span><br><span class="line"></span><br><span class="line">    return _effect.run.bind(_effect)//返回run函数并绑定this</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">run() &#123;</span><br><span class="line">    activeEffect = this</span><br><span class="line">    return this._fn()//返回值</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>**Tips：有关 *****.bind(...)***</p><p>**直接返回 **<code>_effect.run</code> 会让 <code>run</code> 方法在调用时 <code>this</code> 指向出现问题，可能导致 <code>this._fn()</code> 无法正常执行。</p><p><em>例子</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">class ReactiveEffect &#123;</span><br><span class="line">private _fn: any;</span><br><span class="line">constructor(fn) &#123;</span><br><span class="line">this._fn = fn;</span><br><span class="line">&#125;</span><br><span class="line">run() &#123;</span><br><span class="line">console.log(&#x27;this:&#x27;, this);</span><br><span class="line">this._fn();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function effectWithBind(fn) &#123;// 返回 _effect.run.bind(_effect)</span><br><span class="line">const _effect = new ReactiveEffect(fn);</span><br><span class="line">_effect.run();</span><br><span class="line">return _effect.run.bind(_effect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function effectWithoutBind(fn) &#123;// 返回 _effect.run</span><br><span class="line">const _effect = new ReactiveEffect(fn);</span><br><span class="line">_effect.run();</span><br><span class="line">return _effect.run;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const boundRun = effectWithBind(f);// 使用 effectWithBind</span><br><span class="line">boundRun(); // this 指向 _effect 实例</span><br><span class="line"></span><br><span class="line">const unboundRun = effectWithoutBind(f);// 使用 effectWithoutBind</span><br><span class="line">unboundRun(); // this 指向全局对象（在浏览器中是 window）</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><strong>测试 pnpm test effect</strong></p></blockquote><h4 id="功能单测2"><a href="#功能单测2" class="headerlink" title="功能单测2"></a>功能单测2</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">it.skip(&quot;scheduler&quot;, () =&gt; &#123;</span><br><span class="line">    // 1. 通过 effect 的第二个参数给定一个 scheduler 的 fn</span><br><span class="line">    // 2. effect 第一次执行的时候 还会执行 fn</span><br><span class="line">    // 3. 当 响应式对象 set update 不会执行 fn 而是执行 scheduler</span><br><span class="line">    // 4. 如果说当执行 runner 的时候 会再次执行 fn</span><br><span class="line">    let dummy</span><br><span class="line">    let run: any</span><br><span class="line">    const scheduler = jest.fn(() =&gt; &#123;</span><br><span class="line">        run = runner</span><br><span class="line">    &#125;)</span><br><span class="line">    const obj = reactive(&#123; foo: 1 &#125;)</span><br><span class="line">    const runner = effect(() =&gt; </span><br><span class="line">&#123; dummy = obj.foo &#125;,</span><br><span class="line">&#123; scheduler &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    expect(scheduler).not.toHaveBeenCalled()//scheduler不会被调用</span><br><span class="line">    expect(dummy).toBe(1)</span><br><span class="line"></span><br><span class="line">    //当响应式对象set时调用scheduler,但不会执行fn</span><br><span class="line">    obj.foo++</span><br><span class="line">    expect(scheduler).toHaveBeenCalledTimes(1)</span><br><span class="line">    expect(dummy).toBe(1)</span><br><span class="line"></span><br><span class="line">    //调用runner时执行fn</span><br><span class="line">    run()</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>更新effect函数</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">constructor(fn, public scheduler?) &#123;//拿到可选参数scheduler</span><br><span class="line">    this._fn = fn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function effect(fn, options: any = &#123;&#125;) &#123;</span><br><span class="line">    const scheduler = options.scheduler//拿到scheduler</span><br><span class="line">    const _effect = new ReactiveEffect(fn, scheduler)//给类传入scheduler</span><br><span class="line"></span><br><span class="line">    _effect.run()</span><br><span class="line">    return _effect.run.bind(_effect)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>修改更新函数trigger逻辑</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dep.forEach((effect) =&gt; &#123;</span><br><span class="line">    if (effect.scheduler) &#123;</span><br><span class="line">        effect.scheduler()</span><br><span class="line">        return</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        effect.run()</span><br><span class="line">    &#125;</span><br><span class="line">    effect.run()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test effect</strong></p></blockquote><h4 id="功能单测3"><a href="#功能单测3" class="headerlink" title="功能单测3"></a>功能单测3</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">it(&quot;stop的执行逻辑&quot;, () =&gt; &#123;</span><br><span class="line">    let dummy</span><br><span class="line">    const obj = reactive(&#123; prop: 1 &#125;)</span><br><span class="line">    const runner = effect(() =&gt; &#123;</span><br><span class="line">        dummy = obj.prop</span><br><span class="line">    &#125;)</span><br><span class="line">    obj.prop = 2</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line"></span><br><span class="line">    stop(runner)//停止执行runner</span><br><span class="line"></span><br><span class="line">    obj.prop = 3</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line"></span><br><span class="line">    runner()</span><br><span class="line">    expect(dummy).toBe(3)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>reactivity / effect.ts</strong></p><p><strong>实现stop代码</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function stop(runner) &#123;</span><br><span class="line">    runner.effect.stop()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>修改effect函数</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export function effect(fn, options: any = &#123;&#125;) &#123;</span><br><span class="line">    const scheduler = options.scheduler</span><br><span class="line">    const _effect = new ReactiveEffect(fn, scheduler)</span><br><span class="line"></span><br><span class="line">    _effect.run()</span><br><span class="line"></span><br><span class="line">    const runner: any = _effect.run.bind(_effect) //定义runner函数并绑定this</span><br><span class="line">    runner.effect = _effect //将effect挂载到runner上</span><br><span class="line"></span><br><span class="line">    return runner</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>track（依赖收集）函数添加逻辑</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dep.add(activeEffect)</span><br><span class="line">activeEffect.deps.push(dep)</span><br></pre></td></tr></table></figure><p><strong>修改effect类 | 添加stop函数</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public deps = []</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    this.deps.forEach((dep:any) =&gt; &#123;</span><br><span class="line">        dep.delete(this)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test effect --watch</strong></p></blockquote><p><strong>代码优化（抽离清除逻辑 &amp; 防抖）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">active = true</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    if (this.active) &#123;</span><br><span class="line">        cleanupEffect(this)</span><br><span class="line">        this.active = false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function cleanupEffect(effect) &#123;</span><br><span class="line">    effect.deps.forEach((dep: any) =&gt; &#123;</span><br><span class="line">        dep.delete(effect)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="功能单测4"><a href="#功能单测4" class="headerlink" title="功能单测4"></a>功能单测4</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;onStop的执行逻辑&#x27;, () =&gt; &#123;</span><br><span class="line">    const obj = reactive(&#123;</span><br><span class="line">        foo: 1,</span><br><span class="line">    &#125;)</span><br><span class="line">    const onStop = jest.fn()//jest.fn() 创建一个模拟函数 onStop，用于记录其调用次数和参数</span><br><span class="line">    let dummy</span><br><span class="line">    const runner = effect(</span><br><span class="line">        () =&gt; &#123;</span><br><span class="line">            dummy = obj.foo//响应式对象</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            onStop,//选项对象</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    stop(runner)</span><br><span class="line">    expect(onStop).toBeCalledTimes(1)//验证 onStop 函数是否被调用了一次</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>reactivity / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//_effect.onStop = options.onStop//调用类方法</span><br><span class="line">//Object.assign(_effect, options)//调用类方法(优化)</span><br><span class="line">extend(_effect, options)//调用类方法(抽离封装)</span><br></pre></td></tr></table></figure><blockquote><p><strong>Tip：二者区别</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 假设 options 对象如下</span><br><span class="line">const options = &#123;</span><br><span class="line">onStop: () =&gt; console.log(&#x27;Effect stopped&#x27;),</span><br><span class="line">someOtherOption: &#x27;value&#x27;</span><br><span class="line">&#125;;</span><br><span class="line">const _effect = new ReactiveEffect(() =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 仅赋值 onStop 属性</span><br><span class="line">_effect.onStop = options.onStop;</span><br><span class="line"></span><br><span class="line">console.log(_effect.onStop); // 输出: () =&gt; console.log(&#x27;Effect stopped&#x27;)</span><br><span class="line">console.log(_effect.someOtherOption); // 输出: undefined</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 复制 options 对象的所有属性到 _effect</span><br><span class="line">Object.assign(_effect, options);</span><br><span class="line"></span><br><span class="line">console.log(_effect.onStop); // 输出: () =&gt; console.log(&#x27;Effect stopped&#x27;)</span><br><span class="line">console.log(_effect.someOtherOption); // 输出: &#x27;value&#x27;</span><br></pre></td></tr></table></figure></blockquote><p><strong>继续抽离函数</strong></p><p><strong>src / shared (放置通用的工具函数) / index.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export const extend = Object.assign</span><br></pre></td></tr></table></figure><p><strong>修改类</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">onStop?: () =&gt; void</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    if (this.active) &#123;</span><br><span class="line">        cleanupEffect(this)</span><br><span class="line">        if (this.onStop) &#123;</span><br><span class="line">            this.onStop()</span><br><span class="line">        &#125;</span><br><span class="line">        this.active = false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现readonly功能"><a href="#实现readonly功能" class="headerlink" title="实现readonly功能"></a>实现readonly功能</h3><h4 id="编写单测-1"><a href="#编写单测-1" class="headerlink" title="编写单测"></a>编写单测</h4><p><strong>readonly.spec.ts</strong></p><blockquote><p><strong>只读属性只能读取set不能被改写set</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import &#123; readonly &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;readonly&#x27;, () =&gt; &#123;</span><br><span class="line">it(&#x27;readonly&#x27;, () =&gt; &#123;</span><br><span class="line">const original = &#123; foo: 1 &#125;</span><br><span class="line">const wrapped = readonly(original)</span><br><span class="line">expect(wrapped).not.toBe(original) //返回一个新对象，而非返回原对象</span><br><span class="line">expect(wrapped.foo).toBe(1)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">it(&#x27;warning when call set&#x27;, () =&gt; &#123;</span><br><span class="line">console.warn = jest.fn()</span><br><span class="line">const user = readonly(&#123;</span><br><span class="line">age: 10,</span><br><span class="line">&#125;)</span><br><span class="line">user.age = 11</span><br><span class="line">expect(console.warn).toBeCalled()//调用了console.warn</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>reactive</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export function readonly(raw) &#123;</span><br><span class="line">    return new Proxy(raw, &#123;</span><br><span class="line">        get(target, key) &#123;</span><br><span class="line">            return Reflect.get(target, key)</span><br><span class="line">        &#125;,</span><br><span class="line">        set(target, key, value) &#123;</span><br><span class="line">            console.warn(`key: $&#123;key&#125; set 失败，因为 target 是 readonly 的`, target)</span><br><span class="line">            return true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>抽离 get &amp; set 函数</strong></p><p><strong>createGetter</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function createGetter(isReadonly = false, shallow = false) &#123;</span><br><span class="line">    return function get(target, key) &#123;//返回一个get函数</span><br><span class="line">        const res = Reflect.get(target, key)</span><br><span class="line">        if (!isReadonly) &#123;</span><br><span class="line">            track(target, key)</span><br><span class="line">        &#125;</span><br><span class="line">        if (shallow) &#123;</span><br><span class="line">            return res</span><br><span class="line">        &#125;</span><br><span class="line">        if (typeof res === &#x27;object&#x27;) &#123;</span><br><span class="line">            return isReadonly ? readonly(res) : reactive(res)</span><br><span class="line">        &#125;</span><br><span class="line">        return res</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>createSetter</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function createSetter(shallow = false) &#123;</span><br><span class="line">    return function set(target, key, value) &#123;</span><br><span class="line">        const res = Reflect.set(target, key, value)</span><br><span class="line">        trigger(target, key)</span><br><span class="line">        return res</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>改写函数</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">export function reactive(raw) &#123;</span><br><span class="line">    return new Proxy(raw, &#123;</span><br><span class="line">        get: createGetter(),</span><br><span class="line">        set: createSetter(),</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function readonly(raw) &#123;</span><br><span class="line">    return new Proxy(raw, &#123;</span><br><span class="line">        get: createGetter(true),</span><br><span class="line">        set(target, key, value) &#123;</span><br><span class="line">            console.warn(`key: $&#123;key&#125; set 失败，因为 target 是 readonly 的`, target)</span><br><span class="line">            return true</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>继续优化抽离组件</strong></p><p><strong>创建 baseHanders.ts | 封装get逻辑</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import &#123; track, trigger &#125; from &#x27;./effect&#x27;</span><br><span class="line"></span><br><span class="line">function createGetter(isReadonly = false) &#123;</span><br><span class="line">return function get(target, key) &#123;</span><br><span class="line">const res = Reflect.get(target, key)</span><br><span class="line">if (!isReadonly) &#123;</span><br><span class="line">track(target, key)</span><br><span class="line">&#125;</span><br><span class="line">return res</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function createSetter() &#123;</span><br><span class="line">return function set(target, key, value) &#123;</span><br><span class="line">const res = Reflect.set(target, key, value)</span><br><span class="line">trigger(target, key)</span><br><span class="line">return res</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const reactiveHandlers = &#123;</span><br><span class="line">get: createGetter(),</span><br><span class="line">set: createSetter(),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const readonlyHandlers = &#123;</span><br><span class="line">get: createGetter(true),</span><br><span class="line">set(target, key, value) &#123;</span><br><span class="line">console.warn(`key: $&#123;key&#125; set 失败，因为 target 是 readonly 的`, target)</span><br><span class="line">return true</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>重构 reactive &amp; readonly</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactiveHandlers, readonlyHandlers &#125; from &#x27;./baseHanders&#x27;</span><br><span class="line"></span><br><span class="line">function createActiveEffect(raw: any, baseHanders) &#123;</span><br><span class="line">return new Proxy(raw, baseHanders)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function reactive(raw) &#123;</span><br><span class="line">return createActiveEffect(raw, reactiveHandlers)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function readonly(raw) &#123;</span><br><span class="line">return createActiveEffect(raw, readonlyHandlers)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>为 createGetter 添加缓存机制</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const get = createGetter()</span><br><span class="line">const set = createSetter()</span><br><span class="line">const readonlyGet = createGetter(true)</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test readonly --watch</strong></p></blockquote><h3 id="实现-isReactive-isReadonly-功能"><a href="#实现-isReactive-isReadonly-功能" class="headerlink" title="实现 isReactive &amp; isReadonly 功能"></a>实现 isReactive &amp; isReadonly 功能</h3><h4 id="编写单测-2"><a href="#编写单测-2" class="headerlink" title="编写单测"></a>编写单测</h4><p><strong>reactive.spec.ts</strong></p><blockquote><p>**判断传入的 **<code>value</code> 是否为响应式对象</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;reactive&#x27;, () =&gt; &#123;</span><br><span class="line">    const original = &#123; age: 1 &#125;</span><br><span class="line">    const observed = reactive(original)</span><br><span class="line">    expect(observed).not.toBe(original)</span><br><span class="line">    expect(observed.age).toBe(1)</span><br><span class="line"></span><br><span class="line">    //判断是否是响应式对象</span><br><span class="line">    expect(isReactive(observed)).toBe(true)</span><br><span class="line">    expect(isReactive(original)).toBe(false)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>readonly.spec.ts</strong></p><blockquote><p><strong>判断是否是只读对象</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;readonly&#x27;, () =&gt; &#123;</span><br><span class="line">    const original = &#123; foo: 1 &#125;</span><br><span class="line">    const wrapped = readonly(original)</span><br><span class="line">    expect(wrapped).not.toBe(original) //返回一个新对象，而非返回原对象</span><br><span class="line">    expect(wrapped.foo).toBe(1)</span><br><span class="line"></span><br><span class="line">    expect(isReadonly(wrapped)).toBe(true)//判断是否是只读对象</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="功能实现"><a href="#功能实现" class="headerlink" title="功能实现"></a>功能实现</h4><p><strong>createGetter拦截判断</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function createGetter(isReadonly = false) &#123;</span><br><span class="line">return function get(target, key) &#123;</span><br><span class="line"></span><br><span class="line">if (key === ReactiveFlags.IS_REACTIVE) &#123;//判断是否是响应式对象</span><br><span class="line">return !isReadonly</span><br><span class="line">&#125;else if (key === ReactiveFlags.IS_READONLY) &#123;//判断是否是只读对象</span><br><span class="line">return isReadonly</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const res = Reflect.get(target, key)</span><br><span class="line">if (!isReadonly) &#123;</span><br><span class="line">track(target, key)</span><br><span class="line">&#125;</span><br><span class="line">return res</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>reactive.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export const enum ReactiveFlags &#123;</span><br><span class="line">IS_REACTIVE = &#x27;__v_isReactive&#x27;,</span><br><span class="line">IS_READONLY = &#x27;__v_isReadonly&#x27;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function isReactive(value) &#123;//判断是否是响应式对象</span><br><span class="line">    return !!value[ReactiveFlags.IS_REACTIVE]</span><br><span class="line">&#125;</span><br><span class="line">export function isReadonly(value) &#123;//判断是否是只读对象</span><br><span class="line">    return !!value[ReactiveFlags.IS_READONLY]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test readonly --watch</strong></p><p><strong>pnpm test reactive --watch</strong></p></blockquote><h3 id="stop功能优化"><a href="#stop功能优化" class="headerlink" title="stop功能优化"></a>stop功能优化</h3><h4 id="当前bug"><a href="#当前bug" class="headerlink" title="当前bug"></a>当前bug</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">it(&quot;stop的执行逻辑&quot;, () =&gt; &#123;</span><br><span class="line">    let dummy</span><br><span class="line">    const obj = reactive(&#123; prop: 1 &#125;)</span><br><span class="line">    const runner = effect(() =&gt; &#123;</span><br><span class="line">        dummy = obj.prop</span><br><span class="line">    &#125;)</span><br><span class="line">    obj.prop = 2</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line"></span><br><span class="line">    stop(runner)//停止执行runner</span><br><span class="line"></span><br><span class="line">    // obj.prop = 3 只涉及set操作</span><br><span class="line">    obj.prop++ //触发 get+set</span><br><span class="line">    </span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line"></span><br><span class="line">    runner()</span><br><span class="line">    expect(dummy).toBe(3)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><strong>stop(runner)会根据该响应式对象中active的状态清除它的已经收集的所有依赖</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">effect.deps.forEach((dep: any) =&gt; &#123;</span><br><span class="line">dep.delete(effect)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>**+1触发get操作一定会触发track操作重新收集依赖 **</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dep.add(activeEffect)//之前的依赖都白清了</span><br></pre></td></tr></table></figure><p><strong>所以stop函数之后的操作不应该收集依赖（不能触发track操作）</strong></p></blockquote><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p><strong>track添加逻辑</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if(!activeEffect || !shouldTrack)&#123;//如果没有激活的effect或者shouldTrack为false，直接返回</span><br><span class="line">    return  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//...收集依赖</span><br><span class="line"></span><br><span class="line">if (dep.has(activeEffect)) &#123;</span><br><span class="line">    return</span><br><span class="line">&#125;</span><br><span class="line">dep.add(activeEffect)</span><br><span class="line">activeEffect.deps.push(dep)</span><br></pre></td></tr></table></figure><p><strong>修改run函数（stop根据active状态区分）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">run() &#123;</span><br><span class="line">    if (!this.active) &#123; // stop状态直接返回fn</span><br><span class="line">        return this._fn()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    shouldTrack = true // 允许进行依赖收集</span><br><span class="line">    activeEffect = this</span><br><span class="line"></span><br><span class="line">    const res = this._fn() // this._fn() 执行，期间访问响应式对象的属性，触发track依赖收集</span><br><span class="line"></span><br><span class="line">    shouldTrack = false // 依赖收集结束，后续操作不会再触发依赖收集。</span><br><span class="line"></span><br><span class="line">    return res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>cleanupEffect添加逻辑</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">effect.deps.length = 0</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test reactive --watch</strong></p></blockquote><h3 id="嵌套响应式转换"><a href="#嵌套响应式转换" class="headerlink" title="嵌套响应式转换"></a>嵌套响应式转换</h3><h4 id="编写单测-3"><a href="#编写单测-3" class="headerlink" title="编写单测"></a>编写单测</h4><p><strong>reactive</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;嵌套响应式对象转换&#x27;, () =&gt; &#123;</span><br><span class="line">    const original = &#123;</span><br><span class="line">        nested: &#123;</span><br><span class="line">            foo: 1</span><br><span class="line">        &#125;,</span><br><span class="line">        array: [&#123; bar: 2 &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">    const observed = reactive(original)</span><br><span class="line">    expect(isReactive(observed.nested)).toBe(true)</span><br><span class="line">    expect(isReactive(observed.array)).toBe(true)</span><br><span class="line">    expect(isReactive(observed.array[0])).toBe(true) </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>readonly</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;readonly&#x27;, () =&gt; &#123;</span><br><span class="line">    const original = &#123; foo: 1, bar: &#123; baz: 2 &#125; &#125;</span><br><span class="line">    const wrapped = readonly(original)</span><br><span class="line"></span><br><span class="line">    expect(wrapped).not.toBe(original) //返回一个新对象，而非返回原对象</span><br><span class="line">    expect(wrapped.foo).toBe(1)</span><br><span class="line"></span><br><span class="line">    expect(isReadonly(original)).toBe(false)</span><br><span class="line">    expect(isReadonly(original.bar)).toBe(false)</span><br><span class="line">    expect(isReadonly(wrapped)).toBe(true)//只读</span><br><span class="line">    expect(isReadonly(wrapped.bar)).toBe(true)//只读</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>baseHanders.ts 递归拦截</strong></p><blockquote><p><strong>createGetter函数</strong></p><p>**const res = Reflect.get(**<em>target</em>, <em>key</em>)后添加判断</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (isObject(res)) &#123;//判断是否是对象</span><br><span class="line">    return isReadonly ? readonly(res) : reactive(res)//返回只读对象或者响应式对象</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>shared / index.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export const isObject = (val) =&gt; &#123;</span><br><span class="line">    return val !== null &amp;&amp; typeof val === &#x27;object&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="shallowReadonly工具函数"><a href="#shallowReadonly工具函数" class="headerlink" title="shallowReadonly工具函数"></a>shallowReadonly工具函数</h3><h4 id="编写单测-4"><a href="#编写单测-4" class="headerlink" title="编写单测"></a>编写单测</h4><p><strong>shallowReadonly.spec.ts</strong></p><blockquote><p><strong>数据展示:确保外层数据不会被意外修改，同时允许在必要时修改嵌套对象</strong></p><p><strong>性能优化:避免对所有嵌套对象进行只读处理</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; isReadonly, shallowReadonly &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;shallowReadonly&#x27;, () =&gt; &#123;</span><br><span class="line">    it(&#x27;shallowReadonly&#x27;, () =&gt; &#123;</span><br><span class="line">        const props = shallowReadonly(&#123; n: &#123; foo: 1 &#125; &#125;)</span><br><span class="line">        expect(isReadonly(props)).toBe(true)//表层只读</span><br><span class="line">        expect(isReadonly(props.n)).toBe(false)//内部正常</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="功能实现-1"><a href="#功能实现-1" class="headerlink" title="功能实现"></a>功能实现</h4><p><strong>reactive.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function shallowReadonly(raw) &#123;</span><br><span class="line">    return createActiveEffect(raw, shallowReadonlyHandlers)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>baseHanders.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const readonlyGet = createGetter(true)</span><br><span class="line">const shallowReadonlyGet = createGetter(true, true)</span><br></pre></td></tr></table></figure><p><strong>createGetter改写</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function createGetter(isReadonly = false, shallow = false)</span><br><span class="line"></span><br><span class="line">if (shallow) &#123;</span><br><span class="line">    return res</span><br><span class="line">&#125;</span><br><span class="line">//👇判断isObject前拦截👆//</span><br><span class="line">if (isObject(res)) &#123;//判断是否是对象</span><br><span class="line">    return isReadonly ? readonly(res) : reactive(res) //返回只读对象或者响应式对象</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>继承改写自readonlyHandlers</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export const shallowReadonlyHandlers = extend(&#123;&#125;, readonlyHandlers, &#123;</span><br><span class="line">    get: shallowReadonlyGet,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="实现isProxy功能"><a href="#实现isProxy功能" class="headerlink" title="实现isProxy功能"></a>实现isProxy功能</h3><h4 id="编写单测-5"><a href="#编写单测-5" class="headerlink" title="编写单测"></a>编写单测</h4><blockquote><p><strong>判断是否是代理对象</strong></p></blockquote><p><strong>reactive &amp; readonly 分别添加</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(isProxy(observed)).toBe(true)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(isProxy(wrapped)).toBe(true)</span><br></pre></td></tr></table></figure><h4 id="功能实现-2"><a href="#功能实现-2" class="headerlink" title="功能实现"></a>功能实现</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function isProxy(value) &#123; //判断是否是代理对象</span><br><span class="line">    return isReactive(value) || isReadonly(value)   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现ref"><a href="#实现ref" class="headerlink" title="实现ref"></a>实现ref</h3><h4 id="必看：ref与-reactive区别"><a href="#必看：ref与-reactive区别" class="headerlink" title="必看：ref与 reactive区别"></a>必看：<code>ref</code>与 <code>reactive</code>区别</h4><table><thead><tr><th><strong>reactive</strong></th><th><strong>ref</strong></th></tr></thead><tbody><tr><td><strong>❌只支持****对象</strong>和<strong>数组</strong>(引用数据类型)</td><td><strong>✅支持基本数据类型+引用数据类型</strong></td></tr><tr><td><strong>❌重新分配一个新对象会丢失响应性</strong></td><td><strong>✅重新分配一个新对象****不会</strong>失去响应</td></tr><tr><td><strong>❌将对象传入函数时,失去响应</strong></td><td><strong>✅传入函数时,不会失去响应</strong></td></tr><tr><td><strong>能直接访问属性</strong></td><td><strong>需要使用</strong> <code>.value</code>访问属性</td></tr><tr><td><strong>✅在</strong> <code>&lt;script&gt;</code>和 <code>&lt;template&gt;</code>中无差别使用</td><td><strong>❌在</strong> <code>&lt;script&gt;</code>和 <code>&lt;template&gt;</code>使用方式不同(script中要 <code>.value</code>)</td></tr><tr><td><strong>❌解构时会丢失响应性,需使用toRefs</strong></td><td><strong>❌解构对象时会丢失响应性,需使用toRefs</strong></td></tr></tbody></table><blockquote><p><strong>ref只传单值，不能使用Proxy(Proxy对对象起作用)</strong></p><p><strong>ref中的任何一个点key都要对应一个dep，get&amp;set进行依赖收集和触发</strong></p></blockquote><h4 id="功能单测1-1"><a href="#功能单测1-1" class="headerlink" title="功能单测1"></a>功能单测1</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; effect &#125; from &#x27;../effect&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;../ref&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;ref&#x27;, () =&gt; &#123;</span><br><span class="line">    it.only(&#x27;value&#x27;, () =&gt; &#123;</span><br><span class="line">        const a = ref(1)</span><br><span class="line">        expect(a.value).toBe(1)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>ref.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class RefImpl &#123;</span><br><span class="line">    private _value: any;</span><br><span class="line">    constructor(value) &#123;//构造函数</span><br><span class="line">        this._value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get value() &#123;//获取value</span><br><span class="line">        return this._value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // set value() &#123;</span><br><span class="line"></span><br><span class="line">    // &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function ref(value) &#123;</span><br><span class="line">    return new RefImpl(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="功能单测2-1"><a href="#功能单测2-1" class="headerlink" title="功能单测2"></a>功能单测2</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;should be reactive&#x27;, () =&gt; &#123;</span><br><span class="line">    const a = ref(1)</span><br><span class="line">    let dummy</span><br><span class="line">    let calls = 0</span><br><span class="line">    effect(() =&gt; &#123;</span><br><span class="line">        calls++</span><br><span class="line">        dummy = a.value</span><br><span class="line">    &#125;)</span><br><span class="line">    expect(calls).toBe(1)//effect执行了一次</span><br><span class="line">    expect(dummy).toBe(1)</span><br><span class="line">    a.value = 2</span><br><span class="line">    expect(calls).toBe(2)</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line">    // 值相同不会触发</span><br><span class="line">    a.value = 2</span><br><span class="line">    expect(calls).toBe(2)</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>ref.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">class RefImpl &#123;</span><br><span class="line">    private _value: any //值</span><br><span class="line">    public dep //依赖就是唯一的value</span><br><span class="line">    constructor(value) &#123;</span><br><span class="line">        //构造函数</span><br><span class="line">        this._value = value //存储值</span><br><span class="line">        this.dep = new Set() //存储依赖</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get value() &#123;</span><br><span class="line">        //获取value</span><br><span class="line">        return this._value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    set value(newValue) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function ref(value) &#123;</span><br><span class="line">    return new RefImpl(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>回到effect抽离 get &amp; set 逻辑代码复用</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">trackEffects(dep)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function trackEffects(dep) &#123;</span><br><span class="line">    if (dep.has(activeEffect)) &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    dep.add(activeEffect)</span><br><span class="line">    activeEffect.deps.push(dep)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">triggerEffects(dep)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function triggerEffects(dep) &#123; </span><br><span class="line">dep.forEach((effect) =&gt; &#123;</span><br><span class="line">if (effect.scheduler) &#123;</span><br><span class="line">effect.scheduler()</span><br><span class="line">return</span><br><span class="line">&#125; else &#123;</span><br><span class="line">effect.run()</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ref.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">get value() &#123;</span><br><span class="line">    trackEffects(this.dep) //收集依赖</span><br><span class="line">    return this._value //获取value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">set value(newValue) &#123;</span><br><span class="line">    this._value = newValue //设置value</span><br><span class="line">    triggerEffects(this.dep) //触发依赖</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>实现赋值相同不触发effect功能</strong></p><p><strong>set value添加</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(Object.is(newValue,this._value)) return //如果新值和旧值相等，直接返回</span><br></pre></td></tr></table></figure><p><strong>抽离封装成工具函数</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function trackRefValue(ref) &#123;</span><br><span class="line">    if (isTracking()) &#123;</span><br><span class="line">        trackEffects(ref.dep)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export const hasChange = (val, newValue) =&gt; &#123;</span><br><span class="line">    return !Object.is(val, newValue)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>get &amp; set value改写</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get value() &#123;</span><br><span class="line">    trackRefValue(this) //收集依赖</span><br><span class="line">    return this._value //获取value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set value(newValue) &#123;</span><br><span class="line">    if (hasChange(newValue, this._value)) &#123;//判断是否有变化</span><br><span class="line">        this._value = newValue //设置value</span><br><span class="line">        triggerEffects(this.dep) //触发依赖</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="功能单测3-1"><a href="#功能单测3-1" class="headerlink" title="功能单测3"></a>功能单测3</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;嵌套响应&#x27;, () =&gt; &#123;</span><br><span class="line">    const a = ref(&#123;</span><br><span class="line">        count: 1,</span><br><span class="line">    &#125;)</span><br><span class="line">    let dummy</span><br><span class="line">    effect(() =&gt; &#123;</span><br><span class="line">        dummy = a.value.count</span><br><span class="line">    &#125;)</span><br><span class="line">    expect(dummy).toBe(1)</span><br><span class="line">    a.value.count = 2</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><strong>要实现嵌套就设计递归嘛</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">private _value: any //值</span><br><span class="line">public dep //依赖就是唯一的value</span><br><span class="line">private _rawValue: any //原始值</span><br><span class="line">constructor(value) &#123;</span><br><span class="line">    this._rawValue = value</span><br><span class="line">    this._value = isObject(value) ? reactive(value) : value //如果是对象，就递归</span><br><span class="line">    this.dep = new Set() //存储依赖</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">set value(newValue) &#123;</span><br><span class="line">    if (hasChange(newValue, this._rawValue)) &#123;</span><br><span class="line">        //判断是否有变化</span><br><span class="line">        this._rawValue = newValue</span><br><span class="line">        this._value = isObject(newValue) ? reactive(newValue) : newValue</span><br><span class="line">        triggerEffects(this.dep) //触发依赖</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>继续优化</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">private _rawValue: any //原始值</span><br><span class="line"></span><br><span class="line">set value(newValue) &#123;</span><br><span class="line">    if (hasChange(newValue, this._rawValue)) &#123;</span><br><span class="line">        //判断是否有变化</span><br><span class="line">        this._rawValue = newValue</span><br><span class="line">        this._value = convert(newValue) //如果是对象，就递归</span><br><span class="line">        triggerEffects(this.dep) //触发依赖</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function convert(value) &#123;</span><br><span class="line">    return isObject(value) ? reactive(value) : value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现isRef"><a href="#实现isRef" class="headerlink" title="实现isRef"></a>实现isRef</h3><h4 id="编写单测-6"><a href="#编写单测-6" class="headerlink" title="编写单测"></a>编写单测</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;isRef&#x27;, () =&gt; &#123;</span><br><span class="line">    const a = ref(1)</span><br><span class="line">    const user = &#123;</span><br><span class="line">        age: a,</span><br><span class="line">    &#125;</span><br><span class="line">    expect(isRef(a)).toBe(true)</span><br><span class="line">    expect(isRef(1)).toBe(false)</span><br><span class="line">    expect(isRef(user)).toBe(false)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="功能实现-3"><a href="#功能实现-3" class="headerlink" title="功能实现"></a>功能实现</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public __v_isRef = true //标识是否是ref</span><br><span class="line"></span><br><span class="line">export function isRef(ref) &#123;</span><br><span class="line">    return !!ref.__v_isRef//转换为布尔值</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现unRef"><a href="#实现unRef" class="headerlink" title="实现unRef"></a>实现unRef</h3><blockquote><p><strong>如果参数是 ref，则返回内部值，否则返回参数本身</strong></p></blockquote><h4 id="编写单测-7"><a href="#编写单测-7" class="headerlink" title="编写单测"></a>编写单测</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;unRef&#x27;, () =&gt; &#123;//</span><br><span class="line">    const a = ref(1)</span><br><span class="line">    expect(unRef(a)).toBe(1)</span><br><span class="line">    expect(unRef(1)).toBe(1)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="功能实现-4"><a href="#功能实现-4" class="headerlink" title="功能实现"></a>功能实现</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function unRef(ref) &#123;</span><br><span class="line">    return isRef(ref) ? ref.value : ref //如果是ref，就返回value，否则返回原对象   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现proxyRefs"><a href="#实现proxyRefs" class="headerlink" title="实现proxyRefs (?)"></a>实现proxyRefs (?)</h3><h4 id="编写单测-8"><a href="#编写单测-8" class="headerlink" title="编写单测"></a>编写单测</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;proxyRefs&#x27;, () =&gt; &#123;</span><br><span class="line">    const user = &#123;</span><br><span class="line">        age: ref(10),</span><br><span class="line">        name: &#x27;zf&#x27;,</span><br><span class="line">    &#125;</span><br><span class="line">    const proxyUser = proxyRefs(user)</span><br><span class="line">    expect(user.age.value).toBe(10)</span><br><span class="line">    expect(proxyUser.age).toBe(10)//可以省略.value</span><br><span class="line">    expect(proxyUser.name).toBe(&#x27;zf&#x27;)//可以省略.value</span><br><span class="line"></span><br><span class="line">    proxyUser.age = 20</span><br><span class="line">    expect(proxyUser.age).toBe(20)</span><br><span class="line">    expect(user.age.value).toBe(20)</span><br><span class="line"></span><br><span class="line">    proxyUser.age = ref(10)</span><br><span class="line">    expect(proxyUser.age).toBe(10)</span><br><span class="line">    expect(user.age.value).toBe(10)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="功能实现-5"><a href="#功能实现-5" class="headerlink" title="功能实现"></a>功能实现</h4><blockquote><p><strong>逻辑：</strong></p><p><strong>get到ref返回.value，否则直接返回原对象</strong></p><p><strong>实例对象触发set会连锁原对象值改变</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">export function proxyRefs(objectWithRefs) &#123;</span><br><span class="line">    return new Proxy(objectWithRefs, &#123;</span><br><span class="line">        get(target, key) &#123;</span><br><span class="line">            return unRef(Reflect.get(target, key)) //如果是ref，就返回value，否则返回原对象</span><br><span class="line">        &#125;,</span><br><span class="line">        set(target, key, value) &#123;</span><br><span class="line">            if (isRef(target[key]) &amp;&amp; !isRef(value)) &#123;</span><br><span class="line">                return (target[key].value = value) //如果是ref，就返回value，否则返回原对象</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return Reflect.set(target, key, value) //如果是ref，就返回value，否则返回原对象</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现computed"><a href="#实现computed" class="headerlink" title="实现computed"></a>实现computed</h3><blockquote><p>**接受一个 **<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/get#description">getter 函数</a>，返回一个只读的响应式 <a href="https://cn.vuejs.org/api/reactivity-core.html#ref">ref</a> 对象。该 ref 通过 <code>.value</code> 暴露 getter 函数的返回值。它也可以接受一个带有 <code>get</code> 和 <code>set</code> 函数的对象来创建一个可写的 ref 对象。</p></blockquote><h4 id="功能单测1-2"><a href="#功能单测1-2" class="headerlink" title="功能单测1"></a>功能单测1</h4><p><strong>computed.spec.ts</strong></p><blockquote><p><code>computed</code> 函数会基于这个 getter 函数创建一个计算属性 <code>age</code>，该计算属性的值会根据 <code>user.age</code> 的变化而自动更新。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import &#123; computed &#125; from &#x27;../computed&#x27;</span><br><span class="line">import &#123; reactive &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;computed&#x27;, () =&gt; &#123;</span><br><span class="line">    it(&#x27;computed&#x27;, () =&gt; &#123;</span><br><span class="line">        const user = reactive(&#123;</span><br><span class="line">            age: 1,</span><br><span class="line">        &#125;)</span><br><span class="line">        const age = computed(() =&gt; &#123;</span><br><span class="line">            return user.age</span><br><span class="line">        &#125;)</span><br><span class="line">        expect(age.value).toBe(1)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>computed.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class ComputedRefImpl &#123;</span><br><span class="line">    private _getter: any</span><br><span class="line">    constructor(getter) &#123;</span><br><span class="line">        this._getter = getter</span><br><span class="line">    &#125;</span><br><span class="line">    get value() &#123;</span><br><span class="line">        return this._getter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function computed(getter) &#123;</span><br><span class="line">    return new ComputedRefImpl(getter)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="功能单测2-2"><a href="#功能单测2-2" class="headerlink" title="功能单测2"></a>功能单测2</h4><p><strong>computed.spec.ts</strong></p><blockquote><p>**接受一个 **<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/get#description">getter 函数</a>，返回一个只读的响应式 <a href="https://cn.vuejs.org/api/reactivity-core.html#ref">ref</a> 对象。该 ref 通过 <code>.value</code> 暴露 getter 函数的返回值。它也可以接受一个带有 <code>get</code> 和 <code>set</code> 函数的对象来创建一个可写的 ref 对象。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;should compute lazily&#x27;, () =&gt; &#123;</span><br><span class="line">    const value = reactive(&#123;</span><br><span class="line">        foo: 1,</span><br><span class="line">    &#125;)</span><br><span class="line">    const getter = jest.fn(() =&gt; &#123;</span><br><span class="line">        return value.foo</span><br><span class="line">    &#125;)</span><br><span class="line">    const cValue = computed(getter)</span><br><span class="line">    expect(getter).not.toHaveBeenCalled()</span><br><span class="line">    expect(cValue.value).toBe(1)</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(1)</span><br><span class="line">    // 再次访问，不应该再调用</span><br><span class="line">    cValue.value</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(1)</span><br><span class="line">    // 不应该再调用</span><br><span class="line">    value.foo = 2</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(1)</span><br><span class="line">    // 触发getter</span><br><span class="line">    expect(cValue.value).toBe(2)</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(2)</span><br><span class="line">    // 不应该再调用</span><br><span class="line">    cValue.value</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(2)   </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>computed.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ReactiveEffect &#125; from &#x27;./effect&#x27;</span><br><span class="line"></span><br><span class="line">class ComputedRefImpl &#123;</span><br><span class="line">    private _getter: any</span><br><span class="line">    private _value: any</span><br><span class="line">    private _dirty: boolean = true</span><br><span class="line">    private _effect: any</span><br><span class="line">    constructor(getter) &#123;</span><br><span class="line">        this._getter = getter</span><br><span class="line">        this._effect = new ReactiveEffect(getter, () =&gt; &#123;</span><br><span class="line">            if (!this._dirty) &#123;</span><br><span class="line">                this._dirty = true</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    get value() &#123;</span><br><span class="line">        if (this._dirty) &#123;</span><br><span class="line">            this._dirty = false</span><br><span class="line">            this._value = this._effect.run()</span><br><span class="line">        &#125;</span><br><span class="line">        return this._value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function computed(getter) &#123;</span><br><span class="line">    return new ComputedRefImpl(getter)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="runtime-core-初始化流程实现"><a href="#runtime-core-初始化流程实现" class="headerlink" title="runtime-core 初始化流程实现"></a>runtime-core 初始化流程实现</h2><h3 id="总览导图"><a href="#总览导图" class="headerlink" title="总览导图"></a>总览导图</h3><blockquote><p><strong>全程跟着这个流程图实现</strong></p></blockquote><p><img src="file:///C:/Users/DELL/Downloads/runtime-core.jpg?lastModify=1740547033" alt="runtime-core"></p><p><strong>创建src / runtime-core文件夹</strong></p><blockquote><p><strong>这次的测试样例放在根目录下的example / helloworld</strong></p></blockquote><h3 id="初始化-component-主流程"><a href="#初始化-component-主流程" class="headerlink" title="初始化 component 主流程"></a>初始化 component 主流程</h3><h4 id="测试文件"><a href="#测试文件" class="headerlink" title="测试文件"></a>测试文件</h4><p><strong>example / helloworld / index.html</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">        &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;script src=&quot;main.js&quot; type=&quot;module&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>以下文件模拟Vue3</strong></p><p><strong>main.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">createApp(App).mount(&#x27;#app&#x27;)</span><br><span class="line">👇</span><br><span class="line">createApp(App) + app.mount(&#x27;#app&#x27;)</span><br><span class="line">//创建一个根组件App(Vue应用实例)，然后将其挂载到&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;中，从此这个 &lt;div&gt; 里的内容由 Vue 接管，Vue 会根据 App 的图纸，在&lt;div&gt;中渲染出你写的组件</span><br></pre></td></tr></table></figure><p><strong>App.js</strong></p><blockquote><p><strong>!!! 有关虚拟节点 先去看看这篇文章</strong><a href="https://juejin.cn/post/7323031996864446505">vue3虚拟dom详解(含源码) - 掘金</a> !!!</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">export const App = &#123;</span><br><span class="line">    render() &#123;//UI逻辑</span><br><span class="line">        return h( //Vue 中的创建虚拟 DOM 的辅助函数,用于创建虚拟 DOM 节点,接收三个参数：</span><br><span class="line">            &#x27;div&#x27;, //要创建的 HTML 标签名或组件选项对象.</span><br><span class="line">            &#x27;hi, &#x27; + this.msg //子节点,可以是字符串、数字、数组或其他虚拟 DOM 节点.</span><br><span class="line">        )</span><br><span class="line">    &#125;,</span><br><span class="line">    setup() &#123;//组合式 API 的入口点,用于组合组件的逻辑，例如响应式数据、生命周期钩子、计算属性等</span><br><span class="line">        return &#123;</span><br><span class="line">            msg: &#x27;mini-vue&#x27;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="基础实现"><a href="#基础实现" class="headerlink" title="基础实现"></a>基础实现</h4><p><strong>createApp.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export function createApp(rootComponent: any) &#123; // 传入根组件</span><br><span class="line">    return &#123;</span><br><span class="line">        mount(rootContainer: any) &#123; // 挂载回根容器</span><br><span class="line">            // 先把根组件转换成虚拟节点vnode</span><br><span class="line">            // 之后所有的操作都会基于vnode做处理</span><br><span class="line">            const vnode = createVNode(rootComponent)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>vnode.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export function createVNode(type: any, props?: any, children?: any) &#123;</span><br><span class="line">    const vnode = &#123;</span><br><span class="line">        type,// 类型</span><br><span class="line">        props,// 属性</span><br><span class="line">        children,// 孩子</span><br><span class="line">        el: null,// 对应的真实dom</span><br><span class="line">        component: null,// 组件实例</span><br><span class="line">        key: props?.key,// 唯一标识</span><br><span class="line">        // shapeFlag: getShapeFlag(type), // 类型标识</span><br><span class="line">    &#125;</span><br><span class="line">    return vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>添加render函数</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mount(rootContainer: any) &#123;</span><br><span class="line">    const vnode = createVNode(rootComponent)</span><br><span class="line"></span><br><span class="line">    render(vnode, rootContainer)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><strong>renderer.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createComponentInstance &#125; from &quot;./component&quot;</span><br><span class="line"></span><br><span class="line">export function render(vnode: any, container: any) &#123;</span><br><span class="line">    // 调用patch函数</span><br><span class="line">    patch(vnode, container)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function patch(vnode: any, container: any) &#123;</span><br><span class="line">    if (vnode.shapeFlag === 1) &#123;</span><br><span class="line">        // 处理element</span><br><span class="line">        processElement(vnode, container)  </span><br><span class="line">    &#125;else if (vnode.shapeFlag === 8) &#123;</span><br><span class="line">        // 处理component</span><br><span class="line">        processComponent(vnode, container)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function processElement(vnode: any, container: any) &#123;</span><br><span class="line">    mountElement(vnode, container)  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mountElement(vnode: any, container: any) &#123;</span><br><span class="line">    // 创建组件实例对象</span><br><span class="line">    const instance = createComponentInstance(vnode)</span><br><span class="line"></span><br><span class="line">    // 处理组件的setup</span><br><span class="line">    setupComponent(instance)</span><br><span class="line"></span><br><span class="line">    // 处理组件的render</span><br><span class="line">    setupRenderEffect(instance, vnode, container)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>component.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">export function createComponentInstance(vnode: any) &#123;</span><br><span class="line">    const instance = &#123;</span><br><span class="line">        vnode,          // 组件的虚拟节点（设计图）</span><br><span class="line">        type: vnode.type, // 组件定义（比如你写的 .vue 文件中的对象）</span><br><span class="line">        props: vnode.props, // 外部传入的属性</span><br><span class="line">        slots: vnode.slots, // 插槽内容（类似 `&lt;template #header&gt;`）</span><br><span class="line">        proxy: null,     // 代理对象（用于访问数据和属性）</span><br><span class="line">    &#125;;</span><br><span class="line">    return instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function setupComponent(instance: any) &#123;</span><br><span class="line">    // 初始化组件</span><br><span class="line">    initProps(instance)</span><br><span class="line">    initSlots(instance)</span><br><span class="line"></span><br><span class="line">    // 处理组件的setup</span><br><span class="line">    setupStatefulComponent(instance)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function setupStatefulComponent(instance: any) &#123;</span><br><span class="line">    // 先拿到组件</span><br><span class="line">    const Component = instance.type // 组件定义（比如你写的 setup 函数）</span><br><span class="line"></span><br><span class="line">    // 代理对象（用于访问数据和属性）</span><br><span class="line">    instance.proxy = new Proxy(instance, &#123;</span><br><span class="line">        get(target, key) &#123;</span><br><span class="line">            const &#123; setup, props &#125; = target</span><br><span class="line"></span><br><span class="line">            if (key in setup) &#123;// 优先从 setup 返回值中找</span><br><span class="line">                return setup[key]       </span><br><span class="line">            &#125;   else if (key in props) &#123;// 其次从 props 中找</span><br><span class="line">                return props[key]</span><br><span class="line">            &#125;</span><br><span class="line">            return Reflect.get(target, key)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)  </span><br><span class="line"></span><br><span class="line">    const &#123; setup &#125; = Component //解构出setup</span><br><span class="line"></span><br><span class="line">    if (setup) &#123;</span><br><span class="line">        setCurrentInstance(instance) // 标记“当前对象是谁”</span><br><span class="line">        const setupResult = setup() // 执行你的 setup 函数</span><br><span class="line">        setCurrentInstance(null) // 清除标记</span><br><span class="line"></span><br><span class="line">        handleSetupResult(instance, setupResult) // 保存 setup 返回值</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        finishComponentSetup(instance) // 没有 setup 直接完成初始化</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleSetupResult(instance: any, setupResult: any) &#123;</span><br><span class="line">    if (typeof setupResult === &#x27;object&#x27;) &#123;</span><br><span class="line">        instance.setupState = setupResult; // 保存 setup 返回的对象</span><br><span class="line">    &#125;</span><br><span class="line">    finishComponentSetup(instance); // 完成组装</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function finishComponentSetup(instance: any) &#123;</span><br><span class="line">    const Component = instance.type;</span><br><span class="line">    // 确定 render 函数（你写的 template 会被编译成 render 函数）</span><br><span class="line">    instance.render = Component.render || instance.vnode.render;</span><br><span class="line">    // 准备渲染（虚拟 DOM 生成真实 DOM）</span><br><span class="line">    setupRenderEffect(instance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>renderer.ts 继续完善逻辑</strong></p><blockquote><p>**回调render，实现 “拆箱” **</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function setupRenderEffect(instance: any, vnode: any, container: any) &#123;</span><br><span class="line">    const &#123; proxy &#125; = instance</span><br><span class="line">    const subTree = instance.render.call(proxy) //拿到虚拟节点树</span><br><span class="line"></span><br><span class="line">    // vnode -&gt; patch</span><br><span class="line">    // vnode -&gt; element -&gt; mountElement</span><br><span class="line">    patch(subTree, container)</span><br><span class="line"></span><br><span class="line">    vnode.el = subTree.el</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用-rollup-打包库"><a href="#使用-rollup-打包库" class="headerlink" title="使用 rollup 打包库"></a>使用 rollup 打包库</h3><blockquote><p><strong>rollup一般用于库的打包，而webpack更多用于应用的打包</strong></p><blockquote><p><strong>构建输出的作用👇</strong></p></blockquote><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">提供对不同模块格式的支持，增强库的兼容性</span><br><span class="line">优化代码体积与性能</span><br><span class="line">简化库的分发与使用流程，促进组件复用</span><br><span class="line">实现按需加载</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><strong>在以下案例中就构建了两种格式 CommonJS &amp; ES Module 的文件</strong></p></blockquote></blockquote><h4 id="配置rollup"><a href="#配置rollup" class="headerlink" title="配置rollup"></a>配置rollup</h4><p><strong>安装</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install --global rollup</span><br></pre></td></tr></table></figure><p><strong>安装官方依赖</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pnpm install @rollup/plugin-typescript --save-dev</span><br><span class="line">pnpm install tslib</span><br></pre></td></tr></table></figure><blockquote><p><strong>创建 src / index.ts 作为 mini-vue 的出入口</strong></p></blockquote><p><strong>rollup.config.js 编写脚本文件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import typescript from &#x27;@rollup/plugin-typescript&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    input: &#x27;src/index.ts&#x27;, // 入口文件</span><br><span class="line">    output: [</span><br><span class="line">        &#123;</span><br><span class="line">            file: &#x27;lib/guide-mini-vue.cjs.js&#x27;, // 输出的 CommonJS 格式文件</span><br><span class="line">            format: &#x27;cjs&#x27;, // 指定输出格式为 CommonJS</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            file: &#x27;lib/guide-mini-vue.esm.js&#x27;, // 输出的 ES Module 格式文件</span><br><span class="line">            format: &#x27;es&#x27;, // 指定输出格式为 ES Module</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    plugins: [</span><br><span class="line">        // 插件列表</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p><strong>构建的输出文件就是lib下的 guide-mini-vue.cjs.js &amp; guide-mini-vue.esm.js 这两个文件</strong></p></blockquote><p><strong>在package.json中打开依赖</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;jest&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;rollup -c config.js&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><strong>更改tsconfig.json依赖项</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;module&quot;: &quot;esnext&quot;,</span><br></pre></td></tr></table></figure><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p><strong>处理src下的index文件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// mini-vue 的入口</span><br><span class="line">export * from &#x27;./runtime-core&#x27;</span><br></pre></td></tr></table></figure><p><strong>再处理runtime-core下的index文件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export &#123; createApp &#125; from &quot;./createApp&quot;;</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm build 即可构建两种格式的文件</strong></p></blockquote><p><em><strong>补充h函数逻辑</strong></em></p><blockquote><p><strong>前情提要</strong></p><p><strong>example下的App.js文件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">export const App = &#123;</span><br><span class="line"> render() &#123; // UI逻辑</span><br><span class="line">     return h( // Vue 中的创建虚拟 DOM 的辅助函数,用于创建虚拟 DOM 节点,接收三个参数：</span><br><span class="line">         &#x27;div&#x27;, // 要创建的 HTML 标签名或组件选项对象.</span><br><span class="line">         &#123;&#125;, // 标签属性,可以是一个对象或数组.</span><br><span class="line">         &#x27;hi, &#x27; + this.msg // 子节点,可以是字符串、数字、数组或其他虚拟 DOM 节点.</span><br><span class="line">     )</span><br><span class="line"> &#125;,</span><br><span class="line"> setup() &#123; // 组合式 API 的入口点,用于组合组件的逻辑，例如响应式数据、生命周期钩子、计算属性等</span><br><span class="line">     return &#123;</span><br><span class="line">         msg: &#x27;mini-vue&#x27;,</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p><strong>runtime-core / h.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createVNode &#125; from &quot;./vnode&quot;;</span><br><span class="line"></span><br><span class="line">export function h(type: any, props?: any, children?: any) &#123;</span><br><span class="line">    return createVNode(type, props, children)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>runtime-core / index.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export &#123; createApp &#125; from &#x27;./createApp&#x27;</span><br><span class="line">import &#123; h &#125; from &#x27;./h&#x27;</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm build 继续构建到 example 测试项目里</strong></p></blockquote><p><strong>然后就可以在example中直接引用构建下来的文件</strong></p><p><strong>main.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// vue3</span><br><span class="line">import &#123; createApp &#125; from &#x27;../../lib/guide-mini-vue.esm.js&#x27; // 导入自己构建的文件</span><br><span class="line">import &#123; App &#125; from &#x27;./App.js&#x27;</span><br><span class="line"></span><br><span class="line">createApp(App).mount(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure><p><strong>然后就可以打开HTML文件了</strong></p><h2 id="runtime-dom-封装DOM方法"><a href="#runtime-dom-封装DOM方法" class="headerlink" title="runtime-dom 封装DOM方法"></a>runtime-dom 封装DOM方法</h2><h2 id="compiler-core-编译逻辑和算法-1"><a href="#compiler-core-编译逻辑和算法-1" class="headerlink" title="compiler-core 编译逻辑和算法"></a>compiler-core 编译逻辑和算法</h2><h2 id="compiler-sfc-解析-vue组件-1"><a href="#compiler-sfc-解析-vue组件-1" class="headerlink" title="compiler-sfc 解析.vue组件"></a>compiler-sfc 解析.vue组件</h2><h2 id="compiler-dom-处理template标签"><a href="#compiler-dom-处理template标签" class="headerlink" title="compiler-dom 处理template标签"></a>compiler-dom 处理template标签</h2>]]></content>
      
      
      <categories>
          
          <category> 源码学习 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ECharts图表库实战</title>
      <link href="/2025/03/08/%E5%B7%A5%E5%85%B7/ECharts%E5%AE%98%E6%96%B9%E5%9B%BE%E8%A1%A8%E5%BA%93CV%E6%95%99%E7%A8%8B/"/>
      <url>/2025/03/08/%E5%B7%A5%E5%85%B7/ECharts%E5%AE%98%E6%96%B9%E5%9B%BE%E8%A1%A8%E5%BA%93CV%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="本文项目主干结构"><a href="#本文项目主干结构" class="headerlink" title="本文项目主干结构"></a>本文项目主干结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">├── public</span><br><span class="line">│   └── data.json        # 数据文件（静态拆分数据时使用）</span><br><span class="line">│</span><br><span class="line">├── src</span><br><span class="line">│   ├── utils           # 工具</span><br><span class="line">│   │   └── request.ts  # axios二次封装</span><br><span class="line">│   │</span><br><span class="line">│   ├── store              # Pinia仓库</span><br><span class="line">│   │   └── chartStore.ts  # 管理图表相关的数据</span><br><span class="line">│   │</span><br><span class="line">│   ├── services         # API 服务</span><br><span class="line">│   │   └── api.ts       # 模拟后端 API 请求</span><br><span class="line">│   │</span><br><span class="line">│   ├── components       # 组件</span><br><span class="line">│   │   ├── chart        # 图表组件</span><br><span class="line">│   │   │   ├── category # 图表分类</span><br><span class="line">│   │   │   │   └── rose.vue  # 玫瑰图组件</span><br><span class="line">│   │   │   │   └── bar.vue   # 柱状图组件</span><br><span class="line">│   │   │   │   └── line.vue  # 折线图组件</span><br><span class="line">│   │   │   │   └── pie.vue   # 饼状图组件</span><br><span class="line">│   │   │   │   └── scaatter  # 散点图组件</span><br><span class="line">│   │   │   │</span><br><span class="line">│   │   │   ├── data     # 数据处理逻辑</span><br><span class="line">│   │   │   │   └── chartData.ts # 数据获取和处理</span><br><span class="line">│   │   │   │</span><br><span class="line">│   │   │   └── chart.vue # 所有图表汇总</span><br><span class="line">│   │   │</span><br><span class="line">│   │   └── other-components # 其他组件</span><br><span class="line">│   │</span><br><span class="line">│   ├── App.vue          # 根组件</span><br><span class="line">│   ├── main.ts          # 入口文件</span><br><span class="line">│   │</span><br><span class="line">│   └── types            # 类型定义</span><br><span class="line">│       └── chart.d.ts   # ECharts 数据类型定义</span><br><span class="line">│</span><br><span class="line">├── vite.config.ts       # Vite 配置文件</span><br><span class="line">└── package.json         # 项目依赖</span><br></pre></td></tr></table></figure><p><a href="https://echarts.apache.org/examples/zh/index.html">Examples - Apache ECharts</a></p><p><strong>Echarts官网→所有示例→选择需要导入的图表→完整代码</strong></p><p>本文以基础南丁格尔玫瑰图作示例</p><p><a href="https://echarts.apache.org/examples/zh/editor.html?c=pie-roseType-simple&lang=ts&version=5.5.0">Examples - Apache ECharts</a></p><h3 id="官网源码（原生JS）"><a href="#官网源码（原生JS）" class="headerlink" title="官网源码（原生JS）"></a>官网源码（原生JS）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> chartDom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>)!;</span><br><span class="line"><span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(chartDom);</span><br><span class="line"><span class="keyword">var</span> option;</span><br><span class="line"></span><br><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">legend</span>: &#123;</span><br><span class="line">    <span class="attr">top</span>: <span class="string">&#x27;bottom&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">toolbox</span>: &#123;</span><br><span class="line">    <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">feature</span>: &#123;</span><br><span class="line">      <span class="attr">mark</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      <span class="attr">dataView</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span>, <span class="attr">readOnly</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      <span class="attr">restore</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      <span class="attr">saveAsImage</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">series</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Nightingale Chart&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">      <span class="attr">radius</span>: [<span class="number">50</span>, <span class="number">250</span>],</span><br><span class="line">      <span class="attr">center</span>: [<span class="string">&#x27;50%&#x27;</span>, <span class="string">&#x27;50%&#x27;</span>],</span><br><span class="line">      <span class="attr">roseType</span>: <span class="string">&#x27;area&#x27;</span>,</span><br><span class="line">      <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">        <span class="attr">borderRadius</span>: <span class="number">8</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">data</span>: [</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">40</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 1&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">38</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 2&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">32</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 3&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">30</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 4&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">28</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 5&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">26</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 6&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">22</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 7&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">18</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 8&#x27;</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">option &amp;&amp; myChart.<span class="title function_">setOption</span>(option);</span><br></pre></td></tr></table></figure><h3 id="转Vue组件（静态数据）"><a href="#转Vue组件（静态数据）" class="headerlink" title="转Vue组件（静态数据）"></a>转Vue组件（静态数据）</h3><p>rose.vue</p><h4 id="template"><a href="#template" class="headerlink" title="template"></a>template</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div ref=&quot;chartContainer&quot; class=&quot;chart-container&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="script"><a href="#script" class="headerlink" title="script"></a>script</h4><h5 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br></pre></td></tr></table></figure><p>其他按需引入</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onMounted, ref, onUnmounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>; <span class="comment">//更多的看自己需求</span></span><br></pre></td></tr></table></figure><h5 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h5><p>JS源码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> chartDom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>)!;</span><br></pre></td></tr></table></figure><p><strong>转vue组件</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取图表容器的引用</span></span><br><span class="line"><span class="keyword">const</span> chartContainer = ref&lt;<span class="title class_">HTMLElement</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><p>JS源码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(chartDom);</span><br></pre></td></tr></table></figure><p><strong>转vue组件</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义图表实例</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myChart</span>: echarts.<span class="property">ECharts</span> | <span class="literal">null</span> = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><h5 id="option"><a href="#option" class="headerlink" title="option"></a>option</h5><p>JS源码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> option;</span><br><span class="line">option = &#123;</span><br><span class="line">    <span class="comment">//这段直接复制过来//</span></span><br><span class="line">    <span class="attr">legend</span>: &#123;</span><br><span class="line">        <span class="attr">top</span>: <span class="string">&#x27;bottom&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//这段直接复制过来//</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>转vue组件</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义图表选项</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">option</span>: echarts.<span class="property">EChartsOption</span> = &#123;</span><br><span class="line">    <span class="comment">//这段直接复制过来//</span></span><br><span class="line">    <span class="attr">legend</span>: &#123;</span><br><span class="line">        <span class="attr">top</span>: <span class="string">&#x27;bottom&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//这段直接复制过来//</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h5><p>JS源码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">option &amp;&amp; myChart.<span class="title function_">setOption</span>(option);</span><br></pre></td></tr></table></figure><p><strong>转vue组件（优化版）</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在组件挂载时初始化图表</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!chartContainer.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化 ECharts 实例</span></span><br><span class="line">  myChart = echarts.<span class="title function_">init</span>(chartContainer.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置图表选项</span></span><br><span class="line">  myChart.<span class="title function_">setOption</span>(option);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 监听窗口大小变化，自动调整图表大小</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在组件卸载时清理图表实例</span></span><br><span class="line"><span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (myChart) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">    myChart.<span class="title function_">dispose</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义函数：调整图表大小</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">resizeChart</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (myChart) &#123;</span><br><span class="line">    myChart.<span class="title function_">resize</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="style"><a href="#style" class="headerlink" title="style"></a>style</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.chart-container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>; <span class="comment">/* 根据需要调整高度 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="抽离数据写法（静态数据）"><a href="#抽离数据写法（静态数据）" class="headerlink" title="抽离数据写法（静态数据）"></a>抽离数据写法（静态数据）</h3><p>【注：这里是从本地调用数据的写法，需要】</p><h4 id="public-data-json"><a href="#public-data-json" class="headerlink" title="public &#x2F; data.json"></a>public &#x2F; data.json</h4><p>(模拟后端传来的数据)</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 1&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">38</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 2&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">32</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 3&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 4&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">28</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 5&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">26</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 6&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 7&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 8&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="图表组件修改"><a href="#图表组件修改" class="headerlink" title="图表组件修改"></a>图表组件修改</h4><p>option &#x2F; series 部分</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: [</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">40</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 1&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">38</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 2&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">32</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 3&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">30</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 4&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">28</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 5&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">26</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 6&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">22</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 7&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">18</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 8&#x27;</span> &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>改为</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: [], <span class="comment">// 初始为空，稍后从 data.json 加载</span></span><br></pre></td></tr></table></figure><h5 id="添加异步加载函数"><a href="#添加异步加载函数" class="headerlink" title="添加异步加载函数"></a>添加异步加载函数</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步加载数据</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 使用 fetch 从 public/data.json 获取数据</span></span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/data.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加报错提示</span></span><br><span class="line">        <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Failed to fetch data&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 提取数据</span></span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将 JSON 数据转换为 ECharts 需要的格式（根据数据键值对自行修改）</span></span><br><span class="line">        <span class="keyword">const</span> chartData = data.<span class="property">data</span>.<span class="title function_">map</span>(<span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">            <span class="attr">value</span>: item.<span class="property">value</span>,</span><br><span class="line">            <span class="attr">name</span>: item.<span class="property">name</span>,</span><br><span class="line">        &#125;))</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 替换图表选项中‘data’项</span></span><br><span class="line">        option.<span class="property">series</span>[<span class="number">0</span>].<span class="property">data</span> = chartData;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果图表已经初始化，则重新设置选项</span></span><br><span class="line">        <span class="keyword">if</span> (myChart) &#123;</span><br><span class="line">            myChart.<span class="title function_">setOption</span>(option);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading data:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="调用函数-loadData"><a href="#调用函数-loadData" class="headerlink" title="调用函数 loadData"></a>调用函数 loadData</h5><p>在 onMounted 中的 setOption 后</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!chartContainer.<span class="property">value</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化 ECharts 实例</span></span><br><span class="line">    myChart = echarts.<span class="title function_">init</span>(chartContainer.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置图表选项</span></span><br><span class="line">    myChart.<span class="title function_">setOption</span>(option)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载数据并更新图表</span></span><br><span class="line">    <span class="title function_">loadData</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听窗口大小变化，自动调整图表大小</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="真实前后端对接（动态请求）"><a href="#真实前后端对接（动态请求）" class="headerlink" title="真实前后端对接（动态请求）"></a>真实前后端对接（动态请求）</h3><h4 id="使用-axios"><a href="#使用-axios" class="headerlink" title="使用 axios"></a>使用 <code>axios</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install axios</span><br></pre></td></tr></table></figure><h5 id="axios二次封装"><a href="#axios二次封装" class="headerlink" title="axios二次封装"></a>axios二次封装</h5><p>模板</p><p><code>src/utils/request.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios, &#123; <span class="title class_">AxiosInstance</span>, <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span>; <span class="comment">// Element Plus 组件（主要是使用Message消息弹出框）</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span>; <span class="comment">// 引入 Pinia Store</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span>; <span class="comment">// 引入 Vue Router</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 axios 实例</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">service</span>: <span class="title class_">AxiosInstance</span> = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_API_BASE_URL</span> || <span class="string">&#x27;/&#x27;</span>, <span class="comment">// 从环境变量中获取 API 基础路径</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span>, <span class="comment">// 请求超时时间</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">    <span class="comment">// 例如，添加身份验证 token</span></span><br><span class="line">    <span class="keyword">const</span> token = store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">token</span>; <span class="comment">// 假设你有用户信息存储在 Pinia 中</span></span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      config.<span class="property">headers</span>[<span class="string">&#x27;Authorization&#x27;</span>] = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 对响应数据做点什么</span></span><br><span class="line">    <span class="keyword">const</span> res = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果接口返回的状态码不是 200，说明请求失败</span></span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">code</span> !== <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(res.<span class="property">message</span> || <span class="string">&#x27;Error&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(res.<span class="property">message</span> || <span class="string">&#x27;Error&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">response</span>) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (error.<span class="property">response</span>.<span class="property">status</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">401</span>:</span><br><span class="line">          <span class="comment">// 清除 Token 并跳转到登录页面</span></span><br><span class="line">          store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/logout&#x27;</span>);</span><br><span class="line">          router.<span class="title function_">push</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">403</span>:</span><br><span class="line">          <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;Forbidden&#x27;</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">404</span>:</span><br><span class="line">          <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;Not Found&#x27;</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">500</span>:</span><br><span class="line">          <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;Server Error&#x27;</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">          <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;Network Error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service;</span><br></pre></td></tr></table></figure><p>现在可以在任何地方通过 <code>import request from &#39;@/utils/request&#39;</code> 来使用封装后的 axios 实例</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="函数-loadData修改"><a href="#函数-loadData修改" class="headerlink" title="函数 loadData修改"></a>函数 loadData修改</h5><p>静态获取</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">loadData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">/////更改处////</span></span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/data.json&#x27;</span>) <span class="comment">// 使用 fetch 从 public/data.json 获取数据</span></span><br><span class="line">        <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Failed to fetch data&#x27;</span>) &#125;</span><br><span class="line">        <span class="comment">/////更改处////</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>()</span><br><span class="line">        ......</span><br></pre></td></tr></table></figure><p>动态对接</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">/////更改处////</span></span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/api/data&#x27;</span>); <span class="comment">// 假设后端 API 地址为 /api/data</span></span><br><span class="line">        <span class="comment">/////更改处////</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">const</span> data = response.<span class="property">data</span>;</span><br><span class="line">        ......</span><br></pre></td></tr></table></figure><h4 id="Pinia状态管理"><a href="#Pinia状态管理" class="headerlink" title="Pinia状态管理"></a>Pinia状态管理</h4><p>如果你的应用中有多个组件需要共享数据（例如多个图表共享同一份数据），可以考虑使用 Vuex 或 Pinia 进行状态管理。这样可以避免重复的 API 请求，并且更容易管理数据流。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install pinia</span><br></pre></td></tr></table></figure><h5 id="在-main-ts-中注册Pinia"><a href="#在-main-ts-中注册Pinia" class="headerlink" title="在 main.ts 中注册Pinia"></a>在 <code>main.ts</code> 中注册Pinia</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册 Pinia</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">createPinia</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册 Vue Router 和 Element Plus</span></span><br><span class="line">app.<span class="title function_">use</span>(router);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure><h5 id="chartStore-ts"><a href="#chartStore-ts" class="headerlink" title="chartStore.ts"></a><code>chartStore.ts</code></h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ChartState</span> &#123;</span><br><span class="line">    <span class="attr">chartData</span>: <span class="title class_">Array</span>&lt;&#123; <span class="attr">value</span>: <span class="built_in">number</span>; <span class="attr">name</span>: <span class="built_in">string</span> &#125;&gt;;</span><br><span class="line">    <span class="attr">isLoading</span>: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">error</span>: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useChartStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;chart&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">state</span>: (): <span class="function"><span class="params">ChartState</span> =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">chartData</span>: [], <span class="comment">// 图表数据</span></span><br><span class="line">        <span class="attr">isLoading</span>: <span class="literal">false</span>, <span class="comment">// 加载状态</span></span><br><span class="line">        <span class="attr">error</span>: <span class="literal">null</span>, <span class="comment">// 错误信息</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">fetchChartData</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">error</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> response = <span class="keyword">await</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/data&#x27;</span>); <span class="comment">// 假设后端 API 地址为 /api/data</span></span><br><span class="line">                <span class="keyword">const</span> data = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 将 JSON 数据转换为 ECharts 需要的格式</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">chartData</span> = data.<span class="title function_">map</span>(<span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">                    <span class="attr">value</span>: item.<span class="property">sales</span>,</span><br><span class="line">                    <span class="attr">name</span>: item.<span class="property">category</span>,</span><br><span class="line">                &#125;));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">error</span> = <span class="string">&#x27;Failed to load chart data&#x27;</span>;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading data:&#x27;</span>, error);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这样就可以在组件中直接调用现成的数据逻辑了</p><h5 id="rose-vue"><a href="#rose-vue" class="headerlink" title="rose.vue"></a><code>rose.vue</code></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    import &#123; onMounted, onUnmounted, ref, watch &#125; from &#x27;vue&#x27;;</span><br><span class="line">    import * as echarts from &#x27;echarts&#x27;;</span><br><span class="line">    import &#123; useChartStore &#125; from &#x27;@/store/chartStore&#x27;;// 调用自定义Store</span><br><span class="line"></span><br><span class="line">    const chartContainer = ref&lt;HTMLElement | null&gt;(null);</span><br><span class="line">    let myChart: echarts.ECharts | null = null;</span><br><span class="line"></span><br><span class="line">    // 获取 Pinia Store</span><br><span class="line">    const chartStore = useChartStore();</span><br><span class="line"></span><br><span class="line">    // 定义图表选项</span><br><span class="line">    const option: echarts.EChartsOption = &#123;</span><br><span class="line">        legend: &#123;</span><br><span class="line">            top: &#x27;bottom&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">        toolbox: &#123;</span><br><span class="line">            show: true,</span><br><span class="line">            feature: &#123;</span><br><span class="line">                mark: &#123; show: true &#125;,</span><br><span class="line">                dataView: &#123; show: true, readOnly: false &#125;,</span><br><span class="line">                restore: &#123; show: true &#125;,</span><br><span class="line">                saveAsImage: &#123; show: true &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        series: [</span><br><span class="line">            &#123;</span><br><span class="line">                name: &#x27;销量&#x27;,</span><br><span class="line">                type: &#x27;pie&#x27;,</span><br><span class="line">                radius: [50, 250],</span><br><span class="line">                center: [&#x27;50%&#x27;, &#x27;50%&#x27;],</span><br><span class="line">                roseType: &#x27;area&#x27;,</span><br><span class="line">                itemStyle: &#123;</span><br><span class="line">                    borderRadius: 8,</span><br><span class="line">                &#125;,</span><br><span class="line">                data: [], // 初始为空，稍后从 Pinia Store 获取</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 监听 Pinia Store 中的数据变化</span><br><span class="line">    watch(</span><br><span class="line">        () =&gt; chartStore.chartData,</span><br><span class="line">        (newData) =&gt; &#123;</span><br><span class="line">            if (myChart &amp;&amp; newData.length &gt; 0) &#123;</span><br><span class="line">                option.series[0].data = newData;</span><br><span class="line">                myChart.setOption(option);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">        if (!chartContainer.value) return;</span><br><span class="line">        // 初始化 ECharts 实例</span><br><span class="line">        myChart = echarts.init(chartContainer.value);</span><br><span class="line">        // 设置初始图表选项（此时 series.data 为空）</span><br><span class="line">        myChart.setOption(option);</span><br><span class="line">        // 加载数据</span><br><span class="line">        chartStore.fetchChartData();</span><br><span class="line">        // 监听窗口大小变化，自动调整图表大小</span><br><span class="line">        window.addEventListener(&#x27;resize&#x27;, resizeChart);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 在组件卸载时移除事件监听器</span><br><span class="line">    onUnmounted(() =&gt; &#123;</span><br><span class="line">        if (myChart) &#123;</span><br><span class="line">            window.removeEventListener(&#x27;resize&#x27;, resizeChart);</span><br><span class="line">            myChart.dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 自定义函数：调整图表大小</span><br><span class="line">    const resizeChart = () =&gt; &#123;</span><br><span class="line">        if (myChart) &#123;</span><br><span class="line">            myChart.resize();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h5 id="更多组件"><a href="#更多组件" class="headerlink" title="更多组件"></a>更多组件</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">根据上述步骤实现官网源码转Vue组件，插入到category #图表分类 文件夹下即可</span><br></pre></td></tr></table></figure><h4 id="加载动画设置"><a href="#加载动画设置" class="headerlink" title="加载动画设置"></a>加载动画设置</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!chartContainer.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化 ECharts 实例</span></span><br><span class="line">  myChart = echarts.<span class="title function_">init</span>(chartContainer.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 显示加载动画</span></span><br><span class="line">  myChart.<span class="title function_">showLoading</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载数据并更新图表</span></span><br><span class="line">  <span class="title function_">loadData</span>().<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 无论成功还是失败，都隐藏加载动画</span></span><br><span class="line">    myChart?.<span class="title function_">hideLoading</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 监听窗口大小变化，自动调整图表大小</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="缓存与性能优化"><a href="#缓存与性能优化" class="headerlink" title="缓存与性能优化"></a>缓存与性能优化</h4><h5 id="缓存数据"><a href="#缓存数据" class="headerlink" title="缓存数据"></a>缓存数据</h5><p>如果数据不会频繁变化，可以考虑使用浏览器的缓存机制（如 localStorage 或 sessionStorage）来缓存数据，减少不必要的 API 请求。</p><p><code>chartStore.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ChartState</span> &#123;</span><br><span class="line">  <span class="attr">chartData</span>: <span class="title class_">Array</span>&lt;&#123; <span class="attr">value</span>: <span class="built_in">number</span>; <span class="attr">name</span>: <span class="built_in">string</span> &#125;&gt;;</span><br><span class="line">  <span class="attr">isLoading</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">error</span>: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useChartStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;chart&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: (): <span class="function"><span class="params">ChartState</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">chartData</span>: [], <span class="comment">// 图表数据</span></span><br><span class="line">    <span class="attr">isLoading</span>: <span class="literal">false</span>, <span class="comment">// 加载状态</span></span><br><span class="line">    <span class="attr">error</span>: <span class="literal">null</span>, <span class="comment">// 错误信息</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">fetchChartData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">error</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 检查是否有缓存数据</span></span><br><span class="line">      <span class="keyword">const</span> cachedData = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;chartData&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (cachedData) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chartData</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(cachedData);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/data&#x27;</span>); <span class="comment">// 假设后端 API 地址为 /api/data</span></span><br><span class="line">        <span class="keyword">const</span> data = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将 JSON 数据转换为 ECharts 需要的格式</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chartData</span> = data.<span class="title function_">map</span>(<span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">          <span class="attr">value</span>: item.<span class="property">sales</span>,</span><br><span class="line">          <span class="attr">name</span>: item.<span class="property">category</span>,</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 缓存数据</span></span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;chartData&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">chartData</span>));</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">error</span> = <span class="string">&#x27;Failed to load chart data&#x27;</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading data:&#x27;</span>, error);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="按需加载"><a href="#按需加载" class="headerlink" title="按需加载"></a>按需加载</h5><p>大型图表或复杂的数据集，可以考虑分页加载数据或懒加载</p><p><code>chartStore.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useChartStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;chart&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: (): <span class="function"><span class="params">ChartState</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">chartData</span>: [],</span><br><span class="line">    <span class="attr">isLoading</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">error</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">fetchChartData</span>(<span class="params"><span class="attr">forceRefresh</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">error</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果不需要强制刷新且有缓存数据，则直接使用缓存</span></span><br><span class="line">      <span class="keyword">if</span> (!forceRefresh) &#123;</span><br><span class="line">        <span class="keyword">const</span> cachedData = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;chartData&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cachedData) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">chartData</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(cachedData);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/data&#x27;</span>); <span class="comment">// 假设后端 API 地址为 /api/data</span></span><br><span class="line">        <span class="keyword">const</span> data = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将 JSON 数据转换为 ECharts 需要的格式</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chartData</span> = data.<span class="title function_">map</span>(<span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">          <span class="attr">value</span>: item.<span class="property">sales</span>,</span><br><span class="line">          <span class="attr">name</span>: item.<span class="property">category</span>,</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 缓存数据</span></span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;chartData&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">chartData</span>));</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">error</span> = <span class="string">&#x27;Failed to load chart data&#x27;</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading data:&#x27;</span>, error);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>rose.vue</code></p><p>调用 fetchChartData 时传递参数</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认情况下使用缓存数据</span></span><br><span class="line">chartStore.<span class="title function_">fetchChartData</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果需要强制刷新数据（例如用户点击了“刷新”按钮），可以传递 true</span></span><br><span class="line"><span class="comment">// chartStore.fetchChartData(true);</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>前端深入技术方向选型</title>
      <link href="/2025/03/08/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%96%B9%E5%90%91%E9%80%89%E5%9E%8B/"/>
      <url>/2025/03/08/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%96%B9%E5%90%91%E9%80%89%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="前端技术方向选型"><a href="#前端技术方向选型" class="headerlink" title="前端技术方向选型"></a>前端技术方向选型</h1><hr><h2 id="数据可视化"><a href="#数据可视化" class="headerlink" title="数据可视化"></a>数据可视化</h2><p><strong>简介：将数据以图表、图形等可视化形式展示</strong></p><p><strong>技术平台：</strong></p><p><strong>技术栈</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">数据可视化库，如D3.js、ECharts、AntV等</span><br><span class="line">JavaScript的数组操作、数据过滤</span><br></pre></td></tr></table></figure><p><strong>难点</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">数据处理和分析能力要求高</span><br><span class="line">JavaScript的数组操作、数据过滤等方法</span><br><span class="line">不同图表类型的特点和配置选项复杂，需要深入了解</span><br><span class="line">可视化效果的设计和优化难度大，如色彩搭配、布局调整等。</span><br></pre></td></tr></table></figure><p><strong>市场需求度：高</strong></p><p><strong>成熟性：比较成熟，已有许多成熟的数据可视化库，功能强大，基本能满足常见需求。</strong></p><p><strong>可延展性：较好，可与后端数据处理、前端交互等技术集成，拓展数据可视化的应用场景。</strong></p><hr><h2 id="跨端"><a href="#跨端" class="headerlink" title="跨端"></a>跨端</h2><p><strong>简介：一套代码在不同的平台上运行，如Web、Android、iOS、小程序等。</strong></p><p><strong>技术平台：</strong></p><p><strong>技术栈</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">掌握跨端框架，如ReactNative、Flutter等；</span><br><span class="line">了解不同平台的原生开发技术，如Android的Java/Kotlin、iOS的Swift/Objective-C；</span><br><span class="line">熟悉前端的基础技术HTML、CSS、JavaScript；</span><br><span class="line">掌握相关的打包和发布工具，如Cordova、Capacitor等。</span><br></pre></td></tr></table></figure><p><strong>难点</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">不同平台的原生开发技术差异大，需要学习和掌握多种技术栈；</span><br><span class="line">跨端框架的原理和使用复杂，如ReactNative、Flutter等；</span><br><span class="line">适配不同平台的UI和交互规范困难。</span><br></pre></td></tr></table></figure><p><strong>市场需求度：高</strong></p><p><strong>成熟性：比较成熟，主流的跨端框架已得到广泛应用，但在一些特殊需求和平台上仍存在兼容性问题。</strong></p><p><strong>可延展性：强，可与后端开发、云服务等技术集成，拓展跨端应用的功能和场景。</strong></p><hr><h2 id="工程化"><a href="#工程化" class="headerlink" title="工程化"></a>工程化</h2><p><strong>简介：使用软件工程的方法和工具来规范和优化前端开发流程，提高开发效率、代码质量和可维护性。</strong></p><p><strong>技术平台：</strong></p><p><strong>技术栈</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">构建工具，如Webpack、Vite等；</span><br><span class="line">代码规范和检查工具，如ESLint、Prettier等；</span><br><span class="line">了解模块化和组件化开发的方法，如ES6模块、Vue组件、React组件等；</span><br><span class="line">版本控制工具，如Git</span><br><span class="line">自动化部署和持续集成工具，如Jenkins、GitLab CI等。</span><br></pre></td></tr></table></figure><p><strong>难点</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">构建工具的配置和使用复杂，如Webpack、Vite等</span><br><span class="line">代码规范和检查工具的定制和集成困难</span><br><span class="line">理解和掌握模块化和组件化开发的原理和方法需要一定时间。</span><br></pre></td></tr></table></figure><p><strong>市场需求度：高</strong></p><p><strong>成熟性：比较成熟，相关的构建工具、代码规范和检查工具等已得到广泛应用。</strong></p><p><strong>可延展性：较好，可与其他技术集成，如测试框架、自动化部署工具等，拓展工程化的范围和功能。</strong></p><hr><h2 id="即时通讯"><a href="#即时通讯" class="headerlink" title="即时通讯"></a>即时通讯</h2><p><strong>简介：实现客户端与客户端之间的实时通信，如文字消息、语音消息、视频通话等</strong></p><p><strong>技术平台：</strong></p><p><strong>技术栈</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">掌握WebSocket或WebRTC等实时通信技术；</span><br><span class="line">熟悉相关的即时通讯协议，如XMPP、MQTT等；</span><br><span class="line">了解音视频处理技术，如音频采集、视频编码等；</span><br><span class="line">掌握JavaScript的事件处理和异步编程，实现实时通信的交互功能。</span><br></pre></td></tr></table></figure><p><strong>难点</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">实时通信协议和技术的理解和实现复杂，如WebSocket、WebRTC等；</span><br><span class="line">音视频处理技术难度大，包括音频采集、视频编码等；</span><br><span class="line">安全和隐私保护要求高，如数据加密、用户认证等。</span><br></pre></td></tr></table></figure><p><strong>市场需求度：高</strong></p><p><strong>成熟性：比较成熟，已有许多成熟的即时通讯解决方案和库，但在一些特殊需求下仍需定制开发。</strong></p><p><strong>可延展性：较好，可与其他技术集成，如人工智能聊天机器人、客服系统等，拓展应用场景。</strong></p><hr><h2 id="协同"><a href="#协同" class="headerlink" title="协同"></a>协同</h2><p><strong>简介：多人对一个项目进行编译，开发，调试</strong></p><p><strong>技术平台：协同工具平台Git，SVN版本控制系统</strong></p><p><strong>技术栈</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">了解常用的协同工具和平台，如Git、SVN等版本控制系统；</span><br><span class="line">掌握相关的代码合并、冲突解决等技术；</span><br><span class="line">熟悉实时通信技术，如WebSocket，用于实现多人实时协作的交互功能；</span><br><span class="line">了解团队协作和项目管理的流程和方法。</span><br></pre></td></tr></table></figure><p><strong>难点</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">实时通信技术的实现和优化复杂，如WebSocket的连接管理、消息推送等；</span><br><span class="line">处理多人同时操作的并发控制和数据一致性困难；</span><br><span class="line">不同开发人员的代码合并和冲突解决繁琐。</span><br></pre></td></tr></table></figure><p><strong>市场需求度：高</strong></p><p><strong>成熟性：技术在不断发展和完善中，已有一些成熟的协同工具和平台，但在一些复杂场景下仍存在挑战。</strong></p><p><strong>可延展性：强，可与各种开发工具和技术集成，拓展协同的范围和功能。</strong></p><hr><h2 id="富文本"><a href="#富文本" class="headerlink" title="富文本"></a>富文本</h2><p><strong>简介：支持用户输入和编辑丰富格式文本的功能，如加粗、斜体、图片、视频、链接等，应用于博客、内容管理系统、在线文档等场景。</strong></p><p><strong>技术平台：</strong></p><p><strong>技术栈</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">可使用成熟的富文本编辑器库，如TinyMCE、CKEditor等；</span><br><span class="line">掌握JavaScript的事件处理和DOM操作，实现对富文本内容的动态编辑和交互；</span><br><span class="line">熟悉相关的图片上传、视频嵌入等技术，以及数据存储和传输的方式。</span><br></pre></td></tr></table></figure><p><strong>难点</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">富文本编辑器的功能复杂，需要深入掌握其API和配置选项；</span><br><span class="line">处理大量文本和复杂格式时的性能优化挑战大；</span><br><span class="line">实现多人协同编辑时的冲突处理和数据同步困难。</span><br></pre></td></tr></table></figure><p><strong>市场需求度：较高</strong></p><p><strong>成熟性：比较成熟，已有许多成熟的富文本编辑器库，功能丰富，基本能满足常见需求。</strong></p><p><strong>可延展性：较好，可与其他前端技术集成，如文件上传、图片处理、数据存储等，拓展应用场景。</strong></p><hr><h2 id="3D渲染"><a href="#3D渲染" class="headerlink" title="3D渲染"></a>3D渲染</h2><p><strong>简介：在浏览器中创建和展示3D图形和场景</strong></p><p><strong>技术平台：</strong></p><p><strong>技术栈</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">掌握WebGL或WebGPU的API</span><br><span class="line">了解3D图形的基本概念，如顶点、纹理、材质等；</span><br><span class="line">熟悉相关的3D渲染引擎，如Three.js、Babylon.js等；</span><br><span class="line">掌握JavaScript的性能优化技巧，以提高3D渲染的效率；</span><br><span class="line">了解图形设计和建模工具，如Blender、Maya等，用于创建3D模型和场景。</span><br></pre></td></tr></table></figure><p><strong>难点</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3D图形学知识要求高，如顶点、纹理、材质等概念复杂；</span><br><span class="line">WebGL或WebGPU的API学习曲线陡峭，需要掌握底层图形渲染原理；</span><br><span class="line">性能优化难度大，尤其是在处理复杂场景和大量数据时。</span><br></pre></td></tr></table></figure><p><strong>市场需求度：中等偏高</strong></p><p><strong>成熟性：处于发展阶段，相关的3D渲染引擎和工具不断完善，但仍有一定的技术门槛。</strong></p><p><strong>可延展性：好，可与动画、物理引擎等技术结合，拓展3D应用的功能和场景。</strong></p><hr><h2 id="音视频"><a href="#音视频" class="headerlink" title="音视频"></a>音视频</h2><p><strong>简介：在前端实现音视频的播放、录制、编辑、直播、视频会议等功能</strong></p><p><strong>技术平台：</strong></p><p><strong>技术栈</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">掌握HTML5的 &lt;video&gt; 和 &lt;audio&gt; 标签，以及相关的API；</span><br><span class="line">了解音视频编解码技术，如H.264、AAC等；</span><br><span class="line">熟悉音视频处理库，如FFmpeg、WebRTC等；</span><br><span class="line">掌握JavaScript的事件处理和异步编程，实现音视频的交互功能。</span><br></pre></td></tr></table></figure><p><strong>难点</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">音视频编解码技术复杂，需要掌握相关的标准和算法；</span><br><span class="line">浏览器兼容性问题多，不同浏览器对音视频的支持和表现不同；</span><br><span class="line">实时音视频流的传输和处理难度大，如网络延迟、丢包等问题。</span><br></pre></td></tr></table></figure><p><strong>市场需求度：中等偏高，在线教育、视频会议、娱乐等领域对音视频功能的需求不断增长。</strong></p><p><strong>成熟性：比较成熟，HTML5的 <strong><video></strong> 和 <strong><audio></strong> 标签已得到广泛支持，相关的音视频处理库也较为完善。</strong></p><p><strong>可延展性：较好</strong></p><hr><h2 id="低代码"><a href="#低代码" class="headerlink" title="低代码"></a>低代码</h2><p><strong>简介：通过可视化界面和少量代码编写，快速构建应用程序的开发方式，旨在提高开发效率、降低技术门槛，使非专业开发人员也能参与开发。</strong></p><p><strong>技术平台：Jeecg-boot，宜搭</strong></p><p><strong>技术栈</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">精通HTML、CSS、JavaScript基础技术；</span><br><span class="line">熟悉主流的低代码平台，如Jeecg-boot、宜搭等；</span><br><span class="line">相关的前端框架，如Vue、React等</span><br><span class="line">后端技术如Spring Boot、Node.js等</span><br></pre></td></tr></table></figure><p><strong>难点</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">定制性受限，对于复杂业务逻辑和特殊需求难以满足；</span><br><span class="line">自动生成代码可能存在性能问题，如加载速度慢、响应不及时等；</span><br><span class="line">平台兼容性有待提高，不同低代码平台的组件和功能差异大。</span><br></pre></td></tr></table></figure><p><strong>市场需求度：较高</strong></p><p><strong>成熟性：处于快速发展阶段，技术和功能不断完善，已有不少成熟的低代码平台，但仍存在一些局限性。</strong></p><p><strong>可延展性：较好，可与多种技术集成，如后端开发技术、数据分析工具等，拓展应用场景。</strong></p><hr><h2 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h2><p><strong>简介：通常用于处理前端页面中的布局和排版，实现元素的灵活排列和自适应，提高页面的布局效率和响应性。</strong></p><p><strong>技术平台：</strong></p><p><strong>技术栈</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">核心是CSS的Flex布局和Grid布局</span><br><span class="line">掌握Flex布局的属性如flex-direction、flex-wrap等，以及Grid布局的相关属性和概念。</span><br><span class="line">了解JavaScript的DOM操作，以便在需要动态调整布局时进行交互操作。</span><br></pre></td></tr></table></figure><p><strong>难点</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">对CSS布局知识要求高，需深入理解Flex和Grid布局的原理和属性；</span><br><span class="line">在不同浏览器和设备上的兼容性处理复杂；</span><br><span class="line">动态布局调整时，JavaScript与CSS的交互逻辑较难把握。</span><br></pre></td></tr></table></figure><p><strong>市场需求度：中</strong></p><p><strong>成熟性：相对成熟，CSS的Flex和Grid布局已得到广泛支持，相关的布局库和框架也较为完善。</strong></p><p><strong>可延展性：一般，主要围绕页面布局和排版进行扩展，如与动画效果、交互组件等结合。</strong></p>]]></content>
      
      
      <categories>
          
          <category> 技术探索 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>网页视频捕获工具</title>
      <link href="/2025/03/08/%E5%B7%A5%E5%85%B7/%E7%BD%91%E9%A1%B5%E8%A7%86%E9%A2%91%E6%8D%95%E8%8E%B7%E5%B7%A5%E5%85%B7/"/>
      <url>/2025/03/08/%E5%B7%A5%E5%85%B7/%E7%BD%91%E9%A1%B5%E8%A7%86%E9%A2%91%E6%8D%95%E8%8E%B7%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="网页视频捕获工具"><a href="#网页视频捕获工具" class="headerlink" title="网页视频捕获工具"></a>网页视频捕获工具</h1><h2 id="本地解析工具"><a href="#本地解析工具" class="headerlink" title="本地解析工具"></a>本地解析工具</h2><p><strong>基于Windows系统</strong></p><blockquote><p><a href="https://mkvtoolnix.download/downloads.html#windows">MKVToolNix Downloads – Matroska tools for Linux&#x2F;Unix and Windows</a></p></blockquote><p><strong>（当然网站里也有其他系统的工具，只是我没用用过）</strong></p><p>**下载后解压出来 **<code>MKVToolNix</code> 文件夹</p><p>**启动项是 **<code>mkvtoolnix-gui.exe</code></p><p><img src="/upload/image-20250128160924228.png" alt="image-20250128160924228.png"></p><h2 id="浏览器脚本"><a href="#浏览器脚本" class="headerlink" title="浏览器脚本"></a>浏览器脚本</h2><p><code>media-source-extract</code> 装到油猴里（文件放在最后了）</p><p><img src="/upload/image-20250128160910518.png" alt="image-20250128160910518.png"></p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p><img src="/upload/image-20250128163554230.png" alt="image-20250128163554230.png"></p><h2 id="脚本文件"><a href="#脚本文件" class="headerlink" title="脚本文件"></a><em>脚本文件</em></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br></pre></td><td class="code"><pre><span class="line">// ==UserScript==</span><br><span class="line">// @name         media-source-extract</span><br><span class="line">// @namespace    https://github.com/Momo707577045/media-source-extract</span><br><span class="line">// @version      0.8.2</span><br><span class="line">// @description  https://github.com/Momo707577045/media-source-extract 配套插件</span><br><span class="line">// @author       Momo707577045</span><br><span class="line">// @include      *</span><br><span class="line">// @exclude      http://blog.luckly-mjw.cn/tool-show/media-source-extract/player/player.html</span><br><span class="line">// @downloadURL https://blog.luckly-mjw.cn/tool-show/media-source-extract/media-source-extract.user.js</span><br><span class="line">// @updateURL   https://blog.luckly-mjw.cn/tool-show/media-source-extract/media-source-extract.user.js</span><br><span class="line">// @grant        none</span><br><span class="line">// @run-at document-start</span><br><span class="line">// ==/UserScript==</span><br><span class="line"></span><br><span class="line">(function () &#123;</span><br><span class="line">  &#x27;use strict&#x27;;</span><br><span class="line">  (function () &#123;</span><br><span class="line">    if (document.getElementById(&#x27;media-source-extract&#x27;)) &#123;</span><br><span class="line">      return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 复写 call 函数，绕过劫持检查</span><br><span class="line">    Function.prototype.toString.call = function (caller) &#123;</span><br><span class="line">      return `&#x27;function $&#123;caller.name&#125;() &#123; [native code] &#125;&#x27;`</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 轮询监听 iframe 的加载</span><br><span class="line">    setInterval(() =&gt; &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        Array.prototype.forEach.call(document.getElementsByTagName(&#x27;iframe&#x27;), (iframe) =&gt; &#123;</span><br><span class="line">          // 若 iframe 使用了 sandbox 进行操作约束，删除原有 iframe，拷贝其备份，删除 sandbox 属性，重新载入</span><br><span class="line">          // 若 iframe 已载入，再修改 sandbox 属性，将修改无效。故通过新建 iframe 的方式绕过</span><br><span class="line">          if (iframe.hasAttribute(&#x27;sandbox&#x27;)) &#123;</span><br><span class="line">            const parentNode = iframe.parentNode;</span><br><span class="line">            const tempIframe = iframe.cloneNode()</span><br><span class="line">            tempIframe.removeAttribute(&quot;sandbox&quot;);</span><br><span class="line">            iframe.remove()</span><br><span class="line">            parentNode.appendChild(tempIframe);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, 1000)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    let sumFragment = 0 // 已经捕获的所有片段数</span><br><span class="line">    let isClose = false // 是否关闭</span><br><span class="line">    let isStreamDownload = false // 是否使用流式下载</span><br><span class="line">    let _sourceBufferList = [] // 媒体轨道</span><br><span class="line">    const $showBtn = document.createElement(&#x27;div&#x27;) // 展示按钮</span><br><span class="line">    const $btnDownload = document.createElement(&#x27;div&#x27;) // 下载按钮</span><br><span class="line">    const $btnStreamDownload = document.createElement(&#x27;div&#x27;) // 流式下载按钮</span><br><span class="line">    const $downloadNum = document.createElement(&#x27;div&#x27;) // 已捕获视频片段数</span><br><span class="line">    const $tenRate = document.createElement(&#x27;div&#x27;) // 十倍速播放</span><br><span class="line">    const $closeBtn = document.createElement(&#x27;div&#x27;) // 关闭</span><br><span class="line">    const $container = document.createElement(&#x27;div&#x27;) // 容器</span><br><span class="line">    $closeBtn.innerHTML = `</span><br><span class="line">    &lt;img style=&quot;</span><br><span class="line">      padding-top: 4px;</span><br><span class="line">      width: 24px;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">    &quot; src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAk1BMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ROyVeAAAAMHRSTlMA1Sq7gPribxkJx6Ey8onMsq+GTe10QF8kqJl5WEcvIBDc0sHAkkk1FgO2ZZ+dj1FHfPqwAAACNElEQVRIx6VW6ZqqMAwtFlEW2Rm3EXEfdZa+/9PdBEvbIVXu9835oW1yjiQlTWQE/iYPuTObOTzMNz4bQFRlY2FgnFXRC/o01mytiafP+BPvQZk56bcLSOXem1jpCy4QgXvRtlEVCARfUP65RM/hp29/+0R7eSbhoHlnffZ8h76e6x1tyw9mxXaJ3nfTVLd89hQr9NfGceJxfLIXmONh6eNNYftNSESRmgkHlEOjmhgBbYcEW08FFQN/ro6dvAczjhgXEdQP76xHEYxM+igQq259gLrCSlwbD3iDtTMy+A4Yuk0B6zV8c+BcO2OgFIp/UvJdG4o/Rp1JQYXeZFflPEFMfvugiFGFXN587YtgX7C8lRGFXPCGGYCCzlkoxJ4xqmi/jrIcdYYh5pwxiwI/gt7lDDFrcLiMKhBJ//W78ENsJgVUsV8wKpjZBXshM6cCW0jbRAilICFxIpgGMmmiWGHSIR6ViY+DPFaqSJCbQ5mbxoZLIlU0Al/cBj6N1uXfFI0okLppi69StmumSFQRP6oIKDedFi3vRDn3j6KozCZlu0DdJb3AupJXNLmqkk9+X9FEHLt1Jq8oi1H5n01AtRlvwQZQl9hmtPY4JEjMDs5ftWJN4Xr4lLrV2OHiUDHCPgvA/Tn/hP4zGUBfjZ3eLJ+NIOfHxi8CMoAQtYfmw93v01O0e7VlqqcCsXML3Vsu94cxnb4c7ML5chG8JIP9b38dENGaj3+x+TpiA/AL/fen8In7H8l3ZjdJQt2TAAAAAElFTkSuQmCC&quot;&gt;`</span><br><span class="line">    $showBtn.innerHTML = `</span><br><span class="line">    &lt;img style=&quot;</span><br><span class="line">      padding-top: 4px;</span><br><span class="line">      width: 24px;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">    &quot; src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADIBAMAAABfdrOtAAAAElBMVEUAAAD///////////////////8+Uq06AAAABXRSTlMA2kCAv5tF5NoAAAErSURBVHja7dzNasJAFIbhz8Tu7R0Eq/vQNHuxzL6YnPu/ldYpAUckxJ8zSnjfdTIPzHrOUawJdqmDJre1S/X7avigbM08kMgMSmt+iPWKbcwTsb3+KswXseOFLb2RnaTgjXTxtpwRq7XMgWz9kZ8cSKcwE6SX+SMGAgICAvJCyHdz2ud0pEx+/BpFaj2kEgQEBAQEBAQEBOT1kXWSkhbvk1vptOLs1LEWNrmVRgIBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBeTayTqpufogxduqM3q2AgICAgICAgICA3IOko4ZXkB/pqOHzhyZBQEBAQLIieVahtDNBDnrLgZT+yC4HUkmtN9JnWUiVZbVWliVhseCJdPqvCH5IV2tQNl4r6Bod+wWq9eeDik+xFQAAAABJRU5ErkJggg==&quot;&gt;`</span><br><span class="line"></span><br><span class="line">    // 十倍速播放</span><br><span class="line">    function _tenRatePlay() &#123;</span><br><span class="line">      let playbackRate = 10</span><br><span class="line">      if ($tenRate.innerHTML === &#x27;十倍速捕获&#x27;) &#123;</span><br><span class="line">        $tenRate.innerHTML = &#x27;恢复正常播放&#x27;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        playbackRate = 1</span><br><span class="line">        $tenRate.innerHTML = &#x27;十倍速捕获&#x27;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      let $domList = document.getElementsByTagName(&#x27;video&#x27;)</span><br><span class="line">      for (let i = 0, length = $domList.length; i &lt; length; i++) &#123;</span><br><span class="line">        const $dom = $domList[i]</span><br><span class="line">        $dom.playbackRate = playbackRate</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 获取顶部 window title，因可能存在跨域问题，故使用 try catch 进行保护</span><br><span class="line">    function getDocumentTitle() &#123;</span><br><span class="line">      let title = document.title;</span><br><span class="line">      try &#123;</span><br><span class="line">        title = window.top.document.title</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">      &#125;</span><br><span class="line">      return title</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 流式下载</span><br><span class="line">    function _streamDownload() &#123;</span><br><span class="line">      var _hmt = _hmt || [];</span><br><span class="line">      (function () &#123;</span><br><span class="line">        var hm = document.createElement(&quot;script&quot;);</span><br><span class="line">        hm.src = &quot;https://hm.baidu.com/hm.js?1f12b0865d866ae1b93514870d93ce89&quot;;</span><br><span class="line">        var s = document.getElementsByTagName(&quot;script&quot;)[0];</span><br><span class="line">        s.parentNode.insertBefore(hm, s);</span><br><span class="line">      &#125;)();</span><br><span class="line"></span><br><span class="line">      // 对应状态未下载结束的媒体轨道</span><br><span class="line">      const remainSourceBufferList = []</span><br><span class="line">      _sourceBufferList.forEach((target) =&gt; &#123;</span><br><span class="line">        // 对应的 MSE 状态为已下载完成状态</span><br><span class="line">        if (target.MSEInstance.readyState === &#x27;ended&#x27;) &#123;</span><br><span class="line">          target.streamWriter.close()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          remainSourceBufferList.push(target)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      // 流式下载，释放已下载完成的媒体轨道，回收内存</span><br><span class="line">      _sourceBufferList = remainSourceBufferList</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 普通下载</span><br><span class="line">    function _download() &#123;</span><br><span class="line">      var _hmt = _hmt || [];</span><br><span class="line">      (function () &#123;</span><br><span class="line">        var hm = document.createElement(&quot;script&quot;);</span><br><span class="line">        hm.src = &quot;https://hm.baidu.com/hm.js?1f12b0865d866ae1b93514870d93ce89&quot;;</span><br><span class="line">        var s = document.getElementsByTagName(&quot;script&quot;)[0];</span><br><span class="line">        s.parentNode.insertBefore(hm, s);</span><br><span class="line">      &#125;)();</span><br><span class="line"></span><br><span class="line">      _sourceBufferList.forEach((target) =&gt; &#123;</span><br><span class="line">        const mime = target.mime.split(&#x27;;&#x27;)[0]</span><br><span class="line">        const type = mime.split(&#x27;/&#x27;)[1]</span><br><span class="line">        const fileBlob = new Blob(target.bufferList, &#123; type: mime &#125;) // 创建一个Blob对象，并设置文件的 MIME 类型</span><br><span class="line">        const a = document.createElement(&#x27;a&#x27;)</span><br><span class="line">        a.download = `$&#123;getDocumentTitle()&#125;.$&#123;type&#125;`</span><br><span class="line">        a.href = URL.createObjectURL(fileBlob)</span><br><span class="line">        a.style.display = &#x27;none&#x27;</span><br><span class="line">        document.body.appendChild(a)</span><br><span class="line">        // 禁止 click 事件冒泡，避免全局拦截</span><br><span class="line">        a.onclick = function (e) &#123;</span><br><span class="line">          e.stopPropagation();</span><br><span class="line">        &#125;</span><br><span class="line">        a.click()</span><br><span class="line">        a.remove()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 监听资源全部录取成功</span><br><span class="line">    let _endOfStream = window.MediaSource.prototype.endOfStream</span><br><span class="line">    window.MediaSource.prototype.endOfStream = function endOfStream() &#123;</span><br><span class="line">      if (isStreamDownload) &#123;</span><br><span class="line">        alert(&#x27;资源全部捕获成功，即将下载！&#x27;)</span><br><span class="line">        setTimeout(_streamDownload) // 等待 MediaSource 状态变更</span><br><span class="line">        _endOfStream.call(this)</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (confirm(&#x27;资源全部捕获成功，即将下载！&#x27;) == true) &#123;</span><br><span class="line">        _download()</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // 不下载资源</span><br><span class="line">      &#125;</span><br><span class="line">      _endOfStream.call(this)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 录取资源</span><br><span class="line">    let _addSourceBuffer = window.MediaSource.prototype.addSourceBuffer</span><br><span class="line">    window.MediaSource.prototype.addSourceBuffer = function addSourceBuffer(mime) &#123;</span><br><span class="line">      _appendDom()</span><br><span class="line">      let sourceBuffer = _addSourceBuffer.call(this, mime)</span><br><span class="line">      let _append = sourceBuffer.appendBuffer</span><br><span class="line">      let bufferList = []</span><br><span class="line">      const _sourceBuffer = &#123;</span><br><span class="line">        mime,</span><br><span class="line">        bufferList,</span><br><span class="line">        MSEInstance: this,</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // 如果 streamSaver 已提前加载完成，则初始化对应的 streamWriter</span><br><span class="line">      try &#123;</span><br><span class="line">        if (window.streamSaver) &#123;</span><br><span class="line">          const type = mime.split(&#x27;;&#x27;)[0].split(&#x27;/&#x27;)[1]</span><br><span class="line">          _sourceBuffer.streamWriter = streamSaver.createWriteStream(`$&#123;getDocumentTitle()&#125;.$&#123;type&#125;`).getWriter()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.error(error)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      _sourceBufferList.push(_sourceBuffer)</span><br><span class="line">      sourceBuffer.appendBuffer = function (buffer) &#123;</span><br><span class="line">        sumFragment++</span><br><span class="line">        $downloadNum.innerHTML = `已捕获 $&#123;sumFragment&#125; 个片段`</span><br><span class="line"></span><br><span class="line">        if (isStreamDownload &amp;&amp; _sourceBuffer.streamWriter) &#123; // 流式下载</span><br><span class="line">          _sourceBuffer.streamWriter.write(new Uint8Array(buffer));</span><br><span class="line">        &#125; else &#123; // 普通 blob 下载</span><br><span class="line">          bufferList.push(buffer)</span><br><span class="line">        &#125;</span><br><span class="line">        _append.call(this, buffer)</span><br><span class="line">      &#125;</span><br><span class="line">      return sourceBuffer</span><br><span class="line">    &#125;</span><br><span class="line">    window.MediaSource.prototype.addSourceBuffer.toString = function toString() &#123;</span><br><span class="line">      return &#x27;function addSourceBuffer() &#123; [native code] &#125;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 添加操作的 dom</span><br><span class="line">    function _appendDom() &#123;</span><br><span class="line">      if (document.getElementById(&#x27;media-source-extract&#x27;)) &#123;</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">      $container.style = `</span><br><span class="line">      position: fixed;</span><br><span class="line">      top: 50px;</span><br><span class="line">      right: 50px;</span><br><span class="line">      text-align: right;</span><br><span class="line">      z-index: 9999;</span><br><span class="line">      `</span><br><span class="line">      const baseStyle = `</span><br><span class="line">      float:right;</span><br><span class="line">      clear:both;</span><br><span class="line">      margin-top: 10px;</span><br><span class="line">      padding: 0 20px;</span><br><span class="line">      color: white;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">      font-size: 16px;</span><br><span class="line">      font-weight: bold;</span><br><span class="line">      line-height: 40px;</span><br><span class="line">      text-align: center;</span><br><span class="line">      border-radius: 4px;</span><br><span class="line">      background-color: #3498db;</span><br><span class="line">      box-shadow: 0 3px 6px 0 rgba(0, 0, 0, 0.3);</span><br><span class="line">    `</span><br><span class="line">      $tenRate.innerHTML = &#x27;十倍速捕获&#x27;</span><br><span class="line">      $downloadNum.innerHTML = &#x27;已捕获 0 个片段&#x27;</span><br><span class="line">      $btnStreamDownload.innerHTML = &#x27;特大视频下载，边下载边保存&#x27;</span><br><span class="line">      $btnDownload.innerHTML = &#x27;下载已捕获片段&#x27;</span><br><span class="line">      $btnDownload.id = &#x27;media-source-extract&#x27;</span><br><span class="line">      $tenRate.style = baseStyle</span><br><span class="line">      $downloadNum.style = baseStyle</span><br><span class="line">      $btnDownload.style = baseStyle</span><br><span class="line">      $btnStreamDownload.style = baseStyle</span><br><span class="line">      $btnStreamDownload.style.display = &#x27;none&#x27;</span><br><span class="line">      $showBtn.style = `</span><br><span class="line">      float:right;</span><br><span class="line">      clear:both;</span><br><span class="line">      display: none;</span><br><span class="line">      margin-top: 4px;</span><br><span class="line">      height: 34px;</span><br><span class="line">      width: 34px;</span><br><span class="line">      line-height: 34px;</span><br><span class="line">      text-align: center;</span><br><span class="line">      border-radius: 4px;</span><br><span class="line">      background-color: rgba(0, 0, 0, 0.5);</span><br><span class="line">      `</span><br><span class="line">      $closeBtn.style = `</span><br><span class="line">      float:right;</span><br><span class="line">      clear:both;</span><br><span class="line">      margin-top: 10px;</span><br><span class="line">      height: 34px;</span><br><span class="line">      width: 34px;</span><br><span class="line">      line-height: 34px;</span><br><span class="line">      text-align: center;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      border-radius: 50%;</span><br><span class="line">      background-color: rgba(0, 0, 0, 0.5);</span><br><span class="line">      `</span><br><span class="line"></span><br><span class="line">      $btnDownload.addEventListener(&#x27;click&#x27;, _download)</span><br><span class="line">      $tenRate.addEventListener(&#x27;click&#x27;, _tenRatePlay)</span><br><span class="line"></span><br><span class="line">      // 关闭控制面板</span><br><span class="line">      $closeBtn.addEventListener(&#x27;click&#x27;, function () &#123;</span><br><span class="line">        $downloadNum.style.display = &#x27;none&#x27;</span><br><span class="line">        $btnStreamDownload.style.display = &#x27;none&#x27;</span><br><span class="line">        $btnDownload.style.display = &#x27;none&#x27;</span><br><span class="line">        $closeBtn.style.display = &#x27;none&#x27;</span><br><span class="line">        $tenRate.style.display = &#x27;none&#x27;</span><br><span class="line">        $showBtn.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        isClose = true</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      // 显示控制面板</span><br><span class="line">      $showBtn.addEventListener(&#x27;click&#x27;, function () &#123;</span><br><span class="line">        if (!isStreamDownload) &#123;</span><br><span class="line">          $btnDownload.style.display = &#x27;inline-block&#x27;</span><br><span class="line">          $btnStreamDownload.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">        $downloadNum.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        $closeBtn.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        $tenRate.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        $showBtn.style.display = &#x27;none&#x27;</span><br><span class="line">        isClose = false</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      // 启动流式下载</span><br><span class="line">      $btnStreamDownload.addEventListener(&#x27;click&#x27;, function () &#123;</span><br><span class="line">        (function () &#123;</span><br><span class="line">          var hm = document.createElement(&quot;script&quot;);</span><br><span class="line">          hm.src = &quot;https://hm.baidu.com/hm.js?1f12b0865d866ae1b93514870d93ce89&quot;;</span><br><span class="line">          var s = document.getElementsByTagName(&quot;script&quot;)[0];</span><br><span class="line">          s.parentNode.insertBefore(hm, s);</span><br><span class="line">        &#125;)();</span><br><span class="line">        isStreamDownload = true</span><br><span class="line">        $btnDownload.style.display = &#x27;none&#x27;</span><br><span class="line">        $btnStreamDownload.style.display = &#x27;none&#x27;</span><br><span class="line">        _sourceBufferList.forEach(sourceBuffer =&gt; &#123;</span><br><span class="line">          if (!sourceBuffer.streamWriter) &#123;</span><br><span class="line">            const type = sourceBuffer.mime.split(&#x27;;&#x27;)[0].split(&#x27;/&#x27;)[1]</span><br><span class="line">            sourceBuffer.streamWriter = streamSaver.createWriteStream(`$&#123;getDocumentTitle()&#125;.$&#123;type&#125;`).getWriter()</span><br><span class="line">            sourceBuffer.bufferList.forEach(buffer =&gt; &#123;</span><br><span class="line">              sourceBuffer.streamWriter.write(new Uint8Array(buffer));</span><br><span class="line">            &#125;)</span><br><span class="line">            sourceBuffer.bufferList = []</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      document.getElementsByTagName(&#x27;html&#x27;)[0].insertBefore($container, document.getElementsByTagName(&#x27;head&#x27;)[0]);</span><br><span class="line">      $container.appendChild($btnStreamDownload)</span><br><span class="line">      $container.appendChild($downloadNum)</span><br><span class="line">      $container.appendChild($btnDownload)</span><br><span class="line">      $container.appendChild($tenRate)</span><br><span class="line">      $container.appendChild($closeBtn)</span><br><span class="line">      $container.appendChild($showBtn)</span><br><span class="line"></span><br><span class="line">      // 加载 stream 流式下载器</span><br><span class="line">      try &#123;</span><br><span class="line">        let $streamSaver = document.createElement(&#x27;script&#x27;)</span><br><span class="line">        $streamSaver.src = &#x27;https://upyun.luckly-mjw.cn/lib/stream-saver.js&#x27;</span><br><span class="line">        document.body.appendChild($streamSaver);</span><br><span class="line">        $streamSaver.addEventListener(&#x27;load&#x27;, () =&gt; &#123;</span><br><span class="line">          $btnStreamDownload.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.error(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)()</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>GitHub改名</title>
      <link href="/2025/03/08/Github/%E6%9B%B4%E6%94%B9%20GitHub%20%E7%94%A8%E6%88%B7%E5%90%8D%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/"/>
      <url>/2025/03/08/Github/%E6%9B%B4%E6%94%B9%20GitHub%20%E7%94%A8%E6%88%B7%E5%90%8D%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="更改-GitHub-用户名注意事项"><a href="#更改-GitHub-用户名注意事项" class="headerlink" title="更改 GitHub 用户名注意事项"></a><strong>更改 GitHub 用户名注意事项</strong></h1><h2 id="更改前须知"><a href="#更改前须知" class="headerlink" title="更改前须知"></a>更改前须知</h2><p><strong>首先，更改用户名不会删除仓库或提交历史。</strong></p><p>**旧用户名下的仓库 URL（如 ****<code>https://github.com/旧用户名/repo</code>）会 **自动重定向到新地址</p><p><em><strong>但</strong>：</em> &#x2F;&#x2F;&#x2F;<strong>重定向仅保留几个月，之后可能失效，建议尽快更新所有引用</strong>&#x2F;&#x2F;&#x2F;</p><p>****&#x2F;&#x2F;&#x2F;<strong>如果旧用户名被他人注册，重定向会失效</strong>&#x2F;&#x2F;&#x2F;</p><p>****&#x2F;&#x2F;&#x2F;<strong>依赖旧 URL 的服务（如 CI&#x2F;CD、书签）需手动更新</strong>&#x2F;&#x2F;&#x2F;</p><p><strong>注意</strong>：</p><ul><li><strong>确保本地仓库已与远程同步（</strong><code>git push</code>）。</li><li><strong>导出仓库列表（可选，用于后续检查）。</strong></li></ul><p><strong>检查依赖项</strong>：</p><ul><li><strong>第三方服务（如 CI&#x2F;CD、域名绑定、OAuth 登录）是否依赖你的旧用户名。</strong></li><li><strong>文档、README、外部链接中是否有直接引用旧用户名的 URL。</strong></li></ul><h2 id="更改用户名"><a href="#更改用户名" class="headerlink" title="更改用户名"></a><strong>更改用户名</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GitHub，Settings → Account → Change username</span><br></pre></td></tr></table></figure><h2 id="更改后"><a href="#更改后" class="headerlink" title="更改后"></a>更改后</h2><p><strong>所有本地仓库的远程 URL 需手动更新：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前远程 URL（格式为旧用户名）</span><br><span class="line">git remote -v</span><br><span class="line"></span><br><span class="line"># 更新远程 URL（替换为新用户名）</span><br><span class="line">git remote set-url origin https://github.com/新用户名/仓库名.git</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>主页profile美化</title>
      <link href="/2025/03/08/Github/%E4%BF%9D%E5%A7%86%E7%BA%A7GitHub%E4%B8%BB%E9%A1%B5%E7%BE%8E%E5%8C%96%E6%95%99%E7%A8%8B/"/>
      <url>/2025/03/08/Github/%E4%BF%9D%E5%A7%86%E7%BA%A7GitHub%E4%B8%BB%E9%A1%B5%E7%BE%8E%E5%8C%96%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="保姆级GitHub主页美化教程"><a href="#保姆级GitHub主页美化教程" class="headerlink" title="保姆级GitHub主页美化教程"></a>保姆级GitHub主页美化教程</h1><p><img src="https://bu.dusays.com/2025/04/03/67ee9d10540d0.png" alt="image-omub.png"></p><p><strong>实际上这些都存在一个README文件里</strong></p><p><strong>下面我们来一步一步建设你的GitHub主页</strong></p><h3 id="GitHub中的初始操作"><a href="#GitHub中的初始操作" class="headerlink" title="GitHub中的初始操作"></a>GitHub中的初始操作</h3><p><img src="https://bu.dusays.com/2025/04/03/67ee993411203.png" alt="image-20241109134411796.png"></p><p><img src="https://bu.dusays.com/2025/04/03/67ee996eb9961.png" alt="image-20250203234004362.png"></p><p>复制仓库地址</p><p><img src="https://bu.dusays.com/2025/04/03/67ee996bcc98c.png" alt="image-isgp.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">找一个你想要存储在本地的文件地址</span><br><span class="line">右键Open Git Bash here</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee996b63d18.png" alt="image-20241109140014319.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone +Paste把刚才复制的地址粘贴过来    回车</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee996c1f224.png" alt="image-20241109140335008.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tip:如果有报错很多情况是梯子不稳定，没有连接到git仓库，多关闭刷新反复试试</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee996c2fe64.png" alt="image-20241109140636576.png"></p><h2 id="编译器"><a href="#编译器" class="headerlink" title="编译器"></a>编译器</h2><p><strong>这里拿VS Code示范</strong></p><h3 id="需要安装的插件"><a href="#需要安装的插件" class="headerlink" title="需要安装的插件"></a>需要安装的插件</h3><p><img src="https://bu.dusays.com/2025/04/03/67ee99362db03.png" alt="image-20241109133836426.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">下载完插件之后</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee993b71331.png" alt="image-20241109134227028.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">所编写的组件是按顺序排列的</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee9971ebdea.png" alt="image-20241109135735804.png"></p><h4 id="代码结构详解"><a href="#代码结构详解" class="headerlink" title="代码结构详解"></a>代码结构详解</h4><p><img src="https://bu.dusays.com/2025/04/03/67ee99740993b.png" alt="image-20241109141238195.png"></p><h4 id="一般格式模板"><a href="#一般格式模板" class="headerlink" title="一般格式模板"></a>一般格式模板</h4><p><strong>（可以先复制到自己的编译器里）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;p align=&quot;center&quot;&gt;</span><br><span class="line">  &lt;img src=&quot;&quot; /&gt;</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">下面我们来逐一实现组件的代码</span><br></pre></td></tr></table></figure><h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><h3 id="海浪效果边饰"><a href="#海浪效果边饰" class="headerlink" title="海浪效果边饰"></a>海浪效果边饰</h3><p><strong>网站</strong></p><p><a href="https://capsule-render.vercel.app/">https://capsule-render.vercel.app/</a></p><p><img src="https://bu.dusays.com/2025/04/03/67ee993f06de3.png" alt="image-20241108231511744.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">左侧选择完后</span><br><span class="line">点击右侧“Copy”</span><br><span class="line">复制到模板的“src”属性后</span><br></pre></td></tr></table></figure><p><strong>更多具体样式参考</strong></p><p><a href="https://github.com/kyechan99/capsule-render?tab=readme-ov-file#color">https://github.com/kyechan99/capsule-render?tab=readme-ov-file#color</a></p><p><img src="https://bu.dusays.com/2025/04/03/67ee993597645.png" alt="image-20241108231452249.png"></p><h3 id="打字机动画"><a href="#打字机动画" class="headerlink" title="打字机动画"></a>打字机动画</h3><p><strong>网站</strong></p><p><a href="https://readme-typing-svg.demolab.com/demo/">https://readme-typing-svg.demolab.com/demo/</a></p><p><img src="https://bu.dusays.com/2025/04/03/67ee993d28549.png" alt="image-20241108230812485.png"></p><h3 id="技术栈图标"><a href="#技术栈图标" class="headerlink" title="技术栈图标"></a>技术栈图标</h3><p><strong>网站（需要挂梯子）</strong></p><p><a href="https://marwin1991.github.io/profile-technology-icons/">https://marwin1991.github.io/profile-technology-icons/</a></p><p><img src="https://bu.dusays.com/2025/04/03/67ee993feb07a.png" alt="image-20241108225831578.png"></p><h3 id="贡献热度表"><a href="#贡献热度表" class="headerlink" title="贡献热度表"></a>贡献热度表</h3><p><strong>网站</strong></p><p><a href="https://github-readme-streak-stats.herokuapp.com/demo/">https://github-readme-streak-stats.herokuapp.com/demo/</a></p><p><img src="https://bu.dusays.com/2025/04/03/67ee9996225ee.png" alt="image-20241109150452284.png"></p><h3 id="卡片"><a href="#卡片" class="headerlink" title="卡片"></a>卡片</h3><p><strong>网站</strong></p><p><a href="https://tools.bugdesigner.cn/#/gen_card">https://tools.bugdesigner.cn/#/gen_card</a></p><h4 id="个人指标模块"><a href="#个人指标模块" class="headerlink" title="个人指标模块"></a>个人指标模块</h4><p><img src="https://bu.dusays.com/2025/04/03/67ee993de311f.png" alt="image-20241108231807726.png"></p><p><strong>更多主题</strong></p><p><a href="https://github.com/anuraghazra/github-readme-stats">https://github.com/anuraghazra/github-readme-stats</a></p><p><img src="https://bu.dusays.com/2025/04/03/67ee997514304.png" alt="image-20241109142125669.png"></p><p>**主题修改详情见上文“**<strong>代码结构详解</strong>”</p><p><strong>还是卡片的那个网站</strong></p><p><a href="https://tools.bugdesigner.cn/#/gen_card">https://tools.bugdesigner.cn/#/gen_card</a></p><h4 id="常用语言模块"><a href="#常用语言模块" class="headerlink" title="常用语言模块"></a>常用语言模块</h4><p><img src="https://bu.dusays.com/2025/04/03/67ee99765d728.png" alt="image-20241109142657266.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注：复制代码需要保证username属性更改为自己的</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theme属性可以自行添加，和个人指标模块可用的主题一致</span><br></pre></td></tr></table></figure><h4 id="仓库固定模块"><a href="#仓库固定模块" class="headerlink" title="仓库固定模块"></a>仓库固定模块</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可将某些仓库固定在README中展示</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee996a1794b.png" alt="image-20241109143443105.png"></p><p><img src="https://bu.dusays.com/2025/04/03/67ee9992aead6.png" alt="image-20241109143412576.png"></p><h4 id="WakaTime-统计卡"><a href="#WakaTime-统计卡" class="headerlink" title="WakaTime 统计卡"></a>WakaTime 统计卡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">根据以上操作，想必你已经收悉了大致流程，该WakaTime的部署方式与上述操作一致</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee9992bf317.png" alt="image-20241109143646929.png"></p><p>详情见  <a href="https://capsule-render.vercel.app/">https://capsule-render.vercel.app/</a></p><h3 id="贪吃蛇"><a href="#贪吃蛇" class="headerlink" title="贪吃蛇"></a>贪吃蛇</h3><p><strong>参考视频：</strong><a href="https://www.bilibili.com/video/BV1W94y1v7cB/?spm_id_from=333.337.search-card.all.click">给Github主页加上贪吃蛇效果，让你的主页与众不同<em>哔哩哔哩</em>bilibili</a></p><p><strong>不太好配置，建议每一步都跟着来</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">创建main.yml文件</span><br><span class="line">文件路径:</span><br><span class="line">.github/workflows/main.yml</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee99932b45f.png" alt="image-20241109144506704.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将以下内容复制到main.yml文件中</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">name: generate animation</span><br><span class="line"></span><br><span class="line">on:</span><br><span class="line">  # run automatically every 24 hours</span><br><span class="line">  schedule:</span><br><span class="line">    - cron: &#x27;0 */24 * * *&#x27;</span><br><span class="line"></span><br><span class="line">  # allows to manually run the job at any time</span><br><span class="line">  workflow_dispatch:</span><br><span class="line"></span><br><span class="line">  # run on every push on the master branch</span><br><span class="line">  push:</span><br><span class="line">    branches:</span><br><span class="line">      - main</span><br><span class="line"></span><br><span class="line">jobs:</span><br><span class="line">  generate:</span><br><span class="line">    runs-on: ubuntu-latest</span><br><span class="line">    timeout-minutes: 10</span><br><span class="line"></span><br><span class="line">    steps:</span><br><span class="line">      # generates a snake game from a github user (&lt;github_user_name&gt;) contributions graph, output a svg animation at &lt;svg_out_path&gt;</span><br><span class="line">      - name: generate github-contribution-grid-snake.svg</span><br><span class="line">        uses: Platane/snk/svg-only@v3</span><br><span class="line">        with:</span><br><span class="line">          github_user_name: $&#123;&#123; github.repository_owner &#125;&#125;</span><br><span class="line">          outputs: |</span><br><span class="line">            dist/github-contribution-grid-snake.svg</span><br><span class="line">            dist/github-contribution-grid-snake-dark.svg?palette=github-dark</span><br><span class="line">        env:</span><br><span class="line">          GITHUB_TOKEN: $&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125;</span><br><span class="line"></span><br><span class="line">      # push the content of &lt;build_dir&gt; to a branch</span><br><span class="line">      # the content will be available at https://raw.githubusercontent.com/&lt;github_user&gt;/&lt;repository&gt;/&lt;target_branch&gt;/&lt;file&gt; , or as github page</span><br><span class="line">      - name: push github-contribution-grid-snake.svg to the output branch</span><br><span class="line">        uses: crazy-max/ghaction-github-pages@v3.1.0</span><br><span class="line">        with:</span><br><span class="line">          target_branch: output</span><br><span class="line">          build_dir: dist</span><br><span class="line">        env:</span><br><span class="line">          GITHUB_TOKEN: $&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>README.md贪吃蛇代码</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意更改用户名</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;picture&gt;</span><br><span class="line">  &lt;source media=&quot;(prefers-color-scheme: dark)&quot; srcset=&quot;https://raw.githubusercontent.com/用户名/用户名/output/github-contribution-grid-snake-dark.svg&quot;&gt;</span><br><span class="line">  &lt;source media=&quot;(prefers-color-scheme: light)&quot; srcset=&quot;https://raw.githubusercontent.com/用户名/用户名/output/github-contribution-grid-snake.svg&quot;&gt;</span><br><span class="line">  &lt;img alt=&quot;github contribution grid snake animation&quot; src=&quot;https://raw.githubusercontent.com/用户名/用户名/output/github-contribution-grid-snake.svg&quot;&gt;</span><br><span class="line">&lt;/picture&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">此时你的预览中看不见贪吃蛇的组件，这是正常现象，我们接着下一步走</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">提交你的本地代码到GitHub仓库，详情见下文“提交本地代码至GitHub”</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">main.yml文件的本质会创建一个output分支并推送代码，但是执行此操作GitHub需要配置一定的权限</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee99956ac52.png" alt="image-20241109145536992.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">以上方法授予工作流读写权限后</span><br><span class="line">到Action目录，点击Re-run jobs的Re-run，重新执行失败的任务</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee9993c479c.png" alt="image-20241109145648691.png"></p><p><strong>等待三五分钟之后即可完成贪吃蛇的部署</strong></p><h2 id="提交本地代码至GitHub"><a href="#提交本地代码至GitHub" class="headerlink" title="提交本地代码至GitHub"></a>提交本地代码至GitHub</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">提一嘴Open Git Bash here的地址</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/04/03/67ee9992c7baa.png" alt="image-20241109143924621.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">依次执行(对空格和英文双引号有严格要求)</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;init&quot;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><h2 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h2><p><strong>到此所有步骤就结束啦，还有一些没提到的组件网站放在这里，大家感兴趣的可以尝试尝试</strong></p><p><a href="https://shields.io/">https://shields.io/</a><br><a href="https://quira.sh/">https://quira.sh/</a><br><a href="https://progvtblogo.asanatsa.cc/">https://progvtblogo.asanatsa.cc/</a></p>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>新版git推送注意点</title>
      <link href="/2025/03/08/Github/%E6%96%B0%E7%89%88git%E6%8E%A8%E9%80%81%E6%B3%A8%E6%84%8F%E7%82%B9/"/>
      <url>/2025/03/08/Github/%E6%96%B0%E7%89%88git%E6%8E%A8%E9%80%81%E6%B3%A8%E6%84%8F%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="新版git推送注意点"><a href="#新版git推送注意点" class="headerlink" title="新版git推送注意点"></a>新版git推送注意点</h1><p><strong>一切的开始</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure><p><strong>旧版本Git指令会默认创建一个本地的master分支</strong></p><p><img src="/upload/image-20250128151124085.png" alt="image-20250128151124085.png"></p><p><strong>我是win 2.42版本</strong></p><p><img src="/upload/image-20250128151406928.png" alt="image-20250128151406928.png"></p><p><strong>但是</strong></p><p><strong>在较新的GitHub的新仓库中，默认的初始分支名称已经从master变更为main</strong></p><p><strong>如果我们直接一套推送上去会直接推送到远程仓库，会直接推送到远程的master分支上，而当前默认的主分支main上没有东西</strong></p><p><strong>然后我去尝试了一下更新Git版本</strong></p><blockquote><p><strong>访问</strong><a href="https://gitforwindows.org/?spm=5176.28103460.0.0.65235d27rZxmXv">Git for Windows</a>官方网站，安装最新版Git 2.47</p></blockquote><p><strong>然后我发现git init还是默认master分支</strong></p><p><strong>最后还是先养成习惯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init -b main</span><br></pre></td></tr></table></figure><p><strong>切到指定分支创建</strong></p><p><strong>接下来</strong></p><p><strong>连接远程</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin 仓库地址</span><br></pre></td></tr></table></figure><p><strong>推送三件套</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;注释&quot;</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>git基础指令集</title>
      <link href="/2025/03/08/Github/git%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"/>
      <url>/2025/03/08/Github/git%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="git"><a href="#git" class="headerlink" title="git"></a>git</h1><h2 id="git-的运行机制"><a href="#git-的运行机制" class="headerlink" title="git 的运行机制"></a>git 的运行机制</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git分为本地仓库和远程仓库，我们一般情况都是写完代码，commit到本地仓库（生成本地仓的commit ID，代表当前提交代码的版本号），然后push到远程仓库（记录这个版本号）</span><br></pre></td></tr></table></figure><h2 id="git-config-配置"><a href="#git-config-配置" class="headerlink" title="git config(配置)"></a>git config(配置)</h2><p><strong>一个系统只需要配置一次</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;chen&quot;</span><br><span class="line">git config --global user.email &quot;xxx@qq.com&quot;</span><br></pre></td></tr></table></figure><h2 id="文件的状态"><a href="#文件的状态" class="headerlink" title="文件的状态"></a>文件的状态</h2><h4 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure><h5 id="未跟踪"><a href="#未跟踪" class="headerlink" title="未跟踪"></a>未跟踪</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//add .前</span><br></pre></td></tr></table></figure><h5 id="已跟踪"><a href="#已跟踪" class="headerlink" title="已跟踪"></a>已跟踪</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">staged      //暂缓区中的文件状态,也就是index</span><br><span class="line">Unmodified  //commit命令，可以将staged中文件提交到Git仓库</span><br><span class="line">Modified    //修改了某个文件后，会处于Modified状态;</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240709164956512.png" alt="image-20240709164956512.png"></p><h2 id="SSH密钥"><a href="#SSH密钥" class="headerlink" title="SSH密钥"></a>SSH密钥</h2><p><img src="/upload/image-20240709215925092.png" alt="image-20240709215925092.png"></p><h2 id="获取git仓库"><a href="#获取git仓库" class="headerlink" title="获取git仓库"></a>获取git仓库</h2><h4 id="操作流程图"><a href="#操作流程图" class="headerlink" title="操作流程图"></a>操作流程图</h4><p><img src="/upload/image-20240709165543658.png" alt="image-20240709165543658.png"></p><p><strong>git上创建新仓库</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">界面右上角&quot;+&quot;</span><br><span class="line"></span><br><span class="line">New repository</span><br><span class="line"></span><br><span class="line">仓库名字加描述</span><br><span class="line"></span><br><span class="line">Create repository</span><br></pre></td></tr></table></figure><p><strong>建立本地仓库</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">文件根目录右键:Git Bash</span><br><span class="line"></span><br><span class="line">依次执行以下指令</span><br><span class="line">git init</span><br><span class="line">git add .   //跟踪本地文件,文件存入暂存区</span><br><span class="line">git commit -m &quot;注释&quot;</span><br></pre></td></tr></table></figure><p><strong>关联github仓库</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">到github仓库复制仓库地址</span><br></pre></td></tr></table></figure><p><img src="file:///E:/%E5%9B%BE%E8%A7%A3/github%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80(%E6%8B%9F).webp?lastModify=1724233487"></p><p><img src="/upload/github%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80(%E6%8B%9F).webp" alt="github仓库地址(拟).webp"></p><p><strong>执行指令</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin ...(个人新建仓库地址)</span><br></pre></td></tr></table></figure><p><strong>上传本地代码</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><p><strong>上传完成</strong></p><p><strong>(如果出现Are you sure you want to continue connecting (yes&#x2F;no)?)</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yes</span><br></pre></td></tr></table></figure><h4 id="更新仓库"><a href="#更新仓库" class="headerlink" title="更新仓库"></a>更新仓库</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;注释&quot;</span><br><span class="line">git push 仓库地址 master</span><br></pre></td></tr></table></figure><h4 id="克隆仓库"><a href="#克隆仓库" class="headerlink" title="克隆仓库"></a>克隆仓库</h4><p><strong>Code按钮里复制仓库地址</strong></p><p><strong>桌面新建文件夹</strong></p><p><strong>文件夹里开GitBash</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git clone 地址</span><br></pre></td></tr></table></figure><h4 id="日志和版本回退"><a href="#日志和版本回退" class="headerlink" title="日志和版本回退"></a>日志和版本回退</h4><p><strong>校验和</strong>(SHA-1散列,哈希)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//每次提交的唯一id</span><br><span class="line">//由40 个十六进制字符(0-9 和 a-f)组成的字符串，基于 Git 中文件的内容或目录结构计算出来</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240709181505915.png" alt="image-20240709181505915.png"></p><p><strong>日志</strong> (历史版本记录)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git log     //按空格可以继续往下查看</span><br><span class="line">或</span><br><span class="line">//简洁版</span><br><span class="line">git log --pretty=on</span><br><span class="line">git reflog</span><br></pre></td></tr></table></figure><p><strong>回退</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD^      //回退上个版本</span><br><span class="line">git reset --hard HEAD^^     //回退上上个版本</span><br><span class="line">git reset --hard HEAD~100   //回退上100个版本</span><br><span class="line">git reset --hard 2xwjh73e   //回退到指定commid id(可以只写前7位)</span><br></pre></td></tr></table></figure><h2 id="建立远程仓库连接"><a href="#建立远程仓库连接" class="headerlink" title="建立远程仓库连接"></a>建立远程仓库连接</h2><p><strong>连接</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin 仓库地址</span><br></pre></td></tr></table></figure><p><strong>查看连接</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote</span><br><span class="line">git remote -v</span><br></pre></td></tr></table></figure><h4 id="分支"><a href="#分支" class="headerlink" title="分支"></a><strong>分支</strong></h4><p><img src="/upload/image-20240712211441114.png" alt="image-20240712211441114.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">master  //主线</span><br><span class="line">dev     //开发</span><br><span class="line">release //预发布</span><br><span class="line">hotfix  //线上bug修复</span><br><span class="line">feature </span><br></pre></td></tr></table></figure><p><strong>操作</strong></p><p><img src="/upload/image-20240712211630760.png" alt="image-20240712211630760.png"></p><p><strong>顺序</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">创建分支-&gt;修改文件-&gt;修改后的文件提交到dev中</span><br></pre></td></tr></table></figure><p><strong>创建分支</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init -b dev         //创建新分支,会切换到新分支</span><br><span class="line">git branch &lt;新分支名称&gt;   //创建新分支</span><br></pre></td></tr></table></figure><p><strong>切换分支</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;新分支&gt;</span><br></pre></td></tr></table></figure><p><strong>创建并切换分支</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;新分支&gt;</span><br></pre></td></tr></table></figure><p><strong>分支重命名</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -m &lt;旧分支&gt; &lt;新分支&gt;</span><br></pre></td></tr></table></figure><p><strong>删除分支(谨慎)</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -d &lt;分支&gt;  //删除已合并过的分支</span><br><span class="line">git branch -D &lt;分支&gt;  //强制删除分支</span><br></pre></td></tr></table></figure><p><strong>查看版本库有哪些分支</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></table></figure><p><strong>查看版本库状态</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br><span class="line">//没有提交就git add .</span><br></pre></td></tr></table></figure><p><strong>合并到当前分支</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge &lt;需要被合并的分支&gt;</span><br></pre></td></tr></table></figure><p><strong>从指定远程仓库获取</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master(可换) </span><br></pre></td></tr></table></figure><p><strong>如果想直接执行git fetch</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//先给当前分支设置一个跟踪分支</span><br><span class="line">git branch --set-upstream-to=origin/master</span><br><span class="line">git pull</span><br></pre></td></tr></table></figure><p><strong>创建一个分支来跟踪远程分支</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --track dev origin/master</span><br></pre></td></tr></table></figure><h4 id="fork与PR"><a href="#fork与PR" class="headerlink" title="fork与PR"></a>fork与PR</h4><p><strong>PR</strong> : <em>pull request</em> <em>拉取请求</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">先fork把别人的项目复制到自己的远程仓库里</span><br><span class="line">&lt;&gt;Code获得仓库的地址</span><br><span class="line">电脑创建文件夹,Git Bash打开</span><br><span class="line">git clone &lt;地址&gt;</span><br></pre></td></tr></table></figure><p><strong>查看文件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ststus</span><br></pre></td></tr></table></figure><p><strong>提交</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;注释&quot;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><p><strong>合并请求(PR)</strong></p><p><img src="/upload/image-20240712221944550.png" alt="image-20240712221944550.png"></p>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>GitHub自动化部署</title>
      <link href="/2025/03/08/Github/GitHub%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/"/>
      <url>/2025/03/08/Github/GitHub%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="GitHub自动化部署"><a href="#GitHub自动化部署" class="headerlink" title="GitHub自动化部署"></a>GitHub自动化部署</h1><p><strong>通过 GitHub Actions 实现「提交代码 → 自动构建 → 生成 Releases」</strong></p><p><strong>实现步骤</strong></p><blockquote><p>**在本地仓库中创建 **<code>.github/workflows/build.yml</code></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">name: Build and Release</span><br><span class="line"></span><br><span class="line">on:</span><br><span class="line">  push:</span><br><span class="line">    tags: </span><br><span class="line">      - &#x27;v*&#x27; # 当打 tag 时触发</span><br><span class="line"></span><br><span class="line">jobs:</span><br><span class="line">  build:</span><br><span class="line">    runs-on: windows-latest</span><br><span class="line"></span><br><span class="line">    steps:</span><br><span class="line">    - uses: actions/checkout@v4</span><br><span class="line"></span><br><span class="line">    - name: Install Node.js</span><br><span class="line">      uses: actions/setup-node@v3</span><br><span class="line">      with:</span><br><span class="line">        node-version: 20</span><br><span class="line"></span><br><span class="line">    - name: Install PNPM</span><br><span class="line">      run: npm install -g pnpm</span><br><span class="line"></span><br><span class="line">    - name: Install Dependencies</span><br><span class="line">      run: pnpm install</span><br><span class="line"></span><br><span class="line">    - name: Build Project</span><br><span class="line">      run: pnpm run build</span><br><span class="line"></span><br><span class="line">    - name: Create Release</span><br><span class="line">      uses: softprops/action-gh-release@v1</span><br><span class="line">      with:</span><br><span class="line">        files: release/*.exe</span><br></pre></td></tr></table></figure><blockquote><p><strong>触发方式</strong>：当你在本地打标签（如 <code>git tag v1.0.0</code>）并推送时，自动构建并发布 Release</p></blockquote><h2 id="远程仓库配置"><a href="#远程仓库配置" class="headerlink" title="远程仓库配置"></a>远程仓库配置</h2><blockquote><p><strong>GitHub -&gt; 你的仓库 -&gt; Settions -&gt; Actions -&gt; General -&gt; 选择Read and write permissions（工作流权限）</strong></p></blockquote><h2 id="推送"><a href="#推送" class="headerlink" title="推送"></a>推送</h2><p><strong>如果你第一次推送代码</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init -b main</span><br></pre></td></tr></table></figure><p><strong>连接远程</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin 仓库地址</span><br></pre></td></tr></table></figure><p><strong>推送代码</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;注释&quot;</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure><p><strong>推送标签（也要搞）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 创建标签（版本号格式推荐 vX.Y.Z）</span><br><span class="line">git tag -a v1.0.0 -m &quot;Release version 1.0.0&quot;</span><br><span class="line">git push origin v1.0.0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>博客音乐页面实现</title>
      <link href="/2025/03/08/%E5%8D%9A%E5%AE%A2/%E5%8D%9A%E5%AE%A2%E9%9F%B3%E4%B9%90%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0/"/>
      <url>/2025/03/08/%E5%8D%9A%E5%AE%A2/%E5%8D%9A%E5%AE%A2%E9%9F%B3%E4%B9%90%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="博客音乐组件实现"><a href="#博客音乐组件实现" class="headerlink" title="博客音乐组件实现"></a>博客音乐组件实现</h1><p><strong>详情移步 | 安知鱼 | 大佬的博客文章</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.anheyu.com/posts/a76e.html</span><br></pre></td></tr></table></figure><h2 id="一图流"><a href="#一图流" class="headerlink" title="一图流"></a>一图流</h2><p><img src="/upload/image-20250131180643649.png" alt="image-20250131180643649.png"></p><h2 id="开放式公益API"><a href="#开放式公益API" class="headerlink" title="开放式公益API"></a>开放式公益API</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.injahow.cn/meting/?server=:server&amp;type=:type&amp;id=:id&amp;auth=:auth&amp;r=:r</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://meting.qjqq.cn/?server=:server&amp;type=:type&amp;id=:id&amp;auth=:auth&amp;r=:r</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 博客 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>var/let/const</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/varletconst%E5%8C%BA%E5%88%86/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/varletconst%E5%8C%BA%E5%88%86/</url>
      
        <content type="html"><![CDATA[<h1 id="var-let-const区分"><a href="#var-let-const区分" class="headerlink" title="var&#x2F;let&#x2F;const区分"></a>var&#x2F;let&#x2F;const区分</h1><h5 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h5><p><strong>var 和 let 的作用域规则一样</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">函数外，是全局执行上下文，函数里，是当前函数执行上下文。//声明的变量的作用域只能是全局或者整个函数块的。</span><br></pre></td></tr></table></figure><h5 id="重复声明"><a href="#重复声明" class="headerlink" title="重复声明"></a>重复声明</h5><p><strong>var 允许，let&#x2F;const不允许</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function test() &#123;</span><br><span class="line">  var a = 3;</span><br><span class="line">  var a = 4;</span><br><span class="line">  console.log(a) // 4</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>let是块级作用域</strong></p><p><strong>const只能在声明它们的块级作用域中访问</strong></p><p><strong>const&#x2F;let在块级作用域外无法访问内部变量！</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(true)&#123;</span><br><span class="line">    const a=1;</span><br><span class="line">&#125;</span><br><span class="line">console.log(a)</span><br></pre></td></tr></table></figure><h5 id="绑定全局变量"><a href="#绑定全局变量" class="headerlink" title="绑定全局变量"></a>绑定全局变量</h5><p><strong>在全局环境声明变量，var会在全局对象里新建一个属性，let&#x2F;const不会</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var foo = &#x27;global&#x27;</span><br><span class="line">let bar = &#x27;global&#x27;</span><br><span class="line"></span><br><span class="line">console.log(this.foo) // global</span><br><span class="line">console.log(this.bar) // undefined</span><br></pre></td></tr></table></figure><p><strong>此时let定义的变量实际在test 函数的作用域链上</strong></p><p><img src="/upload/image-20241104212220166.png" alt="image-20241104212220166.png"></p><h5 id="变量提升与暂存死区"><a href="#变量提升与暂存死区" class="headerlink" title="变量提升与暂存死区"></a><strong>变量提升与暂存死区</strong></h5><p><img src="/upload/image-20241104223204685.png" alt="image-20241104223204685.png"></p><p><strong>上述代码的例子中</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var例子就是变量提升，const/let的报错就是暂时性死区</span><br></pre></td></tr></table></figure><p><strong>代码的执行原理</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">创建-&gt;初始化-&gt;赋值</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var 声明的变量在执行上下文创建阶段就会被「创建」和「初始化」，因此对于执行阶段来说，可以在声明之前使用。</span><br><span class="line">let 声明的变量在执行上下文创建阶段只会被「创建」而不会被「初始化」，因此对于执行阶段来说，如果在其定义执行前使用，相当于使用了未被初始化的变量，会报错。</span><br></pre></td></tr></table></figure><p><strong>let 与 const 异同</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">唯一区别就在于 const 声明的是一个只读变量，声明之后不允许改变其值。</span><br><span class="line">因此，const 一旦声明必须初始化，否则会报错。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>TS基础</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/TS%E5%9F%BA%E7%A1%80/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/TS%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="TS"><a href="#TS" class="headerlink" title="TS"></a>TS</h1><h3 id="类型（interface）"><a href="#类型（interface）" class="headerlink" title="类型（interface）"></a>类型（interface）</h3><h5 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let a: string //变量a只能存储字符串</span><br><span class="line">let b: number //变量a只能存储数值</span><br><span class="line">let c: boolean //变量a只能存储布尔值</span><br><span class="line">// 参数x必须是数字，参数y也必须是数字，函数返回值也必须是数字</span><br><span class="line">function demo(x:number,y:number):number&#123;</span><br><span class="line"> return x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="总览"><a href="#总览" class="headerlink" title="总览"></a>总览</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">string 、 number 、 boolean 、 null 、 undefined 、 bigint 、 symbol 、 object(Array 、Function 、Date ......)</span><br><span class="line">(新)</span><br><span class="line">void 、 never 、 unknown 、 any 、 enum 、 tuple</span><br><span class="line">(自定义)</span><br><span class="line">type 、 interface</span><br></pre></td></tr></table></figure><h3 id="常用类型"><a href="#常用类型" class="headerlink" title="常用类型"></a>常用类型</h3><h5 id="字面量"><a href="#字面量" class="headerlink" title="字面量"></a>字面量</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">值只能是字⾯量值 （值本身）</span><br></pre></td></tr></table></figure><h5 id="any"><a href="#any" class="headerlink" title="any"></a>any</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//显式的any</span><br><span class="line">let a: any</span><br><span class="line">a = 100</span><br><span class="line">a = &#x27;你好&#x27;</span><br><span class="line">a = false</span><br><span class="line"></span><br><span class="line">//隐式的any</span><br><span class="line">let b</span><br><span class="line">b = 100</span><br><span class="line">b = &#x27;你好&#x27;</span><br><span class="line">b = false</span><br><span class="line"></span><br><span class="line">let a</span><br><span class="line">let x: string</span><br><span class="line">x = a // ⽆警告</span><br></pre></td></tr></table></figure><h5 id="unknown"><a href="#unknown" class="headerlink" title="unknown"></a>unknown</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//适⽤于：开始不知道数据的具体类型，后期才能确定数据的类型</span><br><span class="line">let a: unknown</span><br><span class="line">a = 100</span><br><span class="line">a = false</span><br><span class="line">a = &#x27;你好&#x27;</span><br><span class="line"></span><br><span class="line">let x: string</span><br><span class="line">x = a // 警告：不能将“unknown”分配给“string</span><br></pre></td></tr></table></figure><h5 id="never"><a href="#never" class="headerlink" title="never"></a>never</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">let a: never</span><br><span class="line">// 警告</span><br><span class="line">a = 1</span><br><span class="line">a = true</span><br><span class="line">a = undefined</span><br><span class="line">a = null</span><br><span class="line"></span><br><span class="line">//ts可主动推断</span><br><span class="line">if(typeof a === &#x27;string&#x27;)&#123;</span><br><span class="line"> a.toUpperCase()</span><br><span class="line">&#125;else&#123;</span><br><span class="line"> console.log(a) // 推断出此处为never</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//适⽤于：限制函数的返回值</span><br><span class="line">// 限制demo函数不需要有任何返回值，任何值都不⾏，像undeifned、null都不⾏</span><br><span class="line">function demo():never&#123;</span><br><span class="line"> throw new Error(&#x27;程序异常退出&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="void"><a href="#void" class="headerlink" title="void"></a>void</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//适⽤于：限制函数的返回值</span><br><span class="line">let a:void = undefined</span><br><span class="line">// ⽆警告</span><br><span class="line">function demo1():void&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">// ⽆警告</span><br><span class="line">function demo2():void&#123;</span><br><span class="line"> return</span><br><span class="line">&#125;</span><br><span class="line">// ⽆警告</span><br><span class="line">function demo3():void&#123;</span><br><span class="line"> return undefined</span><br><span class="line">&#125;</span><br><span class="line">// 有警告：不能将类型“number”分配给类型“void”</span><br><span class="line">function demo4():void&#123;</span><br><span class="line"> return 666</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="object（不常用）"><a href="#object（不常用）" class="headerlink" title="object（不常用）"></a>object（不常用）</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">let a:object //a的值可以是任何【⾮原始值类型】，包括：对象、函数、数组等</span><br><span class="line"></span><br><span class="line">// 【⾮原始类型】⽆警告</span><br><span class="line">a = &#123;&#125;</span><br><span class="line">a = &#123;name:&#x27;张三&#x27;&#125;</span><br><span class="line">a = [1,3,5,7,9]</span><br><span class="line">a = function()&#123;&#125;</span><br><span class="line"></span><br><span class="line">// 【原始类型】有警告</span><br><span class="line">a = null // 警告：不能将类型“null”分配给类型“object”</span><br><span class="line">a = undefined // 警告：不能将类型“undefined”分配给类型“object”</span><br><span class="line">a = 1 // 警告：不能将类型“number”分配给类型“object”</span><br><span class="line">a = true // 警告：不能将类型“boolean”分配给类型“object”</span><br><span class="line">a = &#x27;你好&#x27; // 警告：不能将类型“string”分配给类型“object</span><br></pre></td></tr></table></figure><h6 id="限制类型写法"><a href="#限制类型写法" class="headerlink" title="限制类型写法"></a>限制类型写法</h6><p><strong>对象</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let person: &#123; name: string, age?: number&#125; //问号代表可选属性</span><br><span class="line">let car: &#123; price: number; color: string; [k:string]:any&#125;</span><br><span class="line">let student: &#123;</span><br><span class="line"> id: string</span><br><span class="line"> grade:number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person = &#123;name:&#x27;张三&#x27;,age:18&#125;</span><br><span class="line">person = &#123;name:&#x27;李四&#x27;&#125;</span><br><span class="line">car = &#123;price:100,color:&#x27;红⾊&#x27;&#125;</span><br><span class="line">student = &#123;id:&#x27;tetqw76te01&#x27;,grade:3&#125;</span><br></pre></td></tr></table></figure><p><strong>函数</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let demo: (a: number, b: number) =&gt; number</span><br><span class="line">demo = function(x,y) &#123;</span><br><span class="line"> return x+y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>数组</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let arr1: string[] // 该⾏代码等价于： let arr1: Array&lt;string&gt;</span><br><span class="line">let arr2: number[] // 该⾏代码等价于： let arr2: Array&lt;number&gt;</span><br><span class="line">arr1 = [&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]</span><br><span class="line">arr2 = [1,3,5,7,9]</span><br></pre></td></tr></table></figure><h5 id="tuple"><a href="#tuple" class="headerlink" title="tuple"></a>tuple</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//长短固定的数组</span><br><span class="line">let t: [string,number]</span><br><span class="line">t = [&#x27;hello&#x27;,123]</span><br><span class="line">// 警告，不能将类型“[string, number, boolean]”分配给类型“[string, number]”</span><br><span class="line">t = [&#x27;hello&#x27;,123,false]</span><br></pre></td></tr></table></figure><h5 id="enum"><a href="#enum" class="headerlink" title="enum"></a>enum</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//枚举</span><br><span class="line">// 定义⼀个枚举</span><br><span class="line">enum Color &#123;</span><br><span class="line"> Red,</span><br><span class="line"> Blue,</span><br><span class="line"> Black,</span><br><span class="line"> Gold</span><br><span class="line">&#125;</span><br><span class="line">// 定义⼀个枚举，并指定其初识数值</span><br><span class="line">enum Color2 &#123;</span><br><span class="line"> Red = 6,</span><br><span class="line"> Blue,</span><br><span class="line"> Black,</span><br><span class="line"> Gold</span><br><span class="line">&#125;</span><br><span class="line">console.log(Color)</span><br><span class="line">/*</span><br><span class="line"> &#123;</span><br><span class="line">     0: &#x27;Red&#x27;, 1: &#x27;Blue&#x27;, 2: &#x27;Black&#x27;, 3: &#x27;Gold&#x27;,</span><br><span class="line">     Red: 0, Blue: 1, Black: 2, Gold: 3</span><br><span class="line"> &#125;</span><br><span class="line">*/</span><br><span class="line">console.log(Color2)</span><br><span class="line">/*</span><br><span class="line"> &#123;</span><br><span class="line">     6: &#x27;Red&#x27;,  7: &#x27;Blue&#x27;, 8: &#x27;Black&#x27;, 9: &#x27;Gold&#x27;,</span><br><span class="line">     Red: 6, Blue: 7, Black: 8, Gold: 9</span><br><span class="line"> &#125;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><p><strong>实例</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 定义⼀个phone变量，并设置对⻬进⾏限制</span><br><span class="line">let phone: &#123;name:string,price:number,color:Color&#125;</span><br><span class="line"></span><br><span class="line">phone = &#123;name:&#x27;华为Mate60&#x27;,price:6500,color:Color.Red&#125;</span><br><span class="line">phone = &#123;name:&#x27;iPhone15Pro&#x27;,price:7999,color:Color.Blue&#125;</span><br><span class="line"></span><br><span class="line">if(phone.color === Color.Red)&#123;</span><br><span class="line"> console.log(&#x27;⼿机是红⾊的&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自定义类"><a href="#自定义类" class="headerlink" title="自定义类"></a>自定义类</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// 性别的枚举</span><br><span class="line">enum Gender &#123;</span><br><span class="line"> Male,</span><br><span class="line"> Female</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ⾃定义⼀个年级类型（⾼⼀、⾼⼆、⾼三）</span><br><span class="line">type Grade = 1 | 2 | 3</span><br><span class="line"></span><br><span class="line">// ⾃定义⼀个学⽣类型</span><br><span class="line">type Student = &#123;</span><br><span class="line"> name:string,</span><br><span class="line"> age:number,</span><br><span class="line"> gender:Gender,</span><br><span class="line"> grade:Grade</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 定义两个学⽣变量：s1、s2</span><br><span class="line">let s1:Student</span><br><span class="line">let s2:Student</span><br><span class="line"></span><br><span class="line">s1 = &#123;name:&#x27;张三&#x27;,age:18,gender:Gender.Male,grade:1&#125;</span><br><span class="line">s2 = &#123;name:&#x27;李四&#x27;,age:18,gender:Gender.Female,grade:2&#125;</span><br></pre></td></tr></table></figure><h3 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h3><p><strong>常规类</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line"> name: string</span><br><span class="line"> age: number</span><br><span class="line"> constructor(name:string,age:number)&#123;//构造函数</span><br><span class="line">     this.name = name</span><br><span class="line">     this.age = age</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const p1 = new Person(&#x27;张三&#x27;,18)</span><br><span class="line">const p2 = new Person(&#x27;李四&#x27;,19)</span><br></pre></td></tr></table></figure><p><strong>继承</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123; &#125;</span><br><span class="line"></span><br><span class="line">// Teacher类继承Person</span><br><span class="line">class Teacher extends Person &#123; &#125;</span><br><span class="line"></span><br><span class="line">// Student类继承Person</span><br><span class="line">class Student extends Person &#123; &#125;</span><br><span class="line"></span><br><span class="line">// Person实例</span><br><span class="line">const p1 = new Person(&#x27;周杰伦&#x27;,38)</span><br><span class="line">// Student实例</span><br><span class="line">const s1 = new Student(&#x27;张同学&#x27;,18)</span><br><span class="line">const s2 = new Student(&#x27;李同学&#x27;,20)</span><br><span class="line">// Teacher实例</span><br><span class="line">const t1 = new Teacher(&#x27;刘⽼师&#x27;,40)</span><br><span class="line">const t2 = new Teacher(&#x27;孙⽼师&#x27;,50)</span><br></pre></td></tr></table></figure><p><strong>抽象类</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abstract class Person &#123; &#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// Person（抽象类）</span><br><span class="line">abstract class Person &#123; &#125;</span><br><span class="line"></span><br><span class="line">// Teacher类继承Person</span><br><span class="line">class Teacher extends Person &#123;</span><br><span class="line"> // 构造器</span><br><span class="line"> constructor(name: string,age: number)&#123;</span><br><span class="line">    super(name,age)</span><br><span class="line"> &#125;</span><br><span class="line"> // ⽅法</span><br><span class="line"> speak()&#123;</span><br><span class="line">    console.log(&#x27;你好！我是⽼师:&#x27;,this.name)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Student类继承Person</span><br><span class="line">class Student extends Person &#123; &#125;</span><br><span class="line">// Person实例</span><br><span class="line">// const p1 = new Person(&#x27;周杰伦&#x27;,38) // 抽象类，不可以new Person</span><br></pre></td></tr></table></figure><h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//限制⼀个类中包含哪些属性和⽅法</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// Person接⼝</span><br><span class="line">interface Person &#123;</span><br><span class="line"> // 属性声明</span><br><span class="line"> name: string</span><br><span class="line"> age: number</span><br><span class="line"> // ⽅法声明</span><br><span class="line"> speak():void</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">// Teacher实现Person接⼝</span><br><span class="line">class Teacher implements Person &#123;</span><br><span class="line"> name: string</span><br><span class="line"> age: number</span><br><span class="line"> // 构造器</span><br><span class="line"> constructor(name: string,age: number)&#123;</span><br><span class="line">     this.name = name</span><br><span class="line">     this.age = age</span><br><span class="line"> &#125;</span><br><span class="line"> // ⽅法</span><br><span class="line"> speak()&#123;</span><br><span class="line">    console.log(&#x27;你好！我是⽼师:&#x27;,this.name)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>举例</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 接⼝ —— Person，只能包含抽象⽅法</span><br><span class="line">interface Person &#123;</span><br><span class="line"> // 属性，不写具体值</span><br><span class="line"> name:string</span><br><span class="line"> age:number</span><br><span class="line"> // ⽅法，不写具体实现</span><br><span class="line"> speak():void</span><br><span class="line">&#125;</span><br><span class="line">// 创建Teacher类实现Person接⼝</span><br><span class="line">class Teacher implements Person &#123;</span><br><span class="line"> name:string</span><br><span class="line"> age:number</span><br><span class="line"> constructor(name:string,age:number)&#123;</span><br><span class="line">     this.name = name</span><br><span class="line">     this.age = age</span><br><span class="line"> &#125;</span><br><span class="line"> speak()&#123;</span><br><span class="line">    console.log(&#x27;我在⻜快的⾏⾛中......&#x27;)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250127173649162.png?lastModify=1738423183" alt="image-20250127173649162"></p><h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function test&lt;T&gt;(arg: T): T&#123;</span><br><span class="line">    return arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 不指名类型，TS会⾃动推断出来</span><br><span class="line">test(10)</span><br><span class="line"></span><br><span class="line">// 指名具体的类型</span><br><span class="line">test&lt;number&gt;(10)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function test&lt;T, K&gt;(a: T, b: K): K&#123;</span><br><span class="line"> return b;</span><br><span class="line">&#125;</span><br><span class="line">// 为多个泛型指定具体⾃值</span><br><span class="line">test&lt;number, string&gt;(10, &quot;hello&quot;);</span><br></pre></td></tr></table></figure><p><strong>类</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class MyClass&lt;T&gt;&#123;</span><br><span class="line"> prop: T;</span><br><span class="line"> constructor(prop: T)&#123;</span><br><span class="line"> this.prop = prop;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>泛型约束</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface Demo&#123;</span><br><span class="line"> length: number;</span><br><span class="line">&#125;</span><br><span class="line">// 泛型T必须是MyInter的⼦类，即：必须拥有length属性</span><br><span class="line">function test&lt;T extends Demo&gt;(arg: T): number&#123;</span><br><span class="line"> return arg.length;</span><br><span class="line">&#125;</span><br><span class="line">test(10) // 类型“number”的参数不能赋给类型“Demo”的参数</span><br><span class="line">test(&#123;name:&#x27;张三&#x27;&#125;) // 类型“&#123; name: string; &#125;”的参数不能赋给类型“Demo”的参数</span><br><span class="line">test(&#x27;123&#x27;)</span><br><span class="line">test(&#123;name:&#x27;张三&#x27;,length:10&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>页面预加载UI实现</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B5%E9%9D%A2circle%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B5%E9%9D%A2circle%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="页面circle加载动画"><a href="#页面circle加载动画" class="headerlink" title="页面circle加载动画"></a>页面circle加载动画</h1><p><img src="/upload/image-20241116165834762.png" alt="image-20241116165834762.png"></p><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;span&gt;loding......&lt;/span&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    padding: 0;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">&#125;</span><br><span class="line">body &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100vh;</span><br><span class="line">    /* border: 10px solid red; */</span><br><span class="line">&#125;</span><br><span class="line">.container &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    align-items: center;</span><br><span class="line">    /* border: 10px solid rgb(0, 132, 255); */</span><br><span class="line">    background-color: black;</span><br><span class="line">&#125;</span><br><span class="line">/* 背景彩色圆圈 */</span><br><span class="line">.circle &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 200px;</span><br><span class="line">    height: 200px;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    align-items: center;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    /* border: 10px solid rgb(0, 255, 170); */</span><br><span class="line">    background-image: linear-gradient(</span><br><span class="line">        0deg,</span><br><span class="line">        rgb(0, 255, 170),</span><br><span class="line">        rgb(0, 17, 255),</span><br><span class="line">        rgb(255, 0, 255)</span><br><span class="line">    );</span><br><span class="line">    /* !!!动画!!! */</span><br><span class="line">    animation: rotate 2s linear infinite;</span><br><span class="line">&#125;</span><br><span class="line">/* 模糊 */</span><br><span class="line">.circle::before &#123;</span><br><span class="line">    content: &#x27;&#x27;;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 200px;</span><br><span class="line">    height: 200px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    /* border: 10px solid rgb(0, 255, 170); */</span><br><span class="line">    background-image: linear-gradient(</span><br><span class="line">        0deg,</span><br><span class="line">        rgb(0, 255, 170),</span><br><span class="line">        rgb(0, 17, 255),</span><br><span class="line">        rgb(255, 0, 255)</span><br><span class="line">    );</span><br><span class="line">    filter: blur(35px);</span><br><span class="line">&#125;</span><br><span class="line">/* 黑圈 */</span><br><span class="line">.circle::after &#123;</span><br><span class="line">    content: &#x27;&#x27;;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 180px;</span><br><span class="line">    height: 180px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    background-color: black;</span><br><span class="line">&#125;</span><br><span class="line">/* 文字 */</span><br><span class="line">span &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    color: rgb(255, 255, 255);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="重点"><a href="#重点" class="headerlink" title="重点"></a><em><strong>重点</strong></em></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">animation: rotate 2s linear infinite;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/* 动画 */</span><br><span class="line">@keyframes rotate &#123;</span><br><span class="line">    0% &#123;</span><br><span class="line">        transform: rotate(0deg);</span><br><span class="line">    &#125;</span><br><span class="line">    100% &#123;</span><br><span class="line">        transform: rotate(360deg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>手搓页面预加载</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B5%E9%9D%A2%E9%A2%84%E5%8A%A0%E8%BD%BD/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%A1%B5%E9%9D%A2%E9%A2%84%E5%8A%A0%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="页面预加载"><a href="#页面预加载" class="headerlink" title="页面预加载"></a>页面预加载</h1><p><strong>本文实现了</strong></p><p><strong>1.预加载转圈动画+加载完毕销毁组件</strong></p><p><strong>2.开屏蒙版特效（after资源加载完毕）</strong></p><p><strong>3.主页背景图模糊+缩放动画（after资源加载完毕）</strong></p><h2 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h2><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加载动画 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;svg&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;circle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>loding......<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="门板"><a href="#门板" class="headerlink" title="门板"></a><strong>门板</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 门板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="主页面"><a href="#主页面" class="headerlink" title="主页面"></a><strong>主页面</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 主页面 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;page&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://haowallpaper.com/link/common/file/previewFileImg/718a61f6cd6efa803ca87eb743fec045718a61f6cd6efa803ca87eb743fec045&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h3 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h3><h4 id="预加载工具"><a href="#预加载工具" class="headerlink" title="预加载工具"></a><strong>预加载工具</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://libs.baidu.com/jquery/1.8.3/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="动态更新"><a href="#动态更新" class="headerlink" title="动态更新"></a><strong>动态更新</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="variable constant_">JS</span>动态更新 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> left = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.left&#x27;</span>)  <span class="comment">//左门</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> right = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.right&#x27;</span>)<span class="comment">//右门</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> page = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.page&#x27;</span>)  <span class="comment">//获取图片对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $(<span class="variable language_">window</span>).<span class="title function_">on</span>(<span class="string">&#x27;load&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        $(<span class="string">&#x27;.svg&#x27;</span>).<span class="title function_">animate</span>(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">opacity</span>: <span class="number">0</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="number">500</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        )</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            $(<span class="string">&#x27;.svg&#x27;</span>).<span class="title function_">remove</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">//remove组件loding后执行</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">//门板开屏动态</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                left.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateX(-60vw)`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                right.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateX(60vw)`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">//模糊/放缩背景图片效果</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                page.<span class="property">style</span>.<span class="property">animation</span> = <span class="string">`blur-to-clear 2s cubic-bezier(0.62, 0.21, 0.25, 1) 0s 1</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                        normal backwards running,scale 2s cubic-bezier(0.62, 0.21, 0.25, 1) 0s 1 both`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;, <span class="number">200</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;, <span class="number">500</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><h4 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a><strong>全局配置</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/* 取消滚动条 */</span></span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="动画函数"><a href="#动画函数" class="headerlink" title="动画函数"></a><strong>动画函数</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 动画 */</span></span><br><span class="line"><span class="keyword">@keyframes</span> rotate &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 模糊动画 */</span></span><br><span class="line"><span class="keyword">@keyframes</span> blur-to-clear &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">35px</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">0px</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 图片大小变化动画 */</span></span><br><span class="line"><span class="keyword">@keyframes</span> scale &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="包裹加载的样式svg（loding后去除）"><a href="#包裹加载的样式svg（loding后去除）" class="headerlink" title="包裹加载的样式svg（loding后去除）"></a><strong>包裹加载的样式svg（loding后去除）</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.svg</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">999</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="主页背景"><a href="#主页背景" class="headerlink" title="主页背景"></a><strong>主页背景</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span><span class="selector-class">.page</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">1080px</span>;</span><br><span class="line">    <span class="attribute">transition</span>: opacity <span class="number">1s</span>;</span><br><span class="line">    <span class="comment">/* 背景图片变化动画(已存入JS) */</span></span><br><span class="line">    <span class="comment">/* animation: blur-to-clear 2s cubic-bezier(0.62, 0.21, 0.25, 1) 0s 1</span></span><br><span class="line"><span class="comment">    normal backwards running,</span></span><br><span class="line"><span class="comment">    scale 2s cubic-bezier(0.62, 0.21, 0.25, 1) 0s 1 both; */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="加载圆圈样式"><a href="#加载圆圈样式" class="headerlink" title="加载圆圈样式"></a><strong>加载圆圈样式</strong></h4><p><strong>详细拆分见文章“页面circle加载动画”</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="comment">/* border: 10px solid rgb(0, 132, 255); */</span></span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.circle</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="comment">/* border: 10px solid rgb(0, 255, 170); */</span></span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">0deg</span>,</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">170</span>),</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">17</span>, <span class="number">255</span>),</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">/* 动画 */</span></span><br><span class="line">    <span class="attribute">animation</span>: rotate <span class="number">2s</span> linear infinite;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 模糊 */</span></span><br><span class="line"><span class="selector-class">.circle</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="comment">/* border: 10px solid rgb(0, 255, 170); */</span></span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">0deg</span>,</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">170</span>),</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">17</span>, <span class="number">255</span>),</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">35px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 黑圈 */</span></span><br><span class="line"><span class="selector-class">.circle</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">180px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">180px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="comment">/* filter: blur(35px); */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="开屏门板"><a href="#开屏门板" class="headerlink" title="开屏门板"></a><strong>开屏门板</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">998</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: center center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">998</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50vw</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: center center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue组件通信</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Vue%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Vue%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="组件通信"><a href="#组件通信" class="headerlink" title="组件通信"></a>组件通信</h2><h3 id="父子双传"><a href="#父子双传" class="headerlink" title="父子双传"></a>父子双传</h3><h5 id="props"><a href="#props" class="headerlink" title="props"></a>props</h5><p><strong>父传子</strong></p><p><img src="/upload/image-20240825201917435-ppsw.png" alt="image-20240825201917435-ppsw.png"></p><p><strong>子传父</strong></p><p><img src="/upload/image-20240825203836739-eekr.png" alt="image-20240825203836739-eekr.png"></p><h5 id="v-model（双向绑定）"><a href="#v-model（双向绑定）" class="headerlink" title="v-model（双向绑定）"></a>v-model（双向绑定）</h5><p><strong>表单</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//用在html标签</span><br><span class="line">&lt;input type=&quot;text&quot; v-model=&quot;username&quot;&gt;</span><br><span class="line"></span><br><span class="line">//用在组件标签上</span><br><span class="line">&lt;组件 v-model=&quot;username&quot;/&gt;</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240826134133823-jtfn.png" alt="image-20240826134133823-jtfn.png"></p><p><img src="/upload/image-20240826134643288-wved.png" alt="image-20240826134643288-wved.png"></p><h3 id="父传子"><a href="#父传子" class="headerlink" title="父传子"></a>父传子</h3><h5 id="refs"><a href="#refs" class="headerlink" title="$refs"></a>$refs</h5><p><strong>改变子的玩具</strong></p><p><img src="/upload/image-20240826163102996-vnxq.png" alt="image-20240826163102996-vnxq.png"></p><p><strong>让所有子的书变多</strong></p><p><img src="/upload/image-20240826161006792-cmyw.png" alt="image-20240826161006792-cmyw.png"></p><h5 id="默认插槽"><a href="#默认插槽" class="headerlink" title="默认插槽"></a>默认插槽</h5><p><img src="/upload/image-20240826214619312-wydc.png" alt="image-20240826214619312-wydc.png"></p><p><img src="/upload/image-20240826214724976-nytt.png" alt="image-20240826214724976-nytt.png"></p><h5 id="具名插槽"><a href="#具名插槽" class="headerlink" title="具名插槽"></a>具名插槽</h5><p><img src="/upload/image-20240826221750773-jrvs.png" alt="image-20240826221750773-jrvs.png"></p><h3 id="子传父"><a href="#子传父" class="headerlink" title="子传父"></a>子传父</h3><h5 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h5><p><strong>父组件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Child @send-toy=&quot;toy = $event&quot;/&gt;</span><br></pre></td></tr></table></figure><p><strong>子组件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.$emit(&#x27;send-toy&#x27;, 具体数据)</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240825212202117-gpof.png" alt="image-20240825212202117-gpof.png"></p><h5 id="parent"><a href="#parent" class="headerlink" title="$parent"></a>$parent</h5><p><strong>减少父的房产</strong></p><p><img src="/upload/image-20240826162719642-svvx.png" alt="image-20240826162719642-svvx.png"></p><h5 id="作用域插槽"><a href="#作用域插槽" class="headerlink" title="作用域插槽"></a>作用域插槽</h5><p><strong>params 作为对象</strong></p><p><img src="/upload/image-20240827151102500-ymag.png" alt="image-20240827151102500-ymag.png"></p><p><img src="/upload/image-20240827151700297-slyx.png" alt="image-20240827151700297-slyx.png"></p><h3 id="祖传孙"><a href="#祖传孙" class="headerlink" title="祖传孙"></a>祖传孙</h3><h5 id="attrs"><a href="#attrs" class="headerlink" title="$attrs"></a>$attrs</h5><p><img src="/upload/image-20240826144203197-vibc.png" alt="image-20240826144203197-vibc.png"></p><h5 id="provide（配-inject）"><a href="#provide（配-inject）" class="headerlink" title="provide（配 inject）"></a>provide（配 inject）</h5><p><img src="/upload/image-20240826172233626-cazp.png" alt="image-20240826172233626-cazp.png"></p><h3 id="孙传组"><a href="#孙传组" class="headerlink" title="孙传组"></a>孙传组</h3><h5 id="inject（配-provid）"><a href="#inject（配-provid）" class="headerlink" title="inject（配 provid）"></a>inject（配 provid）</h5><p><img src="/upload/image-20240826172226760-ueqn.png" alt="image-20240826172226760-ueqn.png"></p><h3 id="兄弟传"><a href="#兄弟传" class="headerlink" title="兄弟传"></a>兄弟传</h3><h5 id="mitt"><a href="#mitt" class="headerlink" title="mitt"></a>mitt</h5><p><strong>安装</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mitt</span><br></pre></td></tr></table></figure><p><strong>&#x2F;utils&#x2F;emitter</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//引入mitt</span><br><span class="line">import mitt from &#x27;mitt&#x27;</span><br><span class="line"></span><br><span class="line">// 调用mitt得到emitter，emitter能：绑定事件、触发事件</span><br><span class="line">const emitter = mitt()</span><br><span class="line"></span><br><span class="line">// 暴露emitter</span><br><span class="line">export default emitter</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//绑定事件</span><br><span class="line">emitter.on(&#x27;text&#x27;,()=&gt;&#123;&#125;)</span><br><span class="line">//触发事件</span><br><span class="line">emmiter.emit(&#x27;text&#x27;)</span><br><span class="line">//解绑事件</span><br><span class="line">emmiter.off(&#x27;text&#x27;)</span><br><span class="line">//全部解绑</span><br><span class="line">emmiter.all.clear()</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240826131941301-xtro.png" alt="image-20240826131941301-xtro.png"></p><h3 id="任意传"><a href="#任意传" class="headerlink" title="任意传"></a>任意传</h3><h5 id="pinia"><a href="#pinia" class="headerlink" title="pinia"></a>pinia</h5><p><strong>搭建</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia</span><br></pre></td></tr></table></figure><p><strong>main.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &#x27;vue&#x27;</span><br><span class="line">import App from &#x27;./App.vue&#x27;</span><br><span class="line"></span><br><span class="line">/* 引入createPinia，用于创建pinia */</span><br><span class="line">import &#123; createPinia &#125; from &#x27;pinia&#x27;</span><br><span class="line"></span><br><span class="line">/* 创建pinia */</span><br><span class="line">const pinia = createPinia()</span><br><span class="line">const app = createApp(App)</span><br><span class="line"></span><br><span class="line">/* 使用插件 */&#123;&#125;</span><br><span class="line">app.use(pinia)</span><br><span class="line">app.mount(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure><p><strong>&#x2F;stores&#x2F;first.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123;defineStore&#125; from &quot;pinia&quot;;</span><br><span class="line"></span><br><span class="line">import &#123;ref&#125; from &quot;vue&quot;</span><br><span class="line"></span><br><span class="line">export default defineStore(&#x27;first&#x27;,()=&gt;&#123;//创建自己的仓库</span><br><span class="line">    const name = ref(&#x27;pinia&#x27;);</span><br><span class="line"></span><br><span class="line">    return &#123;name&#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>App.vue</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    import useFristStore from &quot;./stores/first&quot;</span><br><span class="line">    const store = useFirstStore();//自己的仓库</span><br><span class="line">    console.log(store.name);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue路由</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Vue%E8%B7%AF%E7%94%B1/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Vue%E8%B7%AF%E7%94%B1/</url>
      
        <content type="html"><![CDATA[<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p><img src="/upload/image-20240829155453971.png" alt="image-20240829155453971.png"></p><ul><li><p><code>router/index.ts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import &#123; creatRouter, createWebHistory &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import 自定义名1 from &#x27;../pages/组件1.vue&#x27;</span><br><span class="line">import 自定义名2 from &#x27;../pages/组件2.vue&#x27;</span><br><span class="line"></span><br><span class="line">export default createRouter(&#123;</span><br><span class="line">    history: createWebHistory(),</span><br><span class="line">    routes:[</span><br><span class="line">        &#123;</span><br><span class="line">            path:&#x27;/自定义路由名1&#x27;</span><br><span class="line">            component:/自定义名1,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            path:&#x27;/自定义路由名2&#x27;</span><br><span class="line">            component:/自定义名2,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><code>App.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;......&quot;&gt;</span><br><span class="line">        &lt;!-- 导航区 --&gt;</span><br><span class="line">        &lt;router-link active-class=&quot;active&quot; class=&quot;...&quot; to=&quot;/props&quot;&gt;1. props&lt;/router-link&gt;</span><br><span class="line">        &lt;router-link active-class=&quot;active&quot; class=&quot;...&quot; to=&quot;/event&quot;&gt;2. 自定义事件&lt;/router-link&gt;</span><br><span class="line">        ......</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;......&quot;&gt;</span><br><span class="line">        &lt;!-- 占位一个展示区 --&gt;</span><br><span class="line">        &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot; name=&quot;App&quot;&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>main.ts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &#x27;vue&#x27;</span><br><span class="line">import App from &#x27;./App.vue&#x27;</span><br><span class="line">import &#123; createPinia &#125; from &#x27;pinia&#x27;</span><br><span class="line">import router from &#x27;./router/index&#x27;</span><br><span class="line"></span><br><span class="line">// 创建应用</span><br><span class="line">const app = createApp(App)</span><br><span class="line">// 创建pinia</span><br><span class="line">const pinia = createPinia()</span><br><span class="line"></span><br><span class="line">// 安装插件</span><br><span class="line">app.use(pinia)</span><br><span class="line">// 安装路由器</span><br><span class="line">app.use(router)</span><br><span class="line">// 挂载应用</span><br><span class="line">app.mount(&#x27;#app&#x27;)//使用.mount()方法将应用挂载到id为&#x27;app&#x27;的元素上</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Scss基础</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Scss/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/Scss/</url>
      
        <content type="html"><![CDATA[<h1 id="Scss"><a href="#Scss" class="headerlink" title="Scss"></a>Scss</h1><p><strong>Sass使用Ruby语法 : *<em><strong>没有花括号</strong>，<strong>没有分号</strong>，具有</em>*严格的缩进</strong></p><h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install -D sass sass-loader</span><br></pre></td></tr></table></figure><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p><strong>define.scss （一般放在src中的styles文件夹中）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$--primary-color: #123456;</span><br><span class="line">$white-color:$--primary-color-green !default;//这个默认值的优先级降到了最低，当没有其它地方赋值时候，才会选择默认值</span><br></pre></td></tr></table></figure><p><strong>vue组件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;style scoped lang=&quot;scss&quot;&gt;</span><br><span class="line">@import &#x27;@/styles/define.scss&#x27;;</span><br><span class="line">    .box&#123;</span><br><span class="line">        color:$--primary-color;</span><br><span class="line">        background-color:$white-color;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="mixin"><a href="#mixin" class="headerlink" title="@mixin"></a>@mixin</h3><p><strong>可以定义一段代码作为模板样式</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@mixin border-radius($radius: 5px, $borderRadius: 8px) &#123;//可以接收传入的参数</span><br><span class="line">  border: &#123;</span><br><span class="line">    radius: $radius;</span><br><span class="line">    top: $borderRadius solid #ff0;</span><br><span class="line">    bottom: $borderRadius solid #f00;</span><br><span class="line">    left: $borderRadius solid #00f;</span><br><span class="line">    right: $borderRadius solid #888;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@include border-radius(5px, 1px);//传入参数，返回计算好的样式</span><br></pre></td></tr></table></figure><h3 id="extend"><a href="#extend" class="headerlink" title="@extend"></a>@extend</h3><p><strong>继承其它代码段</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@mixin btn($width: 50px, $height: 20px, $font-size: 16px) &#123;</span><br><span class="line">  width: $width;</span><br><span class="line">  height: $height;</span><br><span class="line">  font-size: $font-size;</span><br><span class="line">  text-align: center;</span><br><span class="line">  line-height: $height;</span><br><span class="line">  @include border-radius(5px, 1px);</span><br><span class="line">  &amp;:hover &#123;</span><br><span class="line">    opacity: 0.8;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">.btn &#123;</span><br><span class="line">  @include btn(80px, 30px, 12px);</span><br><span class="line">  margin: &#123;</span><br><span class="line">    top: 10px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">.btn-primary &#123;</span><br><span class="line">  @extend .btn;//继承到了btn的样式</span><br><span class="line">  background-color: $light-blue;</span><br><span class="line">  color: $fontColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vite配置scss"><a href="#Vite配置scss" class="headerlink" title="Vite配置scss"></a>Vite配置scss</h2><p><strong>配置vite.config.ts</strong></p><p>顺便把@别名路径都配置好了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; fileURLToPath &#125; from &#x27;url&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">export default defineConfig(&#123;</span><br><span class="line">    plugins: [vue()],</span><br><span class="line">    css: &#123;</span><br><span class="line">        preprocessorOptions: &#123;</span><br><span class="line">            scss: &#123;</span><br><span class="line">                additionalData: &#x27;@import &quot;@/styles/define.scss&quot;;&#x27;,</span><br><span class="line">                javascriptEnabled: true,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">            &#x27;@&#x27;: fileURLToPath(new URL(&#x27;./src&#x27;, import.meta.url)),</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>初识grid布局</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/grid%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/grid%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="CSS定位元素"><a href="#CSS定位元素" class="headerlink" title="CSS定位元素"></a>CSS定位元素</h1><p><img src="/upload/image-20241110163644817.png" alt="image-20241110163644817.png"></p><h1 id="grid网格布局"><a href="#grid网格布局" class="headerlink" title="grid网格布局"></a>grid网格布局</h1><p><strong>新的长度单位：fr</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一般来说 1fr 的意思是“100%的剩余空间”, .25fr 意味着“25%的剩余空间”。当时当 fr 大于 1 的时候，则会重新计算比例来分配。</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110161821264.png" alt="image-20241110161821264.png"></p><h3 id="grid布局"><a href="#grid布局" class="headerlink" title="grid布局"></a>grid布局</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display: grid;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grid-template-columns: 1fr 1fr 1fr 1fr;</span><br></pre></td></tr></table></figure><p><strong>等价于（repeat）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grid-template-columns: repeat(4, 1fr);</span><br><span class="line">grid-template-columns: repeat(4, .25fr);</span><br></pre></td></tr></table></figure><p>一般都建议使用 **<code>fr&gt;=1</code> 的情况</p><h3 id="响应式设计"><a href="#响应式设计" class="headerlink" title="响应式设计"></a>响应式设计</h3><p>这里 <code>A</code> 和 <code>D</code> 都是固定的 <code>50px</code>，<code>C</code> 是占总宽度的 <code>20%</code>，剩余空间就可以分配给 <code>B</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.grid-container &#123;</span><br><span class="line">  grid-template-columns: 50px 1fr 20% 50px;</span><br><span class="line">  column-gap: 10px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110161302301.png" alt="image-20241110161302301.png"></p><h3 id="船新用法"><a href="#船新用法" class="headerlink" title="船新用法"></a>船新用法</h3><p><strong>3*3的网格</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//网格布局</span><br><span class="line">.face &#123;</span><br><span class="line">    display: grid;</span><br><span class="line">    grid-template-rows:repeat(3,1fr);</span><br><span class="line">    grid-template-columns: repeat(3,lfr);</span><br><span class="line">    grid-template-areas:</span><br><span class="line">        &quot;lt . rt&quot;</span><br><span class="line">        &quot;lc cc rc&quot;</span><br><span class="line">        &quot;lb . rb&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//规划块布局</span><br><span class="line">.lt-dot&#123;</span><br><span class="line">    grid-area: lt;</span><br><span class="line">&#125;</span><br><span class="line">.lr-dot&#123;</span><br><span class="line">    grid-area: lr;</span><br><span class="line">&#125;</span><br><span class="line">.lc-dot&#123;</span><br><span class="line">    grid-area: lc;</span><br><span class="line">&#125;</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110163133135.png" alt="image-20241110163133135.png"></p><h3 id="相比Flex"><a href="#相比Flex" class="headerlink" title="相比Flex"></a>相比Flex</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Flex是一维布局，Grid是二维</span><br><span class="line">浏览器对Flex的兼容性更好</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Grid适用于大面积的整体布局</span><br><span class="line">小面积组件Flex更灵活</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>grid布局实战</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/grid+transform%E5%AE%9E%E7%8E%B0%E9%A1%B5%E9%9D%A23D%E9%AA%B0%E5%AD%90/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/grid+transform%E5%AE%9E%E7%8E%B0%E9%A1%B5%E9%9D%A23D%E9%AA%B0%E5%AD%90/</url>
      
        <content type="html"><![CDATA[<h1 id="grid-transform实现页面3D骰子"><a href="#grid-transform实现页面3D骰子" class="headerlink" title="grid+transform实现页面3D骰子"></a>grid+transform实现页面3D骰子</h1><h2 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h2><h3 id="transform"><a href="#transform" class="headerlink" title="transform"></a><em>transform</em></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform-style: preserve-3d;/*所有子元素在3D空间中呈现*/</span><br></pre></td></tr></table></figure><h3 id="偏移"><a href="#偏移" class="headerlink" title="偏移"></a><em><strong>偏移</strong></em></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: translateX(90px) translateY(90px) translateZ(90px);/*左右 下上 前后*/</span><br></pre></td></tr></table></figure><h3 id="旋转"><a href="#旋转" class="headerlink" title="旋转"></a><em><strong>旋转</strong></em></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110201517099.png" alt="image-20241110201517099.png"></p><h2 id="实战效果"><a href="#实战效果" class="headerlink" title="实战效果"></a><strong>实战效果</strong></h2><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;wrap&quot; id=&quot;dice&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid first-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot cc-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid second-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid third-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot cc-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid forth-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot lb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid fifth-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot lb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot cc-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid sixth-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot lc-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot lb-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rt-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rc-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h5 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">container                       //外层占位容器</span><br><span class="line">    wrap / dice                 //控制旋转</span><br><span class="line">        face / face-grid * 6    //面</span><br><span class="line">            dot / red           //点</span><br></pre></td></tr></table></figure><h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><h5 id="box-sizing"><a href="#box-sizing" class="headerlink" title="box-sizing"></a><strong>box-sizing</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">div &#123;</span><br><span class="line">    box-sizing: border-box;/*元素的width和height包括content、padding和border的宽度，但不包括margin*/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="渐变边框技术做面"><a href="#渐变边框技术做面" class="headerlink" title="渐变边框技术做面"></a><strong>渐变边框技术做面</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.face &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 120px;</span><br><span class="line">    height: 120px;</span><br><span class="line">    padding: 20px;/*w/h/p都包裹边框的宽度，是从边框的最里往里padding*/</span><br><span class="line">    opacity: 0.95;</span><br><span class="line">    border: 8px solid transparent; /*8px的透明边框，就是渐变边框的宽度*/</span><br><span class="line">    background-clip: padding-box, border-box;/*必要的两项*/</span><br><span class="line">    background-origin: padding-box, border-box;/*必要的两项*/</span><br><span class="line">    background-image: </span><br><span class="line">        linear-gradient(135deg, #e1eeffbb, #f3d5ffbb),</span><br><span class="line">        linear-gradient(135deg, rgb(0, 60, 255), rgb(0, 225, 255), #f0f);/*渐变角度+渐变颜色*/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="grid做点（face-grid）"><a href="#grid做点（face-grid）" class="headerlink" title="grid做点（face-grid）"></a><strong>grid做点（face-grid）</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">.face-grid &#123;</span><br><span class="line">    /*骰子点数布局*/</span><br><span class="line">    display: grid;</span><br><span class="line">    grid-template-rows: repeat(3, 1fr);/*行*/</span><br><span class="line">    grid-template-columns: repeat(3, 1fr);/*列*/</span><br><span class="line">    grid-template-areas:</span><br><span class="line">        &#x27;lt . rt&#x27;</span><br><span class="line">        &#x27;lc cc rc&#x27;</span><br><span class="line">        &#x27;lb . rb&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">.lt-dot &#123;</span><br><span class="line">    grid-area: lt;</span><br><span class="line">&#125;</span><br><span class="line">.rt-dot &#123;</span><br><span class="line">    grid-area: rt;</span><br><span class="line">&#125;</span><br><span class="line">.lc-dot &#123;</span><br><span class="line">    grid-area: lc;</span><br><span class="line">&#125;</span><br><span class="line">.cc-dot &#123;</span><br><span class="line">    grid-area: cc;</span><br><span class="line">&#125;</span><br><span class="line">.rc-dot &#123;</span><br><span class="line">    grid-area: rc;</span><br><span class="line">&#125;</span><br><span class="line">.lb-dot &#123;</span><br><span class="line">    grid-area: lb;</span><br><span class="line">&#125;</span><br><span class="line">.rb-dot &#123;</span><br><span class="line">    grid-area: rb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="点状样式（dot-red）"><a href="#点状样式（dot-red）" class="headerlink" title="点状样式（dot&#x2F;red）"></a><strong>点状样式（dot&#x2F;red）</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.dot &#123;/*黑点*/</span><br><span class="line">    display: inline-block;</span><br><span class="line">    width: 25px;</span><br><span class="line">    height: 25px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    background-color: #1759af;</span><br><span class="line">&#125;</span><br><span class="line">.red &#123;/*红点（继承黑点属性）*/</span><br><span class="line">    background-color: rgb(162, 0, 211);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="偏移-旋转面"><a href="#偏移-旋转面" class="headerlink" title="偏移+旋转面"></a><strong>偏移+旋转面</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1面（前） 前移 50%边长</span><br><span class="line">6面（后） 后移 50%边长</span><br><span class="line">2面（左） 左移 50%边长 + Y 90deg</span><br><span class="line">3面（右） 右移 50%边长 + Y 90deg</span><br><span class="line">5面（上） 上移 50%边长 + X 90deg</span><br><span class="line">4面（下） 下移 50%边长 + X 90deg</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.first-face &#123;</span><br><span class="line">    transform: translateZ(60px);</span><br><span class="line">&#125;</span><br><span class="line">.second-face &#123;</span><br><span class="line">    transform: translateX(-60px) rotateY(90deg);</span><br><span class="line">&#125;</span><br><span class="line">.third-face &#123;</span><br><span class="line">    transform: translateX(50%) rotateY(90deg);</span><br><span class="line">&#125;</span><br><span class="line">.forth-face &#123;</span><br><span class="line">    transform: translateY(50%) rotateX(90deg);</span><br><span class="line">&#125;</span><br><span class="line">.fifth-face &#123;</span><br><span class="line">    transform: translateY(-50%) rotateX(90deg);</span><br><span class="line">&#125;</span><br><span class="line">.sixth-face &#123;</span><br><span class="line">    transform: translateZ(-60px);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a><strong>效果图</strong></h5><p><img src="/upload/image-20241115172203521.png" alt="image-20241115172203521.png"></p><h5 id="加点动效（CSS-hover）"><a href="#加点动效（CSS-hover）" class="headerlink" title="加点动效（CSS_hover）"></a><strong>加点动效（CSS_hover）</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.wrap:hover &#123;</span><br><span class="line">    transform: rotateX(300deg) rotateY(0deg) rotateZ(100deg) !important;</span><br><span class="line">    transition: transform 2s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JS实现随机点数"><a href="#JS实现随机点数" class="headerlink" title="JS实现随机点数"></a>JS实现随机点数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    let wrap = document.querySelector(&#x27;.wrap&#x27;)</span><br><span class="line">    let rotateX = 0 // 初始化旋转角度</span><br><span class="line">    let rotateY = 0</span><br><span class="line">    let rotateZ = 0</span><br><span class="line"></span><br><span class="line">    wrap.onclick = function () &#123;</span><br><span class="line">        let x = Math.floor(Math.random() * 10) - 5 //随机数，范围是-5到5</span><br><span class="line">        let y = Math.floor(Math.random() * 10) - 5</span><br><span class="line">        let z = Math.floor(Math.random() * 10) - 5</span><br><span class="line">        rotateX += x * 90</span><br><span class="line">        rotateY += y * 90</span><br><span class="line">        rotateZ += z * 90</span><br><span class="line">        wrap.style.transform = `rotateX($&#123;rotateX&#125;deg) rotateY($&#123;rotateY&#125;deg) rotateZ($&#123;rotateZ&#125;deg)`</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><strong>暂时还不会计算旋转后的点数显示</strong></p><p><strong>等有思路了继续更新</strong></p>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CSS搭建页面3D空间</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/CSS%E6%90%AD%E5%BB%BA%E9%A1%B5%E9%9D%A23D%E7%A9%BA%E9%97%B4/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/CSS%E6%90%AD%E5%BB%BA%E9%A1%B5%E9%9D%A23D%E7%A9%BA%E9%97%B4/</url>
      
        <content type="html"><![CDATA[<h1 id="CSS搭建页面3D空间"><a href="#CSS搭建页面3D空间" class="headerlink" title="CSS搭建页面3D空间"></a>CSS搭建页面3D空间</h1><p><strong>重磅CSS属性</strong></p><h5 id="transform"><a href="#transform" class="headerlink" title="transform"></a><em>transform</em></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform-style: preserve-3d;/*所有子元素在3D空间中呈现*/</span><br></pre></td></tr></table></figure><p><em><strong>偏移</strong></em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: translateX(90px) translateY(90px) translateZ(90px);/*左右 下上 前后*/</span><br></pre></td></tr></table></figure><p><em><strong>旋转</strong></em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110201517099.png" alt="image-20241110201517099.png"></p>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>有关CSS的常见问题</title>
      <link href="/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/CSS%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
      <url>/2025/03/08/%E5%A4%A7%E5%89%8D%E7%AB%AF/CSS%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h5 id="元素区分"><a href="#元素区分" class="headerlink" title="元素区分"></a>元素区分</h5><p><strong>块元素</strong><strong>div &#x2F; p &#x2F; h &#x2F; ul &#x2F; li</strong></p><p><strong>行内元素</strong><strong>a &#x2F; span &#x2F;br</strong></p><p><strong>行内块元素</strong><strong>img &#x2F; input &#x2F; td</strong></p><h5 id="高度塌陷"><a href="#高度塌陷" class="headerlink" title="高度塌陷"></a>高度塌陷</h5><p><strong>就是外边距margin塌陷</strong></p><p><strong>只会发生在垂直方向，只出现在块级元素上</strong></p><p><strong>解决：子绝父相</strong></p><h5 id="浮动塌陷"><a href="#浮动塌陷" class="headerlink" title="浮动塌陷"></a>浮动塌陷</h5><p><strong>元素一旦****浮动</strong>后，<strong>脱离标准流</strong>，朝着向左或右方向移动，直到自己的<strong>边界紧贴包含块</strong>(一般是父元素)或者其他浮动元素的边界为止</p><p><strong>clear</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">div -&gt;  display:float</span><br><span class="line">    span    //float: left</span><br><span class="line">    span    //若未设置高度，则span浮动于父元素上方，产生高度塌陷</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">    p   -&gt;  clear: both</span><br><span class="line">div</span><br></pre></td></tr></table></figure><p><strong>创建BFC</strong></p><p>BFC原理详情见文章 “格式化上下文–BFC与IFC”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://154.40.44.42:8090/archives/ge-shi-hua-shang-xia-wen--bfcyu-ifc</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">div -&gt;  display:float / overflow: hidden/auto</span><br><span class="line">    span    //float: left</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">div</span><br></pre></td></tr></table></figure><p><strong>伪元素（!最推荐!）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">div class=clearfix  父元素</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.clearfix::after&#123;</span><br><span class="line">    content: &#x27;&#x27;     //设置为空元素</span><br><span class="line">    display: block  //设置为块级元素</span><br><span class="line">    clear: both     //clear清除浮动</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="三角形"><a href="#三角形" class="headerlink" title="三角形"></a>三角形</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">w:0</span><br><span class="line">h:0</span><br><span class="line">border: 250px solid transparent</span><br><span class="line">border-方向-color:颜色</span><br></pre></td></tr></table></figure><h5 id="固定宽高比"><a href="#固定宽高比" class="headerlink" title="固定宽高比"></a>固定宽高比</h5><p><strong>需要父元素</strong></p><p><strong>宽高比&#x3D;4:3示例</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">w:100%              //为父元素100%</span><br><span class="line">h:0</span><br><span class="line">padding:0</span><br><span class="line">padding-bottom:75%  //为父元素75%</span><br></pre></td></tr></table></figure><h5 id="超出省略"><a href="#超出省略" class="headerlink" title="超出省略"></a>超出省略</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">white-space: nowrap;</span><br><span class="line">text-overflow: ellipsis;</span><br><span class="line">overflow: hidden;</span><br></pre></td></tr></table></figure><h5 id="渐变边框"><a href="#渐变边框" class="headerlink" title="渐变边框"></a>渐变边框</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    border: 8px solid transparent; /*8px的透明边框*/</span><br><span class="line">    border-radius: 12px; /*圆角*/</span><br><span class="line">    background-clip: padding-box, border-box;/*background-clip 设置元素的背景是否延伸到边框、内边距盒子、内容盒子下面。背景延伸至边框外沿（但是在边框下层）且背景延伸至内边距（padding）外沿。不会绘制到边框处。*/</span><br><span class="line">    background-origin: padding-box, border-box;/*背景图片的摆放以 border padding 区域为参考*/</span><br><span class="line">    background-image: </span><br><span class="line">        linear-gradient(to right, #fff, #fff),</span><br><span class="line">        linear-gradient(135deg, #f00, #ff0, #f0f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WebRTC实现本地视频通话 | 全流程详解</title>
      <link href="/2025/03/04/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/WebRTC%E5%AE%9E%E7%8E%B0%E6%9C%AC%E5%9C%B0%E8%A7%86%E9%A2%91%E9%80%9A%E8%AF%9D%E5%85%A8%E6%B5%81%E7%A8%8B/"/>
      <url>/2025/03/04/%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/WebRTC%E5%AE%9E%E7%8E%B0%E6%9C%AC%E5%9C%B0%E8%A7%86%E9%A2%91%E9%80%9A%E8%AF%9D%E5%85%A8%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="WebRTC-实现本地视频通话-全流程详解"><a href="#WebRTC-实现本地视频通话-全流程详解" class="headerlink" title="WebRTC 实现本地视频通话 | 全流程详解"></a>WebRTC 实现本地视频通话 | 全流程详解</h1><p>源码见仓库 <a href="https://github.com/Breezli/WebRTC_Demo">Breezli&#x2F;WebRTC_Demo: 基于 WebRTC 技术实现的本地网页端视频通话</a></p><p>分为前后端两个文件夹</p><blockquote><p>webrtc-client (客户端)</p><p>webrtc-server (服务端)</p></blockquote><h2 id="预先准备"><a href="#预先准备" class="headerlink" title="预先准备"></a>预先准备</h2><h3 id="webrtc-client"><a href="#webrtc-client" class="headerlink" title="webrtc-client"></a>webrtc-client</h3><p>前端页面绘制</p><p><code>依赖下载</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pnpm create vite@latest webrtc-client -- --template vue-ts</span><br><span class="line">pnpm install -D tailwindcss postcss autoprefixer</span><br><span class="line">npx tailwindcss init -p</span><br></pre></td></tr></table></figure><p><code>package.json</code>直通</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webrtc-client&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;private&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;module&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-tsc -b &amp;&amp; vite build&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;preview&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite preview&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;socket.io-client&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.8.1&quot;</span><span class="punctuation">,</span> <span class="comment">//重要依赖</span></span><br><span class="line"><span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.5.13&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;@vitejs/plugin-vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.2.1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;@vue/tsconfig&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.7.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;autoprefixer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^10.4.20&quot;</span><span class="punctuation">,</span> <span class="comment">//自动添加css前缀</span></span><br><span class="line"><span class="attr">&quot;postcss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^8.4.49&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;tailwindcss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.4.17&quot;</span><span class="punctuation">,</span> <span class="comment">//tailwindcss样式库</span></span><br><span class="line"><span class="attr">&quot;typescript&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~5.6.2&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.0.5&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vue-tsc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.2.0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><code>App.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&quot;flex items-center flex-col text-center p-12 h-screen&quot;&gt;</span><br><span class="line">&lt;div class=&quot;relative h-full mb-4&quot;&gt;</span><br><span class="line">&lt;video</span><br><span class="line">ref=&quot;localVideo&quot;</span><br><span class="line">class=&quot;w-96 h-full bg-gray-200 mb-4 object-cover&quot;&gt;&lt;/video&gt;</span><br><span class="line">&lt;video</span><br><span class="line">ref=&quot;remoteVideo&quot;</span><br><span class="line">class=&quot;w-32 h-48 absolute bottom-0 right-0 object-cover&quot;&gt;&lt;/video&gt;</span><br><span class="line">&lt;div</span><br><span class="line">v-if=&quot;caller &amp;&amp; calling&quot;</span><br><span class="line">class=&quot;absolute top-2/3 left-36 flex flex-col items-center&quot;&gt;</span><br><span class="line">&lt;p class=&quot;mb-4 text-white&quot;&gt;等待对方接听...&lt;/p&gt;</span><br><span class="line">&lt;img</span><br><span class="line">@click=&quot;hangUp&quot;</span><br><span class="line">src=&quot;/refuse.svg&quot;</span><br><span class="line">class=&quot;w-16 cursor-pointer&quot;</span><br><span class="line">alt=&quot;&quot; /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div</span><br><span class="line">v-if=&quot;called &amp;&amp; calling&quot;</span><br><span class="line">class=&quot;absolute top-2/3 left-32 flex flex-col items-center&quot;&gt;</span><br><span class="line">&lt;p class=&quot;mb-4 text-white&quot;&gt;收到视频邀请...&lt;/p&gt;</span><br><span class="line">&lt;div class=&quot;flex&quot;&gt;</span><br><span class="line">&lt;img</span><br><span class="line">@click=&quot;hangUp&quot;</span><br><span class="line">src=&quot;/refuse.svg&quot;</span><br><span class="line">class=&quot;w-16 cursor-pointer mr-4&quot;</span><br><span class="line">alt=&quot;&quot; /&gt;</span><br><span class="line">&lt;img</span><br><span class="line">@click=&quot;acceptCall&quot;</span><br><span class="line">src=&quot;/accept.svg&quot;</span><br><span class="line">class=&quot;w-16 cursor-pointer&quot;</span><br><span class="line">alt=&quot;&quot; /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;flex gap-2 mb-4&quot;&gt;</span><br><span class="line">&lt;button</span><br><span class="line">class=&quot;rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white&quot;</span><br><span class="line">@click=&quot;callRemote&quot;&gt;</span><br><span class="line">发起视频</span><br><span class="line">&lt;/button&gt;</span><br><span class="line">&lt;button</span><br><span class="line">class=&quot;rounded-md bg-red-600 px-4 py-2 text-sm font-semibold text-white&quot;</span><br><span class="line">@click=&quot;hangUp&quot;&gt;</span><br><span class="line">挂断视频</span><br><span class="line">&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p><code>main.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>style.css</code> 这里使用了 tailwind 的样式库</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@tailwind</span> base;</span><br><span class="line"><span class="keyword">@tailwind</span> components;</span><br><span class="line"><span class="keyword">@tailwind</span> utilities;</span><br></pre></td></tr></table></figure><p><code>tailwind.config.js</code> 此配置文件中添加所有模板文件的路径</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;tailwindcss&#x27;).Config</span>&#125; */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="attr">content</span>: [<span class="string">&#x27;./index.html&#x27;</span>, <span class="string">&#x27;./src/**/*.&#123;vue,js,ts,jsx,tsx&#125;&#x27;</span>],</span><br><span class="line"><span class="attr">theme</span>: &#123;</span><br><span class="line"><span class="attr">extend</span>: &#123;&#125;,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">plugins</span>: [],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>到此前端页面绘制完成，可在 3000 端口可启动 node 服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run start</span><br></pre></td></tr></table></figure><h3 id="webrtc-server"><a href="#webrtc-server" class="headerlink" title="webrtc-server"></a>webrtc-server</h3><p>初始化服务端项目</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm init</span><br></pre></td></tr></table></figure><p><code>socket.io</code> 封装了 websocket 应用创建服务</p><p><code>nodemon</code> 代码改变会自动重启(不用重复地开关)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install socket.io nodemon</span><br></pre></td></tr></table></figure><p><code>package.json</code> 添加<code>start</code>命令，使用<code>nodemon</code>启动项目</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nodemon index.js&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>创建<code>index.js</code>（最初版，之后后端的所有操作都在这个文件上进行）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = <span class="built_in">require</span>(<span class="string">&#x27;socket.io&#x27;</span>) <span class="comment">//封装了websocket应用创建服务</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>) <span class="comment">//引入http模块</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>() <span class="comment">//创建服务器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> io = <span class="title function_">socket</span>(server, &#123;</span><br><span class="line"><span class="attr">cors</span>: &#123;</span><br><span class="line"><span class="attr">origin</span>: <span class="string">&#x27;*&#x27;</span>, <span class="comment">// 配置跨域</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/////接下来的主体部分/////</span></span><br><span class="line">io.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">sock</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接成功...&#x27;</span>)</span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>) <span class="comment">// 向客户端发送连接成功的消息</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">io.<span class="title function_">on</span>(<span class="string">&#x27;disconnect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接断开&#x27;</span>)</span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;connectionFalse&#x27;</span>) <span class="comment">// 向客户端发送连接断开的消息</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/////接下来的主体部分/////</span></span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="插播-socket-重要概念"><a href="#插播-socket-重要概念" class="headerlink" title="!!!插播 socket 重要概念!!!"></a>!!!插播 socket 重要概念!!!</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.emit发送事件</span><br><span class="line">.on监听事件</span><br></pre></td></tr></table></figure><p>常见内置事件说明</p><table><thead><tr><th align="center">事件名称</th><th align="center">触发场景</th><th align="center">使用位置</th></tr></thead><tbody><tr><td align="center">connect</td><td align="center">客户端成功连接到服务端时</td><td align="center">客户端</td></tr><tr><td align="center">connection</td><td align="center">服务端接收到新客户端连接时</td><td align="center">服务端</td></tr><tr><td align="center">disconnect</td><td align="center">连接断开时</td><td align="center">客户端&#x2F;服务端</td></tr><tr><td align="center">error</td><td align="center">连接发生错误时</td><td align="center">客户端&#x2F;服务端</td></tr></tbody></table><p>后端至此搭建完成，可在 3000 端口可启动 node 服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run start</span><br></pre></td></tr></table></figure><h2 id="前端连接信令服务器"><a href="#前端连接信令服务器" class="headerlink" title="前端连接信令服务器"></a>前端连接信令服务器</h2><p>依靠的就是<code>socket.io-client</code></p><p>接下来我们将在<code>App.vue</code>中开始编写脚本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, onMounted, onUnmounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; io, Socket &#125; from &#x27;socket.io-client&#x27;</span><br><span class="line"></span><br><span class="line">const socket = ref&lt;Socket&gt;() // 前端Socket实例</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">const sock = io(&#x27;localhost:3000&#x27;) // 通过 io(&#x27;localhost:3000&#x27;) 创建的 Socket.IO 客户端实例</span><br><span class="line"></span><br><span class="line">// 连接成功</span><br><span class="line">sock.on(&#x27;connectionSuccess&#x27;, () =&gt; &#123;</span><br><span class="line">console.log(&#x27;连接成功&#x27;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">socket.value = sock // 存储Socket实例</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>还记得吗，就在前两步，后端在连接成功后向前端.emit(发送)了 connectionSuccess 事件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">io.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">sock</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接成功...&#x27;</span>)</span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>) <span class="comment">// 向客户端发送连接成功的消息</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>而在此时的前端加入的</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 接收到服务端发来的connectionSuccess(连接成功)事件</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>前后端交互正式开始</p><h2 id="发起视频请求"><a href="#发起视频请求" class="headerlink" title="发起视频请求"></a>发起视频请求</h2><h3 id="获取本地音视频流"><a href="#获取本地音视频流" class="headerlink" title="获取本地音视频流"></a>获取本地音视频流</h3><p>前端</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getLocalStream</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">const</span> stream = <span class="keyword">await</span> navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123;</span><br><span class="line"><span class="comment">// 获取音视频流</span></span><br><span class="line"><span class="attr">video</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">audio</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br><span class="line">localVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = stream <span class="comment">// 将媒体流设置到 video 标签上播放</span></span><br><span class="line">localVideo.<span class="property">value</span>!.<span class="title function_">play</span>() <span class="comment">// 播放音视频流</span></span><br><span class="line">localStream.<span class="property">value</span> = stream <span class="comment">// 存储本地流</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> stream</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="“房间”的概念"><a href="#“房间”的概念" class="headerlink" title="“房间”的概念"></a>“房间”的概念</h3><blockquote><p>不妨先停下来思考一下，为什么在同一个网页，不同的客户端可以看见不同的页面，和实时共享的内容</p></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250205190246032.png" alt="image-20250205190246032" style="zoom: 33%;" /><p>我们先来看一看之前给前端写的组件（layout 省略版）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;video ref=&quot;localVideo&quot;&gt;&lt;/video&gt;</span><br><span class="line">//本地视频</span><br><span class="line">&lt;video ref=&quot;remoteVideo&quot;&gt;&lt;/video&gt;</span><br><span class="line">//接收方视频（位于右下角）</span><br><span class="line"></span><br><span class="line">&lt;div v-if=&quot;caller &amp;&amp; calling&quot;&gt;//状态参数---caller:发送方---calling:呼叫中</span><br><span class="line">    &lt;p&gt;等待对方接听...&lt;/p&gt;</span><br><span class="line">    &lt;img @click=&quot;hangUp&quot; src=&quot;/refuse.svg&quot;/&gt;//挂断</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div v-if=&quot;called &amp;&amp; calling&quot;&gt;//状态参数---called:接收方---calling:呼叫中</span><br><span class="line">    &lt;p&gt;收到视频邀请...&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    &lt;img @click=&quot;hangUp&quot; src=&quot;/refuse.svg&quot;/&gt;//挂断</span><br><span class="line">    &lt;img @click=&quot;acceptCall&quot; src=&quot;/accept.svg&quot;/&gt;//接听</span><br><span class="line"></span><br><span class="line">    &lt;button @click=&quot;callRemote&quot;&gt;发起视频&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;hangUp&quot;&gt;挂断视频&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><blockquote><p>不难发现我们是依靠状态参数来控制页面显示的</p></blockquote><p>本项目参数表如下</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> called = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// 是否是接收方</span></span><br><span class="line"><span class="keyword">const</span> caller = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// 是否是发起方</span></span><br><span class="line"><span class="keyword">const</span> calling = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// 呼叫中</span></span><br><span class="line"><span class="keyword">const</span> communicating = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// 视频通话中</span></span><br><span class="line"><span class="keyword">const</span> localVideo = ref&lt;<span class="title class_">HTMLVideoElement</span>&gt;() <span class="comment">// video标签实例，播放本人的视频</span></span><br><span class="line"><span class="keyword">const</span> remoteVideo = ref&lt;<span class="title class_">HTMLVideoElement</span>&gt;() <span class="comment">// video标签实例，播放对方的视频</span></span><br><span class="line"><span class="keyword">const</span> localStream = ref&lt;<span class="title class_">MediaStream</span>&gt;() <span class="comment">// 本地流</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> roomId = <span class="string">&#x27;001&#x27;</span> <span class="comment">// 房间ID</span></span><br></pre></td></tr></table></figure><p>顺便带上实例创建</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = ref&lt;<span class="title class_">Socket</span>&gt;() <span class="comment">// Socket实例</span></span><br><span class="line"><span class="keyword">const</span> peer = ref&lt;<span class="built_in">any</span>&gt;() <span class="comment">// RTCPeerConnection实例</span></span><br></pre></td></tr></table></figure><p>而对于我们这个项目，<code>房间</code>的概念就很简单</p><blockquote><p>A (左) 向 B (右) 发起接通请求，在 B 接收请求后，双方都将加入这个视频通话的”房间”</p><p>房间 可以通过自主分配 id 划分，每个房间也可以加入很多用户 (如直播系统)</p><p>服务端含有加入房间的操纵代码 sock.join(Id)</p></blockquote><h3 id="加入房间请求"><a href="#加入房间请求" class="headerlink" title="加入房间请求"></a>加入房间请求</h3><p>前端</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接服务器成功...&#x27;</span>)</span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;joinRoom&#x27;</span>, roomId) <span class="comment">// 前端发送加入房间事件</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>后端</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;joinRoom&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line">sock.<span class="title function_">join</span>(roomId) <span class="comment">// 加入房间</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="发起视频请求-1"><a href="#发起视频请求-1" class="headerlink" title="发起视频请求"></a>发起视频请求</h3><p><strong>A 方按钮触发函数</strong></p><p>前端</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">callRemote</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发起视频&#x27;</span>) <span class="comment">// 状态更新</span></span><br><span class="line">caller.<span class="property">value</span> = <span class="literal">true</span> <span class="comment">// 发送方标记</span></span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">true</span> <span class="comment">// 呼叫中</span></span><br><span class="line"><span class="keyword">await</span> <span class="title function_">getLocalStream</span>() <span class="comment">// 获取本地音视频流函数</span></span><br><span class="line">socket.<span class="property">value</span>?.<span class="title function_">emit</span>(<span class="string">&#x27;callRemote&#x27;</span>, roomId) <span class="comment">// 发送视频请求事件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>后端</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;callRemote&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 收到发送方的视频请求事件</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCall&#x27;</span>) <span class="comment">// 向这个房间中的所有人广播事件receiveCall</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>前端</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveCall&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 房间内所有接收方监听到视频请求事件</span></span><br><span class="line"><span class="keyword">if</span> (!caller.<span class="property">value</span>) &#123;</span><br><span class="line"><span class="comment">// 非发起方</span></span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">true</span> <span class="comment">// 呼叫中</span></span><br><span class="line">called.<span class="property">value</span> = <span class="literal">true</span> <span class="comment">// 接收方标记</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>此时 A(发起)方启动摄像头和麦克风，并等待对方接听</p><p>B(接收)方出现 接听&#x2F;挂断 按钮</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-if=&quot;caller &amp;&amp; calling&quot;&gt;//状态参数---caller:发送方---calling:呼叫中</span><br><span class="line">    &lt;p&gt;等待对方接听...&lt;/p&gt;</span><br><span class="line">    &lt;img @click=&quot;hangUp&quot; src=&quot;/refuse.svg&quot;/&gt;//挂断</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div v-if=&quot;called &amp;&amp; calling&quot;&gt;//状态参数---called:接收方---calling:呼叫中</span><br><span class="line">    &lt;p&gt;收到视频邀请...&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    &lt;img @click=&quot;hangUp&quot; src=&quot;/refuse.svg&quot;/&gt;//挂断</span><br><span class="line">    &lt;img @click=&quot;acceptCall&quot; src=&quot;/accept.svg&quot;/&gt;//接听</span><br><span class="line"></span><br><span class="line">    &lt;button @click=&quot;callRemote&quot;&gt;发起视频&lt;/button&gt;//发起</span><br><span class="line">    &lt;button @click=&quot;hangUp&quot;&gt;挂断视频&lt;/button&gt;//挂断</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h3 id="接收-挂断-视频"><a href="#接收-挂断-视频" class="headerlink" title="接收 &#x2F; 挂断 视频"></a>接收 &#x2F; 挂断 视频</h3><p><strong><em>趁着现在，我们添上其他按钮绑定的函数</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 挂断视频</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hangUp</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;hangUp&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收视频请求（接收方）</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">acceptCall</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;acceptCall&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><em>接着来看后端怎么处理</em></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 挂断视频</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;hangUp&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;hangUp&#x27;</span>) <span class="comment">// 向Id房间内所有人广播这个事件</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收视频请求</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;acceptCall&#x27;</span>) <span class="comment">// 向Id房间内所有人广播这个事件</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong><em>返回前端，处理我们接收到的 hangUp || acceptCall</em></strong></p><p><strong>挂断视频</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;hangUp&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">reset</span>() <span class="comment">// 重置状态</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>重置状态函数</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">reset</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">called.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">caller.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">communicating.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">peer.<span class="property">value</span> = <span class="literal">null</span></span><br><span class="line">localVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = <span class="literal">null</span> <span class="comment">// 关闭本地视频</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = <span class="literal">null</span> <span class="comment">// 关闭远程视频</span></span><br><span class="line">localStream.<span class="property">value</span>?.<span class="title function_">getTracks</span>()[<span class="number">0</span>].<span class="title function_">stop</span>() <span class="comment">// 关闭本地流</span></span><br><span class="line"><span class="comment">// localStream.value = undefined // 关闭本地流（相同效果）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>接受视频请求</strong></p><p>而这个就变复杂了</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;</span><br><span class="line"><span class="comment">// 发送方</span></span><br><span class="line">peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>() <span class="comment">// 创建RTCPeerConnection对象</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="title function_">addStream</span>(localStream.<span class="property">value</span>) <span class="comment">// 添加本地音视频流</span></span><br><span class="line"></span><br><span class="line">peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 获取candidate信息</span></span><br><span class="line"><span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;) <span class="comment">// 向服务器发送candidate信息</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取对方的音视频流</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment">// 拿到对方的视频流</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 生成offer</span></span><br><span class="line"><span class="keyword">const</span> offer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createOffer</span>(&#123;</span><br><span class="line"><span class="attr">offerToReceiveAudio</span>: <span class="literal">true</span>, <span class="comment">// 是否接收对方的音频</span></span><br><span class="line"><span class="attr">offerToReceiveVideo</span>: <span class="literal">true</span>, <span class="comment">// 是否接收对方的视频</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(offer) <span class="comment">// 设置本地描述的offer</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, &#123; roomId, offer &#125;) <span class="comment">// 发送offer</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="交换-SDP-信息和-candidate-信息"><a href="#交换-SDP-信息和-candidate-信息" class="headerlink" title="交换 SDP 信息和 candidate 信息"></a>交换 SDP 信息和 candidate 信息</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p><strong><em>SDP</em></strong> ：WebRTC 的一种协议，用于描述<strong>设备支持的媒体格式</strong></p><p><strong><em>candidate</em></strong> ：网络信息</p><p><strong>媒体协商</strong> ：交换 SDP</p><p><strong>ICE</strong> ：WebRTC 的通信机制</p><img src="C:\Users\DELL\Desktop\WebRTC资料\WebRTC\讲义\04.png" alt="04" style="zoom: 50%;" /><p>工作原理</p><blockquote><p>1.双方收集本地网络地址（分 共有 | 私有）+ STUN 和 TURN 服务器获取候选地址</p><p>2.双方通过信令服务器交换这些候选地址</p><p>3.双方使用候选地址进行连接测试，确定最佳的可用地址，开始实时音视频通话</p></blockquote><h3 id="媒体协商"><a href="#媒体协商" class="headerlink" title="媒体协商"></a>媒体协商</h3><p><strong>接下来是最重要的信令交换步骤（WebRTC 核心）</strong></p><p>主要用到以下方法</p><p>媒体协商</p><blockquote><p>createOffer</p><p>createAnswer</p><p>setLocalDesccription</p><p>setRemoteDesccription</p></blockquote><p>重要事件</p><blockquote><p>onicecandidate</p><p>onaddstream</p></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250113163924170.png" alt="image-20250113163924170" style="zoom:50%;" /><p>步骤流程重绘（可以对标号有个印象）</p><blockquote><p>预告：所有函数均在前端实现，后端起到向前端广播作用</p></blockquote><img src="E:\QQ缓存/IMG_20250205_220254.jpg" alt="IMG_20250205_220254" style="zoom: 25%;" /><p>紧接着接收方接收到对方同意的消息</p><h3 id="信息交换全程"><a href="#信息交换全程" class="headerlink" title="信息交换全程"></a>信息交换全程</h3><p>前端（发送方）</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;<span class="comment">// 发送方</span></span><br><span class="line">        peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>()<span class="comment">// 创建RTCPeerConnection对象</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="title function_">addStream</span>(localStream.<span class="property">value</span>)<span class="comment">// 添加本地音视频流</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取candidate信息</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line">                <span class="comment">// 向服务器发送candidate信息</span></span><br><span class="line">                sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取对方的音视频流</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">            calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">            communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">            <span class="comment">// 拿到对方的视频流</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ---①---</span><br><span class="line">        <span class="keyword">const</span> offer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createOffer</span>(&#123;<span class="comment">// 生成offer</span></span><br><span class="line">            <span class="attr">offerToReceiveAudio</span>: <span class="literal">true</span>, <span class="comment">// 是否接收对方的音频</span></span><br><span class="line">            <span class="attr">offerToReceiveVideo</span>: <span class="literal">true</span>, <span class="comment">// 是否接收对方的视频</span></span><br><span class="line">        &#125;)</span><br><span class="line">        ---②---</span><br><span class="line">        <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(offer)<span class="comment">// 设置本地描述的offer</span></span><br><span class="line">        ---③---</span><br><span class="line">        sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, &#123; roomId, offer &#125;)<span class="comment">// 发送offer !!!注意,这里offer已经当参数传过去了!!!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>后端</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, candidate &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, candidate) <span class="comment">// 向这个房间里所有人广播candidate信息</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendOffer&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, offer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// !!!offer在这里!!!</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, offer) <span class="comment">// 向这个房间里所有人广播offer信息 &amp;&amp; 向接收方发送这个offer</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>前端（接收方）</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendOffer&#x27;</span>, <span class="title function_">async</span> (<span class="attr">offer</span>: <span class="built_in">any</span>) =&gt; &#123;<span class="comment">// !!!offer传回前端(判断被标注的接收方)!!!</span></span><br><span class="line">    <span class="keyword">if</span> (called.<span class="property">value</span>) &#123;<span class="comment">// 接收方</span></span><br><span class="line">        <span class="keyword">const</span> stream = <span class="keyword">await</span> <span class="title function_">getLocalStream</span>()<span class="comment">// 获取本地音视频流</span></span><br><span class="line">        peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>()<span class="comment">// 接收方创建自己的RTCPeerConnection对象</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="title function_">addStream</span>(stream)<span class="comment">// 添加本地音视频流</span></span><br><span class="line"></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;<span class="comment">// 获取candidate信息</span></span><br><span class="line">            <span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line">                <span class="comment">// 向服务器发送candidate信息</span></span><br><span class="line">                sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取对方的音视频流</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">            calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">            communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">            <span class="comment">// 拿到对方的视频流</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ---④---</span><br><span class="line">        <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setRemoteDescription</span>(offer)<span class="comment">// 设置远端描述信息</span></span><br><span class="line"></span><br><span class="line">        ---⑤---</span><br><span class="line">        <span class="keyword">const</span> answer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createAnswer</span>()<span class="comment">// 生成answer</span></span><br><span class="line">        ---⑥---</span><br><span class="line">        <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(answer)<span class="comment">// 设置本地描述信息</span></span><br><span class="line">        ---⑦---</span><br><span class="line">        sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendAnswer&#x27;</span>, &#123; roomId, answer &#125;)<span class="comment">// 发送answer !!!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>后端</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, candidate &#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// !!!</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, candidate) <span class="comment">// 向这个房间里所有人广播candidate信息</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendAnswer&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, answer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveAnswer&#x27;</span>, answer) <span class="comment">// 向这个房间里所有人广播answer信息 &amp;&amp; 向接收方发送这个answer</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>前端</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveAnswer&#x27;</span>, <span class="function">(<span class="params"><span class="attr">answer</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;<span class="comment">// 发送方</span></span><br><span class="line">        ---⑧---</span><br><span class="line">        peer.<span class="property">value</span>.<span class="title function_">setRemoteDescription</span>(answer)<span class="comment">// 设置远端描述信息</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>为了让文章不那么乱，最后再补一下<em>candidate</em></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, <span class="title function_">async</span> (<span class="attr">candidate</span>: <span class="built_in">any</span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">addIceCandidate</span>(candidate) <span class="comment">// 添加candidate信息</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>一路下来是不是逻辑非常清晰明了 😁 (bushi)</p></blockquote><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><p>前端 (App.vue)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; io, <span class="title class_">Socket</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;socket.io-client&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> roomId = <span class="string">&#x27;001&#x27;</span> <span class="comment">// 房间ID</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> called = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// 是否是接收方</span></span><br><span class="line"><span class="keyword">const</span> caller = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// 是否是发起方</span></span><br><span class="line"><span class="keyword">const</span> calling = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// 呼叫中</span></span><br><span class="line"><span class="keyword">const</span> communicating = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// 视频通话中</span></span><br><span class="line"><span class="keyword">const</span> localVideo = ref&lt;<span class="title class_">HTMLVideoElement</span>&gt;() <span class="comment">// video标签实例，播放本人的视频</span></span><br><span class="line"><span class="keyword">const</span> remoteVideo = ref&lt;<span class="title class_">HTMLVideoElement</span>&gt;() <span class="comment">// video标签实例，播放对方的视频</span></span><br><span class="line"><span class="keyword">const</span> localStream = ref&lt;<span class="title class_">MediaStream</span>&gt;() <span class="comment">// 本地流</span></span><br><span class="line"><span class="keyword">const</span> socket = ref&lt;<span class="title class_">Socket</span>&gt;() <span class="comment">// Socket实例</span></span><br><span class="line"><span class="keyword">const</span> peer = ref&lt;<span class="built_in">any</span>&gt;() <span class="comment">// RTCPeerConnection实例</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> sock = <span class="title function_">io</span>(<span class="string">&#x27;localhost:3001&#x27;</span>) <span class="comment">// 连接服务器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接成功</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 进入房间</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;joinRoom&#x27;</span>, roomId)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收方监听收到视频请求事件</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveCall&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!caller.<span class="property">value</span>) &#123;</span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">called.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送方收到同意视频事件</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;</span><br><span class="line"><span class="comment">// 发送方</span></span><br><span class="line"><span class="comment">// 创建RTCPeerConnection对象</span></span><br><span class="line">peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>()</span><br><span class="line"><span class="comment">// 添加本地音视频流</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="title function_">addStream</span>(localStream.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取candidate信息</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line"><span class="comment">// 向服务器发送candidate信息</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取对方的音视频流</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment">// 拿到对方的视频流</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成offer</span></span><br><span class="line"><span class="keyword">const</span> offer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createOffer</span>(&#123;</span><br><span class="line"><span class="attr">offerToReceiveAudio</span>: <span class="literal">true</span>, <span class="comment">// 是否接收对方的音频</span></span><br><span class="line"><span class="attr">offerToReceiveVideo</span>: <span class="literal">true</span>, <span class="comment">// 是否接收对方的视频</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 设置本地描述的offer</span></span><br><span class="line"><span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(offer)</span><br><span class="line"><span class="comment">// 发送offer</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, &#123; roomId, offer &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收方收到offer</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendOffer&#x27;</span>, <span class="title function_">async</span> (<span class="attr">offer</span>: <span class="built_in">any</span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (called.<span class="property">value</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> stream = <span class="keyword">await</span> <span class="title function_">getLocalStream</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收方创建自己的RTCPeerConnection对象</span></span><br><span class="line">peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加本地音视频流</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="title function_">addStream</span>(stream)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取candidate信息</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line"><span class="comment">// 向服务器发送candidate信息</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取对方的音视频流</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 拿到对方的视频流</span></span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置远端描述信息</span></span><br><span class="line"><span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setRemoteDescription</span>(offer)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成answer</span></span><br><span class="line"><span class="keyword">const</span> answer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createAnswer</span>()</span><br><span class="line"><span class="comment">// 设置本地描述信息</span></span><br><span class="line"><span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(answer)</span><br><span class="line"><span class="comment">// 发送answer</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendAnswer&#x27;</span>, &#123; roomId, answer &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送方收到接收方的answer</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveAnswer&#x27;</span>, <span class="function">(<span class="params"><span class="attr">answer</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;</span><br><span class="line"><span class="comment">// 设置远端描述信息</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="title function_">setRemoteDescription</span>(answer)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收candidate信息</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, <span class="title function_">async</span> (<span class="attr">candidate</span>: <span class="built_in">any</span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">addIceCandidate</span>(candidate) <span class="comment">// 添加candidate信息</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 收到挂断视频请求</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;hangUp&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">reset</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">socket.<span class="property">value</span> = sock</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取本地音视频流</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getLocalStream</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"><span class="comment">// 获取音视频流</span></span><br><span class="line"><span class="keyword">const</span> stream = <span class="keyword">await</span> navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123;</span><br><span class="line"><span class="attr">video</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">audio</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 将媒体流设置到 video 标签上播放</span></span><br><span class="line">localVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = stream</span><br><span class="line"><span class="comment">// 播放音视频流</span></span><br><span class="line">localVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line"><span class="comment">// 存储本地流</span></span><br><span class="line">localStream.<span class="property">value</span> = stream</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> stream</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发起视频请求（发起方）</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">callRemote</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (calling.<span class="property">value</span> || communicating.<span class="property">value</span>) &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment">// 获取本地音视频流</span></span><br><span class="line"><span class="keyword">await</span> <span class="title function_">getLocalStream</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向服务器发送发起视频请求的事件</span></span><br><span class="line">caller.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;callRemote&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收视频请求（接受方）</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">acceptCall</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"><span class="comment">// 向服务器发送接受视频请求的事件</span></span><br><span class="line">socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;acceptCall&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂断视频</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hangUp</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;hangUp&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 状态重置</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reset</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">called.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">caller.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">communicating.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">peer.<span class="property">value</span> = <span class="literal">null</span></span><br><span class="line">localVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = <span class="literal">null</span> <span class="comment">// 关闭本地视频</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = <span class="literal">null</span> <span class="comment">// 关闭远程视频</span></span><br><span class="line">localStream.<span class="property">value</span>?.<span class="title function_">getTracks</span>()[<span class="number">0</span>].<span class="title function_">stop</span>() <span class="comment">// 关闭本地流</span></span><br><span class="line"><span class="comment">// localStream.value = undefined // 关闭本地流</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>后端 (index.js)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = <span class="built_in">require</span>(<span class="string">&#x27;socket.io&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> io = <span class="title function_">socket</span>(server, &#123;</span><br><span class="line"><span class="attr">cors</span>: &#123;</span><br><span class="line"><span class="attr">origin</span>: <span class="string">&#x27;*&#x27;</span>, <span class="comment">// 配置跨域</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">io.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">sock</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接成功...&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向客户端发送连接成功的消息</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听客户端进入房间的事件</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;joinRoom&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 加入房间</span></span><br><span class="line">sock.<span class="title function_">join</span>(roomId)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 收到发送方的视频请求事件</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;callRemote&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 向这个房间中的人广播这个事件</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCall&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 收到接收方的同意视频事件</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 向这个房间中的人广播这个事件</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;acceptCall&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 收到发送方的offer</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendOffer&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, offer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 向接收方发送这个offer</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, offer)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 收到接收方的answer</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendAnswer&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, answer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 向这个房间中的人广播这个事件</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveAnswer&#x27;</span>, answer)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 收到发送方的candidate信息</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, candidate &#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 向这个房间中的人广播candidate信息</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, candidate)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 收到挂断视频请求</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;hangUp&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 向这个房间中的人广播这个事件</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;hangUp&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3001</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务器启动成功&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="项目启动方式"><a href="#项目启动方式" class="headerlink" title="项目启动方式"></a>项目启动方式</h2><p>后端启动服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm start</span><br></pre></td></tr></table></figure><p>前端</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pnpm install</span><br><span class="line">pnpm run dev</span><br></pre></td></tr></table></figure><h1 id="WebSocket-NestJS-升级项目-支持不同网络下视频通话"><a href="#WebSocket-NestJS-升级项目-支持不同网络下视频通话" class="headerlink" title="WebSocket+NestJS 升级项目 | 支持不同网络下视频通话"></a>WebSocket+NestJS 升级项目 | 支持不同网络下视频通话</h1><h2 id="项目架构重构"><a href="#项目架构重构" class="headerlink" title="项目架构重构"></a>项目架构重构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">├── webrtc-client/       # Vue 前端</span><br><span class="line">│   ├── src/</span><br><span class="line">│   │   ├── App.vue      # 主界面</span><br><span class="line">│   │   └── webrtc.ts    # WebRTC 核心逻辑(从App.vue分离出来)</span><br><span class="line">├── webrtc-server/       # NestJS 后端</span><br><span class="line">│   ├── src/</span><br><span class="line">│   │   ├── signaling/   # 信令服务器模块</span><br><span class="line">│   │   └── main.ts      # 入口文件</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术探索 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>TS + NodeJS实现axios</title>
      <link href="/2025/03/04/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0axios/"/>
      <url>/2025/03/04/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0axios/</url>
      
        <content type="html"><![CDATA[<h1 id="TS-NodeJS-实现-axios"><a href="#TS-NodeJS-实现-axios" class="headerlink" title="TS + NodeJS 实现 axios"></a>TS + NodeJS 实现 axios</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/alexjoverm/typescript-library-starter.git ts-axios</span><br></pre></td></tr></table></figure><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><blockquote><p>在浏览器端使用 XMLHttpRequest 对象通讯</p><p>Promise API</p><p>请求响应拦截器</p><p>请求数据和响应数据转换</p><p>请求的取消</p><p>JSON 数据的自动转换</p><p>客户端防止 XSRF</p></blockquote><p>框架工具</p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250129205459495.png" alt="image-20250129205459495" style="zoom:67%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250129205721267.png" alt="image-20250129205721267" style="zoom:67%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250129205345604.png" alt="image-20250129205345604" style="zoom:80%;" /><h3 id="请求代码"><a href="#请求代码" class="headerlink" title="请求代码"></a>请求代码</h3><p>axios 最基本的操作</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line"><span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line"><span class="attr">url</span>: <span class="string">&#x27;/simple/get&#x27;</span>,</span><br><span class="line"><span class="attr">params</span>: &#123;</span><br><span class="line"><span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>创建入口文件</p><p><code>index.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">axios</span>(<span class="params">config</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure><p><code>xhr.ts</code></p><blockquote><p><code>xhr</code> 函数用于发送 HTTP 请求的工具函数，基于 XMLHttpRequest API 实现，并提供了一个简单的接口来配置和发送请求。</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">xhr</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> &#123; data = <span class="literal">null</span>, url, method = <span class="string">&#x27;get&#x27;</span> &#125; = config <span class="comment">// 解构设置默认值</span></span><br><span class="line"><span class="keyword">const</span> request = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>() <span class="comment">// 实例化一个 XMLHttpRequest 对象 并赋值给 request 变量</span></span><br><span class="line">request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url, <span class="literal">true</span>) <span class="comment">// 调用 open 方法 并传入 method url true 三个参数 并将 method 转换为大写并赋值给 method,url. async:true</span></span><br><span class="line">request.<span class="title function_">send</span>(data) <span class="comment">// 调用 send 方法 并传入 data 参数 并赋值给 request 变量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250130164413743.png" alt="image-20250130164413743"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="webpack-配置"><a href="#webpack-配置" class="headerlink" title="webpack 配置"></a>webpack 配置</h2><blockquote><p>webpack.config.js</p><p>整体导出一个对象，包含 mode（开发模式），entry，output，module，resolve，plugins 几个关键属性</p></blockquote><h3 id="entry"><a href="#entry" class="headerlink" title="entry"></a><em>entry</em></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">entry</span>: fs.<span class="title function_">readdirSync</span>(__dirname).<span class="title function_">reduce</span>(<span class="function">(<span class="params">entries, dir</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fullDir = path.<span class="title function_">join</span>(__dirname, dir)</span><br><span class="line">    <span class="keyword">const</span> entry = path.<span class="title function_">join</span>(fullDir, <span class="string">&#x27;app.ts&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (fs.<span class="title function_">statSync</span>(fullDir).<span class="title function_">isDirectory</span>() &amp;&amp; fs.<span class="title function_">existsSync</span>(entry)) &#123;</span><br><span class="line">        entries[dir] = [<span class="string">&#x27;webpack-hot-middleware/client&#x27;</span>, entry]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> entries</span><br><span class="line">&#125;, &#123;&#125;),</span><br></pre></td></tr></table></figure><blockquote><p>entries 收集了多个目录的入口文件 (app.ts) ，并将每个入口引入一个用于热更新的文件</p><p>entries 是一个对象，key 为目录名</p></blockquote><h3 id="output"><a href="#output" class="headerlink" title="output"></a><em>output</em></h3><blockquote><p>将 entries 的 key 打包成 filename</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;__build__&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;/__build__/&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="module"><a href="#module" class="headerlink" title="module"></a><em>module</em></h3><blockquote><p>rules 定义一系列处理不同类型文件的规则</p><p>.ts :<code>tslint-loader</code> 进行预处理 (包括类型检查)</p><p>.tsx :<code>transpileOnly: true</code> 只进行编译而不进行类型检查</p><p>.css :<code>style-loader</code> 将 CSS 注入到 DOM 中，<code>css-loader</code> 处理 CSS 文件中的 <code>@import</code> 和 <code>url()</code></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">            <span class="attr">enforce</span>: <span class="string">&#x27;pre&#x27;</span>,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;tslint-loader&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;ts-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>: &#123;</span><br><span class="line">                        <span class="attr">transpileOnly</span>: <span class="literal">true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a><em>resolve</em></h3><blockquote><p>指定在导入模块时可以省略的文件扩展名，Webpack 会自动尝试这些扩展名。</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resolve</span>: &#123;</span><br><span class="line"><span class="attr">extensions</span>: [<span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a><em>plugins</em></h3><blockquote><p>热更新 | 发生错误不打包文件</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line"><span class="keyword">new</span> webpack.<span class="title class_">HotModuleReplacementPlugin</span>(),</span><br><span class="line"><span class="keyword">new</span> webpack.<span class="title class_">NoEmitOnErrorsPlugin</span>(),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h2><h3 id="处理-url-参数-params"><a href="#处理-url-参数-params" class="headerlink" title="处理 url 参数(params)"></a>处理 url 参数(params)</h3><blockquote><p>核心思想：把 params 的 key&amp;value <strong>解构拼接</strong>到 URL 上</p></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210214938544.png" alt="image-20250210214938544" style="zoom: 50%;" /><p><code>helpers/url.ts</code></p><h4 id="解构-URL-params"><a href="#解构-URL-params" class="headerlink" title="解构 URL -&gt; params"></a>解构 URL -&gt; params</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">bulidURL</span>(<span class="params"><span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">params</span>?: <span class="built_in">any</span></span>): <span class="built_in">string</span> &#123;<span class="comment">//解构</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>需处理逻辑</strong></p><p><em>没有参数</em></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215202014.png" alt="image-20250210215202014" style="zoom:50%;" /><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!params) &#123;</span><br><span class="line"><span class="comment">// 没有参数 直接返回 url</span></span><br><span class="line"><span class="keyword">return</span> url</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="解构-params-key-value"><a href="#解构-params-key-value" class="headerlink" title="解构 params -&gt; key&#x2F;value"></a>解构 params -&gt; key&#x2F;value</h4><p>params 是一个包含请求参数的对象</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例</span></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line"><span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line"><span class="attr">hobbies</span>: [<span class="string">&#x27;reading&#x27;</span>, <span class="string">&#x27;coding&#x27;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体代码</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">parts</span>: <span class="built_in">string</span>[] = [] <span class="comment">// 存放参数的数组</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(params).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123; <span class="comment">// key 依次取到 &#x27;name&#x27;, &#x27;age&#x27;, &#x27;hobbies&#x27; 等值</span></span><br><span class="line">    <span class="keyword">const</span> val = params[key] <span class="comment">// 对象key值所对应的value</span></span><br><span class="line">    ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><em>value 为 null 或 undefined</em></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (val === <span class="literal">null</span> || <span class="keyword">typeof</span> val === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>value</em> 为 <em>数组</em></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210214959177.png" alt="image-20250210214959177" style="zoom:50%;" /><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> values = [] <span class="comment">// 定义 values 变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(val)) &#123;</span><br><span class="line"><span class="comment">// 如果 value 为数组 直接赋值给 values</span></span><br><span class="line">values = val</span><br><span class="line">key += <span class="string">&#x27;[]&#x27;</span> <span class="comment">// 键名后面添加一个 []</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">values = [val] <span class="comment">// 赋值给 values</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>value</em> 为 <em>Data</em> | <em>字符串</em> | <em>对象</em></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215112025.png" alt="image-20250210215112025" style="zoom:50%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215135428.png" alt="image-20250210215135428" style="zoom:50%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215027145.png" alt="image-20250210215027145" style="zoom:50%;" /><p>helpers&#x2F;util.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isDate</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Date</span> &#123;</span><br><span class="line"><span class="keyword">return</span> toString.<span class="title function_">call</span>(val) === <span class="string">&#x27;[object Date]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isObject</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Object</span> &#123;</span><br><span class="line"><span class="keyword">return</span> val !== <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">&#x27;object&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再回来</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isDate, isObject &#125; <span class="keyword">from</span> <span class="string">&#x27;./util&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encode</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(val)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%40/g</span>, <span class="string">&#x27;@&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%3A/gi</span>, <span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%24/g</span>, <span class="string">&#x27;$&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%2C/gi</span>, <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%20/g</span>, <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%5B/gi</span>, <span class="string">&#x27;[&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%5D/gi</span>, <span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">values.<span class="title function_">forEach</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 遍历 values</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isDate</span>(val)) &#123;</span><br><span class="line"><span class="comment">// value 为日期</span></span><br><span class="line">val = val.<span class="title function_">toISOString</span>() <span class="comment">// 转换为 ISO 格式赋值给 val</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isObject</span>(val)) &#123;</span><br><span class="line"><span class="comment">// value 为对象</span></span><br><span class="line">val = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(val) <span class="comment">// 转换为字符串赋值给 val</span></span><br><span class="line">&#125;</span><br><span class="line">parts.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;encode(key)&#125;</span>=<span class="subst">$&#123;encode(val)&#125;</span>`</span>) <span class="comment">// 特殊字符转码赋值给 parts</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>拼装成 URL</p><blockquote><p>parts.join(‘&amp;’) 效果</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;[<span class="string">&#x27;name=John&#x27;</span>, <span class="string">&#x27;age=30&#x27;</span>, <span class="string">&#x27;hobbies[]=reading&#x27;</span>, <span class="string">&#x27;hobbies[]=coding&#x27;</span>]</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;name=John&amp;age=30&amp;hobbies[]=reading&amp;hobbies[]=coding&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215213939.png" alt="image-20250210215213939" style="zoom:50%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215227134.png" alt="image-20250210215227134" style="zoom:50%;" /><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> serializedParams = parts.<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>) <span class="comment">// 将 parts 数组中的所有元素连接成一个字符串，并使用 &amp; 作为分隔符</span></span><br><span class="line"><span class="keyword">if</span> (serializedParams) &#123;</span><br><span class="line"><span class="comment">// 如果 serializedParams 不为空 则拼接 url</span></span><br><span class="line"><span class="keyword">const</span> markIndex = url.<span class="title function_">indexOf</span>(<span class="string">&#x27;#&#x27;</span>) <span class="comment">// 查找 URL 中是否存在 # 符号 返回 # 符号在 URL 中的位置索引</span></span><br><span class="line"><span class="keyword">if</span> (markIndex !== -<span class="number">1</span>) &#123;</span><br><span class="line">url = url.<span class="title function_">slice</span>(<span class="number">0</span>, markIndex) <span class="comment">// 使用slice方法将URL截取到哈希部分之前，从而去除哈希部分</span></span><br><span class="line">&#125;</span><br><span class="line">url += (url.<span class="title function_">indexOf</span>(<span class="string">&#x27;?&#x27;</span>) === -<span class="number">1</span> ? <span class="string">&#x27;?&#x27;</span> : <span class="string">&#x27;&amp;&#x27;</span>) + serializedParams <span class="comment">// 确保URL中的查询参数?存在</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="处理-body-数据"><a href="#处理-body-数据" class="headerlink" title="处理 body 数据"></a>处理 body 数据</h3><p>helpers&#x2F;util.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isDate</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Date</span> &#123;</span><br><span class="line"><span class="comment">// 判断是否为日期</span></span><br><span class="line"><span class="keyword">return</span> toString.<span class="title function_">call</span>(val) === <span class="string">&#x27;[object Date]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// export function isObject(val: any): val is Object &#123;  // 判断是否为对象</span></span><br><span class="line"><span class="comment">//   return val !== null &amp;&amp; typeof val === &#x27;object&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isPlainObject</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Object</span> &#123;</span><br><span class="line"><span class="comment">// 判断是否为普通对象</span></span><br><span class="line"><span class="keyword">return</span> toString.<span class="title function_">call</span>(val) === <span class="string">&#x27;[object Object]&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>helpers&#x2F;data.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isPlainObject &#125; <span class="keyword">from</span> <span class="string">&#x27;./util&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">transformRequest</span>(<span class="params"><span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(data)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 处理 config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformURL</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line"><span class="comment">// 处理 url 返回拼接后的 url</span></span><br><span class="line"><span class="keyword">const</span> &#123; url, params &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">bulidURL</span>(url, params)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformRequestData</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 处理 data</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequest</span>(config.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="处理-header"><a href="#处理-header" class="headerlink" title="处理 header"></a>处理 header</h3><blockquote><p>headers 一般传递诸如认证信息、内容类型等元数据给服务器</p></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250212030911535.png" alt="image-20250212030911535" style="zoom:50%;" /><p>helpers&#x2F;header.ts</p><blockquote><p>处理 headers</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">processHeaders</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>, <span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// processHeaders 函数接收 headers 和 data 两个参数</span></span><br><span class="line"><span class="title function_">normalizeHeaderName</span>(headers, <span class="string">&#x27;Content-Type&#x27;</span>) <span class="comment">// 调用 normalizeHeaderName 函数将 headers 的 Content-Type 属性名规范化</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(data)) &#123;</span><br><span class="line"><span class="comment">// 如果 data 是一个普通对象</span></span><br><span class="line"><span class="keyword">if</span> (headers &amp;&amp; !headers[<span class="string">&#x27;Content-Type&#x27;</span>]) &#123;</span><br><span class="line"><span class="comment">// 如果 headers 不存在 Content-Type 属性</span></span><br><span class="line">headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json;charset=utf-8&#x27;</span> <span class="comment">// 设置 Content-Type 属性为 application/json;charset=utf-8</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>Content-Type</code> 是 HTTP 请求头的一部分，用于指示实体主体（即请求或响应的正文部分）的数据类型。它告诉接收方如何解析接收到的数据。例如，当发送 JSON 格式的数据时，通常会将 <code>Content-Type</code> 设置为 <code>application/json</code>，这样接收方就知道应该以 JSON 的形式来解析数据</p></blockquote><p>辅助函数</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeHeaderName</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>, <span class="attr">normalizedName</span>: <span class="built_in">string</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// normalizeHeaderName 函数接收 headers 和 normalizedName 两个参数</span></span><br><span class="line"><span class="keyword">if</span> (!headers) &#123;</span><br><span class="line"><span class="comment">// 如果 headers 不存在</span></span><br><span class="line"><span class="keyword">return</span> <span class="comment">// 直接返回</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 遍历 headers 的所有属性</span></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">name !== normalizedName &amp;&amp;</span><br><span class="line">name.<span class="title function_">toUpperCase</span>() === normalizedName.<span class="title function_">toUpperCase</span>()</span><br><span class="line">) &#123;</span><br><span class="line"><span class="comment">// 如果属性名不等于 normalizedName 并且属性名的大写形式等于 normalizedName 的大写形式</span></span><br><span class="line">headers[normalizedName] = headers[name] <span class="comment">// 将 headers 的属性名设置为 normalizedName (content-type -&gt; Content-Type)</span></span><br><span class="line"><span class="keyword">delete</span> headers[name] <span class="comment">// 删除 headers 的属性名</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> headers <span class="comment">// 返回 headers</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>types&#x2F;index.ts 加入 headers</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line"><span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.ts 增添处理逻辑</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 处理 config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// 先处理 headers</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// 再处理 data</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformHeaders</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// 处理 headers 调用 processHeaders 方法</span></span><br><span class="line"><span class="keyword">const</span> &#123; headers = &#123;&#125;, data &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">processHeaders</span>(headers, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>xhr.ts 添加 header 处理逻辑</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">xhr</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="keyword">const</span> &#123; data = <span class="literal">null</span>, url, method = <span class="string">&#x27;get&#x27;</span>, headers &#125; = config <span class="comment">// 添加header解构</span></span><br><span class="line"><span class="keyword">const</span> request = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>() <span class="comment">// 实例化一个 XMLHttpRequest 对象 并赋值给 request 变量</span></span><br><span class="line">request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 遍历 headers 的所有属性</span></span><br><span class="line"><span class="keyword">if</span> (data === <span class="literal">null</span> &amp;&amp; name.<span class="title function_">toLowerCase</span>() === <span class="string">&#x27;content-type&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// 如果 data 为 null 并且属性名为 content-type</span></span><br><span class="line"><span class="keyword">delete</span> headers[name] <span class="comment">// 删除 headers 的属性名</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">request.<span class="title function_">setRequestHeader</span>(name, headers[name]) <span class="comment">// 调用 setRequestHeader 方法 并传入 name headers[name] 两个参数 并赋值给 request 变量</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">request.<span class="title function_">send</span>(data) <span class="comment">// 调用 send 方法 并传入 data 参数 并赋值给 request 变量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><blockquote><p>这部分处理实现了</p><p>为 Content-Type 自动添加 application&#x2F;json;charset&#x3D;UTF-8（告知服务端解析的是 JSON 数据）</p></blockquote><h3 id="获取处理-response"><a href="#获取处理-response" class="headerlink" title="获取处理 response"></a>获取处理 response</h3><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="comment">//config接口</span></span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line"><span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">responseType</span>?: <span class="title class_">XMLHttpRequestResponseType</span> <span class="comment">//新增</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line"><span class="comment">//response接口</span></span><br><span class="line"><span class="attr">data</span>: <span class="built_in">any</span></span><br><span class="line"><span class="attr">status</span>: <span class="built_in">number</span></span><br><span class="line"><span class="attr">statusText</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">headers</span>: <span class="built_in">any</span></span><br><span class="line"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line"><span class="attr">request</span>: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosPromise</span> <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;<span class="title class_">AxiosResponse</span>&gt; &#123;</span><br><span class="line"><span class="comment">//promise接口</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>xhr.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">xhr</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// xhr 函数接收一个 config 参数</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> <span class="comment">// 返回一个 Promise 对象 并传入 resolve reject 两个参数</span></span><br><span class="line">    <span class="keyword">const</span> &#123; data = <span class="literal">null</span>, url, method = <span class="string">&#x27;get&#x27;</span>, headers, responseType &#125; = config <span class="comment">// 解构赋值拿到变量</span></span><br><span class="line">    <span class="keyword">const</span> request = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>() <span class="comment">// 实例化一个 XMLHttpRequest 对象 并赋值给 request 变量</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (responseType) &#123;</span><br><span class="line">      request.<span class="property">responseType</span> = responseType</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url, <span class="literal">true</span>) <span class="comment">// 调用 open 方法 并传入 method url true 三个参数 并将 method 转换为大写并赋值给 method,url. async:true异步</span></span><br><span class="line"></span><br><span class="line">    request.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> <span class="title function_">handleLoad</span>(<span class="params"></span>) &#123;<span class="comment">// 调用 onreadystatechange 方法 并传入 handleLoad 函数 并赋值给 request 变量</span></span><br><span class="line">      <span class="keyword">if</span> (request.<span class="property">readyState</span> !== <span class="number">4</span>) &#123;<span class="comment">// 4状态为正确接收到数据 (// 没有收到正确的响应)</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> responseHeaders = request.<span class="title function_">getAllResponseHeaders</span>() <span class="comment">// 调用 getAllResponseHeaders 方法 并赋值给 responseHeaders 变量（后面要处理这个字符串）</span></span><br><span class="line">      <span class="keyword">const</span> responseData = responseType &amp;&amp; responseType !== <span class="string">&#x27;text&#x27;</span> ? request.<span class="property">response</span> : request.<span class="property">responseText</span> <span class="comment">// 调用 responseText 方法 并赋值给 responseData 变量</span></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">response</span>: <span class="title class_">AxiosResponse</span> = &#123;</span><br><span class="line">        <span class="attr">data</span>: responseData,</span><br><span class="line">        <span class="attr">status</span>: request.<span class="property">status</span>,</span><br><span class="line">        <span class="attr">statusText</span>: request.<span class="property">statusText</span>,</span><br><span class="line">        <span class="attr">headers</span>: responseHeaders,</span><br><span class="line">        config,</span><br><span class="line">        request</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">resolve</span>(response) <span class="comment">// 调用 resolve 方法 并传入 response 参数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function"><span class="params">name</span> =&gt;</span> &#123;<span class="comment">// 遍历 headers 的所有属性</span></span><br><span class="line">      <span class="keyword">if</span> (data === <span class="literal">null</span> &amp;&amp; name.<span class="title function_">toLowerCase</span>() === <span class="string">&#x27;content-type&#x27;</span>) &#123;<span class="comment">// 如果 data 为 null 并且属性名为 content-type</span></span><br><span class="line">        <span class="keyword">delete</span> headers[name] <span class="comment">// 删除 headers 的属性名</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        request.<span class="title function_">setRequestHeader</span>(name, headers[name]) <span class="comment">// 调用 setRequestHeader 方法 并传入 name headers[name] 两个参数 并赋值给 request 变量</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    request.<span class="title function_">send</span>(data) <span class="comment">// 调用 send 方法 并传入 data 参数 并赋值给 request 变量</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">axios</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line"><span class="comment">// axios 函数接收一个 config 参数</span></span><br><span class="line"><span class="title function_">processConfig</span>(config)</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">xhr</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>getAllResponseHeaders</code>方法处理</p><p>XMLHttpRequest 对象的 getAllResponseHeaders 方法获取到的值是如下字符串</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">date<span class="punctuation">:</span>Fri<span class="punctuation">,</span><span class="number">05</span> Apr <span class="number">2019</span> <span class="number">12</span><span class="punctuation">:</span><span class="number">40</span><span class="punctuation">:</span><span class="number">49</span> GMT</span><br><span class="line">etag<span class="punctuation">:</span> W/<span class="string">&quot;d-Ssxx4FRxEutDLwo2+xkkxKc4y0k&#x27;&#x27;</span></span><br><span class="line"><span class="string">connection: keep-alive</span></span><br><span class="line"><span class="string">x-powered-by: Express</span></span><br><span class="line"><span class="string">content-length:13</span></span><br><span class="line"><span class="string">content-type:application/json;charset=utf-8</span></span><br></pre></td></tr></table></figure><blockquote><p>每一行都是以回车和换行符<code>\r\n</code>结束，是每个 header 属性的分隔符</p></blockquote><p>而我们希望解析成的对象结构</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    date<span class="punctuation">:</span>Fri<span class="punctuation">,</span><span class="number">05</span> Apr <span class="number">2019</span> <span class="number">12</span><span class="punctuation">:</span><span class="number">40</span><span class="punctuation">:</span><span class="number">49</span> GMT</span><br><span class="line">etag<span class="punctuation">:</span> W/<span class="string">&quot;d-Ssxx4FRxEutDLwo2+xkkxKc4y0k&#x27;&#x27;,</span></span><br><span class="line"><span class="string">connection: keep-alive,</span></span><br><span class="line"><span class="string">x-powered-by: Express,</span></span><br><span class="line"><span class="string">content-length:13</span></span><br><span class="line"><span class="string">content-type:application/json;charset=utf-8</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>headers.ts 新增 parseHeaders 方法</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">parseHeaders</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">string</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// parseHeaders 函数接收 headers 参数</span></span><br><span class="line"><span class="keyword">let</span> parsed = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>) <span class="comment">// 创建一个空对象</span></span><br><span class="line"><span class="keyword">if</span> (!headers) &#123;</span><br><span class="line"><span class="comment">// 如果 headers 不存在</span></span><br><span class="line"><span class="keyword">return</span> parsed <span class="comment">// 返回 parsed</span></span><br><span class="line">&#125;</span><br><span class="line">headers.<span class="title function_">split</span>(<span class="string">&#x27;\r\n&#x27;</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">line</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 遍历 headers 的每一行</span></span><br><span class="line"><span class="keyword">let</span> [key, val] = line.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>) <span class="comment">// 分割每一行的 key 和 val</span></span><br><span class="line">key = key.<span class="title function_">trim</span>().<span class="title function_">toLowerCase</span>() <span class="comment">// 去掉 key 的空格并将 key 转换为小写</span></span><br><span class="line"><span class="keyword">if</span> (!key) &#123;</span><br><span class="line"><span class="comment">// 如果 key 不存在</span></span><br><span class="line"><span class="keyword">return</span> <span class="comment">// 直接返回</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (val) &#123;</span><br><span class="line"><span class="comment">// 如果 val 存在</span></span><br><span class="line">val = val.<span class="title function_">trim</span>() <span class="comment">// 去掉 val 的空格</span></span><br><span class="line">&#125;</span><br><span class="line">parsed[key] = val <span class="comment">// 将 key 和 val 赋值给 parsed</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> parsed <span class="comment">// 返回 parsed</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="处理响应-data"><a href="#处理响应-data" class="headerlink" title="处理响应 data"></a>处理响应 data</h3><p>不设置 responseType 情况下，服务端返回数据是字符串类型</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data: &quot;&#123;&quot;a&quot;:1,&quot;b&quot;:2&#125;&quot;</span><br></pre></td></tr></table></figure><p>我们要转成对象</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data<span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    a<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    b<span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>data.ts 新增 transformResponse 转化函数</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">transformResponse</span>(<span class="params"><span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> data === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"><span class="comment">// do nothing</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.ts 处理 axios</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/data&#x27;</span> <span class="comment">// 新增引入转化函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">axios</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line"><span class="title function_">processConfig</span>(config)</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">xhr</span>(config).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//请求结束后对 response data 进行处理</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">transformResponseData</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformResponseData</span>(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>): <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line"><span class="comment">// 处理 response data</span></span><br><span class="line">res.<span class="property">data</span> = <span class="title function_">transformResponse</span>(res.<span class="property">data</span>)</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/// 基础核心功能至此已全部实现 ///</span><br></pre></td></tr></table></figure><h2 id="错误处理-reject-拒回"><a href="#错误处理-reject-拒回" class="headerlink" title="错误处理(reject 拒回)"></a>错误处理(reject 拒回)</h2><h3 id="处理网络错误"><a href="#处理网络错误" class="headerlink" title="处理网络错误"></a>处理网络错误</h3><p>网络不通时发送请求会触发 XMLHttpRequest 对象实例的 error 事件，所以我们可以在 onerror 事件回调函数中捕获此类错误</p><p>xhr.ts 中添加</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onerror</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// 调用 onerror 方法 并传入 handleError 函数 并赋值给 request 变量</span></span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Network Error&#x27;</span>)) <span class="comment">// 调用 reject 方法 并传入 Network Error 参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="处理超时错误"><a href="#处理超时错误" class="headerlink" title="处理超时错误"></a>处理超时错误</h3><p>设置一个 timeout，当请求超过某个时间后没收到响应则终止，并触发 timeout 事件</p><blockquote><p>默认超时时间为 0（永不超时，我们首先需要允许程序可配置超时时间</p></blockquote><p>type &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="comment">//config接口</span></span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line"><span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">responseType</span>?: <span class="title class_">XMLHttpRequestResponseType</span></span><br><span class="line"><span class="attr">timeout</span>?: <span class="built_in">number</span> <span class="comment">// 新增timeout</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>xhr.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">data = <span class="literal">null</span>,</span><br><span class="line">url,</span><br><span class="line">method = <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">headers,</span><br><span class="line">responseType,</span><br><span class="line">timeout,</span><br><span class="line">&#125; = config <span class="comment">// 新增解构</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增逻辑</span></span><br><span class="line"><span class="keyword">if</span> (timeout) &#123;</span><br><span class="line"><span class="comment">// 如果 timeout 存在</span></span><br><span class="line">request.<span class="property">timeout</span> = timeout</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request.<span class="property">ontimeout</span> = <span class="keyword">function</span> <span class="title function_">handleTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Timeout of <span class="subst">$&#123;timeout&#125;</span> ms exceeded`</span>)) <span class="comment">// 超过 $&#123;timeout&#125; 毫秒 超时</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="状态码处理-200-错误"><a href="#状态码处理-200-错误" class="headerlink" title="状态码处理(!200 错误)"></a>状态码处理(!200 错误)</h3><blockquote><p>处理时机：接收到响应的时候</p></blockquote><p>xhr.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> <span class="title function_">handleLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (request.<span class="property">readyState</span> !== <span class="number">4</span>) &#123;</span><br><span class="line"><span class="comment">// 没有收到正确的响应</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//也就是在这里//</span></span><br><span class="line"><span class="keyword">if</span> (request.<span class="property">status</span> === <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// 如果发送网络错误 || 超时错误</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">resolve</span>(response) <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 传入处理 response 参数</span></span><br><span class="line"><span class="keyword">if</span> (response.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; response.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line"><span class="comment">// 状态码 大于等于 200 并且小于 300</span></span><br><span class="line"><span class="title function_">resolve</span>(response) <span class="comment">// 调用 resolve 方法 并传入 response 参数</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Request failed with status code <span class="subst">$&#123;response.status&#125;</span>`</span>)) <span class="comment">// 报错状态码</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="错误信息增强"><a href="#错误信息增强" class="headerlink" title="错误信息增强"></a>错误信息增强</h3><blockquote><p>按照之前的操作，我们实现了对基础错误信息的处理，但我们对外提供的错误信息是十分有限的</p><p>我们希望对外提供的错误信息包括</p><p>错误文本信息（报错显示）</p><p>请求对象配置 config</p><p>错误代码 code</p><p>XMLHttpRequest 对象实例 request</p><p>自定义响应对象 response</p></blockquote><h4 id="创建-AxiosError-类"><a href="#创建-AxiosError-类" class="headerlink" title="创建 AxiosError 类"></a>创建 AxiosError 类</h4><p>types &#x2F; index.ts 定义接口</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosError</span> <span class="keyword">extends</span> <span class="title class_">Error</span> &#123;</span><br><span class="line"><span class="comment">//error接口</span></span><br><span class="line"><span class="attr">isAxiosError</span>: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line"><span class="attr">code</span>?: <span class="built_in">string</span></span><br><span class="line"><span class="attr">request</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>新建 helpers &#x2F; error.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AxiosError</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line"><span class="comment">// 定义一个AxiosError类继承Error类 实现AxiosError接口 并设置 isAxiosError为true</span></span><br><span class="line"><span class="attr">isAxiosError</span>: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line"><span class="attr">code</span>?: <span class="built_in">string</span> | <span class="literal">null</span></span><br><span class="line"><span class="attr">request</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params"><span class="comment">//构造函数 接收五个参数赋值给对应的属性 并设置 isAxiosError为true</span></span></span><br><span class="line"><span class="params"><span class="attr">message</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>,</span></span><br><span class="line"><span class="params"><span class="attr">code</span>?: <span class="built_in">string</span> | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params"><span class="attr">request</span>?: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params"><span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">super</span>(message) <span class="comment">//调用父类的构造函数 传入message参数赋值给message属性</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">config</span> = config</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">code</span> = code</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">request</span> = request</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">response</span> = response</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">isAxiosError</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="variable language_">this</span>, <span class="title class_">AxiosError</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// 修复原型链问题</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createError</span>(<span class="params"> <span class="comment">//定义一个createError函数 接收五个参数 并返回一个AxiosError对象</span></span></span><br><span class="line"><span class="params"><span class="attr">message</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>,</span></span><br><span class="line"><span class="params"><span class="attr">code</span>?: <span class="built_in">string</span> | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params"><span class="attr">request</span>?: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params"><span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> error = <span class="keyword">new</span> <span class="title class_">AxiosError</span>(message, config, code, request, response)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="createError-方法应用"><a href="#createError-方法应用" class="headerlink" title="createError 方法应用"></a>createError 方法应用</h4><blockquote><p>对错误对象创建的逻辑进行修改</p></blockquote><p>xhr.ts</p><p><strong><em>onerror 修改</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onerror</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Network Error&#x27;</span>)) <span class="comment">// 调用 reject 方法 并传入 Network Error 参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>替换为</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onerror</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="title function_">createError</span>(<span class="string">&#x27;Network Error&#x27;</span>, config, <span class="literal">null</span>, request)) <span class="comment">// 传入 &#x27;Network Error&#x27;,config,null,request 参数（事件触发时拿不到response就不传了） 调用 createError 方法并传入参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><em>ontimeout 修改</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">ontimeout</span> = <span class="keyword">function</span> <span class="title function_">handleTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// 调用 ontimeout 方法 并传入 handleTimeout 函数 并赋值给 request 变量</span></span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Timeout of <span class="subst">$&#123;timeout&#125;</span> ms exceeded`</span>)) <span class="comment">// 调用 reject 方法 并传入 Timeout of $&#123;timeout&#125; ms exceeded 参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>替换为</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">ontimeout</span> = <span class="keyword">function</span> <span class="title function_">handleTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// 调用 ontimeout 方法 并传入 handleTimeout 函数 并赋值给 request 变量</span></span><br><span class="line"><span class="title function_">reject</span>(</span><br><span class="line"><span class="title function_">createError</span>(</span><br><span class="line"><span class="string">`Timeout of <span class="subst">$&#123;timeout&#125;</span> ms exceeded`</span>,</span><br><span class="line">config,</span><br><span class="line"><span class="string">&#x27;ECONNABORTED&#x27;</span>,</span><br><span class="line">request</span><br><span class="line">)</span><br><span class="line">) <span class="comment">// 传入 `Timeout of $&#123;timeout&#125; ms exceeded`,config,&#x27;ECONNABORTED&#x27;,request 参数 调用 createError 方法 并传入参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><em>handleResponse 修改</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 传入处理 response 参数</span></span><br><span class="line"><span class="keyword">if</span> (response.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; response.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line"><span class="comment">// 状态码 大于等于 200 并且小于 300</span></span><br><span class="line"><span class="title function_">resolve</span>(response) <span class="comment">// 调用 resolve 方法 并传入 response 参数</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Request failed with status code <span class="subst">$&#123;response.status&#125;</span>`</span>)) <span class="comment">// 调用 reject 方法 并传入 Request failed with status code $&#123;response.status&#125; 参数</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>替换为</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 传入处理 response 参数</span></span><br><span class="line"><span class="keyword">if</span> (response.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; response.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line"><span class="comment">// 状态码 大于等于 200 并且小于 300</span></span><br><span class="line"><span class="title function_">resolve</span>(response) <span class="comment">// 调用 resolve 方法 并传入 response 参数</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">reject</span>(</span><br><span class="line"><span class="title function_">createError</span>(</span><br><span class="line"><span class="string">`Request failed with status code <span class="subst">$&#123;response.status&#125;</span>`</span>,</span><br><span class="line">config,</span><br><span class="line"><span class="literal">null</span>,</span><br><span class="line">request,</span><br><span class="line">response</span><br><span class="line">)</span><br><span class="line">) <span class="comment">// 传入 `Request failed with status code $&#123;response.status&#125;`,config,null,request,response 参数 调用 createError 方法 并传入参数</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="接口扩展"><a href="#接口扩展" class="headerlink" title="接口扩展"></a>接口扩展</h2><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><blockquote><p>为了用户更加方便地使用 axios 发送请求，我们可以为所有支持的请求方法扩展一些接口</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//[可选项]</span></span><br><span class="line">axios.<span class="property">request</span>(config)</span><br><span class="line">axios.<span class="property">get</span>(url[,config])</span><br><span class="line">axios.<span class="property">delete</span>(url[,config])</span><br><span class="line">axios.<span class="property">head</span>(url[,config])</span><br><span class="line">axios.<span class="property">options</span>(url[,config])</span><br><span class="line">axios.<span class="property">post</span>(url[,datal,config])</span><br><span class="line">axios.<span class="property">put</span>(url[,datal,config])</span><br><span class="line">axios.<span class="property">patch</span>(url[,datal,config])</span><br></pre></td></tr></table></figure><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line"><span class="comment">//axios接口</span></span><br><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">get</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">delete</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">head</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">options</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">post</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: <span class="built_in">any</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">put</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: <span class="built_in">any</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">patch</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: <span class="built_in">any</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInstance</span> <span class="keyword">extends</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line"><span class="comment">//axios实例接口 既有函数类型又有属性接口</span></span><br><span class="line">(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="创建-Axios-ts"><a href="#创建-Axios-ts" class="headerlink" title="创建 Axios.ts"></a>创建 Axios.ts</h3><blockquote><p>存放一些发送请求核心代码</p></blockquote><p>core &#x2F; Axios.ts &#x2F;&#x2F;大写表示是一个类</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line"><span class="comment">// 实现request方法</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>core &#x2F; dispatchRequest.ts</p><blockquote><p>封装 axios.ts 核心代码</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> xhr <span class="keyword">from</span> <span class="string">&#x27;../xhr&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; bulidURL &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/url&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; processHeaders &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/header&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">dispatchRequest</span>(<span class="params"></span></span><br><span class="line"><span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line"><span class="comment">// dispatchRequest 函数接收一个 config 参数</span></span><br><span class="line"><span class="title function_">processConfig</span>(config)</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">xhr</span>(config).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//请求结束后对 response data 进行处理</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">transformResponseData</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 处理 config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// 先处理 headers</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// 再处理 data</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformURL</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line"><span class="comment">// 处理 url 返回拼接后的 url</span></span><br><span class="line"><span class="keyword">const</span> &#123; url, params &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">bulidURL</span>(url, params)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformRequestData</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 处理 data 调用 transformRequest 方法</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequest</span>(config.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformHeaders</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// 处理 headers 调用 processHeaders 方法</span></span><br><span class="line"><span class="keyword">const</span> &#123; headers = &#123;&#125;, data &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">processHeaders</span>(headers, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformResponseData</span>(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>): <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line"><span class="comment">// 处理 response data</span></span><br><span class="line">res.<span class="property">data</span> = <span class="title function_">transformResponse</span>(res.<span class="property">data</span>)</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>然后将 xhr.ts 移入 core 文件夹（xhr 也作为核心模块）</p></blockquote><p><strong>部分报错修改</strong> (严格模式)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//dispatchRequest.ts</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">bulidURL</span>(url!, params)</span><br><span class="line"></span><br><span class="line"><span class="comment">//xht.ts</span></span><br><span class="line">request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url!, <span class="literal">true</span>) <span class="comment">// 调用 open 方法传入 method url true 三个参数 并将 method 转换为大写并赋值给 method,url. async:true异步</span></span><br></pre></td></tr></table></figure><blockquote><p>Tips： 断言（ ! ）</p><blockquote><p>TS 中，当你保证某个变量不会为 <code>null</code> 或者 <code>undefined</code>，但编译器却无法推断出来的时候，就可以使用非空断言操作符 ( ! )，不会在运行时进行检查，但要是你做出了错误的保证，在运行时就可能会出现错误。</p></blockquote></blockquote><h3 id="实现-Axios-类中接口"><a href="#实现-Axios-类中接口" class="headerlink" title="实现 Axios 类中接口"></a>实现 Axios 类中接口</h3><p><code>Axios.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> dispatchRequest <span class="keyword">from</span> <span class="string">&#x27;./dispatchRequest&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">  <span class="title function_">request</span>(...)</span><br><span class="line">  <span class="title function_">get</span>(...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现 <strong><em>request</em></strong> 接口</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入config参数 并返回AxiosPromise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong><em>逻辑封装</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">_requestMethodWithoutData</span>(</span><br><span class="line">    <span class="attr">method</span>: <span class="title class_">Method</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line">    <span class="comment">// 封装_requestMethodWithoutData方法传入method,url和config参数 并返回AxiosPromise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="title class_">Object</span>.<span class="title function_">assign</span>(config || &#123;&#125;, &#123; method, url &#125;)) <span class="comment">// 调用request方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>实现 <strong><em>get</em></strong> 接口</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">get</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;get&#x27;</span>, url, config) <span class="comment">// 调用方法 传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现 <strong><em>delete</em></strong> 接口</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">delete</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;delete&#x27;</span>, url, config) <span class="comment">// 调用方法 传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现 <strong><em>head</em></strong> 接口</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">head</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;head&#x27;</span>, url, config) <span class="comment">// 调用方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现 <strong><em>options</em></strong> 接口</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">options</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;options&#x27;</span>, url, config) <span class="comment">// 调用方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong><em>逻辑封装</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">_requestMethodWithData</span>(</span><br><span class="line">    <span class="attr">method</span>: <span class="title class_">Method</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">data</span>?: <span class="built_in">any</span>,</span><br><span class="line">    <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line">    <span class="comment">// 封装_requestMethodWithData方法传入method,url,data和config参数 并返回AxiosPromise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="title class_">Object</span>.<span class="title function_">assign</span>(config || &#123;&#125;, &#123; method, url, data &#125;)) <span class="comment">// 调用request方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>实现 <strong><em>post</em></strong> 接口</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">head</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url,data和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithData</span>(<span class="string">&#x27;post&#x27;</span>, url, data, config) <span class="comment">// 调用方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现 <strong><em>put</em></strong> 接口</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">put</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url,data和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithData</span>(<span class="string">&#x27;put&#x27;</span>, url, data, config) <span class="comment">// 调用方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现 <strong><em>patch</em></strong> 接口</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">patch</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 传入url,data和config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithData</span>(<span class="string">&#x27;patch&#x27;</span>, url, data, config) <span class="comment">// 调用方法 并传入一个对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="混合对象实现"><a href="#混合对象实现" class="headerlink" title="混合对象实现"></a>混合对象实现</h3><blockquote><p>首先这个对象是函数，其次这个对象包括 Axios 类内所有原型属性和实例属性</p></blockquote><p>helpers &#x2F; utils</p><blockquote><p><code>extend</code> 合成函数</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例</span></span><br><span class="line"><span class="keyword">const</span> target = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">const</span> source = &#123; <span class="attr">b</span>: <span class="number">2</span> &#125;</span><br><span class="line"><span class="keyword">const</span> result = <span class="title function_">extend</span>(target, source)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result) <span class="comment">// 输出: &#123; a: 1, b: 2 &#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>这里我们使用**<em>泛型</em>** <code>T</code> 和 <code>U</code></p><p><code>T</code> 代表目标对象 <code>to</code> 的类型，<code>U</code> 代表源对象 <code>from</code> 的类型</p><p>函数的返回值类型是 <code>T &amp; U</code>，也就是 <code>to</code> 和 <code>from</code> 两个对象类型的交集。</p></blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> extend&lt;T, U&gt;(<span class="attr">to</span>: T, <span class="attr">from</span>: U): T &amp; U &#123;</span><br><span class="line"><span class="comment">// 合并对象</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="keyword">from</span>) &#123;</span><br><span class="line">;(to <span class="keyword">as</span> T &amp; U)[key] = <span class="keyword">from</span>[key] <span class="keyword">as</span> <span class="built_in">any</span> <span class="comment">//把 from 对象的属性值赋值给 to 对象对应的属性。这里运用了类型断言 as T &amp; U 和 as any，让 TypeScript 编译器认可这种赋值操作。</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> to <span class="keyword">as</span> T &amp; U <span class="comment">//也用了类型断言 as T &amp; U</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="工厂函数实现"><a href="#工厂函数实现" class="headerlink" title="工厂函数实现"></a>工厂函数实现</h3><p>处理 axios.ts</p><blockquote><p>删掉内容，只保留 export default axios</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosInstance</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Axios</span> <span class="keyword">from</span> <span class="string">&#x27;./core/Axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/util&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"></span>): <span class="title class_">AxiosInstance</span> &#123;</span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> <span class="title class_">Axios</span>() <span class="comment">//实例化一个 Axios 对象 并赋值给 context 变量</span></span><br><span class="line"><span class="keyword">const</span> instance = <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span>.<span class="title function_">bind</span>(context) <span class="comment">//调用 request 方法 并传入 context 参数 并赋值给 instance 变量 绑定 this 指向 context</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">extend</span>(instance, context) <span class="comment">//调用 extend 方法 并传入 instance 和 context 参数 实现 instance 对象继承 context 对象</span></span><br><span class="line"><span class="keyword">return</span> instance <span class="keyword">as</span> <span class="title class_">AxiosInstance</span> <span class="comment">//返回 instance 对象 并断言为 AxiosInstance 类型</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="title function_">createInstance</span>() <span class="comment">//调用 createInstance 方法 并赋值给 axios 变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure><h3 id="axios-函数重载"><a href="#axios-函数重载" class="headerlink" title="axios 函数重载"></a>axios 函数重载</h3><blockquote><p>目前我们函数只能存放一个对象</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">url: &#x27;/extend/post&#x27;,</span><br><span class="line">method: &#x27;post&#x27;,</span><br><span class="line">data:&#123;</span><br><span class="line">msg:&#x27;hi&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>那么如果 axios 同时含有两个参数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">axios(&#x27;/extend/post&#x27;,&#123;</span><br><span class="line">method: &#x27;post&#x27;,</span><br><span class="line">data:&#123;</span><br><span class="line">msg:&#x27;hi&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></blockquote><p>type &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInstance</span> <span class="keyword">extends</span> <span class="title class_">Axios</span> &#123;<span class="comment">//axios实例接口 既有函数类型又有属性接口</span></span><br><span class="line">  (<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromis</span>) <span class="comment">//(config单参)</span></span><br><span class="line">  (<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> <span class="comment">//添加：函数重载(url+config双参)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>core &#x2F; Axios.ts</p><blockquote><p>修改 request 方法</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 实现request方法传入config参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>改为 👇</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">url</span>: <span class="built_in">any</span>, <span class="attr">config</span>: <span class="built_in">any</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 实现request方法传入url？config？参数</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">&#x27;string&#x27;</span>) &#123; <span class="comment">//url+config双参</span></span><br><span class="line">        <span class="keyword">if</span> (!config) &#123;</span><br><span class="line">            config = &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        config.<span class="property">url</span> = url</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//config单参</span></span><br><span class="line">        config = url <span class="comment">//此时的url就是config</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="响应数据支持泛型"><a href="#响应数据支持泛型" class="headerlink" title="响应数据支持泛型"></a>响应数据支持泛型</h3><blockquote><p>通常情况，我们会将后端返回数据格式单独放入一个接口中</p></blockquote><p>设置泛型，提高类型灵活性</p><p>type &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosResponse</span>&lt;T = <span class="built_in">any</span>&gt; &#123; <span class="comment">//response接口</span></span><br><span class="line">    <span class="attr">data</span>: T</span><br><span class="line">    <span class="attr">status</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">statusText</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">headers</span>: <span class="built_in">any</span></span><br><span class="line">    <span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">    <span class="attr">request</span>: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosPromise</span>&lt;T = <span class="built_in">any</span>&gt; <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;<span class="title class_">AxiosResponse</span>&lt;T&gt;&gt; &#123; <span class="comment">//promise接口</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Axios</span> &#123; <span class="comment">//axios接口</span></span><br><span class="line">    request&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt;</span><br><span class="line">    get&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInstance</span> <span class="keyword">extends</span> <span class="title class_">Axios</span> &#123; <span class="comment">//axios实例接口 既有函数类型又有属性接口</span></span><br><span class="line">&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt;</span><br><span class="line">&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt; <span class="comment">//函数重载</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="拦截器实现"><a href="#拦截器实现" class="headerlink" title="拦截器实现"></a>拦截器实现</h2><blockquote><p>也就是 axios 二次封装中常见的请求拦截器 &amp; 响应拦截器</p><p>我们先回顾一下用户 asios 拦截器是怎么写的</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>:<span class="string">&#x27;/api</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">instance.interceptors.request.use(res =&gt;&#123;//请求拦截器</span></span><br><span class="line"><span class="string">    console.log(&#x27;</span>res<span class="string">&#x27;,res)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">instance.interceptors.response.use(res =&gt;&#123;//响应拦截器</span></span><br><span class="line"><span class="string">    console.log(&#x27;</span>res<span class="string">&#x27;,res)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default instance</span></span><br></pre></td></tr></table></figure><p>Tip：request 是后添加的先执行，response 是先添加的先执行</p></blockquote><h3 id="拦截器管理类"><a href="#拦截器管理类" class="headerlink" title="拦截器管理类"></a>拦截器管理类</h3><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInterceptorManager</span>&lt;T&gt; &#123;</span><br><span class="line"><span class="comment">//拦截器接口</span></span><br><span class="line"><span class="title function_">use</span>(<span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt;, <span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span>): <span class="built_in">number</span> <span class="comment">//添加拦截器 返回拦截器id</span></span><br><span class="line"><span class="title function_">eject</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">void</span> <span class="comment">//删除拦截器 返回拦截器id</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ResolvedFn</span>&lt;T = <span class="built_in">any</span>&gt; &#123;</span><br><span class="line"><span class="comment">//成功拦截器接口</span></span><br><span class="line">(<span class="attr">val</span>: T): T | <span class="title class_">Promise</span>&lt;T&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">RejectedFn</span> &#123;</span><br><span class="line"><span class="comment">//失败拦截器接口</span></span><br><span class="line">(<span class="attr">error</span>: <span class="built_in">any</span>): <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>core &#x2F; interceptorManager.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ResolvedFn</span>, <span class="title class_">RejectedFn</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Interceptor</span>&lt;T&gt; &#123;</span><br><span class="line"><span class="comment">// 拦截器接口</span></span><br><span class="line"><span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt;</span><br><span class="line"><span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">InterceptorManager</span>&lt;T&gt; &#123;</span><br><span class="line"><span class="comment">// 拦截器管理类</span></span><br><span class="line"><span class="keyword">private</span> <span class="attr">interceptors</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Interceptor</span>&lt;T&gt;&gt; <span class="comment">// 拦截器数组存放的是拦截器对象 每个对象有两个属性 resolved rejected</span></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// 构造函数 初始化拦截器数组</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">interceptors</span> = [] <span class="comment">// 拦截器数组中存放的是拦截器对象</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">use</span>(<span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt;, <span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span>): <span class="built_in">number</span> &#123;</span><br><span class="line"><span class="comment">// 添加拦截器</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line"><span class="comment">// 将拦截器对象添加到拦截器数组中</span></span><br><span class="line">resolved,</span><br><span class="line">rejected,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">length</span> - <span class="number">1</span> <span class="comment">// 返回拦截器的id 用于删除拦截器</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">forEach</span>(<span class="attr">fn</span>: <span class="function">(<span class="params"><span class="attr">interceptor</span>: <span class="title class_">Interceptor</span>&lt;T&gt;</span>) =&gt;</span> <span class="built_in">void</span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 遍历拦截器</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">interceptor</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 遍历拦截器数组</span></span><br><span class="line"><span class="keyword">if</span> (interceptor !== <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">// 判断拦截器是否存在</span></span><br><span class="line"><span class="title function_">fn</span>(interceptor) <span class="comment">// 存在则调用fn函数</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">eject</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 删除拦截器 通过id删除拦截器</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">interceptors</span>[id]) &#123;</span><br><span class="line"><span class="comment">// 判断拦截器是否存在</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">interceptors</span>[id] = <span class="literal">null</span> <span class="comment">// 存在则将拦截器置为null</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="链式调用实现"><a href="#链式调用实现" class="headerlink" title="链式调用实现"></a>链式调用实现</h3><p>core &#x2F; Axios.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>,<span class="title class_">AxiosResponse</span>, <span class="title class_">Method</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">InterceptorManager</span> <span class="keyword">from</span> <span class="string">&#x27;./interceptorManager&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Interceptors</span> &#123;</span><br><span class="line">    <span class="attr">request</span>: <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;</span><br><span class="line">    <span class="attr">response</span>: <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">    <span class="attr">interceptors</span>: <span class="title class_">Interceptors</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">interceptors</span> = &#123; <span class="comment">//用户可以通过axios.interceptors.request.use()添加拦截器</span></span><br><span class="line">            <span class="attr">request</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;(),</span><br><span class="line">            <span class="attr">response</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">request</span>(...)...</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完善 request (实现调用链)</p><blockquote><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250218152615640.png" alt="image-20250218152615640"></p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>, <span class="title class_">AxiosResponse</span>, <span class="title class_">Method</span>,<span class="title class_">ResolvedFn</span>,<span class="title class_">RejectedFn</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PromiseChain</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt; | (<span class="function">(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>) =&gt;</span> <span class="title class_">AxiosPromise</span>)<span class="comment">//resolved是一个函数类型 接收一个AxiosRequestConfig类型的参数 返回一个AxiosPromise类型的参数</span></span><br><span class="line">    <span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span> <span class="comment">//rejected是一个函数类型 接收一个AxiosRequestConfig类型的参数 返回一个AxiosPromise类型的参数</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="title function_">request</span>(<span class="attr">url</span>: <span class="built_in">any</span>, <span class="attr">config</span>: <span class="built_in">any</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// 实现request方法传入参数</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!config) &#123;</span><br><span class="line">            config = &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        config.<span class="property">url</span> = url</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        config = url</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">chain</span>:<span class="title class_">PromiseChain</span>&lt;<span class="built_in">any</span>&gt;[] = [</span><br><span class="line">        &#123;<span class="comment">// 创建一个数组chain</span></span><br><span class="line">            <span class="attr">resolved</span>: dispatchRequest,</span><br><span class="line">            <span class="attr">rejected</span>: <span class="literal">undefined</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">interceptor</span> =&gt;</span> &#123;<span class="comment">// 遍历request拦截器</span></span><br><span class="line">        chain.<span class="title function_">unshift</span>(interceptor) <span class="comment">// 将拦截器添加到chain数组的开头</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">interceptor</span> =&gt;</span> &#123;<span class="comment">// 遍历response拦截器</span></span><br><span class="line">        chain.<span class="title function_">push</span>(interceptor) <span class="comment">// 将拦截器添加到chain数组的末尾</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(config) <span class="comment">// 创建一个promise对象 并传入config参数</span></span><br><span class="line">    <span class="keyword">while</span> (chain.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 遍历chain数组</span></span><br><span class="line">        <span class="keyword">const</span> &#123; resolved, rejected &#125; = chain.<span class="title function_">shift</span>()! <span class="comment">// 取出chain数组的第一个元素</span></span><br><span class="line">              promise = promise.<span class="title function_">then</span>(resolved, rejected) <span class="comment">// 将promise对象的then方法传入resolved和rejected参数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="合并用户配置"><a href="#合并用户配置" class="headerlink" title="合并用户配置"></a>合并用户配置</h2><blockquote><p>用户在发送请求时可以传入一个配置来决定请求的不同行为</p><p>甚至可以直接修改一些默认配置 (defaults)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">axios.<span class="property">defaults</span>.<span class="property">headers</span>.<span class="property">common</span>[<span class="string">&#x27;test&#x27;</span>] = <span class="number">123</span> <span class="comment">//默认对任何类型的请求的header都添加test属性</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">headers</span>.<span class="property">post</span>[<span class="string">&#x27;Content-Type&#x27;</span>] =</span><br><span class="line"><span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span> <span class="comment">//默认对post请求的header都添加Content-Type属性</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">timeout</span> = <span class="number">2000</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="默认配置设置"><a href="#默认配置设置" class="headerlink" title="默认配置设置"></a>默认配置设置</h3><p>defaults.ts 配置默认请求</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span> = &#123;</span><br><span class="line"><span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"><span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line"><span class="attr">timeout</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="attr">common</span>: &#123;</span><br><span class="line"><span class="title class_">Accept</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>, <span class="comment">//通用的请求头 接受的响应类型为json/plain文本*/*表示任意类型 优先级最低</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> methodsNoData = [<span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;head&#x27;</span>, <span class="string">&#x27;options&#x27;</span>]</span><br><span class="line"></span><br><span class="line">methodsNoData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">method</span>) =&gt;</span> &#123;</span><br><span class="line">defaults.<span class="property">headers</span>[method] = &#123;&#125; <span class="comment">//没有数据的请求头 优先级高于通用的请求头</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> methodsWithData = [<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;put&#x27;</span>, <span class="string">&#x27;patch&#x27;</span>]</span><br><span class="line"></span><br><span class="line">methodsWithData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">method</span>) =&gt;</span> &#123;</span><br><span class="line">defaults.<span class="property">headers</span>[method] = &#123;</span><br><span class="line"><span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>, <span class="comment">//表单提交的请求头 优先级高于通用的请求头</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defaults</span><br></pre></td></tr></table></figure><p>core &#x2F; Axios.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">    <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">    <span class="attr">interceptors</span>: <span class="title class_">Interceptors</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">initConfig</span>?: <span class="title class_">AxiosRequestConfig</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">defaults</span> = initConfig <span class="comment">// 初始化defaults属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">interceptors</span> = &#123;</span><br><span class="line">            <span class="comment">//用户可以通过axios.interceptors.request.use()添加拦截器</span></span><br><span class="line">            <span class="attr">request</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;(),</span><br><span class="line">            <span class="attr">response</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">    <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span> <span class="comment">//默认配置</span></span><br><span class="line">    <span class="attr">interceptors</span>: &#123; <span class="comment">//拦截器</span></span><br><span class="line">        <span class="attr">request</span>: <span class="title class_">AxiosInterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;</span><br><span class="line">        <span class="attr">response</span>: <span class="title class_">AxiosInterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重写 axios.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosInstance</span>, <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Axios</span> <span class="keyword">from</span> <span class="string">&#x27;./core/Axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/util&#x27;</span></span><br><span class="line"><span class="keyword">import</span> defaults <span class="keyword">from</span> <span class="string">&#x27;./defaults&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosInstance</span> &#123;</span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> <span class="title class_">Axios</span>(config) <span class="comment">//创建一个 Axios 实例 并传入 config 参数 并赋值给 context 变量</span></span><br><span class="line"><span class="keyword">const</span> instance = <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span>.<span class="title function_">bind</span>(context) <span class="comment">//调用 request 方法 并传入 context 参数 并赋值给 instance 变量 绑定 this 指向 context</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">extend</span>(instance, context) <span class="comment">//调用 extend 方法 并传入 instance 和 context 参数 实现 instance 对象继承 context 对象</span></span><br><span class="line"><span class="keyword">return</span> instance <span class="keyword">as</span> <span class="title class_">AxiosInstance</span> <span class="comment">//返回 instance 对象 并断言为 AxiosInstance 类型</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="title function_">createInstance</span>(defaults) <span class="comment">//调用 createInstance 方法 并传入 defaults 参数 并赋值给 axios 变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure><h3 id="合并策略实现"><a href="#合并策略实现" class="headerlink" title="合并策略实现"></a>合并策略实现</h3><p>创建 core &#x2F; mergeConfig.ts</p><blockquote><p><code>config1</code> 为默认配置</p><p><code>config2</code> 代表用户传入的自定义配置</p><blockquote><p>实现示例 (假设 <code>config1</code> 和 <code>config2</code> 如下：)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config1 = &#123;</span><br><span class="line"><span class="attr">timeout</span>: <span class="number">1000</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config2 = &#123;</span><br><span class="line"><span class="attr">timeout</span>: <span class="number">2000</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="title class_">Authorization</span>: <span class="string">&#x27;Bearer token&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>合并 <code>timeout</code> 属性时，<code>val1</code> 就是 <code>config1.timeout</code> 的值 <code>1000</code>，<code>val2</code> 就是 <code>config2.timeout</code> 的值 <code>2000</code>。</p></blockquote></blockquote><h4 id="timeout-逻辑"><a href="#timeout-逻辑" class="headerlink" title="timeout 逻辑"></a>timeout 逻辑</h4><p>mergeConfig.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> strats = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>) <span class="comment">//合并策略 key为属性名 value为合并策略函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defaultStrat</span>(<span class="params"><span class="attr">val1</span>: <span class="built_in">any</span>, <span class="attr">val2</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">//默认合并策略</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">typeof</span> val2 !== <span class="string">&#x27;undefined&#x27;</span> ? val2 : val1 <span class="comment">//优先取val2 如果val2不存在则取val1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fromVal2Strat</span>(<span class="params"><span class="attr">val1</span>: <span class="built_in">any</span>, <span class="attr">val2</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> val2 !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">//忽略val1 只取val2</span></span><br><span class="line"><span class="keyword">return</span> val2</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stratKeysFromVal2 = [<span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;params&#x27;</span>, <span class="string">&#x27;data&#x27;</span>]</span><br><span class="line"></span><br><span class="line">stratKeysFromVal2.<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//对于url params data属性 只取val2</span></span><br><span class="line">strats[key] = fromVal2Strat</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">mergeConfig</span>(<span class="params"></span></span><br><span class="line"><span class="params"><span class="attr">config1</span>: <span class="title class_">AxiosRequestConfig</span>,</span></span><br><span class="line"><span class="params"><span class="attr">config2</span>?: <span class="title class_">AxiosRequestConfig</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!config2) &#123;</span><br><span class="line">config2 = &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> config = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>) <span class="comment">//合并后的配置结果</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> config2) &#123;</span><br><span class="line"><span class="title function_">mergeField</span>(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> config1) &#123;</span><br><span class="line"><span class="keyword">if</span> (!config2[key]) &#123;</span><br><span class="line"><span class="title function_">mergeField</span>(key)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mergeField</span>(<span class="params"><span class="attr">key</span>: <span class="built_in">string</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="keyword">const</span> strat = strats[key] || defaultStrat <span class="comment">//合并策略</span></span><br><span class="line">config[key] = <span class="title function_">strat</span>(config1[key], config2![key])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>types &#x2F; index.ts 添加自动索引</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    [<span class="attr">propName</span>: <span class="built_in">string</span>]: <span class="built_in">any</span> <span class="comment">//字符串自动索引</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="headers-逻辑"><a href="#headers-逻辑" class="headerlink" title="headers 逻辑"></a>headers 逻辑</h4><h5 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepMergeStrat</span>(<span class="params"><span class="attr">val1</span>: <span class="built_in">any</span>, <span class="attr">val2</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(val2)) &#123;</span><br><span class="line"><span class="comment">//如果val2是对象</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">deepMerge</span>(val1, val2) <span class="comment">//递归合并</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> val2 !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">//如果val2不是对象 且val2存在</span></span><br><span class="line"><span class="keyword">return</span> val2</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(val1)) &#123;</span><br><span class="line"><span class="comment">//如果val2不是对象 且val2不存在 且val1是对象</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">deepMerge</span>(val1) <span class="comment">//递归合并</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> val1 !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">//如果val2不是对象 且val2不存在 且val1不是对象 且val1存在</span></span><br><span class="line"><span class="keyword">return</span> val1</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>deepMerge 工具函数实现</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deepMerge</span>(<span class="params">...<span class="attr">objs</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// 深度合并对象</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">objs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (obj) &#123;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> val = obj[key]</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(val)) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(result[key])) &#123;</span><br><span class="line">result[key] = <span class="title function_">deepMerge</span>(result[key], val)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">result[key] = <span class="title function_">deepMerge</span>(val)</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">result[key] = val</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在请求中应用函数</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">url</span>: <span class="built_in">any</span>, <span class="attr">config</span>: <span class="built_in">any</span>): <span class="title class_">AxiosPromise</span> &#123; <span class="comment">// 实现request方法传入参数</span></span><br><span class="line">    。。。</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!config) &#123;</span><br><span class="line">            config = &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        config.<span class="property">url</span> = url</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        config = url</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送请求之前应用</span></span><br><span class="line">    config = <span class="variable language_">this</span>.<span class="title function_">mergeConfig</span>(<span class="variable language_">this</span>.<span class="property">defaults</span>,config) <span class="comment">// 合并config</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">chain</span>:<span class="title class_">PromiseChain</span>&lt;<span class="built_in">any</span>&gt;[] = [</span><br><span class="line">        &#123;<span class="comment">// 创建一个数组chain</span></span><br><span class="line">            <span class="attr">resolved</span>: dispatchRequest,</span><br><span class="line">            <span class="attr">rejected</span>: <span class="literal">undefined</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    。。。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h5><blockquote><p>合并后的 headers 是一个复杂对象，多了 common、post、get 等属性</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">headers:&#123;</span><br><span class="line">    common:&#123;</span><br><span class="line">    Accept:&#x27;application/json,text/plain,*/*&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    post: &#123;</span><br><span class="line">    &#x27;Content-Type&#x27;:&#x27;application/x-www-form-urlencoded&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们需要压缩成一级</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">headers:&#123;</span><br><span class="line">Accept:&#x27;application/json,text/plain,*/*&#x27;,</span><br><span class="line">&#x27;Content-Type&#x27;:&#x27;application/x-www-form-urlencoded&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Tip：对于 comman 中定义的 header 字段，我们都要提取，而对于 post、get 这类提取，需要和该次请求的方法对应。</p></blockquote><p>headers.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">flattenHeaders</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>, <span class="attr">method</span>: <span class="title class_">Method</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// flattenHeaders 函数接收 headers 和 method 参数 将 headers 中的属性名规范化 并删除不必要的属性 并返回一个新的 headers 对象</span></span><br><span class="line"><span class="keyword">if</span> (!headers) &#123;</span><br><span class="line"><span class="comment">// 如果 headers 不存在</span></span><br><span class="line"><span class="keyword">return</span> headers <span class="comment">// 返回 headers</span></span><br><span class="line">&#125;</span><br><span class="line">headers = <span class="title function_">deepMerge</span>(headers, <span class="literal">null</span>) <span class="comment">// 调用 deepMerge 函数将 headers 深度合并</span></span><br><span class="line"><span class="keyword">const</span> methodsToDelete = [</span><br><span class="line"><span class="comment">// 定义一个数组 methodsToDelete 存储需要删除的 headers 属性名</span></span><br><span class="line"><span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;get&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;head&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;options&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;post&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;put&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;patch&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;common&#x27;</span>,</span><br><span class="line">]</span><br><span class="line">methodsToDelete.<span class="title function_">forEach</span>(<span class="function">(<span class="params">method</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 遍历 methodsToDelete 数组</span></span><br><span class="line"><span class="keyword">delete</span> headers[method] <span class="comment">// 删除 headers 的属性名</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> headers <span class="comment">// 返回 headers</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>dispatchRequest.ts 应用函数</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 处理 config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// 先处理 headers</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// 再处理 data</span></span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">flattenHeaders</span>(config.<span class="property">headers</span>, config.<span class="property">method</span>!) <span class="comment">//处理 headers 扁平化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="更多配置"><a href="#更多配置" class="headerlink" title="更多配置"></a>更多配置</h3><h4 id="transfromRequest-transfromResponse"><a href="#transfromRequest-transfromResponse" class="headerlink" title="transfromRequest &amp; transfromResponse"></a>transfromRequest &amp; transfromResponse</h4><blockquote><p>官方 axios 中提供<code>transfromRequest</code>&amp;<code>transfromResponse</code>，值为**<em>一个数组或一个函数</em>**</p><p>这两个属性允许用户在 <strong>数据发送到服务器之前</strong>(只适用于 put、post、patch，而且可以修改 headers 对象) &#x2F; <strong>把响应数据传递给 then 或 catch 之前</strong> 对其修改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">    transformRequest: [</span><br><span class="line">        (function(data) &#123;</span><br><span class="line">            return qs.stringify(data); // 自定义的 transformRequest</span><br><span class="line">        &#125;),</span><br><span class="line">        ...axios.defaults.transformRequest // 保留默认的 transformRequest</span><br><span class="line">    ],</span><br><span class="line">    transformResponse: [</span><br><span class="line">        ...axios.defaults.transformResponse, // 展开默认的 transformResponse</span><br><span class="line">        function(data) &#123;</span><br><span class="line">            if (typeof data === &#x27;object&#x27;) &#123; // 自定义的 transformResponse</span><br><span class="line">                data.b = 2; // 修改响应数据</span><br><span class="line">            &#125;</span><br><span class="line">            return data;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    url: &#x27;/config/post&#x27;, // 请求的 URL</span><br><span class="line">    method: &#x27;post&#x27;, // 请求方法</span><br><span class="line">    data: &#123;</span><br><span class="line">        a: 1 // 请求的数据</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote><h5 id="定义接口"><a href="#定义接口" class="headerlink" title="定义接口"></a>定义接口</h5><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="comment">//config接口</span></span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line"><span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">responseType</span>?: <span class="title class_">XMLHttpRequestResponseType</span></span><br><span class="line"><span class="attr">timeout</span>?: <span class="built_in">number</span></span><br><span class="line"><span class="attr">transformRequest</span>?: <span class="title class_">AxiosTransformer</span> | <span class="title class_">AxiosTransformer</span>[] <span class="comment">//请求数据转换函数</span></span><br><span class="line"><span class="attr">transformResponse</span>?: <span class="title class_">AxiosTransformer</span> | <span class="title class_">AxiosTransformer</span>[] <span class="comment">//响应数据转换函数</span></span><br><span class="line"></span><br><span class="line">[<span class="attr">propName</span>: <span class="built_in">string</span>]: <span class="built_in">any</span> <span class="comment">//字符串自动索引</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosTransformer</span> &#123;</span><br><span class="line"><span class="comment">//转换接口</span></span><br><span class="line">(<span class="attr">data</span>: <span class="built_in">any</span>, <span class="attr">headers</span>?: <span class="built_in">any</span>): <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>defaults.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; processHeaders &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/header&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span> = &#123;</span><br><span class="line"><span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"><span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line"><span class="attr">timeout</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="attr">common</span>: &#123;</span><br><span class="line"><span class="title class_">Accept</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>, <span class="comment">//通用的请求头 接受的响应类型为json/plain文本*/*表示任意类型 优先级最低</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="attr">transformRequest</span>: [</span><br><span class="line"><span class="keyword">function</span> (<span class="params"><span class="attr">data</span>: <span class="built_in">any</span>, <span class="attr">headers</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="title function_">processHeaders</span>(headers, data) <span class="comment">//处理请求头</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">transformRequest</span>(data) <span class="comment">//处理请求数据</span></span><br><span class="line">&#125;,</span><br><span class="line">],</span><br><span class="line"><span class="attr">transformResponse</span>: [</span><br><span class="line"><span class="keyword">function</span> (<span class="params"><span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">transformResponse</span>(data) <span class="comment">//处理响应数据</span></span><br><span class="line">&#125;,</span><br><span class="line">],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="重构-transform-逻辑"><a href="#重构-transform-逻辑" class="headerlink" title="重构 transform 逻辑"></a>重构 transform 逻辑</h5><p>core &#x2F; transform.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosTransformer</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">transform</span>(<span class="params"> <span class="comment">//transform函数接收data headers fns三个参数</span></span></span><br><span class="line"><span class="params"><span class="attr">data</span>: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params"><span class="attr">fns</span>?: <span class="title class_">AxiosTransformer</span> | <span class="title class_">AxiosTransformer</span>[]</span></span><br><span class="line"><span class="params"></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!fns) &#123;</span><br><span class="line"><span class="comment">//如果没有传入fns 直接返回data</span></span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(fns)) &#123;</span><br><span class="line"><span class="comment">//如果fns不是数组 将其转为数组</span></span><br><span class="line">fns = [fns]</span><br><span class="line">&#125;</span><br><span class="line">fns.<span class="title function_">forEach</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//遍历fns数组 依次调用fn函数</span></span><br><span class="line">data = <span class="title function_">fn</span>(data, headers)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>core &#x2F; dispatchRequest.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> transform <span class="keyword">from</span> <span class="string">&#x27;./transform&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 处理 config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// 先处理 headers</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// 再处理 data</span></span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">flattenHeaders</span>(config.<span class="property">headers</span>, config.<span class="property">method</span>!) <span class="comment">//处理 headers 扁平化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更改为 👇</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 处理 config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transform</span>(config.<span class="property">data</span>, config.<span class="property">headers</span>, config.<span class="property">transformRequest</span>) <span class="comment">//处理 data</span></span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">flattenHeaders</span>(config.<span class="property">headers</span>, config.<span class="property">method</span>!) <span class="comment">//处理 headers 扁平化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>删掉不用的东西</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformRequestData</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// 处理 data 调用 transformRequest 方法</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequest</span>(config.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformHeaders</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// 处理 headers 调用 processHeaders 方法</span></span><br><span class="line"><span class="keyword">const</span> &#123; headers = &#123;&#125;, data &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">processHeaders</span>(headers, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更改逻辑</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">transformResponseData</span>(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>): <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line"><span class="comment">// 处理 response data</span></span><br><span class="line">res.<span class="property">data</span> = <span class="title function_">transform</span>(res.<span class="property">data</span>, res.<span class="property">headers</span>, res.<span class="property">config</span>.<span class="property">transformResponse</span>)</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="create"><a href="#create" class="headerlink" title="create"></a>create</h4><blockquote><p>目前为止，我们的 axios 都是一个单例，一旦我们修改了 axios 的默认配置，会影响所有的请求。我们希望提供了一个<code>axios.create</code>的静态接口允许我们创建一个新的 axios 实例，同时允许我们传入新的配置和默认配置合并，并做为新的默认配置。</p></blockquote><h5 id="扩展新的接口"><a href="#扩展新的接口" class="headerlink" title="扩展新的接口"></a>扩展新的接口</h5><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosStatic</span> <span class="keyword">extends</span> <span class="title class_">AxiosInstance</span> &#123;</span><br><span class="line"><span class="comment">//axios静态接口</span></span><br><span class="line"><span class="title function_">create</span>(<span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosInstance</span> <span class="comment">//创建axios实例</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>axios.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosStatic</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Axios</span> <span class="keyword">from</span> <span class="string">&#x27;./core/Axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/util&#x27;</span></span><br><span class="line"><span class="keyword">import</span> defaults <span class="keyword">from</span> <span class="string">&#x27;./defaults&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mergeConfig <span class="keyword">from</span> <span class="string">&#x27;./core/mergeConfig&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosStatic</span> &#123;</span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> <span class="title class_">Axios</span>(config) <span class="comment">//创建一个 Axios 实例 并传入 config 参数 并赋值给 context 变量</span></span><br><span class="line"><span class="keyword">const</span> instance = <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span>.<span class="title function_">bind</span>(context) <span class="comment">//调用 request 方法 并传入 context 参数 并赋值给 instance 变量 绑定 this 指向 context</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">extend</span>(instance, context) <span class="comment">//调用 extend 方法 并传入 instance 和 context 参数 实现 instance 对象继承 context 对象</span></span><br><span class="line"><span class="keyword">return</span> instance <span class="keyword">as</span> <span class="title class_">AxiosStatic</span> <span class="comment">//返回 instance 对象 并断言为 AxiosStatic 类型</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="title function_">createInstance</span>(defaults) <span class="comment">//调用 createInstance 方法 并传入 defaults 参数 并赋值给 axios 变量</span></span><br><span class="line"></span><br><span class="line">axios.<span class="property">create</span> = <span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">config</span>) &#123;</span><br><span class="line"><span class="comment">//axios.create 方法接收一个 config 参数 并返回一个 createInstance 方法的调用结果 并传入 mergeConfig 方法的调用结果 并传入 defaults 和 config 参数</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">createInstance</span>(<span class="title function_">mergeConfig</span>(defaults, config))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 源码学习 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>源码探究 runtime-core模块</title>
      <link href="/2025/03/04/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/%E6%BA%90%E7%A0%81%E6%8E%A2%E7%A9%B6%20runtime-core%E6%A8%A1%E5%9D%97/"/>
      <url>/2025/03/04/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/%E6%BA%90%E7%A0%81%E6%8E%A2%E7%A9%B6%20runtime-core%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="源码探究-runtime-core-模块"><a href="#源码探究-runtime-core-模块" class="headerlink" title="源码探究 runtime-core 模块"></a>源码探究 runtime-core 模块</h1><blockquote><p>接下来我们将对这行核心代码的源码进行全流程追踪</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#root&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>注：在此之前我们已经通过</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const rootContainer = document.querySelector(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure><p>拿到 <strong><em>rootContainer</em></strong> ：<div id="app"></div></p></blockquote><p>拆分成两个步骤</p><blockquote><p>createApp(App)</p><p>.mount(“#root”)</p></blockquote><h2 id="createApp-App"><a href="#createApp-App" class="headerlink" title="createApp(App)"></a>createApp(App)</h2><h3 id="关于-App"><a href="#关于-App" class="headerlink" title="关于 App"></a>关于 App</h3><p>我们先来看用户这边的操作</p><p>App.js</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">App</span> = &#123;</span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// UI逻辑</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">h</span>(</span><br><span class="line"><span class="comment">// Vue 中的创建虚拟 DOM 的辅助函数,用于创建虚拟 DOM 节点,接收三个参数：</span></span><br><span class="line"><span class="string">&#x27;div&#x27;</span>, <span class="comment">// type：要创建的 HTML 标签名或组件选项对象.</span></span><br><span class="line">&#123; <span class="attr">id</span>: <span class="string">&#x27;root&#x27;</span>, <span class="attr">class</span>: [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;hard&#x27;</span>] &#125;, <span class="comment">// props：标签属性,可以是一个 对象 或 数组.</span></span><br><span class="line"><span class="string">&#x27;hi, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">msg</span> <span class="comment">// children：子节点,可以是 字符串、数字、数组、其他虚拟 DOM 节点.</span></span><br><span class="line">)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// 组合式 API 的入口点,用于组合组件的逻辑，例如响应式数据、生命周期钩子、计算属性等</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="attr">msg</span>: <span class="string">&#x27;mini-vue&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里给 h 辅助函数传入三个参数</p><p><strong><em>type</em></strong>：要创建的 HTML 标签名或组件选项对象(div)</p><p><strong><em>props</em></strong>：标签属性,可以是一个 对象 或 数组</p><p><strong><em>children</em></strong>：子节点,可以是 字符串、数字、数组、其他虚拟 DOM 节点</p></blockquote><p>来看看 h 辅助函数</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">h</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">createVNode</span>(<span class="keyword">type</span>, props, children)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接着 createVNode</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createVNode</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> vnode = &#123;</span><br><span class="line"><span class="keyword">type</span>, <span class="comment">// 类型</span></span><br><span class="line">props, <span class="comment">// 属性</span></span><br><span class="line">children, <span class="comment">// 孩子</span></span><br><span class="line"><span class="attr">el</span>: <span class="literal">null</span>, <span class="comment">// 对应的真实dom</span></span><br><span class="line"><span class="attr">component</span>: <span class="literal">null</span>, <span class="comment">// 组件实例</span></span><br><span class="line"><span class="attr">key</span>: props === <span class="literal">null</span> || props === <span class="built_in">void</span> <span class="number">0</span> ? <span class="built_in">void</span> <span class="number">0</span> : props.<span class="property">key</span>, <span class="comment">// 唯一标识</span></span><br><span class="line"><span class="comment">// shapeFlag: getShapeFlag(type), // 类型标识</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>现在 App 的结构就变成了这样</p><p>render()</p><blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type<span class="punctuation">,</span> <span class="comment">// 类型</span></span><br><span class="line">props<span class="punctuation">,</span> <span class="comment">// 属性</span></span><br><span class="line">children<span class="punctuation">,</span> <span class="comment">// 孩子</span></span><br><span class="line">el<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// 对应的真实dom</span></span><br><span class="line">component<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// 组件实例</span></span><br><span class="line">key<span class="punctuation">:</span> props === <span class="literal"><span class="keyword">null</span></span> || props === void <span class="number">0</span> ? void <span class="number">0</span> <span class="punctuation">:</span> props.key<span class="punctuation">,</span> <span class="comment">// 唯一标识</span></span><br></pre></td></tr></table></figure></blockquote><p>setup()</p></blockquote><h3 id="关于-createApp"><a href="#关于-createApp" class="headerlink" title="关于 createApp"></a>关于 createApp</h3><blockquote><p>传入结构 App-&gt;rootComponent</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createApp</span>(<span class="params">rootComponent</span>) &#123;</span><br><span class="line"><span class="comment">//rootComponent就是App</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="title function_">mount</span>(<span class="params">rootContainer</span>) &#123;</span><br><span class="line"><span class="comment">//.mount方法的扩展</span></span><br><span class="line"><span class="keyword">const</span> vnode = <span class="title function_">createVNode</span>(rootComponent)</span><br><span class="line"><span class="title function_">render</span>(vnode, rootContainer)</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>由此进入.mount(“#root”)部分</p></blockquote><h2 id="mount-“-root”"><a href="#mount-“-root”" class="headerlink" title=".mount(“#root”)"></a>.mount(“#root”)</h2><blockquote><p>接着看 mount 方法的内部</p><p>&#x2F;&#x2F; 挂载回根容器<br>&#x2F;&#x2F; 先把根组件转换成虚拟节点 vnode<br>&#x2F;&#x2F; 之后所有的操作都会基于 vnode 做处理</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createApp</span>(<span class="params">rootComponent</span>) &#123;</span><br><span class="line"><span class="comment">// rootComponent 就是 &#123;render: ƒ, setup: ƒ&#125;</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="title function_">mount</span>(<span class="params">rootContainer</span>) &#123;</span><br><span class="line"><span class="comment">// rootContainer 就是 div#app</span></span><br><span class="line"><span class="keyword">const</span> vnode = <span class="title function_">createVNode</span>(rootComponent) <span class="comment">// 根组件转换成虚拟节点vnode</span></span><br><span class="line"><span class="title function_">render</span>(vnode, rootContainer) <span class="comment">// 将 vnode 渲染到 container 中</span></span><br><span class="line"><span class="comment">// 之后所有的操作都会基于vnode做处理</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="createVNode"><a href="#createVNode" class="headerlink" title="createVNode"></a>createVNode</h3><blockquote><p>rootComponent 传进来了 {render: ƒ, setup: ƒ}</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createVNode</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> vnode = &#123;</span><br><span class="line"><span class="keyword">type</span>, <span class="comment">// 类型</span></span><br><span class="line">props, <span class="comment">// 属性</span></span><br><span class="line">children, <span class="comment">// 孩子</span></span><br><span class="line"><span class="attr">el</span>: <span class="literal">null</span>, <span class="comment">// 对应的真实dom</span></span><br><span class="line"><span class="attr">component</span>: <span class="literal">null</span>, <span class="comment">// 组件实例</span></span><br><span class="line"><span class="attr">key</span>: props === <span class="literal">null</span> || props === <span class="built_in">void</span> <span class="number">0</span> ? <span class="built_in">void</span> <span class="number">0</span> : props.<span class="property">key</span>, <span class="comment">// 唯一标识</span></span><br><span class="line"><span class="comment">// shapeFlag: getShapeFlag(type), // 类型标识</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>现在 {render: ƒ, setup: ƒ} 被挂到了虚拟节点的第一个属性 <strong><em>type</em></strong> 上</p></blockquote><blockquote><p>现在 <strong><em>vnode</em></strong> 的结构就变成了这样</p><p><strong>type</strong></p><blockquote><p>render()</p><blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type<span class="punctuation">,</span> <span class="comment">// 类型</span></span><br><span class="line">props<span class="punctuation">,</span> <span class="comment">// 属性</span></span><br><span class="line">children<span class="punctuation">,</span> <span class="comment">// 孩子</span></span><br><span class="line">el<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// 对应的真实dom</span></span><br><span class="line">component<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// 组件实例</span></span><br><span class="line">key<span class="punctuation">:</span> props === <span class="literal"><span class="keyword">null</span></span> || props === void <span class="number">0</span> ? void <span class="number">0</span> <span class="punctuation">:</span> props.key<span class="punctuation">,</span> <span class="comment">// 唯一标识</span></span><br></pre></td></tr></table></figure></blockquote><p>setup()</p></blockquote><p><strong>props</strong></p><p><strong>children</strong></p><p><strong>el</strong></p><p><strong>component</strong></p><p><strong>key</strong></p></blockquote><h3 id="render"><a href="#render" class="headerlink" title="render"></a>render</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(vnode, rootContainer) <span class="comment">// 将 vnode 渲染到 container 中</span></span><br></pre></td></tr></table></figure><blockquote><p>vnode : 刚才写的结构 👆</p><p>rootContainer : div#app</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="comment">// 直接指向patch函数</span></span><br><span class="line"><span class="title function_">patch</span>(vnode, container)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="patch-拆箱回调"><a href="#patch-拆箱回调" class="headerlink" title="patch 拆箱回调"></a>patch 拆箱回调</h3><blockquote><p>拆箱函数，深层回调的起点</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">type</span> === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// 元素分支</span></span><br><span class="line"><span class="title function_">processElement</span>(vnode, container)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">type</span> === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// 组件分支</span></span><br><span class="line"><span class="title function_">processComponent</span>(vnode)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="processComponent-组件分支（首次进入）"><a href="#processComponent-组件分支（首次进入）" class="headerlink" title="processComponent 组件分支（首次进入）"></a>processComponent 组件分支（首次进入）</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processComponent</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="title function_">mountComponent</span>(vnode)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="mountComponent-组件初始化分支"><a href="#mountComponent-组件初始化分支" class="headerlink" title="mountComponent 组件初始化分支"></a>mountComponent 组件初始化分支</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountComponent</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> instance = <span class="title function_">createComponentInstance</span>(vnode) <span class="comment">// 创建组件实例</span></span><br><span class="line"><span class="title function_">setupComponent</span>(instance) <span class="comment">// 处理组件</span></span><br><span class="line"><span class="title function_">setupRenderEffect</span>(instance, vnode, container) <span class="comment">// 处理组件渲染</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="createComponentInstance"><a href="#createComponentInstance" class="headerlink" title="createComponentInstance"></a>createComponentInstance</h6><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createComponentInstance</span>(<span class="params">vnode</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> instance = &#123;</span><br><span class="line">vnode,</span><br><span class="line"><span class="attr">type</span>: vnode.<span class="property">type</span>,</span><br><span class="line"><span class="attr">props</span>: vnode.<span class="property">props</span>,</span><br><span class="line"><span class="attr">slots</span>: vnode.<span class="property">slots</span>, <span class="comment">// 插槽</span></span><br><span class="line"><span class="attr">proxy</span>: <span class="literal">null</span>, <span class="comment">// 代理对象</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> instance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>返回的 <strong><em>instance</em></strong> 结构</p><p><strong>vnode</strong>(新增) ：继承当前传过来的整个 vnode 结构</p><p><strong>type</strong></p><blockquote><p>render()</p><blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type<span class="punctuation">,</span> <span class="comment">// 类型</span></span><br><span class="line">props<span class="punctuation">,</span> <span class="comment">// 属性</span></span><br><span class="line">children<span class="punctuation">,</span> <span class="comment">// 孩子</span></span><br><span class="line">el<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// 对应的真实dom</span></span><br><span class="line">component<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// 组件实例</span></span><br><span class="line">key<span class="punctuation">:</span> props === <span class="literal"><span class="keyword">null</span></span> || props === void <span class="number">0</span> ? void <span class="number">0</span> <span class="punctuation">:</span> props.key<span class="punctuation">,</span> <span class="comment">// 唯一标识</span></span><br></pre></td></tr></table></figure></blockquote><p>setup()</p></blockquote><p><strong>props</strong></p><p><strong>slots</strong>(新增)</p><p><strong>proxy</strong>(新增)</p><p><strong>children</strong></p><p><strong>el</strong></p><p><strong>component</strong></p><p><strong>key</strong></p></blockquote><h6 id="setupComponent"><a href="#setupComponent" class="headerlink" title="setupComponent"></a>setupComponent</h6><blockquote><p>instance 的结构见上 👆</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setupComponent</span>(<span class="params">instance</span>) &#123;</span><br><span class="line"><span class="comment">// 初始化组件</span></span><br><span class="line"><span class="title function_">initProps</span>(instance)</span><br><span class="line"><span class="title function_">initSlots</span>(instance)</span><br><span class="line"><span class="title function_">setupStatefulComponent</span>(instance) <span class="comment">// 处理组件的setup</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>setupStatefulComponent</strong></p><blockquote><p>按这个例子来说，解构出来的 setup 结构为</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ƒ <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;mini-vue&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setupStatefulComponent</span>(<span class="params">instance</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Component</span> = instance.<span class="property">type</span> <span class="comment">// 先拿到组件 &#123;render: ƒ, setup: ƒ&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; setup &#125; = <span class="title class_">Component</span> <span class="comment">//解构出setup(结构见上面注释)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (setup) &#123;</span><br><span class="line"><span class="comment">// setCurrentInstance(instance)</span></span><br><span class="line"><span class="keyword">const</span> setupResult = <span class="title function_">setup</span>() <span class="comment">// &#123;msg: &#x27;mini-vue&#x27;&#125;</span></span><br><span class="line"><span class="comment">// setCurrentInstance(null)</span></span><br><span class="line"><span class="title function_">handleSetupResult</span>(instance, setupResult) <span class="comment">// instance &amp; &#123;msg: &#x27;mini-vue&#x27;&#125;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">finishComponentSetup</span>(instance)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面这个先留个坑🕳后面看</span></span><br><span class="line">instance.<span class="property">proxy</span> = <span class="keyword">new</span> <span class="title class_">Proxy</span>(instance, &#123;</span><br><span class="line"><span class="comment">// 创建代理对象</span></span><br><span class="line"><span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> &#123; setup, props &#125; = target</span><br><span class="line"><span class="keyword">if</span> (key <span class="keyword">in</span> setup) &#123;</span><br><span class="line"><span class="keyword">return</span> setup[key]</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (key <span class="keyword">in</span> props) &#123;</span><br><span class="line"><span class="keyword">return</span> props[key]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key)</span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>如果 setup 存在</strong></p><p>handleSetupResult （处理组件的 setup）</p><blockquote><p>传入 instance &amp; {msg: ‘mini-vue’}</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleSetupResult</span>(<span class="params"><span class="attr">instance</span>: <span class="built_in">any</span>, <span class="attr">setupResult</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> setupResult === <span class="string">&#x27;object&#x27;</span> &amp;&amp; setupResult !== <span class="literal">null</span>) &#123;</span><br><span class="line">instance.<span class="property">setupState</span> = setupResult <span class="comment">// instance新增属性setupState</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">finishComponentSetup</span>(instance) <span class="comment">// 处理组件的render</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>finishComponentSetup （处理组件的 render）</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">finishComponentSetup</span>(<span class="params">instance</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Component</span> = instance.<span class="property">type</span> <span class="comment">// 先拿到组件 &#123;render: ƒ, setup: ƒ&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">Component</span>.<span class="property">render</span>) &#123;</span><br><span class="line">instance.<span class="property">render</span> = <span class="title class_">Component</span>.<span class="property">render</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">instance.<span class="property">render</span> = instance.<span class="property">vnode</span>.<span class="property">render</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里 instance 又新增了 render 属性</p></blockquote><p><strong>如果 setup 不存在</strong></p><blockquote><p>直接处理组件的 render</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">finishComponentSetup</span>(instance)</span><br></pre></td></tr></table></figure><blockquote><p>到这里就是组件初始化的最底层了，接下来我们回到 <em>mountComponent</em> 完成 <em>setupRenderEffect</em> 部分</p></blockquote><h6 id="setupRenderEffect"><a href="#setupRenderEffect" class="headerlink" title="setupRenderEffect"></a>setupRenderEffect</h6><blockquote><p>要传入三个参数 <strong><em>instance</em></strong>, <strong><em>vnode</em></strong>, <strong><em>container</em></strong></p><p>已知 <strong>container</strong> 作为容器为<div id="app"></div></p><p>到这里我们先梳理一下目前 <strong>instance</strong> &amp; <strong>vnode</strong> 内部的参数</p><table><thead><tr><th align="left">instance</th><th align="left">vnode</th><th align="center">属性</th></tr></thead><tbody><tr><td align="left">✅</td><td align="left">✅</td><td align="center">children</td></tr><tr><td align="left">✅</td><td align="left">✅</td><td align="center">component</td></tr><tr><td align="left">✅</td><td align="left">✅</td><td align="center">el</td></tr><tr><td align="left">✅</td><td align="left">✅</td><td align="center">key</td></tr><tr><td align="left">✅</td><td align="left">✅</td><td align="center">props</td></tr><tr><td align="left">✅ 内部是右边 vnode 的前五个属性</td><td align="left">⛔</td><td align="center"><strong><em>vnode</em></strong></td></tr><tr><td align="left">✅ { render: ƒ, setup: ƒ }</td><td align="left">✅ { render: ƒ, setup: ƒ }</td><td align="center"><strong><em>type</em></strong></td></tr><tr><td align="left">✅</td><td align="left">⛔</td><td align="center">proxy</td></tr><tr><td align="left">✅</td><td align="left">⛔</td><td align="center">slots</td></tr><tr><td align="left">✅ { msg: ‘mini-vue’ }</td><td align="left">⛔</td><td align="center">setupState</td></tr></tbody></table></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupRenderEffect</span>(<span class="params"><span class="attr">instance</span>: <span class="built_in">any</span>, <span class="attr">vnode</span>: <span class="built_in">any</span>, <span class="attr">container</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line"><span class="comment">//我们先看这一部分</span></span><br><span class="line"><span class="keyword">const</span> &#123; proxy &#125; = instance</span><br><span class="line"><span class="keyword">const</span> subTree = instance.<span class="property">render</span>.<span class="title function_">call</span>(proxy) <span class="comment">// 注意!是这个时候去调用render里的h函数了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vnode -&gt; patch</span></span><br><span class="line"><span class="comment">// vnode -&gt; element -&gt; mountElement</span></span><br><span class="line"><span class="comment">// patch(subTree, container)</span></span><br><span class="line"><span class="comment">// vnode.el = subTree.el</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>回顾 h 函数</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">h</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">createVNode</span>(<span class="keyword">type</span>, props, children)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>再看这时候的 type, props, children 也就是用户样例</p><p>type：’div’</p><p>props：{ id: ‘root’, class: [‘red’, ‘hard’] }</p><p>children：’hi, mini-vue’</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createVNode</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> vnode = &#123;</span><br><span class="line"><span class="keyword">type</span>, <span class="comment">// 传入类型</span></span><br><span class="line">props, <span class="comment">// 传入属性</span></span><br><span class="line">children, <span class="comment">// 传入子节点</span></span><br><span class="line"><span class="attr">el</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">component</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">key</span>: props === <span class="literal">null</span> || props === <span class="built_in">void</span> <span class="number">0</span> ? <span class="built_in">void</span> <span class="number">0</span> : props.<span class="property">key</span>, <span class="comment">// 唯一标识</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>那么接下来的 <strong><em>subTree</em></strong> 结构就是</p><p><strong>type</strong> &#x3D; ‘div’</p><p><strong>props</strong> &#x3D; { id: ‘root’, class: [‘red’, ‘hard’] }</p><p><strong>children</strong> &#x3D; ‘hi, mini-vue’</p><p><strong>el</strong></p><p><strong>component</strong></p><p><strong>key</strong></p></blockquote><blockquote><p>以及 <strong><em>container</em></strong> 结构</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span> <span class="attr">class</span>=<span class="string">&quot;red, hard&quot;</span>&gt;</span>hi, mini-vue<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><p>返回 <strong>setupRenderEffect</strong> 函数，继续看下面的逻辑</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupRenderEffect</span>(<span class="params"><span class="attr">instance</span>: <span class="built_in">any</span>, <span class="attr">vnode</span>: <span class="built_in">any</span>, <span class="attr">container</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line"><span class="comment">// const &#123; proxy &#125; = instance</span></span><br><span class="line"><span class="comment">// const subTree = instance.render.call(proxy) // 注意!是这个时候去调用render里的h函数了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vnode -&gt; patch</span></span><br><span class="line"><span class="comment">// vnode -&gt; element -&gt; mountElement</span></span><br><span class="line"><span class="title function_">patch</span>(subTree, container) <span class="comment">//传入subtree container</span></span><br><span class="line">vnode.<span class="property">el</span> = subTree.<span class="property">el</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时调用 <strong><em>patch</em></strong> 回调拆箱</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">type</span> === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// 元素分支 &lt;-这次进这个</span></span><br><span class="line"><span class="title function_">processElement</span>(vnode, container) <span class="comment">// 此时的 vnode.type 已经是&#x27;div&#x27;了</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">type</span> === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// 组件分支</span></span><br><span class="line"><span class="title function_">processComponent</span>(vnode)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>快进到下面的 processElement 元素分支</p></blockquote><h5 id="updateComponent-更新分支"><a href="#updateComponent-更新分支" class="headerlink" title="updateComponent 更新分支"></a>updateComponent 更新分支</h5><blockquote><p><strong><em>!!! 第一次看先掠过这一部分,先看后文 ‘processElement 元素分支’ 实现拆箱 !!!</em></strong></p></blockquote><h4 id="processElement-元素分支"><a href="#processElement-元素分支" class="headerlink" title="processElement 元素分支"></a>processElement 元素分支</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="title function_">mountElement</span>(vnode, container)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="mountElement-元素初始化分支"><a href="#mountElement-元素初始化分支" class="headerlink" title="mountElement 元素初始化分支"></a>mountElement 元素初始化分支</h5><blockquote><p>若以首次样例传入为例，进入文本节点</p><p>若以二次样例传入为例，进入数组节点</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(vnode.<span class="property">type</span>) <span class="comment">// 创建真实dom &lt;div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="keyword">const</span> &#123; children, props &#125; = vnode</span><br><span class="line"><span class="comment">// (首次)解构为</span></span><br><span class="line"><span class="comment">// &#x27;hi, mini-vue&#x27;</span></span><br><span class="line"><span class="comment">// &#123; id: &#x27;root&#x27;, class: [&#x27;red&#x27;, &#x27;hard&#x27;] &#125;</span></span><br><span class="line"><span class="comment">// (二次)解构为</span></span><br><span class="line"><span class="comment">// [h(&#x27;p&#x27;, &#123; class: &#x27;red&#x27; &#125;, &#x27;hi&#x27;), h(&#x27;p&#x27;, &#123; class: &#x27;blue&#x27; &#125;, &#x27;mini-vue&#x27;)]</span></span><br><span class="line"><span class="comment">// &#123; id: &#x27;root&#x27;, class: [&#x27;red&#x27;, &#x27;hard&#x27;] &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> children === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// 文本节点(首次样例)</span></span><br><span class="line">el.<span class="property">textContent</span> = children <span class="comment">// 直接把&#x27;hi, mini-vue&#x27;插入到&lt;div&gt;&lt;/div&gt;下0位处</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(children)) &#123;</span><br><span class="line"><span class="comment">// 数组节点(二次样例)</span></span><br><span class="line"><span class="title function_">mountChildren</span>(vnode, el) <span class="comment">// 拆分数组 + patch回调 (此时el是&lt;p&gt;,container是&lt;div&gt;)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (props) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> props) &#123;</span><br><span class="line"><span class="comment">// 遍历key</span></span><br><span class="line"><span class="keyword">const</span> val = props[key] <span class="comment">// 拿到属性值val</span></span><br><span class="line">el.<span class="title function_">setAttribute</span>(key, val) <span class="comment">// Web内置API,把键值对嵌入div标签</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">container.<span class="title function_">append</span>(el) <span class="comment">// Web内置API,把el挂载到容器中</span></span><br><span class="line"><span class="comment">// (首次)挂载为</span></span><br><span class="line"><span class="comment">// container : &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment">// el : &lt;div id=&quot;root&quot; class=&quot;red,hard&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment">// (二次)挂载为</span></span><br><span class="line"><span class="comment">// container : &lt;div id=&quot;root&quot; class=&quot;red,hard&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment">// el : &lt;p class=&quot;...&quot;&gt;&lt;/p&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>(首次样例) for (const key in props) 的过程</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span> <span class="attr">class</span>=<span class="string">&quot;red,hard&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><blockquote><p>(首次样例) container.append(el) 的结果</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- container --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&gt; 0 =</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span> <span class="attr">class</span>=<span class="string">&quot;red, hard&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&gt; &gt; 0 = hi, mini-vue</span><br></pre></td></tr></table></figure></blockquote><p>此时返回 <strong><em>setupRenderEffect</em></strong> 的最后一行</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vnode.<span class="property">el</span> = subTree.<span class="property">el</span></span><br></pre></td></tr></table></figure><blockquote><p>此时打开 html 网页，就可以看到屏幕上的 hi, mini-vue 字样了</p></blockquote><p><strong><em>!!! 二次复盘 !!!</em></strong></p><blockquote><p>现在我们将 h 的 children 参数改成数组</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title function_">h</span>(</span><br><span class="line"><span class="comment">// 创建虚拟 DOM 节点,接收三个参数</span></span><br><span class="line"><span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">&#123; <span class="attr">id</span>: <span class="string">&#x27;root&#x27;</span>, <span class="attr">class</span>: [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;hard&#x27;</span>] &#125;,</span><br><span class="line"><span class="comment">// &#x27;hi, mini-vue&#x27; //string类型</span></span><br><span class="line">[<span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;red&#x27;</span> &#125;, <span class="string">&#x27;hi&#x27;</span>), <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;blue&#x27;</span> &#125;, <span class="string">&#x27;mini-vue&#x27;</span>)] <span class="comment">// array类型</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>并且在 index.html 中添加 css 样式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.red</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.blue</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">color</span>: blue;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></blockquote><p>还记得 children 判断类型的分支吗，就在刚写的 <strong><em>mountElement</em></strong> 函数里，返回去再看看，看完再回到这里</p><h6 id="mountChildren"><a href="#mountChildren" class="headerlink" title="mountChildren"></a>mountChildren</h6><blockquote><p>所以现在二次样例中的数据如下</p><p><strong>vnode.children</strong> 子节点标签数组</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;[<span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;red&#x27;</span> &#125;, <span class="string">&#x27;hi&#x27;</span>), <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;blue&#x27;</span> &#125;, <span class="string">&#x27;mini-vue&#x27;</span>)]</span><br></pre></td></tr></table></figure><p><strong>container</strong> 根容器</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountChildren</span>(<span class="params"><span class="attr">vnode</span>: <span class="built_in">any</span>, <span class="attr">container</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">vnode.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">patch</span>(v, container) <span class="comment">// 递归处理children</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>取出来的 <strong><em>v</em></strong> 依此是</p><table><thead><tr><th align="center"></th><th align="center">第一次 (调用 h)</th><th align="center">第二次 (调用 h)</th></tr></thead><tbody><tr><td align="center"><strong>type</strong></td><td align="center">p</td><td align="center">p</td></tr><tr><td align="center"><strong>props</strong></td><td align="center">{ class: ‘ red ‘ }</td><td align="center">{ class: ‘ blue ‘ }</td></tr><tr><td align="center"><strong>children</strong></td><td align="center">‘ hi ‘</td><td align="center">‘ mini-vue ‘</td></tr></tbody></table></blockquote>]]></content>
      
      
      <categories>
          
          <category> 源码学习 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
