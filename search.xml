<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>é€šä¿—ç‰ˆPromiseè§£é‡Š</title>
      <link href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/%E9%80%9A%E4%BF%97%E7%89%88Promise%E8%A7%A3%E9%87%8A/"/>
      <url>/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/%E9%80%9A%E4%BF%97%E7%89%88Promise%E8%A7%A3%E9%87%8A/</url>
      
        <content type="html"><![CDATA[<h1 id="é€šä¿—ç‰ˆPromiseè§£é‡Š"><a href="#é€šä¿—ç‰ˆPromiseè§£é‡Š" class="headerlink" title="é€šä¿—ç‰ˆPromiseè§£é‡Š"></a>é€šä¿—ç‰ˆPromiseè§£é‡Š</h1><p><strong>é¦–å…ˆè¦ç†è§£å‰ç«¯çš„åŒæ­¥å¼‚æ­¥ä»»åŠ¡æµç¨‹</strong></p><h2 id="åŒæ­¥-vs-å¼‚æ­¥ä»»åŠ¡"><a href="#åŒæ­¥-vs-å¼‚æ­¥ä»»åŠ¡" class="headerlink" title="åŒæ­¥ vs å¼‚æ­¥ä»»åŠ¡"></a>åŒæ­¥ vs å¼‚æ­¥ä»»åŠ¡</h2><h3 id="åŒæ­¥ä»»åŠ¡ï¼ˆæ’é˜Ÿä¹°å¥¶èŒ¶ï¼‰"><a href="#åŒæ­¥ä»»åŠ¡ï¼ˆæ’é˜Ÿä¹°å¥¶èŒ¶ï¼‰" class="headerlink" title="åŒæ­¥ä»»åŠ¡ï¼ˆæ’é˜Ÿä¹°å¥¶èŒ¶ï¼‰"></a><strong>åŒæ­¥ä»»åŠ¡ï¼ˆæ’é˜Ÿä¹°å¥¶èŒ¶ï¼‰</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// ä½ ç«™åœ¨æŸœå°å‰å¹²ç­‰ï¼Œä¸åšå…¶ä»–äº‹</span><br><span class="line">console.log(&quot;1. ç‚¹å•ï¼šæˆ‘è¦çç å¥¶èŒ¶&quot;);</span><br><span class="line">console.log(&quot;2. ç­‰åº—å‘˜åˆ¶ä½œ...ï¼ˆå¹²ç­‰5ç§’ï¼‰&quot;);</span><br><span class="line">// æ¨¡æ‹ŸåŒæ­¥ç­‰å¾…</span><br><span class="line">const start = Date.now();</span><br><span class="line">while (Date.now() - start &lt; 5000) &#123;&#125; // ç›´æ¥é˜»æ–­åé¢çš„è¿›ç¨‹ï¼Œé˜»å¡5ç§’</span><br><span class="line">console.log(&quot;3. æ‹¿åˆ°å¥¶èŒ¶ï¼Œå¼€å¿ƒå–ï¼&quot;);</span><br></pre></td></tr></table></figure><hr><h3 id="å¼‚æ­¥ä»»åŠ¡ï¼ˆå¤–å–é€šçŸ¥ï¼‰"><a href="#å¼‚æ­¥ä»»åŠ¡ï¼ˆå¤–å–é€šçŸ¥ï¼‰" class="headerlink" title="å¼‚æ­¥ä»»åŠ¡ï¼ˆå¤–å–é€šçŸ¥ï¼‰"></a><strong>å¼‚æ­¥ä»»åŠ¡ï¼ˆå¤–å–é€šçŸ¥ï¼‰</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">console.log(&quot;1. æ‰‹æœºä¸‹å•å¥¶èŒ¶&quot;);</span><br><span class="line">// å¼‚æ­¥æ“ä½œï¼šä¸‹å•åå…ˆåšå…¶ä»–äº‹ï¼Œç­‰é€šçŸ¥</span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  console.log(&quot;3. å¤–å–å‘˜é€šçŸ¥ï¼šå¥¶èŒ¶åˆ°å•¦ï¼&quot;);</span><br><span class="line">&#125;, 5000); // 5ç§’åæ‰è§¦å‘å›è°ƒï¼Œä¸é˜»å¡ä¸»è¿›ç¨‹</span><br><span class="line">console.log(&quot;2. ä¸‹å•æˆåŠŸï¼Œå…ˆå»æ‰“æ¸¸æˆ~&quot;);</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºé¡ºåº</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. æ‰‹æœºä¸‹å•å¥¶èŒ¶  </span><br><span class="line">2. ä¸‹å•æˆåŠŸï¼Œå…ˆå»æ‰“æ¸¸æˆ~  </span><br><span class="line">3. å¤–å–å‘˜é€šçŸ¥ï¼šå¥¶èŒ¶åˆ°å•¦ï¼  </span><br></pre></td></tr></table></figure><h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>**å¯ä»¥æŠŠ <strong><strong>Promise</strong> æƒ³è±¡æˆä¸€å¼  <strong>è®¢é¤æ—¶çš„è®¢å•å°ç¥¨</strong>ã€‚</strong> **ä½ ç‚¹äº†ä¸€ä»½å¤–å–ï¼ˆå‘èµ·ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰ï¼Œè¿™æ—¶å€™æœåŠ¡å‘˜ä¸ä¼šè®©ä½ å¹²ç­‰ç€ï¼Œè€Œæ˜¯ç»™ä½ ä¸€å¼ è®¢å•å°ç¥¨ï¼ˆPromiseå¯¹è±¡ï¼‰ï¼Œå‘Šè¯‰ä½ ï¼šâ€œé¤å¥½äº†ä¼šé€šçŸ¥ä½ â€ã€‚</p><hr><h3 id="é€šä¿—ç‰ˆè§£é‡Šï¼š"><a href="#é€šä¿—ç‰ˆè§£é‡Šï¼š" class="headerlink" title="é€šä¿—ç‰ˆè§£é‡Šï¼š"></a><strong>é€šä¿—ç‰ˆè§£é‡Šï¼š</strong></h3><ol><li><strong>ä¸‹å•ï¼ˆPendingçŠ¶æ€ï¼‰</strong><ul><li>**ä½ ç‚¹äº†é¤ï¼Œä½†é¥­è¿˜æ²¡åšå¥½ â†’ **<code>new Promise()</code> åˆ›å»ºæ—¶å¤„äº <strong>è¿›è¡Œä¸­ï¼ˆPendingï¼‰</strong>ã€‚</li><li><strong>æ­¤æ—¶ä½ ï¼ˆä»£ç ï¼‰å¯ä»¥ç»§ç»­åšå…¶ä»–äº‹ï¼ˆæ¯”å¦‚ç©æ‰‹æœºï¼‰ï¼Œä¸ç”¨ä¸€ç›´ç›¯ç€å¨æˆ¿ã€‚ï¼ˆå¼‚æ­¥ï¼‰</strong></li></ul></li><li><strong>é¤å¥½äº†ï¼ˆFulfilledçŠ¶æ€ï¼‰</strong><ul><li>**å¨æˆ¿é€šçŸ¥ä½ ï¼šâ€œé¤å¥½äº†ï¼Œæ¥å–å§ï¼â€ â†’ Promise **<strong>æˆåŠŸï¼ˆResolvedï¼‰</strong>ã€‚</li><li>**ä½ æ‹¿åˆ°é¥­åå¼€å§‹åƒ â†’ ç”¨ **<code>.then()</code> å¤„ç†æˆåŠŸçš„ç»“æœï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order.then(food =&gt; eat(food)); // æ‹¿åˆ°é¥­å°±åƒ</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>é¤å‡ºé—®é¢˜äº†ï¼ˆRejectedçŠ¶æ€ï¼‰</strong><ul><li>**å¨æˆ¿è¯´ï¼šâ€œæŠ±æ­‰ï¼Œæ²¡é£Ÿæäº†â€ â†’ Promise **<strong>å¤±è´¥ï¼ˆRejectedï¼‰</strong>ã€‚</li><li>**ä½ å†³å®šæ³¡é¢ â†’ ç”¨ **<code>.catch()</code> å¤„ç†å¤±è´¥ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order.catch(error =&gt; eatInstantNoodles()); // å¤±è´¥å°±åƒæ³¡é¢</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æ— è®ºå¦‚ä½•éƒ½è¦æ”¶æ‹¾æ¡Œå­ï¼ˆFinallyï¼‰</strong><ul><li>**ä¸ç®¡åƒæ²¡åƒåˆ°å¤–å–ï¼Œä½ éƒ½è¦æ“¦æ¡Œå­ â†’ **<code>.finally()</code>ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order.finally(() =&gt; cleanTable()); // æ— è®ºæˆè´¥éƒ½æ‰§è¡Œ</span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><h3 id="ä¸ºä»€ä¹ˆæ¯”-â€œå›è°ƒå‡½æ•°â€-æ›´å¥½ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ¯”-â€œå›è°ƒå‡½æ•°â€-æ›´å¥½ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ¯” â€œå›è°ƒå‡½æ•°â€ æ›´å¥½ï¼Ÿ"></a><strong>ä¸ºä»€ä¹ˆæ¯” â€œå›è°ƒå‡½æ•°â€ æ›´å¥½ï¼Ÿ</strong></h3><ul><li><strong>å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰</strong>ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">// ä¼ ç»Ÿå›è°ƒå†™æ³•</span><br><span class="line">function orderMilkTea(callback) &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        console.log(&quot;1. æ‹¿åˆ°åŸºç¡€å¥¶èŒ¶&quot;);</span><br><span class="line">        callback(null, &quot;ğŸµåŸºç¡€å¥¶èŒ¶&quot;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addPearl(tea, callback) &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        console.log(&quot;2. åŠ çç &quot;);</span><br><span class="line">        callback(null, tea + &quot; + ğŸ±çç &quot;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addCheeseFoam(tea, callback) &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        console.log(&quot;3. åŠ å¥¶ç›–&quot;);</span><br><span class="line">        callback(null, tea + &quot; + ğŸ§€å¥¶ç›–&quot;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨å›è°ƒåœ°ç‹±</span><br><span class="line">orderMilkTea((error, tea) =&gt; &#123;</span><br><span class="line">    if (error) &#123;</span><br><span class="line">        console.log(&quot;å¤±è´¥ï¼š&quot;, error);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        addPearl(tea, (error, teaWithPearl) =&gt; &#123;</span><br><span class="line">            if (error) &#123;</span><br><span class="line">                console.log(&quot;å¤±è´¥ï¼š&quot;, error);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                addCheeseFoam(teaWithPearl, (error, finalTea) =&gt; &#123;</span><br><span class="line">                    if (error) &#123;</span><br><span class="line">                        console.log(&quot;å¤±è´¥ï¼š&quot;, error);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        console.log(&quot;æœ€ç»ˆå¥¶èŒ¶ï¼š&quot;, finalTea);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><strong>Promiseé“¾å¼è°ƒç”¨</strong>ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">// ç”¨PromiseåŒ…è£…å¼‚æ­¥æ“ä½œ</span><br><span class="line">function orderMilkTea() &#123;</span><br><span class="line">    return new Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&quot;1. æ‹¿åˆ°åŸºç¡€å¥¶èŒ¶&quot;);</span><br><span class="line">            resolve(&quot;ğŸµåŸºç¡€å¥¶èŒ¶&quot;);</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addPearl(tea) &#123;</span><br><span class="line">    return new Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&quot;2. åŠ çç &quot;);</span><br><span class="line">            resolve(tea + &quot; + ğŸ§‹çç &quot;);</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addCheeseFoam(tea) &#123;</span><br><span class="line">    return new Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&quot;3. åŠ å¥¶ç›–&quot;);</span><br><span class="line">            resolve(tea + &quot; + ğŸ§€å¥¶ç›–&quot;);</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// é“¾å¼è°ƒç”¨</span><br><span class="line">orderMilkTea()</span><br><span class="line">    .then(tea =&gt; addPearl(tea))</span><br><span class="line">    .then(teaWithPearl =&gt; addCheeseFoam(teaWithPearl))</span><br><span class="line">    .then(finalTea =&gt; &#123;</span><br><span class="line">    console.log(&quot;æœ€ç»ˆå¥¶èŒ¶ï¼š&quot;, finalTea);</span><br><span class="line">&#125;)</span><br><span class="line">    .catch(error =&gt; &#123;</span><br><span class="line">    console.log(&quot;å¤±è´¥ï¼š&quot;, error);</span><br><span class="line">&#125;)</span><br><span class="line">    .finally(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;æµç¨‹ç»“æŸï¼Œæ¸…ç†æ“ä½œ&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="ä¸€å¥è¯æ€»ç»“ï¼š"><a href="#ä¸€å¥è¯æ€»ç»“ï¼š" class="headerlink" title="ä¸€å¥è¯æ€»ç»“ï¼š"></a><strong>ä¸€å¥è¯æ€»ç»“ï¼š</strong></h3><p>**Promise å°±æ˜¯ä¸€å¼  ****â€œæœªæ¥äº‹ä»¶ä¿è¯ä¹¦â€**ï¼Œå‘Šè¯‰ç¨‹åºï¼šâ€œåˆ«å¹²ç­‰ï¼Œå…ˆå¿™ä½ çš„ï¼Œäº‹æƒ…æˆäº†æˆ–é»„äº†ï¼Œæˆ‘éƒ½ä¼šç»™ä½ ä¸ªäº¤ä»£ï¼â€</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¡¹ç›®ä¸­z-indexè§„åˆ’è®¾è®¡</title>
      <link href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E4%B8%ADz-index%E7%9A%84%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1/"/>
      <url>/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E4%B8%ADz-index%E7%9A%84%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="é¡¹ç›®ä¸­z-indexçš„è§„åˆ’è®¾è®¡"><a href="#é¡¹ç›®ä¸­z-indexçš„è§„åˆ’è®¾è®¡" class="headerlink" title="é¡¹ç›®ä¸­z-indexçš„è§„åˆ’è®¾è®¡"></a>é¡¹ç›®ä¸­z-indexçš„è§„åˆ’è®¾è®¡</h2><p><strong>æŠ€æœ¯è§„èŒƒï¼šå¤¹å±‚æ¨¡å‹</strong></p><p><strong>æ•´ä¸ªç»“æ„åˆ†ä¸ºAPPå±‚å’Œé¡µé¢ç»„ä»¶å±‚ã€‚APPåªæœ‰ä¸€ä¸ªï¼Œä½†é¡µé¢æœ‰å¾ˆå¤šã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1~999ï¼šéƒ½æ˜¯é¡µé¢å†…æ¯”è¾ƒæ­£å¸¸çš„å…ƒç´ </span><br><span class="line"></span><br><span class="line">1000~1999ï¼šå¼¹çª—çš„ç°è‰²é®ç½©èƒŒæ™¯ä¹‹ç±»çš„ç»„ä»¶ï¼Œæˆ–è€…æ˜¯èƒ½å¤Ÿé®ä½å…¨å±çš„åŠ è½½åŠ¨ç”»</span><br><span class="line"></span><br><span class="line">2000~2999ï¼šå¼¹çª—é¢æ¿ï¼Œæ¯”å¦‚çªç„¶å¼¹å‡ºæ¥ä¸€ä¸ªç•Œé¢æç¤ºæ¡†ï¼Œç™»å½•æ¡†ã€è­¦å‘Šæ¡†ä¹‹ç±»çš„</span><br><span class="line"></span><br><span class="line">3000~3999ï¼šé¡µé¢é¼ æ ‡äº¤äº’å±‚ï¼šæ¯”å¦‚åœ¨è¿™ä¸ªç•Œé¢ï¼Œä¼šæœ‰ä¸€ä¸ªé¼ æ ‡ç‚¹å‡»ä¸€ä¸‹å°±èƒ½è®©å±å¹•ä¸Šå¤šå‡ºæ¥ä¸€ä¸ªå°æ¡ƒå¿ƒçš„ä¸Šæµ®åŠ¨ç”»ï¼Œè¿™ä¸ªå°æ¡ƒå¿ƒå°±å¯ä»¥ç”¨ç»å¯¹å®šä½ä¸€ä¸ªdivæ¥å®ç°ã€‚ä½†ä»–çš„z-indexå¿…é¡»å¾ˆé«˜ï¼Œæ¯”å¼¹çª—ç»„ä»¶è¿˜è¦é«˜ã€‚</span><br></pre></td></tr></table></figure><p><strong>æœ‰äº†ç•Œé¢å±‚ï¼Œå…¶å®è¿˜åº”è¯¥æœ‰ä¸ªå…¨å±€çš„APPå±‚ï¼ŒAPPå±‚æ˜¯å®Œå…¨é«˜äºç•Œé¢å±‚çš„ä¸€ç§å±‚ã€‚å’Œç•Œé¢ä¸€æ ·ï¼Œä¹Ÿæœ‰é®ç½©å±‚ã€å¼¹çª—é¢æ¿å±‚å’Œé¼ æ ‡äº¤äº’å±‚ã€‚ä¸ºäº†æ–¹ä¾¿è®°å¿†ï¼Œç›´æ¥è®¾å®šAPPå±‚ä¸ºå››ä½æ•°ä¸Šä¸‡ã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¹Ÿå°±æ˜¯10000~~19999,20000~~29999,30000~39999ã€‚</span><br></pre></td></tr></table></figure><p><strong>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¯¥æ¨¡å‹ä¸­ä¸ä»…æœ‰å‘ä¸Šçš„è€ƒè™‘ï¼Œè¿˜æœ‰0ä»¥ä¸‹çš„è€ƒè™‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¯ä»¥è®¾å®šä¸€ä¸ªé¡µé¢èƒŒæ™¯å±‚ï¼Œè®©z-indexï¼š-1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç„¶åå†è®¾è®¡ä¸€ä¸ªAPPé€šç”¨èƒŒæ™¯å±‚ï¼Œz-indexï¼š-2ã€‚</span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1000ä»¥å†…éƒ½æ˜¯æ­£å¸¸é¡µé¢ï¼Œä¸Šåƒçº§åˆ«æ˜¯é¡µé¢çº§åˆ«çš„ä¸œè¥¿ï¼Œä¸Šä¸‡çº§åˆ«æ˜¯APPçº§åˆ«çš„ä¸œè¥¿ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1xxx+æ˜¯å¼¹çª—èƒŒæ™¯ï¼Œ2xxx+æ˜¯å¼¹çª—ï¼Œ3xxx+æ˜¯é¼ æ ‡äº¤äº’å±‚ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿä¸Šæ‰‹EChart(Vueé¡¹ç›®)</title>
      <link href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BEChart%E5%90%AB%E5%9B%BE%E8%A1%A8%E6%A8%A1%E6%9D%BF_vue%E9%A1%B9%E7%9B%AE%E5%86%99%E6%B3%95/"/>
      <url>/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BEChart%E5%90%AB%E5%9B%BE%E8%A1%A8%E6%A8%A1%E6%9D%BF_vue%E9%A1%B9%E7%9B%AE%E5%86%99%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯åŸºäº EChart å®˜æ–¹æ–‡æ¡£è¿›è¡Œçš„ç®€åŒ–</p><p><a href="https://echarts.apache.org/handbook/zh/get-started/" title="å¿«é€Ÿä¸Šæ‰‹ - ä½¿ç”¨æ‰‹å†Œ - Apache ECharts">å¿«é€Ÿä¸Šæ‰‹ - ä½¿ç”¨æ‰‹å†Œ - Apache ECharts</a></p><h2 id="ECharts"><a href="#ECharts" class="headerlink" title="ECharts"></a>ECharts</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install echarts --save</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h3 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h3><h4 id="å…¨å±€å¯¼å…¥"><a href="#å…¨å±€å¯¼å…¥" class="headerlink" title="å…¨å±€å¯¼å…¥"></a>å…¨å±€å¯¼å…¥</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å¼•å…¥ ECharts æ ¸å¿ƒæ¨¡å—</span><br><span class="line">import * as echarts from &#x27;echarts/core&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="æŒ‰éœ€å¯¼å…¥"><a href="#æŒ‰éœ€å¯¼å…¥" class="headerlink" title="æŒ‰éœ€å¯¼å…¥"></a>æŒ‰éœ€å¯¼å…¥</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç”±äºä¸åŒå›¾è¡¨ç±»å‹éœ€è¦å¯¼å…¥çš„ä¸œè¥¿éå¸¸æ‚ä¹±ï¼Œä»¥ä¸‹ä¸ºå¯¼å…¥åˆ†ç±»æ€»ç»“</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>æ¸²æŸ“å™¨ï¼ˆå¿…ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å¼•å…¥ Canvas æ¸²æŸ“å™¨</span><br><span class="line">import &#123; CanvasRenderer &#125; from &#x27;echarts/renderers&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>å›¾è¡¨ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// å¼•å…¥æŸ±çŠ¶å›¾å›¾è¡¨</span><br><span class="line">import &#123; BarChart &#125; from &#x27;echarts/charts&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥æŠ˜çº¿å›¾å›¾è¡¨</span><br><span class="line">import &#123; LineChart &#125; from &#x27;echarts/charts&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥é¥¼å›¾å›¾è¡¨</span><br><span class="line">import &#123; PieChart &#125; from &#x27;echarts/charts&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// å¼•å…¥æ ‡é¢˜ç»„ä»¶</span><br><span class="line">import &#123; TitleComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥æç¤ºæ¡†ç»„ä»¶</span><br><span class="line">import &#123; TooltipComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥ç›´è§’åæ ‡ç³»ç»„ä»¶ï¼ˆç”¨äºæŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ç­‰ï¼‰</span><br><span class="line">import &#123; GridComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥æ•°æ®é›†ç»„ä»¶</span><br><span class="line">import &#123; DatasetComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥å†…ç½®æ•°æ®è½¬æ¢å™¨ç»„ä»¶</span><br><span class="line">import &#123; TransformComponent &#125; from &#x27;echarts/components&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥å›¾ä¾‹ç»„ä»¶ï¼ˆç”¨äºé¥¼å›¾ç­‰ï¼‰</span><br><span class="line">import &#123; LegendComponent &#125; from &#x27;echarts/components&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>ç‰¹æ€§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å¼•å…¥æ ‡ç­¾è‡ªåŠ¨å¸ƒå±€ç‰¹æ€§</span><br><span class="line">import &#123; LabelLayout &#125; from &#x27;echarts/features&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥å…¨å±€è¿‡æ¸¡åŠ¨ç”»ç‰¹æ€§</span><br><span class="line">import &#123; UniversalTransition &#125; from &#x27;echarts/features&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>æ³¨å†Œç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// æ³¨å†Œå¿…é¡»çš„ç»„ä»¶å’Œç‰¹æ€§</span><br><span class="line">echarts.use([</span><br><span class="line">  TitleComponent,      // æ ‡é¢˜ç»„ä»¶</span><br><span class="line">  TooltipComponent,    // æç¤ºæ¡†ç»„ä»¶</span><br><span class="line">  GridComponent,       // ç›´è§’åæ ‡ç³»ç»„ä»¶</span><br><span class="line">  DatasetComponent,    // æ•°æ®é›†ç»„ä»¶</span><br><span class="line">  TransformComponent,  // å†…ç½®æ•°æ®è½¬æ¢å™¨ç»„ä»¶</span><br><span class="line">  BarChart,            // æŸ±çŠ¶å›¾</span><br><span class="line">  LineChart,           // æŠ˜çº¿å›¾</span><br><span class="line">  PieChart,            // é¥¼å›¾</span><br><span class="line">  LabelLayout,         // æ ‡ç­¾è‡ªåŠ¨å¸ƒå±€ç‰¹æ€§</span><br><span class="line">  UniversalTransition, // å…¨å±€è¿‡æ¸¡åŠ¨ç”»ç‰¹æ€§</span><br><span class="line">  CanvasRenderer,      // Canvas æ¸²æŸ“å™¨</span><br><span class="line">  LegendComponent,     // å›¾ä¾‹ç»„ä»¶</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h5 id="å®Œæ•´ç¤ºä¾‹æ¨¡æ¿"><a href="#å®Œæ•´ç¤ºä¾‹æ¨¡æ¿" class="headerlink" title="å®Œæ•´ç¤ºä¾‹æ¨¡æ¿"></a>å®Œæ•´ç¤ºä¾‹æ¨¡æ¿</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import &#123; onMounted &#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥ ECharts æ ¸å¿ƒæ¨¡å—</span><br><span class="line">import * as echarts from &#x27;echarts/core&#x27;;</span><br><span class="line"></span><br><span class="line">// å¼•å…¥å›¾è¡¨ç±»å‹</span><br><span class="line">import &#123; BarChart &#125; from &#x27;echarts/charts&#x27;;        // æŸ±çŠ¶å›¾</span><br><span class="line">import &#123; LineChart &#125; from &#x27;echarts/charts&#x27;;       // æŠ˜çº¿å›¾</span><br><span class="line">import &#123; PieChart &#125; from &#x27;echarts/charts&#x27;;        // é¥¼å›¾</span><br><span class="line"></span><br><span class="line">// å¼•å…¥ç»„ä»¶</span><br><span class="line">import &#123; TitleComponent &#125; from &#x27;echarts/components&#x27;;      // æ ‡é¢˜ç»„ä»¶</span><br><span class="line">import &#123; TooltipComponent &#125; from &#x27;echarts/components&#x27;;    // æç¤ºæ¡†ç»„ä»¶</span><br><span class="line">import &#123; GridComponent &#125; from &#x27;echarts/components&#x27;;       // ç›´è§’åæ ‡ç³»ç»„ä»¶</span><br><span class="line">import &#123; DatasetComponent &#125; from &#x27;echarts/components&#x27;;    // æ•°æ®é›†ç»„ä»¶</span><br><span class="line">import &#123; TransformComponent &#125; from &#x27;echarts/components&#x27;;  // å†…ç½®æ•°æ®è½¬æ¢å™¨ç»„ä»¶</span><br><span class="line">import &#123; LegendComponent &#125; from &#x27;echarts/components&#x27;;     // å›¾ä¾‹ç»„ä»¶</span><br><span class="line"></span><br><span class="line">// å¼•å…¥ç‰¹æ€§</span><br><span class="line">import &#123; LabelLayout &#125; from &#x27;echarts/features&#x27;;           // æ ‡ç­¾è‡ªåŠ¨å¸ƒå±€ç‰¹æ€§</span><br><span class="line">import &#123; UniversalTransition &#125; from &#x27;echarts/features&#x27;;   // å…¨å±€è¿‡æ¸¡åŠ¨ç”»ç‰¹æ€§</span><br><span class="line"></span><br><span class="line">// å¼•å…¥æ¸²æŸ“å™¨</span><br><span class="line">import &#123; CanvasRenderer &#125; from &#x27;echarts/renderers&#x27;;       // Canvas æ¸²æŸ“å™¨</span><br><span class="line"></span><br><span class="line">// æ³¨å†Œå¿…é¡»çš„ç»„ä»¶å’Œç‰¹æ€§</span><br><span class="line">echarts.use([</span><br><span class="line">  TitleComponent,      // æ ‡é¢˜ç»„ä»¶</span><br><span class="line">  TooltipComponent,    // æç¤ºæ¡†ç»„ä»¶</span><br><span class="line">  GridComponent,       // ç›´è§’åæ ‡ç³»ç»„ä»¶</span><br><span class="line">  DatasetComponent,    // æ•°æ®é›†ç»„ä»¶</span><br><span class="line">  TransformComponent,  // å†…ç½®æ•°æ®è½¬æ¢å™¨ç»„ä»¶</span><br><span class="line">  BarChart,            // æŸ±çŠ¶å›¾</span><br><span class="line">  LineChart,           // æŠ˜çº¿å›¾</span><br><span class="line">  PieChart,            // é¥¼å›¾</span><br><span class="line">  LabelLayout,         // æ ‡ç­¾è‡ªåŠ¨å¸ƒå±€ç‰¹æ€§</span><br><span class="line">  UniversalTransition, // å…¨å±€è¿‡æ¸¡åŠ¨ç”»ç‰¹æ€§</span><br><span class="line">  CanvasRenderer,      // Canvas æ¸²æŸ“å™¨</span><br><span class="line">  LegendComponent,     // å›¾ä¾‹ç»„ä»¶</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p>å®¹å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">        &lt;div id=&quot;main&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>æ ·å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#main &#123;</span><br><span class="line">    width: 600px;</span><br><span class="line">    height: 400px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>å¼•å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import &#123; onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">// å¼•å…¥ echarts æ ¸å¿ƒæ¨¡å—ï¼Œæ ¸å¿ƒæ¨¡å—æä¾›äº† echarts ä½¿ç”¨å¿…é¡»è¦çš„æ¥å£ã€‚</span><br><span class="line">import * as echarts from &#x27;echarts/core&#x27;</span><br><span class="line">// å¼•å…¥æŸ±çŠ¶å›¾å›¾è¡¨ï¼Œå›¾è¡¨åç¼€éƒ½ä¸º Chart</span><br><span class="line">import &#123; BarChart &#125; from &#x27;echarts/charts&#x27;</span><br><span class="line">// å¼•å…¥æ ‡é¢˜ï¼Œæç¤ºæ¡†ï¼Œç›´è§’åæ ‡ç³»ï¼Œæ•°æ®é›†ï¼Œå†…ç½®æ•°æ®è½¬æ¢å™¨ç»„ä»¶ï¼Œç»„ä»¶åç¼€éƒ½ä¸º Component</span><br><span class="line">import &#123;</span><br><span class="line">TitleComponent,</span><br><span class="line">TooltipComponent,</span><br><span class="line">GridComponent,</span><br><span class="line">DatasetComponent,</span><br><span class="line">TransformComponent,</span><br><span class="line">&#125; from &#x27;echarts/components&#x27;</span><br><span class="line">// æ ‡ç­¾è‡ªåŠ¨å¸ƒå±€ã€å…¨å±€è¿‡æ¸¡åŠ¨ç”»ç­‰ç‰¹æ€§</span><br><span class="line">import &#123; LabelLayout, UniversalTransition &#125; from &#x27;echarts/features&#x27;</span><br><span class="line">// å¼•å…¥ Canvas æ¸²æŸ“å™¨ï¼Œæ³¨æ„å¼•å…¥ CanvasRenderer æˆ–è€… SVGRenderer æ˜¯å¿…é¡»çš„ä¸€æ­¥</span><br><span class="line">import &#123; CanvasRenderer &#125; from &#x27;echarts/renderers&#x27;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>æ³¨å†Œç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">echarts.use([</span><br><span class="line">    TitleComponent,</span><br><span class="line">    TooltipComponent,</span><br><span class="line">    GridComponent,</span><br><span class="line">    DatasetComponent,</span><br><span class="line">    TransformComponent,</span><br><span class="line">    BarChart,</span><br><span class="line">    LabelLayout,</span><br><span class="line">    UniversalTransition,</span><br><span class="line">    CanvasRenderer,</span><br><span class="line">])</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h3 id="å›¾è¡¨é…ç½®"><a href="#å›¾è¡¨é…ç½®" class="headerlink" title="å›¾è¡¨é…ç½®"></a>å›¾è¡¨é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">    // åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹</span><br><span class="line">    const myChart = echarts.init(document.getElementById(&#x27;main&#x27;))</span><br><span class="line"></span><br><span class="line">    // é¢œè‰²æ•°ç»„</span><br><span class="line">    let colors = [</span><br><span class="line">        &#x27;#5470c6&#x27;,</span><br><span class="line">        &#x27;#91cc75&#x27;,</span><br><span class="line">        &#x27;#fac858&#x27;,</span><br><span class="line">        &#x27;#ee6666&#x27;,</span><br><span class="line">        &#x27;#73c0de&#x27;,</span><br><span class="line">        &#x27;#3ba272&#x27;,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    const option = &#123;</span><br><span class="line">        // æ ‡é¢˜</span><br><span class="line">        title: &#123;</span><br><span class="line">            text: &#x27;ECharts å…¥é—¨ç¤ºä¾‹&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">        // æç¤ºæ¡†</span><br><span class="line">        tooltip: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">        // xè½´</span><br><span class="line">        xAxis: &#123;</span><br><span class="line">            data: [&#x27;è¡¬è¡«&#x27;, &#x27;ç¾Šæ¯›è¡«&#x27;, &#x27;é›ªçººè¡«&#x27;, &#x27;è£¤å­&#x27;, &#x27;é«˜è·Ÿé‹&#x27;, &#x27;è¢œå­&#x27;],</span><br><span class="line">        &#125;,</span><br><span class="line">        // yè½´</span><br><span class="line">        yAxis: &#123;</span><br><span class="line">            data: [&#x27;0&#x27;, &#x27;50&#x27;, &#x27;100&#x27;, &#x27;150&#x27;, &#x27;200&#x27;, &#x27;250&#x27;],</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        // æ•°æ®ç³»åˆ—</span><br><span class="line">        series: [</span><br><span class="line">            &#123;</span><br><span class="line">                name: &#x27;é”€é‡&#x27;,</span><br><span class="line">                type: &#x27;bar&#x27;,</span><br><span class="line">                data: [5, 20, 36, 10, 10, 20],</span><br><span class="line">                itemStyle: &#123;</span><br><span class="line">                    color: (params) =&gt; colors[params.dataIndex] || &#x27;#fac858&#x27;,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //lodingé¢„åŠ è½½</span><br><span class="line">    myChart.showLoading()</span><br><span class="line">    $.get(&#x27;data.json&#x27;).done(function () &#123;</span><br><span class="line">        myChart.hideLoading()</span><br><span class="line">        myChart.setOption(option)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    myChart.setOption(option)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h3 id="æ‹†åˆ†ç»„ä»¶"><a href="#æ‹†åˆ†ç»„ä»¶" class="headerlink" title="æ‹†åˆ†ç»„ä»¶"></a>æ‹†åˆ†ç»„ä»¶</h3><h4 id="series-å›¾è¡¨"><a href="#series-å›¾è¡¨" class="headerlink" title="series &#x2F; å›¾è¡¨"></a>series &#x2F; å›¾è¡¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">series: [</span><br><span class="line">    &#123;</span><br><span class="line">        name: &#x27;é”€é‡&#x27;,//å•ä½é‡</span><br><span class="line">        type: &#x27;bar&#x27;,//å›¾è¡¨ç±»å‹</span><br><span class="line">        data: [5, 20, 36, 10, 10, 20],//å›¾è¡¨æ•°æ®</span><br><span class="line">        itemStyle: &#123;//æ ·å¼é…ç½®</span><br><span class="line">            color: (params) =&gt; option.color[params.dataIndex] || &#x27;#fac858&#x27;, // ä½¿ç”¨å…¨å±€é¢œè‰²</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h5 id="type-ç±»å‹"><a href="#type-ç±»å‹" class="headerlink" title="type &#x2F; ç±»å‹"></a>type &#x2F; ç±»å‹</h5><h6 id="æŸ±çŠ¶å›¾ï¼ˆbarï¼‰"><a href="#æŸ±çŠ¶å›¾ï¼ˆbarï¼‰" class="headerlink" title="æŸ±çŠ¶å›¾ï¼ˆbarï¼‰"></a>æŸ±çŠ¶å›¾ï¼ˆ<code>bar</code>ï¼‰</h6><p>éœ€æ±‚</p><ul><li><strong>åæ ‡è½´</strong>ï¼šéœ€è¦ <code>xAxis</code> å’Œ <code>yAxis</code> é…ç½®ã€‚</li><li><strong>æ•°æ®æ ¼å¼</strong>ï¼šæ•°æ®é€šå¸¸æ˜¯ç®€å•çš„æ•°å€¼æ•°ç»„æˆ–å¯¹è±¡æ•°ç»„ã€‚</li><li><strong>å…¶ä»–é…ç½®</strong>ï¼šå¯ä»¥æ·»åŠ  <code>tooltip</code>ã€<code>title</code>ã€<code>legend</code> ç­‰ç»„ä»¶æ¥å¢å¼ºå›¾è¡¨çš„å¯è¯»æ€§å’Œäº¤äº’æ€§ã€‚</li></ul><p>é…ç½®ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: &#x27;ECharts é”€é‡ç»Ÿè®¡&#x27;,</span><br><span class="line">    subtext: &#x27;ç¤ºä¾‹æ•°æ®&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;</span><br><span class="line">    trigger: &#x27;axis&#x27;, // è§¦å‘ç±»å‹ä¸ºåæ ‡è½´è§¦å‘</span><br><span class="line">  &#125;,</span><br><span class="line">  xAxis: &#123;</span><br><span class="line">    type: &#x27;category&#x27;, // ç±»ç›®è½´</span><br><span class="line">    data: [&#x27;è¡¬è¡«&#x27;, &#x27;ç¾Šæ¯›è¡«&#x27;, &#x27;é›ªçººè¡«&#x27;, &#x27;è£¤å­&#x27;, &#x27;é«˜è·Ÿé‹&#x27;, &#x27;è¢œå­&#x27;], // xè½´æ•°æ®</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">      fontSize: 14,  // æ ‡ç­¾å­—ä½“å¤§å°</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        color: &#x27;#ccc&#x27;, // è½´çº¿é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    axisTick: &#123;</span><br><span class="line">      show: false, // æ˜¯å¦æ˜¾ç¤ºåˆ»åº¦çº¿</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  yAxis: &#123;</span><br><span class="line">    type: &#x27;value&#x27;, // æ•°å€¼è½´</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">      formatter: &#x27;&#123;value&#125; ä»¶&#x27;, // æ ‡ç­¾æ ¼å¼åŒ–</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      show: false, // æ˜¯å¦æ˜¾ç¤ºè½´çº¿</span><br><span class="line">    &#125;,</span><br><span class="line">    splitLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        type: &#x27;dashed&#x27;, // åˆ†å‰²çº¿æ ·å¼</span><br><span class="line">        color: &#x27;#eee&#x27;,  // åˆ†å‰²çº¿é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;é”€é‡&#x27;,</span><br><span class="line">      type: &#x27;bar&#x27;, // æŸ±çŠ¶å›¾</span><br><span class="line">      data: [5, 20, 36, 10, 10, 20], // æ•°æ®</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: (params) =&gt; [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;][params.dataIndex] || &#x27;#fac858&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h6 id="æŠ˜çº¿å›¾ï¼ˆlineï¼‰"><a href="#æŠ˜çº¿å›¾ï¼ˆlineï¼‰" class="headerlink" title="æŠ˜çº¿å›¾ï¼ˆlineï¼‰"></a>æŠ˜çº¿å›¾ï¼ˆ<code>line</code>ï¼‰</h6><p>éœ€æ±‚</p><ul><li><strong>åæ ‡è½´</strong>ï¼šéœ€è¦ <code>xAxis</code> å’Œ <code>yAxis</code> é…ç½®ã€‚</li><li><strong>æ•°æ®æ ¼å¼</strong>ï¼šæ•°æ®é€šå¸¸æ˜¯ç®€å•çš„æ•°å€¼æ•°ç»„æˆ–å¯¹è±¡æ•°ç»„ã€‚</li><li><strong>å…¶ä»–é…ç½®</strong>ï¼šå¯ä»¥æ·»åŠ  <code>tooltip</code>ã€<code>title</code>ã€<code>legend</code> ç­‰ç»„ä»¶æ¥å¢å¼ºå›¾è¡¨çš„å¯è¯»æ€§å’Œäº¤äº’æ€§ã€‚</li></ul><p>é…ç½®ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: &#x27;ECharts é”€é‡è¶‹åŠ¿&#x27;,</span><br><span class="line">    subtext: &#x27;ç¤ºä¾‹æ•°æ®&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;</span><br><span class="line">    trigger: &#x27;axis&#x27;, // è§¦å‘ç±»å‹ä¸ºåæ ‡è½´è§¦å‘</span><br><span class="line">  &#125;,</span><br><span class="line">  xAxis: &#123;</span><br><span class="line">    type: &#x27;category&#x27;, // ç±»ç›®è½´</span><br><span class="line">    data: [&#x27;è¡¬è¡«&#x27;, &#x27;ç¾Šæ¯›è¡«&#x27;, &#x27;é›ªçººè¡«&#x27;, &#x27;è£¤å­&#x27;, &#x27;é«˜è·Ÿé‹&#x27;, &#x27;è¢œå­&#x27;], // xè½´æ•°æ®</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">      fontSize: 14,  // æ ‡ç­¾å­—ä½“å¤§å°</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        color: &#x27;#ccc&#x27;, // è½´çº¿é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    axisTick: &#123;</span><br><span class="line">      show: false, // æ˜¯å¦æ˜¾ç¤ºåˆ»åº¦çº¿</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  yAxis: &#123;</span><br><span class="line">    type: &#x27;value&#x27;, // æ•°å€¼è½´</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">      formatter: &#x27;&#123;value&#125; ä»¶&#x27;, // æ ‡ç­¾æ ¼å¼åŒ–</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      show: false, // æ˜¯å¦æ˜¾ç¤ºè½´çº¿</span><br><span class="line">    &#125;,</span><br><span class="line">    splitLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        type: &#x27;dashed&#x27;, // åˆ†å‰²çº¿æ ·å¼</span><br><span class="line">        color: &#x27;#eee&#x27;,  // åˆ†å‰²çº¿é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;é”€é‡&#x27;,</span><br><span class="line">      type: &#x27;line&#x27;, // æŠ˜çº¿å›¾</span><br><span class="line">      data: [5, 20, 36, 10, 10, 20], // æ•°æ®</span><br><span class="line">      smooth: true, // å¹³æ»‘æ›²çº¿</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: &#x27;#5470c6&#x27;, // çº¿æ¡é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h6 id="é¥¼å›¾ï¼ˆpieï¼‰"><a href="#é¥¼å›¾ï¼ˆpieï¼‰" class="headerlink" title="é¥¼å›¾ï¼ˆpieï¼‰"></a>é¥¼å›¾ï¼ˆ<code>pie</code>ï¼‰</h6><p>éœ€æ±‚</p><ul><li><strong>åæ ‡è½´</strong>ï¼šä¸éœ€è¦ <code>xAxis</code> å’Œ <code>yAxis</code>ï¼Œå› ä¸ºé¥¼å›¾æ˜¯åŸºäºåœ†å½¢çš„ã€‚</li><li><strong>æ•°æ®æ ¼å¼</strong>ï¼šæ•°æ®é€šå¸¸æ˜¯åŒ…å« <code>value</code> å’Œ <code>name</code> çš„å¯¹è±¡æ•°ç»„ã€‚</li><li><strong>å…¶ä»–é…ç½®</strong>ï¼šå¯ä»¥æ·»åŠ  <code>tooltip</code>ã€<code>title</code>ã€<code>legend</code> ç­‰ç»„ä»¶æ¥å¢å¼ºå›¾è¡¨çš„å¯è¯»æ€§å’Œäº¤äº’æ€§ã€‚</li></ul><p>é…ç½®ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: &#x27;ECharts é”€é‡åˆ†å¸ƒ&#x27;,</span><br><span class="line">    subtext: &#x27;ç¤ºä¾‹æ•°æ®&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;</span><br><span class="line">    trigger: &#x27;item&#x27;, // è§¦å‘ç±»å‹ä¸ºå•ä¸ªæ•°æ®ç‚¹è§¦å‘</span><br><span class="line">  &#125;,</span><br><span class="line">  legend: &#123;</span><br><span class="line">    orient: &#x27;vertical&#x27;, // å›¾ä¾‹æ–¹å‘</span><br><span class="line">    left: &#x27;left&#x27;,       // å›¾ä¾‹ä½ç½®</span><br><span class="line">  &#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;é”€é‡&#x27;,</span><br><span class="line">      type: &#x27;pie&#x27;, // é¥¼å›¾</span><br><span class="line">      radius: &#x27;50%&#x27;, // é¥¼å›¾çš„åŠå¾„</span><br><span class="line">      data: [</span><br><span class="line">        &#123; value: 5, name: &#x27;è¡¬è¡«&#x27; &#125;,</span><br><span class="line">        &#123; value: 20, name: &#x27;ç¾Šæ¯›è¡«&#x27; &#125;,</span><br><span class="line">        &#123; value: 36, name: &#x27;é›ªçººè¡«&#x27; &#125;,</span><br><span class="line">        &#123; value: 10, name: &#x27;è£¤å­&#x27; &#125;,</span><br><span class="line">        &#123; value: 10, name: &#x27;é«˜è·Ÿé‹&#x27; &#125;,</span><br><span class="line">        &#123; value: 20, name: &#x27;è¢œå­&#x27; &#125;,</span><br><span class="line">      ], // æ•°æ®</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: (params) =&gt; [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;][params.dataIndex] || &#x27;#fac858&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h6 id="æ•£ç‚¹å›¾ï¼ˆscatterï¼‰"><a href="#æ•£ç‚¹å›¾ï¼ˆscatterï¼‰" class="headerlink" title="æ•£ç‚¹å›¾ï¼ˆscatterï¼‰"></a>æ•£ç‚¹å›¾ï¼ˆ<code>scatter</code>ï¼‰</h6><p>éœ€æ±‚</p><ul><li><strong>åæ ‡è½´</strong>ï¼šéœ€è¦ <code>xAxis</code> å’Œ <code>yAxis</code> é…ç½®ã€‚</li><li><strong>æ•°æ®æ ¼å¼</strong>ï¼šæ•°æ®é€šå¸¸æ˜¯äºŒç»´æ•°ç»„ï¼Œæ¯ä¸ªæ•°æ®ç‚¹åŒ…å«ä¸¤ä¸ªå€¼ <code>[x, y]</code>ã€‚</li><li><strong>å…¶ä»–é…ç½®</strong>ï¼šå¯ä»¥æ·»åŠ  <code>tooltip</code>ã€<code>title</code>ã€<code>legend</code> ç­‰ç»„ä»¶æ¥å¢å¼ºå›¾è¡¨çš„å¯è¯»æ€§å’Œäº¤äº’æ€§ã€‚</li></ul><p>é…ç½®ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    text: &#x27;ECharts æ•£ç‚¹å›¾ç¤ºä¾‹&#x27;,</span><br><span class="line">    subtext: &#x27;éšæœºç”Ÿæˆçš„æ•°æ®&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  tooltip: &#123;</span><br><span class="line">    trigger: &#x27;item&#x27;, // è§¦å‘ç±»å‹ä¸ºå•ä¸ªæ•°æ®ç‚¹è§¦å‘</span><br><span class="line">  &#125;,</span><br><span class="line">  xAxis: &#123;</span><br><span class="line">    type: &#x27;value&#x27;, // æ•°å€¼è½´</span><br><span class="line">    name: &#x27;Xè½´&#x27;,</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">      fontSize: 14,  // æ ‡ç­¾å­—ä½“å¤§å°</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        color: &#x27;#ccc&#x27;, // è½´çº¿é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  yAxis: &#123;</span><br><span class="line">    type: &#x27;value&#x27;, // æ•°å€¼è½´</span><br><span class="line">    name: &#x27;Yè½´&#x27;,</span><br><span class="line">    axisLabel: &#123;</span><br><span class="line">      color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">      fontSize: 14,  // æ ‡ç­¾å­—ä½“å¤§å°</span><br><span class="line">    &#125;,</span><br><span class="line">    axisLine: &#123;</span><br><span class="line">      lineStyle: &#123;</span><br><span class="line">        color: &#x27;#ccc&#x27;, // è½´çº¿é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;æ•£ç‚¹&#x27;,</span><br><span class="line">      type: &#x27;scatter&#x27;, // æ•£ç‚¹å›¾</span><br><span class="line">      data: [</span><br><span class="line">        [10, 20],</span><br><span class="line">        [20, 30],</span><br><span class="line">        [30, 40],</span><br><span class="line">        [40, 50],</span><br><span class="line">        [50, 60],</span><br><span class="line">        [60, 70],</span><br><span class="line">      ], // æ•°æ®</span><br><span class="line">      symbolSize: 20, // æ•£ç‚¹å¤§å°</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: &#x27;#5470c6&#x27;, // æ•£ç‚¹é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h5 id="itemStyle-æ ·å¼"><a href="#itemStyle-æ ·å¼" class="headerlink" title="itemStyle &#x2F; æ ·å¼"></a>itemStyle &#x2F; æ ·å¼</h5><p>ï¼æ³¨æ„ï¼šé¢œè‰²çš„é…ç½®åªèƒ½åœ¨</p><p><strong>1.series å¤–ï¼ˆå…¨å±€ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const option = &#123;</span><br><span class="line">  // ... å…¶ä»–é…ç½®</span><br><span class="line">  color: [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;], // å…¨å±€é¢œè‰²</span><br><span class="line">  series: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#x27;é”€é‡&#x27;,</span><br><span class="line">      type: &#x27;bar&#x27;,</span><br><span class="line">      data: [5, 20, 36, 10, 10, 20],</span><br><span class="line">      itemStyle: &#123;</span><br><span class="line">        color: (params) =&gt; option.color[params.dataIndex] || &#x27;#fac858&#x27;, // ä½¿ç”¨å…¨å±€é¢œè‰²</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  // ... å…¶ä»–é…ç½®</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p><strong>2.<code>itemStyle</code> å†…éƒ¨ï¼ˆå±€éƒ¨ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">series: [</span><br><span class="line">  &#123;</span><br><span class="line">    name: &#x27;é”€é‡&#x27;,</span><br><span class="line">    type: &#x27;bar&#x27;,</span><br><span class="line">    data: [5, 20, 36, 10, 10, 20],</span><br><span class="line">    itemStyle: &#123;</span><br><span class="line">      color: (params) =&gt; &#123;</span><br><span class="line">        const colors = [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;];</span><br><span class="line">        return colors[params.dataIndex] || &#x27;#fac858&#x27;; // ç›´æ¥ä½¿ç”¨æœ¬åœ°å®šä¹‰çš„ colors æ•°ç»„</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p><strong><em>ä¸èƒ½åœ¨ series ä¸­é…ç½®é¢œè‰²æ•°ç»„</em></strong></p><p>æ¸å˜è‰²ï¼ˆå†…éƒ¨é…ç½®ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">itemStyle: &#123;</span><br><span class="line">    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [</span><br><span class="line">        &#123; offset: 0, color: &#x27;#5470c6&#x27; &#125;,</span><br><span class="line">        &#123; offset: 0.2, color: &#x27;#91cc75&#x27; &#125;,</span><br><span class="line">        &#123; offset: 0.5, color: &#x27;#91cc75&#x27; &#125;,</span><br><span class="line">        &#123; offset: 0.7, color: &#x27;#fac858&#x27; &#125;,</span><br><span class="line">        &#123; offset: 1, color: &#x27;#91cc75&#x27; &#125;,</span><br><span class="line">    ]),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="title-æ ‡é¢˜"><a href="#title-æ ‡é¢˜" class="headerlink" title="title | æ ‡é¢˜"></a>title | æ ‡é¢˜</h4><p>è‡ªå®šä¹‰æ ‡é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">title: &#123;</span><br><span class="line">    text: &#x27;ECharts é”€é‡ç»Ÿè®¡&#x27;,</span><br><span class="line">    subtext: &#x27;ç¤ºä¾‹æ•°æ®&#x27;,</span><br><span class="line">    left: &#x27;center&#x27;,</span><br><span class="line">    textStyle: &#123;</span><br><span class="line">       fontSize: 20,</span><br><span class="line">       color: &#x27;#333&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="color-é¢œè‰²"><a href="#color-é¢œè‰²" class="headerlink" title="color | é¢œè‰²"></a>color | é¢œè‰²</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">color: [&#x27;#5470c6&#x27;, &#x27;#91cc75&#x27;, &#x27;#fac858&#x27;, &#x27;#ee6666&#x27;, &#x27;#73c0de&#x27;, &#x27;#3ba272&#x27;], // å…¨å±€é¢œè‰²</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="tooltip-æç¤ºæ¡†"><a href="#tooltip-æç¤ºæ¡†" class="headerlink" title="tooltip | æç¤ºæ¡†"></a>tooltip | æç¤ºæ¡†</h4><p>è‡ªå®šä¹‰æç¤ºæ¡†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tooltip: &#123;</span><br><span class="line">  trigger: &#x27;axis&#x27;, // è§¦å‘ç±»å‹ï¼Œå¯ä»¥æ˜¯ &#x27;item&#x27; æˆ– &#x27;axis&#x27;</span><br><span class="line">  axisPointer: &#123;</span><br><span class="line">    type: &#x27;shadow&#x27;, // é»˜è®¤ä¸º &#x27;line&#x27;ï¼Œä¹Ÿå¯ä»¥æ˜¯ &#x27;shadow&#x27; æˆ– &#x27;cross&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  formatter: function (params) &#123;</span><br><span class="line">    return `$&#123;params[0].name&#125;: $&#123;params[0].value&#125;`;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="x-yAxis-åæ ‡è½´"><a href="#x-yAxis-åæ ‡è½´" class="headerlink" title="x&#x2F;yAxis | åæ ‡è½´"></a>x&#x2F;yAxis | åæ ‡è½´</h4><p>é€‚ç”¨äº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æŸ±çŠ¶å›¾ bar</span><br><span class="line">æŠ˜çº¿å›¾ line</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>åæ ‡è½´æ ·å¼</p><p>è‡ªå®šä¹‰ x è½´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">xAxis: &#123;</span><br><span class="line">  type: &#x27;category&#x27;,</span><br><span class="line">  data: [&#x27;è¡¬è¡«&#x27;, &#x27;ç¾Šæ¯›è¡«&#x27;, &#x27;é›ªçººè¡«&#x27;, &#x27;è£¤å­&#x27;, &#x27;é«˜è·Ÿé‹&#x27;, &#x27;è¢œå­&#x27;],</span><br><span class="line">  axisLabel: &#123;</span><br><span class="line">    color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">    fontSize: 14,  // æ ‡ç­¾å­—ä½“å¤§å°</span><br><span class="line">  &#125;,</span><br><span class="line">  axisLine: &#123;</span><br><span class="line">    lineStyle: &#123;</span><br><span class="line">      color: &#x27;#ccc&#x27;, // è½´çº¿é¢œè‰²</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  axisTick: &#123;</span><br><span class="line">    show: false, // æ˜¯å¦æ˜¾ç¤ºåˆ»åº¦çº¿</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>è‡ªå®šä¹‰ y è½´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">yAxis: &#123;</span><br><span class="line">  type: &#x27;value&#x27;,</span><br><span class="line">  axisLabel: &#123;</span><br><span class="line">    color: &#x27;#333&#x27;, // æ ‡ç­¾é¢œè‰²</span><br><span class="line">    formatter: &#x27;&#123;value&#125; ä»¶&#x27;, // æ ‡ç­¾æ ¼å¼åŒ–</span><br><span class="line">  &#125;,</span><br><span class="line">  axisLine: &#123;</span><br><span class="line">    show: false, // æ˜¯å¦æ˜¾ç¤ºè½´çº¿</span><br><span class="line">  &#125;,</span><br><span class="line">  splitLine: &#123;</span><br><span class="line">    lineStyle: &#123;</span><br><span class="line">      type: &#x27;dashed&#x27;, // åˆ†å‰²çº¿æ ·å¼</span><br><span class="line">      color: &#x27;#eee&#x27;,  // åˆ†å‰²çº¿é¢œè‰²</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="animation-åŠ¨ç”»"><a href="#animation-åŠ¨ç”»" class="headerlink" title="animation | åŠ¨ç”»"></a>animation | åŠ¨ç”»</h4><p>åŠ¨ç”»æ ·å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">animation: true, // æ˜¯å¦å¼€å¯åŠ¨ç”»</span><br><span class="line">animationDuration: 1000, // åŠ¨ç”»æŒç»­æ—¶é—´</span><br><span class="line">animationEasing: &#x27;elasticOut&#x27;, // åŠ¨ç”»ç¼“åŠ¨æ•ˆæœ</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h3 id="å…¶ä»–é…ç½®"><a href="#å…¶ä»–é…ç½®" class="headerlink" title="å…¶ä»–é…ç½®"></a>å…¶ä»–é…ç½®</h3><h4 id="loding-é¢„åŠ è½½"><a href="#loding-é¢„åŠ è½½" class="headerlink" title="loding | é¢„åŠ è½½"></a>loding | é¢„åŠ è½½</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm i --save-dev @types/jquery</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myChart.showLoading()</span><br><span class="line">$.get(&#x27;data.json&#x27;).done(function (data) &#123;</span><br><span class="line">    myChart.hideLoading()</span><br><span class="line">    myChart.setOption(option)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é”®ç›˜ä¹±é”®é—®é¢˜è§£å†³</title>
      <link href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E9%94%AE%E7%9B%98%E4%B9%B1%E9%94%AE%E9%97%AE%E9%A2%98/"/>
      <url>/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E9%94%AE%E7%9B%98%E4%B9%B1%E9%94%AE%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="é”®ç›˜ä¹±é”®é—®é¢˜"><a href="#é”®ç›˜ä¹±é”®é—®é¢˜" class="headerlink" title="é”®ç›˜ä¹±é”®é—®é¢˜"></a>é”®ç›˜ä¹±é”®é—®é¢˜</h1><p><strong>çœŸçš„å¾ˆå´©æºƒï¼Œæœºæ¢°é”®ç›˜çš„ä¹±é”®é—®é¢˜å±…ç„¶è¿˜èƒ½è¿å¸¦åˆ°æœ¬æœºçš„é”®ç›˜ä¸ŠğŸ˜…</strong></p><p><strong>æœ€åå‘ç°æ­¥éª¤å…¶å®å¾ˆç®€å•ï¼Œç„¶åæˆ‘ä¹±ä¿®äº†ä¸¤ä¸ªå°æ—¶ğŸ™ƒ</strong></p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><p><strong>æœºæ¢°+æœ¬æœºé”®ç›˜å‡ºå‚è®¾ç½®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fn + esc é•¿æŒ‰äº”ç§’ä»¥ä¸Š</span><br></pre></td></tr></table></figure><p><strong>é‡å¯ç”µè„‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿˜æœ‰æˆ‘ç”µè„‘å¼€æœºæ˜¯æœ‰ä¸€ä¸ªé”®ç›˜é©±åŠ¨é€‰é¡¹çš„ï¼Œç›´æ¥ç»™æ‹’äº†</span><br></pre></td></tr></table></figure><p><strong>é‡æ–°é…ç½®æœºæ¢°é”®ç›˜ï¼ˆè“ç‰™å•Šå•¥çš„ï¼‰</strong></p>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BFCä¸IFC</title>
      <link href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8A%E4%B8%8B%E6%96%87--BFC%E4%B8%8EIFC/"/>
      <url>/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8A%E4%B8%8B%E6%96%87--BFC%E4%B8%8EIFC/</url>
      
        <content type="html"><![CDATA[<h3 id="ç›’å­"><a href="#ç›’å­" class="headerlink" title="ç›’å­"></a>ç›’å­</h3><h5 id="æ ¼å¼åŒ–ä¸Šä¸‹æ–‡"><a href="#æ ¼å¼åŒ–ä¸Šä¸‹æ–‡" class="headerlink" title="æ ¼å¼åŒ–ä¸Šä¸‹æ–‡"></a>æ ¼å¼åŒ–ä¸Šä¸‹æ–‡</h5><p><strong>å¤–éƒ¨æ˜¾ç¤ºç±»å‹ï¼ˆdisplay-outsideï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è§„å®šç›’å­å¦‚ä½•ä¸ç»Ÿä¸€æ ¼å¼ä¸Šä¸‹æ–‡ä¸­çš„å…¶ä»–å…ƒç´ ä¸€èµ·æ˜¾ç¤º</span><br></pre></td></tr></table></figure><p><strong>å†…éƒ¨æ˜¾ç¤ºç±»å‹ï¼ˆ display-inside  ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è§„å®šç›’å­å†…éƒ¨å¸ƒå±€æ–¹å¼ï¼Œæ¯”å¦‚</span><br><span class="line">display:    flex    (å¤–éƒ¨æ˜¾ç¤ºä¸ºblock ) å‚ä¸BFCï¼ˆå—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰</span><br><span class="line">display:inline-flex (å¤–éƒ¨æ˜¾ç¤ºä¸ºinline) å‚ä¸IFCï¼ˆå†…è”çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰</span><br></pre></td></tr></table></figure><h5 id="BFC"><a href="#BFC" class="headerlink" title="BFC"></a>BFC</h5><p><strong>å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡</strong></p><p><em><strong>FC</strong></em>ï¼ˆFormatting Contextï¼‰ï¼ˆ<em><strong>æ ¼å¼åŒ–ä¸Šä¸‹æ–‡</strong></em>ï¼‰</p><p><strong>æ‰€æœ‰çš„ç›’å­éƒ½å±äºFC</strong></p><p><strong>å¯èƒ½å±äºä¸€ä¸ªBFCï¼ˆblockï¼‰(div&#x2F;p&#x2F;h1)ã€ä¹Ÿå¯èƒ½æ˜¯IFCï¼ˆinlineï¼‰(a&#x2F;span&#x2F;i&#x2F;img)</strong></p><h6 id="ä¼šç”ŸæˆBFCçš„æƒ…å†µ"><a href="#ä¼šç”ŸæˆBFCçš„æƒ…å†µ" class="headerlink" title="ä¼šç”ŸæˆBFCçš„æƒ…å†µ"></a><strong>ä¼šç”ŸæˆBFCçš„æƒ…å†µ</strong></h6><p><img src="/upload/image-20241104160610394.png" alt="image-20241104160610394.png"></p><h6 id="BFCçš„ä½œç”¨"><a href="#BFCçš„ä½œç”¨" class="headerlink" title="BFCçš„ä½œç”¨"></a><strong>BFCçš„ä½œç”¨</strong></h6><p><strong>å¸®åŠ©ç›’å­ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªæ²¿ç€å‚ç›´æ–¹å‘æ’å¸ƒ</strong></p><p><strong>marginå°±æ˜¯ç”±BFCæ¥è§£æçš„</strong></p><p><strong>ä¸¤ä¸ªç›’å­éƒ½è®¾ç½®marginæ—¶å€™ä¼šæŠ˜å ï¼Œå°±æ˜¯BFCåœ¨èµ·ä½œç”¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨åŒä¸€ä¸ªBFCé‡Œï¼Œä¸¤ä¸ªç›’å­çš„marginæ‰ä¼šæŠ˜å </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTMLå¯ä»¥å½¢æˆæ ‡å‡†æµï¼Œå› ä¸ºæœ¬èº«å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„BFCç¯å¢ƒ</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨BFCä¸­ï¼Œæ¯ä¸ªå…ƒç´ çš„å·¦è¾¹ç¼˜æ˜¯ç´§æŒ¨ç€åŒ…å«å—çš„å·¦è¾¹ç¼˜çš„</span><br></pre></td></tr></table></figure><p><strong>BFCå¯ä»¥è§£å†³</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">marginçš„æŠ˜å é—®é¢˜</span><br><span class="line">æµ®åŠ¨çš„é«˜åº¦å¡Œé™·é—®é¢˜</span><br></pre></td></tr></table></figure><h6 id="å½¢æˆæ–°çš„BFC"><a href="#å½¢æˆæ–°çš„BFC" class="headerlink" title="å½¢æˆæ–°çš„BFC"></a>å½¢æˆæ–°çš„BFC</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//åªè¦overflow: !!ä¸æ˜¯!! visible</span><br><span class="line">å¯ä»¥æ˜¯ auto/hidden/scroll</span><br></pre></td></tr></table></figure><p><strong>è§£å†³æŠ˜å é—®é¢˜</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//çˆ¶çº§åŒ…è£¹ä¸¤ä¸ªå…ƒç´ </span><br><span class="line">div content</span><br><span class="line">    div item</span><br><span class="line">    div item</span><br><span class="line">div</span><br><span class="line">//cssåˆ›å»ºBFC</span><br><span class="line">.content&#123;</span><br><span class="line">    overflow: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è§£å†³æµ®åŠ¨é«˜åº¦å¡Œé™·</strong></p><p><strong>æ¡ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//çˆ¶å…ƒç´ è§¦å‘BFCï¼Œå½¢æˆç‹¬ç«‹å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡</span><br><span class="line">//çˆ¶å…ƒç´ é«˜åº¦ä¸ºauto</span><br></pre></td></tr></table></figure><p><em>BFCçš„è®¡ç®—æ–¹å¼</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.å¦‚æœåªæœ‰inline-levelï¼Œæ˜¯è¡Œé«˜çš„é¡¶éƒ¨å’Œåº•éƒ¨çš„è·ç¦»</span><br><span class="line">2.å¦‚æœæœ‰block-levelï¼Œæ˜¯ç”±æœ€åº•å±‚çš„å—ä¸Šè¾¹ç¼˜å’Œæœ€åº•å±‚å—ç›’å­çš„ä¸‹è¾¹ç¼˜ä¹‹é—´çš„è·ç¦»</span><br><span class="line">3.å¦‚æœæœ‰ç»å¯¹å®šä½å…ƒç´ ï¼Œå°†è¢«å¿½ç•¥;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4.å¦‚æœæœ‰æµ®åŠ¨å…ƒç´ ï¼Œé‚£ä¹ˆä¼šå¢åŠ é«˜åº¦ä»¥åŒ…æ‹¬è¿™äº›æµ®åŠ¨å…ƒç´ çš„ä¸‹è¾¹ç¼˜</span><br></pre></td></tr></table></figure><h6 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">overflow: visible;  //å¯è§</span><br><span class="line">overflow: hidden;   //éšè—(å¯æ»šåŠ¨çš„å®¹å™¨)</span><br><span class="line">overflow: clip;     //å‰ªè¾‘(ç¦æ­¢æ»šåŠ¨)</span><br><span class="line">overflow: scroll;   //æ»šåŠ¨(æµè§ˆå™¨æ€»æ˜¯æ˜¾ç¤ºæ»šåŠ¨æ¡)</span><br><span class="line">overflow: auto;     //è‡ªåŠ¨(å¦‚æœå†…å®¹æº¢å‡ºï¼Œåˆ™æµè§ˆå™¨æä¾›æ»šåŠ¨æ¡)</span><br><span class="line">overflow: hidden;   //è¦†ç›–(æ»šåŠ¨æ¡ç»˜åˆ¶åœ¨å†…å®¹ä¹‹ä¸Šï¼Œè€Œä¸æ˜¯å æ®ç©ºé—´)</span><br></pre></td></tr></table></figure><h5 id="IFC"><a href="#IFC" class="headerlink" title="IFC"></a>IFC</h5><p><strong>å†…è”çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç›’å­ä¼šä»åŒ…å«å—çš„é¡¶éƒ¨å¼€å§‹ï¼ŒæŒ‰æ°´å¹³æ’åˆ—</span><br><span class="line">è¿™äº›ç›’å­å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼å¯¹é½</span><br><span class="line">åŒ…å«ä¸€ä¸²ç›’å­çš„çŸ©å½¢åŒºåŸŸå°±æ˜¯ä¸€ä¸ª â€œçº¿æ¡æ¡†(line box)â€</span><br></pre></td></tr></table></figure><h6 id="å¯¹é½æ–¹å¼"><a href="#å¯¹é½æ–¹å¼" class="headerlink" title="å¯¹é½æ–¹å¼"></a>å¯¹é½æ–¹å¼</h6><p><img src="/upload/image-20241110155405765.png" alt="image-20241110155405765.png"></p><p><img src="/upload/image-20241110155807497.png" alt="image-20241110155807497.png"></p><p><img src="/upload/image-20241110160000770.png" alt="image-20241110160000770.png"></p><h5 id="å±‚å ä¸Šä¸‹æ–‡"><a href="#å±‚å ä¸Šä¸‹æ–‡" class="headerlink" title="å±‚å ä¸Šä¸‹æ–‡"></a>å±‚å ä¸Šä¸‹æ–‡</h5><p><strong>å¯¹HTMLå…ƒç´ çš„ä¸‰ç»´æ„æƒ³ï¼ŒåŸºäºç”¨æˆ·ç•Œé¢zè½´çš„ä¸Šä¸‹æ’å¸ƒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¯¹äºæµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹çš„â€œæ¸²æŸ“å±‚(render layer)â€</span><br></pre></td></tr></table></figure><h6 id="å±‚å æ°´å¹³"><a href="#å±‚å æ°´å¹³" class="headerlink" title="å±‚å æ°´å¹³"></a>å±‚å æ°´å¹³</h6><p><strong>ä¹Ÿå°±æ˜¯å±‚å é¡ºåº</strong></p><p><img src="/upload/image-20241110164351519.png" alt="image-20241110164351519.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">z-indexåªèƒ½åœ¨åŒä¸€ä¸ªå±‚å ä¸Šä¸‹æ–‡æ¯”è¾ƒ</span><br><span class="line">å­å…ƒç´ çš„z-indexæ— æ³•è¶…è¿‡çˆ¶å…ƒç´ çš„z-indexé¡ºåº</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Electronå®ç°æ¡Œé¢ç«¯è®¡æ—¶å™¨</title>
      <link href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E5%B0%9D%E8%AF%95%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E6%A1%8C%E9%9D%A2%E7%AB%AF%E8%AE%A1%E6%97%B6%E5%99%A8%EF%BC%88%E5%8D%8A%E6%88%90%E5%93%81%E7%89%88%EF%BC%89/"/>
      <url>/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E5%B0%9D%E8%AF%95%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E6%A1%8C%E9%9D%A2%E7%AB%AF%E8%AE%A1%E6%97%B6%E5%99%A8%EF%BC%88%E5%8D%8A%E6%88%90%E5%93%81%E7%89%88%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="åæ§½"><a href="#åæ§½" class="headerlink" title="åæ§½"></a>åæ§½</h2><p><strong>æœ€åˆæŠ€æœ¯æ ˆä¸ºVue+Electron+TSï¼Œå¤ªç”œç¾çš„éš¾äº†ã€‚ã€‚ã€‚é…ç½®æŠ¥é”™é—®é¢˜ä¸€å¤§å †ï¼Œä¸€è·¯æŠ¥é”™é—®AIä¸€è·¯æ”¹ï¼Œé•¿è¾¾ä¸‰ä¸ªå°æ—¶æŠŠæ–‡ä»¶æ”¹çš„ä¹±ä¸ƒå…«ç³Ÿæ— æ³•æ”¶å°¾å¿ç—›æ”¾å¼ƒæ–°å¼€é¡¹ç›®</strong></p><p>**æœ€åæŠ€æœ¯æ ˆé€‰æ‹©ä¸º **<strong>Vue+Electron+Vite+JS</strong> ï¼ŒåŒ…ç®¡ç†å·¥å…·é€‰æ‹©ä¸º <strong>pnpm</strong></p><p><del>å®Œæ•´ä»£ç è§githubä»“åº“</del> <code>......</code>(è¿˜æ²¡æ¨ï¼Œå› ä¸ºdistæ–‡ä»¶å¤ªå¤§çš„åŸå› æ²¡åŠæ³•ä¼ ï¼Œç›®å‰è¿˜åœ¨å¯»æ‰¾æ›´åˆç†çš„æ¨é€æ–¹æ¡ˆ)</p><h2 id="ä¸»æ­¥éª¤"><a href="#ä¸»æ­¥éª¤" class="headerlink" title="ä¸»æ­¥éª¤"></a>ä¸»æ­¥éª¤</h2><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p><strong>åˆ›å»º</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm create vite Tclick --template vue</span><br></pre></td></tr></table></figure><p><strong>ä¾èµ–</strong></p><p><strong>package.json ç›´äº«ç‰ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;clock&quot;,</span><br><span class="line">    &quot;private&quot;: true,</span><br><span class="line">    &quot;version&quot;: &quot;0.0.0&quot;,</span><br><span class="line">    &quot;description&quot;: &quot;An Timer application.&quot;,//æè¿°</span><br><span class="line">    &quot;author&quot;: &quot;none &lt;ä½ çš„é‚®ç®±&gt;&quot;,//ä½œè€…</span><br><span class="line">    &quot;homepage&quot;: &quot;./&quot;,</span><br><span class="line">    &quot;main&quot;: &quot;main.js&quot;,</span><br><span class="line">    &quot;scripts&quot;: &#123;</span><br><span class="line">        &quot;dev&quot;: &quot;vite&quot;,</span><br><span class="line">        &quot;build&quot;: &quot;vite build&quot;,</span><br><span class="line">        &quot;serve&quot;: &quot;vite preview&quot;,</span><br><span class="line">        &quot;electron:dev&quot;: &quot;concurrently \&quot;cross-env NODE_ENV=development wait-on http://localhost:5173 &amp;&amp; electron .\&quot; \&quot;npm run dev\&quot;&quot;,</span><br><span class="line">        &quot;electron:build&quot;: &quot;npm run build &amp;&amp; electron-builder &amp;&amp; node post-build.js&quot;,</span><br><span class="line">        &quot;start&quot;: &quot;npm run electron:dev&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;dependencies&quot;: &#123;</span><br><span class="line">        &quot;vue&quot;: &quot;^3.5.13&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;devDependencies&quot;: &#123;</span><br><span class="line">        &quot;@vitejs/plugin-vue&quot;: &quot;^5.2.1&quot;,</span><br><span class="line">        &quot;concurrently&quot;: &quot;^9.1.2&quot;,</span><br><span class="line">        &quot;cross-env&quot;: &quot;^7.0.3&quot;,</span><br><span class="line">        &quot;electron&quot;: &quot;^33.3.1&quot;,</span><br><span class="line">        &quot;electron-builder&quot;: &quot;^25.1.8&quot;,</span><br><span class="line">        &quot;vite&quot;: &quot;^6.0.5&quot;,</span><br><span class="line">        &quot;vite-plugin-html&quot;: &quot;^3.2.2&quot;,</span><br><span class="line">        &quot;wait-on&quot;: &quot;^8.0.2&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;build&quot;: &#123;</span><br><span class="line">        &quot;productName&quot;: &quot;Clock&quot;,</span><br><span class="line">        &quot;appId&quot;: &quot;com.example.clock&quot;,</span><br><span class="line">        &quot;directories&quot;: &#123;</span><br><span class="line">            &quot;output&quot;: &quot;release&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;files&quot;: [</span><br><span class="line">            &quot;dist/**/*&quot;,</span><br><span class="line">            &quot;node_modules/**/*&quot;,</span><br><span class="line">            &quot;main.js&quot;,</span><br><span class="line">            &quot;preload.js&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;mac&quot;: &#123;</span><br><span class="line">            &quot;target&quot;: &quot;dmg&quot;,</span><br><span class="line">            &quot;icon&quot;: &quot;dist/installer-icon-256.ico&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;win&quot;: &#123;</span><br><span class="line">            &quot;target&quot;: &quot;nsis&quot;,</span><br><span class="line">            &quot;icon&quot;: &quot;dist/installer-icon-256.ico&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;linux&quot;: &#123;</span><br><span class="line">            &quot;target&quot;: &quot;AppImage&quot;,</span><br><span class="line">            &quot;icon&quot;: &quot;dist/installer-icon-256.ico&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;nsis&quot;: &#123;</span><br><span class="line">            &quot;installerIcon&quot;: &quot;./public/installer-icon.ico&quot;,//è¿™é‡Œçš„icoæ˜¯æˆ‘ä¸‹çš„æ—¶é’Ÿå›¾æ ‡ï¼Œæ›¿æ¢è½¯ä»¶å›¾æ ‡</span><br><span class="line">            &quot;oneClick&quot;: false,</span><br><span class="line">            &quot;allowToChangeInstallationDirectory&quot;: true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install</span><br></pre></td></tr></table></figure><h3 id="è¡¥å……é¡¹ç›®ç»“æ„"><a href="#è¡¥å……é¡¹ç›®ç»“æ„" class="headerlink" title="è¡¥å……é¡¹ç›®ç»“æ„"></a>è¡¥å……é¡¹ç›®ç»“æ„</h3><p><code>public/icon</code>ï¼ˆå›¾æ ‡ï¼‰</p><p><code>main.js</code>ï¼ˆElectronä¸»è¿›ç¨‹ï¼‰</p><p><code>preload.js</code>ï¼ˆElectroné¢„åŠ è½½è„šæœ¬ï¼‰</p><p><code>post-build.js</code>ï¼ˆæ–‡ä»¶æ“ä½œï¼Œç”Ÿæˆdistï¼‰</p><h3 id="æ ¸å¿ƒé…ç½®"><a href="#æ ¸å¿ƒé…ç½®" class="headerlink" title="æ ¸å¿ƒé…ç½®"></a>æ ¸å¿ƒé…ç½®</h3><p><code>index.html</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">        &lt;link rel=&quot;icon&quot; type=&quot;image/svg+xml&quot; href=&quot;./dist/installer-icon.ico&quot; /&gt;</span><br><span class="line">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">        &lt;title&gt;Clock&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;script type=&quot;module&quot; src=&quot;/src/main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><code>main.js</code>ï¼ˆElectronä¸»è¿›ç¨‹ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">const &#123; app, BrowserWindow &#125; = require(&#x27;electron&#x27;)</span><br><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line"></span><br><span class="line">function createWindow() &#123;</span><br><span class="line">    const win = new BrowserWindow(&#123;</span><br><span class="line">        width: 500,</span><br><span class="line">        height: 210,</span><br><span class="line">        x: 800, // æŒ‡å®šåˆå§‹ x åæ ‡</span><br><span class="line">        y: 20, // æŒ‡å®šåˆå§‹ y åæ ‡</span><br><span class="line">        webPreferences: &#123;</span><br><span class="line">            preload: path.join(__dirname, &#x27;preload.js&#x27;),</span><br><span class="line">            nodeIntegration: false,</span><br><span class="line">            contextIsolation: true,</span><br><span class="line">            // è®¾ç½® CSP</span><br><span class="line">            additionalArguments: [&#x27;--disable-features=ElectronSandbox&#x27;], // æ ¹æ®éœ€è¦è°ƒæ•´</span><br><span class="line">            webviewTag: false, // ç¦æ­¢ä½¿ç”¨ &lt;webview&gt; æ ‡ç­¾</span><br><span class="line">            webSecurity: true,</span><br><span class="line">            sandbox: true,</span><br><span class="line">            contentSecurityPolicy: `</span><br><span class="line">        default-src &#x27;self&#x27;;</span><br><span class="line">        script-src &#x27;self&#x27;;</span><br><span class="line">        connect-src &#x27;self&#x27;;</span><br><span class="line">        style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; /* å¦‚æœéœ€è¦å†…è”æ ·å¼ */</span><br><span class="line">        img-src &#x27;self&#x27; data:;</span><br><span class="line">        font-src &#x27;self&#x27;;</span><br><span class="line">      `,</span><br><span class="line">        &#125;,</span><br><span class="line">        title: &#x27;Clock&#x27;, // è®¾ç½®çª—å£æ ‡é¢˜</span><br><span class="line">        icon: path.join(__dirname, &#x27;dist&#x27;, &#x27;installer-icon.ico&#x27;), // è®¾ç½®çª—å£å›¾æ ‡</span><br><span class="line">        autoHideMenuBar: true, //è‡ªåŠ¨éšè—èœå•æ </span><br><span class="line">        alwaysOnTop: true, // ç¡®ä¿çª—å£å§‹ç»ˆåœ¨é¡¶éƒ¨</span><br><span class="line">        // frame: false, // éšè—çª—å£è¾¹æ¡†</span><br><span class="line">        // resizable: false, // ç¦æ­¢è°ƒæ•´çª—å£å¤§å°</span><br><span class="line">        transparent: true, // ä½¿çª—å£é€æ˜</span><br><span class="line">        // skipTaskbar: true, // è·³è¿‡ä»»åŠ¡æ æ˜¾ç¤º</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    if (process.env.NODE_ENV === &#x27;development&#x27;) &#123;</span><br><span class="line">        win.loadURL(&#x27;http://localhost:5173&#x27;)</span><br><span class="line">        // win.loadFile(&#x27;dist/index.html&#x27;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        win.loadFile(path.resolve(__dirname, &#x27;dist&#x27;, &#x27;index.html&#x27;))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.whenReady().then(() =&gt; &#123;</span><br><span class="line">    createWindow()</span><br><span class="line"></span><br><span class="line">    app.on(&#x27;activate&#x27;, function () &#123;</span><br><span class="line">        if (BrowserWindow.getAllWindows().length === 0) createWindow()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// å…¶ä»–äº‹ä»¶ç›‘å¬å™¨...</span><br><span class="line"></span><br><span class="line">app.on(&#x27;window-all-closed&#x27;, () =&gt; &#123;</span><br><span class="line">    if (process.platform !== &#x27;darwin&#x27;) &#123;</span><br><span class="line">        app.quit()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.on(&#x27;activate&#x27;, () =&gt; &#123;</span><br><span class="line">    if (BrowserWindow.getAllWindows().length === 0) &#123;</span><br><span class="line">        createWindow()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>preload.js</code>ï¼ˆElectroné¢„åŠ è½½è„šæœ¬ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// preload.js</span><br><span class="line">window.addEventListener(&#x27;DOMContentLoaded&#x27;, () =&gt; &#123;</span><br><span class="line">    // è¿™é‡Œå¯ä»¥æ·»åŠ ä¸DOMäº¤äº’çš„ä»£ç </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>post-build.js</code>ï¼ˆæ–‡ä»¶æ“ä½œï¼Œç”Ÿæˆdistï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;)</span><br><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line"></span><br><span class="line">const htmlFilePath = path.resolve(__dirname, &#x27;dist&#x27;, &#x27;index.html&#x27;)</span><br><span class="line"></span><br><span class="line">fs.readFile(htmlFilePath, &#x27;utf8&#x27;, (err, data) =&gt; &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        return console.log(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const result = data.replace(/&lt;title&gt;.*?&lt;\/title&gt;/, &#x27;&lt;title&gt;Clock&lt;/title&gt;&#x27;)</span><br><span class="line"></span><br><span class="line">    fs.writeFile(htmlFilePath, result, &#x27;utf8&#x27;, (err) =&gt; &#123;</span><br><span class="line">        if (err) return console.log(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="ç®€é™‹çš„ç»„ä»¶"><a href="#ç®€é™‹çš„ç»„ä»¶" class="headerlink" title="ç®€é™‹çš„ç»„ä»¶"></a>ç®€é™‹çš„ç»„ä»¶</h3><p><code>App.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=&quot;app&quot; class=&quot;hide-scrollbar&quot;&gt;</span><br><span class="line">        &lt;Main /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    import Main from &#x27;./components/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .hide-scrollbar &#123;</span><br><span class="line">        scrollbar-width: none; /* Firefox */</span><br><span class="line">        -ms-overflow-style: none; /* IE å’Œ Edge */</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .hide-scrollbar::-webkit-scrollbar &#123;</span><br><span class="line">        display: none;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style</span><br></pre></td></tr></table></figure><p><code>utils/timeUtils.js</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">export const getFormattedTime = () =&gt; &#123;</span><br><span class="line">    const now = new Date();</span><br><span class="line">    </span><br><span class="line">    // è·å–å½“å‰æ—¶é—´çš„å°æ—¶ã€åˆ†é’Ÿå’Œç§’æ•°ï¼Œå¹¶ç¡®ä¿å®ƒä»¬éƒ½æ˜¯ä¸¤ä½æ•°</span><br><span class="line">    const padZero = (num) =&gt; num.toString().padStart(2, &#x27;0&#x27;);</span><br><span class="line">    const hours = padZero(now.getHours());</span><br><span class="line">    const minutes = padZero(now.getMinutes());</span><br><span class="line">    const seconds = padZero(now.getSeconds());</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">        hoursFirstChar: hours[0],</span><br><span class="line">        hoursSecondChar: hours[1],</span><br><span class="line">        minutesFirstChar: minutes[0],</span><br><span class="line">        minutesSecondChar: minutes[1],</span><br><span class="line">        secondsFirstChar: seconds[0],</span><br><span class="line">        secondsSecondChar: seconds[1],</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>components / index.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;layouts&quot;&gt;</span><br><span class="line">        &lt;div v-for=&quot;(title, index) in titles&quot; :key=&quot;index&quot; class=&quot;layout&quot;&gt;</span><br><span class="line">            &lt;div&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;top&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;title&quot;&gt;&#123;&#123; title &#125;&#125;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;btn&quot; @click=&quot;start(index)&quot; :disabled=&quot;timers[index].isRunning&quot;&gt;å¼€å§‹&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;btn&quot; @click=&quot;stop(index)&quot; :disabled=&quot;!timers[index].isRunning&quot;&gt;åœæ­¢&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;btn&quot; @click=&quot;reset(index)&quot; :disabled=&quot;timers[index].elapsedTime === 0&quot;&gt;é‡ç½®&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;!-- &lt;Flip</span><br><span class="line">                :hours=&quot;timers[index].formattedTime.hours&quot;</span><br><span class="line">                :minutes=&quot;timers[index].formattedTime.minutes&quot;</span><br><span class="line">                :seconds=&quot;timers[index].formattedTime.seconds&quot; /&gt; --&gt;</span><br><span class="line">            &lt;Timer /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    import &#123; ref, computed &#125; from &#x27;vue&#x27;</span><br><span class="line">    import Flip from &#x27;./Flip/index.vue&#x27;</span><br><span class="line">    import Timer from &#x27;./Timer/index.vue&#x27;</span><br><span class="line"></span><br><span class="line">    const titles = [&#x27;å­¦ä¹ æ—¶é•¿&#x27;, &#x27;è‹±è¯­æ—¶é•¿&#x27;, &#x27;çœ‹ä¹¦æ—¶é•¿&#x27;, &#x27;åšå®¢æ—¶é•¿&#x27;]</span><br><span class="line">    const timers = ref([])</span><br><span class="line"></span><br><span class="line">    for (let i = 0; i &lt; 4; i++) &#123;</span><br><span class="line">        timers.value.push(&#123;</span><br><span class="line">            startTime: null,</span><br><span class="line">            elapsedTime: 0,</span><br><span class="line">            isRunning: false,</span><br><span class="line">            formattedTime: &#123; hours: &#x27;00&#x27;, minutes: &#x27;00&#x27;, seconds: &#x27;00&#x27; &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const start = (index) =&gt; &#123;</span><br><span class="line">        if (!timers.value[index].isRunning) &#123;</span><br><span class="line">            timers.value[index].startTime = Date.now() - (timers.value[index].startTime ? timers.value[index].startTime : 0)</span><br><span class="line">            timers.value[index].isRunning = true</span><br><span class="line">            updateElapsedTime(index)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const stop = (index) =&gt; &#123;</span><br><span class="line">        timers.value[index].isRunning = false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const reset = (index) =&gt; &#123;</span><br><span class="line">        timers.value[index].startTime = null</span><br><span class="line">        timers.value[index].elapsedTime = 0</span><br><span class="line">        timers.value[index].isRunning = false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const updateElapsedTime = (index) =&gt; &#123;</span><br><span class="line">        if (timers.value[index].isRunning) &#123;</span><br><span class="line">            timers.value[index].elapsedTime = Math.floor((Date.now() - timers.value[index].startTime) / 1000)</span><br><span class="line">            updateFormattedTime(index)</span><br><span class="line">            setTimeout(() =&gt; updateElapsedTime(index), 1000)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const updateFormattedTime = (index) =&gt; &#123;</span><br><span class="line">        const hours = Math.floor(timers.value[index].elapsedTime / 3600).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        const minutes = Math.floor((timers.value[index].elapsedTime % 3600) / 60).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        const seconds = (timers.value[index].elapsedTime % 60).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        timers.value[index].formattedTime = &#123; hours, minutes, seconds &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .layouts &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: row;</span><br><span class="line">        gap: 20px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        align-items: center;</span><br><span class="line">        width: 25%;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout .top &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: space-between;</span><br><span class="line">        align-items: center;</span><br><span class="line">        width: 100%;</span><br><span class="line">        background: #fff;</span><br><span class="line">        border-radius: 20px;</span><br><span class="line">        padding: 10px;</span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout .top .title &#123;</span><br><span class="line">        font-size: 20px;</span><br><span class="line">        font-weight: 700;</span><br><span class="line">        color: #333;</span><br><span class="line">        margin-right: auto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout .top .btn &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        align-items: center;</span><br><span class="line">        width: 50px;</span><br><span class="line">        height: 24px;</span><br><span class="line">        border-radius: 10px;</span><br><span class="line">        border: 1px solid #333;</span><br><span class="line">        font-size: 14px;</span><br><span class="line">        font-weight: 700;</span><br><span class="line">        color: #333;</span><br><span class="line">        padding: 0px 3px;</span><br><span class="line">        cursor: pointer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .layout .top .btn:hover &#123;</span><br><span class="line">        background: #333;</span><br><span class="line">        color: #fff;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><code>components / Flip / index.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;clock&quot;&gt;</span><br><span class="line">        &lt;!-- å°æ—¶ --&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;hoursFirstChar&quot;&gt;&#123;&#123; hoursFirstChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;hoursSecondChar&quot;&gt;&#123;&#123; hoursSecondChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;em class=&quot;divider&quot;&gt;:&lt;/em&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- åˆ†é’Ÿ --&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;minutesFirstChar&quot;&gt;&#123;&#123; minutesFirstChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;minutesSecondChar&quot;&gt;&#123;&#123; minutesSecondChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;em class=&quot;divider&quot;&gt;:&lt;/em&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- ç§’ --&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;secondsFirstChar&quot;&gt;&#123;&#123; secondsFirstChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;flip&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;digital&quot; :data-number=&quot;secondsSecondChar&quot;&gt;&#123;&#123; secondsSecondChar &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    import &#123; ref, onMounted, watch &#125; from &#x27;vue&#x27;;</span><br><span class="line">    import &#123; getFormattedTime &#125; from &#x27;../../utils/timeUtils&#x27;; // ç¡®ä¿è·¯å¾„æ­£ç¡®</span><br><span class="line"></span><br><span class="line">    const hoursFirstChar = ref(&#x27;&#x27;);</span><br><span class="line">    const hoursSecondChar = ref(&#x27;&#x27;);</span><br><span class="line">    const minutesFirstChar = ref(&#x27;&#x27;);</span><br><span class="line">    const minutesSecondChar = ref(&#x27;&#x27;);</span><br><span class="line">    const secondsFirstChar = ref(&#x27;&#x27;);</span><br><span class="line">    const secondsSecondChar = ref(&#x27;&#x27;);</span><br><span class="line"></span><br><span class="line">    const updateTime = () =&gt; &#123;</span><br><span class="line">        const time = getFormattedTime();</span><br><span class="line">        hoursFirstChar.value = time.hoursFirstChar;</span><br><span class="line">        hoursSecondChar.value = time.hoursSecondChar;</span><br><span class="line">        minutesFirstChar.value = time.minutesFirstChar;</span><br><span class="line">        minutesSecondChar.value = time.minutesSecondChar;</span><br><span class="line">        secondsFirstChar.value = time.secondsFirstChar;</span><br><span class="line">        secondsSecondChar.value = time.secondsSecondChar;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">        updateTime(); // åˆå§‹åŒ–æ—¶æ›´æ–°æ—¶é—´</span><br><span class="line">        setInterval(updateTime, 1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡æ—¶é—´</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        align-items: center;</span><br><span class="line">        height: 100vh;</span><br><span class="line">        width: 100vw;</span><br><span class="line">        background-color: #2c3e50; /* æ·»åŠ èƒŒæ™¯è‰²ä»¥ä¾¿äºæŸ¥çœ‹ */</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .clock &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* æ—¶é’Ÿçš„åˆ†éš” */</span><br><span class="line">    .clock .divider &#123;</span><br><span class="line">        font-size: 30px;</span><br><span class="line">        line-height: 60px;</span><br><span class="line">        font-style: normal;</span><br><span class="line">        color: rgb(255, 255, 255); /* æ›´æ”¹ä¸ºç™½è‰²ä»¥ä¾¿äºæŸ¥çœ‹ */</span><br><span class="line">        margin: 0 5px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* æ—¶é’Ÿçš„å¡ç‰‡ */</span><br><span class="line">    .clock .flip &#123;</span><br><span class="line">        position: relative;</span><br><span class="line">        width: 40px; /* ç¨å¾®å¢åŠ å®½åº¦ä»¥ç¡®ä¿æ•°å­—å®Œå…¨æ˜¾ç¤º */</span><br><span class="line">        height: 60px; /* å¢åŠ é«˜åº¦ä»¥ç¡®ä¿æ•°å­—å®Œå…¨æ˜¾ç¤º */</span><br><span class="line">        margin: 2px;</span><br><span class="line">        font-size: 48px; /* å¢åŠ å­—ä½“å¤§å°ä»¥ä¾¿äºæŸ¥çœ‹ */</span><br><span class="line">        font-weight: 700;</span><br><span class="line">        line-height: 60px; /* ç¡®ä¿æ–‡æœ¬å‚ç›´å±…ä¸­ */</span><br><span class="line">        text-align: center;</span><br><span class="line">        background: rgb(46, 45, 45);</span><br><span class="line">        border: 1px solid rgb(34, 33, 33);</span><br><span class="line">        border-radius: 10px;</span><br><span class="line">        box-shadow: 0 0 6px rgba(54, 54, 54, 0.5);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* æ—¶é’Ÿä¸Šçš„æ•°å­— */</span><br><span class="line">    .clock .flip .digital &#123;</span><br><span class="line">        position: absolute;</span><br><span class="line">        top: 0;</span><br><span class="line">        left: 0;</span><br><span class="line">        right: 0;</span><br><span class="line">        bottom: 0;</span><br><span class="line">        color: white; /* æ•°å­—é¢œè‰²ä¸ºç™½è‰² */</span><br><span class="line">        background: transparent; /* èƒŒæ™¯é€æ˜ */</span><br><span class="line">        border-radius: 10px;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">        justify-content: center;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><code>components / Timer / index.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;&#123;&#123; formattedTime &#125;&#125;&lt;/h1&gt;</span><br><span class="line">        &lt;button @click=&quot;start&quot; :disabled=&quot;isRunning&quot;&gt;å¼€å§‹&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;stop&quot; :disabled=&quot;!isRunning&quot;&gt;åœæ­¢&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;reset&quot; :disabled=&quot;elapsedTime === 0&quot;&gt;é‡ç½®&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    import &#123; ref, computed, onMounted, onUnmounted &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">    const startTime = ref(null)</span><br><span class="line">    const elapsedTime = ref(0)</span><br><span class="line">    const isRunning = ref(false)</span><br><span class="line"></span><br><span class="line">    const formattedTime = computed(() =&gt; &#123;</span><br><span class="line">        const hours = Math.floor(elapsedTime.value / 3600).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        const minutes = Math.floor((elapsedTime.value % 3600) / 60).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        const seconds = (elapsedTime.value % 60).toString().padStart(2, &#x27;0&#x27;)</span><br><span class="line">        return `$&#123;hours&#125;:$&#123;minutes&#125;:$&#123;seconds&#125;`</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    let intervalId = null</span><br><span class="line"></span><br><span class="line">    function start() &#123;</span><br><span class="line">        if (!isRunning.value) &#123;</span><br><span class="line">            startTime.value = Date.now() - (startTime.value ? startTime.value : 0)</span><br><span class="line">            isRunning.value = true</span><br><span class="line">            intervalId = setInterval(updateElapsedTime, 1000)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function stop() &#123;</span><br><span class="line">        clearInterval(intervalId)</span><br><span class="line">        isRunning.value = false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function reset() &#123;</span><br><span class="line">        clearInterval(intervalId)</span><br><span class="line">        startTime.value = null</span><br><span class="line">        elapsedTime.value = 0</span><br><span class="line">        isRunning.value = false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function updateElapsedTime() &#123;</span><br><span class="line">        elapsedTime.value = Math.floor((Date.now() - startTime.value) / 1000)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">        document.addEventListener(&#x27;visibilitychange&#x27;, handleVisibilityChange)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    onUnmounted(() =&gt; &#123;</span><br><span class="line">        document.removeEventListener(&#x27;visibilitychange&#x27;, handleVisibilityChange)</span><br><span class="line">        clearInterval(intervalId)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    function handleVisibilityChange() &#123;</span><br><span class="line">        if (document.visibilityState === &#x27;hidden&#x27;) &#123;</span><br><span class="line">            if (isRunning.value) &#123;</span><br><span class="line">                stop()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else if (document.visibilityState === &#x27;visible&#x27;) &#123;</span><br><span class="line">            if (isRunning.value) &#123;</span><br><span class="line">                start()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨é¡¹ç›®"><a href="#å¯åŠ¨é¡¹ç›®" class="headerlink" title="å¯åŠ¨é¡¹ç›®"></a>å¯åŠ¨é¡¹ç›®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run build</span><br></pre></td></tr></table></figure><p><strong>ç½‘é¡µç«¯å¼€å‘ç¯å¢ƒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run dev</span><br></pre></td></tr></table></figure><p><strong>æ¡Œé¢ç«¯å¼€å‘ç¯å¢ƒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run start</span><br></pre></td></tr></table></figure><h3 id="exeæ–‡ä»¶ç”Ÿæˆä½ç½®"><a href="#exeæ–‡ä»¶ç”Ÿæˆä½ç½®" class="headerlink" title=".exeæ–‡ä»¶ç”Ÿæˆä½ç½®"></a>.exeæ–‡ä»¶ç”Ÿæˆä½ç½®</h3><p><code>release</code>æ–‡ä»¶å¤¹ä¸­çš„ Setup.exeï¼ˆæ–‡ä»¶æœ‰70å¤šm!!!ä¸ç†è§£ï¼‰</p><h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a><em>TODO</em></h3><p><strong>1.æ¡Œé¢è½¯ä»¶å›¾æ ‡è¿˜æ˜¯Electronçš„ï¼Œéœ€è¦ä¿®æ”¹ä¸ºä¸‹å¥½çš„ico</strong></p><p><strong>2.gitå¤§æ–‡ä»¶æäº¤é—®é¢˜ï¼ˆå¯èƒ½æ˜¯éœ€è¦æ”¹åŠ¨gitignoreï¼Ÿæ²¡æœ‰æ¥è§¦è¿‡ï¼‰</strong></p><p><strong>3.ç¬¬ä¸€ç‰ˆVue+Electron+TSé¡¹ç›®æåˆ°è¿‡è‡ªåŠ¨å‘å¸ƒç‰ˆæœ¬å·¥ä½œæµï¼Œè¿˜æœ‰æ£€æµ‹æ ‡ç­¾å•¥çš„ï¼Œè¿˜æ²¡å¼„æ‡‚è¿™å‘¨æ¢ç´¢ä¸€ä¸‹ï¼Œæ²¡è®°é”™çš„è¯githubä¸»é¡µçš„è´ªåƒè›‡å¥½åƒä¹Ÿå’Œè¿™ä¸ªæœ‰å…³ç³»</strong></p><p><strong>4.ç®€å•UIæ’å¸ƒ</strong></p><p><strong>5.äº¤äº’åŠŸèƒ½ï¼šç”¨æˆ·å¯è‡ªè¡Œæ·»åŠ å¤šä¸ªè®¡æ—¶å™¨ï¼Œä¸”ç‹¬ç«‹è®¡æ—¶</strong></p><p><strong>6.è€ƒè™‘åˆ°æŒ‚åå°ä¼šæœ‰è®¡æ—¶è¯¯å·®ï¼Œæ·»åŠ æ–°çš„è®¡æ—¶é€»è¾‘ï¼ˆbeginè®°å½•æ—¶é—´æˆ³ï¼Œä»åå°è°ƒå‡ºæ—¶é€šè¿‡æ—¶é—´æˆ³ç›¸å‡æ›´æ–°æ—¶é—´ï¼‰</strong></p>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WebSocket</title>
      <link href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/WebSocket/"/>
      <url>/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/WebSocket/</url>
      
        <content type="html"><![CDATA[<h1 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h1><blockquote><p><strong>ä½å»¶è¿Ÿï¼ŒåŒå‘å®æ—¶é€šä¿¡(åŒå…¨å·¥)ï¼Œé•¿æœŸè¿è¡Œ</strong></p></blockquote><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><strong>ç›¸æ¯”HTTPåè®®ï¼ŒWebSocketæ˜¯ä¸€ç§****å®æ—¶é€šä¿¡</strong>åè®®</p><p><strong>åœ¨å®æ—¶é€šè®¯å‰ï¼ŒHTTPé€šè¿‡****è½®è¯¢</strong>è§£å†³å®æ—¶é—®é¢˜</p><blockquote><p><strong>è½®è¯¢ï¼šå®¢æˆ·ç«¯å®šæœŸå‘æœåŠ¡å™¨å‘é€è¯·æ±‚</strong></p><blockquote><p><strong>é•¿è½®è¯¢ï¼šå®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚åï¼Œä¿æŒè¿æ¥æ‰“å¼€ï¼Œç­‰å¾…æ–°æ•°æ®å“åº”åå†å…³é—­è¿æ¥</strong></p></blockquote><blockquote><p><strong>Cometï¼šä¿æŒé•¿è¿æ¥ï¼Œè¿”å›è¯·æ±‚åç»§ç»­ä¿æŒè¿æ¥æ‰“å¼€</strong></p></blockquote></blockquote><p><strong>WebSocketçš„è¿æ¥åªéœ€è¦å»ºç«‹ä¸€æ¬¡</strong></p><h2 id="å»ºç«‹è¿æ¥"><a href="#å»ºç«‹è¿æ¥" class="headerlink" title="å»ºç«‹è¿æ¥"></a>å»ºç«‹è¿æ¥</h2><h3 id="ç†è®ºé¡»çŸ¥"><a href="#ç†è®ºé¡»çŸ¥" class="headerlink" title="ç†è®ºé¡»çŸ¥"></a>ç†è®ºé¡»çŸ¥</h3><p><strong>éœ€è¦HTTPå‘æœåŠ¡å™¨å‘èµ·ä¸€æ¬¡å¸¸è§„Getè¯·æ±‚ï¼Œå¹¶åœ¨è¿™ä¸ªè¯·æ±‚å¤´ä¸Šæºå¸¦</strong><em><strong>Upgrade</strong></em></p><blockquote><p><strong>Upgradeä½œä¸ºå‡çº§è¯·æ±‚å°†ä¼ é€’ç»™æœåŠ¡å™¨ï¼Œåè®®ä»HTTPå‡çº§ä¸ºWebSocket</strong></p></blockquote><p><strong>åœ¨æ­¤ä¹‹åå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å³å¯éšæ—¶å‘å½¼æ­¤å‘é€æ¶ˆæ¯</strong></p><h3 id="å…·ä½“ä»£ç "><a href="#å…·ä½“ä»£ç " class="headerlink" title="å…·ä½“ä»£ç "></a>å…·ä½“ä»£ç </h3><p><strong>å‰ç«¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const socket = new WebSocket(&quot;ws://localhost:8080&quot;);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">socket.onopen =function(event)&#123;</span><br><span class="line">    console.log(&quot;Websocketè¿æ¥å·²æ‰“å¼€&quot;)</span><br><span class="line">&#125;</span><br><span class="line">socket.onmessage =function(event)&#123;</span><br><span class="line">    console.log(&quot;æ”¶åˆ°äº†å›å¤:&quot;event.data)</span><br><span class="line">&#125;</span><br><span class="line">socket.onclose = function(event)&#123;</span><br><span class="line">    console.log(&quot;Websocketè¿æ¥å·²å…³é—­&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function click()&#123;//å‘é€æ¶ˆæ¯</span><br><span class="line">    socket.send(&quot;Hello World!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åç«¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&#x27;http&#x27;);//å¼•å…¥æ¨¡å—</span><br><span class="line">const WebSocket = require(&#x27;ws&#x27;);</span><br><span class="line"></span><br><span class="line">const server = http.createServer();//HTTPæœåŠ¡å™¨å®ä¾‹</span><br><span class="line">const wss = new WebSocket.Server(&#123; server &#125;);//æ ¹æ®æœåŠ¡å™¨å®ä¾‹åˆ›å»ºWebSocketå®ä¾‹</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wss.on(&#x27;connection&#x27;,(socket) =&gt; &#123;//å®¢æˆ·ç«¯è¿å…¥WebsocketæœåŠ¡å™¨</span><br><span class="line">    socket.on(&#x27;message&#x27;,(message)=&gt;&#123;</span><br><span class="line">        console.log(&#x27;æ”¶åˆ°æ¶ˆæ¯:&#x27;+ message)</span><br><span class="line">        socket.send(&#x27;Hello FireUG&#x27;);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    socket.on(&#x27;close&#x27;,() =&gt; &#123;</span><br><span class="line">        console.log(&#x27;Websocketè¿æ¥å·²å…³é—­&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server.on(&#x27;request&#x27;,(request,response)=&gt;&#123;</span><br><span class="line">    response.writeHead(200,&#123;&#x27;Content-Type&#x27;:&#x27;text/plain&#x27;&#125;)</span><br><span class="line">    response.end(&#x27;Hello, World!&#x27;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.listen(8080ï¼Œ() =&gt; &#123;</span><br><span class="line">    console.log(&#x27;æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç«¯å£å·ä¸º 8080&#x27;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="å¿ƒè·³æœºåˆ¶"><a href="#å¿ƒè·³æœºåˆ¶" class="headerlink" title="å¿ƒè·³æœºåˆ¶"></a>å¿ƒè·³æœºåˆ¶</h2><blockquote><p><strong>ä¸ºäº†ä¿æŒé•¿è¿æ¥ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´é€šè¿‡</strong> <code>å¿ƒè·³åŒ…</code>ä¿æŒè¿æ¥çŠ¶æ€ï¼Œé˜²æ­¢é•¿æ—¶é—´æ²¡æœ‰æ•°æ®ä¼ è¾“è€Œè¢«åˆ‡æ–­</p></blockquote><p><code>å¿ƒè·³åŒ…</code></p><blockquote><p><strong>ä¸€ç§æ•°æ®åŒ…ï¼Œä¸åŒ…å«ä»»ä½•å®é™…æ•°æ®</strong></p><p><strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å®šæœŸå‘é€ä¸€ä¸ªç©ºçš„æ•°æ®åŒ…ï¼Œç¡®ä¿é“¾æ¥ä»ç„¶æœ‰æ•ˆ</strong></p><p><strong>å¦‚æœä¸€æ®µæ—¶é—´æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„å¿ƒè·³åŒ…ï¼Œå°±å¯è®¤ä¸ºè¿æ¥å·²ç»æ–­å¼€</strong></p></blockquote><h2 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h2><p><strong>å®‰å…¨</strong></p><blockquote><p><strong>ä¸æä¾›åŠ å¯†åŠŸèƒ½ï¼Œéœ€é‡‡ç”¨å…¶ä»–æ–¹å¼æ¥ç¡®ä¿å®‰å…¨æ€§</strong></p><blockquote><p><strong>SSLåè®®ï¼šå¯å¯¹WebSocketè¿æ¥è¿›è¡ŒåŠ å¯†é˜²æ­¢æ•æ„Ÿä¿¡æ¯è¢«çªƒå¬å’Œç¯¡æ”¹</strong></p></blockquote><blockquote><p><strong>è®¾ç½®é»‘ç™½åå•ï¼šåœ¨æœåŠ¡ç«¯è®¾ç½®ï¼Œåªå…è®¸ç‰¹å®šIPåœ°å€æˆ–åŸŸåçš„å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥</strong></p></blockquote></blockquote><p><strong>æ”¯æŒ</strong></p><blockquote><p><strong>å°äºIE10çš„æµè§ˆå™¨ä¸æ”¯æŒ</strong></p></blockquote><p><strong>ä¼˜åŒ–</strong></p><blockquote><p><strong>ä¿æŒé•¿è¿æ¥éœ€è¦æœåŠ¡å™¨ä¸æ–­åœ°ç»´æŠ¤å’Œå¤„ç†è¿æ¥çŠ¶æ€ï¼Œéœ€è¦ä¼˜åŒ–æ€§èƒ½ï¼Œä¸ç„¶ä¼šè¿‡åº¦åœ°æ¶ˆè€—æœåŠ¡å™¨èµ„æº</strong></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Node.js</title>
      <link href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/Node.js%E5%9F%BA%E7%A1%80/"/>
      <url>/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/Node.js%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="Node-jsåŸºç¡€"><a href="#Node-jsåŸºç¡€" class="headerlink" title="Node.jsåŸºç¡€"></a>Node.jsåŸºç¡€</h1><h2 id="æ¨¡å—ç³»ç»Ÿ"><a href="#æ¨¡å—ç³»ç»Ÿ" class="headerlink" title="æ¨¡å—ç³»ç»Ÿ"></a>æ¨¡å—ç³»ç»Ÿ</h2><h3 id="require-module"><a href="#require-module" class="headerlink" title="require &amp; module"></a>require &amp; module</h3><blockquote><p><strong>CommonJSè§„èŒƒ</strong></p><p><strong>æ¨¡å—åŒ–:æŠŠä»£ç æŒ‰åŠŸèƒ½åˆ†å¼€(å¯å¤ç”¨æ€§å¼º)</strong></p></blockquote><p><strong>ä¸¾ä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function sayHello(name) &#123;</span><br><span class="line">    return `Hello, $&#123;name&#125;`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);//å¼•å…¥expressæ¨¡å—</span><br><span class="line">const sayHello = require(&#x27;./myModule&#x27;);//å¼•å…¥è‡ªå®šä¹‰æ¨¡å—</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, (req, res) =&gt; &#123;</span><br><span class="line">    res.send(sayHello(&#x27;World&#x27;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="npmåŒ…ç®¡ç†"><a href="#npmåŒ…ç®¡ç†" class="headerlink" title="npmåŒ…ç®¡ç†"></a>npmåŒ…ç®¡ç†</h3><blockquote><p><strong>å°±æ˜¯å‰ç«¯å¸¸è§çš„ npm install ä¸‹åŒ…</strong></p></blockquote><h2 id="å¼‚æ­¥ç¼–ç¨‹"><a href="#å¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹"></a>å¼‚æ­¥ç¼–ç¨‹</h2><h3 id="å›è°ƒå‡½æ•°Promise"><a href="#å›è°ƒå‡½æ•°Promise" class="headerlink" title="å›è°ƒå‡½æ•°Promise"></a>å›è°ƒå‡½æ•°Promise</h3><blockquote><p><strong>å¯ä»¥é€šè¿‡</strong> <code>util.promisify</code>å°†åŸºäºå›è°ƒçš„APIè½¬æ¢ä¸ºè¿”å›Promiseçš„å½¢å¼</p><p><code>async</code>å…³é”®å­—å®šä¹‰ä¸€ä¸ªè¿”å›Promiseçš„å‡½æ•°ï¼Œ<code>await</code>ç­‰å¾…ä¸€ä¸ªPromiseå¯¹è±¡çš„ç»“æœ</p></blockquote><h3 id="fs-readFile"><a href="#fs-readFile" class="headerlink" title="fs.readFile"></a>fs.readFile</h3><blockquote><p><strong>Node.jsçš„æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼ˆfsï¼‰æä¾›äº†åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§ç‰ˆæœ¬çš„APIï¼Œå¦‚</strong> <code>fs.readFile</code>å’Œ <code>fs.readFileSync</code>ã€‚</p></blockquote><p><strong>å››ç§å†™æ³•</strong></p><p><img src="/upload/image-20250207162038459.png" alt="image-20250207162038459.png"></p><h2 id="HTTPæœåŠ¡å™¨"><a href="#HTTPæœåŠ¡å™¨" class="headerlink" title="HTTPæœåŠ¡å™¨"></a>HTTPæœåŠ¡å™¨</h2><h3 id="å¼•å…¥nodejså†…ç½®æ¨¡å—"><a href="#å¼•å…¥nodejså†…ç½®æ¨¡å—" class="headerlink" title="å¼•å…¥nodejså†…ç½®æ¨¡å—"></a>å¼•å…¥nodejså†…ç½®æ¨¡å—</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&#x27;http&#x27;);</span><br><span class="line">const url = require(&#x27;url&#x27;);</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºæœåŠ¡å™¨"><a href="#åˆ›å»ºæœåŠ¡å™¨" class="headerlink" title="åˆ›å»ºæœåŠ¡å™¨"></a>åˆ›å»ºæœåŠ¡å™¨</h3><blockquote><p><code>http.createServer()</code>å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„HTTPæœåŠ¡å™¨å®ä¾‹</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const server = http.createServer((req, res) =&gt; &#123;</span><br><span class="line">  // å¤„ç†è¯·æ±‚å’Œå“åº”</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>å½“æœ‰è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼Œå›è°ƒå‡½æ•°ä¼šè¢«è§¦å‘</strong></p><p><code>req</code>æ˜¯è¯·æ±‚å¯¹è±¡ï¼Œ<code>res</code>æ˜¯å“åº”å¯¹è±¡</p></blockquote><h3 id="è§£æURL"><a href="#è§£æURL" class="headerlink" title="è§£æURL"></a>è§£æURL</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const parsedUrl = url.parse(req.url, true);</span><br></pre></td></tr></table></figure><blockquote><p><strong><code>req.url</code></strong>ï¼šè·å–è¯·æ±‚çš„URLï¼ˆæ¯”å¦‚ <code>/hello?name=Qwen</code>ï¼‰</p><p><strong><code>url.parse()</code></strong>ï¼šå°†URLæ‹†è§£æˆå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•° <code>true</code>è¡¨ç¤ºå°†æŸ¥è¯¢å‚æ•°ï¼ˆå¦‚ <code>?name=Qwen</code>ï¼‰è§£æä¸ºå¯¹è±¡ï¼ˆ<code>parsedUrl.query</code>ï¼‰</p></blockquote><h3 id="è®¾ç½®å“åº”å¤´"><a href="#è®¾ç½®å“åº”å¤´" class="headerlink" title="è®¾ç½®å“åº”å¤´"></a>è®¾ç½®å“åº”å¤´</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.writeHead(200, &#123;&#x27;Content-Type&#x27;: &#x27;text/plain&#x27;&#125;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>çŠ¶æ€ç 200</strong>ï¼šè¡¨ç¤ºè¯·æ±‚æˆåŠŸ</p><p><strong><code>Content-Type: text/plain</code></strong>ï¼šå‘Šè¯‰æµè§ˆå™¨è¿”å›çš„å†…å®¹æ˜¯çº¯æ–‡æœ¬</p></blockquote><h3 id="å¤„ç†è¯·æ±‚"><a href="#å¤„ç†è¯·æ±‚" class="headerlink" title="å¤„ç†è¯·æ±‚"></a>å¤„ç†è¯·æ±‚</h3><p><strong>req.url</strong></p><p><strong>req.method</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if (req.method === &#x27;GET&#x27;) &#123;</span><br><span class="line">  if (parsedUrl.pathname === &#x27;/hello&#x27;) &#123;//http://localhost:3000/hello?...=...</span><br><span class="line">    // å¤„ç†/helloè·¯å¾„</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // å¤„ç†å…¶ä»–è·¯å¾„</span><br><span class="line">  &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  // å¤„ç†éGETè¯·æ±‚</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è·¯å¾„æ˜¯</strong> <code>/hello</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let name = parsedUrl.query.name || &quot;World&quot;;</span><br><span class="line">res.end(`Hello $&#123;name&#125;!\n`);</span><br></pre></td></tr></table></figure><blockquote><p><strong>è·å–æŸ¥è¯¢å‚æ•°</strong>ï¼šä» <code>parsedUrl.query</code>ä¸­è¯»å– <code>name</code>å‚æ•°ï¼ˆå¦‚ <code>?name=Qwen</code>ï¼‰</p><p><strong>å¦‚æœæœªæä¾›</strong> <code>name</code>ï¼Œé»˜è®¤å€¼ä¸º <code>World</code></p><p><strong>ç¤ºä¾‹</strong>ï¼šè®¿é—® <code>http://localhost:3000/hello?name=Qwen</code>ä¼šè¿”å› <code>Hello Qwen!</code></p></blockquote><p><strong>å…¶ä»–è·¯å¾„</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.end(&#x27;Welcome to the simple HTTP server!\n&#x27;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ ¹è·¯å¾„ç¤ºä¾‹</strong>ï¼šè®¿é—® <code>http://localhost:3000/</code>ä¼šè¿”å›æ¬¢è¿æ¶ˆæ¯</p></blockquote><h3 id="égetè¯·æ±‚"><a href="#égetè¯·æ±‚" class="headerlink" title="égetè¯·æ±‚"></a>égetè¯·æ±‚</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.writeHead(405, &#123;&#x27;Content-Type&#x27;: &#x27;text/plain&#x27;&#125;);</span><br><span class="line">res.end(&#x27;Method Not Allowed\n&#x27;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>çŠ¶æ€ç 405</strong>ï¼šè¡¨ç¤ºæœåŠ¡å™¨ä¸æ”¯æŒè¯¥è¯·æ±‚æ–¹æ³•ï¼ˆå¦‚POSTã€PUTç­‰ï¼‰</p><p><strong>ä¼šè¿”å›é”™è¯¯ä¿¡æ¯</strong> <code>Method Not Allowed</code></p></blockquote><h3 id="å¯åŠ¨æœåŠ¡å™¨"><a href="#å¯åŠ¨æœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨æœåŠ¡å™¨"></a>å¯åŠ¨æœåŠ¡å™¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.listen(3000, () =&gt; &#123;</span><br><span class="line">  console.log(&#x27;Server is listening on port 3000&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>æœåŠ¡å™¨ç›‘å¬æœ¬åœ°çš„3000ç«¯å£ï¼Œå¯åŠ¨åæ‰“å°æ—¥å¿—ã€‚</strong></p></blockquote><h2 id="è°ƒè¯•ä¸éƒ¨ç½²"><a href="#è°ƒè¯•ä¸éƒ¨ç½²" class="headerlink" title="è°ƒè¯•ä¸éƒ¨ç½²"></a>è°ƒè¯•ä¸éƒ¨ç½²</h2><h3 id="nodemonçƒ­é‡è½½"><a href="#nodemonçƒ­é‡è½½" class="headerlink" title="nodemonçƒ­é‡è½½"></a>nodemonçƒ­é‡è½½</h3><blockquote><p><code>nodemon</code>æ˜¯ä¸€ä¸ªç”¨äºNode.jsåº”ç”¨çš„å·¥å…·ï¼Œå®ƒå¯ä»¥ç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶åœ¨æ–‡ä»¶è¢«ä¿®æ”¹æ—¶è‡ªåŠ¨é‡å¯æœåŠ¡ï¼Œè¿™å¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡</p></blockquote><h3 id="PM2è¿›ç¨‹ç®¡ç†"><a href="#PM2è¿›ç¨‹ç®¡ç†" class="headerlink" title="PM2è¿›ç¨‹ç®¡ç†"></a>PM2è¿›ç¨‹ç®¡ç†</h3><blockquote><p><strong>å®ƒå¯ä»¥ä¿è¯ä½ çš„åº”ç”¨ç¨‹åºå§‹ç»ˆåœ¨çº¿ï¼Œå³ä½¿é‡åˆ°å´©æºƒä¹Ÿèƒ½è‡ªåŠ¨é‡å¯</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start app.js --name &quot;MyApi&quot;</span><br></pre></td></tr></table></figure><blockquote><p><code>app.js</code>å°±æ˜¯ä½ Node.jsåº”ç”¨çš„å…¥å£æ–‡ä»¶</p></blockquote><p><strong>å®‰è£…</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express nodemon pm2 --save</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mini-vueæ­å»ºç¬”è®°</title>
      <link href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/mini-vue%E6%90%AD%E5%BB%BA%E7%AC%94%E8%AE%B0/"/>
      <url>/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/mini-vue%E6%90%AD%E5%BB%BA%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="mini-vueæ­å»ºç¬”è®°"><a href="#mini-vueæ­å»ºç¬”è®°" class="headerlink" title="mini-vueæ­å»ºç¬”è®°"></a>mini-vueæ­å»ºç¬”è®°</h1><h1 id="åŸç†æ¦‚å†µ"><a href="#åŸç†æ¦‚å†µ" class="headerlink" title="åŸç†æ¦‚å†µ"></a>åŸç†æ¦‚å†µ</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/cuixiaorui/mini-vue</span><br></pre></td></tr></table></figure><h2 id="Vue3æ¨¡å—ç»„ç»‡æ–¹å¼"><a href="#Vue3æ¨¡å—ç»„ç»‡æ–¹å¼" class="headerlink" title="Vue3æ¨¡å—ç»„ç»‡æ–¹å¼"></a>Vue3æ¨¡å—ç»„ç»‡æ–¹å¼</h2><h3 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h3><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250219223855962.png?lastModify=1740547033" alt="image-20250219223855962"></p><h3 id="ç®€å•æ¥è¯´"><a href="#ç®€å•æ¥è¯´" class="headerlink" title="ç®€å•æ¥è¯´"></a>ç®€å•æ¥è¯´</h3><h4 id="å¤„ç†ç¼–è¯‘"><a href="#å¤„ç†ç¼–è¯‘" class="headerlink" title="å¤„ç†ç¼–è¯‘"></a>å¤„ç†ç¼–è¯‘</h4><blockquote><p><code>compiler-sfc</code>ä¸“é—¨è§£æsfc (ä½¿ç”¨rollup-vue<em><strong>æŠŠApp.vueå•æ–‡ä»¶ç»„ä»¶ç¼–è¯‘æˆJS</strong></em>)</p><p><code>compiler-dom</code>ä¾èµ–coreï¼Œå¤„ç†templateæ ‡ç­¾ï¼Œ<em><strong>æŠŠtemplateç¼–è¯‘è½¬åŒ–æˆä¸€ä¸ªrenderå‡½æ•°</strong></em></p><p><code>compiler-core</code>ç»™domæä¾›ä¾èµ–</p></blockquote><h4 id="å¤„ç†è¿è¡Œæ—¶"><a href="#å¤„ç†è¿è¡Œæ—¶" class="headerlink" title="å¤„ç†è¿è¡Œæ—¶"></a>å¤„ç†è¿è¡Œæ—¶</h4><blockquote><p><code>runtime-dom</code>ä¾èµ–core</p><p><code>runtime-core</code><em><strong>æœ€é‡ç‚¹çš„æ ¸å¿ƒä»£ç </strong></em></p><p><code>runtime-reactivity</code>å®ç°vueçš„<em><strong>å“åº”å¼</strong></em></p></blockquote><h3 id="æ›´ä¸ºè¯¦ç»†çš„"><a href="#æ›´ä¸ºè¯¦ç»†çš„" class="headerlink" title="æ›´ä¸ºè¯¦ç»†çš„"></a>æ›´ä¸ºè¯¦ç»†çš„</h3><h4 id="runtime-reactivity-å“åº”å¼ç³»ç»Ÿ"><a href="#runtime-reactivity-å“åº”å¼ç³»ç»Ÿ" class="headerlink" title="runtime-reactivity å“åº”å¼ç³»ç»Ÿ"></a>runtime-reactivity å“åº”å¼ç³»ç»Ÿ</h4><blockquote><p><strong>æä¾›äº†è¯¸å¦‚ reactiveã€ref ç­‰ API æ¥åˆ›å»ºå“åº”å¼å¯¹è±¡æˆ–å˜é‡ã€‚</strong> <strong>ä½¿ç”¨ WeakMap æ•°æ®ç»“æ„æ¥è·Ÿè¸ªä¾èµ–å…³ç³»ï¼Œç¡®ä¿å½“æ•°æ®å˜åŒ–æ—¶èƒ½å¤Ÿé€šçŸ¥ç›¸å…³çš„è§‚å¯Ÿè€…è¿›è¡Œæ›´æ–°ã€‚</strong> <strong>å®ç°äº† effect å‡½æ•°æœºåˆ¶ï¼Œç”¨äºè‡ªåŠ¨è¿½è¸ªå’Œè§¦å‘å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œã€‚</strong></p></blockquote><h4 id="runtime-core-è·¨å¹³å°æ¸²æŸ“"><a href="#runtime-core-è·¨å¹³å°æ¸²æŸ“" class="headerlink" title="runtime-core è·¨å¹³å°æ¸²æŸ“"></a>runtime-core è·¨å¹³å°æ¸²æŸ“</h4><blockquote><p><strong>Vue3 çš„è¿è¡Œæ—¶æ ¸å¿ƒæ¨¡å—ï¼Œæä¾›äº†è·¨å¹³å°çš„æ¸²æŸ“èƒ½åŠ›ã€‚å®ƒçš„ä¸»è¦èŒè´£åŒ…æ‹¬ï¼š</strong> <strong>å®šä¹‰äº†é€šç”¨çš„æ¸²æŸ“å™¨æ¥å£ createRendererï¼Œå…è®¸å¼€å‘è€…è‡ªå®šä¹‰æ¸²æŸ“é€»è¾‘ã€‚</strong> <strong>å®ç°äº†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€æ’æ§½æœºåˆ¶ä»¥åŠå…¶ä»–è¿è¡Œæ—¶æ‰€éœ€çš„åŸºç¡€åŠŸèƒ½ã€‚</strong> <strong>æä¾›äº†è¯¸å¦‚ h å‡½æ•°è¿™æ ·çš„å·¥å…·ï¼Œç”¨äºåˆ›å»ºè™šæ‹Ÿ DOM èŠ‚ç‚¹ã€‚</strong> <strong>åŒ…å«äº†ä¸å¹³å°æ— å…³çš„è¿è¡Œæ—¶æ ¸å¿ƒå®ç°ï¼ˆå¦‚è™šæ‹Ÿ DOM çš„æ¸²æŸ“å™¨ã€ç»„ä»¶å®ç°å’Œä¸€äº›å…¨å±€çš„ JS APIï¼‰ã€‚</strong></p></blockquote><h4 id="runtime-dom-DOMæ–¹æ³•"><a href="#runtime-dom-DOMæ–¹æ³•" class="headerlink" title="runtime-dom DOMæ–¹æ³•"></a>runtime-dom DOMæ–¹æ³•</h4><blockquote><p><strong>runtime-dom æ¨¡å—é’ˆå¯¹æµè§ˆå™¨ç¯å¢ƒå®ç°äº†å…·ä½“çš„è¿è¡Œæ—¶é€»è¾‘ã€‚å…¶ä¸»è¦ä»»åŠ¡æ˜¯ï¼š</strong> <strong>å°è£…äº†ä¸€ç³»åˆ—ä¸ DOM æ“ä½œç›¸å…³çš„å®ç”¨æ–¹æ³•ï¼Œå¦‚åˆ›å»ºå…ƒç´ ã€æ’å…¥èŠ‚ç‚¹ç­‰ã€‚</strong> <strong>æä¾›äº†ä¸€ä¸ªåŸºäº runtime-core çš„é»˜è®¤æ¸²æŸ“å™¨å®ä¾‹ï¼Œç”¨äºå°†è™šæ‹Ÿ DOM èŠ‚ç‚¹æ¸²æŸ“åˆ°çœŸå®çš„ DOM å®¹å™¨ä¸­ã€‚</strong> <strong>å¤„ç†ç‰¹å®šäºæµè§ˆå™¨çš„è¡Œä¸ºï¼Œæ¯”å¦‚å±æ€§ç»‘å®šã€äº‹ä»¶ç›‘å¬å™¨æ·»åŠ ç­‰ã€‚</strong> <strong>å¯¹åŸç”Ÿ DOM APIã€å±æ€§ã€æ ·å¼ã€äº‹ä»¶ç­‰è¿›è¡Œç®¡ç†ã€‚</strong></p></blockquote><h4 id="compiler-sfc-è§£æ-vueç»„ä»¶"><a href="#compiler-sfc-è§£æ-vueç»„ä»¶" class="headerlink" title="compiler-sfc è§£æ.vueç»„ä»¶"></a>compiler-sfc è§£æ.vueç»„ä»¶</h4><blockquote><p><strong>compiler-sfc æ¨¡å—è´Ÿè´£è§£æå•æ–‡ä»¶ç»„ä»¶ï¼ˆ.vue æ–‡ä»¶ï¼‰ï¼Œå®ƒå°† .vue æ–‡ä»¶ä¸­çš„ <strong><template></strong>ã€</strong><script>** å’Œ <strong><style></strong> éƒ¨åˆ†åˆ†åˆ«æå–å‡ºæ¥ï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚å…·ä½“è€Œè¨€ï¼š** <strong>å¯¹äº <strong><template></strong> éƒ¨åˆ†ï¼Œä¼šè°ƒç”¨ compiler-dom æ¥å°†å…¶ç¼–è¯‘ä¸ºæ¸²æŸ“å‡½æ•°ã€‚</strong> <strong>å¯¹äº <strong><script></strong> éƒ¨åˆ†ï¼Œå¯èƒ½ä¼šåšä¸€äº›é¢å¤–çš„å¤„ç†ï¼Œæ¯”å¦‚æ³¨å…¥ä¸Šä¸‹æ–‡æˆ–å¤„ç† TypeScript ç±»å‹å£°æ˜ã€‚</strong> <strong>å¯¹äº <strong><style></strong> éƒ¨åˆ†ï¼Œåˆ™å¯èƒ½æ¶‰åŠ CSS æ¨¡å—åŒ–å¤„ç†æˆ–è€…å…¶ä»–æ ·å¼ç›¸å…³çš„è½¬æ¢ã€‚</strong></p></blockquote><h4 id="compiler-core-ç¼–è¯‘é€»è¾‘å’Œç®—æ³•"><a href="#compiler-core-ç¼–è¯‘é€»è¾‘å’Œç®—æ³•" class="headerlink" title="compiler-core ç¼–è¯‘é€»è¾‘å’Œç®—æ³•"></a>compiler-core ç¼–è¯‘é€»è¾‘å’Œç®—æ³•</h4><blockquote><p><strong>ä½œä¸º Vue ç¼–è¯‘çš„æ ¸å¿ƒæ¨¡å—ï¼Œcompiler-core æ˜¯å¹³å°æ— å…³çš„ï¼Œæä¾›äº†åŸºç¡€çš„ç¼–è¯‘é€»è¾‘å’Œç®—æ³•ã€‚å®ƒçš„èŒè´£æ˜¯å®šä¹‰äº†ç¼–è¯‘çš„åŸºæœ¬æµç¨‹ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</strong> <strong>æä¾› baseParse å‡½æ•°ç”¨äºè§£ææ¨¡æ¿å­—ç¬¦ä¸²åˆ° ASTã€‚</strong> <strong>å®šä¹‰äº† transform æ–¹æ³•æ¥å¯¹ AST è¿›è¡Œè½¬æ¢ã€‚</strong> <strong>å®ç°äº† generate å‡½æ•°ç”¨æ¥ä» AST ç”Ÿæˆæœ€ç»ˆçš„æ¸²æŸ“å‡½æ•°ä»£ç ã€‚</strong> <strong>æä¾›äº†ä¸å¹³å°æ— å…³çš„ä»£ç è½¬æ¢æ’ä»¶ï¼Œé€‚ç”¨äºä¸åŒç±»å‹çš„ç¼–è¯‘éœ€æ±‚ã€‚</strong></p></blockquote><h4 id="compiler-dom-æµè§ˆå™¨æ¨¡æ¿ç¼–è¯‘"><a href="#compiler-dom-æµè§ˆå™¨æ¨¡æ¿ç¼–è¯‘" class="headerlink" title="compiler-dom æµè§ˆå™¨æ¨¡æ¿ç¼–è¯‘"></a>compiler-dom æµè§ˆå™¨æ¨¡æ¿ç¼–è¯‘</h4><blockquote><p><strong>è¯¥æ¨¡å—ä¸“æ³¨äºæµè§ˆå™¨ç«¯çš„æ¨¡æ¿ç¼–è¯‘å·¥ä½œã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</strong> <strong>æ¥æ”¶ Vue çš„æ¨¡æ¿å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥ï¼Œé€šè¿‡è°ƒç”¨ baseCompile å‡½æ•°æ¥æ‰§è¡Œå®é™…çš„ç¼–è¯‘è¿‡ç¨‹ã€‚</strong> <strong>å°†æ¨¡æ¿å­—ç¬¦ä¸²è§£æä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚</strong> <strong>å¯¹ AST è¿›è¡Œå¿…è¦çš„è½¬æ¢å’Œä¼˜åŒ–ã€‚</strong> <strong>æœ€ç»ˆç”Ÿæˆå¯æ‰§è¡Œçš„ JavaScript æ¸²æŸ“å‡½æ•°ä»£ç ï¼Œä»¥ä¾¿åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­è¿è¡Œã€‚</strong></p></blockquote><h1 id="runtime-reactivity-å“åº”å¼ç³»ç»Ÿ-1"><a href="#runtime-reactivity-å“åº”å¼ç³»ç»Ÿ-1" class="headerlink" title="runtime-reactivity å“åº”å¼ç³»ç»Ÿ"></a>runtime-reactivity å“åº”å¼ç³»ç»Ÿ</h1><h2 id="ä¸»æµç¨‹-è„‘å›¾"><a href="#ä¸»æµç¨‹-è„‘å›¾" class="headerlink" title="ä¸»æµç¨‹ | è„‘å›¾"></a>ä¸»æµç¨‹ | è„‘å›¾</h2><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250220163321605.png?lastModify=1740547033" alt="image-20250220163321605"></p><h3 id="reactive-å“åº”å¼è®¾ç½®"><a href="#reactive-å“åº”å¼è®¾ç½®" class="headerlink" title="reactive å“åº”å¼è®¾ç½®"></a>reactive å“åº”å¼è®¾ç½®</h3><blockquote><p><em><strong>reactivityæ ¸å¿ƒAPI</strong></em></p><p><strong><code>reactive()</code><strong>åˆ›å»º</strong>å¯¹è±¡ç±»å‹</strong>çš„å“åº”å¼æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive &#125; from &#x27;vue&#x27;;</span><br><span class="line">const state = reactive(&#123; count: 0 &#125;);</span><br><span class="line">state.count++; // ä¿®æ”¹åè§†å›¾è‡ªåŠ¨æ›´æ–°</span><br></pre></td></tr></table></figure><p><strong><code>ref()</code><strong>åˆ›å»º</strong>ä»»æ„ç±»å‹</strong>çš„å“åº”å¼æ•°æ®ï¼ˆé€šè¿‡ <code>.value</code> è®¿é—®ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">const num = ref(0);</span><br><span class="line">num.value = 10; // ä¿®æ”¹éœ€ä½¿ç”¨ .value</span><br></pre></td></tr></table></figure><p>**<code>computed()</code>**åˆ›å»ºä¾èµ–å…¶ä»–æ•°æ®çš„è®¡ç®—å±æ€§ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const doubleCount = computed(() =&gt; state.count * 2);</span><br></pre></td></tr></table></figure><p>**<code>watch()</code> å’Œ <code>watchEffect()</code>**ç›‘å¬æ•°æ®å˜åŒ–æ‰§è¡Œå‰¯ä½œç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">watch(num, (newVal) =&gt; console.log(&#x27;numå˜åŒ–:&#x27;, newVal));</span><br><span class="line">watchEffect(() =&gt; console.log(&#x27;countå˜åŒ–:&#x27;, state.count));</span><br></pre></td></tr></table></figure></blockquote><h4 id="reactive-å•æµ‹"><a href="#reactive-å•æµ‹" class="headerlink" title="reactive å•æµ‹"></a>reactive å•æµ‹</h4><p><strong>reactivity / tests / reactive.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive, isReactive, toRaw, reactiveMap &#125; from &quot;../src/reactive&quot;;</span><br></pre></td></tr></table></figure><blockquote><p><code>reactive</code>: å°†æ™®é€šå¯¹è±¡è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡ã€‚** <strong><code>isReactive</code>: æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯å“åº”å¼å¯¹è±¡ã€‚</strong> <strong><code>toRaw</code>: è·å–å“åº”å¼å¯¹è±¡å¯¹åº”çš„åŸå§‹å¯¹è±¡ã€‚</strong> **<code>reactiveMap</code>: å†…éƒ¨ä½¿ç”¨çš„ Map æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨åŸå§‹å¯¹è±¡å’Œå“åº”å¼å¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">describe(&quot;reactive&quot;, () =&gt; &#123;</span><br><span class="line">  test(&quot;Object&quot;, () =&gt; &#123;//æµ‹è¯•ç”¨ä¾‹1 | åŸºæœ¬åŠŸèƒ½ï¼šç¡®ä¿ reactive æ–¹æ³•èƒ½å¤Ÿæ­£ç¡®åœ°å°†æ™®é€šå¯¹è±¡è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡ã€‚</span><br><span class="line">    const original = &#123; foo: 1 &#125;;</span><br><span class="line">    const observed = reactive(original);//å°†æ™®é€šå¯¹è±¡è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡</span><br><span class="line">    expect(observed).not.toBe(original);//ç¡®ä¿ reactive è¿”å›çš„å¯¹è±¡ä¸åŸå§‹å¯¹è±¡ä¸æ˜¯åŒä¸€ä¸ªå¼•ç”¨</span><br><span class="line">    expect(isReactive(observed)).toBe(true);//éªŒè¯ observed æ˜¯å“åº”å¼å¯¹è±¡</span><br><span class="line">    expect(isReactive(original)).toBe(false);//è€Œ original ä¸æ˜¯</span><br><span class="line">    expect(observed.foo).toBe(1);//å¯è¯»å–</span><br><span class="line">    expect(&quot;foo&quot; in observed).toBe(true);//å­˜åœ¨</span><br><span class="line">    expect(Object.keys(observed)).toEqual([&quot;foo&quot;]);//è‡ªæœ‰å±æ€§é”®å</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  test(&quot;nested reactives&quot;, () =&gt; &#123;//æµ‹è¯•ç”¨ä¾‹2 | åµŒå¥—å¯¹è±¡æ”¯æŒï¼šç¡®ä¿åµŒå¥—å¯¹è±¡å’Œæ•°ç»„ä¹Ÿèƒ½è¢«æ­£ç¡®è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡ã€‚</span><br><span class="line">    const original = &#123;//å®šä¹‰ä¸€ä¸ªå¤æ‚å¯¹è±¡</span><br><span class="line">      nested: &#123;//åµŒå¥—å¯¹è±¡</span><br><span class="line">        foo: 1,</span><br><span class="line">      &#125;,</span><br><span class="line">      array: [&#123; bar: 2 &#125;],//æ•°ç»„</span><br><span class="line">    &#125;;</span><br><span class="line">    const observed = reactive(original);//å°†å¤æ‚å¯¹è±¡è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡</span><br><span class="line">    expect(isReactive(observed.nested)).toBe(true);</span><br><span class="line">    expect(isReactive(observed.array)).toBe(true);</span><br><span class="line">    expect(isReactive(observed.array[0])).toBe(true);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  test(&quot;toRaw&quot;, () =&gt; &#123;//æµ‹è¯•ç”¨ä¾‹3 | toRaw æ–¹æ³•ï¼šç¡®ä¿å¯ä»¥æ­£ç¡®åœ°ä»å“åº”å¼å¯¹è±¡ä¸­è·å–åŸå§‹å¯¹è±¡ã€‚</span><br><span class="line">    const original = &#123; foo: 1 &#125;;</span><br><span class="line">    const observed = reactive(original);</span><br><span class="line">    expect(toRaw(observed)).toBe(original);//ç¡®ä¿é€šè¿‡ toRaw æ–¹æ³•å¯ä»¥ä»å“åº”å¼å¯¹è±¡ observed ä¸­è·å–åŸå§‹å¯¹è±¡ original</span><br><span class="line">    expect(toRaw(original)).toBe(original);//å¦‚æœç›´æ¥å¯¹åŸå§‹å¯¹è±¡è°ƒç”¨ toRawï¼Œåº”è¯¥è¿”å›åŸå§‹å¯¹è±¡æœ¬èº«</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="reactive-æºç å®ç°ï¼ˆProxyï¼‰"><a href="#reactive-æºç å®ç°ï¼ˆProxyï¼‰" class="headerlink" title="reactive æºç å®ç°ï¼ˆProxyï¼‰"></a>reactive æºç å®ç°ï¼ˆ<em>Proxy</em>ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function reactive(target) &#123;</span><br><span class="line">  return createReactiveObject(target, reactiveMap, mutableHandlers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ğŸ‘‡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function createReactiveObject(target, proxyMap, baseHandlers) &#123;//åŸç†æ˜¯JSåˆ›å»ºçš„Proxyå¯¹è±¡ï¼Œç›®çš„æ˜¯å¯ä»¥ä¾¦å¬åˆ°ç”¨æˆ· get æˆ–è€… set çš„åŠ¨ä½œ</span><br><span class="line">    </span><br><span class="line">  const existingProxy = proxyMap.get(target);//å…ˆæ£€æŸ¥ proxyMap ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ä¸å½“å‰ target å¯¹åº”çš„ä»£ç†å¯¹è±¡ã€‚</span><br><span class="line">  if (existingProxy) &#123;//å­˜åœ¨åˆ™ç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„ä»£ç†å¯¹è±¡ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚</span><br><span class="line">    return existingProxy;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //target è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡</span><br><span class="line">  //baseHandlers ä¸€ä¸ªæ‹¦æˆªå™¨å¯¹è±¡ï¼Œå®šä¹‰äº†ä»£ç†çš„è¡Œä¸ºï¼ˆä¾‹å¦‚å¦‚ä½•å¤„ç† get å’Œ set æ“ä½œï¼‰</span><br><span class="line">  const proxy = new Proxy(target, baseHandlers);</span><br><span class="line"></span><br><span class="line">  proxyMap.set(target, proxy);//æŠŠåˆ›å»ºå¥½çš„ proxy ç»™å­˜èµ·æ¥</span><br><span class="line">  return proxy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>å¦ï¼šå›é¡¾ProxyåŠŸèƒ½ | å¯åœ¨ç”¨æˆ·å¯¹ç›®æ ‡å¯¹è±¡çš„</strong>***è®¿é—®(get)<em><strong>å’Œ</strong></em>ä¿®æ”¹(set)***æ“ä½œä¸­ï¼Œè‡ªå®šä¹‰é€»è¾‘ï¼ˆå¦‚è§¦å‘ä¾èµ–æ›´æ–°ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// å®šä¹‰ä¸€ä¸ªç›®æ ‡å¯¹è±¡</span><br><span class="line">const target = &#123; count: 0 &#125;;</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºä¸€ä¸ª Proxy å¯¹è±¡</span><br><span class="line">const reactiveObj = new Proxy(target, &#123;</span><br><span class="line">get(target, key, receiver) &#123;</span><br><span class="line">console.log(`Getting $&#123;key&#125;`);</span><br><span class="line">return Reflect.get(target, key, receiver);</span><br><span class="line">&#125;,</span><br><span class="line">set(target, key, value, receiver) &#123;</span><br><span class="line">console.log(`Setting $&#123;key&#125; to $&#123;value&#125;`);</span><br><span class="line">const result = Reflect.set(target, key, value, receiver);</span><br><span class="line">if (result) &#123;</span><br><span class="line">console.log(&quot;Trigger updates...&quot;);</span><br><span class="line">&#125;</span><br><span class="line">return result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// æµ‹è¯•</span><br><span class="line">console.log(reactiveObj.count); // è¾“å‡º: Getting count</span><br><span class="line">reactiveObj.count++; // è¾“å‡º: Setting count to 1 å’Œ Trigger updates...</span><br></pre></td></tr></table></figure></blockquote><h3 id="init-åˆå§‹åŒ–"><a href="#init-åˆå§‹åŒ–" class="headerlink" title="init åˆå§‹åŒ–"></a>init åˆå§‹åŒ–</h3><h4 id="effect-å•æµ‹"><a href="#effect-å•æµ‹" class="headerlink" title="effect å•æµ‹"></a>effect å•æµ‹</h4><blockquote><p><em><strong>effect å‡½æ•°åŠŸèƒ½</strong></em></p><p><strong>å½“ä¾èµ–çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè‡ªåŠ¨é‡æ–°æ‰§è¡ŒæŒ‡å®šçš„å‡½æ•°ã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive, effect &#125; from &#x27;@vue/reactivity&#x27;;</span><br><span class="line"></span><br><span class="line">const state = reactive(&#123; count: 0 &#125;);</span><br><span class="line"></span><br><span class="line">// effectå‡½æ•°</span><br><span class="line">effect(() =&gt; &#123;</span><br><span class="line">console.log(`Count is $&#123;state.count&#125;`);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// ä¿®æ”¹çŠ¶æ€</span><br><span class="line">state.count++; // è¾“å‡º: Count is 1</span><br><span class="line">state.count++; // è¾“å‡º: Count is 2</span><br></pre></td></tr></table></figure><p>**æ‰‹åŠ¨åœæ­¢ **<code>effect</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºä¸€ä¸ª effect å¹¶è·å–åœæ­¢å‡½æ•°</span><br><span class="line">const stop = effect(() =&gt; &#123;</span><br><span class="line">console.log(`Count is $&#123;state.count&#125;`);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// ä¿®æ”¹çŠ¶æ€</span><br><span class="line">state.count++; // è¾“å‡º: Count is 1</span><br><span class="line">// åœæ­¢ effect</span><br><span class="line">stop();</span><br><span class="line">// å†æ¬¡ä¿®æ”¹çŠ¶æ€ï¼Œä½† effect ä¸å†è§¦å‘</span><br><span class="line">state.count++; // æ— è¾“å‡º</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive &#125; from &quot;../src/reactive&quot;;</span><br><span class="line">import &#123; effect, stop &#125; from &quot;../src/effect&quot;;</span><br><span class="line">import &#123; vi &#125; from &quot;vitest&quot;;</span><br><span class="line"></span><br><span class="line">describe(&quot;effect&quot;, () =&gt; &#123;</span><br><span class="line">  it(&quot;should run the passed function once (wrapped by a effect)&quot;, () =&gt; &#123; //éªŒè¯ effect å‡½æ•°æ˜¯å¦ä¼šç«‹å³æ‰§è¡Œä¼ å…¥çš„å‡½æ•°ä¸€æ¬¡</span><br><span class="line">    const fnSpy = vi.fn(() =&gt; &#123;&#125;);//åˆ›å»ºä¸€ä¸ªé—´è°å‡½æ•°fnSpy</span><br><span class="line">    effect(fnSpy);//fnSpyä½œä¸ºå‚æ•°ä¼ é€’ç»™effectå‡½æ•°</span><br><span class="line">    expect(fnSpy).toHaveBeenCalledTimes(1);//éªŒè¯fnSpyæ˜¯å¦è¢«è°ƒç”¨äº†ä¸€æ¬¡</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should observe basic properties&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿè§‚å¯Ÿåˆ°å“åº”å¼å¯¹è±¡çš„åŸºæœ¬å±æ€§çš„å˜åŒ–</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; num: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = counter.num));//ä½¿ç”¨ effect å‡½æ•°åŒ…è£¹ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œè¯¥å‡½æ•°å°† counter.num çš„å€¼èµ‹ç»™ dummyã€‚</span><br><span class="line">    </span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.num = 7;</span><br><span class="line">    expect(dummy).toBe(7);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should observe multiple properties&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿè§‚å¯Ÿåˆ°å“åº”å¼å¯¹è±¡çš„å¤šä¸ªå±æ€§çš„å˜åŒ–</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; num1: 0, num2: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = counter.num1 + counter.num1 + counter.num2));</span><br><span class="line">    </span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.num1 = counter.num2 = 7;</span><br><span class="line">    expect(dummy).toBe(21);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should handle multiple effects&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿå¤„ç†å¤šä¸ªå“åº”å¼ä¾èµ–</span><br><span class="line">    let dummy1, dummy2;</span><br><span class="line">    const counter = reactive(&#123; num: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy1 = counter.num));</span><br><span class="line">    effect(() =&gt; (dummy2 = counter.num));</span><br><span class="line"></span><br><span class="line">    expect(dummy1).toBe(0);</span><br><span class="line">    expect(dummy2).toBe(0);</span><br><span class="line">    counter.num++;</span><br><span class="line">    expect(dummy1).toBe(1);</span><br><span class="line">    expect(dummy2).toBe(1);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should observe nested properties&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿè§‚å¯Ÿåˆ°åµŒå¥—å±æ€§çš„å˜åŒ–</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; nested: &#123; num: 0 &#125; &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = counter.nested.num));</span><br><span class="line"></span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.nested.num = 8;</span><br><span class="line">    expect(dummy).toBe(8);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;should observe function call chains&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿè§‚å¯Ÿåˆ°å‡½æ•°è°ƒç”¨é“¾çš„å˜åŒ–</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; num: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = getNum()));</span><br><span class="line"></span><br><span class="line">    function getNum() &#123;</span><br><span class="line">      return counter.num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.num = 2;</span><br><span class="line">    expect(dummy).toBe(2);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;scheduler&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°è°ƒç”¨ scheduler å‡½æ•°</span><br><span class="line">    let dummy;</span><br><span class="line">    let run: any;</span><br><span class="line">    const scheduler = vi.fn(() =&gt; &#123;</span><br><span class="line">      run = runner;</span><br><span class="line">    &#125;);</span><br><span class="line">    const obj = reactive(&#123; foo: 1 &#125;);</span><br><span class="line">    const runner = effect(</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        dummy = obj.foo;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; scheduler &#125;</span><br><span class="line">    );</span><br><span class="line">    expect(scheduler).not.toHaveBeenCalled();</span><br><span class="line">    expect(dummy).toBe(1);</span><br><span class="line">    // should be called on first trigger</span><br><span class="line">    obj.foo++;</span><br><span class="line">    expect(scheduler).toHaveBeenCalledTimes(1);</span><br><span class="line">    // // should not run yet</span><br><span class="line">    expect(dummy).toBe(1);</span><br><span class="line">    // // manually run</span><br><span class="line">    run();</span><br><span class="line">    // // should have run</span><br><span class="line">    expect(dummy).toBe(2);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;stop&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°åœæ­¢è§‚å¯Ÿ</span><br><span class="line">    let dummy;</span><br><span class="line">    const obj = reactive(&#123; prop: 1 &#125;);</span><br><span class="line">    const runner = effect(() =&gt; &#123;</span><br><span class="line">      dummy = obj.prop;</span><br><span class="line">    &#125;);</span><br><span class="line">    obj.prop = 2;</span><br><span class="line">    expect(dummy).toBe(2);</span><br><span class="line">    stop(runner);</span><br><span class="line">    // obj.prop = 3</span><br><span class="line">    obj.prop++;</span><br><span class="line">    expect(dummy).toBe(2);</span><br><span class="line"></span><br><span class="line">    // stopped effect should still be manually callable</span><br><span class="line">    runner();</span><br><span class="line">    expect(dummy).toBe(3);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;events: onStop&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°è§¦å‘ onStop äº‹ä»¶</span><br><span class="line">    const onStop = vi.fn();</span><br><span class="line">    const runner = effect(() =&gt; &#123;&#125;, &#123;</span><br><span class="line">      onStop,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    stop(runner);</span><br><span class="line">    expect(onStop).toHaveBeenCalled();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="effect-æºç å®ç°"><a href="#effect-æºç å®ç°" class="headerlink" title="effect æºç å®ç°"></a>effect æºç å®ç°</h4><p><strong>effectå‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">export function effect(fn, options = &#123;&#125;) &#123;</span><br><span class="line">    //fnï¼šç”¨æˆ·ä¼ å…¥çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œè¯¥å‡½æ•°å†…éƒ¨é€šå¸¸ä¼šè®¿é—®å“åº”å¼æ•°æ®ï¼Œå½“è¿™äº›å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œfn ä¼šè¢«é‡æ–°æ‰§è¡Œã€‚</span><br><span class="line">    //optionsï¼šä¸€ä¸ªå¯é€‰çš„é…ç½®å¯¹è±¡ï¼Œé»˜è®¤å€¼ä¸ºç©ºå¯¹è±¡ &#123;&#125;ã€‚</span><br><span class="line">    const _effect = new ReactiveEffect(fn);</span><br><span class="line"></span><br><span class="line">    extend(_effect, options);//å°†ç”¨æˆ·ä¼ å…¥çš„ options é…ç½®å¯¹è±¡åˆå¹¶åˆ°_effect å®ä¾‹ä¸Šï¼Œä½†ä¸å®¹æ˜“ç›´æ¥çœ‹å‡º _effect å®ä¾‹ä¸Šæœ‰å“ªäº›é¢å¤–çš„å±æ€§</span><br><span class="line">    _effect.run();//è°ƒç”¨å†…éƒ¨runæ–¹æ³•</span><br><span class="line"></span><br><span class="line">    // å°† _effect.run æ–¹æ³•ç»‘å®šåˆ° _effect å®ä¾‹ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•° runner</span><br><span class="line">    // å½“è°ƒç”¨ runner å‡½æ•°æ—¶ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨ _effect.run æ–¹æ³•</span><br><span class="line">    const runner: any = _effect.run.bind(_effect);</span><br><span class="line">    //åœ¨ runner å‡½æ•°ä¸Šæ·»åŠ ä¸€ä¸ª effect å±æ€§ï¼ŒæŒ‡å‘ _effect å®ä¾‹</span><br><span class="line">    runner.effect = _effect;</span><br><span class="line">    return runner;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ‰§è¡Œfn"><a href="#æ‰§è¡Œfn" class="headerlink" title="æ‰§è¡Œfn"></a>æ‰§è¡Œfn</h5><p><strong>ReactiveEffectç±»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">export class ReactiveEffect &#123;</span><br><span class="line">  active = true; //æ ‡è®°è¯¥å‰¯ä½œç”¨å‡½æ•°æ˜¯å¦å¤„äºæ´»è·ƒçŠ¶æ€</span><br><span class="line">  deps = []; //å­˜å‚¨è¯¥å‰¯ä½œç”¨å‡½æ•°çš„æ‰€æœ‰ä¾èµ–é¡¹</span><br><span class="line">  public onStop?: () =&gt; void; //å‰¯ä½œç”¨å‡½æ•°åœæ­¢æ—¶çš„å›è°ƒ</span><br><span class="line">  constructor(public fn, public scheduler?) &#123;</span><br><span class="line">    console.log(&quot;åˆ›å»º ReactiveEffect å¯¹è±¡&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  run() &#123;</span><br><span class="line">    console.log(&quot;run&quot;);</span><br><span class="line">      </span><br><span class="line">    //å¦‚æœ this.active ä¸º falseï¼Œè¡¨ç¤ºè¯¥å‰¯ä½œç”¨å‡½æ•°å·²ç»è¢«åœæ­¢ï¼ˆè°ƒç”¨äº† stop æ–¹æ³•ï¼‰ï¼Œæ­¤æ—¶ç›´æ¥æ‰§è¡Œ this.fn() å¹¶è¿”å›ç»“æœï¼Œä¸è¿›è¡Œä¾èµ–æ”¶é›†ã€‚</span><br><span class="line">    if (!this.active) &#123;</span><br><span class="line">      return this.fn();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    shouldTrack = true;//å…¨å±€å˜é‡ï¼Œæ§åˆ¶æ˜¯å¦è¿›è¡Œä¾èµ–æ”¶é›†ã€‚trueè¡¨ç¤ºå¼€å§‹æ”¶é›†ä¾èµ–ã€‚</span><br><span class="line">    activeEffect = this as any;//å…¨å±€å˜é‡ï¼Œå­˜å‚¨å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°ã€‚thisè¡¨ç¤ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°æ˜¯ ReactiveEffect çš„å®ä¾‹ã€‚</span><br><span class="line">      </span><br><span class="line">    console.log(&quot;æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„ fn&quot;);</span><br><span class="line">    const result = this.fn();</span><br><span class="line"></span><br><span class="line">    shouldTrack = false;//åœæ­¢ä¾èµ–æ”¶é›†ã€‚</span><br><span class="line">    activeEffect = undefined;//å½“å‰æ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°ã€‚</span><br><span class="line"></span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  stop() &#123;</span><br><span class="line">    if (this.active) &#123;//è¯¥å‰¯ä½œç”¨å‡½æ•°å·²ç»è¢«åœæ­¢</span><br><span class="line">      // å¦‚æœç¬¬ä¸€æ¬¡æ‰§è¡Œ stop å active å°± false äº†ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢é‡å¤çš„è°ƒç”¨ï¼Œæ‰§è¡Œ stop é€»è¾‘</span><br><span class="line">      cleanupEffect(this);//ä»æ‰€æœ‰ä¾èµ–è¯¥å‰¯ä½œç”¨å‡½æ•°çš„å“åº”å¼å¯¹è±¡ä¸­ç§»é™¤è¯¥å‰¯ä½œç”¨å‡½æ•°ï¼Œä»è€Œåœæ­¢å“åº”å¼è¿½è¸ª</span><br><span class="line">      if (this.onStop) &#123;//this.onStop å­˜åœ¨ï¼Œåˆ™è°ƒç”¨è¯¥å›è°ƒå‡½æ•°ï¼Œå…è®¸ç”¨æˆ·åœ¨å‰¯ä½œç”¨å‡½æ•°åœæ­¢æ—¶æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘</span><br><span class="line">        this.onStop();</span><br><span class="line">      &#125;</span><br><span class="line">      this.active = false;//å‰¯ä½œç”¨å‡½æ•°å·²ç»åœæ­¢</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="è§¦å‘get-è®¿é—®"><a href="#è§¦å‘get-è®¿é—®" class="headerlink" title="è§¦å‘get(è®¿é—®)"></a>è§¦å‘get(è®¿é—®)</h5><h5 id="æ‰§è¡Œtrack-æ”¶é›†ä¾èµ–"><a href="#æ‰§è¡Œtrack-æ”¶é›†ä¾èµ–" class="headerlink" title="æ‰§è¡Œtrack(æ”¶é›†ä¾èµ–)"></a>æ‰§è¡Œtrack(æ”¶é›†ä¾èµ–)</h5><h5 id="æŠŠeffectæ”¶é›†èµ·æ¥ä½œä¸ºä¾èµ–"><a href="#æŠŠeffectæ”¶é›†èµ·æ¥ä½œä¸ºä¾èµ–" class="headerlink" title="æŠŠeffectæ”¶é›†èµ·æ¥ä½œä¸ºä¾èµ–"></a>æŠŠeffectæ”¶é›†èµ·æ¥ä½œä¸ºä¾èµ–</h5><h3 id="update-æ›´æ–°"><a href="#update-æ›´æ–°" class="headerlink" title="update æ›´æ–°"></a>update æ›´æ–°</h3><h4 id="ä¾‹ï¼šeffect-å•æµ‹"><a href="#ä¾‹ï¼šeffect-å•æµ‹" class="headerlink" title="ä¾‹ï¼šeffect å•æµ‹"></a>ä¾‹ï¼šeffect å•æµ‹</h4><h5 id="è§¦å‘set-ä¿®æ”¹"><a href="#è§¦å‘set-ä¿®æ”¹" class="headerlink" title="è§¦å‘set(ä¿®æ”¹)"></a>è§¦å‘set(ä¿®æ”¹)</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">it(&quot;should observe basic properties&quot;, () =&gt; &#123;//éªŒè¯ effect å‡½æ•°æ˜¯å¦èƒ½å¤Ÿè§‚å¯Ÿåˆ°å“åº”å¼å¯¹è±¡çš„åŸºæœ¬å±æ€§çš„å˜åŒ–</span><br><span class="line">    let dummy;</span><br><span class="line">    const counter = reactive(&#123; num: 0 &#125;);</span><br><span class="line">    effect(() =&gt; (dummy = counter.num));</span><br><span class="line"></span><br><span class="line">    expect(dummy).toBe(0);</span><br><span class="line">    counter.num = 7;// æ›´æ–°æ—¶è§¦å‘setæ“ä½œ</span><br><span class="line">    expect(dummy).toBe(7);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="æ‰§è¡Œtrigger-è§¦å‘ä¾èµ–"><a href="#æ‰§è¡Œtrigger-è§¦å‘ä¾èµ–" class="headerlink" title="æ‰§è¡Œtrigger(è§¦å‘ä¾èµ–)"></a>æ‰§è¡Œtrigger(è§¦å‘ä¾èµ–)</h5><p><strong>baseHandlers.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function createSetter() &#123;</span><br><span class="line">    return function set(target, key, value, receiver) &#123;</span><br><span class="line">        const result = Reflect.set(target, key, value, receiver)</span><br><span class="line"></span><br><span class="line">        trigger(target, &#x27;set&#x27;, key)// è§¦å‘triggeråé‡æ–°è¿è¡Œeffectå‡½æ•°</span><br><span class="line"></span><br><span class="line">        return result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="effecté‡æ–°è¿è¡Œ"><a href="#effecté‡æ–°è¿è¡Œ" class="headerlink" title="effecté‡æ–°è¿è¡Œ"></a>effecté‡æ–°è¿è¡Œ</h5><blockquote><p><strong>æ‰§è¡Œfn-&gt;è§¦å‘get(è®¿é—®)-&gt;æ‰§è¡Œtrack(æ”¶é›†ä¾èµ–)-&gt;æŠŠeffectæ”¶é›†èµ·æ¥ä½œä¸ºä¾èµ–</strong></p></blockquote><h2 id="baseHandlers-è„‘å›¾"><a href="#baseHandlers-è„‘å›¾" class="headerlink" title="baseHandlers | è„‘å›¾"></a>baseHandlers | è„‘å›¾</h2><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250220164149032.png?lastModify=1740547033" alt="image-20250220164149032"></p><p><strong>ç›´è¾¾src / baseHandlers.ts</strong></p><h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">function createGetter(isReadonly = false, shallow = false) &#123;</span><br><span class="line">  return function get(target, key, receiver) &#123;</span><br><span class="line">    //è¿™äº›è¾…åŠ©å‡½æ•°ç”¨äºæ£€æŸ¥ key æ˜¯å¦ä¸º ReactiveFlags.RAWï¼Œå¹¶ä¸” receiver æ˜¯å¦ä¸ç›¸åº”çš„æ˜ å°„è¡¨ï¼ˆreactiveMapã€readonlyMap æˆ– shallowReadonlyMapï¼‰ä¸­çš„ç›®æ ‡å¯¹è±¡åŒ¹é…ã€‚</span><br><span class="line">    const isExistInReactiveMap = () =&gt;</span><br><span class="line">      key === ReactiveFlags.RAW &amp;&amp; receiver === reactiveMap.get(target);</span><br><span class="line"></span><br><span class="line">    const isExistInReadonlyMap = () =&gt;</span><br><span class="line">      key === ReactiveFlags.RAW &amp;&amp; receiver === readonlyMap.get(target);</span><br><span class="line"></span><br><span class="line">    const isExistInShallowReadonlyMap = () =&gt;</span><br><span class="line">      key === ReactiveFlags.RAW &amp;&amp; receiver === shallowReadonlyMap.get(target);</span><br><span class="line"></span><br><span class="line">    if (key === ReactiveFlags.IS_REACTIVE) &#123;//è¡¨ç¤ºå¯¹è±¡æ˜¯å¦ä¸ºå“åº”å¼å¯¹è±¡ã€‚</span><br><span class="line">      return !isReadonly;</span><br><span class="line">    &#125; else if (key === ReactiveFlags.IS_READONLY) &#123;</span><br><span class="line">      return isReadonly;</span><br><span class="line">    &#125; else if (//è¡¨ç¤ºå¯¹è±¡æ˜¯å¦ä¸ºåªè¯»å¯¹è±¡ã€‚</span><br><span class="line">      isExistInReactiveMap() ||</span><br><span class="line">      isExistInReadonlyMap() ||</span><br><span class="line">      isExistInShallowReadonlyMap()</span><br><span class="line">    ) &#123;</span><br><span class="line">      return target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å‡è®¾obj=&#123;foo:1&#125; key:foo -&gt; res = 1 reså°±æ˜¯ç›®æ ‡å¯¹è±¡çš„å±æ€§å€¼//</span><br><span class="line">    const res = Reflect.get(target, key, receiver);</span><br><span class="line"></span><br><span class="line">    if (!isReadonly) &#123;//å¦‚æœå¯¹è±¡ä¸æ˜¯åªè¯»çš„ï¼Œè°ƒç”¨ track å‡½æ•°è¿›è¡Œä¾èµ–æ”¶é›†ã€‚åªè¯»å¯¹è±¡ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä¹Ÿå°±ä¸ä¼šè§¦å‘ trigger å‡½æ•°ï¼Œæ‰€ä»¥ä¸éœ€è¦æ”¶é›†ä¾èµ–ã€‚</span><br><span class="line">      // åœ¨è§¦å‘ get çš„æ—¶å€™è¿›è¡Œä¾èµ–æ”¶é›†</span><br><span class="line">      track(target, &quot;get&quot;, key);//è§¦å‘track</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (shallow) &#123;//å¦‚æœæ˜¯æµ…å“åº”å¼æ¨¡å¼ï¼Œç›´æ¥è¿”å›å±æ€§å€¼ï¼Œä¸è¿›è¡Œé€’å½’å¤„ç†</span><br><span class="line">      return res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (isObject(res)) &#123;//å¦‚æœå±æ€§å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ ¹æ® isReadonly çš„å€¼ï¼Œå°†å…¶è½¬æ¢ä¸ºåªè¯»å“åº”å¼å¯¹è±¡æˆ–æ™®é€šå“åº”å¼å¯¹è±¡</span><br><span class="line">      // res ç­‰äº target[key]</span><br><span class="line">      return isReadonly ? readonly(res) : reactive(res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return res;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function createSetter() &#123;</span><br><span class="line">    return function set(target, key, value, receiver) &#123;</span><br><span class="line">         //å‡è®¾obj=&#123;foo:1&#125; key:foo -&gt; valueå¯å˜2//</span><br><span class="line">         //obj=&#123;foo:2&#125;//</span><br><span class="line">        const result = Reflect.set(target, key, value, receiver)//è®¾ç½®å¯¹è±¡çš„å±æ€§å€¼</span><br><span class="line"></span><br><span class="line">        trigger(target, &#x27;set&#x27;, key)//triggerå‡½æ•°ä¼šé€šçŸ¥æ‰€æœ‰ä¾èµ–è¯¥å±æ€§çš„å‰¯ä½œç”¨å‡½æ•°é‡æ–°æ‰§è¡Œï¼Œä»¥ç¡®ä¿å“åº”å¼ç³»ç»Ÿèƒ½å¤Ÿæ­£ç¡®æ›´æ–°ç›¸å…³çš„è§†å›¾æˆ–æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">        return result//è®¾ç½®å®Œæˆï¼Œè¿”å›ç»“æœ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="deleteProperty"><a href="#deleteProperty" class="headerlink" title="deleteProperty"></a>deleteProperty</h3><h3 id="has"><a href="#has" class="headerlink" title="has"></a>has</h3><h3 id="ownKeys"><a href="#ownKeys" class="headerlink" title="ownKeys"></a>ownKeys</h3><h2 id="track-æ”¶é›†ä¾èµ–-è„‘å›¾"><a href="#track-æ”¶é›†ä¾èµ–-è„‘å›¾" class="headerlink" title="track(æ”¶é›†ä¾èµ–) | è„‘å›¾"></a>track(æ”¶é›†ä¾èµ–) | è„‘å›¾</h2><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250220212111915.png?lastModify=1740547033" alt="image-20250220212111915"></p><h3 id="åˆå§‹åŒ–dep"><a href="#åˆå§‹åŒ–dep" class="headerlink" title="åˆå§‹åŒ–dep"></a>åˆå§‹åŒ–dep</h3><p><strong>src / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">export function track(target, type, key) &#123;</span><br><span class="line">    //targetï¼šå“åº”å¼å¯¹è±¡ï¼Œå³è¢«ä»£ç†çš„åŸå§‹å¯¹è±¡ã€‚</span><br><span class="line">    //typeï¼šæ“ä½œç±»å‹ï¼Œä¾‹å¦‚ GETã€SET ç­‰ï¼Œä¸è¿‡åœ¨å½“å‰ä»£ç ä¸­ï¼Œtype å‚æ•°æœªè¢«ä½¿ç”¨ã€‚</span><br><span class="line">    //keyï¼šå“åº”å¼å¯¹è±¡çš„å±æ€§åã€‚</span><br><span class="line">    if (!isTracking()) &#123;//å½“å‰æ˜¯å¦å…è®¸è¿›è¡Œä¾èµ–æ”¶é›†</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(`è§¦å‘ track -&gt; target: $&#123;target&#125; type:$&#123;type&#125; key:$&#123;key&#125;`);</span><br><span class="line">    </span><br><span class="line">    let depsMap = targetMap.get(target);//targetMap æ˜¯ä¸€ä¸ª WeakMapï¼Œç”¨äºå­˜å‚¨æ¯ä¸ªå“åº”å¼å¯¹è±¡å¯¹åº”çš„ depsMap</span><br><span class="line">    if (!depsMap) &#123;// å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡çš„è¯ï¼Œåˆå§‹åŒ– depsMap çš„é€»è¾‘</span><br><span class="line">        depsMap = new Map();// åˆ›å»ºä¸€ä¸ªæ–°çš„ Map å®ä¾‹</span><br><span class="line">        targetMap.set(target, depsMap);//å­˜å‚¨åˆ° targetMap ä¸­</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let dep = depsMap.get(key);//depsMap æ˜¯ä¸€ä¸ª Mapï¼Œå­˜å‚¨æ¯ä¸ªå±æ€§å¯¹åº”çš„ dep</span><br><span class="line">    if (!dep) &#123;</span><br><span class="line">        dep = createDep();//åˆ›å»ºä¸€ä¸ªæ–°çš„ dep å®ä¾‹</span><br><span class="line">        depsMap.set(key, dep);//å­˜å‚¨åˆ° depsMap ä¸­</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    trackEffects(dep);//å°†å½“å‰çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆactiveEffectï¼‰æ·»åŠ åˆ° dep ä¸­ï¼Œå¹¶å°† dep æ·»åŠ åˆ° activeEffect çš„ deps æ•°ç»„ä¸­</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸºäºactiveEffectè·å–å½“å‰ä¾èµ–-dep-push-activeEffect"><a href="#åŸºäºactiveEffectè·å–å½“å‰ä¾èµ–-dep-push-activeEffect" class="headerlink" title="åŸºäºactiveEffectè·å–å½“å‰ä¾èµ– &amp; dep.push(activeEffect)"></a>åŸºäºactiveEffectè·å–å½“å‰ä¾èµ– &amp; dep.push(activeEffect)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export function trackEffects(dep) &#123;</span><br><span class="line">    // å°†å½“å‰æ´»è·ƒçš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆactiveEffectï¼‰æ·»åŠ åˆ°å¯¹åº”çš„ä¾èµ–é›†åˆï¼ˆdepï¼‰ä¸­ï¼ŒåŒæ—¶å°†è¯¥ä¾èµ–é›†åˆæ·»åŠ åˆ°å‰¯ä½œç”¨å‡½æ•°çš„ä¾èµ–åˆ—è¡¨ï¼ˆdepsï¼‰é‡Œã€‚</span><br><span class="line">    if (!dep.has(activeEffect)) &#123;//æ£€æŸ¥æ˜¯å¦å·²æ”¶é›†å‰¯å‡½æ•°</span><br><span class="line">        dep.add(activeEffect);//æ·»åŠ </span><br><span class="line">        (activeEffect as any).deps.push(dep);//æ·»åŠ ä¾èµ–é›†åˆåˆ°å‰¯ä½œç”¨å‡½æ•°çš„ä¾èµ–åˆ—è¡¨</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="trigger-è§¦å‘ä¾èµ–-è„‘å›¾"><a href="#trigger-è§¦å‘ä¾èµ–-è„‘å›¾" class="headerlink" title="trigger(è§¦å‘ä¾èµ–) | è„‘å›¾"></a>trigger(è§¦å‘ä¾èµ–) | è„‘å›¾</h2><p><strong>src / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">export function trigger(target, type, key) &#123;</span><br><span class="line">    // targetï¼šå“åº”å¼å¯¹è±¡ï¼Œå³è¢«ä»£ç†çš„åŸå§‹å¯¹è±¡ã€‚</span><br><span class="line">    // typeï¼šæ“ä½œç±»å‹ï¼Œä¾‹å¦‚ GETã€SET ç­‰ã€‚ä¸è¿‡åœ¨å½“å‰ä»£ç ä¸­ï¼Œæš‚æ—¶åªå¤„ç†äº† GET ç±»å‹ã€‚</span><br><span class="line">    // keyï¼šå“åº”å¼å¯¹è±¡çš„å±æ€§åã€‚</span><br><span class="line">    let deps: Array&lt;any&gt; = [];//å­˜å‚¨æ‰€æœ‰ä¾èµ–è¯¥å±æ€§çš„ä¾èµ–é›†åˆï¼ˆdepï¼‰</span><br><span class="line"></span><br><span class="line">    const depsMap = targetMap.get(target);//ä» targetMap ä¸­è·å– target å¯¹åº”çš„ depsMap</span><br><span class="line"></span><br><span class="line">    if (!depsMap) return;</span><br><span class="line"></span><br><span class="line">    // æš‚æ—¶åªå®ç°äº† GET ç±»å‹</span><br><span class="line">    // get ç±»å‹åªéœ€è¦å–å‡ºæ¥å°±å¯ä»¥</span><br><span class="line">    const dep = depsMap.get(key);</span><br><span class="line"></span><br><span class="line">    deps.push(dep);// æœ€åæ”¶é›†åˆ° deps å†…</span><br><span class="line"></span><br><span class="line">    const effects: Array&lt;any&gt; = [];</span><br><span class="line">    deps.forEach((dep) =&gt; &#123; // è¿™é‡Œè§£æ„ dep å¾—åˆ°çš„æ˜¯ dep å†…éƒ¨å­˜å‚¨çš„ effect</span><br><span class="line">        effects.push(...dep);</span><br><span class="line">    &#125;);</span><br><span class="line">    // è¿™é‡Œçš„ç›®çš„æ˜¯åªæœ‰ä¸€ä¸ª dep ï¼Œè¿™ä¸ªdep é‡Œé¢åŒ…å«æ‰€æœ‰çš„ effect</span><br><span class="line">    // è¿™é‡Œçš„ç›®å‰åº”è¯¥æ˜¯ä¸ºäº† triggerEffects è¿™ä¸ªå‡½æ•°çš„å¤ç”¨</span><br><span class="line">    triggerEffects(createDep(effects));// è§¦å‘è¯¥ä¾èµ–é›†åˆä¸­çš„æ‰€æœ‰å‰¯ä½œç”¨å‡½æ•°é‡æ–°æ‰§è¡Œ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>src / dep.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export function createDep(effects?) &#123;</span><br><span class="line">    // Set æ˜¯ JavaScript ä¸­çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œç±»ä¼¼äºæ•°ç»„ï¼Œä½†æˆå‘˜çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰é‡å¤çš„å€¼ã€‚</span><br><span class="line">    const dep = new Set(effects);// å°†ä¼ å…¥çš„ effects ä½œä¸ºåˆå§‹å€¼å¡«å……åˆ°è¿™ä¸ª Set ä¸­</span><br><span class="line">    return dep;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>src / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export function triggerEffects(dep) &#123; // dep æ˜¯ä¸€ä¸ªå­˜å‚¨å‰¯ä½œç”¨å‡½æ•°çš„é›†åˆï¼Œé€šå¸¸æ˜¯ä¸€ä¸ª Set ç±»å‹ï¼Œç”¨äºè®°å½•ä¾èµ–äºæŸä¸ªå“åº”å¼å¯¹è±¡å±æ€§çš„æ‰€æœ‰å‰¯ä½œç”¨å‡½æ•°ã€‚</span><br><span class="line">    for (const effect of dep) &#123;// éå† dep é›†åˆä¸­çš„æ¯ä¸ªå‰¯ä½œç”¨å‡½æ•° effect</span><br><span class="line">        if (effect.scheduler) &#123;// effect.schedulerå­˜åœ¨</span><br><span class="line">            // scheduler å¯ä»¥è®©ç”¨æˆ·è‡ªå·±é€‰æ‹©è°ƒç”¨çš„æ—¶æœºï¼Œè¿™æ ·å°±å¯ä»¥çµæ´»çš„æ§åˆ¶è°ƒç”¨äº†</span><br><span class="line">            // åœ¨ runtime-core ä¸­ï¼Œå°±æ˜¯ä½¿ç”¨äº† scheduler å®ç°äº†åœ¨ next ticker ä¸­è°ƒç”¨çš„é€»è¾‘</span><br><span class="line">            effect.scheduler();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            effect.run();// ç›´æ¥è°ƒç”¨ effect.run() æ–¹æ³•ï¼Œæ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ã€‚</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="runtime-core-åˆå§‹åŒ–æ ¸å¿ƒ"><a href="#runtime-core-åˆå§‹åŒ–æ ¸å¿ƒ" class="headerlink" title="runtime-core åˆå§‹åŒ–æ ¸å¿ƒ"></a>runtime-core åˆå§‹åŒ–æ ¸å¿ƒ</h1><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p><strong>example / helloWorld</strong></p><p><strong>index.html</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script src=&quot;main.js&quot; type=&quot;module&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><strong>main.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &quot;../../dist/mini-vue.esm-bundler.js&quot;;</span><br><span class="line">import App from &quot;./App.js&quot;;</span><br><span class="line"></span><br><span class="line">const rootContainer = document.querySelector(&quot;#root&quot;);//è·å–æ ¹æ ‡ç­¾èŠ‚ç‚¹</span><br><span class="line">createApp(App).mount(rootContainer); //createApp(ä¼ å…¥æ ¹ç»„ä»¶).mount(ä¼ å…¥æ ¹å®¹å™¨)</span><br></pre></td></tr></table></figure><p><strong>App.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;//ä¸€ä¸ªå¯¹è±¡</span><br><span class="line">    name: &quot;App&quot;,//æ ‡è®°å½“å‰ç»„ä»¶çš„åå­—</span><br><span class="line">    setup(props,context) &#123;&#125;,//ä¸€ä¸ªåœ¨ç»„ä»¶åˆ›å»ºä¹‹å‰æ‰§è¡Œçš„å‡½æ•°ï¼Œå¯ä½¿ç”¨å“åº”å¼æ•°æ®ã€ç”Ÿå‘½å‘¨æœŸé’©å­ã€è®¡ç®—å±æ€§ç­‰</span><br><span class="line"></span><br><span class="line">    render() &#123;//æŠŠtemplateè½¬åŒ–æˆrenderå‡½æ•°ï¼Œä»£è¡¨è¿™ä¸ªç»„ä»¶æƒ³è¦æ¸²æŸ“å‡ºæ¥çš„è§†å›¾</span><br><span class="line">        //tagæ ‡ç­¾å(div)  propså±æ€§å¯¹è±¡  childrenæ•°æ®åŒ…å«äº†(div å…ƒç´ çš„å­èŠ‚ç‚¹)</span><br><span class="line">        return h(&quot;div&quot;, &#123; tId: 1 &#125;, [h(&quot;p&quot;, &#123;&#125;, &quot;ä¸»é¡µ&quot;), h(HelloWorld)]);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="æ¸²æŸ“æµç¨‹è¯¦è§£"><a href="#æ¸²æŸ“æµç¨‹è¯¦è§£" class="headerlink" title="æ¸²æŸ“æµç¨‹è¯¦è§£"></a>æ¸²æŸ“æµç¨‹è¯¦è§£</h2><h3 id="mount-åˆå§‹åŒ–æµç¨‹"><a href="#mount-åˆå§‹åŒ–æµç¨‹" class="headerlink" title="mount åˆå§‹åŒ–æµç¨‹"></a>mount åˆå§‹åŒ–æµç¨‹</h3><blockquote><p><strong>å…ˆè¿›å…¥main.js---è·å–åˆ°æ ¹å®¹å™¨---è§¦å‘createAppå‡½æ•°---è°ƒç”¨createAppå†…éƒ¨Appå¯¹è±¡çš„mountå‡½æ•°---mountå†…éƒ¨åŸºäºä¼ æ¥çš„æ ¹å®¹å™¨ç”Ÿæˆè™šæ‹ŸèŠ‚ç‚¹vnode(ä¸€ä¸ªæ™®é€šå¯¹è±¡ä½†æœ‰å‡ ä¸ªå…³é”®çš„keyï¼Œæœ€å…³é”®çš„æ˜¯æœ‰typeå¯¹è±¡[å’Œä¼ å…¥çš„å¯¹è±¡æ˜¯ä¸€æ ·çš„name|setup|render])</strong></p><p><strong>è°ƒç”¨mountå†…éƒ¨çš„render---è°ƒç”¨å†…éƒ¨patchæ–¹æ³•---è§£æ„å‡ºtypeå¯¹è±¡---switchåˆ¤æ–­typeçš„ç±»å‹ä»è€Œç”¨ä¸åŒçš„æ–¹æ³•å¤„ç†</strong></p><blockquote><p><strong>component</strong> ç»„ä»¶ç±»å‹---è°ƒç”¨processComponent---æ ¹æ®!n1åˆ†æˆåˆå§‹åŒ–oræ›´æ–°</p></blockquote><blockquote><blockquote><p><strong>mountComponent</strong> åˆå§‹åŒ–---æ¨¡æ¿åˆå§‹åŒ–å¯¹è±¡+æŠŠvnodeè™šæ‹ŸèŠ‚ç‚¹æŒ‚åœ¨åˆ°è¯¥å¯¹è±¡ä¸Š---<em><strong>setupComponent</strong></em>---initProps+initSlots+setupStatefulComponentåˆå§‹åŒ–props/slots/setup&amp;å¤„ç†ç»„ä»¶---åœ¨setupStatefulComponentåˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡[è¿˜æ˜¯é‚£ä¸ªä¼ æ¥çš„typeå¯¹è±¡]å°†å…¶ç»‘å®šåˆ°instanceå¯¹è±¡ä¸Š---ä¼ å…¥instanceè§¦å‘setcurrentinstance---handlesetupResultåŸºäºsetupä¸­çš„propså’Œcontextåšå‡ºä¸€å®šçš„å¤„ç†---1.setupè¿”å›ä¸€ä¸ªå‡½æ•°[ä¼šæŠŠå®ƒå½“æˆrenderå‡½æ•°å»å†™] 2.setupè¿”å›ä¸€ä¸ªå¯¹è±¡[èµ‹å€¼,è°ƒç”¨finishComponentSetup,å¦‚æœæ²¡æœ‰renderä¼šå°†Componentçš„renderèµ‹å€¼ç»™å®ƒ]</p></blockquote></blockquote><blockquote><blockquote><p><strong>å¾€å›èµ°èµ°åˆ°</strong><em><strong>setupComponent</strong></em>ï¼Œinstance.updateä½¿ç”¨effectè°ƒç”¨componentUpdateFn---è¯¥å‡½æ•°ä¸­è¦è°ƒç”¨ä¼ æ¥å¯¹è±¡é‡Œçš„renderå‡½æ•°è·å–vnodeå­ç»„ä»¶ç”Ÿæˆå¥½çš„è™šæ‹ŸèŠ‚ç‚¹---åœ¨componentUpdateFnè§¦å‘<em><strong>patch</strong></em>(é€’å½’å›å»äº†)ã€!æ­¤æ—¶å·²ç»å˜æˆ<strong>element</strong>å…ƒç´ ç±»å‹äº†!ã€‘</p></blockquote></blockquote><blockquote><blockquote><p><strong>updateComponent</strong> æ›´æ–°</p></blockquote></blockquote><blockquote><p><strong>element</strong> å…ƒç´ ç±»å‹---è°ƒç”¨processElement---æ ¹æ®!n1åˆ†æˆåˆå§‹åŒ–oræ›´æ–°</p></blockquote><blockquote><blockquote><p><strong>mountElement</strong> åˆå§‹åŒ–(æŠŠè™šæ‹ŸèŠ‚ç‚¹è½¬åŒ–æˆä¸€ä¸ªçœŸå®çš„domå…ƒç´ )---åˆ›å»ºel(çœŸå®çš„element)---[æ–‡æœ¬ç±»å‹è°ƒç”¨hostcreateElement]---[æ•°ç»„ç±»å‹è°ƒç”¨mountChildren]ä¼ å…¥childerèŠ‚ç‚¹,el---éå†æ•°ç»„è§¦å‘<em><strong>patch</strong></em>(é€’å½’)ã€!æ­¤æ—¶æ•°ç»„å…ƒç´ å°±æ˜¯<strong>element</strong>ç±»å‹!ã€‘</p></blockquote></blockquote><blockquote><blockquote><p><strong>ä»ç„¶ä½äºmountElementå‡½æ•°ä¸­,å¦‚æœå…ƒç´ propså­˜åœ¨,éå†è°ƒç”¨****hostPatchProp</strong>(ä¼ å…¥el,key,null,val)---åˆ†ç±»,å†…éƒ¨å¤„ç†è¿˜æ˜¯è°ƒç”¨äº†domå†…éƒ¨çš„API</p></blockquote></blockquote><blockquote><blockquote><p><strong>è¿”å›mountElementå‡½æ•°,ä¸‹ä¸€æ­¥è°ƒç”¨****hostInsert</strong>(el,container[æ ¹ç»„ä»¶])[å°†æ‰€æœ‰çš„ä¸€åˆ‡æ’å›#rootæ ¹å…ƒç´ ç»„ä»¶]åˆ°æ­¤æ‰€æœ‰å…ƒç´ å°±éƒ½åœ¨é¡µé¢ä¸Šå±•ç¤ºå‡ºæ¥äº†ï¼Œä¹Ÿå°±æ˜¯åˆå§‹åŒ–çš„å…¨è¿‡ç¨‹</p></blockquote></blockquote><blockquote><blockquote><p><strong>patchElement</strong></p></blockquote></blockquote></blockquote><blockquote><p>**é€šä¿—æ¥è¯´ï¼š**<em><strong>è°ƒç”¨renderå°±æ˜¯â€œæ‹†ç®±â€çš„è¿‡ç¨‹</strong></em>ç›´åˆ°æŠŠå†…éƒ¨æ‰€æœ‰çš„ç»„ä»¶æ¸²æŸ“åˆ°æµè§ˆå™¨ä¸Š</p></blockquote><h3 id="update-æ›´æ–°æµç¨‹"><a href="#update-æ›´æ–°æµç¨‹" class="headerlink" title="update æ›´æ–°æµç¨‹"></a>update æ›´æ–°æµç¨‹</h3><p><strong>App.js æ ·ä¾‹å˜åŠ¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;//ä¸€ä¸ªå¯¹è±¡</span><br><span class="line">    name: &quot;App&quot;,//æ ‡è®°å½“å‰ç»„ä»¶çš„åå­—</span><br><span class="line">    setup(props,context) &#123;//ä¸€ä¸ªåœ¨ç»„ä»¶åˆ›å»ºä¹‹å‰æ‰§è¡Œçš„å‡½æ•°ï¼Œå¯ä½¿ç”¨å“åº”å¼æ•°æ®ã€ç”Ÿå‘½å‘¨æœŸé’©å­ã€è®¡ç®—å±æ€§ç­‰</span><br><span class="line">        const count = ref(10)</span><br><span class="line">        window.count = count</span><br><span class="line">        </span><br><span class="line">        return&#123;</span><br><span class="line">            count,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    render() &#123;//æŠŠtemplateè½¬åŒ–æˆrenderå‡½æ•°ï¼Œä»£è¡¨è¿™ä¸ªç»„ä»¶æƒ³è¦æ¸²æŸ“å‡ºæ¥çš„è§†å›¾</span><br><span class="line">        //tagæ ‡ç­¾å(div)  propså±æ€§å¯¹è±¡  childrenæ•°æ®åŒ…å«äº†(div å…ƒç´ çš„å­èŠ‚ç‚¹)</span><br><span class="line">        return h(&quot;div&quot;, &#123; tId: 1 &#125;, [h(&quot;p&quot;, &#123;&#125;, &quot;ä¸»é¡µ&quot; + this.count)]);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p><strong>å“åº”å¼çš„å€¼å‘ç”Ÿæ”¹å˜(å“åº”å¼å¯¹è±¡éƒ½åœ¨renderå‡½æ•°å†…)---æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„fn---åˆ¤æ–­æ˜¯å¦åˆå§‹åŒ–---è§¦å‘å½“å‰ç»„ä»¶çš„effectå‡½æ•°æ‰§è¡Œ(instance,update)---è°ƒç”¨renderå‡½æ•°(è·å–å‰åè™šæ‹ŸèŠ‚ç‚¹æ ‘èŠ‚ç‚¹)---è§¦å‘</strong><em><strong>patch</strong></em>(å‰åè™šæ‹ŸèŠ‚ç‚¹æ ‘èŠ‚ç‚¹)---æ ¹æ®!n2åˆ†æˆ<strong>component</strong>ç»„ä»¶ç±»å‹or<strong>element</strong>å…ƒç´ ç±»å‹</p><p><em><em>æ›´æ–°é€»è¾‘ï¼š<strong><em><strong>processXXX</strong></em>ä¸­n1å­˜åœ¨---è¿›å…¥</strong></em>updateXXX</em>**(n1,n2)---å–å‡ºæ–°(n1&amp;n2)è€(n2&amp;{})props---n2.el=n1.el---å¯¹æ¯”props(patchProps)---å¯¹æ¯”children(patchChild)åŒç«¯å¯¹æ¯”ç®—æ³•å®ç°</p></blockquote><h1 id="é€æ­¥æ­å»º"><a href="#é€æ­¥æ­å»º" class="headerlink" title="é€æ­¥æ­å»º"></a>é€æ­¥æ­å»º</h1><h2 id="åˆå§‹åŒ–é¡¹ç›®-æ­å»ºç¯å¢ƒ"><a href="#åˆå§‹åŒ–é¡¹ç›®-æ­å»ºç¯å¢ƒ" class="headerlink" title="åˆå§‹åŒ–é¡¹ç›®+æ­å»ºç¯å¢ƒ"></a>åˆå§‹åŒ–é¡¹ç›®+æ­å»ºç¯å¢ƒ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm install --save-dev jest</span><br><span class="line">pnpm add typescript --save-dev</span><br><span class="line">npx tsc --init</span><br><span class="line">pnpm add --save-dev jest</span><br><span class="line">pnpm i --save-dev @types/node</span><br></pre></td></tr></table></figure><p><strong>æ›¿æ¢ package.json &amp; tsconfig.json</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;jest&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&quot;types&quot;: [&quot;jest&quot;],</span><br><span class="line">&quot;noImplicitAny&quot;: false,//æŠŠanyæŠ¥é”™å¿½ç•¥æ‰</span><br></pre></td></tr></table></figure><p><strong>é…ç½®bableç¯å¢ƒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add --save-dev babel-jest @babel/core @babel/preset-env @babel/preset-typescript</span><br></pre></td></tr></table></figure><p><strong>æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª</strong> <code>babel.config.js</code>æ–‡ä»¶</p><blockquote><p><strong>ä»¥å½“å‰nodeç‰ˆæœ¬åšä¸€ä¸ªè½¬æ¢ | æ”¯æŒTS</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  presets: [</span><br><span class="line">    [&#x27;@babel/preset-env&#x27;, &#123;targets: &#123;node: &#x27;current&#x27;&#125;&#125;],</span><br><span class="line">    &#x27;@babel/preset-typescript&#x27;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>ç¼–å†™æµ‹è¯•æ–‡ä»¶</strong></p><p><strong>reactivity / index.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function sum(a, b) &#123;</span><br><span class="line">    return a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>reactivity / tests / index.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;index&#x27;, () =&gt; &#123;</span><br><span class="line">    expect(1).toBe(1)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>å•æµ‹è¿è¡Œ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm test</span><br></pre></td></tr></table></figure><h2 id="runtime-reactivity-å“åº”å¼ç³»ç»Ÿå®ç°"><a href="#runtime-reactivity-å“åº”å¼ç³»ç»Ÿå®ç°" class="headerlink" title="runtime-reactivity å“åº”å¼ç³»ç»Ÿå®ç°"></a>runtime-reactivity å“åº”å¼ç³»ç»Ÿå®ç°</h2><h3 id="ç¼–å†™å•æµ‹"><a href="#ç¼–å†™å•æµ‹" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h3><h4 id="effect"><a href="#effect" class="headerlink" title="effect"></a>effect</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import &#123; effect &#125; from &#x27;../effect&#x27;</span><br><span class="line">import &#123; reactive &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;effect&#x27;, () =&gt; &#123;</span><br><span class="line">    it.skip(&#x27;effect&#x27;, () =&gt; &#123;</span><br><span class="line">        const user = reactive(&#123;// å“åº”å¼å¯¹è±¡</span><br><span class="line">            age: 10,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        let nextAge</span><br><span class="line">        effect(() =&gt; &#123;//æ”¶é›†ä¾èµ– æ¥æ”¶fn è§¦å‘getæ“ä½œ</span><br><span class="line">            nextAge = user.age + 1</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        expect(nextAge).toBe(11)</span><br><span class="line"></span><br><span class="line">        // update è§¦å‘setæ“ä½œ</span><br><span class="line">        user.age++</span><br><span class="line">        expect(nextAge).toBe(12)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h4><p><strong>reactivity / texts / reactive.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;reactive&#x27;, () =&gt; &#123;</span><br><span class="line">    it(&#x27;reactive&#x27;, () =&gt; &#123;</span><br><span class="line">        const original = &#123; age: 1 &#125;</span><br><span class="line">        const observed = reactive(original)</span><br><span class="line">        expect(observed).not.toBe(original)</span><br><span class="line">        expect(observed.age).toBe(1)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="å®ç°reactive"><a href="#å®ç°reactive" class="headerlink" title="å®ç°reactive"></a>å®ç°reactive</h3><p><strong>tsconfig.json</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;lib&quot;: [&quot;DOM&quot;,&quot;ES6&quot;], </span><br></pre></td></tr></table></figure><p><strong>reactivity / reactive.ts</strong></p><blockquote><p><strong>ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªProxyå¯¹è±¡ï¼Œå®ç° get &amp; set å‡½æ•°</strong></p><blockquote><p><strong>è¯¦è§£ å‡è®¾å¯¹è±¡ä¸º { foo : 1 }</strong></p></blockquote><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target: &#123; foo : 1 &#125;</span><br><span class="line">key: foo</span><br><span class="line">value: 1</span><br></pre></td></tr></table></figure></blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">export function reactive(raw) &#123;</span><br><span class="line">    return new Proxy(raw, &#123;</span><br><span class="line">        get(target, key) &#123;</span><br><span class="line">            const res = Reflect.get(target, key)</span><br><span class="line"></span><br><span class="line">            // TODO:æ”¶é›†ä¾èµ–</span><br><span class="line"></span><br><span class="line">            return res</span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br><span class="line">        set(target, key, value) &#123;</span><br><span class="line">            const res = Reflect.set(target, key, value)</span><br><span class="line">            </span><br><span class="line">            // TODO:è§¦å‘ä¾èµ–</span><br><span class="line"></span><br><span class="line">            return res</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æµ‹è¯• pnpm test reactive</strong></p></blockquote><h3 id="å®ç°effect"><a href="#å®ç°effect" class="headerlink" title="å®ç°effect"></a>å®ç°effect</h3><p><strong>reactivity / effect.ts</strong></p><blockquote><p><strong>ä¼ å…¥ä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°fnï¼Œå“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‡æ–°æ‰§è¡Œfn</strong></p><blockquote><p>**å°è£…ç±»ï¼Œå°† **<code>_fn</code> ç§æœ‰å±æ€§å’Œ <code>run</code> æ–¹æ³•å°è£…åœ¨ä¸€èµ·ï¼Œå¤–éƒ¨ä»£ç åªèƒ½é€šè¿‡ <code>run</code> æ–¹æ³•æ¥æ‰§è¡Œ <code>_fn</code>ï¼Œéšè—å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œæé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§</p></blockquote><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class ReactiveEffect &#123;</span><br><span class="line">private _fn: any</span><br><span class="line"> constructor(fn) &#123;</span><br><span class="line">     this._fn = fn</span><br><span class="line"> &#125;</span><br><span class="line"> run() &#123;</span><br><span class="line">     this._fn()</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export function effect(fn) &#123;</span><br><span class="line">    const _effect = new ReactiveEffect(fn)</span><br><span class="line"></span><br><span class="line">    _effect.run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æµ‹è¯• pnpm test effect</strong></p></blockquote><h3 id="å®ç°reactive-get"><a href="#å®ç°reactive-get" class="headerlink" title="å®ç°reactive-get"></a>å®ç°reactive-get</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">get(target, key) &#123;</span><br><span class="line">    const res = Reflect.get(target, key)</span><br><span class="line"></span><br><span class="line">    track(target, key) //ä¼ å…¥å¯¹è±¡å’Œkey</span><br><span class="line"></span><br><span class="line">    return res</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="track-ä¾èµ–æ”¶é›†"><a href="#track-ä¾èµ–æ”¶é›†" class="headerlink" title="track ä¾èµ–æ”¶é›†"></a>track ä¾èµ–æ”¶é›†</h4><p><strong>reactivity / effect.ts</strong></p><blockquote><p><strong>æ„å»ºä¸€ä¸ªå®¹å™¨ï¼Œå­˜å‚¨ä¾èµ–</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const targetMap = new Map() // å­˜å‚¨ä¾èµ–å…³ç³»</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const targetMap = new Map() // å­˜æ‰€æœ‰ä¾èµ–</span><br><span class="line">export function track(target, key) &#123;</span><br><span class="line">    let depsMap = targetMap.get(target)</span><br><span class="line">    if (!depsMap) &#123;</span><br><span class="line">        depsMap = new Map()</span><br><span class="line">        targetMap.set(target, depsMap)//targetMapç»“æ„[target&lt;obj&gt;, depsMap&lt;map&gt;]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let dep = depsMap.get(key)</span><br><span class="line">    if (!dep) &#123;</span><br><span class="line">        dep = new Set()</span><br><span class="line">        depsMap.set(key, dep)//depsMapç»“æ„[key&lt;key&gt;, dep&lt;ReactiveEffect&gt;]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dep.add(ï¼Ÿ)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¦‚ä½•æ‹¿åˆ°fn</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//å…¨å±€å¯¹è±¡</span><br><span class="line">let activeEffect</span><br><span class="line"></span><br><span class="line">//ReactiveEffectç±»å†…</span><br><span class="line">run() &#123;</span><br><span class="line">    activeEffect = this</span><br><span class="line">    this._fn()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ä¼ å…¥effect</span><br><span class="line">dep.add(activeEffect)</span><br></pre></td></tr></table></figure><h3 id="å®ç°reactive-set"><a href="#å®ç°reactive-set" class="headerlink" title="å®ç°reactive-set"></a>å®ç°reactive-set</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">set(target, key, value) &#123;</span><br><span class="line">    const res = Reflect.set(target, key, value)</span><br><span class="line"></span><br><span class="line">    trigger(target, key) //ä¼ å…¥å¯¹è±¡å’Œkey</span><br><span class="line">    </span><br><span class="line">    return res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="trigger-ä¾èµ–è§¦å‘"><a href="#trigger-ä¾èµ–è§¦å‘" class="headerlink" title="trigger ä¾èµ–è§¦å‘"></a>trigger ä¾èµ–è§¦å‘</h4><p><strong>reactivity / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">export function trigger(target, key) &#123;</span><br><span class="line">    let depsMap = targetMap.get(target)</span><br><span class="line">    if (!depsMap) &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let dep = depsMap.get(key)</span><br><span class="line">    if (!dep) &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dep.forEach((effect) =&gt; &#123;</span><br><span class="line">        effect.run()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æµ‹è¯• pnpm test effect</strong></p></blockquote><h3 id="å®Œå–„effectåŠŸèƒ½"><a href="#å®Œå–„effectåŠŸèƒ½" class="headerlink" title="å®Œå–„effectåŠŸèƒ½"></a>å®Œå–„effectåŠŸèƒ½</h3><h4 id="åŠŸèƒ½å•æµ‹1"><a href="#åŠŸèƒ½å•æµ‹1" class="headerlink" title="åŠŸèƒ½å•æµ‹1"></a>åŠŸèƒ½å•æµ‹1</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;è¿”å›runnerå¯ä»¥è§¦å‘effect&#x27;, () =&gt; &#123;</span><br><span class="line">    let foo = 10</span><br><span class="line">    const runner = effect(() =&gt; &#123;</span><br><span class="line">        foo++</span><br><span class="line">        return foo</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    expect(foo).toBe(11)//åˆ›å»ºeffect - foo++</span><br><span class="line">    const r = runner()//è°ƒç”¨runner - foo++</span><br><span class="line">    expect(foo).toBe(12)</span><br><span class="line">    expect(r).toBe(foo)//è°ƒç”¨runner - foo++</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹effecté€»è¾‘</strong></p><p><em>å®ç°åˆ›å»ºå®ä¾‹æ—¶runä¸€æ¬¡</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export function effect(fn) &#123;</span><br><span class="line">const _effect = new ReactiveEffect(fn)</span><br><span class="line"></span><br><span class="line">_effect.run() //å…ˆæ‰§è¡Œä¸€æ¬¡</span><br><span class="line"></span><br><span class="line">    return _effect.run.bind(_effect)//è¿”å›runå‡½æ•°å¹¶ç»‘å®šthis</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">run() &#123;</span><br><span class="line">    activeEffect = this</span><br><span class="line">    return this._fn()//è¿”å›å€¼</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>**Tipsï¼šæœ‰å…³ *****.bind(...)***</p><p>**ç›´æ¥è¿”å› **<code>_effect.run</code> ä¼šè®© <code>run</code> æ–¹æ³•åœ¨è°ƒç”¨æ—¶ <code>this</code> æŒ‡å‘å‡ºç°é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´ <code>this._fn()</code> æ— æ³•æ­£å¸¸æ‰§è¡Œã€‚</p><p><em>ä¾‹å­</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">class ReactiveEffect &#123;</span><br><span class="line">private _fn: any;</span><br><span class="line">constructor(fn) &#123;</span><br><span class="line">this._fn = fn;</span><br><span class="line">&#125;</span><br><span class="line">run() &#123;</span><br><span class="line">console.log(&#x27;this:&#x27;, this);</span><br><span class="line">this._fn();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function effectWithBind(fn) &#123;// è¿”å› _effect.run.bind(_effect)</span><br><span class="line">const _effect = new ReactiveEffect(fn);</span><br><span class="line">_effect.run();</span><br><span class="line">return _effect.run.bind(_effect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function effectWithoutBind(fn) &#123;// è¿”å› _effect.run</span><br><span class="line">const _effect = new ReactiveEffect(fn);</span><br><span class="line">_effect.run();</span><br><span class="line">return _effect.run;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const boundRun = effectWithBind(f);// ä½¿ç”¨ effectWithBind</span><br><span class="line">boundRun(); // this æŒ‡å‘ _effect å®ä¾‹</span><br><span class="line"></span><br><span class="line">const unboundRun = effectWithoutBind(f);// ä½¿ç”¨ effectWithoutBind</span><br><span class="line">unboundRun(); // this æŒ‡å‘å…¨å±€å¯¹è±¡ï¼ˆåœ¨æµè§ˆå™¨ä¸­æ˜¯ windowï¼‰</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><strong>æµ‹è¯• pnpm test effect</strong></p></blockquote><h4 id="åŠŸèƒ½å•æµ‹2"><a href="#åŠŸèƒ½å•æµ‹2" class="headerlink" title="åŠŸèƒ½å•æµ‹2"></a>åŠŸèƒ½å•æµ‹2</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">it.skip(&quot;scheduler&quot;, () =&gt; &#123;</span><br><span class="line">    // 1. é€šè¿‡ effect çš„ç¬¬äºŒä¸ªå‚æ•°ç»™å®šä¸€ä¸ª scheduler çš„ fn</span><br><span class="line">    // 2. effect ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ è¿˜ä¼šæ‰§è¡Œ fn</span><br><span class="line">    // 3. å½“ å“åº”å¼å¯¹è±¡ set update ä¸ä¼šæ‰§è¡Œ fn è€Œæ˜¯æ‰§è¡Œ scheduler</span><br><span class="line">    // 4. å¦‚æœè¯´å½“æ‰§è¡Œ runner çš„æ—¶å€™ ä¼šå†æ¬¡æ‰§è¡Œ fn</span><br><span class="line">    let dummy</span><br><span class="line">    let run: any</span><br><span class="line">    const scheduler = jest.fn(() =&gt; &#123;</span><br><span class="line">        run = runner</span><br><span class="line">    &#125;)</span><br><span class="line">    const obj = reactive(&#123; foo: 1 &#125;)</span><br><span class="line">    const runner = effect(() =&gt; </span><br><span class="line">&#123; dummy = obj.foo &#125;,</span><br><span class="line">&#123; scheduler &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    expect(scheduler).not.toHaveBeenCalled()//schedulerä¸ä¼šè¢«è°ƒç”¨</span><br><span class="line">    expect(dummy).toBe(1)</span><br><span class="line"></span><br><span class="line">    //å½“å“åº”å¼å¯¹è±¡setæ—¶è°ƒç”¨scheduler,ä½†ä¸ä¼šæ‰§è¡Œfn</span><br><span class="line">    obj.foo++</span><br><span class="line">    expect(scheduler).toHaveBeenCalledTimes(1)</span><br><span class="line">    expect(dummy).toBe(1)</span><br><span class="line"></span><br><span class="line">    //è°ƒç”¨runneræ—¶æ‰§è¡Œfn</span><br><span class="line">    run()</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>æ›´æ–°effectå‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">constructor(fn, public scheduler?) &#123;//æ‹¿åˆ°å¯é€‰å‚æ•°scheduler</span><br><span class="line">    this._fn = fn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function effect(fn, options: any = &#123;&#125;) &#123;</span><br><span class="line">    const scheduler = options.scheduler//æ‹¿åˆ°scheduler</span><br><span class="line">    const _effect = new ReactiveEffect(fn, scheduler)//ç»™ç±»ä¼ å…¥scheduler</span><br><span class="line"></span><br><span class="line">    _effect.run()</span><br><span class="line">    return _effect.run.bind(_effect)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹æ›´æ–°å‡½æ•°triggeré€»è¾‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dep.forEach((effect) =&gt; &#123;</span><br><span class="line">    if (effect.scheduler) &#123;</span><br><span class="line">        effect.scheduler()</span><br><span class="line">        return</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        effect.run()</span><br><span class="line">    &#125;</span><br><span class="line">    effect.run()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test effect</strong></p></blockquote><h4 id="åŠŸèƒ½å•æµ‹3"><a href="#åŠŸèƒ½å•æµ‹3" class="headerlink" title="åŠŸèƒ½å•æµ‹3"></a>åŠŸèƒ½å•æµ‹3</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">it(&quot;stopçš„æ‰§è¡Œé€»è¾‘&quot;, () =&gt; &#123;</span><br><span class="line">    let dummy</span><br><span class="line">    const obj = reactive(&#123; prop: 1 &#125;)</span><br><span class="line">    const runner = effect(() =&gt; &#123;</span><br><span class="line">        dummy = obj.prop</span><br><span class="line">    &#125;)</span><br><span class="line">    obj.prop = 2</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line"></span><br><span class="line">    stop(runner)//åœæ­¢æ‰§è¡Œrunner</span><br><span class="line"></span><br><span class="line">    obj.prop = 3</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line"></span><br><span class="line">    runner()</span><br><span class="line">    expect(dummy).toBe(3)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>reactivity / effect.ts</strong></p><p><strong>å®ç°stopä»£ç </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function stop(runner) &#123;</span><br><span class="line">    runner.effect.stop()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹effectå‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export function effect(fn, options: any = &#123;&#125;) &#123;</span><br><span class="line">    const scheduler = options.scheduler</span><br><span class="line">    const _effect = new ReactiveEffect(fn, scheduler)</span><br><span class="line"></span><br><span class="line">    _effect.run()</span><br><span class="line"></span><br><span class="line">    const runner: any = _effect.run.bind(_effect) //å®šä¹‰runnerå‡½æ•°å¹¶ç»‘å®šthis</span><br><span class="line">    runner.effect = _effect //å°†effectæŒ‚è½½åˆ°runnerä¸Š</span><br><span class="line"></span><br><span class="line">    return runner</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>trackï¼ˆä¾èµ–æ”¶é›†ï¼‰å‡½æ•°æ·»åŠ é€»è¾‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dep.add(activeEffect)</span><br><span class="line">activeEffect.deps.push(dep)</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹effectç±» | æ·»åŠ stopå‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public deps = []</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    this.deps.forEach((dep:any) =&gt; &#123;</span><br><span class="line">        dep.delete(this)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test effect --watch</strong></p></blockquote><p><strong>ä»£ç ä¼˜åŒ–ï¼ˆæŠ½ç¦»æ¸…é™¤é€»è¾‘ &amp; é˜²æŠ–ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">active = true</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    if (this.active) &#123;</span><br><span class="line">        cleanupEffect(this)</span><br><span class="line">        this.active = false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function cleanupEffect(effect) &#123;</span><br><span class="line">    effect.deps.forEach((dep: any) =&gt; &#123;</span><br><span class="line">        dep.delete(effect)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å•æµ‹4"><a href="#åŠŸèƒ½å•æµ‹4" class="headerlink" title="åŠŸèƒ½å•æµ‹4"></a>åŠŸèƒ½å•æµ‹4</h4><p><strong>reactivity / texts / effect.spec.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;onStopçš„æ‰§è¡Œé€»è¾‘&#x27;, () =&gt; &#123;</span><br><span class="line">    const obj = reactive(&#123;</span><br><span class="line">        foo: 1,</span><br><span class="line">    &#125;)</span><br><span class="line">    const onStop = jest.fn()//jest.fn() åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿå‡½æ•° onStopï¼Œç”¨äºè®°å½•å…¶è°ƒç”¨æ¬¡æ•°å’Œå‚æ•°</span><br><span class="line">    let dummy</span><br><span class="line">    const runner = effect(</span><br><span class="line">        () =&gt; &#123;</span><br><span class="line">            dummy = obj.foo//å“åº”å¼å¯¹è±¡</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            onStop,//é€‰é¡¹å¯¹è±¡</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    stop(runner)</span><br><span class="line">    expect(onStop).toBeCalledTimes(1)//éªŒè¯ onStop å‡½æ•°æ˜¯å¦è¢«è°ƒç”¨äº†ä¸€æ¬¡</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>reactivity / effect.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//_effect.onStop = options.onStop//è°ƒç”¨ç±»æ–¹æ³•</span><br><span class="line">//Object.assign(_effect, options)//è°ƒç”¨ç±»æ–¹æ³•(ä¼˜åŒ–)</span><br><span class="line">extend(_effect, options)//è°ƒç”¨ç±»æ–¹æ³•(æŠ½ç¦»å°è£…)</span><br></pre></td></tr></table></figure><blockquote><p><strong>Tipï¼šäºŒè€…åŒºåˆ«</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// å‡è®¾ options å¯¹è±¡å¦‚ä¸‹</span><br><span class="line">const options = &#123;</span><br><span class="line">onStop: () =&gt; console.log(&#x27;Effect stopped&#x27;),</span><br><span class="line">someOtherOption: &#x27;value&#x27;</span><br><span class="line">&#125;;</span><br><span class="line">const _effect = new ReactiveEffect(() =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// ä»…èµ‹å€¼ onStop å±æ€§</span><br><span class="line">_effect.onStop = options.onStop;</span><br><span class="line"></span><br><span class="line">console.log(_effect.onStop); // è¾“å‡º: () =&gt; console.log(&#x27;Effect stopped&#x27;)</span><br><span class="line">console.log(_effect.someOtherOption); // è¾“å‡º: undefined</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å¤åˆ¶ options å¯¹è±¡çš„æ‰€æœ‰å±æ€§åˆ° _effect</span><br><span class="line">Object.assign(_effect, options);</span><br><span class="line"></span><br><span class="line">console.log(_effect.onStop); // è¾“å‡º: () =&gt; console.log(&#x27;Effect stopped&#x27;)</span><br><span class="line">console.log(_effect.someOtherOption); // è¾“å‡º: &#x27;value&#x27;</span><br></pre></td></tr></table></figure></blockquote><p><strong>ç»§ç»­æŠ½ç¦»å‡½æ•°</strong></p><p><strong>src / shared (æ”¾ç½®é€šç”¨çš„å·¥å…·å‡½æ•°) / index.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export const extend = Object.assign</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹ç±»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">onStop?: () =&gt; void</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    if (this.active) &#123;</span><br><span class="line">        cleanupEffect(this)</span><br><span class="line">        if (this.onStop) &#123;</span><br><span class="line">            this.onStop()</span><br><span class="line">        &#125;</span><br><span class="line">        this.active = false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°readonlyåŠŸèƒ½"><a href="#å®ç°readonlyåŠŸèƒ½" class="headerlink" title="å®ç°readonlyåŠŸèƒ½"></a>å®ç°readonlyåŠŸèƒ½</h3><h4 id="ç¼–å†™å•æµ‹-1"><a href="#ç¼–å†™å•æµ‹-1" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><p><strong>readonly.spec.ts</strong></p><blockquote><p><strong>åªè¯»å±æ€§åªèƒ½è¯»å–setä¸èƒ½è¢«æ”¹å†™set</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import &#123; readonly &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;readonly&#x27;, () =&gt; &#123;</span><br><span class="line">it(&#x27;readonly&#x27;, () =&gt; &#123;</span><br><span class="line">const original = &#123; foo: 1 &#125;</span><br><span class="line">const wrapped = readonly(original)</span><br><span class="line">expect(wrapped).not.toBe(original) //è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œéè¿”å›åŸå¯¹è±¡</span><br><span class="line">expect(wrapped.foo).toBe(1)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">it(&#x27;warning when call set&#x27;, () =&gt; &#123;</span><br><span class="line">console.warn = jest.fn()</span><br><span class="line">const user = readonly(&#123;</span><br><span class="line">age: 10,</span><br><span class="line">&#125;)</span><br><span class="line">user.age = 11</span><br><span class="line">expect(console.warn).toBeCalled()//è°ƒç”¨äº†console.warn</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>reactive</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export function readonly(raw) &#123;</span><br><span class="line">    return new Proxy(raw, &#123;</span><br><span class="line">        get(target, key) &#123;</span><br><span class="line">            return Reflect.get(target, key)</span><br><span class="line">        &#125;,</span><br><span class="line">        set(target, key, value) &#123;</span><br><span class="line">            console.warn(`key: $&#123;key&#125; set å¤±è´¥ï¼Œå› ä¸º target æ˜¯ readonly çš„`, target)</span><br><span class="line">            return true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æŠ½ç¦» get &amp; set å‡½æ•°</strong></p><p><strong>createGetter</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function createGetter(isReadonly = false, shallow = false) &#123;</span><br><span class="line">    return function get(target, key) &#123;//è¿”å›ä¸€ä¸ªgetå‡½æ•°</span><br><span class="line">        const res = Reflect.get(target, key)</span><br><span class="line">        if (!isReadonly) &#123;</span><br><span class="line">            track(target, key)</span><br><span class="line">        &#125;</span><br><span class="line">        if (shallow) &#123;</span><br><span class="line">            return res</span><br><span class="line">        &#125;</span><br><span class="line">        if (typeof res === &#x27;object&#x27;) &#123;</span><br><span class="line">            return isReadonly ? readonly(res) : reactive(res)</span><br><span class="line">        &#125;</span><br><span class="line">        return res</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>createSetter</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function createSetter(shallow = false) &#123;</span><br><span class="line">    return function set(target, key, value) &#123;</span><br><span class="line">        const res = Reflect.set(target, key, value)</span><br><span class="line">        trigger(target, key)</span><br><span class="line">        return res</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ”¹å†™å‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">export function reactive(raw) &#123;</span><br><span class="line">    return new Proxy(raw, &#123;</span><br><span class="line">        get: createGetter(),</span><br><span class="line">        set: createSetter(),</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function readonly(raw) &#123;</span><br><span class="line">    return new Proxy(raw, &#123;</span><br><span class="line">        get: createGetter(true),</span><br><span class="line">        set(target, key, value) &#123;</span><br><span class="line">            console.warn(`key: $&#123;key&#125; set å¤±è´¥ï¼Œå› ä¸º target æ˜¯ readonly çš„`, target)</span><br><span class="line">            return true</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»§ç»­ä¼˜åŒ–æŠ½ç¦»ç»„ä»¶</strong></p><p><strong>åˆ›å»º baseHanders.ts | å°è£…geté€»è¾‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import &#123; track, trigger &#125; from &#x27;./effect&#x27;</span><br><span class="line"></span><br><span class="line">function createGetter(isReadonly = false) &#123;</span><br><span class="line">return function get(target, key) &#123;</span><br><span class="line">const res = Reflect.get(target, key)</span><br><span class="line">if (!isReadonly) &#123;</span><br><span class="line">track(target, key)</span><br><span class="line">&#125;</span><br><span class="line">return res</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function createSetter() &#123;</span><br><span class="line">return function set(target, key, value) &#123;</span><br><span class="line">const res = Reflect.set(target, key, value)</span><br><span class="line">trigger(target, key)</span><br><span class="line">return res</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const reactiveHandlers = &#123;</span><br><span class="line">get: createGetter(),</span><br><span class="line">set: createSetter(),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const readonlyHandlers = &#123;</span><br><span class="line">get: createGetter(true),</span><br><span class="line">set(target, key, value) &#123;</span><br><span class="line">console.warn(`key: $&#123;key&#125; set å¤±è´¥ï¼Œå› ä¸º target æ˜¯ readonly çš„`, target)</span><br><span class="line">return true</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é‡æ„ reactive &amp; readonly</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactiveHandlers, readonlyHandlers &#125; from &#x27;./baseHanders&#x27;</span><br><span class="line"></span><br><span class="line">function createActiveEffect(raw: any, baseHanders) &#123;</span><br><span class="line">return new Proxy(raw, baseHanders)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function reactive(raw) &#123;</span><br><span class="line">return createActiveEffect(raw, reactiveHandlers)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function readonly(raw) &#123;</span><br><span class="line">return createActiveEffect(raw, readonlyHandlers)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸º createGetter æ·»åŠ ç¼“å­˜æœºåˆ¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const get = createGetter()</span><br><span class="line">const set = createSetter()</span><br><span class="line">const readonlyGet = createGetter(true)</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test readonly --watch</strong></p></blockquote><h3 id="å®ç°-isReactive-isReadonly-åŠŸèƒ½"><a href="#å®ç°-isReactive-isReadonly-åŠŸèƒ½" class="headerlink" title="å®ç° isReactive &amp; isReadonly åŠŸèƒ½"></a>å®ç° isReactive &amp; isReadonly åŠŸèƒ½</h3><h4 id="ç¼–å†™å•æµ‹-2"><a href="#ç¼–å†™å•æµ‹-2" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><p><strong>reactive.spec.ts</strong></p><blockquote><p>**åˆ¤æ–­ä¼ å…¥çš„ **<code>value</code> æ˜¯å¦ä¸ºå“åº”å¼å¯¹è±¡</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;reactive&#x27;, () =&gt; &#123;</span><br><span class="line">    const original = &#123; age: 1 &#125;</span><br><span class="line">    const observed = reactive(original)</span><br><span class="line">    expect(observed).not.toBe(original)</span><br><span class="line">    expect(observed.age).toBe(1)</span><br><span class="line"></span><br><span class="line">    //åˆ¤æ–­æ˜¯å¦æ˜¯å“åº”å¼å¯¹è±¡</span><br><span class="line">    expect(isReactive(observed)).toBe(true)</span><br><span class="line">    expect(isReactive(original)).toBe(false)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>readonly.spec.ts</strong></p><blockquote><p><strong>åˆ¤æ–­æ˜¯å¦æ˜¯åªè¯»å¯¹è±¡</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;readonly&#x27;, () =&gt; &#123;</span><br><span class="line">    const original = &#123; foo: 1 &#125;</span><br><span class="line">    const wrapped = readonly(original)</span><br><span class="line">    expect(wrapped).not.toBe(original) //è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œéè¿”å›åŸå¯¹è±¡</span><br><span class="line">    expect(wrapped.foo).toBe(1)</span><br><span class="line"></span><br><span class="line">    expect(isReadonly(wrapped)).toBe(true)//åˆ¤æ–­æ˜¯å¦æ˜¯åªè¯»å¯¹è±¡</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å®ç°"><a href="#åŠŸèƒ½å®ç°" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h4><p><strong>createGetteræ‹¦æˆªåˆ¤æ–­</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function createGetter(isReadonly = false) &#123;</span><br><span class="line">return function get(target, key) &#123;</span><br><span class="line"></span><br><span class="line">if (key === ReactiveFlags.IS_REACTIVE) &#123;//åˆ¤æ–­æ˜¯å¦æ˜¯å“åº”å¼å¯¹è±¡</span><br><span class="line">return !isReadonly</span><br><span class="line">&#125;else if (key === ReactiveFlags.IS_READONLY) &#123;//åˆ¤æ–­æ˜¯å¦æ˜¯åªè¯»å¯¹è±¡</span><br><span class="line">return isReadonly</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const res = Reflect.get(target, key)</span><br><span class="line">if (!isReadonly) &#123;</span><br><span class="line">track(target, key)</span><br><span class="line">&#125;</span><br><span class="line">return res</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>reactive.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export const enum ReactiveFlags &#123;</span><br><span class="line">IS_REACTIVE = &#x27;__v_isReactive&#x27;,</span><br><span class="line">IS_READONLY = &#x27;__v_isReadonly&#x27;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function isReactive(value) &#123;//åˆ¤æ–­æ˜¯å¦æ˜¯å“åº”å¼å¯¹è±¡</span><br><span class="line">    return !!value[ReactiveFlags.IS_REACTIVE]</span><br><span class="line">&#125;</span><br><span class="line">export function isReadonly(value) &#123;//åˆ¤æ–­æ˜¯å¦æ˜¯åªè¯»å¯¹è±¡</span><br><span class="line">    return !!value[ReactiveFlags.IS_READONLY]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test readonly --watch</strong></p><p><strong>pnpm test reactive --watch</strong></p></blockquote><h3 id="stopåŠŸèƒ½ä¼˜åŒ–"><a href="#stopåŠŸèƒ½ä¼˜åŒ–" class="headerlink" title="stopåŠŸèƒ½ä¼˜åŒ–"></a>stopåŠŸèƒ½ä¼˜åŒ–</h3><h4 id="å½“å‰bug"><a href="#å½“å‰bug" class="headerlink" title="å½“å‰bug"></a>å½“å‰bug</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">it(&quot;stopçš„æ‰§è¡Œé€»è¾‘&quot;, () =&gt; &#123;</span><br><span class="line">    let dummy</span><br><span class="line">    const obj = reactive(&#123; prop: 1 &#125;)</span><br><span class="line">    const runner = effect(() =&gt; &#123;</span><br><span class="line">        dummy = obj.prop</span><br><span class="line">    &#125;)</span><br><span class="line">    obj.prop = 2</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line"></span><br><span class="line">    stop(runner)//åœæ­¢æ‰§è¡Œrunner</span><br><span class="line"></span><br><span class="line">    // obj.prop = 3 åªæ¶‰åŠsetæ“ä½œ</span><br><span class="line">    obj.prop++ //è§¦å‘ get+set</span><br><span class="line">    </span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line"></span><br><span class="line">    runner()</span><br><span class="line">    expect(dummy).toBe(3)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><strong>stop(runner)ä¼šæ ¹æ®è¯¥å“åº”å¼å¯¹è±¡ä¸­activeçš„çŠ¶æ€æ¸…é™¤å®ƒçš„å·²ç»æ”¶é›†çš„æ‰€æœ‰ä¾èµ–</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">effect.deps.forEach((dep: any) =&gt; &#123;</span><br><span class="line">dep.delete(effect)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>**+1è§¦å‘getæ“ä½œä¸€å®šä¼šè§¦å‘trackæ“ä½œé‡æ–°æ”¶é›†ä¾èµ– **</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dep.add(activeEffect)//ä¹‹å‰çš„ä¾èµ–éƒ½ç™½æ¸…äº†</span><br></pre></td></tr></table></figure><p><strong>æ‰€ä»¥stopå‡½æ•°ä¹‹åçš„æ“ä½œä¸åº”è¯¥æ”¶é›†ä¾èµ–ï¼ˆä¸èƒ½è§¦å‘trackæ“ä½œï¼‰</strong></p></blockquote><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p><strong>trackæ·»åŠ é€»è¾‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if(!activeEffect || !shouldTrack)&#123;//å¦‚æœæ²¡æœ‰æ¿€æ´»çš„effectæˆ–è€…shouldTrackä¸ºfalseï¼Œç›´æ¥è¿”å›</span><br><span class="line">    return  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//...æ”¶é›†ä¾èµ–</span><br><span class="line"></span><br><span class="line">if (dep.has(activeEffect)) &#123;</span><br><span class="line">    return</span><br><span class="line">&#125;</span><br><span class="line">dep.add(activeEffect)</span><br><span class="line">activeEffect.deps.push(dep)</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹runå‡½æ•°ï¼ˆstopæ ¹æ®activeçŠ¶æ€åŒºåˆ†ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">run() &#123;</span><br><span class="line">    if (!this.active) &#123; // stopçŠ¶æ€ç›´æ¥è¿”å›fn</span><br><span class="line">        return this._fn()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    shouldTrack = true // å…è®¸è¿›è¡Œä¾èµ–æ”¶é›†</span><br><span class="line">    activeEffect = this</span><br><span class="line"></span><br><span class="line">    const res = this._fn() // this._fn() æ‰§è¡Œï¼ŒæœŸé—´è®¿é—®å“åº”å¼å¯¹è±¡çš„å±æ€§ï¼Œè§¦å‘trackä¾èµ–æ”¶é›†</span><br><span class="line"></span><br><span class="line">    shouldTrack = false // ä¾èµ–æ”¶é›†ç»“æŸï¼Œåç»­æ“ä½œä¸ä¼šå†è§¦å‘ä¾èµ–æ”¶é›†ã€‚</span><br><span class="line"></span><br><span class="line">    return res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>cleanupEffectæ·»åŠ é€»è¾‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">effect.deps.length = 0</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm test reactive --watch</strong></p></blockquote><h3 id="åµŒå¥—å“åº”å¼è½¬æ¢"><a href="#åµŒå¥—å“åº”å¼è½¬æ¢" class="headerlink" title="åµŒå¥—å“åº”å¼è½¬æ¢"></a>åµŒå¥—å“åº”å¼è½¬æ¢</h3><h4 id="ç¼–å†™å•æµ‹-3"><a href="#ç¼–å†™å•æµ‹-3" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><p><strong>reactive</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;åµŒå¥—å“åº”å¼å¯¹è±¡è½¬æ¢&#x27;, () =&gt; &#123;</span><br><span class="line">    const original = &#123;</span><br><span class="line">        nested: &#123;</span><br><span class="line">            foo: 1</span><br><span class="line">        &#125;,</span><br><span class="line">        array: [&#123; bar: 2 &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">    const observed = reactive(original)</span><br><span class="line">    expect(isReactive(observed.nested)).toBe(true)</span><br><span class="line">    expect(isReactive(observed.array)).toBe(true)</span><br><span class="line">    expect(isReactive(observed.array[0])).toBe(true) </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>readonly</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;readonly&#x27;, () =&gt; &#123;</span><br><span class="line">    const original = &#123; foo: 1, bar: &#123; baz: 2 &#125; &#125;</span><br><span class="line">    const wrapped = readonly(original)</span><br><span class="line"></span><br><span class="line">    expect(wrapped).not.toBe(original) //è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œéè¿”å›åŸå¯¹è±¡</span><br><span class="line">    expect(wrapped.foo).toBe(1)</span><br><span class="line"></span><br><span class="line">    expect(isReadonly(original)).toBe(false)</span><br><span class="line">    expect(isReadonly(original.bar)).toBe(false)</span><br><span class="line">    expect(isReadonly(wrapped)).toBe(true)//åªè¯»</span><br><span class="line">    expect(isReadonly(wrapped.bar)).toBe(true)//åªè¯»</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>baseHanders.ts é€’å½’æ‹¦æˆª</strong></p><blockquote><p><strong>createGetterå‡½æ•°</strong></p><p>**const res = Reflect.get(**<em>target</em>, <em>key</em>)åæ·»åŠ åˆ¤æ–­</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (isObject(res)) &#123;//åˆ¤æ–­æ˜¯å¦æ˜¯å¯¹è±¡</span><br><span class="line">    return isReadonly ? readonly(res) : reactive(res)//è¿”å›åªè¯»å¯¹è±¡æˆ–è€…å“åº”å¼å¯¹è±¡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>shared / index.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export const isObject = (val) =&gt; &#123;</span><br><span class="line">    return val !== null &amp;&amp; typeof val === &#x27;object&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="shallowReadonlyå·¥å…·å‡½æ•°"><a href="#shallowReadonlyå·¥å…·å‡½æ•°" class="headerlink" title="shallowReadonlyå·¥å…·å‡½æ•°"></a>shallowReadonlyå·¥å…·å‡½æ•°</h3><h4 id="ç¼–å†™å•æµ‹-4"><a href="#ç¼–å†™å•æµ‹-4" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><p><strong>shallowReadonly.spec.ts</strong></p><blockquote><p><strong>æ•°æ®å±•ç¤º:ç¡®ä¿å¤–å±‚æ•°æ®ä¸ä¼šè¢«æ„å¤–ä¿®æ”¹ï¼ŒåŒæ—¶å…è®¸åœ¨å¿…è¦æ—¶ä¿®æ”¹åµŒå¥—å¯¹è±¡</strong></p><p><strong>æ€§èƒ½ä¼˜åŒ–:é¿å…å¯¹æ‰€æœ‰åµŒå¥—å¯¹è±¡è¿›è¡Œåªè¯»å¤„ç†</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; isReadonly, shallowReadonly &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;shallowReadonly&#x27;, () =&gt; &#123;</span><br><span class="line">    it(&#x27;shallowReadonly&#x27;, () =&gt; &#123;</span><br><span class="line">        const props = shallowReadonly(&#123; n: &#123; foo: 1 &#125; &#125;)</span><br><span class="line">        expect(isReadonly(props)).toBe(true)//è¡¨å±‚åªè¯»</span><br><span class="line">        expect(isReadonly(props.n)).toBe(false)//å†…éƒ¨æ­£å¸¸</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å®ç°-1"><a href="#åŠŸèƒ½å®ç°-1" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h4><p><strong>reactive.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function shallowReadonly(raw) &#123;</span><br><span class="line">    return createActiveEffect(raw, shallowReadonlyHandlers)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>baseHanders.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const readonlyGet = createGetter(true)</span><br><span class="line">const shallowReadonlyGet = createGetter(true, true)</span><br></pre></td></tr></table></figure><p><strong>createGetteræ”¹å†™</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function createGetter(isReadonly = false, shallow = false)</span><br><span class="line"></span><br><span class="line">if (shallow) &#123;</span><br><span class="line">    return res</span><br><span class="line">&#125;</span><br><span class="line">//ğŸ‘‡åˆ¤æ–­isObjectå‰æ‹¦æˆªğŸ‘†//</span><br><span class="line">if (isObject(res)) &#123;//åˆ¤æ–­æ˜¯å¦æ˜¯å¯¹è±¡</span><br><span class="line">    return isReadonly ? readonly(res) : reactive(res) //è¿”å›åªè¯»å¯¹è±¡æˆ–è€…å“åº”å¼å¯¹è±¡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»§æ‰¿æ”¹å†™è‡ªreadonlyHandlers</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export const shallowReadonlyHandlers = extend(&#123;&#125;, readonlyHandlers, &#123;</span><br><span class="line">    get: shallowReadonlyGet,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="å®ç°isProxyåŠŸèƒ½"><a href="#å®ç°isProxyåŠŸèƒ½" class="headerlink" title="å®ç°isProxyåŠŸèƒ½"></a>å®ç°isProxyåŠŸèƒ½</h3><h4 id="ç¼–å†™å•æµ‹-5"><a href="#ç¼–å†™å•æµ‹-5" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><blockquote><p><strong>åˆ¤æ–­æ˜¯å¦æ˜¯ä»£ç†å¯¹è±¡</strong></p></blockquote><p><strong>reactive &amp; readonly åˆ†åˆ«æ·»åŠ </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(isProxy(observed)).toBe(true)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(isProxy(wrapped)).toBe(true)</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å®ç°-2"><a href="#åŠŸèƒ½å®ç°-2" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function isProxy(value) &#123; //åˆ¤æ–­æ˜¯å¦æ˜¯ä»£ç†å¯¹è±¡</span><br><span class="line">    return isReactive(value) || isReadonly(value)   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°ref"><a href="#å®ç°ref" class="headerlink" title="å®ç°ref"></a>å®ç°ref</h3><h4 id="å¿…çœ‹ï¼šrefä¸-reactiveåŒºåˆ«"><a href="#å¿…çœ‹ï¼šrefä¸-reactiveåŒºåˆ«" class="headerlink" title="å¿…çœ‹ï¼šrefä¸ reactiveåŒºåˆ«"></a>å¿…çœ‹ï¼š<code>ref</code>ä¸ <code>reactive</code>åŒºåˆ«</h4><table><thead><tr><th><strong>reactive</strong></th><th><strong>ref</strong></th></tr></thead><tbody><tr><td><strong>âŒåªæ”¯æŒ****å¯¹è±¡</strong>å’Œ<strong>æ•°ç»„</strong>(å¼•ç”¨æ•°æ®ç±»å‹)</td><td><strong>âœ…æ”¯æŒåŸºæœ¬æ•°æ®ç±»å‹+å¼•ç”¨æ•°æ®ç±»å‹</strong></td></tr><tr><td><strong>âŒé‡æ–°åˆ†é…ä¸€ä¸ªæ–°å¯¹è±¡ä¼šä¸¢å¤±å“åº”æ€§</strong></td><td><strong>âœ…é‡æ–°åˆ†é…ä¸€ä¸ªæ–°å¯¹è±¡****ä¸ä¼š</strong>å¤±å»å“åº”</td></tr><tr><td><strong>âŒå°†å¯¹è±¡ä¼ å…¥å‡½æ•°æ—¶,å¤±å»å“åº”</strong></td><td><strong>âœ…ä¼ å…¥å‡½æ•°æ—¶,ä¸ä¼šå¤±å»å“åº”</strong></td></tr><tr><td><strong>èƒ½ç›´æ¥è®¿é—®å±æ€§</strong></td><td><strong>éœ€è¦ä½¿ç”¨</strong> <code>.value</code>è®¿é—®å±æ€§</td></tr><tr><td><strong>âœ…åœ¨</strong> <code>&lt;script&gt;</code>å’Œ <code>&lt;template&gt;</code>ä¸­æ— å·®åˆ«ä½¿ç”¨</td><td><strong>âŒåœ¨</strong> <code>&lt;script&gt;</code>å’Œ <code>&lt;template&gt;</code>ä½¿ç”¨æ–¹å¼ä¸åŒ(scriptä¸­è¦ <code>.value</code>)</td></tr><tr><td><strong>âŒè§£æ„æ—¶ä¼šä¸¢å¤±å“åº”æ€§,éœ€ä½¿ç”¨toRefs</strong></td><td><strong>âŒè§£æ„å¯¹è±¡æ—¶ä¼šä¸¢å¤±å“åº”æ€§,éœ€ä½¿ç”¨toRefs</strong></td></tr></tbody></table><blockquote><p><strong>refåªä¼ å•å€¼ï¼Œä¸èƒ½ä½¿ç”¨Proxy(Proxyå¯¹å¯¹è±¡èµ·ä½œç”¨)</strong></p><p><strong>refä¸­çš„ä»»ä½•ä¸€ä¸ªç‚¹keyéƒ½è¦å¯¹åº”ä¸€ä¸ªdepï¼Œget&amp;setè¿›è¡Œä¾èµ–æ”¶é›†å’Œè§¦å‘</strong></p></blockquote><h4 id="åŠŸèƒ½å•æµ‹1-1"><a href="#åŠŸèƒ½å•æµ‹1-1" class="headerlink" title="åŠŸèƒ½å•æµ‹1"></a>åŠŸèƒ½å•æµ‹1</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; effect &#125; from &#x27;../effect&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;../ref&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;ref&#x27;, () =&gt; &#123;</span><br><span class="line">    it.only(&#x27;value&#x27;, () =&gt; &#123;</span><br><span class="line">        const a = ref(1)</span><br><span class="line">        expect(a.value).toBe(1)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>ref.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class RefImpl &#123;</span><br><span class="line">    private _value: any;</span><br><span class="line">    constructor(value) &#123;//æ„é€ å‡½æ•°</span><br><span class="line">        this._value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get value() &#123;//è·å–value</span><br><span class="line">        return this._value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // set value() &#123;</span><br><span class="line"></span><br><span class="line">    // &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function ref(value) &#123;</span><br><span class="line">    return new RefImpl(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å•æµ‹2-1"><a href="#åŠŸèƒ½å•æµ‹2-1" class="headerlink" title="åŠŸèƒ½å•æµ‹2"></a>åŠŸèƒ½å•æµ‹2</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;should be reactive&#x27;, () =&gt; &#123;</span><br><span class="line">    const a = ref(1)</span><br><span class="line">    let dummy</span><br><span class="line">    let calls = 0</span><br><span class="line">    effect(() =&gt; &#123;</span><br><span class="line">        calls++</span><br><span class="line">        dummy = a.value</span><br><span class="line">    &#125;)</span><br><span class="line">    expect(calls).toBe(1)//effectæ‰§è¡Œäº†ä¸€æ¬¡</span><br><span class="line">    expect(dummy).toBe(1)</span><br><span class="line">    a.value = 2</span><br><span class="line">    expect(calls).toBe(2)</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line">    // å€¼ç›¸åŒä¸ä¼šè§¦å‘</span><br><span class="line">    a.value = 2</span><br><span class="line">    expect(calls).toBe(2)</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>ref.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">class RefImpl &#123;</span><br><span class="line">    private _value: any //å€¼</span><br><span class="line">    public dep //ä¾èµ–å°±æ˜¯å”¯ä¸€çš„value</span><br><span class="line">    constructor(value) &#123;</span><br><span class="line">        //æ„é€ å‡½æ•°</span><br><span class="line">        this._value = value //å­˜å‚¨å€¼</span><br><span class="line">        this.dep = new Set() //å­˜å‚¨ä¾èµ–</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get value() &#123;</span><br><span class="line">        //è·å–value</span><br><span class="line">        return this._value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    set value(newValue) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function ref(value) &#123;</span><br><span class="line">    return new RefImpl(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å›åˆ°effectæŠ½ç¦» get &amp; set é€»è¾‘ä»£ç å¤ç”¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">trackEffects(dep)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function trackEffects(dep) &#123;</span><br><span class="line">    if (dep.has(activeEffect)) &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    dep.add(activeEffect)</span><br><span class="line">    activeEffect.deps.push(dep)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">triggerEffects(dep)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function triggerEffects(dep) &#123; </span><br><span class="line">dep.forEach((effect) =&gt; &#123;</span><br><span class="line">if (effect.scheduler) &#123;</span><br><span class="line">effect.scheduler()</span><br><span class="line">return</span><br><span class="line">&#125; else &#123;</span><br><span class="line">effect.run()</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ref.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">get value() &#123;</span><br><span class="line">    trackEffects(this.dep) //æ”¶é›†ä¾èµ–</span><br><span class="line">    return this._value //è·å–value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">set value(newValue) &#123;</span><br><span class="line">    this._value = newValue //è®¾ç½®value</span><br><span class="line">    triggerEffects(this.dep) //è§¦å‘ä¾èµ–</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®ç°èµ‹å€¼ç›¸åŒä¸è§¦å‘effectåŠŸèƒ½</strong></p><p><strong>set valueæ·»åŠ </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(Object.is(newValue,this._value)) return //å¦‚æœæ–°å€¼å’Œæ—§å€¼ç›¸ç­‰ï¼Œç›´æ¥è¿”å›</span><br></pre></td></tr></table></figure><p><strong>æŠ½ç¦»å°è£…æˆå·¥å…·å‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function trackRefValue(ref) &#123;</span><br><span class="line">    if (isTracking()) &#123;</span><br><span class="line">        trackEffects(ref.dep)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export const hasChange = (val, newValue) =&gt; &#123;</span><br><span class="line">    return !Object.is(val, newValue)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>get &amp; set valueæ”¹å†™</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get value() &#123;</span><br><span class="line">    trackRefValue(this) //æ”¶é›†ä¾èµ–</span><br><span class="line">    return this._value //è·å–value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set value(newValue) &#123;</span><br><span class="line">    if (hasChange(newValue, this._value)) &#123;//åˆ¤æ–­æ˜¯å¦æœ‰å˜åŒ–</span><br><span class="line">        this._value = newValue //è®¾ç½®value</span><br><span class="line">        triggerEffects(this.dep) //è§¦å‘ä¾èµ–</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å•æµ‹3-1"><a href="#åŠŸèƒ½å•æµ‹3-1" class="headerlink" title="åŠŸèƒ½å•æµ‹3"></a>åŠŸèƒ½å•æµ‹3</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;åµŒå¥—å“åº”&#x27;, () =&gt; &#123;</span><br><span class="line">    const a = ref(&#123;</span><br><span class="line">        count: 1,</span><br><span class="line">    &#125;)</span><br><span class="line">    let dummy</span><br><span class="line">    effect(() =&gt; &#123;</span><br><span class="line">        dummy = a.value.count</span><br><span class="line">    &#125;)</span><br><span class="line">    expect(dummy).toBe(1)</span><br><span class="line">    a.value.count = 2</span><br><span class="line">    expect(dummy).toBe(2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><strong>è¦å®ç°åµŒå¥—å°±è®¾è®¡é€’å½’å˜›</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">private _value: any //å€¼</span><br><span class="line">public dep //ä¾èµ–å°±æ˜¯å”¯ä¸€çš„value</span><br><span class="line">private _rawValue: any //åŸå§‹å€¼</span><br><span class="line">constructor(value) &#123;</span><br><span class="line">    this._rawValue = value</span><br><span class="line">    this._value = isObject(value) ? reactive(value) : value //å¦‚æœæ˜¯å¯¹è±¡ï¼Œå°±é€’å½’</span><br><span class="line">    this.dep = new Set() //å­˜å‚¨ä¾èµ–</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">set value(newValue) &#123;</span><br><span class="line">    if (hasChange(newValue, this._rawValue)) &#123;</span><br><span class="line">        //åˆ¤æ–­æ˜¯å¦æœ‰å˜åŒ–</span><br><span class="line">        this._rawValue = newValue</span><br><span class="line">        this._value = isObject(newValue) ? reactive(newValue) : newValue</span><br><span class="line">        triggerEffects(this.dep) //è§¦å‘ä¾èµ–</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»§ç»­ä¼˜åŒ–</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">private _rawValue: any //åŸå§‹å€¼</span><br><span class="line"></span><br><span class="line">set value(newValue) &#123;</span><br><span class="line">    if (hasChange(newValue, this._rawValue)) &#123;</span><br><span class="line">        //åˆ¤æ–­æ˜¯å¦æœ‰å˜åŒ–</span><br><span class="line">        this._rawValue = newValue</span><br><span class="line">        this._value = convert(newValue) //å¦‚æœæ˜¯å¯¹è±¡ï¼Œå°±é€’å½’</span><br><span class="line">        triggerEffects(this.dep) //è§¦å‘ä¾èµ–</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function convert(value) &#123;</span><br><span class="line">    return isObject(value) ? reactive(value) : value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°isRef"><a href="#å®ç°isRef" class="headerlink" title="å®ç°isRef"></a>å®ç°isRef</h3><h4 id="ç¼–å†™å•æµ‹-6"><a href="#ç¼–å†™å•æµ‹-6" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;isRef&#x27;, () =&gt; &#123;</span><br><span class="line">    const a = ref(1)</span><br><span class="line">    const user = &#123;</span><br><span class="line">        age: a,</span><br><span class="line">    &#125;</span><br><span class="line">    expect(isRef(a)).toBe(true)</span><br><span class="line">    expect(isRef(1)).toBe(false)</span><br><span class="line">    expect(isRef(user)).toBe(false)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å®ç°-3"><a href="#åŠŸèƒ½å®ç°-3" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public __v_isRef = true //æ ‡è¯†æ˜¯å¦æ˜¯ref</span><br><span class="line"></span><br><span class="line">export function isRef(ref) &#123;</span><br><span class="line">    return !!ref.__v_isRef//è½¬æ¢ä¸ºå¸ƒå°”å€¼</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°unRef"><a href="#å®ç°unRef" class="headerlink" title="å®ç°unRef"></a>å®ç°unRef</h3><blockquote><p><strong>å¦‚æœå‚æ•°æ˜¯ refï¼Œåˆ™è¿”å›å†…éƒ¨å€¼ï¼Œå¦åˆ™è¿”å›å‚æ•°æœ¬èº«</strong></p></blockquote><h4 id="ç¼–å†™å•æµ‹-7"><a href="#ç¼–å†™å•æµ‹-7" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;unRef&#x27;, () =&gt; &#123;//</span><br><span class="line">    const a = ref(1)</span><br><span class="line">    expect(unRef(a)).toBe(1)</span><br><span class="line">    expect(unRef(1)).toBe(1)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å®ç°-4"><a href="#åŠŸèƒ½å®ç°-4" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export function unRef(ref) &#123;</span><br><span class="line">    return isRef(ref) ? ref.value : ref //å¦‚æœæ˜¯refï¼Œå°±è¿”å›valueï¼Œå¦åˆ™è¿”å›åŸå¯¹è±¡   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°proxyRefs"><a href="#å®ç°proxyRefs" class="headerlink" title="å®ç°proxyRefs (?)"></a>å®ç°proxyRefs (?)</h3><h4 id="ç¼–å†™å•æµ‹-8"><a href="#ç¼–å†™å•æµ‹-8" class="headerlink" title="ç¼–å†™å•æµ‹"></a>ç¼–å†™å•æµ‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;proxyRefs&#x27;, () =&gt; &#123;</span><br><span class="line">    const user = &#123;</span><br><span class="line">        age: ref(10),</span><br><span class="line">        name: &#x27;zf&#x27;,</span><br><span class="line">    &#125;</span><br><span class="line">    const proxyUser = proxyRefs(user)</span><br><span class="line">    expect(user.age.value).toBe(10)</span><br><span class="line">    expect(proxyUser.age).toBe(10)//å¯ä»¥çœç•¥.value</span><br><span class="line">    expect(proxyUser.name).toBe(&#x27;zf&#x27;)//å¯ä»¥çœç•¥.value</span><br><span class="line"></span><br><span class="line">    proxyUser.age = 20</span><br><span class="line">    expect(proxyUser.age).toBe(20)</span><br><span class="line">    expect(user.age.value).toBe(20)</span><br><span class="line"></span><br><span class="line">    proxyUser.age = ref(10)</span><br><span class="line">    expect(proxyUser.age).toBe(10)</span><br><span class="line">    expect(user.age.value).toBe(10)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å®ç°-5"><a href="#åŠŸèƒ½å®ç°-5" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h4><blockquote><p><strong>é€»è¾‘ï¼š</strong></p><p><strong>getåˆ°refè¿”å›.valueï¼Œå¦åˆ™ç›´æ¥è¿”å›åŸå¯¹è±¡</strong></p><p><strong>å®ä¾‹å¯¹è±¡è§¦å‘setä¼šè¿é”åŸå¯¹è±¡å€¼æ”¹å˜</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">export function proxyRefs(objectWithRefs) &#123;</span><br><span class="line">    return new Proxy(objectWithRefs, &#123;</span><br><span class="line">        get(target, key) &#123;</span><br><span class="line">            return unRef(Reflect.get(target, key)) //å¦‚æœæ˜¯refï¼Œå°±è¿”å›valueï¼Œå¦åˆ™è¿”å›åŸå¯¹è±¡</span><br><span class="line">        &#125;,</span><br><span class="line">        set(target, key, value) &#123;</span><br><span class="line">            if (isRef(target[key]) &amp;&amp; !isRef(value)) &#123;</span><br><span class="line">                return (target[key].value = value) //å¦‚æœæ˜¯refï¼Œå°±è¿”å›valueï¼Œå¦åˆ™è¿”å›åŸå¯¹è±¡</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return Reflect.set(target, key, value) //å¦‚æœæ˜¯refï¼Œå°±è¿”å›valueï¼Œå¦åˆ™è¿”å›åŸå¯¹è±¡</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°computed"><a href="#å®ç°computed" class="headerlink" title="å®ç°computed"></a>å®ç°computed</h3><blockquote><p>**æ¥å—ä¸€ä¸ª **<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/get#description">getter å‡½æ•°</a>ï¼Œè¿”å›ä¸€ä¸ªåªè¯»çš„å“åº”å¼ <a href="https://cn.vuejs.org/api/reactivity-core.html#ref">ref</a> å¯¹è±¡ã€‚è¯¥ ref é€šè¿‡ <code>.value</code> æš´éœ² getter å‡½æ•°çš„è¿”å›å€¼ã€‚å®ƒä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªå¸¦æœ‰ <code>get</code> å’Œ <code>set</code> å‡½æ•°çš„å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªå¯å†™çš„ ref å¯¹è±¡ã€‚</p></blockquote><h4 id="åŠŸèƒ½å•æµ‹1-2"><a href="#åŠŸèƒ½å•æµ‹1-2" class="headerlink" title="åŠŸèƒ½å•æµ‹1"></a>åŠŸèƒ½å•æµ‹1</h4><p><strong>computed.spec.ts</strong></p><blockquote><p><code>computed</code> å‡½æ•°ä¼šåŸºäºè¿™ä¸ª getter å‡½æ•°åˆ›å»ºä¸€ä¸ªè®¡ç®—å±æ€§ <code>age</code>ï¼Œè¯¥è®¡ç®—å±æ€§çš„å€¼ä¼šæ ¹æ® <code>user.age</code> çš„å˜åŒ–è€Œè‡ªåŠ¨æ›´æ–°ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import &#123; computed &#125; from &#x27;../computed&#x27;</span><br><span class="line">import &#123; reactive &#125; from &#x27;../reactive&#x27;</span><br><span class="line"></span><br><span class="line">describe(&#x27;computed&#x27;, () =&gt; &#123;</span><br><span class="line">    it(&#x27;computed&#x27;, () =&gt; &#123;</span><br><span class="line">        const user = reactive(&#123;</span><br><span class="line">            age: 1,</span><br><span class="line">        &#125;)</span><br><span class="line">        const age = computed(() =&gt; &#123;</span><br><span class="line">            return user.age</span><br><span class="line">        &#125;)</span><br><span class="line">        expect(age.value).toBe(1)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>computed.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class ComputedRefImpl &#123;</span><br><span class="line">    private _getter: any</span><br><span class="line">    constructor(getter) &#123;</span><br><span class="line">        this._getter = getter</span><br><span class="line">    &#125;</span><br><span class="line">    get value() &#123;</span><br><span class="line">        return this._getter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function computed(getter) &#123;</span><br><span class="line">    return new ComputedRefImpl(getter)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠŸèƒ½å•æµ‹2-2"><a href="#åŠŸèƒ½å•æµ‹2-2" class="headerlink" title="åŠŸèƒ½å•æµ‹2"></a>åŠŸèƒ½å•æµ‹2</h4><p><strong>computed.spec.ts</strong></p><blockquote><p>**æ¥å—ä¸€ä¸ª **<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/get#description">getter å‡½æ•°</a>ï¼Œè¿”å›ä¸€ä¸ªåªè¯»çš„å“åº”å¼ <a href="https://cn.vuejs.org/api/reactivity-core.html#ref">ref</a> å¯¹è±¡ã€‚è¯¥ ref é€šè¿‡ <code>.value</code> æš´éœ² getter å‡½æ•°çš„è¿”å›å€¼ã€‚å®ƒä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªå¸¦æœ‰ <code>get</code> å’Œ <code>set</code> å‡½æ•°çš„å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªå¯å†™çš„ ref å¯¹è±¡ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">it(&#x27;should compute lazily&#x27;, () =&gt; &#123;</span><br><span class="line">    const value = reactive(&#123;</span><br><span class="line">        foo: 1,</span><br><span class="line">    &#125;)</span><br><span class="line">    const getter = jest.fn(() =&gt; &#123;</span><br><span class="line">        return value.foo</span><br><span class="line">    &#125;)</span><br><span class="line">    const cValue = computed(getter)</span><br><span class="line">    expect(getter).not.toHaveBeenCalled()</span><br><span class="line">    expect(cValue.value).toBe(1)</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(1)</span><br><span class="line">    // å†æ¬¡è®¿é—®ï¼Œä¸åº”è¯¥å†è°ƒç”¨</span><br><span class="line">    cValue.value</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(1)</span><br><span class="line">    // ä¸åº”è¯¥å†è°ƒç”¨</span><br><span class="line">    value.foo = 2</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(1)</span><br><span class="line">    // è§¦å‘getter</span><br><span class="line">    expect(cValue.value).toBe(2)</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(2)</span><br><span class="line">    // ä¸åº”è¯¥å†è°ƒç”¨</span><br><span class="line">    cValue.value</span><br><span class="line">    expect(getter).toHaveBeenCalledTimes(2)   </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>computed.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ReactiveEffect &#125; from &#x27;./effect&#x27;</span><br><span class="line"></span><br><span class="line">class ComputedRefImpl &#123;</span><br><span class="line">    private _getter: any</span><br><span class="line">    private _value: any</span><br><span class="line">    private _dirty: boolean = true</span><br><span class="line">    private _effect: any</span><br><span class="line">    constructor(getter) &#123;</span><br><span class="line">        this._getter = getter</span><br><span class="line">        this._effect = new ReactiveEffect(getter, () =&gt; &#123;</span><br><span class="line">            if (!this._dirty) &#123;</span><br><span class="line">                this._dirty = true</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    get value() &#123;</span><br><span class="line">        if (this._dirty) &#123;</span><br><span class="line">            this._dirty = false</span><br><span class="line">            this._value = this._effect.run()</span><br><span class="line">        &#125;</span><br><span class="line">        return this._value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function computed(getter) &#123;</span><br><span class="line">    return new ComputedRefImpl(getter)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="runtime-core-åˆå§‹åŒ–æµç¨‹å®ç°"><a href="#runtime-core-åˆå§‹åŒ–æµç¨‹å®ç°" class="headerlink" title="runtime-core åˆå§‹åŒ–æµç¨‹å®ç°"></a>runtime-core åˆå§‹åŒ–æµç¨‹å®ç°</h2><h3 id="æ€»è§ˆå¯¼å›¾"><a href="#æ€»è§ˆå¯¼å›¾" class="headerlink" title="æ€»è§ˆå¯¼å›¾"></a>æ€»è§ˆå¯¼å›¾</h3><blockquote><p><strong>å…¨ç¨‹è·Ÿç€è¿™ä¸ªæµç¨‹å›¾å®ç°</strong></p></blockquote><p><img src="file:///C:/Users/DELL/Downloads/runtime-core.jpg?lastModify=1740547033" alt="runtime-core"></p><p><strong>åˆ›å»ºsrc / runtime-coreæ–‡ä»¶å¤¹</strong></p><blockquote><p><strong>è¿™æ¬¡çš„æµ‹è¯•æ ·ä¾‹æ”¾åœ¨æ ¹ç›®å½•ä¸‹çš„example / helloworld</strong></p></blockquote><h3 id="åˆå§‹åŒ–-component-ä¸»æµç¨‹"><a href="#åˆå§‹åŒ–-component-ä¸»æµç¨‹" class="headerlink" title="åˆå§‹åŒ– component ä¸»æµç¨‹"></a>åˆå§‹åŒ– component ä¸»æµç¨‹</h3><h4 id="æµ‹è¯•æ–‡ä»¶"><a href="#æµ‹è¯•æ–‡ä»¶" class="headerlink" title="æµ‹è¯•æ–‡ä»¶"></a>æµ‹è¯•æ–‡ä»¶</h4><p><strong>example / helloworld / index.html</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">        &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;script src=&quot;main.js&quot; type=&quot;module&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>ä»¥ä¸‹æ–‡ä»¶æ¨¡æ‹ŸVue3</strong></p><p><strong>main.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">createApp(App).mount(&#x27;#app&#x27;)</span><br><span class="line">ğŸ‘‡</span><br><span class="line">createApp(App) + app.mount(&#x27;#app&#x27;)</span><br><span class="line">//åˆ›å»ºä¸€ä¸ªæ ¹ç»„ä»¶App(Vueåº”ç”¨å®ä¾‹)ï¼Œç„¶åå°†å…¶æŒ‚è½½åˆ°&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;ä¸­ï¼Œä»æ­¤è¿™ä¸ª &lt;div&gt; é‡Œçš„å†…å®¹ç”± Vue æ¥ç®¡ï¼ŒVue ä¼šæ ¹æ® App çš„å›¾çº¸ï¼Œåœ¨&lt;div&gt;ä¸­æ¸²æŸ“å‡ºä½ å†™çš„ç»„ä»¶</span><br></pre></td></tr></table></figure><p><strong>App.js</strong></p><blockquote><p><strong>!!! æœ‰å…³è™šæ‹ŸèŠ‚ç‚¹ å…ˆå»çœ‹çœ‹è¿™ç¯‡æ–‡ç« </strong><a href="https://juejin.cn/post/7323031996864446505">vue3è™šæ‹Ÿdomè¯¦è§£(å«æºç ) - æ˜é‡‘</a> !!!</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">export const App = &#123;</span><br><span class="line">    render() &#123;//UIé€»è¾‘</span><br><span class="line">        return h( //Vue ä¸­çš„åˆ›å»ºè™šæ‹Ÿ DOM çš„è¾…åŠ©å‡½æ•°,ç”¨äºåˆ›å»ºè™šæ‹Ÿ DOM èŠ‚ç‚¹,æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š</span><br><span class="line">            &#x27;div&#x27;, //è¦åˆ›å»ºçš„ HTML æ ‡ç­¾åæˆ–ç»„ä»¶é€‰é¡¹å¯¹è±¡.</span><br><span class="line">            &#x27;hi, &#x27; + this.msg //å­èŠ‚ç‚¹,å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„æˆ–å…¶ä»–è™šæ‹Ÿ DOM èŠ‚ç‚¹.</span><br><span class="line">        )</span><br><span class="line">    &#125;,</span><br><span class="line">    setup() &#123;//ç»„åˆå¼ API çš„å…¥å£ç‚¹,ç”¨äºç»„åˆç»„ä»¶çš„é€»è¾‘ï¼Œä¾‹å¦‚å“åº”å¼æ•°æ®ã€ç”Ÿå‘½å‘¨æœŸé’©å­ã€è®¡ç®—å±æ€§ç­‰</span><br><span class="line">        return &#123;</span><br><span class="line">            msg: &#x27;mini-vue&#x27;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŸºç¡€å®ç°"><a href="#åŸºç¡€å®ç°" class="headerlink" title="åŸºç¡€å®ç°"></a>åŸºç¡€å®ç°</h4><p><strong>createApp.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export function createApp(rootComponent: any) &#123; // ä¼ å…¥æ ¹ç»„ä»¶</span><br><span class="line">    return &#123;</span><br><span class="line">        mount(rootContainer: any) &#123; // æŒ‚è½½å›æ ¹å®¹å™¨</span><br><span class="line">            // å…ˆæŠŠæ ¹ç»„ä»¶è½¬æ¢æˆè™šæ‹ŸèŠ‚ç‚¹vnode</span><br><span class="line">            // ä¹‹åæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šåŸºäºvnodeåšå¤„ç†</span><br><span class="line">            const vnode = createVNode(rootComponent)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>vnode.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export function createVNode(type: any, props?: any, children?: any) &#123;</span><br><span class="line">    const vnode = &#123;</span><br><span class="line">        type,// ç±»å‹</span><br><span class="line">        props,// å±æ€§</span><br><span class="line">        children,// å­©å­</span><br><span class="line">        el: null,// å¯¹åº”çš„çœŸå®dom</span><br><span class="line">        component: null,// ç»„ä»¶å®ä¾‹</span><br><span class="line">        key: props?.key,// å”¯ä¸€æ ‡è¯†</span><br><span class="line">        // shapeFlag: getShapeFlag(type), // ç±»å‹æ ‡è¯†</span><br><span class="line">    &#125;</span><br><span class="line">    return vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ·»åŠ renderå‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mount(rootContainer: any) &#123;</span><br><span class="line">    const vnode = createVNode(rootComponent)</span><br><span class="line"></span><br><span class="line">    render(vnode, rootContainer)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><strong>renderer.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createComponentInstance &#125; from &quot;./component&quot;</span><br><span class="line"></span><br><span class="line">export function render(vnode: any, container: any) &#123;</span><br><span class="line">    // è°ƒç”¨patchå‡½æ•°</span><br><span class="line">    patch(vnode, container)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function patch(vnode: any, container: any) &#123;</span><br><span class="line">    if (vnode.shapeFlag === 1) &#123;</span><br><span class="line">        // å¤„ç†element</span><br><span class="line">        processElement(vnode, container)  </span><br><span class="line">    &#125;else if (vnode.shapeFlag === 8) &#123;</span><br><span class="line">        // å¤„ç†component</span><br><span class="line">        processComponent(vnode, container)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function processElement(vnode: any, container: any) &#123;</span><br><span class="line">    mountElement(vnode, container)  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mountElement(vnode: any, container: any) &#123;</span><br><span class="line">    // åˆ›å»ºç»„ä»¶å®ä¾‹å¯¹è±¡</span><br><span class="line">    const instance = createComponentInstance(vnode)</span><br><span class="line"></span><br><span class="line">    // å¤„ç†ç»„ä»¶çš„setup</span><br><span class="line">    setupComponent(instance)</span><br><span class="line"></span><br><span class="line">    // å¤„ç†ç»„ä»¶çš„render</span><br><span class="line">    setupRenderEffect(instance, vnode, container)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>component.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">export function createComponentInstance(vnode: any) &#123;</span><br><span class="line">    const instance = &#123;</span><br><span class="line">        vnode,          // ç»„ä»¶çš„è™šæ‹ŸèŠ‚ç‚¹ï¼ˆè®¾è®¡å›¾ï¼‰</span><br><span class="line">        type: vnode.type, // ç»„ä»¶å®šä¹‰ï¼ˆæ¯”å¦‚ä½ å†™çš„ .vue æ–‡ä»¶ä¸­çš„å¯¹è±¡ï¼‰</span><br><span class="line">        props: vnode.props, // å¤–éƒ¨ä¼ å…¥çš„å±æ€§</span><br><span class="line">        slots: vnode.slots, // æ’æ§½å†…å®¹ï¼ˆç±»ä¼¼ `&lt;template #header&gt;`ï¼‰</span><br><span class="line">        proxy: null,     // ä»£ç†å¯¹è±¡ï¼ˆç”¨äºè®¿é—®æ•°æ®å’Œå±æ€§ï¼‰</span><br><span class="line">    &#125;;</span><br><span class="line">    return instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function setupComponent(instance: any) &#123;</span><br><span class="line">    // åˆå§‹åŒ–ç»„ä»¶</span><br><span class="line">    initProps(instance)</span><br><span class="line">    initSlots(instance)</span><br><span class="line"></span><br><span class="line">    // å¤„ç†ç»„ä»¶çš„setup</span><br><span class="line">    setupStatefulComponent(instance)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function setupStatefulComponent(instance: any) &#123;</span><br><span class="line">    // å…ˆæ‹¿åˆ°ç»„ä»¶</span><br><span class="line">    const Component = instance.type // ç»„ä»¶å®šä¹‰ï¼ˆæ¯”å¦‚ä½ å†™çš„ setup å‡½æ•°ï¼‰</span><br><span class="line"></span><br><span class="line">    // ä»£ç†å¯¹è±¡ï¼ˆç”¨äºè®¿é—®æ•°æ®å’Œå±æ€§ï¼‰</span><br><span class="line">    instance.proxy = new Proxy(instance, &#123;</span><br><span class="line">        get(target, key) &#123;</span><br><span class="line">            const &#123; setup, props &#125; = target</span><br><span class="line"></span><br><span class="line">            if (key in setup) &#123;// ä¼˜å…ˆä» setup è¿”å›å€¼ä¸­æ‰¾</span><br><span class="line">                return setup[key]       </span><br><span class="line">            &#125;   else if (key in props) &#123;// å…¶æ¬¡ä» props ä¸­æ‰¾</span><br><span class="line">                return props[key]</span><br><span class="line">            &#125;</span><br><span class="line">            return Reflect.get(target, key)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)  </span><br><span class="line"></span><br><span class="line">    const &#123; setup &#125; = Component //è§£æ„å‡ºsetup</span><br><span class="line"></span><br><span class="line">    if (setup) &#123;</span><br><span class="line">        setCurrentInstance(instance) // æ ‡è®°â€œå½“å‰å¯¹è±¡æ˜¯è°â€</span><br><span class="line">        const setupResult = setup() // æ‰§è¡Œä½ çš„ setup å‡½æ•°</span><br><span class="line">        setCurrentInstance(null) // æ¸…é™¤æ ‡è®°</span><br><span class="line"></span><br><span class="line">        handleSetupResult(instance, setupResult) // ä¿å­˜ setup è¿”å›å€¼</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        finishComponentSetup(instance) // æ²¡æœ‰ setup ç›´æ¥å®Œæˆåˆå§‹åŒ–</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleSetupResult(instance: any, setupResult: any) &#123;</span><br><span class="line">    if (typeof setupResult === &#x27;object&#x27;) &#123;</span><br><span class="line">        instance.setupState = setupResult; // ä¿å­˜ setup è¿”å›çš„å¯¹è±¡</span><br><span class="line">    &#125;</span><br><span class="line">    finishComponentSetup(instance); // å®Œæˆç»„è£…</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function finishComponentSetup(instance: any) &#123;</span><br><span class="line">    const Component = instance.type;</span><br><span class="line">    // ç¡®å®š render å‡½æ•°ï¼ˆä½ å†™çš„ template ä¼šè¢«ç¼–è¯‘æˆ render å‡½æ•°ï¼‰</span><br><span class="line">    instance.render = Component.render || instance.vnode.render;</span><br><span class="line">    // å‡†å¤‡æ¸²æŸ“ï¼ˆè™šæ‹Ÿ DOM ç”ŸæˆçœŸå® DOMï¼‰</span><br><span class="line">    setupRenderEffect(instance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>renderer.ts ç»§ç»­å®Œå–„é€»è¾‘</strong></p><blockquote><p>**å›è°ƒrenderï¼Œå®ç° â€œæ‹†ç®±â€ **</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function setupRenderEffect(instance: any, vnode: any, container: any) &#123;</span><br><span class="line">    const &#123; proxy &#125; = instance</span><br><span class="line">    const subTree = instance.render.call(proxy) //æ‹¿åˆ°è™šæ‹ŸèŠ‚ç‚¹æ ‘</span><br><span class="line"></span><br><span class="line">    // vnode -&gt; patch</span><br><span class="line">    // vnode -&gt; element -&gt; mountElement</span><br><span class="line">    patch(subTree, container)</span><br><span class="line"></span><br><span class="line">    vnode.el = subTree.el</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-rollup-æ‰“åŒ…åº“"><a href="#ä½¿ç”¨-rollup-æ‰“åŒ…åº“" class="headerlink" title="ä½¿ç”¨ rollup æ‰“åŒ…åº“"></a>ä½¿ç”¨ rollup æ‰“åŒ…åº“</h3><blockquote><p><strong>rollupä¸€èˆ¬ç”¨äºåº“çš„æ‰“åŒ…ï¼Œè€Œwebpackæ›´å¤šç”¨äºåº”ç”¨çš„æ‰“åŒ…</strong></p><blockquote><p><strong>æ„å»ºè¾“å‡ºçš„ä½œç”¨ğŸ‘‡</strong></p></blockquote><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æä¾›å¯¹ä¸åŒæ¨¡å—æ ¼å¼çš„æ”¯æŒï¼Œå¢å¼ºåº“çš„å…¼å®¹æ€§</span><br><span class="line">ä¼˜åŒ–ä»£ç ä½“ç§¯ä¸æ€§èƒ½</span><br><span class="line">ç®€åŒ–åº“çš„åˆ†å‘ä¸ä½¿ç”¨æµç¨‹ï¼Œä¿ƒè¿›ç»„ä»¶å¤ç”¨</span><br><span class="line">å®ç°æŒ‰éœ€åŠ è½½</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><strong>åœ¨ä»¥ä¸‹æ¡ˆä¾‹ä¸­å°±æ„å»ºäº†ä¸¤ç§æ ¼å¼ CommonJS &amp; ES Module çš„æ–‡ä»¶</strong></p></blockquote></blockquote><h4 id="é…ç½®rollup"><a href="#é…ç½®rollup" class="headerlink" title="é…ç½®rollup"></a>é…ç½®rollup</h4><p><strong>å®‰è£…</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install --global rollup</span><br></pre></td></tr></table></figure><p><strong>å®‰è£…å®˜æ–¹ä¾èµ–</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pnpm install @rollup/plugin-typescript --save-dev</span><br><span class="line">pnpm install tslib</span><br></pre></td></tr></table></figure><blockquote><p><strong>åˆ›å»º src / index.ts ä½œä¸º mini-vue çš„å‡ºå…¥å£</strong></p></blockquote><p><strong>rollup.config.js ç¼–å†™è„šæœ¬æ–‡ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import typescript from &#x27;@rollup/plugin-typescript&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    input: &#x27;src/index.ts&#x27;, // å…¥å£æ–‡ä»¶</span><br><span class="line">    output: [</span><br><span class="line">        &#123;</span><br><span class="line">            file: &#x27;lib/guide-mini-vue.cjs.js&#x27;, // è¾“å‡ºçš„ CommonJS æ ¼å¼æ–‡ä»¶</span><br><span class="line">            format: &#x27;cjs&#x27;, // æŒ‡å®šè¾“å‡ºæ ¼å¼ä¸º CommonJS</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            file: &#x27;lib/guide-mini-vue.esm.js&#x27;, // è¾“å‡ºçš„ ES Module æ ¼å¼æ–‡ä»¶</span><br><span class="line">            format: &#x27;es&#x27;, // æŒ‡å®šè¾“å‡ºæ ¼å¼ä¸º ES Module</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    plugins: [</span><br><span class="line">        // æ’ä»¶åˆ—è¡¨</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ„å»ºçš„è¾“å‡ºæ–‡ä»¶å°±æ˜¯libä¸‹çš„ guide-mini-vue.cjs.js &amp; guide-mini-vue.esm.js è¿™ä¸¤ä¸ªæ–‡ä»¶</strong></p></blockquote><p><strong>åœ¨package.jsonä¸­æ‰“å¼€ä¾èµ–</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;jest&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;rollup -c config.js&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><strong>æ›´æ”¹tsconfig.jsonä¾èµ–é¡¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;module&quot;: &quot;esnext&quot;,</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><strong>å¤„ç†srcä¸‹çš„indexæ–‡ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// mini-vue çš„å…¥å£</span><br><span class="line">export * from &#x27;./runtime-core&#x27;</span><br></pre></td></tr></table></figure><p><strong>å†å¤„ç†runtime-coreä¸‹çš„indexæ–‡ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export &#123; createApp &#125; from &quot;./createApp&quot;;</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm build å³å¯æ„å»ºä¸¤ç§æ ¼å¼çš„æ–‡ä»¶</strong></p></blockquote><p><em><strong>è¡¥å……hå‡½æ•°é€»è¾‘</strong></em></p><blockquote><p><strong>å‰æƒ…æè¦</strong></p><p><strong>exampleä¸‹çš„App.jsæ–‡ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">export const App = &#123;</span><br><span class="line"> render() &#123; // UIé€»è¾‘</span><br><span class="line">     return h( // Vue ä¸­çš„åˆ›å»ºè™šæ‹Ÿ DOM çš„è¾…åŠ©å‡½æ•°,ç”¨äºåˆ›å»ºè™šæ‹Ÿ DOM èŠ‚ç‚¹,æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š</span><br><span class="line">         &#x27;div&#x27;, // è¦åˆ›å»ºçš„ HTML æ ‡ç­¾åæˆ–ç»„ä»¶é€‰é¡¹å¯¹è±¡.</span><br><span class="line">         &#123;&#125;, // æ ‡ç­¾å±æ€§,å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„.</span><br><span class="line">         &#x27;hi, &#x27; + this.msg // å­èŠ‚ç‚¹,å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„æˆ–å…¶ä»–è™šæ‹Ÿ DOM èŠ‚ç‚¹.</span><br><span class="line">     )</span><br><span class="line"> &#125;,</span><br><span class="line"> setup() &#123; // ç»„åˆå¼ API çš„å…¥å£ç‚¹,ç”¨äºç»„åˆç»„ä»¶çš„é€»è¾‘ï¼Œä¾‹å¦‚å“åº”å¼æ•°æ®ã€ç”Ÿå‘½å‘¨æœŸé’©å­ã€è®¡ç®—å±æ€§ç­‰</span><br><span class="line">     return &#123;</span><br><span class="line">         msg: &#x27;mini-vue&#x27;,</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p><strong>runtime-core / h.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createVNode &#125; from &quot;./vnode&quot;;</span><br><span class="line"></span><br><span class="line">export function h(type: any, props?: any, children?: any) &#123;</span><br><span class="line">    return createVNode(type, props, children)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>runtime-core / index.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export &#123; createApp &#125; from &#x27;./createApp&#x27;</span><br><span class="line">import &#123; h &#125; from &#x27;./h&#x27;</span><br></pre></td></tr></table></figure><blockquote><p><strong>pnpm build ç»§ç»­æ„å»ºåˆ° example æµ‹è¯•é¡¹ç›®é‡Œ</strong></p></blockquote><p><strong>ç„¶åå°±å¯ä»¥åœ¨exampleä¸­ç›´æ¥å¼•ç”¨æ„å»ºä¸‹æ¥çš„æ–‡ä»¶</strong></p><p><strong>main.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// vue3</span><br><span class="line">import &#123; createApp &#125; from &#x27;../../lib/guide-mini-vue.esm.js&#x27; // å¯¼å…¥è‡ªå·±æ„å»ºçš„æ–‡ä»¶</span><br><span class="line">import &#123; App &#125; from &#x27;./App.js&#x27;</span><br><span class="line"></span><br><span class="line">createApp(App).mount(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure><p><strong>ç„¶åå°±å¯ä»¥æ‰“å¼€HTMLæ–‡ä»¶äº†</strong></p><h2 id="runtime-dom-å°è£…DOMæ–¹æ³•"><a href="#runtime-dom-å°è£…DOMæ–¹æ³•" class="headerlink" title="runtime-dom å°è£…DOMæ–¹æ³•"></a>runtime-dom å°è£…DOMæ–¹æ³•</h2><h2 id="compiler-core-ç¼–è¯‘é€»è¾‘å’Œç®—æ³•-1"><a href="#compiler-core-ç¼–è¯‘é€»è¾‘å’Œç®—æ³•-1" class="headerlink" title="compiler-core ç¼–è¯‘é€»è¾‘å’Œç®—æ³•"></a>compiler-core ç¼–è¯‘é€»è¾‘å’Œç®—æ³•</h2><h2 id="compiler-sfc-è§£æ-vueç»„ä»¶-1"><a href="#compiler-sfc-è§£æ-vueç»„ä»¶-1" class="headerlink" title="compiler-sfc è§£æ.vueç»„ä»¶"></a>compiler-sfc è§£æ.vueç»„ä»¶</h2><h2 id="compiler-dom-å¤„ç†templateæ ‡ç­¾"><a href="#compiler-dom-å¤„ç†templateæ ‡ç­¾" class="headerlink" title="compiler-dom å¤„ç†templateæ ‡ç­¾"></a>compiler-dom å¤„ç†templateæ ‡ç­¾</h2>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>EChartså›¾è¡¨åº“å®æˆ˜</title>
      <link href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/ECharts%E5%AE%98%E6%96%B9%E5%9B%BE%E8%A1%A8%E5%BA%93CV%E6%95%99%E7%A8%8B/"/>
      <url>/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/ECharts%E5%AE%98%E6%96%B9%E5%9B%BE%E8%A1%A8%E5%BA%93CV%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="æœ¬æ–‡é¡¹ç›®ä¸»å¹²ç»“æ„"><a href="#æœ¬æ–‡é¡¹ç›®ä¸»å¹²ç»“æ„" class="headerlink" title="æœ¬æ–‡é¡¹ç›®ä¸»å¹²ç»“æ„"></a>æœ¬æ–‡é¡¹ç›®ä¸»å¹²ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ public</span><br><span class="line">â”‚   â””â”€â”€ data.json        # æ•°æ®æ–‡ä»¶ï¼ˆé™æ€æ‹†åˆ†æ•°æ®æ—¶ä½¿ç”¨ï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ src</span><br><span class="line">â”‚   â”œâ”€â”€ utils           # å·¥å…·</span><br><span class="line">â”‚   â”‚   â””â”€â”€ request.ts  # axiosäºŒæ¬¡å°è£…</span><br><span class="line">â”‚   â”‚</span><br><span class="line">â”‚   â”œâ”€â”€ store              # Piniaä»“åº“</span><br><span class="line">â”‚   â”‚   â””â”€â”€ chartStore.ts  # ç®¡ç†å›¾è¡¨ç›¸å…³çš„æ•°æ®</span><br><span class="line">â”‚   â”‚</span><br><span class="line">â”‚   â”œâ”€â”€ services         # API æœåŠ¡</span><br><span class="line">â”‚   â”‚   â””â”€â”€ api.ts       # æ¨¡æ‹Ÿåç«¯ API è¯·æ±‚</span><br><span class="line">â”‚   â”‚</span><br><span class="line">â”‚   â”œâ”€â”€ components       # ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ chart        # å›¾è¡¨ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ category # å›¾è¡¨åˆ†ç±»</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ rose.vue  # ç«ç‘°å›¾ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ bar.vue   # æŸ±çŠ¶å›¾ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ line.vue  # æŠ˜çº¿å›¾ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ pie.vue   # é¥¼çŠ¶å›¾ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ scaatter  # æ•£ç‚¹å›¾ç»„ä»¶</span><br><span class="line">â”‚   â”‚   â”‚   â”‚</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ data     # æ•°æ®å¤„ç†é€»è¾‘</span><br><span class="line">â”‚   â”‚   â”‚   â”‚   â””â”€â”€ chartData.ts # æ•°æ®è·å–å’Œå¤„ç†</span><br><span class="line">â”‚   â”‚   â”‚   â”‚</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ chart.vue # æ‰€æœ‰å›¾è¡¨æ±‡æ€»</span><br><span class="line">â”‚   â”‚   â”‚</span><br><span class="line">â”‚   â”‚   â””â”€â”€ other-components # å…¶ä»–ç»„ä»¶</span><br><span class="line">â”‚   â”‚</span><br><span class="line">â”‚   â”œâ”€â”€ App.vue          # æ ¹ç»„ä»¶</span><br><span class="line">â”‚   â”œâ”€â”€ main.ts          # å…¥å£æ–‡ä»¶</span><br><span class="line">â”‚   â”‚</span><br><span class="line">â”‚   â””â”€â”€ types            # ç±»å‹å®šä¹‰</span><br><span class="line">â”‚       â””â”€â”€ chart.d.ts   # ECharts æ•°æ®ç±»å‹å®šä¹‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ vite.config.ts       # Vite é…ç½®æ–‡ä»¶</span><br><span class="line">â””â”€â”€ package.json         # é¡¹ç›®ä¾èµ–</span><br></pre></td></tr></table></figure><p><a href="https://echarts.apache.org/examples/zh/index.html">Examples - Apache ECharts</a></p><p><strong>Echartså®˜ç½‘â†’æ‰€æœ‰ç¤ºä¾‹â†’é€‰æ‹©éœ€è¦å¯¼å…¥çš„å›¾è¡¨â†’å®Œæ•´ä»£ç </strong></p><p>æœ¬æ–‡ä»¥åŸºç¡€å—ä¸æ ¼å°”ç«ç‘°å›¾ä½œç¤ºä¾‹</p><p><a href="https://echarts.apache.org/examples/zh/editor.html?c=pie-roseType-simple&lang=ts&version=5.5.0">Examples - Apache ECharts</a></p><h3 id="å®˜ç½‘æºç ï¼ˆåŸç”ŸJSï¼‰"><a href="#å®˜ç½‘æºç ï¼ˆåŸç”ŸJSï¼‰" class="headerlink" title="å®˜ç½‘æºç ï¼ˆåŸç”ŸJSï¼‰"></a>å®˜ç½‘æºç ï¼ˆåŸç”ŸJSï¼‰</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> chartDom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>)!;</span><br><span class="line"><span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(chartDom);</span><br><span class="line"><span class="keyword">var</span> option;</span><br><span class="line"></span><br><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">legend</span>: &#123;</span><br><span class="line">    <span class="attr">top</span>: <span class="string">&#x27;bottom&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">toolbox</span>: &#123;</span><br><span class="line">    <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">feature</span>: &#123;</span><br><span class="line">      <span class="attr">mark</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      <span class="attr">dataView</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span>, <span class="attr">readOnly</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      <span class="attr">restore</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      <span class="attr">saveAsImage</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">series</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Nightingale Chart&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">      <span class="attr">radius</span>: [<span class="number">50</span>, <span class="number">250</span>],</span><br><span class="line">      <span class="attr">center</span>: [<span class="string">&#x27;50%&#x27;</span>, <span class="string">&#x27;50%&#x27;</span>],</span><br><span class="line">      <span class="attr">roseType</span>: <span class="string">&#x27;area&#x27;</span>,</span><br><span class="line">      <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">        <span class="attr">borderRadius</span>: <span class="number">8</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">data</span>: [</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">40</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 1&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">38</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 2&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">32</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 3&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">30</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 4&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">28</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 5&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">26</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 6&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">22</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 7&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">value</span>: <span class="number">18</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 8&#x27;</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">option &amp;&amp; myChart.<span class="title function_">setOption</span>(option);</span><br></pre></td></tr></table></figure><h3 id="è½¬Vueç»„ä»¶ï¼ˆé™æ€æ•°æ®ï¼‰"><a href="#è½¬Vueç»„ä»¶ï¼ˆé™æ€æ•°æ®ï¼‰" class="headerlink" title="è½¬Vueç»„ä»¶ï¼ˆé™æ€æ•°æ®ï¼‰"></a>è½¬Vueç»„ä»¶ï¼ˆé™æ€æ•°æ®ï¼‰</h3><p>rose.vue</p><h4 id="template"><a href="#template" class="headerlink" title="template"></a>template</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div ref=&quot;chartContainer&quot; class=&quot;chart-container&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="script"><a href="#script" class="headerlink" title="script"></a>script</h4><h5 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å…¶ä»–æŒ‰éœ€å¼•å…¥</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onMounted, ref, onUnmounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>; <span class="comment">//æ›´å¤šçš„çœ‹è‡ªå·±éœ€æ±‚</span></span><br></pre></td></tr></table></figure><h5 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h5><p>JSæºç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> chartDom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>)!;</span><br></pre></td></tr></table></figure><p><strong>è½¬vueç»„ä»¶</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å›¾è¡¨å®¹å™¨çš„å¼•ç”¨</span></span><br><span class="line"><span class="keyword">const</span> chartContainer = ref&lt;<span class="title class_">HTMLElement</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><p>JSæºç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(chartDom);</span><br></pre></td></tr></table></figure><p><strong>è½¬vueç»„ä»¶</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰å›¾è¡¨å®ä¾‹</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myChart</span>: echarts.<span class="property">ECharts</span> | <span class="literal">null</span> = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><h5 id="option"><a href="#option" class="headerlink" title="option"></a>option</h5><p>JSæºç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> option;</span><br><span class="line">option = &#123;</span><br><span class="line">    <span class="comment">//è¿™æ®µç›´æ¥å¤åˆ¶è¿‡æ¥//</span></span><br><span class="line">    <span class="attr">legend</span>: &#123;</span><br><span class="line">        <span class="attr">top</span>: <span class="string">&#x27;bottom&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//è¿™æ®µç›´æ¥å¤åˆ¶è¿‡æ¥//</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>è½¬vueç»„ä»¶</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰å›¾è¡¨é€‰é¡¹</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">option</span>: echarts.<span class="property">EChartsOption</span> = &#123;</span><br><span class="line">    <span class="comment">//è¿™æ®µç›´æ¥å¤åˆ¶è¿‡æ¥//</span></span><br><span class="line">    <span class="attr">legend</span>: &#123;</span><br><span class="line">        <span class="attr">top</span>: <span class="string">&#x27;bottom&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//è¿™æ®µç›´æ¥å¤åˆ¶è¿‡æ¥//</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h5><p>JSæºç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">option &amp;&amp; myChart.<span class="title function_">setOption</span>(option);</span><br></pre></td></tr></table></figure><p><strong>è½¬vueç»„ä»¶ï¼ˆä¼˜åŒ–ç‰ˆï¼‰</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–å›¾è¡¨</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!chartContainer.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ– ECharts å®ä¾‹</span></span><br><span class="line">  myChart = echarts.<span class="title function_">init</span>(chartContainer.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®å›¾è¡¨é€‰é¡¹</span></span><br><span class="line">  myChart.<span class="title function_">setOption</span>(option);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œè‡ªåŠ¨è°ƒæ•´å›¾è¡¨å¤§å°</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…ç†å›¾è¡¨å®ä¾‹</span></span><br><span class="line"><span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (myChart) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">    myChart.<span class="title function_">dispose</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰å‡½æ•°ï¼šè°ƒæ•´å›¾è¡¨å¤§å°</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">resizeChart</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (myChart) &#123;</span><br><span class="line">    myChart.<span class="title function_">resize</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="style"><a href="#style" class="headerlink" title="style"></a>style</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.chart-container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>; <span class="comment">/* æ ¹æ®éœ€è¦è°ƒæ•´é«˜åº¦ */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŠ½ç¦»æ•°æ®å†™æ³•ï¼ˆé™æ€æ•°æ®ï¼‰"><a href="#æŠ½ç¦»æ•°æ®å†™æ³•ï¼ˆé™æ€æ•°æ®ï¼‰" class="headerlink" title="æŠ½ç¦»æ•°æ®å†™æ³•ï¼ˆé™æ€æ•°æ®ï¼‰"></a>æŠ½ç¦»æ•°æ®å†™æ³•ï¼ˆé™æ€æ•°æ®ï¼‰</h3><p>ã€æ³¨ï¼šè¿™é‡Œæ˜¯ä»æœ¬åœ°è°ƒç”¨æ•°æ®çš„å†™æ³•ï¼Œéœ€è¦ã€‘</p><h4 id="public-data-json"><a href="#public-data-json" class="headerlink" title="public &#x2F; data.json"></a>public &#x2F; data.json</h4><p>(æ¨¡æ‹Ÿåç«¯ä¼ æ¥çš„æ•°æ®)</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 1&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">38</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 2&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">32</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 3&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 4&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">28</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 5&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">26</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 6&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 7&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rose 8&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="å›¾è¡¨ç»„ä»¶ä¿®æ”¹"><a href="#å›¾è¡¨ç»„ä»¶ä¿®æ”¹" class="headerlink" title="å›¾è¡¨ç»„ä»¶ä¿®æ”¹"></a>å›¾è¡¨ç»„ä»¶ä¿®æ”¹</h4><p>option &#x2F; series éƒ¨åˆ†</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: [</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">40</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 1&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">38</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 2&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">32</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 3&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">30</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 4&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">28</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 5&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">26</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 6&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">22</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 7&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="number">18</span>, <span class="attr">name</span>: <span class="string">&#x27;rose 8&#x27;</span> &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>æ”¹ä¸º</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: [], <span class="comment">// åˆå§‹ä¸ºç©ºï¼Œç¨åä» data.json åŠ è½½</span></span><br></pre></td></tr></table></figure><h5 id="æ·»åŠ å¼‚æ­¥åŠ è½½å‡½æ•°"><a href="#æ·»åŠ å¼‚æ­¥åŠ è½½å‡½æ•°" class="headerlink" title="æ·»åŠ å¼‚æ­¥åŠ è½½å‡½æ•°"></a>æ·»åŠ å¼‚æ­¥åŠ è½½å‡½æ•°</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼‚æ­¥åŠ è½½æ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ fetch ä» public/data.json è·å–æ•°æ®</span></span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/data.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ æŠ¥é”™æç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Failed to fetch data&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æå–æ•°æ®</span></span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°† JSON æ•°æ®è½¬æ¢ä¸º ECharts éœ€è¦çš„æ ¼å¼ï¼ˆæ ¹æ®æ•°æ®é”®å€¼å¯¹è‡ªè¡Œä¿®æ”¹ï¼‰</span></span><br><span class="line">        <span class="keyword">const</span> chartData = data.<span class="property">data</span>.<span class="title function_">map</span>(<span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">            <span class="attr">value</span>: item.<span class="property">value</span>,</span><br><span class="line">            <span class="attr">name</span>: item.<span class="property">name</span>,</span><br><span class="line">        &#125;))</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›¿æ¢å›¾è¡¨é€‰é¡¹ä¸­â€˜dataâ€™é¡¹</span></span><br><span class="line">        option.<span class="property">series</span>[<span class="number">0</span>].<span class="property">data</span> = chartData;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœå›¾è¡¨å·²ç»åˆå§‹åŒ–ï¼Œåˆ™é‡æ–°è®¾ç½®é€‰é¡¹</span></span><br><span class="line">        <span class="keyword">if</span> (myChart) &#123;</span><br><span class="line">            myChart.<span class="title function_">setOption</span>(option);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading data:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="è°ƒç”¨å‡½æ•°-loadData"><a href="#è°ƒç”¨å‡½æ•°-loadData" class="headerlink" title="è°ƒç”¨å‡½æ•° loadData"></a>è°ƒç”¨å‡½æ•° loadData</h5><p>åœ¨ onMounted ä¸­çš„ setOption å</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!chartContainer.<span class="property">value</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– ECharts å®ä¾‹</span></span><br><span class="line">    myChart = echarts.<span class="title function_">init</span>(chartContainer.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å›¾è¡¨é€‰é¡¹</span></span><br><span class="line">    myChart.<span class="title function_">setOption</span>(option)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ è½½æ•°æ®å¹¶æ›´æ–°å›¾è¡¨</span></span><br><span class="line">    <span class="title function_">loadData</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œè‡ªåŠ¨è°ƒæ•´å›¾è¡¨å¤§å°</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="çœŸå®å‰åç«¯å¯¹æ¥ï¼ˆåŠ¨æ€è¯·æ±‚ï¼‰"><a href="#çœŸå®å‰åç«¯å¯¹æ¥ï¼ˆåŠ¨æ€è¯·æ±‚ï¼‰" class="headerlink" title="çœŸå®å‰åç«¯å¯¹æ¥ï¼ˆåŠ¨æ€è¯·æ±‚ï¼‰"></a>çœŸå®å‰åç«¯å¯¹æ¥ï¼ˆåŠ¨æ€è¯·æ±‚ï¼‰</h3><h4 id="ä½¿ç”¨-axios"><a href="#ä½¿ç”¨-axios" class="headerlink" title="ä½¿ç”¨ axios"></a>ä½¿ç”¨ <code>axios</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install axios</span><br></pre></td></tr></table></figure><h5 id="axiosäºŒæ¬¡å°è£…"><a href="#axiosäºŒæ¬¡å°è£…" class="headerlink" title="axiosäºŒæ¬¡å°è£…"></a>axiosäºŒæ¬¡å°è£…</h5><p>æ¨¡æ¿</p><p><code>src/utils/request.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios, &#123; <span class="title class_">AxiosInstance</span>, <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span>; <span class="comment">// Element Plus ç»„ä»¶ï¼ˆä¸»è¦æ˜¯ä½¿ç”¨Messageæ¶ˆæ¯å¼¹å‡ºæ¡†ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span>; <span class="comment">// å¼•å…¥ Pinia Store</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span>; <span class="comment">// å¼•å…¥ Vue Router</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º axios å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">service</span>: <span class="title class_">AxiosInstance</span> = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_API_BASE_URL</span> || <span class="string">&#x27;/&#x27;</span>, <span class="comment">// ä»ç¯å¢ƒå˜é‡ä¸­è·å– API åŸºç¡€è·¯å¾„</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span>, <span class="comment">// è¯·æ±‚è¶…æ—¶æ—¶é—´</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚æ‹¦æˆªå™¨</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åœ¨å‘é€è¯·æ±‚ä¹‹å‰åšäº›ä»€ä¹ˆ</span></span><br><span class="line">    <span class="comment">// ä¾‹å¦‚ï¼Œæ·»åŠ èº«ä»½éªŒè¯ token</span></span><br><span class="line">    <span class="keyword">const</span> token = store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">token</span>; <span class="comment">// å‡è®¾ä½ æœ‰ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨ Pinia ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      config.<span class="property">headers</span>[<span class="string">&#x27;Authorization&#x27;</span>] = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å“åº”æ‹¦æˆªå™¨</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹å“åº”æ•°æ®åšç‚¹ä»€ä¹ˆ</span></span><br><span class="line">    <span class="keyword">const</span> res = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ¥å£è¿”å›çš„çŠ¶æ€ç ä¸æ˜¯ 200ï¼Œè¯´æ˜è¯·æ±‚å¤±è´¥</span></span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">code</span> !== <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(res.<span class="property">message</span> || <span class="string">&#x27;Error&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(res.<span class="property">message</span> || <span class="string">&#x27;Error&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹å“åº”é”™è¯¯åšç‚¹ä»€ä¹ˆ</span></span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">response</span>) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (error.<span class="property">response</span>.<span class="property">status</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">401</span>:</span><br><span class="line">          <span class="comment">// æ¸…é™¤ Token å¹¶è·³è½¬åˆ°ç™»å½•é¡µé¢</span></span><br><span class="line">          store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/logout&#x27;</span>);</span><br><span class="line">          router.<span class="title function_">push</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">403</span>:</span><br><span class="line">          <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;Forbidden&#x27;</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">404</span>:</span><br><span class="line">          <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;Not Found&#x27;</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">500</span>:</span><br><span class="line">          <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;Server Error&#x27;</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">          <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;Network Error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service;</span><br></pre></td></tr></table></figure><p>ç°åœ¨å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡ <code>import request from &#39;@/utils/request&#39;</code> æ¥ä½¿ç”¨å°è£…åçš„ axios å®ä¾‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="å‡½æ•°-loadDataä¿®æ”¹"><a href="#å‡½æ•°-loadDataä¿®æ”¹" class="headerlink" title="å‡½æ•° loadDataä¿®æ”¹"></a>å‡½æ•° loadDataä¿®æ”¹</h5><p>é™æ€è·å–</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">loadData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">/////æ›´æ”¹å¤„////</span></span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/data.json&#x27;</span>) <span class="comment">// ä½¿ç”¨ fetch ä» public/data.json è·å–æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Failed to fetch data&#x27;</span>) &#125;</span><br><span class="line">        <span class="comment">/////æ›´æ”¹å¤„////</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>()</span><br><span class="line">        ......</span><br></pre></td></tr></table></figure><p>åŠ¨æ€å¯¹æ¥</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">/////æ›´æ”¹å¤„////</span></span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/api/data&#x27;</span>); <span class="comment">// å‡è®¾åç«¯ API åœ°å€ä¸º /api/data</span></span><br><span class="line">        <span class="comment">/////æ›´æ”¹å¤„////</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">const</span> data = response.<span class="property">data</span>;</span><br><span class="line">        ......</span><br></pre></td></tr></table></figure><h4 id="PiniaçŠ¶æ€ç®¡ç†"><a href="#PiniaçŠ¶æ€ç®¡ç†" class="headerlink" title="PiniaçŠ¶æ€ç®¡ç†"></a>PiniaçŠ¶æ€ç®¡ç†</h4><p>å¦‚æœä½ çš„åº”ç”¨ä¸­æœ‰å¤šä¸ªç»„ä»¶éœ€è¦å…±äº«æ•°æ®ï¼ˆä¾‹å¦‚å¤šä¸ªå›¾è¡¨å…±äº«åŒä¸€ä»½æ•°æ®ï¼‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Vuex æˆ– Pinia è¿›è¡ŒçŠ¶æ€ç®¡ç†ã€‚è¿™æ ·å¯ä»¥é¿å…é‡å¤çš„ API è¯·æ±‚ï¼Œå¹¶ä¸”æ›´å®¹æ˜“ç®¡ç†æ•°æ®æµã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install pinia</span><br></pre></td></tr></table></figure><h5 id="åœ¨-main-ts-ä¸­æ³¨å†ŒPinia"><a href="#åœ¨-main-ts-ä¸­æ³¨å†ŒPinia" class="headerlink" title="åœ¨ main.ts ä¸­æ³¨å†ŒPinia"></a>åœ¨ <code>main.ts</code> ä¸­æ³¨å†ŒPinia</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œ Pinia</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">createPinia</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œ Vue Router å’Œ Element Plus</span></span><br><span class="line">app.<span class="title function_">use</span>(router);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure><h5 id="chartStore-ts"><a href="#chartStore-ts" class="headerlink" title="chartStore.ts"></a><code>chartStore.ts</code></h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ChartState</span> &#123;</span><br><span class="line">    <span class="attr">chartData</span>: <span class="title class_">Array</span>&lt;&#123; <span class="attr">value</span>: <span class="built_in">number</span>; <span class="attr">name</span>: <span class="built_in">string</span> &#125;&gt;;</span><br><span class="line">    <span class="attr">isLoading</span>: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">error</span>: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useChartStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;chart&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">state</span>: (): <span class="function"><span class="params">ChartState</span> =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">chartData</span>: [], <span class="comment">// å›¾è¡¨æ•°æ®</span></span><br><span class="line">        <span class="attr">isLoading</span>: <span class="literal">false</span>, <span class="comment">// åŠ è½½çŠ¶æ€</span></span><br><span class="line">        <span class="attr">error</span>: <span class="literal">null</span>, <span class="comment">// é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">fetchChartData</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">error</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> response = <span class="keyword">await</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/data&#x27;</span>); <span class="comment">// å‡è®¾åç«¯ API åœ°å€ä¸º /api/data</span></span><br><span class="line">                <span class="keyword">const</span> data = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å°† JSON æ•°æ®è½¬æ¢ä¸º ECharts éœ€è¦çš„æ ¼å¼</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">chartData</span> = data.<span class="title function_">map</span>(<span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">                    <span class="attr">value</span>: item.<span class="property">sales</span>,</span><br><span class="line">                    <span class="attr">name</span>: item.<span class="property">category</span>,</span><br><span class="line">                &#125;));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">error</span> = <span class="string">&#x27;Failed to load chart data&#x27;</span>;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading data:&#x27;</span>, error);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥åœ¨ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨ç°æˆçš„æ•°æ®é€»è¾‘äº†</p><h5 id="rose-vue"><a href="#rose-vue" class="headerlink" title="rose.vue"></a><code>rose.vue</code></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    import &#123; onMounted, onUnmounted, ref, watch &#125; from &#x27;vue&#x27;;</span><br><span class="line">    import * as echarts from &#x27;echarts&#x27;;</span><br><span class="line">    import &#123; useChartStore &#125; from &#x27;@/store/chartStore&#x27;;// è°ƒç”¨è‡ªå®šä¹‰Store</span><br><span class="line"></span><br><span class="line">    const chartContainer = ref&lt;HTMLElement | null&gt;(null);</span><br><span class="line">    let myChart: echarts.ECharts | null = null;</span><br><span class="line"></span><br><span class="line">    // è·å– Pinia Store</span><br><span class="line">    const chartStore = useChartStore();</span><br><span class="line"></span><br><span class="line">    // å®šä¹‰å›¾è¡¨é€‰é¡¹</span><br><span class="line">    const option: echarts.EChartsOption = &#123;</span><br><span class="line">        legend: &#123;</span><br><span class="line">            top: &#x27;bottom&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">        toolbox: &#123;</span><br><span class="line">            show: true,</span><br><span class="line">            feature: &#123;</span><br><span class="line">                mark: &#123; show: true &#125;,</span><br><span class="line">                dataView: &#123; show: true, readOnly: false &#125;,</span><br><span class="line">                restore: &#123; show: true &#125;,</span><br><span class="line">                saveAsImage: &#123; show: true &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        series: [</span><br><span class="line">            &#123;</span><br><span class="line">                name: &#x27;é”€é‡&#x27;,</span><br><span class="line">                type: &#x27;pie&#x27;,</span><br><span class="line">                radius: [50, 250],</span><br><span class="line">                center: [&#x27;50%&#x27;, &#x27;50%&#x27;],</span><br><span class="line">                roseType: &#x27;area&#x27;,</span><br><span class="line">                itemStyle: &#123;</span><br><span class="line">                    borderRadius: 8,</span><br><span class="line">                &#125;,</span><br><span class="line">                data: [], // åˆå§‹ä¸ºç©ºï¼Œç¨åä» Pinia Store è·å–</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // ç›‘å¬ Pinia Store ä¸­çš„æ•°æ®å˜åŒ–</span><br><span class="line">    watch(</span><br><span class="line">        () =&gt; chartStore.chartData,</span><br><span class="line">        (newData) =&gt; &#123;</span><br><span class="line">            if (myChart &amp;&amp; newData.length &gt; 0) &#123;</span><br><span class="line">                option.series[0].data = newData;</span><br><span class="line">                myChart.setOption(option);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">        if (!chartContainer.value) return;</span><br><span class="line">        // åˆå§‹åŒ– ECharts å®ä¾‹</span><br><span class="line">        myChart = echarts.init(chartContainer.value);</span><br><span class="line">        // è®¾ç½®åˆå§‹å›¾è¡¨é€‰é¡¹ï¼ˆæ­¤æ—¶ series.data ä¸ºç©ºï¼‰</span><br><span class="line">        myChart.setOption(option);</span><br><span class="line">        // åŠ è½½æ•°æ®</span><br><span class="line">        chartStore.fetchChartData();</span><br><span class="line">        // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œè‡ªåŠ¨è°ƒæ•´å›¾è¡¨å¤§å°</span><br><span class="line">        window.addEventListener(&#x27;resize&#x27;, resizeChart);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // åœ¨ç»„ä»¶å¸è½½æ—¶ç§»é™¤äº‹ä»¶ç›‘å¬å™¨</span><br><span class="line">    onUnmounted(() =&gt; &#123;</span><br><span class="line">        if (myChart) &#123;</span><br><span class="line">            window.removeEventListener(&#x27;resize&#x27;, resizeChart);</span><br><span class="line">            myChart.dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // è‡ªå®šä¹‰å‡½æ•°ï¼šè°ƒæ•´å›¾è¡¨å¤§å°</span><br><span class="line">    const resizeChart = () =&gt; &#123;</span><br><span class="line">        if (myChart) &#123;</span><br><span class="line">            myChart.resize();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h5 id="æ›´å¤šç»„ä»¶"><a href="#æ›´å¤šç»„ä»¶" class="headerlink" title="æ›´å¤šç»„ä»¶"></a>æ›´å¤šç»„ä»¶</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ ¹æ®ä¸Šè¿°æ­¥éª¤å®ç°å®˜ç½‘æºç è½¬Vueç»„ä»¶ï¼Œæ’å…¥åˆ°category #å›¾è¡¨åˆ†ç±» æ–‡ä»¶å¤¹ä¸‹å³å¯</span><br></pre></td></tr></table></figure><h4 id="åŠ è½½åŠ¨ç”»è®¾ç½®"><a href="#åŠ è½½åŠ¨ç”»è®¾ç½®" class="headerlink" title="åŠ è½½åŠ¨ç”»è®¾ç½®"></a>åŠ è½½åŠ¨ç”»è®¾ç½®</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!chartContainer.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ– ECharts å®ä¾‹</span></span><br><span class="line">  myChart = echarts.<span class="title function_">init</span>(chartContainer.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ˜¾ç¤ºåŠ è½½åŠ¨ç”»</span></span><br><span class="line">  myChart.<span class="title function_">showLoading</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŠ è½½æ•°æ®å¹¶æ›´æ–°å›¾è¡¨</span></span><br><span class="line">  <span class="title function_">loadData</span>().<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½éšè—åŠ è½½åŠ¨ç”»</span></span><br><span class="line">    myChart?.<span class="title function_">hideLoading</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œè‡ªåŠ¨è°ƒæ•´å›¾è¡¨å¤§å°</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeChart);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–"><a href="#ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–"></a>ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–</h4><h5 id="ç¼“å­˜æ•°æ®"><a href="#ç¼“å­˜æ•°æ®" class="headerlink" title="ç¼“å­˜æ•°æ®"></a>ç¼“å­˜æ•°æ®</h5><p>å¦‚æœæ•°æ®ä¸ä¼šé¢‘ç¹å˜åŒ–ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶ï¼ˆå¦‚ localStorage æˆ– sessionStorageï¼‰æ¥ç¼“å­˜æ•°æ®ï¼Œå‡å°‘ä¸å¿…è¦çš„ API è¯·æ±‚ã€‚</p><p><code>chartStore.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ChartState</span> &#123;</span><br><span class="line">  <span class="attr">chartData</span>: <span class="title class_">Array</span>&lt;&#123; <span class="attr">value</span>: <span class="built_in">number</span>; <span class="attr">name</span>: <span class="built_in">string</span> &#125;&gt;;</span><br><span class="line">  <span class="attr">isLoading</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">error</span>: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useChartStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;chart&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: (): <span class="function"><span class="params">ChartState</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">chartData</span>: [], <span class="comment">// å›¾è¡¨æ•°æ®</span></span><br><span class="line">    <span class="attr">isLoading</span>: <span class="literal">false</span>, <span class="comment">// åŠ è½½çŠ¶æ€</span></span><br><span class="line">    <span class="attr">error</span>: <span class="literal">null</span>, <span class="comment">// é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">fetchChartData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">error</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ£€æŸ¥æ˜¯å¦æœ‰ç¼“å­˜æ•°æ®</span></span><br><span class="line">      <span class="keyword">const</span> cachedData = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;chartData&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (cachedData) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chartData</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(cachedData);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/data&#x27;</span>); <span class="comment">// å‡è®¾åç«¯ API åœ°å€ä¸º /api/data</span></span><br><span class="line">        <span class="keyword">const</span> data = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°† JSON æ•°æ®è½¬æ¢ä¸º ECharts éœ€è¦çš„æ ¼å¼</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chartData</span> = data.<span class="title function_">map</span>(<span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">          <span class="attr">value</span>: item.<span class="property">sales</span>,</span><br><span class="line">          <span class="attr">name</span>: item.<span class="property">category</span>,</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¼“å­˜æ•°æ®</span></span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;chartData&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">chartData</span>));</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">error</span> = <span class="string">&#x27;Failed to load chart data&#x27;</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading data:&#x27;</span>, error);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="æŒ‰éœ€åŠ è½½"><a href="#æŒ‰éœ€åŠ è½½" class="headerlink" title="æŒ‰éœ€åŠ è½½"></a>æŒ‰éœ€åŠ è½½</h5><p>å¤§å‹å›¾è¡¨æˆ–å¤æ‚çš„æ•°æ®é›†ï¼Œå¯ä»¥è€ƒè™‘åˆ†é¡µåŠ è½½æ•°æ®æˆ–æ‡’åŠ è½½</p><p><code>chartStore.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useChartStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;chart&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: (): <span class="function"><span class="params">ChartState</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">chartData</span>: [],</span><br><span class="line">    <span class="attr">isLoading</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">error</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">fetchChartData</span>(<span class="params"><span class="attr">forceRefresh</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">error</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœä¸éœ€è¦å¼ºåˆ¶åˆ·æ–°ä¸”æœ‰ç¼“å­˜æ•°æ®ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ç¼“å­˜</span></span><br><span class="line">      <span class="keyword">if</span> (!forceRefresh) &#123;</span><br><span class="line">        <span class="keyword">const</span> cachedData = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;chartData&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cachedData) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">chartData</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(cachedData);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/api/data&#x27;</span>); <span class="comment">// å‡è®¾åç«¯ API åœ°å€ä¸º /api/data</span></span><br><span class="line">        <span class="keyword">const</span> data = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°† JSON æ•°æ®è½¬æ¢ä¸º ECharts éœ€è¦çš„æ ¼å¼</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chartData</span> = data.<span class="title function_">map</span>(<span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">any</span></span>) =&gt;</span> (&#123;</span><br><span class="line">          <span class="attr">value</span>: item.<span class="property">sales</span>,</span><br><span class="line">          <span class="attr">name</span>: item.<span class="property">category</span>,</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¼“å­˜æ•°æ®</span></span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;chartData&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">chartData</span>));</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">error</span> = <span class="string">&#x27;Failed to load chart data&#x27;</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading data:&#x27;</span>, error);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isLoading</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>rose.vue</code></p><p>è°ƒç”¨ fetchChartData æ—¶ä¼ é€’å‚æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ç¼“å­˜æ•°æ®</span></span><br><span class="line">chartStore.<span class="title function_">fetchChartData</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœéœ€è¦å¼ºåˆ¶åˆ·æ–°æ•°æ®ï¼ˆä¾‹å¦‚ç”¨æˆ·ç‚¹å‡»äº†â€œåˆ·æ–°â€æŒ‰é’®ï¼‰ï¼Œå¯ä»¥ä¼ é€’ true</span></span><br><span class="line"><span class="comment">// chartStore.fetchChartData(true);</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯æ·±å…¥æŠ€æœ¯æ–¹å‘é€‰å‹</title>
      <link href="/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%96%B9%E5%90%91%E9%80%89%E5%9E%8B/"/>
      <url>/2025/03/08/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%96%B9%E5%90%91%E9%80%89%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰ç«¯æŠ€æœ¯æ–¹å‘é€‰å‹"><a href="#å‰ç«¯æŠ€æœ¯æ–¹å‘é€‰å‹" class="headerlink" title="å‰ç«¯æŠ€æœ¯æ–¹å‘é€‰å‹"></a>å‰ç«¯æŠ€æœ¯æ–¹å‘é€‰å‹</h1><hr><h2 id="æ•°æ®å¯è§†åŒ–"><a href="#æ•°æ®å¯è§†åŒ–" class="headerlink" title="æ•°æ®å¯è§†åŒ–"></a>æ•°æ®å¯è§†åŒ–</h2><p><strong>ç®€ä»‹ï¼šå°†æ•°æ®ä»¥å›¾è¡¨ã€å›¾å½¢ç­‰å¯è§†åŒ–å½¢å¼å±•ç¤º</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ•°æ®å¯è§†åŒ–åº“ï¼Œå¦‚D3.jsã€EChartsã€AntVç­‰</span><br><span class="line">JavaScriptçš„æ•°ç»„æ“ä½œã€æ•°æ®è¿‡æ»¤</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ•°æ®å¤„ç†å’Œåˆ†æèƒ½åŠ›è¦æ±‚é«˜</span><br><span class="line">JavaScriptçš„æ•°ç»„æ“ä½œã€æ•°æ®è¿‡æ»¤ç­‰æ–¹æ³•</span><br><span class="line">ä¸åŒå›¾è¡¨ç±»å‹çš„ç‰¹ç‚¹å’Œé…ç½®é€‰é¡¹å¤æ‚ï¼Œéœ€è¦æ·±å…¥äº†è§£</span><br><span class="line">å¯è§†åŒ–æ•ˆæœçš„è®¾è®¡å’Œä¼˜åŒ–éš¾åº¦å¤§ï¼Œå¦‚è‰²å½©æ­é…ã€å¸ƒå±€è°ƒæ•´ç­‰ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæ¯”è¾ƒæˆç†Ÿï¼Œå·²æœ‰è®¸å¤šæˆç†Ÿçš„æ•°æ®å¯è§†åŒ–åº“ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼ŒåŸºæœ¬èƒ½æ»¡è¶³å¸¸è§éœ€æ±‚ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šè¾ƒå¥½ï¼Œå¯ä¸åç«¯æ•°æ®å¤„ç†ã€å‰ç«¯äº¤äº’ç­‰æŠ€æœ¯é›†æˆï¼Œæ‹“å±•æ•°æ®å¯è§†åŒ–çš„åº”ç”¨åœºæ™¯ã€‚</strong></p><hr><h2 id="è·¨ç«¯"><a href="#è·¨ç«¯" class="headerlink" title="è·¨ç«¯"></a>è·¨ç«¯</h2><p><strong>ç®€ä»‹ï¼šä¸€å¥—ä»£ç åœ¨ä¸åŒçš„å¹³å°ä¸Šè¿è¡Œï¼Œå¦‚Webã€Androidã€iOSã€å°ç¨‹åºç­‰ã€‚</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æŒæ¡è·¨ç«¯æ¡†æ¶ï¼Œå¦‚ReactNativeã€Flutterç­‰ï¼›</span><br><span class="line">äº†è§£ä¸åŒå¹³å°çš„åŸç”Ÿå¼€å‘æŠ€æœ¯ï¼Œå¦‚Androidçš„Java/Kotlinã€iOSçš„Swift/Objective-Cï¼›</span><br><span class="line">ç†Ÿæ‚‰å‰ç«¯çš„åŸºç¡€æŠ€æœ¯HTMLã€CSSã€JavaScriptï¼›</span><br><span class="line">æŒæ¡ç›¸å…³çš„æ‰“åŒ…å’Œå‘å¸ƒå·¥å…·ï¼Œå¦‚Cordovaã€Capacitorç­‰ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¸åŒå¹³å°çš„åŸç”Ÿå¼€å‘æŠ€æœ¯å·®å¼‚å¤§ï¼Œéœ€è¦å­¦ä¹ å’ŒæŒæ¡å¤šç§æŠ€æœ¯æ ˆï¼›</span><br><span class="line">è·¨ç«¯æ¡†æ¶çš„åŸç†å’Œä½¿ç”¨å¤æ‚ï¼Œå¦‚ReactNativeã€Flutterç­‰ï¼›</span><br><span class="line">é€‚é…ä¸åŒå¹³å°çš„UIå’Œäº¤äº’è§„èŒƒå›°éš¾ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæ¯”è¾ƒæˆç†Ÿï¼Œä¸»æµçš„è·¨ç«¯æ¡†æ¶å·²å¾—åˆ°å¹¿æ³›åº”ç”¨ï¼Œä½†åœ¨ä¸€äº›ç‰¹æ®Šéœ€æ±‚å’Œå¹³å°ä¸Šä»å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šå¼ºï¼Œå¯ä¸åç«¯å¼€å‘ã€äº‘æœåŠ¡ç­‰æŠ€æœ¯é›†æˆï¼Œæ‹“å±•è·¨ç«¯åº”ç”¨çš„åŠŸèƒ½å’Œåœºæ™¯ã€‚</strong></p><hr><h2 id="å·¥ç¨‹åŒ–"><a href="#å·¥ç¨‹åŒ–" class="headerlink" title="å·¥ç¨‹åŒ–"></a>å·¥ç¨‹åŒ–</h2><p><strong>ç®€ä»‹ï¼šä½¿ç”¨è½¯ä»¶å·¥ç¨‹çš„æ–¹æ³•å’Œå·¥å…·æ¥è§„èŒƒå’Œä¼˜åŒ–å‰ç«¯å¼€å‘æµç¨‹ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ„å»ºå·¥å…·ï¼Œå¦‚Webpackã€Viteç­‰ï¼›</span><br><span class="line">ä»£ç è§„èŒƒå’Œæ£€æŸ¥å·¥å…·ï¼Œå¦‚ESLintã€Prettierç­‰ï¼›</span><br><span class="line">äº†è§£æ¨¡å—åŒ–å’Œç»„ä»¶åŒ–å¼€å‘çš„æ–¹æ³•ï¼Œå¦‚ES6æ¨¡å—ã€Vueç»„ä»¶ã€Reactç»„ä»¶ç­‰ï¼›</span><br><span class="line">ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œå¦‚Git</span><br><span class="line">è‡ªåŠ¨åŒ–éƒ¨ç½²å’ŒæŒç»­é›†æˆå·¥å…·ï¼Œå¦‚Jenkinsã€GitLab CIç­‰ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ„å»ºå·¥å…·çš„é…ç½®å’Œä½¿ç”¨å¤æ‚ï¼Œå¦‚Webpackã€Viteç­‰</span><br><span class="line">ä»£ç è§„èŒƒå’Œæ£€æŸ¥å·¥å…·çš„å®šåˆ¶å’Œé›†æˆå›°éš¾</span><br><span class="line">ç†è§£å’ŒæŒæ¡æ¨¡å—åŒ–å’Œç»„ä»¶åŒ–å¼€å‘çš„åŸç†å’Œæ–¹æ³•éœ€è¦ä¸€å®šæ—¶é—´ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæ¯”è¾ƒæˆç†Ÿï¼Œç›¸å…³çš„æ„å»ºå·¥å…·ã€ä»£ç è§„èŒƒå’Œæ£€æŸ¥å·¥å…·ç­‰å·²å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šè¾ƒå¥½ï¼Œå¯ä¸å…¶ä»–æŠ€æœ¯é›†æˆï¼Œå¦‚æµ‹è¯•æ¡†æ¶ã€è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·ç­‰ï¼Œæ‹“å±•å·¥ç¨‹åŒ–çš„èŒƒå›´å’ŒåŠŸèƒ½ã€‚</strong></p><hr><h2 id="å³æ—¶é€šè®¯"><a href="#å³æ—¶é€šè®¯" class="headerlink" title="å³æ—¶é€šè®¯"></a>å³æ—¶é€šè®¯</h2><p><strong>ç®€ä»‹ï¼šå®ç°å®¢æˆ·ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„å®æ—¶é€šä¿¡ï¼Œå¦‚æ–‡å­—æ¶ˆæ¯ã€è¯­éŸ³æ¶ˆæ¯ã€è§†é¢‘é€šè¯ç­‰</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æŒæ¡WebSocketæˆ–WebRTCç­‰å®æ—¶é€šä¿¡æŠ€æœ¯ï¼›</span><br><span class="line">ç†Ÿæ‚‰ç›¸å…³çš„å³æ—¶é€šè®¯åè®®ï¼Œå¦‚XMPPã€MQTTç­‰ï¼›</span><br><span class="line">äº†è§£éŸ³è§†é¢‘å¤„ç†æŠ€æœ¯ï¼Œå¦‚éŸ³é¢‘é‡‡é›†ã€è§†é¢‘ç¼–ç ç­‰ï¼›</span><br><span class="line">æŒæ¡JavaScriptçš„äº‹ä»¶å¤„ç†å’Œå¼‚æ­¥ç¼–ç¨‹ï¼Œå®ç°å®æ—¶é€šä¿¡çš„äº¤äº’åŠŸèƒ½ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å®æ—¶é€šä¿¡åè®®å’ŒæŠ€æœ¯çš„ç†è§£å’Œå®ç°å¤æ‚ï¼Œå¦‚WebSocketã€WebRTCç­‰ï¼›</span><br><span class="line">éŸ³è§†é¢‘å¤„ç†æŠ€æœ¯éš¾åº¦å¤§ï¼ŒåŒ…æ‹¬éŸ³é¢‘é‡‡é›†ã€è§†é¢‘ç¼–ç ç­‰ï¼›</span><br><span class="line">å®‰å…¨å’Œéšç§ä¿æŠ¤è¦æ±‚é«˜ï¼Œå¦‚æ•°æ®åŠ å¯†ã€ç”¨æˆ·è®¤è¯ç­‰ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæ¯”è¾ƒæˆç†Ÿï¼Œå·²æœ‰è®¸å¤šæˆç†Ÿçš„å³æ—¶é€šè®¯è§£å†³æ–¹æ¡ˆå’Œåº“ï¼Œä½†åœ¨ä¸€äº›ç‰¹æ®Šéœ€æ±‚ä¸‹ä»éœ€å®šåˆ¶å¼€å‘ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šè¾ƒå¥½ï¼Œå¯ä¸å…¶ä»–æŠ€æœ¯é›†æˆï¼Œå¦‚äººå·¥æ™ºèƒ½èŠå¤©æœºå™¨äººã€å®¢æœç³»ç»Ÿç­‰ï¼Œæ‹“å±•åº”ç”¨åœºæ™¯ã€‚</strong></p><hr><h2 id="ååŒ"><a href="#ååŒ" class="headerlink" title="ååŒ"></a>ååŒ</h2><p><strong>ç®€ä»‹ï¼šå¤šäººå¯¹ä¸€ä¸ªé¡¹ç›®è¿›è¡Œç¼–è¯‘ï¼Œå¼€å‘ï¼Œè°ƒè¯•</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼šååŒå·¥å…·å¹³å°Gitï¼ŒSVNç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">äº†è§£å¸¸ç”¨çš„ååŒå·¥å…·å’Œå¹³å°ï¼Œå¦‚Gitã€SVNç­‰ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼›</span><br><span class="line">æŒæ¡ç›¸å…³çš„ä»£ç åˆå¹¶ã€å†²çªè§£å†³ç­‰æŠ€æœ¯ï¼›</span><br><span class="line">ç†Ÿæ‚‰å®æ—¶é€šä¿¡æŠ€æœ¯ï¼Œå¦‚WebSocketï¼Œç”¨äºå®ç°å¤šäººå®æ—¶åä½œçš„äº¤äº’åŠŸèƒ½ï¼›</span><br><span class="line">äº†è§£å›¢é˜Ÿåä½œå’Œé¡¹ç›®ç®¡ç†çš„æµç¨‹å’Œæ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å®æ—¶é€šä¿¡æŠ€æœ¯çš„å®ç°å’Œä¼˜åŒ–å¤æ‚ï¼Œå¦‚WebSocketçš„è¿æ¥ç®¡ç†ã€æ¶ˆæ¯æ¨é€ç­‰ï¼›</span><br><span class="line">å¤„ç†å¤šäººåŒæ—¶æ“ä½œçš„å¹¶å‘æ§åˆ¶å’Œæ•°æ®ä¸€è‡´æ€§å›°éš¾ï¼›</span><br><span class="line">ä¸åŒå¼€å‘äººå‘˜çš„ä»£ç åˆå¹¶å’Œå†²çªè§£å†³ç¹çã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæŠ€æœ¯åœ¨ä¸æ–­å‘å±•å’Œå®Œå–„ä¸­ï¼Œå·²æœ‰ä¸€äº›æˆç†Ÿçš„ååŒå·¥å…·å’Œå¹³å°ï¼Œä½†åœ¨ä¸€äº›å¤æ‚åœºæ™¯ä¸‹ä»å­˜åœ¨æŒ‘æˆ˜ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šå¼ºï¼Œå¯ä¸å„ç§å¼€å‘å·¥å…·å’ŒæŠ€æœ¯é›†æˆï¼Œæ‹“å±•ååŒçš„èŒƒå›´å’ŒåŠŸèƒ½ã€‚</strong></p><hr><h2 id="å¯Œæ–‡æœ¬"><a href="#å¯Œæ–‡æœ¬" class="headerlink" title="å¯Œæ–‡æœ¬"></a>å¯Œæ–‡æœ¬</h2><p><strong>ç®€ä»‹ï¼šæ”¯æŒç”¨æˆ·è¾“å…¥å’Œç¼–è¾‘ä¸°å¯Œæ ¼å¼æ–‡æœ¬çš„åŠŸèƒ½ï¼Œå¦‚åŠ ç²—ã€æ–œä½“ã€å›¾ç‰‡ã€è§†é¢‘ã€é“¾æ¥ç­‰ï¼Œåº”ç”¨äºåšå®¢ã€å†…å®¹ç®¡ç†ç³»ç»Ÿã€åœ¨çº¿æ–‡æ¡£ç­‰åœºæ™¯ã€‚</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¯ä½¿ç”¨æˆç†Ÿçš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åº“ï¼Œå¦‚TinyMCEã€CKEditorç­‰ï¼›</span><br><span class="line">æŒæ¡JavaScriptçš„äº‹ä»¶å¤„ç†å’ŒDOMæ“ä½œï¼Œå®ç°å¯¹å¯Œæ–‡æœ¬å†…å®¹çš„åŠ¨æ€ç¼–è¾‘å’Œäº¤äº’ï¼›</span><br><span class="line">ç†Ÿæ‚‰ç›¸å…³çš„å›¾ç‰‡ä¸Šä¼ ã€è§†é¢‘åµŒå…¥ç­‰æŠ€æœ¯ï¼Œä»¥åŠæ•°æ®å­˜å‚¨å’Œä¼ è¾“çš„æ–¹å¼ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„åŠŸèƒ½å¤æ‚ï¼Œéœ€è¦æ·±å…¥æŒæ¡å…¶APIå’Œé…ç½®é€‰é¡¹ï¼›</span><br><span class="line">å¤„ç†å¤§é‡æ–‡æœ¬å’Œå¤æ‚æ ¼å¼æ—¶çš„æ€§èƒ½ä¼˜åŒ–æŒ‘æˆ˜å¤§ï¼›</span><br><span class="line">å®ç°å¤šäººååŒç¼–è¾‘æ—¶çš„å†²çªå¤„ç†å’Œæ•°æ®åŒæ­¥å›°éš¾ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šè¾ƒé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæ¯”è¾ƒæˆç†Ÿï¼Œå·²æœ‰è®¸å¤šæˆç†Ÿçš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åº“ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼ŒåŸºæœ¬èƒ½æ»¡è¶³å¸¸è§éœ€æ±‚ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šè¾ƒå¥½ï¼Œå¯ä¸å…¶ä»–å‰ç«¯æŠ€æœ¯é›†æˆï¼Œå¦‚æ–‡ä»¶ä¸Šä¼ ã€å›¾ç‰‡å¤„ç†ã€æ•°æ®å­˜å‚¨ç­‰ï¼Œæ‹“å±•åº”ç”¨åœºæ™¯ã€‚</strong></p><hr><h2 id="3Dæ¸²æŸ“"><a href="#3Dæ¸²æŸ“" class="headerlink" title="3Dæ¸²æŸ“"></a>3Dæ¸²æŸ“</h2><p><strong>ç®€ä»‹ï¼šåœ¨æµè§ˆå™¨ä¸­åˆ›å»ºå’Œå±•ç¤º3Då›¾å½¢å’Œåœºæ™¯</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æŒæ¡WebGLæˆ–WebGPUçš„API</span><br><span class="line">äº†è§£3Då›¾å½¢çš„åŸºæœ¬æ¦‚å¿µï¼Œå¦‚é¡¶ç‚¹ã€çº¹ç†ã€æè´¨ç­‰ï¼›</span><br><span class="line">ç†Ÿæ‚‰ç›¸å…³çš„3Dæ¸²æŸ“å¼•æ“ï¼Œå¦‚Three.jsã€Babylon.jsç­‰ï¼›</span><br><span class="line">æŒæ¡JavaScriptçš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œä»¥æé«˜3Dæ¸²æŸ“çš„æ•ˆç‡ï¼›</span><br><span class="line">äº†è§£å›¾å½¢è®¾è®¡å’Œå»ºæ¨¡å·¥å…·ï¼Œå¦‚Blenderã€Mayaç­‰ï¼Œç”¨äºåˆ›å»º3Dæ¨¡å‹å’Œåœºæ™¯ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3Då›¾å½¢å­¦çŸ¥è¯†è¦æ±‚é«˜ï¼Œå¦‚é¡¶ç‚¹ã€çº¹ç†ã€æè´¨ç­‰æ¦‚å¿µå¤æ‚ï¼›</span><br><span class="line">WebGLæˆ–WebGPUçš„APIå­¦ä¹ æ›²çº¿é™¡å³­ï¼Œéœ€è¦æŒæ¡åº•å±‚å›¾å½¢æ¸²æŸ“åŸç†ï¼›</span><br><span class="line">æ€§èƒ½ä¼˜åŒ–éš¾åº¦å¤§ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤æ‚åœºæ™¯å’Œå¤§é‡æ•°æ®æ—¶ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šä¸­ç­‰åé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šå¤„äºå‘å±•é˜¶æ®µï¼Œç›¸å…³çš„3Dæ¸²æŸ“å¼•æ“å’Œå·¥å…·ä¸æ–­å®Œå–„ï¼Œä½†ä»æœ‰ä¸€å®šçš„æŠ€æœ¯é—¨æ§›ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šå¥½ï¼Œå¯ä¸åŠ¨ç”»ã€ç‰©ç†å¼•æ“ç­‰æŠ€æœ¯ç»“åˆï¼Œæ‹“å±•3Dåº”ç”¨çš„åŠŸèƒ½å’Œåœºæ™¯ã€‚</strong></p><hr><h2 id="éŸ³è§†é¢‘"><a href="#éŸ³è§†é¢‘" class="headerlink" title="éŸ³è§†é¢‘"></a>éŸ³è§†é¢‘</h2><p><strong>ç®€ä»‹ï¼šåœ¨å‰ç«¯å®ç°éŸ³è§†é¢‘çš„æ’­æ”¾ã€å½•åˆ¶ã€ç¼–è¾‘ã€ç›´æ’­ã€è§†é¢‘ä¼šè®®ç­‰åŠŸèƒ½</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æŒæ¡HTML5çš„ &lt;video&gt; å’Œ &lt;audio&gt; æ ‡ç­¾ï¼Œä»¥åŠç›¸å…³çš„APIï¼›</span><br><span class="line">äº†è§£éŸ³è§†é¢‘ç¼–è§£ç æŠ€æœ¯ï¼Œå¦‚H.264ã€AACç­‰ï¼›</span><br><span class="line">ç†Ÿæ‚‰éŸ³è§†é¢‘å¤„ç†åº“ï¼Œå¦‚FFmpegã€WebRTCç­‰ï¼›</span><br><span class="line">æŒæ¡JavaScriptçš„äº‹ä»¶å¤„ç†å’Œå¼‚æ­¥ç¼–ç¨‹ï¼Œå®ç°éŸ³è§†é¢‘çš„äº¤äº’åŠŸèƒ½ã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">éŸ³è§†é¢‘ç¼–è§£ç æŠ€æœ¯å¤æ‚ï¼Œéœ€è¦æŒæ¡ç›¸å…³çš„æ ‡å‡†å’Œç®—æ³•ï¼›</span><br><span class="line">æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜å¤šï¼Œä¸åŒæµè§ˆå™¨å¯¹éŸ³è§†é¢‘çš„æ”¯æŒå’Œè¡¨ç°ä¸åŒï¼›</span><br><span class="line">å®æ—¶éŸ³è§†é¢‘æµçš„ä¼ è¾“å’Œå¤„ç†éš¾åº¦å¤§ï¼Œå¦‚ç½‘ç»œå»¶è¿Ÿã€ä¸¢åŒ…ç­‰é—®é¢˜ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šä¸­ç­‰åé«˜ï¼Œåœ¨çº¿æ•™è‚²ã€è§†é¢‘ä¼šè®®ã€å¨±ä¹ç­‰é¢†åŸŸå¯¹éŸ³è§†é¢‘åŠŸèƒ½çš„éœ€æ±‚ä¸æ–­å¢é•¿ã€‚</strong></p><p><strong>æˆç†Ÿæ€§ï¼šæ¯”è¾ƒæˆç†Ÿï¼ŒHTML5çš„ <strong><video></strong> å’Œ <strong><audio></strong> æ ‡ç­¾å·²å¾—åˆ°å¹¿æ³›æ”¯æŒï¼Œç›¸å…³çš„éŸ³è§†é¢‘å¤„ç†åº“ä¹Ÿè¾ƒä¸ºå®Œå–„ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šè¾ƒå¥½</strong></p><hr><h2 id="ä½ä»£ç "><a href="#ä½ä»£ç " class="headerlink" title="ä½ä»£ç "></a>ä½ä»£ç </h2><p><strong>ç®€ä»‹ï¼šé€šè¿‡å¯è§†åŒ–ç•Œé¢å’Œå°‘é‡ä»£ç ç¼–å†™ï¼Œå¿«é€Ÿæ„å»ºåº”ç”¨ç¨‹åºçš„å¼€å‘æ–¹å¼ï¼Œæ—¨åœ¨æé«˜å¼€å‘æ•ˆç‡ã€é™ä½æŠ€æœ¯é—¨æ§›ï¼Œä½¿éä¸“ä¸šå¼€å‘äººå‘˜ä¹Ÿèƒ½å‚ä¸å¼€å‘ã€‚</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼šJeecg-bootï¼Œå®œæ­</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç²¾é€šHTMLã€CSSã€JavaScriptåŸºç¡€æŠ€æœ¯ï¼›</span><br><span class="line">ç†Ÿæ‚‰ä¸»æµçš„ä½ä»£ç å¹³å°ï¼Œå¦‚Jeecg-bootã€å®œæ­ç­‰ï¼›</span><br><span class="line">ç›¸å…³çš„å‰ç«¯æ¡†æ¶ï¼Œå¦‚Vueã€Reactç­‰</span><br><span class="line">åç«¯æŠ€æœ¯å¦‚Spring Bootã€Node.jsç­‰</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å®šåˆ¶æ€§å—é™ï¼Œå¯¹äºå¤æ‚ä¸šåŠ¡é€»è¾‘å’Œç‰¹æ®Šéœ€æ±‚éš¾ä»¥æ»¡è¶³ï¼›</span><br><span class="line">è‡ªåŠ¨ç”Ÿæˆä»£ç å¯èƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œå¦‚åŠ è½½é€Ÿåº¦æ…¢ã€å“åº”ä¸åŠæ—¶ç­‰ï¼›</span><br><span class="line">å¹³å°å…¼å®¹æ€§æœ‰å¾…æé«˜ï¼Œä¸åŒä½ä»£ç å¹³å°çš„ç»„ä»¶å’ŒåŠŸèƒ½å·®å¼‚å¤§ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šè¾ƒé«˜</strong></p><p><strong>æˆç†Ÿæ€§ï¼šå¤„äºå¿«é€Ÿå‘å±•é˜¶æ®µï¼ŒæŠ€æœ¯å’ŒåŠŸèƒ½ä¸æ–­å®Œå–„ï¼Œå·²æœ‰ä¸å°‘æˆç†Ÿçš„ä½ä»£ç å¹³å°ï¼Œä½†ä»å­˜åœ¨ä¸€äº›å±€é™æ€§ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šè¾ƒå¥½ï¼Œå¯ä¸å¤šç§æŠ€æœ¯é›†æˆï¼Œå¦‚åç«¯å¼€å‘æŠ€æœ¯ã€æ•°æ®åˆ†æå·¥å…·ç­‰ï¼Œæ‹“å±•åº”ç”¨åœºæ™¯ã€‚</strong></p><hr><h2 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h2><p><strong>ç®€ä»‹ï¼šé€šå¸¸ç”¨äºå¤„ç†å‰ç«¯é¡µé¢ä¸­çš„å¸ƒå±€å’Œæ’ç‰ˆï¼Œå®ç°å…ƒç´ çš„çµæ´»æ’åˆ—å’Œè‡ªé€‚åº”ï¼Œæé«˜é¡µé¢çš„å¸ƒå±€æ•ˆç‡å’Œå“åº”æ€§ã€‚</strong></p><p><strong>æŠ€æœ¯å¹³å°ï¼š</strong></p><p><strong>æŠ€æœ¯æ ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ ¸å¿ƒæ˜¯CSSçš„Flexå¸ƒå±€å’ŒGridå¸ƒå±€</span><br><span class="line">æŒæ¡Flexå¸ƒå±€çš„å±æ€§å¦‚flex-directionã€flex-wrapç­‰ï¼Œä»¥åŠGridå¸ƒå±€çš„ç›¸å…³å±æ€§å’Œæ¦‚å¿µã€‚</span><br><span class="line">äº†è§£JavaScriptçš„DOMæ“ä½œï¼Œä»¥ä¾¿åœ¨éœ€è¦åŠ¨æ€è°ƒæ•´å¸ƒå±€æ—¶è¿›è¡Œäº¤äº’æ“ä½œã€‚</span><br></pre></td></tr></table></figure><p><strong>éš¾ç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¯¹CSSå¸ƒå±€çŸ¥è¯†è¦æ±‚é«˜ï¼Œéœ€æ·±å…¥ç†è§£Flexå’ŒGridå¸ƒå±€çš„åŸç†å’Œå±æ€§ï¼›</span><br><span class="line">åœ¨ä¸åŒæµè§ˆå™¨å’Œè®¾å¤‡ä¸Šçš„å…¼å®¹æ€§å¤„ç†å¤æ‚ï¼›</span><br><span class="line">åŠ¨æ€å¸ƒå±€è°ƒæ•´æ—¶ï¼ŒJavaScriptä¸CSSçš„äº¤äº’é€»è¾‘è¾ƒéš¾æŠŠæ¡ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¸‚åœºéœ€æ±‚åº¦ï¼šä¸­</strong></p><p><strong>æˆç†Ÿæ€§ï¼šç›¸å¯¹æˆç†Ÿï¼ŒCSSçš„Flexå’ŒGridå¸ƒå±€å·²å¾—åˆ°å¹¿æ³›æ”¯æŒï¼Œç›¸å…³çš„å¸ƒå±€åº“å’Œæ¡†æ¶ä¹Ÿè¾ƒä¸ºå®Œå–„ã€‚</strong></p><p><strong>å¯å»¶å±•æ€§ï¼šä¸€èˆ¬ï¼Œä¸»è¦å›´ç»•é¡µé¢å¸ƒå±€å’Œæ’ç‰ˆè¿›è¡Œæ‰©å±•ï¼Œå¦‚ä¸åŠ¨ç”»æ•ˆæœã€äº¤äº’ç»„ä»¶ç­‰ç»“åˆã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2025/03/08/%E5%B7%A5%E5%85%B7/%E7%BD%91%E9%A1%B5%E8%A7%86%E9%A2%91%E6%8D%95%E8%8E%B7%E5%B7%A5%E5%85%B7/"/>
      <url>/2025/03/08/%E5%B7%A5%E5%85%B7/%E7%BD%91%E9%A1%B5%E8%A7%86%E9%A2%91%E6%8D%95%E8%8E%B7%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="ç½‘é¡µè§†é¢‘æ•è·å·¥å…·"><a href="#ç½‘é¡µè§†é¢‘æ•è·å·¥å…·" class="headerlink" title="ç½‘é¡µè§†é¢‘æ•è·å·¥å…·"></a>ç½‘é¡µè§†é¢‘æ•è·å·¥å…·</h1><h2 id="æœ¬åœ°è§£æå·¥å…·"><a href="#æœ¬åœ°è§£æå·¥å…·" class="headerlink" title="æœ¬åœ°è§£æå·¥å…·"></a>æœ¬åœ°è§£æå·¥å…·</h2><p><strong>åŸºäºWindowsç³»ç»Ÿ</strong></p><blockquote><p><a href="https://mkvtoolnix.download/downloads.html#windows">MKVToolNix Downloads â€“ Matroska tools for Linux&#x2F;Unix and Windows</a></p></blockquote><p><strong>ï¼ˆå½“ç„¶ç½‘ç«™é‡Œä¹Ÿæœ‰å…¶ä»–ç³»ç»Ÿçš„å·¥å…·ï¼Œåªæ˜¯æˆ‘æ²¡ç”¨ç”¨è¿‡ï¼‰</strong></p><p>**ä¸‹è½½åè§£å‹å‡ºæ¥ **<code>MKVToolNix</code> æ–‡ä»¶å¤¹</p><p>**å¯åŠ¨é¡¹æ˜¯ **<code>mkvtoolnix-gui.exe</code></p><p><img src="/upload/image-20250128160924228.png" alt="image-20250128160924228.png"></p><h2 id="æµè§ˆå™¨è„šæœ¬"><a href="#æµè§ˆå™¨è„šæœ¬" class="headerlink" title="æµè§ˆå™¨è„šæœ¬"></a>æµè§ˆå™¨è„šæœ¬</h2><p><code>media-source-extract</code> è£…åˆ°æ²¹çŒ´é‡Œï¼ˆæ–‡ä»¶æ”¾åœ¨æœ€åäº†ï¼‰</p><p><img src="/upload/image-20250128160910518.png" alt="image-20250128160910518.png"></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p><img src="/upload/image-20250128163554230.png" alt="image-20250128163554230.png"></p><h2 id="è„šæœ¬æ–‡ä»¶"><a href="#è„šæœ¬æ–‡ä»¶" class="headerlink" title="è„šæœ¬æ–‡ä»¶"></a><em>è„šæœ¬æ–‡ä»¶</em></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br></pre></td><td class="code"><pre><span class="line">// ==UserScript==</span><br><span class="line">// @name         media-source-extract</span><br><span class="line">// @namespace    https://github.com/Momo707577045/media-source-extract</span><br><span class="line">// @version      0.8.2</span><br><span class="line">// @description  https://github.com/Momo707577045/media-source-extract é…å¥—æ’ä»¶</span><br><span class="line">// @author       Momo707577045</span><br><span class="line">// @include      *</span><br><span class="line">// @exclude      http://blog.luckly-mjw.cn/tool-show/media-source-extract/player/player.html</span><br><span class="line">// @downloadURL https://blog.luckly-mjw.cn/tool-show/media-source-extract/media-source-extract.user.js</span><br><span class="line">// @updateURL   https://blog.luckly-mjw.cn/tool-show/media-source-extract/media-source-extract.user.js</span><br><span class="line">// @grant        none</span><br><span class="line">// @run-at document-start</span><br><span class="line">// ==/UserScript==</span><br><span class="line"></span><br><span class="line">(function () &#123;</span><br><span class="line">  &#x27;use strict&#x27;;</span><br><span class="line">  (function () &#123;</span><br><span class="line">    if (document.getElementById(&#x27;media-source-extract&#x27;)) &#123;</span><br><span class="line">      return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å¤å†™ call å‡½æ•°ï¼Œç»•è¿‡åŠ«æŒæ£€æŸ¥</span><br><span class="line">    Function.prototype.toString.call = function (caller) &#123;</span><br><span class="line">      return `&#x27;function $&#123;caller.name&#125;() &#123; [native code] &#125;&#x27;`</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è½®è¯¢ç›‘å¬ iframe çš„åŠ è½½</span><br><span class="line">    setInterval(() =&gt; &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        Array.prototype.forEach.call(document.getElementsByTagName(&#x27;iframe&#x27;), (iframe) =&gt; &#123;</span><br><span class="line">          // è‹¥ iframe ä½¿ç”¨äº† sandbox è¿›è¡Œæ“ä½œçº¦æŸï¼Œåˆ é™¤åŸæœ‰ iframeï¼Œæ‹·è´å…¶å¤‡ä»½ï¼Œåˆ é™¤ sandbox å±æ€§ï¼Œé‡æ–°è½½å…¥</span><br><span class="line">          // è‹¥ iframe å·²è½½å…¥ï¼Œå†ä¿®æ”¹ sandbox å±æ€§ï¼Œå°†ä¿®æ”¹æ— æ•ˆã€‚æ•…é€šè¿‡æ–°å»º iframe çš„æ–¹å¼ç»•è¿‡</span><br><span class="line">          if (iframe.hasAttribute(&#x27;sandbox&#x27;)) &#123;</span><br><span class="line">            const parentNode = iframe.parentNode;</span><br><span class="line">            const tempIframe = iframe.cloneNode()</span><br><span class="line">            tempIframe.removeAttribute(&quot;sandbox&quot;);</span><br><span class="line">            iframe.remove()</span><br><span class="line">            parentNode.appendChild(tempIframe);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, 1000)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    let sumFragment = 0 // å·²ç»æ•è·çš„æ‰€æœ‰ç‰‡æ®µæ•°</span><br><span class="line">    let isClose = false // æ˜¯å¦å…³é—­</span><br><span class="line">    let isStreamDownload = false // æ˜¯å¦ä½¿ç”¨æµå¼ä¸‹è½½</span><br><span class="line">    let _sourceBufferList = [] // åª’ä½“è½¨é“</span><br><span class="line">    const $showBtn = document.createElement(&#x27;div&#x27;) // å±•ç¤ºæŒ‰é’®</span><br><span class="line">    const $btnDownload = document.createElement(&#x27;div&#x27;) // ä¸‹è½½æŒ‰é’®</span><br><span class="line">    const $btnStreamDownload = document.createElement(&#x27;div&#x27;) // æµå¼ä¸‹è½½æŒ‰é’®</span><br><span class="line">    const $downloadNum = document.createElement(&#x27;div&#x27;) // å·²æ•è·è§†é¢‘ç‰‡æ®µæ•°</span><br><span class="line">    const $tenRate = document.createElement(&#x27;div&#x27;) // åå€é€Ÿæ’­æ”¾</span><br><span class="line">    const $closeBtn = document.createElement(&#x27;div&#x27;) // å…³é—­</span><br><span class="line">    const $container = document.createElement(&#x27;div&#x27;) // å®¹å™¨</span><br><span class="line">    $closeBtn.innerHTML = `</span><br><span class="line">    &lt;img style=&quot;</span><br><span class="line">      padding-top: 4px;</span><br><span class="line">      width: 24px;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">    &quot; src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAk1BMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ROyVeAAAAMHRSTlMA1Sq7gPribxkJx6Ey8onMsq+GTe10QF8kqJl5WEcvIBDc0sHAkkk1FgO2ZZ+dj1FHfPqwAAACNElEQVRIx6VW6ZqqMAwtFlEW2Rm3EXEfdZa+/9PdBEvbIVXu9835oW1yjiQlTWQE/iYPuTObOTzMNz4bQFRlY2FgnFXRC/o01mytiafP+BPvQZk56bcLSOXem1jpCy4QgXvRtlEVCARfUP65RM/hp29/+0R7eSbhoHlnffZ8h76e6x1tyw9mxXaJ3nfTVLd89hQr9NfGceJxfLIXmONh6eNNYftNSESRmgkHlEOjmhgBbYcEW08FFQN/ro6dvAczjhgXEdQP76xHEYxM+igQq259gLrCSlwbD3iDtTMy+A4Yuk0B6zV8c+BcO2OgFIp/UvJdG4o/Rp1JQYXeZFflPEFMfvugiFGFXN587YtgX7C8lRGFXPCGGYCCzlkoxJ4xqmi/jrIcdYYh5pwxiwI/gt7lDDFrcLiMKhBJ//W78ENsJgVUsV8wKpjZBXshM6cCW0jbRAilICFxIpgGMmmiWGHSIR6ViY+DPFaqSJCbQ5mbxoZLIlU0Al/cBj6N1uXfFI0okLppi69StmumSFQRP6oIKDedFi3vRDn3j6KozCZlu0DdJb3AupJXNLmqkk9+X9FEHLt1Jq8oi1H5n01AtRlvwQZQl9hmtPY4JEjMDs5ftWJN4Xr4lLrV2OHiUDHCPgvA/Tn/hP4zGUBfjZ3eLJ+NIOfHxi8CMoAQtYfmw93v01O0e7VlqqcCsXML3Vsu94cxnb4c7ML5chG8JIP9b38dENGaj3+x+TpiA/AL/fen8In7H8l3ZjdJQt2TAAAAAElFTkSuQmCC&quot;&gt;`</span><br><span class="line">    $showBtn.innerHTML = `</span><br><span class="line">    &lt;img style=&quot;</span><br><span class="line">      padding-top: 4px;</span><br><span class="line">      width: 24px;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">    &quot; src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADIBAMAAABfdrOtAAAAElBMVEUAAAD///////////////////8+Uq06AAAABXRSTlMA2kCAv5tF5NoAAAErSURBVHja7dzNasJAFIbhz8Tu7R0Eq/vQNHuxzL6YnPu/ldYpAUckxJ8zSnjfdTIPzHrOUawJdqmDJre1S/X7avigbM08kMgMSmt+iPWKbcwTsb3+KswXseOFLb2RnaTgjXTxtpwRq7XMgWz9kZ8cSKcwE6SX+SMGAgICAvJCyHdz2ud0pEx+/BpFaj2kEgQEBAQEBAQEBOT1kXWSkhbvk1vptOLs1LEWNrmVRgIBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBeTayTqpufogxduqM3q2AgICAgICAgICA3IOko4ZXkB/pqOHzhyZBQEBAQLIieVahtDNBDnrLgZT+yC4HUkmtN9JnWUiVZbVWliVhseCJdPqvCH5IV2tQNl4r6Bod+wWq9eeDik+xFQAAAABJRU5ErkJggg==&quot;&gt;`</span><br><span class="line"></span><br><span class="line">    // åå€é€Ÿæ’­æ”¾</span><br><span class="line">    function _tenRatePlay() &#123;</span><br><span class="line">      let playbackRate = 10</span><br><span class="line">      if ($tenRate.innerHTML === &#x27;åå€é€Ÿæ•è·&#x27;) &#123;</span><br><span class="line">        $tenRate.innerHTML = &#x27;æ¢å¤æ­£å¸¸æ’­æ”¾&#x27;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        playbackRate = 1</span><br><span class="line">        $tenRate.innerHTML = &#x27;åå€é€Ÿæ•è·&#x27;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      let $domList = document.getElementsByTagName(&#x27;video&#x27;)</span><br><span class="line">      for (let i = 0, length = $domList.length; i &lt; length; i++) &#123;</span><br><span class="line">        const $dom = $domList[i]</span><br><span class="line">        $dom.playbackRate = playbackRate</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è·å–é¡¶éƒ¨ window titleï¼Œå› å¯èƒ½å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œæ•…ä½¿ç”¨ try catch è¿›è¡Œä¿æŠ¤</span><br><span class="line">    function getDocumentTitle() &#123;</span><br><span class="line">      let title = document.title;</span><br><span class="line">      try &#123;</span><br><span class="line">        title = window.top.document.title</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.log(error)</span><br><span class="line">      &#125;</span><br><span class="line">      return title</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æµå¼ä¸‹è½½</span><br><span class="line">    function _streamDownload() &#123;</span><br><span class="line">      var _hmt = _hmt || [];</span><br><span class="line">      (function () &#123;</span><br><span class="line">        var hm = document.createElement(&quot;script&quot;);</span><br><span class="line">        hm.src = &quot;https://hm.baidu.com/hm.js?1f12b0865d866ae1b93514870d93ce89&quot;;</span><br><span class="line">        var s = document.getElementsByTagName(&quot;script&quot;)[0];</span><br><span class="line">        s.parentNode.insertBefore(hm, s);</span><br><span class="line">      &#125;)();</span><br><span class="line"></span><br><span class="line">      // å¯¹åº”çŠ¶æ€æœªä¸‹è½½ç»“æŸçš„åª’ä½“è½¨é“</span><br><span class="line">      const remainSourceBufferList = []</span><br><span class="line">      _sourceBufferList.forEach((target) =&gt; &#123;</span><br><span class="line">        // å¯¹åº”çš„ MSE çŠ¶æ€ä¸ºå·²ä¸‹è½½å®ŒæˆçŠ¶æ€</span><br><span class="line">        if (target.MSEInstance.readyState === &#x27;ended&#x27;) &#123;</span><br><span class="line">          target.streamWriter.close()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          remainSourceBufferList.push(target)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      // æµå¼ä¸‹è½½ï¼Œé‡Šæ”¾å·²ä¸‹è½½å®Œæˆçš„åª’ä½“è½¨é“ï¼Œå›æ”¶å†…å­˜</span><br><span class="line">      _sourceBufferList = remainSourceBufferList</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ™®é€šä¸‹è½½</span><br><span class="line">    function _download() &#123;</span><br><span class="line">      var _hmt = _hmt || [];</span><br><span class="line">      (function () &#123;</span><br><span class="line">        var hm = document.createElement(&quot;script&quot;);</span><br><span class="line">        hm.src = &quot;https://hm.baidu.com/hm.js?1f12b0865d866ae1b93514870d93ce89&quot;;</span><br><span class="line">        var s = document.getElementsByTagName(&quot;script&quot;)[0];</span><br><span class="line">        s.parentNode.insertBefore(hm, s);</span><br><span class="line">      &#125;)();</span><br><span class="line"></span><br><span class="line">      _sourceBufferList.forEach((target) =&gt; &#123;</span><br><span class="line">        const mime = target.mime.split(&#x27;;&#x27;)[0]</span><br><span class="line">        const type = mime.split(&#x27;/&#x27;)[1]</span><br><span class="line">        const fileBlob = new Blob(target.bufferList, &#123; type: mime &#125;) // åˆ›å»ºä¸€ä¸ªBlobå¯¹è±¡ï¼Œå¹¶è®¾ç½®æ–‡ä»¶çš„ MIME ç±»å‹</span><br><span class="line">        const a = document.createElement(&#x27;a&#x27;)</span><br><span class="line">        a.download = `$&#123;getDocumentTitle()&#125;.$&#123;type&#125;`</span><br><span class="line">        a.href = URL.createObjectURL(fileBlob)</span><br><span class="line">        a.style.display = &#x27;none&#x27;</span><br><span class="line">        document.body.appendChild(a)</span><br><span class="line">        // ç¦æ­¢ click äº‹ä»¶å†’æ³¡ï¼Œé¿å…å…¨å±€æ‹¦æˆª</span><br><span class="line">        a.onclick = function (e) &#123;</span><br><span class="line">          e.stopPropagation();</span><br><span class="line">        &#125;</span><br><span class="line">        a.click()</span><br><span class="line">        a.remove()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ç›‘å¬èµ„æºå…¨éƒ¨å½•å–æˆåŠŸ</span><br><span class="line">    let _endOfStream = window.MediaSource.prototype.endOfStream</span><br><span class="line">    window.MediaSource.prototype.endOfStream = function endOfStream() &#123;</span><br><span class="line">      if (isStreamDownload) &#123;</span><br><span class="line">        alert(&#x27;èµ„æºå…¨éƒ¨æ•è·æˆåŠŸï¼Œå³å°†ä¸‹è½½ï¼&#x27;)</span><br><span class="line">        setTimeout(_streamDownload) // ç­‰å¾… MediaSource çŠ¶æ€å˜æ›´</span><br><span class="line">        _endOfStream.call(this)</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (confirm(&#x27;èµ„æºå…¨éƒ¨æ•è·æˆåŠŸï¼Œå³å°†ä¸‹è½½ï¼&#x27;) == true) &#123;</span><br><span class="line">        _download()</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // ä¸ä¸‹è½½èµ„æº</span><br><span class="line">      &#125;</span><br><span class="line">      _endOfStream.call(this)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å½•å–èµ„æº</span><br><span class="line">    let _addSourceBuffer = window.MediaSource.prototype.addSourceBuffer</span><br><span class="line">    window.MediaSource.prototype.addSourceBuffer = function addSourceBuffer(mime) &#123;</span><br><span class="line">      _appendDom()</span><br><span class="line">      let sourceBuffer = _addSourceBuffer.call(this, mime)</span><br><span class="line">      let _append = sourceBuffer.appendBuffer</span><br><span class="line">      let bufferList = []</span><br><span class="line">      const _sourceBuffer = &#123;</span><br><span class="line">        mime,</span><br><span class="line">        bufferList,</span><br><span class="line">        MSEInstance: this,</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // å¦‚æœ streamSaver å·²æå‰åŠ è½½å®Œæˆï¼Œåˆ™åˆå§‹åŒ–å¯¹åº”çš„ streamWriter</span><br><span class="line">      try &#123;</span><br><span class="line">        if (window.streamSaver) &#123;</span><br><span class="line">          const type = mime.split(&#x27;;&#x27;)[0].split(&#x27;/&#x27;)[1]</span><br><span class="line">          _sourceBuffer.streamWriter = streamSaver.createWriteStream(`$&#123;getDocumentTitle()&#125;.$&#123;type&#125;`).getWriter()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.error(error)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      _sourceBufferList.push(_sourceBuffer)</span><br><span class="line">      sourceBuffer.appendBuffer = function (buffer) &#123;</span><br><span class="line">        sumFragment++</span><br><span class="line">        $downloadNum.innerHTML = `å·²æ•è· $&#123;sumFragment&#125; ä¸ªç‰‡æ®µ`</span><br><span class="line"></span><br><span class="line">        if (isStreamDownload &amp;&amp; _sourceBuffer.streamWriter) &#123; // æµå¼ä¸‹è½½</span><br><span class="line">          _sourceBuffer.streamWriter.write(new Uint8Array(buffer));</span><br><span class="line">        &#125; else &#123; // æ™®é€š blob ä¸‹è½½</span><br><span class="line">          bufferList.push(buffer)</span><br><span class="line">        &#125;</span><br><span class="line">        _append.call(this, buffer)</span><br><span class="line">      &#125;</span><br><span class="line">      return sourceBuffer</span><br><span class="line">    &#125;</span><br><span class="line">    window.MediaSource.prototype.addSourceBuffer.toString = function toString() &#123;</span><br><span class="line">      return &#x27;function addSourceBuffer() &#123; [native code] &#125;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ·»åŠ æ“ä½œçš„ dom</span><br><span class="line">    function _appendDom() &#123;</span><br><span class="line">      if (document.getElementById(&#x27;media-source-extract&#x27;)) &#123;</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">      $container.style = `</span><br><span class="line">      position: fixed;</span><br><span class="line">      top: 50px;</span><br><span class="line">      right: 50px;</span><br><span class="line">      text-align: right;</span><br><span class="line">      z-index: 9999;</span><br><span class="line">      `</span><br><span class="line">      const baseStyle = `</span><br><span class="line">      float:right;</span><br><span class="line">      clear:both;</span><br><span class="line">      margin-top: 10px;</span><br><span class="line">      padding: 0 20px;</span><br><span class="line">      color: white;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">      font-size: 16px;</span><br><span class="line">      font-weight: bold;</span><br><span class="line">      line-height: 40px;</span><br><span class="line">      text-align: center;</span><br><span class="line">      border-radius: 4px;</span><br><span class="line">      background-color: #3498db;</span><br><span class="line">      box-shadow: 0 3px 6px 0 rgba(0, 0, 0, 0.3);</span><br><span class="line">    `</span><br><span class="line">      $tenRate.innerHTML = &#x27;åå€é€Ÿæ•è·&#x27;</span><br><span class="line">      $downloadNum.innerHTML = &#x27;å·²æ•è· 0 ä¸ªç‰‡æ®µ&#x27;</span><br><span class="line">      $btnStreamDownload.innerHTML = &#x27;ç‰¹å¤§è§†é¢‘ä¸‹è½½ï¼Œè¾¹ä¸‹è½½è¾¹ä¿å­˜&#x27;</span><br><span class="line">      $btnDownload.innerHTML = &#x27;ä¸‹è½½å·²æ•è·ç‰‡æ®µ&#x27;</span><br><span class="line">      $btnDownload.id = &#x27;media-source-extract&#x27;</span><br><span class="line">      $tenRate.style = baseStyle</span><br><span class="line">      $downloadNum.style = baseStyle</span><br><span class="line">      $btnDownload.style = baseStyle</span><br><span class="line">      $btnStreamDownload.style = baseStyle</span><br><span class="line">      $btnStreamDownload.style.display = &#x27;none&#x27;</span><br><span class="line">      $showBtn.style = `</span><br><span class="line">      float:right;</span><br><span class="line">      clear:both;</span><br><span class="line">      display: none;</span><br><span class="line">      margin-top: 4px;</span><br><span class="line">      height: 34px;</span><br><span class="line">      width: 34px;</span><br><span class="line">      line-height: 34px;</span><br><span class="line">      text-align: center;</span><br><span class="line">      border-radius: 4px;</span><br><span class="line">      background-color: rgba(0, 0, 0, 0.5);</span><br><span class="line">      `</span><br><span class="line">      $closeBtn.style = `</span><br><span class="line">      float:right;</span><br><span class="line">      clear:both;</span><br><span class="line">      margin-top: 10px;</span><br><span class="line">      height: 34px;</span><br><span class="line">      width: 34px;</span><br><span class="line">      line-height: 34px;</span><br><span class="line">      text-align: center;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      border-radius: 50%;</span><br><span class="line">      background-color: rgba(0, 0, 0, 0.5);</span><br><span class="line">      `</span><br><span class="line"></span><br><span class="line">      $btnDownload.addEventListener(&#x27;click&#x27;, _download)</span><br><span class="line">      $tenRate.addEventListener(&#x27;click&#x27;, _tenRatePlay)</span><br><span class="line"></span><br><span class="line">      // å…³é—­æ§åˆ¶é¢æ¿</span><br><span class="line">      $closeBtn.addEventListener(&#x27;click&#x27;, function () &#123;</span><br><span class="line">        $downloadNum.style.display = &#x27;none&#x27;</span><br><span class="line">        $btnStreamDownload.style.display = &#x27;none&#x27;</span><br><span class="line">        $btnDownload.style.display = &#x27;none&#x27;</span><br><span class="line">        $closeBtn.style.display = &#x27;none&#x27;</span><br><span class="line">        $tenRate.style.display = &#x27;none&#x27;</span><br><span class="line">        $showBtn.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        isClose = true</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      // æ˜¾ç¤ºæ§åˆ¶é¢æ¿</span><br><span class="line">      $showBtn.addEventListener(&#x27;click&#x27;, function () &#123;</span><br><span class="line">        if (!isStreamDownload) &#123;</span><br><span class="line">          $btnDownload.style.display = &#x27;inline-block&#x27;</span><br><span class="line">          $btnStreamDownload.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">        $downloadNum.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        $closeBtn.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        $tenRate.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        $showBtn.style.display = &#x27;none&#x27;</span><br><span class="line">        isClose = false</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      // å¯åŠ¨æµå¼ä¸‹è½½</span><br><span class="line">      $btnStreamDownload.addEventListener(&#x27;click&#x27;, function () &#123;</span><br><span class="line">        (function () &#123;</span><br><span class="line">          var hm = document.createElement(&quot;script&quot;);</span><br><span class="line">          hm.src = &quot;https://hm.baidu.com/hm.js?1f12b0865d866ae1b93514870d93ce89&quot;;</span><br><span class="line">          var s = document.getElementsByTagName(&quot;script&quot;)[0];</span><br><span class="line">          s.parentNode.insertBefore(hm, s);</span><br><span class="line">        &#125;)();</span><br><span class="line">        isStreamDownload = true</span><br><span class="line">        $btnDownload.style.display = &#x27;none&#x27;</span><br><span class="line">        $btnStreamDownload.style.display = &#x27;none&#x27;</span><br><span class="line">        _sourceBufferList.forEach(sourceBuffer =&gt; &#123;</span><br><span class="line">          if (!sourceBuffer.streamWriter) &#123;</span><br><span class="line">            const type = sourceBuffer.mime.split(&#x27;;&#x27;)[0].split(&#x27;/&#x27;)[1]</span><br><span class="line">            sourceBuffer.streamWriter = streamSaver.createWriteStream(`$&#123;getDocumentTitle()&#125;.$&#123;type&#125;`).getWriter()</span><br><span class="line">            sourceBuffer.bufferList.forEach(buffer =&gt; &#123;</span><br><span class="line">              sourceBuffer.streamWriter.write(new Uint8Array(buffer));</span><br><span class="line">            &#125;)</span><br><span class="line">            sourceBuffer.bufferList = []</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      document.getElementsByTagName(&#x27;html&#x27;)[0].insertBefore($container, document.getElementsByTagName(&#x27;head&#x27;)[0]);</span><br><span class="line">      $container.appendChild($btnStreamDownload)</span><br><span class="line">      $container.appendChild($downloadNum)</span><br><span class="line">      $container.appendChild($btnDownload)</span><br><span class="line">      $container.appendChild($tenRate)</span><br><span class="line">      $container.appendChild($closeBtn)</span><br><span class="line">      $container.appendChild($showBtn)</span><br><span class="line"></span><br><span class="line">      // åŠ è½½ stream æµå¼ä¸‹è½½å™¨</span><br><span class="line">      try &#123;</span><br><span class="line">        let $streamSaver = document.createElement(&#x27;script&#x27;)</span><br><span class="line">        $streamSaver.src = &#x27;https://upyun.luckly-mjw.cn/lib/stream-saver.js&#x27;</span><br><span class="line">        document.body.appendChild($streamSaver);</span><br><span class="line">        $streamSaver.addEventListener(&#x27;load&#x27;, () =&gt; &#123;</span><br><span class="line">          $btnStreamDownload.style.display = &#x27;inline-block&#x27;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.error(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)()</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>GitHubæ”¹å</title>
      <link href="/2025/03/08/Github/%E6%9B%B4%E6%94%B9%20GitHub%20%E7%94%A8%E6%88%B7%E5%90%8D%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/"/>
      <url>/2025/03/08/Github/%E6%9B%B4%E6%94%B9%20GitHub%20%E7%94%A8%E6%88%B7%E5%90%8D%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="æ›´æ”¹-GitHub-ç”¨æˆ·åæ³¨æ„äº‹é¡¹"><a href="#æ›´æ”¹-GitHub-ç”¨æˆ·åæ³¨æ„äº‹é¡¹" class="headerlink" title="æ›´æ”¹ GitHub ç”¨æˆ·åæ³¨æ„äº‹é¡¹"></a><strong>æ›´æ”¹ GitHub ç”¨æˆ·åæ³¨æ„äº‹é¡¹</strong></h1><h2 id="æ›´æ”¹å‰é¡»çŸ¥"><a href="#æ›´æ”¹å‰é¡»çŸ¥" class="headerlink" title="æ›´æ”¹å‰é¡»çŸ¥"></a>æ›´æ”¹å‰é¡»çŸ¥</h2><p><strong>é¦–å…ˆï¼Œæ›´æ”¹ç”¨æˆ·åä¸ä¼šåˆ é™¤ä»“åº“æˆ–æäº¤å†å²ã€‚</strong></p><p>**æ—§ç”¨æˆ·åä¸‹çš„ä»“åº“ URLï¼ˆå¦‚ ****<code>https://github.com/æ—§ç”¨æˆ·å/repo</code>ï¼‰ä¼š **è‡ªåŠ¨é‡å®šå‘åˆ°æ–°åœ°å€</p><p><em><strong>ä½†</strong>ï¼š</em> &#x2F;&#x2F;&#x2F;<strong>é‡å®šå‘ä»…ä¿ç•™å‡ ä¸ªæœˆï¼Œä¹‹åå¯èƒ½å¤±æ•ˆï¼Œå»ºè®®å°½å¿«æ›´æ–°æ‰€æœ‰å¼•ç”¨</strong>&#x2F;&#x2F;&#x2F;</p><p>****&#x2F;&#x2F;&#x2F;<strong>å¦‚æœæ—§ç”¨æˆ·åè¢«ä»–äººæ³¨å†Œï¼Œé‡å®šå‘ä¼šå¤±æ•ˆ</strong>&#x2F;&#x2F;&#x2F;</p><p>****&#x2F;&#x2F;&#x2F;<strong>ä¾èµ–æ—§ URL çš„æœåŠ¡ï¼ˆå¦‚ CI&#x2F;CDã€ä¹¦ç­¾ï¼‰éœ€æ‰‹åŠ¨æ›´æ–°</strong>&#x2F;&#x2F;&#x2F;</p><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li><strong>ç¡®ä¿æœ¬åœ°ä»“åº“å·²ä¸è¿œç¨‹åŒæ­¥ï¼ˆ</strong><code>git push</code>ï¼‰ã€‚</li><li><strong>å¯¼å‡ºä»“åº“åˆ—è¡¨ï¼ˆå¯é€‰ï¼Œç”¨äºåç»­æ£€æŸ¥ï¼‰ã€‚</strong></li></ul><p><strong>æ£€æŸ¥ä¾èµ–é¡¹</strong>ï¼š</p><ul><li><strong>ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆå¦‚ CI&#x2F;CDã€åŸŸåç»‘å®šã€OAuth ç™»å½•ï¼‰æ˜¯å¦ä¾èµ–ä½ çš„æ—§ç”¨æˆ·åã€‚</strong></li><li><strong>æ–‡æ¡£ã€READMEã€å¤–éƒ¨é“¾æ¥ä¸­æ˜¯å¦æœ‰ç›´æ¥å¼•ç”¨æ—§ç”¨æˆ·åçš„ URLã€‚</strong></li></ul><h2 id="æ›´æ”¹ç”¨æˆ·å"><a href="#æ›´æ”¹ç”¨æˆ·å" class="headerlink" title="æ›´æ”¹ç”¨æˆ·å"></a><strong>æ›´æ”¹ç”¨æˆ·å</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GitHubï¼ŒSettings â†’ Account â†’ Change username</span><br></pre></td></tr></table></figure><h2 id="æ›´æ”¹å"><a href="#æ›´æ”¹å" class="headerlink" title="æ›´æ”¹å"></a>æ›´æ”¹å</h2><p><strong>æ‰€æœ‰æœ¬åœ°ä»“åº“çš„è¿œç¨‹ URL éœ€æ‰‹åŠ¨æ›´æ–°ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹å½“å‰è¿œç¨‹ URLï¼ˆæ ¼å¼ä¸ºæ—§ç”¨æˆ·åï¼‰</span><br><span class="line">git remote -v</span><br><span class="line"></span><br><span class="line"># æ›´æ–°è¿œç¨‹ URLï¼ˆæ›¿æ¢ä¸ºæ–°ç”¨æˆ·åï¼‰</span><br><span class="line">git remote set-url origin https://github.com/æ–°ç”¨æˆ·å/ä»“åº“å.git</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¸»é¡µprofileç¾åŒ–</title>
      <link href="/2025/03/08/Github/%E4%BF%9D%E5%A7%86%E7%BA%A7GitHub%E4%B8%BB%E9%A1%B5%E7%BE%8E%E5%8C%96%E6%95%99%E7%A8%8B/"/>
      <url>/2025/03/08/Github/%E4%BF%9D%E5%A7%86%E7%BA%A7GitHub%E4%B8%BB%E9%A1%B5%E7%BE%8E%E5%8C%96%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¿å§†çº§GitHubä¸»é¡µç¾åŒ–æ•™ç¨‹"><a href="#ä¿å§†çº§GitHubä¸»é¡µç¾åŒ–æ•™ç¨‹" class="headerlink" title="ä¿å§†çº§GitHubä¸»é¡µç¾åŒ–æ•™ç¨‹"></a>ä¿å§†çº§GitHubä¸»é¡µç¾åŒ–æ•™ç¨‹</h1><p><img src="/upload/image-omub.png" alt="image-omub.png"></p><p><strong>å®é™…ä¸Šè¿™äº›éƒ½å­˜åœ¨ä¸€ä¸ªREADMEæ–‡ä»¶é‡Œ</strong></p><p><strong>ä¸‹é¢æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥å»ºè®¾ä½ çš„GitHubä¸»é¡µ</strong></p><h3 id="GitHubä¸­çš„åˆå§‹æ“ä½œ"><a href="#GitHubä¸­çš„åˆå§‹æ“ä½œ" class="headerlink" title="GitHubä¸­çš„åˆå§‹æ“ä½œ"></a>GitHubä¸­çš„åˆå§‹æ“ä½œ</h3><p><img src="/upload/image-20241109134411796.png" alt="image-20241109134411796.png"></p><p><img src="/upload/image-20250203234004362.png" alt="image-20250203234004362.png"></p><p>å¤åˆ¶ä»“åº“åœ°å€</p><p><img src="/upload/image-isgp.png" alt="image-isgp.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ‰¾ä¸€ä¸ªä½ æƒ³è¦å­˜å‚¨åœ¨æœ¬åœ°çš„æ–‡ä»¶åœ°å€</span><br><span class="line">å³é”®Open Git Bash here</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241109140014319.png" alt="image-20241109140014319.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone +PasteæŠŠåˆšæ‰å¤åˆ¶çš„åœ°å€ç²˜è´´è¿‡æ¥    å›è½¦</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241109140335008.png" alt="image-20241109140335008.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tip:å¦‚æœæœ‰æŠ¥é”™å¾ˆå¤šæƒ…å†µæ˜¯æ¢¯å­ä¸ç¨³å®šï¼Œæ²¡æœ‰è¿æ¥åˆ°gitä»“åº“ï¼Œå¤šå…³é—­åˆ·æ–°åå¤è¯•è¯•</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241109140636576.png" alt="image-20241109140636576.png"></p><h2 id="ç¼–è¯‘å™¨"><a href="#ç¼–è¯‘å™¨" class="headerlink" title="ç¼–è¯‘å™¨"></a>ç¼–è¯‘å™¨</h2><p><strong>è¿™é‡Œæ‹¿VS Codeç¤ºèŒƒ</strong></p><h3 id="éœ€è¦å®‰è£…çš„æ’ä»¶"><a href="#éœ€è¦å®‰è£…çš„æ’ä»¶" class="headerlink" title="éœ€è¦å®‰è£…çš„æ’ä»¶"></a>éœ€è¦å®‰è£…çš„æ’ä»¶</h3><p><img src="/upload/image-20241109133836426.png" alt="image-20241109133836426.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹è½½å®Œæ’ä»¶ä¹‹å</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241109134227028.png" alt="image-20241109134227028.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ‰€ç¼–å†™çš„ç»„ä»¶æ˜¯æŒ‰é¡ºåºæ’åˆ—çš„</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241109135735804.png" alt="image-20241109135735804.png"></p><h4 id="ä»£ç ç»“æ„è¯¦è§£"><a href="#ä»£ç ç»“æ„è¯¦è§£" class="headerlink" title="ä»£ç ç»“æ„è¯¦è§£"></a>ä»£ç ç»“æ„è¯¦è§£</h4><p><img src="/upload/image-20241109141238195.png" alt="image-20241109141238195.png"></p><h4 id="ä¸€èˆ¬æ ¼å¼æ¨¡æ¿"><a href="#ä¸€èˆ¬æ ¼å¼æ¨¡æ¿" class="headerlink" title="ä¸€èˆ¬æ ¼å¼æ¨¡æ¿"></a>ä¸€èˆ¬æ ¼å¼æ¨¡æ¿</h4><p><strong>ï¼ˆå¯ä»¥å…ˆå¤åˆ¶åˆ°è‡ªå·±çš„ç¼–è¯‘å™¨é‡Œï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;p align=&quot;center&quot;&gt;</span><br><span class="line">  &lt;img src=&quot;&quot; /&gt;</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹é¢æˆ‘ä»¬æ¥é€ä¸€å®ç°ç»„ä»¶çš„ä»£ç </span><br></pre></td></tr></table></figure><h2 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h2><h3 id="æµ·æµªæ•ˆæœè¾¹é¥°"><a href="#æµ·æµªæ•ˆæœè¾¹é¥°" class="headerlink" title="æµ·æµªæ•ˆæœè¾¹é¥°"></a>æµ·æµªæ•ˆæœè¾¹é¥°</h3><p><strong>ç½‘ç«™</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://capsule-render.vercel.app/</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241108231511744.png" alt="image-20241108231511744.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å·¦ä¾§é€‰æ‹©å®Œå</span><br><span class="line">ç‚¹å‡»å³ä¾§â€œCopyâ€</span><br><span class="line">å¤åˆ¶åˆ°æ¨¡æ¿çš„â€œsrcâ€å±æ€§å</span><br></pre></td></tr></table></figure><p><strong>æ›´å¤šå…·ä½“æ ·å¼å‚è€ƒï¼ˆç ”ç©¶ingã€‚ã€‚ã€‚ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/kyechan99/capsule-render?tab=readme-ov-file#color</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241108231452249.png" alt="image-20241108231452249.png"></p><h3 id="æ‰“å­—æœºåŠ¨ç”»"><a href="#æ‰“å­—æœºåŠ¨ç”»" class="headerlink" title="æ‰“å­—æœºåŠ¨ç”»"></a>æ‰“å­—æœºåŠ¨ç”»</h3><p><strong>ç½‘ç«™</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://readme-typing-svg.demolab.com/demo/</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241108230812485.png" alt="image-20241108230812485.png"></p><h3 id="æŠ€æœ¯æ ˆå›¾æ ‡"><a href="#æŠ€æœ¯æ ˆå›¾æ ‡" class="headerlink" title="æŠ€æœ¯æ ˆå›¾æ ‡"></a>æŠ€æœ¯æ ˆå›¾æ ‡</h3><p><strong>ç½‘ç«™ï¼ˆéœ€è¦æŒ‚æ¢¯å­ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://marwin1991.github.io/profile-technology-icons/</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241108225831578.png" alt="image-20241108225831578.png"></p><h3 id="è´¡çŒ®çƒ­åº¦è¡¨"><a href="#è´¡çŒ®çƒ­åº¦è¡¨" class="headerlink" title="è´¡çŒ®çƒ­åº¦è¡¨"></a>è´¡çŒ®çƒ­åº¦è¡¨</h3><p><strong>ç½‘ç«™</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github-readme-streak-stats.herokuapp.com/demo/</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241109150452284.png" alt="image-20241109150452284.png"></p><h3 id="å¡ç‰‡"><a href="#å¡ç‰‡" class="headerlink" title="å¡ç‰‡"></a>å¡ç‰‡</h3><p><strong>ç½‘ç«™</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://tools.bugdesigner.cn/#/gen_card</span><br></pre></td></tr></table></figure><h4 id="ä¸ªäººæŒ‡æ ‡æ¨¡å—"><a href="#ä¸ªäººæŒ‡æ ‡æ¨¡å—" class="headerlink" title="ä¸ªäººæŒ‡æ ‡æ¨¡å—"></a>ä¸ªäººæŒ‡æ ‡æ¨¡å—</h4><p><img src="/upload/image-20241108231807726.png" alt="image-20241108231807726.png"></p><p><strong>æ›´å¤šä¸»é¢˜</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/anuraghazra/github-readme-stats</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241109142125669.png" alt="image-20241109142125669.png"></p><p>**ä¸»é¢˜ä¿®æ”¹è¯¦æƒ…è§ä¸Šæ–‡â€œ**<strong>ä»£ç ç»“æ„è¯¦è§£</strong>â€</p><p><strong>è¿˜æ˜¯å¡ç‰‡çš„é‚£ä¸ªç½‘ç«™</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://tools.bugdesigner.cn/#/gen_card</span><br></pre></td></tr></table></figure><h4 id="å¸¸ç”¨è¯­è¨€æ¨¡å—"><a href="#å¸¸ç”¨è¯­è¨€æ¨¡å—" class="headerlink" title="å¸¸ç”¨è¯­è¨€æ¨¡å—"></a>å¸¸ç”¨è¯­è¨€æ¨¡å—</h4><p><img src="/upload/image-20241109142657266.png" alt="image-20241109142657266.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ³¨ï¼šå¤åˆ¶ä»£ç éœ€è¦ä¿è¯usernameå±æ€§æ›´æ”¹ä¸ºè‡ªå·±çš„</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">themeå±æ€§å¯ä»¥è‡ªè¡Œæ·»åŠ ï¼Œå’Œä¸ªäººæŒ‡æ ‡æ¨¡å—å¯ç”¨çš„ä¸»é¢˜ä¸€è‡´</span><br></pre></td></tr></table></figure><h4 id="ä»“åº“å›ºå®šæ¨¡å—"><a href="#ä»“åº“å›ºå®šæ¨¡å—" class="headerlink" title="ä»“åº“å›ºå®šæ¨¡å—"></a>ä»“åº“å›ºå®šæ¨¡å—</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¯å°†æŸäº›ä»“åº“å›ºå®šåœ¨ä¸»é¡µREADMEå±•ç¤º</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241109143412576.png" alt="image-20241109143412576.png"></p><p><img src="/upload/image-20241109143443105.png" alt="image-20241109143443105.png"></p><h4 id="WakaTime-ç»Ÿè®¡å¡"><a href="#WakaTime-ç»Ÿè®¡å¡" class="headerlink" title="WakaTime ç»Ÿè®¡å¡"></a>WakaTime ç»Ÿè®¡å¡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ ¹æ®ä»¥ä¸Šæ“ä½œï¼Œæƒ³å¿…ä½ å·²ç»æ”¶æ‚‰äº†å¤§è‡´æµç¨‹ï¼Œè¯¥WakaTimeçš„éƒ¨ç½²æ–¹å¼ä¸ä¸Šè¿°æ“ä½œä¸€è‡´</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241109143646929.png" alt="image-20241109143646929.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¯¦æƒ…ä»¥  https://capsule-render.vercel.app/ å¤§ä½¬ä»“åº“ä¸ºä¸»</span><br></pre></td></tr></table></figure><h3 id="è´ªåƒè›‡"><a href="#è´ªåƒè›‡" class="headerlink" title="è´ªåƒè›‡"></a>è´ªåƒè›‡</h3><p><strong>å‚è€ƒè§†é¢‘ï¼š</strong><a href="https://www.bilibili.com/video/BV1W94y1v7cB/?spm_id_from=333.337.search-card.all.click">ç»™Githubä¸»é¡µåŠ ä¸Šè´ªåƒè›‡æ•ˆæœï¼Œè®©ä½ çš„ä¸»é¡µä¸ä¼—ä¸åŒ<em>å“”å“©å“”å“©</em>bilibili</a></p><p><strong>ä¸å¤ªå¥½é…ç½®ï¼Œå»ºè®®æ¯ä¸€æ­¥éƒ½è·Ÿç€æ¥</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºmain.ymlæ–‡ä»¶</span><br><span class="line">æ–‡ä»¶è·¯å¾„:</span><br><span class="line">.github/workflows/main.yml</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241109144506704.png" alt="image-20241109144506704.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶åˆ°main.ymlæ–‡ä»¶ä¸­</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">name: generate animation</span><br><span class="line"></span><br><span class="line">on:</span><br><span class="line">  # run automatically every 24 hours</span><br><span class="line">  schedule:</span><br><span class="line">    - cron: &#x27;0 */24 * * *&#x27;</span><br><span class="line"></span><br><span class="line">  # allows to manually run the job at any time</span><br><span class="line">  workflow_dispatch:</span><br><span class="line"></span><br><span class="line">  # run on every push on the master branch</span><br><span class="line">  push:</span><br><span class="line">    branches:</span><br><span class="line">      - main</span><br><span class="line"></span><br><span class="line">jobs:</span><br><span class="line">  generate:</span><br><span class="line">    runs-on: ubuntu-latest</span><br><span class="line">    timeout-minutes: 10</span><br><span class="line"></span><br><span class="line">    steps:</span><br><span class="line">      # generates a snake game from a github user (&lt;github_user_name&gt;) contributions graph, output a svg animation at &lt;svg_out_path&gt;</span><br><span class="line">      - name: generate github-contribution-grid-snake.svg</span><br><span class="line">        uses: Platane/snk/svg-only@v3</span><br><span class="line">        with:</span><br><span class="line">          github_user_name: $&#123;&#123; github.repository_owner &#125;&#125;</span><br><span class="line">          outputs: |</span><br><span class="line">            dist/github-contribution-grid-snake.svg</span><br><span class="line">            dist/github-contribution-grid-snake-dark.svg?palette=github-dark</span><br><span class="line">        env:</span><br><span class="line">          GITHUB_TOKEN: $&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125;</span><br><span class="line"></span><br><span class="line">      # push the content of &lt;build_dir&gt; to a branch</span><br><span class="line">      # the content will be available at https://raw.githubusercontent.com/&lt;github_user&gt;/&lt;repository&gt;/&lt;target_branch&gt;/&lt;file&gt; , or as github page</span><br><span class="line">      - name: push github-contribution-grid-snake.svg to the output branch</span><br><span class="line">        uses: crazy-max/ghaction-github-pages@v3.1.0</span><br><span class="line">        with:</span><br><span class="line">          target_branch: output</span><br><span class="line">          build_dir: dist</span><br><span class="line">        env:</span><br><span class="line">          GITHUB_TOKEN: $&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>README.mdè´ªåƒè›‡ä»£ç </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ³¨æ„æ›´æ”¹ç”¨æˆ·å</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;picture&gt;</span><br><span class="line">  &lt;source media=&quot;(prefers-color-scheme: dark)&quot; srcset=&quot;https://raw.githubusercontent.com/ç”¨æˆ·å/ç”¨æˆ·å/output/github-contribution-grid-snake-dark.svg&quot;&gt;</span><br><span class="line">  &lt;source media=&quot;(prefers-color-scheme: light)&quot; srcset=&quot;https://raw.githubusercontent.com/ç”¨æˆ·å/ç”¨æˆ·å/output/github-contribution-grid-snake.svg&quot;&gt;</span><br><span class="line">  &lt;img alt=&quot;github contribution grid snake animation&quot; src=&quot;https://raw.githubusercontent.com/ç”¨æˆ·å/ç”¨æˆ·å/output/github-contribution-grid-snake.svg&quot;&gt;</span><br><span class="line">&lt;/picture&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ­¤æ—¶ä½ çš„é¢„è§ˆä¸­çœ‹ä¸è§è´ªåƒè›‡çš„ç»„ä»¶ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œæˆ‘ä»¬æ¥ç€ä¸‹ä¸€æ­¥èµ°</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æäº¤ä½ çš„æœ¬åœ°ä»£ç åˆ°GitHubä»“åº“ï¼Œè¯¦æƒ…è§ä¸‹æ–‡â€œæäº¤æœ¬åœ°ä»£ç è‡³GitHubâ€</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">main.ymlæ–‡ä»¶çš„æœ¬è´¨ä¼šåˆ›å»ºä¸€ä¸ªoutputåˆ†æ”¯å¹¶æ¨é€ä»£ç ï¼Œä½†æ˜¯æ‰§è¡Œæ­¤æ“ä½œGitHubéœ€è¦é…ç½®ä¸€å®šçš„æƒé™</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241109145536992.png" alt="image-20241109145536992.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸Šæ–¹æ³•æˆäºˆå·¥ä½œæµè¯»å†™æƒé™å</span><br><span class="line">åˆ°Actionç›®å½•ï¼Œç‚¹å‡»Re-run jobsçš„Re-runï¼Œé‡æ–°æ‰§è¡Œå¤±è´¥çš„ä»»åŠ¡</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241109145648691.png" alt="image-20241109145648691.png"></p><p><strong>ç­‰å¾…ä¸‰äº”åˆ†é’Ÿä¹‹åå³å¯å®Œæˆè´ªåƒè›‡çš„éƒ¨ç½²</strong></p><h2 id="æäº¤æœ¬åœ°ä»£ç è‡³GitHub"><a href="#æäº¤æœ¬åœ°ä»£ç è‡³GitHub" class="headerlink" title="æäº¤æœ¬åœ°ä»£ç è‡³GitHub"></a>æäº¤æœ¬åœ°ä»£ç è‡³GitHub</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æä¸€å˜´Open Git Bash hereçš„åœ°å€</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241109143924621.png" alt="image-20241109143924621.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä¾æ¬¡æ‰§è¡Œ(å¯¹ç©ºæ ¼å’Œè‹±æ–‡åŒå¼•å·æœ‰ä¸¥æ ¼è¦æ±‚)</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;init&quot;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><h2 id="æ›´å¤š"><a href="#æ›´å¤š" class="headerlink" title="æ›´å¤š"></a>æ›´å¤š</h2><p><strong>åˆ°æ­¤æ‰€æœ‰æ­¥éª¤å°±ç»“æŸå•¦ï¼Œè¿˜æœ‰ä¸€äº›æ²¡æåˆ°çš„ç»„ä»¶ç½‘ç«™æ”¾åœ¨è¿™é‡Œï¼Œå¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥å°è¯•å°è¯•</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://shields.io/</span><br><span class="line">https://quira.sh/</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ–°ç‰ˆgitæ¨é€æ³¨æ„ç‚¹</title>
      <link href="/2025/03/08/Github/%E6%96%B0%E7%89%88git%E6%8E%A8%E9%80%81%E6%B3%A8%E6%84%8F%E7%82%B9/"/>
      <url>/2025/03/08/Github/%E6%96%B0%E7%89%88git%E6%8E%A8%E9%80%81%E6%B3%A8%E6%84%8F%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="æ–°ç‰ˆgitæ¨é€æ³¨æ„ç‚¹"><a href="#æ–°ç‰ˆgitæ¨é€æ³¨æ„ç‚¹" class="headerlink" title="æ–°ç‰ˆgitæ¨é€æ³¨æ„ç‚¹"></a>æ–°ç‰ˆgitæ¨é€æ³¨æ„ç‚¹</h1><p><strong>ä¸€åˆ‡çš„å¼€å§‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure><p><strong>æ—§ç‰ˆæœ¬GitæŒ‡ä»¤ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªæœ¬åœ°çš„masteråˆ†æ”¯</strong></p><p><img src="/upload/image-20250128151124085.png" alt="image-20250128151124085.png"></p><p><strong>æˆ‘æ˜¯win 2.42ç‰ˆæœ¬</strong></p><p><img src="/upload/image-20250128151406928.png" alt="image-20250128151406928.png"></p><p><strong>ä½†æ˜¯</strong></p><p><strong>åœ¨è¾ƒæ–°çš„GitHubçš„æ–°ä»“åº“ä¸­ï¼Œé»˜è®¤çš„åˆå§‹åˆ†æ”¯åç§°å·²ç»ä»masterå˜æ›´ä¸ºmain</strong></p><p><strong>å¦‚æœæˆ‘ä»¬ç›´æ¥ä¸€å¥—æ¨é€ä¸Šå»ä¼šç›´æ¥æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œä¼šç›´æ¥æ¨é€åˆ°è¿œç¨‹çš„masteråˆ†æ”¯ä¸Šï¼Œè€Œå½“å‰é»˜è®¤çš„ä¸»åˆ†æ”¯mainä¸Šæ²¡æœ‰ä¸œè¥¿</strong></p><p><strong>ç„¶åæˆ‘å»å°è¯•äº†ä¸€ä¸‹æ›´æ–°Gitç‰ˆæœ¬</strong></p><blockquote><p><strong>è®¿é—®</strong><a href="https://gitforwindows.org/?spm=5176.28103460.0.0.65235d27rZxmXv">Git for Windows</a>å®˜æ–¹ç½‘ç«™ï¼Œå®‰è£…æœ€æ–°ç‰ˆGit 2.47</p></blockquote><p><strong>ç„¶åæˆ‘å‘ç°git initè¿˜æ˜¯é»˜è®¤masteråˆ†æ”¯</strong></p><p><strong>æœ€åè¿˜æ˜¯å…ˆå…»æˆä¹ æƒ¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init -b main</span><br></pre></td></tr></table></figure><p><strong>åˆ‡åˆ°æŒ‡å®šåˆ†æ”¯åˆ›å»º</strong></p><p><strong>æ¥ä¸‹æ¥</strong></p><p><strong>è¿æ¥è¿œç¨‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin ä»“åº“åœ°å€</span><br></pre></td></tr></table></figure><p><strong>æ¨é€ä¸‰ä»¶å¥—</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;æ³¨é‡Š&quot;</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>gitåŸºç¡€æŒ‡ä»¤é›†</title>
      <link href="/2025/03/08/Github/git%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"/>
      <url>/2025/03/08/Github/git%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="git"><a href="#git" class="headerlink" title="git"></a>git</h1><h2 id="git-çš„è¿è¡Œæœºåˆ¶"><a href="#git-çš„è¿è¡Œæœºåˆ¶" class="headerlink" title="git çš„è¿è¡Œæœºåˆ¶"></a>git çš„è¿è¡Œæœºåˆ¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitåˆ†ä¸ºæœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“ï¼Œæˆ‘ä»¬ä¸€èˆ¬æƒ…å†µéƒ½æ˜¯å†™å®Œä»£ç ï¼Œcommitåˆ°æœ¬åœ°ä»“åº“ï¼ˆç”Ÿæˆæœ¬åœ°ä»“çš„commit IDï¼Œä»£è¡¨å½“å‰æäº¤ä»£ç çš„ç‰ˆæœ¬å·ï¼‰ï¼Œç„¶åpushåˆ°è¿œç¨‹ä»“åº“ï¼ˆè®°å½•è¿™ä¸ªç‰ˆæœ¬å·ï¼‰</span><br></pre></td></tr></table></figure><h2 id="git-config-é…ç½®"><a href="#git-config-é…ç½®" class="headerlink" title="git config(é…ç½®)"></a>git config(é…ç½®)</h2><p><strong>ä¸€ä¸ªç³»ç»Ÿåªéœ€è¦é…ç½®ä¸€æ¬¡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;chen&quot;</span><br><span class="line">git config --global user.email &quot;xxx@qq.com&quot;</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶çš„çŠ¶æ€"><a href="#æ–‡ä»¶çš„çŠ¶æ€" class="headerlink" title="æ–‡ä»¶çš„çŠ¶æ€"></a>æ–‡ä»¶çš„çŠ¶æ€</h2><h4 id="æŸ¥çœ‹"><a href="#æŸ¥çœ‹" class="headerlink" title="æŸ¥çœ‹"></a>æŸ¥çœ‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure><h5 id="æœªè·Ÿè¸ª"><a href="#æœªè·Ÿè¸ª" class="headerlink" title="æœªè·Ÿè¸ª"></a>æœªè·Ÿè¸ª</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//add .å‰</span><br></pre></td></tr></table></figure><h5 id="å·²è·Ÿè¸ª"><a href="#å·²è·Ÿè¸ª" class="headerlink" title="å·²è·Ÿè¸ª"></a>å·²è·Ÿè¸ª</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">staged      //æš‚ç¼“åŒºä¸­çš„æ–‡ä»¶çŠ¶æ€,ä¹Ÿå°±æ˜¯index</span><br><span class="line">Unmodified  //commitå‘½ä»¤ï¼Œå¯ä»¥å°†stagedä¸­æ–‡ä»¶æäº¤åˆ°Gitä»“åº“</span><br><span class="line">Modified    //ä¿®æ”¹äº†æŸä¸ªæ–‡ä»¶åï¼Œä¼šå¤„äºModifiedçŠ¶æ€;</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240709164956512.png" alt="image-20240709164956512.png"></p><h2 id="SSHå¯†é’¥"><a href="#SSHå¯†é’¥" class="headerlink" title="SSHå¯†é’¥"></a>SSHå¯†é’¥</h2><p><img src="/upload/image-20240709215925092.png" alt="image-20240709215925092.png"></p><h2 id="è·å–gitä»“åº“"><a href="#è·å–gitä»“åº“" class="headerlink" title="è·å–gitä»“åº“"></a>è·å–gitä»“åº“</h2><h4 id="æ“ä½œæµç¨‹å›¾"><a href="#æ“ä½œæµç¨‹å›¾" class="headerlink" title="æ“ä½œæµç¨‹å›¾"></a>æ“ä½œæµç¨‹å›¾</h4><p><img src="/upload/image-20240709165543658.png" alt="image-20240709165543658.png"></p><p><strong>gitä¸Šåˆ›å»ºæ–°ä»“åº“</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ç•Œé¢å³ä¸Šè§’&quot;+&quot;</span><br><span class="line"></span><br><span class="line">New repository</span><br><span class="line"></span><br><span class="line">ä»“åº“åå­—åŠ æè¿°</span><br><span class="line"></span><br><span class="line">Create repository</span><br></pre></td></tr></table></figure><p><strong>å»ºç«‹æœ¬åœ°ä»“åº“</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ä»¶æ ¹ç›®å½•å³é”®:Git Bash</span><br><span class="line"></span><br><span class="line">ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤</span><br><span class="line">git init</span><br><span class="line">git add .   //è·Ÿè¸ªæœ¬åœ°æ–‡ä»¶,æ–‡ä»¶å­˜å…¥æš‚å­˜åŒº</span><br><span class="line">git commit -m &quot;æ³¨é‡Š&quot;</span><br></pre></td></tr></table></figure><p><strong>å…³è”githubä»“åº“</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ°githubä»“åº“å¤åˆ¶ä»“åº“åœ°å€</span><br></pre></td></tr></table></figure><p><img src="file:///E:/%E5%9B%BE%E8%A7%A3/github%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80(%E6%8B%9F).webp?lastModify=1724233487"></p><p><img src="/upload/github%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80(%E6%8B%9F).webp" alt="githubä»“åº“åœ°å€(æ‹Ÿ).webp"></p><p><strong>æ‰§è¡ŒæŒ‡ä»¤</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin ...(ä¸ªäººæ–°å»ºä»“åº“åœ°å€)</span><br></pre></td></tr></table></figure><p><strong>ä¸Šä¼ æœ¬åœ°ä»£ç </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><p><strong>ä¸Šä¼ å®Œæˆ</strong></p><p><strong>(å¦‚æœå‡ºç°Are you sure you want to continue connecting (yes&#x2F;no)?)</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yes</span><br></pre></td></tr></table></figure><h4 id="æ›´æ–°ä»“åº“"><a href="#æ›´æ–°ä»“åº“" class="headerlink" title="æ›´æ–°ä»“åº“"></a>æ›´æ–°ä»“åº“</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;æ³¨é‡Š&quot;</span><br><span class="line">git push ä»“åº“åœ°å€ master</span><br></pre></td></tr></table></figure><h4 id="å…‹éš†ä»“åº“"><a href="#å…‹éš†ä»“åº“" class="headerlink" title="å…‹éš†ä»“åº“"></a>å…‹éš†ä»“åº“</h4><p><strong>CodeæŒ‰é’®é‡Œå¤åˆ¶ä»“åº“åœ°å€</strong></p><p><strong>æ¡Œé¢æ–°å»ºæ–‡ä»¶å¤¹</strong></p><p><strong>æ–‡ä»¶å¤¹é‡Œå¼€GitBash</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git clone åœ°å€</span><br></pre></td></tr></table></figure><h4 id="æ—¥å¿—å’Œç‰ˆæœ¬å›é€€"><a href="#æ—¥å¿—å’Œç‰ˆæœ¬å›é€€" class="headerlink" title="æ—¥å¿—å’Œç‰ˆæœ¬å›é€€"></a>æ—¥å¿—å’Œç‰ˆæœ¬å›é€€</h4><p><strong>æ ¡éªŒå’Œ</strong>(SHA-1æ•£åˆ—,å“ˆå¸Œ)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//æ¯æ¬¡æäº¤çš„å”¯ä¸€id</span><br><span class="line">//ç”±40 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦(0-9 å’Œ a-f)ç»„æˆçš„å­—ç¬¦ä¸²ï¼ŒåŸºäº Git ä¸­æ–‡ä»¶çš„å†…å®¹æˆ–ç›®å½•ç»“æ„è®¡ç®—å‡ºæ¥</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240709181505915.png" alt="image-20240709181505915.png"></p><p><strong>æ—¥å¿—</strong> (å†å²ç‰ˆæœ¬è®°å½•)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git log     //æŒ‰ç©ºæ ¼å¯ä»¥ç»§ç»­å¾€ä¸‹æŸ¥çœ‹</span><br><span class="line">æˆ–</span><br><span class="line">//ç®€æ´ç‰ˆ</span><br><span class="line">git log --pretty=on</span><br><span class="line">git reflog</span><br></pre></td></tr></table></figure><p><strong>å›é€€</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD^      //å›é€€ä¸Šä¸ªç‰ˆæœ¬</span><br><span class="line">git reset --hard HEAD^^     //å›é€€ä¸Šä¸Šä¸ªç‰ˆæœ¬</span><br><span class="line">git reset --hard HEAD~100   //å›é€€ä¸Š100ä¸ªç‰ˆæœ¬</span><br><span class="line">git reset --hard 2xwjh73e   //å›é€€åˆ°æŒ‡å®šcommid id(å¯ä»¥åªå†™å‰7ä½)</span><br></pre></td></tr></table></figure><h2 id="å»ºç«‹è¿œç¨‹ä»“åº“è¿æ¥"><a href="#å»ºç«‹è¿œç¨‹ä»“åº“è¿æ¥" class="headerlink" title="å»ºç«‹è¿œç¨‹ä»“åº“è¿æ¥"></a>å»ºç«‹è¿œç¨‹ä»“åº“è¿æ¥</h2><p><strong>è¿æ¥</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin ä»“åº“åœ°å€</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹è¿æ¥</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote</span><br><span class="line">git remote -v</span><br></pre></td></tr></table></figure><h4 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a><strong>åˆ†æ”¯</strong></h4><p><img src="/upload/image-20240712211441114.png" alt="image-20240712211441114.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">master  //ä¸»çº¿</span><br><span class="line">dev     //å¼€å‘</span><br><span class="line">release //é¢„å‘å¸ƒ</span><br><span class="line">hotfix  //çº¿ä¸Šbugä¿®å¤</span><br><span class="line">feature </span><br></pre></td></tr></table></figure><p><strong>æ“ä½œ</strong></p><p><img src="/upload/image-20240712211630760.png" alt="image-20240712211630760.png"></p><p><strong>é¡ºåº</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºåˆ†æ”¯-&gt;ä¿®æ”¹æ–‡ä»¶-&gt;ä¿®æ”¹åçš„æ–‡ä»¶æäº¤åˆ°devä¸­</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºåˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init -b dev         //åˆ›å»ºæ–°åˆ†æ”¯,ä¼šåˆ‡æ¢åˆ°æ–°åˆ†æ”¯</span><br><span class="line">git branch &lt;æ–°åˆ†æ”¯åç§°&gt;   //åˆ›å»ºæ–°åˆ†æ”¯</span><br></pre></td></tr></table></figure><p><strong>åˆ‡æ¢åˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;æ–°åˆ†æ”¯&gt;</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;æ–°åˆ†æ”¯&gt;</span><br></pre></td></tr></table></figure><p><strong>åˆ†æ”¯é‡å‘½å</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -m &lt;æ—§åˆ†æ”¯&gt; &lt;æ–°åˆ†æ”¯&gt;</span><br></pre></td></tr></table></figure><p><strong>åˆ é™¤åˆ†æ”¯(è°¨æ…)</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -d &lt;åˆ†æ”¯&gt;  //åˆ é™¤å·²åˆå¹¶è¿‡çš„åˆ†æ”¯</span><br><span class="line">git branch -D &lt;åˆ†æ”¯&gt;  //å¼ºåˆ¶åˆ é™¤åˆ†æ”¯</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹ç‰ˆæœ¬åº“æœ‰å“ªäº›åˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹ç‰ˆæœ¬åº“çŠ¶æ€</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br><span class="line">//æ²¡æœ‰æäº¤å°±git add .</span><br></pre></td></tr></table></figure><p><strong>åˆå¹¶åˆ°å½“å‰åˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge &lt;éœ€è¦è¢«åˆå¹¶çš„åˆ†æ”¯&gt;</span><br></pre></td></tr></table></figure><p><strong>ä»æŒ‡å®šè¿œç¨‹ä»“åº“è·å–</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master(å¯æ¢) </span><br></pre></td></tr></table></figure><p><strong>å¦‚æœæƒ³ç›´æ¥æ‰§è¡Œgit fetch</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//å…ˆç»™å½“å‰åˆ†æ”¯è®¾ç½®ä¸€ä¸ªè·Ÿè¸ªåˆ†æ”¯</span><br><span class="line">git branch --set-upstream-to=origin/master</span><br><span class="line">git pull</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºä¸€ä¸ªåˆ†æ”¯æ¥è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --track dev origin/master</span><br></pre></td></tr></table></figure><h4 id="forkä¸PR"><a href="#forkä¸PR" class="headerlink" title="forkä¸PR"></a>forkä¸PR</h4><p><strong>PR</strong> : <em>pull request</em> <em>æ‹‰å–è¯·æ±‚</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å…ˆforkæŠŠåˆ«äººçš„é¡¹ç›®å¤åˆ¶åˆ°è‡ªå·±çš„è¿œç¨‹ä»“åº“é‡Œ</span><br><span class="line">&lt;&gt;Codeè·å¾—ä»“åº“çš„åœ°å€</span><br><span class="line">ç”µè„‘åˆ›å»ºæ–‡ä»¶å¤¹,Git Bashæ‰“å¼€</span><br><span class="line">git clone &lt;åœ°å€&gt;</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹æ–‡ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ststus</span><br></pre></td></tr></table></figure><p><strong>æäº¤</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;æ³¨é‡Š&quot;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><p><strong>åˆå¹¶è¯·æ±‚(PR)</strong></p><p><img src="/upload/image-20240712221944550.png" alt="image-20240712221944550.png"></p>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>GitHubè‡ªåŠ¨åŒ–éƒ¨ç½²</title>
      <link href="/2025/03/08/Github/GitHub%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/"/>
      <url>/2025/03/08/Github/GitHub%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="GitHubè‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#GitHubè‡ªåŠ¨åŒ–éƒ¨ç½²" class="headerlink" title="GitHubè‡ªåŠ¨åŒ–éƒ¨ç½²"></a>GitHubè‡ªåŠ¨åŒ–éƒ¨ç½²</h1><p><strong>é€šè¿‡ GitHub Actions å®ç°ã€Œæäº¤ä»£ç  â†’ è‡ªåŠ¨æ„å»º â†’ ç”Ÿæˆ Releasesã€</strong></p><p><strong>å®ç°æ­¥éª¤</strong></p><blockquote><p>**åœ¨æœ¬åœ°ä»“åº“ä¸­åˆ›å»º **<code>.github/workflows/build.yml</code></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">name: Build and Release</span><br><span class="line"></span><br><span class="line">on:</span><br><span class="line">  push:</span><br><span class="line">    tags: </span><br><span class="line">      - &#x27;v*&#x27; # å½“æ‰“ tag æ—¶è§¦å‘</span><br><span class="line"></span><br><span class="line">jobs:</span><br><span class="line">  build:</span><br><span class="line">    runs-on: windows-latest</span><br><span class="line"></span><br><span class="line">    steps:</span><br><span class="line">    - uses: actions/checkout@v4</span><br><span class="line"></span><br><span class="line">    - name: Install Node.js</span><br><span class="line">      uses: actions/setup-node@v3</span><br><span class="line">      with:</span><br><span class="line">        node-version: 20</span><br><span class="line"></span><br><span class="line">    - name: Install PNPM</span><br><span class="line">      run: npm install -g pnpm</span><br><span class="line"></span><br><span class="line">    - name: Install Dependencies</span><br><span class="line">      run: pnpm install</span><br><span class="line"></span><br><span class="line">    - name: Build Project</span><br><span class="line">      run: pnpm run build</span><br><span class="line"></span><br><span class="line">    - name: Create Release</span><br><span class="line">      uses: softprops/action-gh-release@v1</span><br><span class="line">      with:</span><br><span class="line">        files: release/*.exe</span><br></pre></td></tr></table></figure><blockquote><p><strong>è§¦å‘æ–¹å¼</strong>ï¼šå½“ä½ åœ¨æœ¬åœ°æ‰“æ ‡ç­¾ï¼ˆå¦‚ <code>git tag v1.0.0</code>ï¼‰å¹¶æ¨é€æ—¶ï¼Œè‡ªåŠ¨æ„å»ºå¹¶å‘å¸ƒ Release</p></blockquote><h2 id="è¿œç¨‹ä»“åº“é…ç½®"><a href="#è¿œç¨‹ä»“åº“é…ç½®" class="headerlink" title="è¿œç¨‹ä»“åº“é…ç½®"></a>è¿œç¨‹ä»“åº“é…ç½®</h2><blockquote><p><strong>GitHub -&gt; ä½ çš„ä»“åº“ -&gt; Settions -&gt; Actions -&gt; General -&gt; é€‰æ‹©Read and write permissionsï¼ˆå·¥ä½œæµæƒé™ï¼‰</strong></p></blockquote><h2 id="æ¨é€"><a href="#æ¨é€" class="headerlink" title="æ¨é€"></a>æ¨é€</h2><p><strong>å¦‚æœä½ ç¬¬ä¸€æ¬¡æ¨é€ä»£ç </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init -b main</span><br></pre></td></tr></table></figure><p><strong>è¿æ¥è¿œç¨‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin ä»“åº“åœ°å€</span><br></pre></td></tr></table></figure><p><strong>æ¨é€ä»£ç </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;æ³¨é‡Š&quot;</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure><p><strong>æ¨é€æ ‡ç­¾ï¼ˆä¹Ÿè¦æï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºæ ‡ç­¾ï¼ˆç‰ˆæœ¬å·æ ¼å¼æ¨è vX.Y.Zï¼‰</span><br><span class="line">git tag -a v1.0.0 -m &quot;Release version 1.0.0&quot;</span><br><span class="line">git push origin v1.0.0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2025/03/08/%E5%8D%9A%E5%AE%A2/%E5%8D%9A%E5%AE%A2%E9%9F%B3%E4%B9%90%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0/"/>
      <url>/2025/03/08/%E5%8D%9A%E5%AE%A2/%E5%8D%9A%E5%AE%A2%E9%9F%B3%E4%B9%90%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="åšå®¢éŸ³ä¹ç»„ä»¶å®ç°"><a href="#åšå®¢éŸ³ä¹ç»„ä»¶å®ç°" class="headerlink" title="åšå®¢éŸ³ä¹ç»„ä»¶å®ç°"></a>åšå®¢éŸ³ä¹ç»„ä»¶å®ç°</h1><p><strong>è¯¦æƒ…ç§»æ­¥ | å®‰çŸ¥é±¼ | å¤§ä½¬çš„åšå®¢æ–‡ç« </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.anheyu.com/posts/a76e.html</span><br></pre></td></tr></table></figure><h2 id="ä¸€å›¾æµ"><a href="#ä¸€å›¾æµ" class="headerlink" title="ä¸€å›¾æµ"></a>ä¸€å›¾æµ</h2><p><img src="/upload/image-20250131180643649.png" alt="image-20250131180643649.png"></p><h2 id="å¼€æ”¾å¼å…¬ç›ŠAPI"><a href="#å¼€æ”¾å¼å…¬ç›ŠAPI" class="headerlink" title="å¼€æ”¾å¼å…¬ç›ŠAPI"></a>å¼€æ”¾å¼å…¬ç›ŠAPI</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.injahow.cn/meting/?server=:server&amp;type=:type&amp;id=:id&amp;auth=:auth&amp;r=:r</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://meting.qjqq.cn/?server=:server&amp;type=:type&amp;id=:id&amp;auth=:auth&amp;r=:r</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>var/let/const</title>
      <link href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/varletconst%E5%8C%BA%E5%88%86/"/>
      <url>/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/varletconst%E5%8C%BA%E5%88%86/</url>
      
        <content type="html"><![CDATA[<h1 id="var-let-conståŒºåˆ†"><a href="#var-let-conståŒºåˆ†" class="headerlink" title="var&#x2F;let&#x2F;conståŒºåˆ†"></a>var&#x2F;let&#x2F;conståŒºåˆ†</h1><h5 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h5><p><strong>var å’Œ let çš„ä½œç”¨åŸŸè§„åˆ™ä¸€æ ·</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å‡½æ•°å¤–ï¼Œæ˜¯å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå‡½æ•°é‡Œï¼Œæ˜¯å½“å‰å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚//å£°æ˜çš„å˜é‡çš„ä½œç”¨åŸŸåªèƒ½æ˜¯å…¨å±€æˆ–è€…æ•´ä¸ªå‡½æ•°å—çš„ã€‚</span><br></pre></td></tr></table></figure><h5 id="é‡å¤å£°æ˜"><a href="#é‡å¤å£°æ˜" class="headerlink" title="é‡å¤å£°æ˜"></a>é‡å¤å£°æ˜</h5><p><strong>var å…è®¸ï¼Œlet&#x2F;constä¸å…è®¸</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function test() &#123;</span><br><span class="line">  var a = 3;</span><br><span class="line">  var a = 4;</span><br><span class="line">  console.log(a) // 4</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>letæ˜¯å—çº§ä½œç”¨åŸŸ</strong></p><p><strong>conståªèƒ½åœ¨å£°æ˜å®ƒä»¬çš„å—çº§ä½œç”¨åŸŸä¸­è®¿é—®</strong></p><p><strong>const&#x2F;letåœ¨å—çº§ä½œç”¨åŸŸå¤–æ— æ³•è®¿é—®å†…éƒ¨å˜é‡ï¼</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(true)&#123;</span><br><span class="line">    const a=1;</span><br><span class="line">&#125;</span><br><span class="line">console.log(a)</span><br></pre></td></tr></table></figure><h5 id="ç»‘å®šå…¨å±€å˜é‡"><a href="#ç»‘å®šå…¨å±€å˜é‡" class="headerlink" title="ç»‘å®šå…¨å±€å˜é‡"></a>ç»‘å®šå…¨å±€å˜é‡</h5><p><strong>åœ¨å…¨å±€ç¯å¢ƒå£°æ˜å˜é‡ï¼Œvarä¼šåœ¨å…¨å±€å¯¹è±¡é‡Œæ–°å»ºä¸€ä¸ªå±æ€§ï¼Œlet&#x2F;constä¸ä¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var foo = &#x27;global&#x27;</span><br><span class="line">let bar = &#x27;global&#x27;</span><br><span class="line"></span><br><span class="line">console.log(this.foo) // global</span><br><span class="line">console.log(this.bar) // undefined</span><br></pre></td></tr></table></figure><p><strong>æ­¤æ—¶letå®šä¹‰çš„å˜é‡å®é™…åœ¨test å‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸Š</strong></p><p><img src="/upload/image-20241104212220166.png" alt="image-20241104212220166.png"></p><h5 id="å˜é‡æå‡ä¸æš‚å­˜æ­»åŒº"><a href="#å˜é‡æå‡ä¸æš‚å­˜æ­»åŒº" class="headerlink" title="å˜é‡æå‡ä¸æš‚å­˜æ­»åŒº"></a><strong>å˜é‡æå‡ä¸æš‚å­˜æ­»åŒº</strong></h5><p><img src="/upload/image-20241104223204685.png" alt="image-20241104223204685.png"></p><p><strong>ä¸Šè¿°ä»£ç çš„ä¾‹å­ä¸­</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">varä¾‹å­å°±æ˜¯å˜é‡æå‡ï¼Œconst/letçš„æŠ¥é”™å°±æ˜¯æš‚æ—¶æ€§æ­»åŒº</span><br></pre></td></tr></table></figure><p><strong>ä»£ç çš„æ‰§è¡ŒåŸç†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»º-&gt;åˆå§‹åŒ–-&gt;èµ‹å€¼</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var å£°æ˜çš„å˜é‡åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºé˜¶æ®µå°±ä¼šè¢«ã€Œåˆ›å»ºã€å’Œã€Œåˆå§‹åŒ–ã€ï¼Œå› æ­¤å¯¹äºæ‰§è¡Œé˜¶æ®µæ¥è¯´ï¼Œå¯ä»¥åœ¨å£°æ˜ä¹‹å‰ä½¿ç”¨ã€‚</span><br><span class="line">let å£°æ˜çš„å˜é‡åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºé˜¶æ®µåªä¼šè¢«ã€Œåˆ›å»ºã€è€Œä¸ä¼šè¢«ã€Œåˆå§‹åŒ–ã€ï¼Œå› æ­¤å¯¹äºæ‰§è¡Œé˜¶æ®µæ¥è¯´ï¼Œå¦‚æœåœ¨å…¶å®šä¹‰æ‰§è¡Œå‰ä½¿ç”¨ï¼Œç›¸å½“äºä½¿ç”¨äº†æœªè¢«åˆå§‹åŒ–çš„å˜é‡ï¼Œä¼šæŠ¥é”™ã€‚</span><br></pre></td></tr></table></figure><p><strong>let ä¸ const å¼‚åŒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å”¯ä¸€åŒºåˆ«å°±åœ¨äº const å£°æ˜çš„æ˜¯ä¸€ä¸ªåªè¯»å˜é‡ï¼Œå£°æ˜ä¹‹åä¸å…è®¸æ”¹å˜å…¶å€¼ã€‚</span><br><span class="line">å› æ­¤ï¼Œconst ä¸€æ—¦å£°æ˜å¿…é¡»åˆå§‹åŒ–ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>TSåŸºç¡€</title>
      <link href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/TS%E5%9F%BA%E7%A1%80/"/>
      <url>/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/TS%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="TS"><a href="#TS" class="headerlink" title="TS"></a>TS</h1><h3 id="ç±»å‹ï¼ˆinterfaceï¼‰"><a href="#ç±»å‹ï¼ˆinterfaceï¼‰" class="headerlink" title="ç±»å‹ï¼ˆinterfaceï¼‰"></a>ç±»å‹ï¼ˆinterfaceï¼‰</h3><h5 id="å£°æ˜"><a href="#å£°æ˜" class="headerlink" title="å£°æ˜"></a>å£°æ˜</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let a: string //å˜é‡aåªèƒ½å­˜å‚¨å­—ç¬¦ä¸²</span><br><span class="line">let b: number //å˜é‡aåªèƒ½å­˜å‚¨æ•°å€¼</span><br><span class="line">let c: boolean //å˜é‡aåªèƒ½å­˜å‚¨å¸ƒå°”å€¼</span><br><span class="line">// å‚æ•°xå¿…é¡»æ˜¯æ•°å­—ï¼Œå‚æ•°yä¹Ÿå¿…é¡»æ˜¯æ•°å­—ï¼Œå‡½æ•°è¿”å›å€¼ä¹Ÿå¿…é¡»æ˜¯æ•°å­—</span><br><span class="line">function demo(x:number,y:number):number&#123;</span><br><span class="line"> return x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">string ã€ number ã€ boolean ã€ null ã€ undefined ã€ bigint ã€ symbol ã€ object(Array ã€Function ã€Date ......)</span><br><span class="line">(æ–°)</span><br><span class="line">void ã€ never ã€ unknown ã€ any ã€ enum ã€ tuple</span><br><span class="line">(è‡ªå®šä¹‰)</span><br><span class="line">type ã€ interface</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨ç±»å‹"><a href="#å¸¸ç”¨ç±»å‹" class="headerlink" title="å¸¸ç”¨ç±»å‹"></a>å¸¸ç”¨ç±»å‹</h3><h5 id="å­—é¢é‡"><a href="#å­—é¢é‡" class="headerlink" title="å­—é¢é‡"></a>å­—é¢é‡</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å€¼åªèƒ½æ˜¯å­—â¾¯é‡å€¼ ï¼ˆå€¼æœ¬èº«ï¼‰</span><br></pre></td></tr></table></figure><h5 id="any"><a href="#any" class="headerlink" title="any"></a>any</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//æ˜¾å¼çš„any</span><br><span class="line">let a: any</span><br><span class="line">a = 100</span><br><span class="line">a = &#x27;ä½ å¥½&#x27;</span><br><span class="line">a = false</span><br><span class="line"></span><br><span class="line">//éšå¼çš„any</span><br><span class="line">let b</span><br><span class="line">b = 100</span><br><span class="line">b = &#x27;ä½ å¥½&#x27;</span><br><span class="line">b = false</span><br><span class="line"></span><br><span class="line">let a</span><br><span class="line">let x: string</span><br><span class="line">x = a // â½†è­¦å‘Š</span><br></pre></td></tr></table></figure><h5 id="unknown"><a href="#unknown" class="headerlink" title="unknown"></a>unknown</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//é€‚â½¤äºï¼šå¼€å§‹ä¸çŸ¥é“æ•°æ®çš„å…·ä½“ç±»å‹ï¼ŒåæœŸæ‰èƒ½ç¡®å®šæ•°æ®çš„ç±»å‹</span><br><span class="line">let a: unknown</span><br><span class="line">a = 100</span><br><span class="line">a = false</span><br><span class="line">a = &#x27;ä½ å¥½&#x27;</span><br><span class="line"></span><br><span class="line">let x: string</span><br><span class="line">x = a // è­¦å‘Šï¼šä¸èƒ½å°†â€œunknownâ€åˆ†é…ç»™â€œstring</span><br></pre></td></tr></table></figure><h5 id="never"><a href="#never" class="headerlink" title="never"></a>never</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">let a: never</span><br><span class="line">// è­¦å‘Š</span><br><span class="line">a = 1</span><br><span class="line">a = true</span><br><span class="line">a = undefined</span><br><span class="line">a = null</span><br><span class="line"></span><br><span class="line">//tså¯ä¸»åŠ¨æ¨æ–­</span><br><span class="line">if(typeof a === &#x27;string&#x27;)&#123;</span><br><span class="line"> a.toUpperCase()</span><br><span class="line">&#125;else&#123;</span><br><span class="line"> console.log(a) // æ¨æ–­å‡ºæ­¤å¤„ä¸ºnever</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//é€‚â½¤äºï¼šé™åˆ¶å‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">// é™åˆ¶demoå‡½æ•°ä¸éœ€è¦æœ‰ä»»ä½•è¿”å›å€¼ï¼Œä»»ä½•å€¼éƒ½ä¸â¾ï¼Œåƒundeifnedã€nulléƒ½ä¸â¾</span><br><span class="line">function demo():never&#123;</span><br><span class="line"> throw new Error(&#x27;ç¨‹åºå¼‚å¸¸é€€å‡º&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="void"><a href="#void" class="headerlink" title="void"></a>void</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//é€‚â½¤äºï¼šé™åˆ¶å‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">let a:void = undefined</span><br><span class="line">// â½†è­¦å‘Š</span><br><span class="line">function demo1():void&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">// â½†è­¦å‘Š</span><br><span class="line">function demo2():void&#123;</span><br><span class="line"> return</span><br><span class="line">&#125;</span><br><span class="line">// â½†è­¦å‘Š</span><br><span class="line">function demo3():void&#123;</span><br><span class="line"> return undefined</span><br><span class="line">&#125;</span><br><span class="line">// æœ‰è­¦å‘Šï¼šä¸èƒ½å°†ç±»å‹â€œnumberâ€åˆ†é…ç»™ç±»å‹â€œvoidâ€</span><br><span class="line">function demo4():void&#123;</span><br><span class="line"> return 666</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="objectï¼ˆä¸å¸¸ç”¨ï¼‰"><a href="#objectï¼ˆä¸å¸¸ç”¨ï¼‰" class="headerlink" title="objectï¼ˆä¸å¸¸ç”¨ï¼‰"></a>objectï¼ˆä¸å¸¸ç”¨ï¼‰</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">let a:object //açš„å€¼å¯ä»¥æ˜¯ä»»ä½•ã€â¾®åŸå§‹å€¼ç±»å‹ã€‘ï¼ŒåŒ…æ‹¬ï¼šå¯¹è±¡ã€å‡½æ•°ã€æ•°ç»„ç­‰</span><br><span class="line"></span><br><span class="line">// ã€â¾®åŸå§‹ç±»å‹ã€‘â½†è­¦å‘Š</span><br><span class="line">a = &#123;&#125;</span><br><span class="line">a = &#123;name:&#x27;å¼ ä¸‰&#x27;&#125;</span><br><span class="line">a = [1,3,5,7,9]</span><br><span class="line">a = function()&#123;&#125;</span><br><span class="line"></span><br><span class="line">// ã€åŸå§‹ç±»å‹ã€‘æœ‰è­¦å‘Š</span><br><span class="line">a = null // è­¦å‘Šï¼šä¸èƒ½å°†ç±»å‹â€œnullâ€åˆ†é…ç»™ç±»å‹â€œobjectâ€</span><br><span class="line">a = undefined // è­¦å‘Šï¼šä¸èƒ½å°†ç±»å‹â€œundefinedâ€åˆ†é…ç»™ç±»å‹â€œobjectâ€</span><br><span class="line">a = 1 // è­¦å‘Šï¼šä¸èƒ½å°†ç±»å‹â€œnumberâ€åˆ†é…ç»™ç±»å‹â€œobjectâ€</span><br><span class="line">a = true // è­¦å‘Šï¼šä¸èƒ½å°†ç±»å‹â€œbooleanâ€åˆ†é…ç»™ç±»å‹â€œobjectâ€</span><br><span class="line">a = &#x27;ä½ å¥½&#x27; // è­¦å‘Šï¼šä¸èƒ½å°†ç±»å‹â€œstringâ€åˆ†é…ç»™ç±»å‹â€œobject</span><br></pre></td></tr></table></figure><h6 id="é™åˆ¶ç±»å‹å†™æ³•"><a href="#é™åˆ¶ç±»å‹å†™æ³•" class="headerlink" title="é™åˆ¶ç±»å‹å†™æ³•"></a>é™åˆ¶ç±»å‹å†™æ³•</h6><p><strong>å¯¹è±¡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let person: &#123; name: string, age?: number&#125; //é—®å·ä»£è¡¨å¯é€‰å±æ€§</span><br><span class="line">let car: &#123; price: number; color: string; [k:string]:any&#125;</span><br><span class="line">let student: &#123;</span><br><span class="line"> id: string</span><br><span class="line"> grade:number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person = &#123;name:&#x27;å¼ ä¸‰&#x27;,age:18&#125;</span><br><span class="line">person = &#123;name:&#x27;æå››&#x27;&#125;</span><br><span class="line">car = &#123;price:100,color:&#x27;çº¢â¾Š&#x27;&#125;</span><br><span class="line">student = &#123;id:&#x27;tetqw76te01&#x27;,grade:3&#125;</span><br></pre></td></tr></table></figure><p><strong>å‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let demo: (a: number, b: number) =&gt; number</span><br><span class="line">demo = function(x,y) &#123;</span><br><span class="line"> return x+y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•°ç»„</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let arr1: string[] // è¯¥â¾ä»£ç ç­‰ä»·äºï¼š let arr1: Array&lt;string&gt;</span><br><span class="line">let arr2: number[] // è¯¥â¾ä»£ç ç­‰ä»·äºï¼š let arr2: Array&lt;number&gt;</span><br><span class="line">arr1 = [&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]</span><br><span class="line">arr2 = [1,3,5,7,9]</span><br></pre></td></tr></table></figure><h5 id="tuple"><a href="#tuple" class="headerlink" title="tuple"></a>tuple</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//é•¿çŸ­å›ºå®šçš„æ•°ç»„</span><br><span class="line">let t: [string,number]</span><br><span class="line">t = [&#x27;hello&#x27;,123]</span><br><span class="line">// è­¦å‘Šï¼Œä¸èƒ½å°†ç±»å‹â€œ[string, number, boolean]â€åˆ†é…ç»™ç±»å‹â€œ[string, number]â€</span><br><span class="line">t = [&#x27;hello&#x27;,123,false]</span><br></pre></td></tr></table></figure><h5 id="enum"><a href="#enum" class="headerlink" title="enum"></a>enum</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//æšä¸¾</span><br><span class="line">// å®šä¹‰â¼€ä¸ªæšä¸¾</span><br><span class="line">enum Color &#123;</span><br><span class="line"> Red,</span><br><span class="line"> Blue,</span><br><span class="line"> Black,</span><br><span class="line"> Gold</span><br><span class="line">&#125;</span><br><span class="line">// å®šä¹‰â¼€ä¸ªæšä¸¾ï¼Œå¹¶æŒ‡å®šå…¶åˆè¯†æ•°å€¼</span><br><span class="line">enum Color2 &#123;</span><br><span class="line"> Red = 6,</span><br><span class="line"> Blue,</span><br><span class="line"> Black,</span><br><span class="line"> Gold</span><br><span class="line">&#125;</span><br><span class="line">console.log(Color)</span><br><span class="line">/*</span><br><span class="line"> &#123;</span><br><span class="line">     0: &#x27;Red&#x27;, 1: &#x27;Blue&#x27;, 2: &#x27;Black&#x27;, 3: &#x27;Gold&#x27;,</span><br><span class="line">     Red: 0, Blue: 1, Black: 2, Gold: 3</span><br><span class="line"> &#125;</span><br><span class="line">*/</span><br><span class="line">console.log(Color2)</span><br><span class="line">/*</span><br><span class="line"> &#123;</span><br><span class="line">     6: &#x27;Red&#x27;,  7: &#x27;Blue&#x27;, 8: &#x27;Black&#x27;, 9: &#x27;Gold&#x27;,</span><br><span class="line">     Red: 6, Blue: 7, Black: 8, Gold: 9</span><br><span class="line"> &#125;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><p><strong>å®ä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// å®šä¹‰â¼€ä¸ªphoneå˜é‡ï¼Œå¹¶è®¾ç½®å¯¹â»¬è¿›â¾é™åˆ¶</span><br><span class="line">let phone: &#123;name:string,price:number,color:Color&#125;</span><br><span class="line"></span><br><span class="line">phone = &#123;name:&#x27;åä¸ºMate60&#x27;,price:6500,color:Color.Red&#125;</span><br><span class="line">phone = &#123;name:&#x27;iPhone15Pro&#x27;,price:7999,color:Color.Blue&#125;</span><br><span class="line"></span><br><span class="line">if(phone.color === Color.Red)&#123;</span><br><span class="line"> console.log(&#x27;â¼¿æœºæ˜¯çº¢â¾Šçš„&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰ç±»"><a href="#è‡ªå®šä¹‰ç±»" class="headerlink" title="è‡ªå®šä¹‰ç±»"></a>è‡ªå®šä¹‰ç±»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// æ€§åˆ«çš„æšä¸¾</span><br><span class="line">enum Gender &#123;</span><br><span class="line"> Male,</span><br><span class="line"> Female</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// â¾ƒå®šä¹‰â¼€ä¸ªå¹´çº§ç±»å‹ï¼ˆâ¾¼â¼€ã€â¾¼â¼†ã€â¾¼ä¸‰ï¼‰</span><br><span class="line">type Grade = 1 | 2 | 3</span><br><span class="line"></span><br><span class="line">// â¾ƒå®šä¹‰â¼€ä¸ªå­¦â½£ç±»å‹</span><br><span class="line">type Student = &#123;</span><br><span class="line"> name:string,</span><br><span class="line"> age:number,</span><br><span class="line"> gender:Gender,</span><br><span class="line"> grade:Grade</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å®šä¹‰ä¸¤ä¸ªå­¦â½£å˜é‡ï¼šs1ã€s2</span><br><span class="line">let s1:Student</span><br><span class="line">let s2:Student</span><br><span class="line"></span><br><span class="line">s1 = &#123;name:&#x27;å¼ ä¸‰&#x27;,age:18,gender:Gender.Male,grade:1&#125;</span><br><span class="line">s2 = &#123;name:&#x27;æå››&#x27;,age:18,gender:Gender.Female,grade:2&#125;</span><br></pre></td></tr></table></figure><h3 id="æŠ½è±¡ç±»"><a href="#æŠ½è±¡ç±»" class="headerlink" title="æŠ½è±¡ç±»"></a>æŠ½è±¡ç±»</h3><p><strong>å¸¸è§„ç±»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line"> name: string</span><br><span class="line"> age: number</span><br><span class="line"> constructor(name:string,age:number)&#123;//æ„é€ å‡½æ•°</span><br><span class="line">     this.name = name</span><br><span class="line">     this.age = age</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const p1 = new Person(&#x27;å¼ ä¸‰&#x27;,18)</span><br><span class="line">const p2 = new Person(&#x27;æå››&#x27;,19)</span><br></pre></td></tr></table></figure><p><strong>ç»§æ‰¿</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123; &#125;</span><br><span class="line"></span><br><span class="line">// Teacherç±»ç»§æ‰¿Person</span><br><span class="line">class Teacher extends Person &#123; &#125;</span><br><span class="line"></span><br><span class="line">// Studentç±»ç»§æ‰¿Person</span><br><span class="line">class Student extends Person &#123; &#125;</span><br><span class="line"></span><br><span class="line">// Personå®ä¾‹</span><br><span class="line">const p1 = new Person(&#x27;å‘¨æ°ä¼¦&#x27;,38)</span><br><span class="line">// Studentå®ä¾‹</span><br><span class="line">const s1 = new Student(&#x27;å¼ åŒå­¦&#x27;,18)</span><br><span class="line">const s2 = new Student(&#x27;æåŒå­¦&#x27;,20)</span><br><span class="line">// Teacherå®ä¾‹</span><br><span class="line">const t1 = new Teacher(&#x27;åˆ˜â½¼å¸ˆ&#x27;,40)</span><br><span class="line">const t2 = new Teacher(&#x27;å­™â½¼å¸ˆ&#x27;,50)</span><br></pre></td></tr></table></figure><p><strong>æŠ½è±¡ç±»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abstract class Person &#123; &#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// Personï¼ˆæŠ½è±¡ç±»ï¼‰</span><br><span class="line">abstract class Person &#123; &#125;</span><br><span class="line"></span><br><span class="line">// Teacherç±»ç»§æ‰¿Person</span><br><span class="line">class Teacher extends Person &#123;</span><br><span class="line"> // æ„é€ å™¨</span><br><span class="line"> constructor(name: string,age: number)&#123;</span><br><span class="line">    super(name,age)</span><br><span class="line"> &#125;</span><br><span class="line"> // â½…æ³•</span><br><span class="line"> speak()&#123;</span><br><span class="line">    console.log(&#x27;ä½ å¥½ï¼æˆ‘æ˜¯â½¼å¸ˆ:&#x27;,this.name)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Studentç±»ç»§æ‰¿Person</span><br><span class="line">class Student extends Person &#123; &#125;</span><br><span class="line">// Personå®ä¾‹</span><br><span class="line">// const p1 = new Person(&#x27;å‘¨æ°ä¼¦&#x27;,38) // æŠ½è±¡ç±»ï¼Œä¸å¯ä»¥new Person</span><br></pre></td></tr></table></figure><h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//é™åˆ¶â¼€ä¸ªç±»ä¸­åŒ…å«å“ªäº›å±æ€§å’Œâ½…æ³•</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// Personæ¥â¼</span><br><span class="line">interface Person &#123;</span><br><span class="line"> // å±æ€§å£°æ˜</span><br><span class="line"> name: string</span><br><span class="line"> age: number</span><br><span class="line"> // â½…æ³•å£°æ˜</span><br><span class="line"> speak():void</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">// Teacherå®ç°Personæ¥â¼</span><br><span class="line">class Teacher implements Person &#123;</span><br><span class="line"> name: string</span><br><span class="line"> age: number</span><br><span class="line"> // æ„é€ å™¨</span><br><span class="line"> constructor(name: string,age: number)&#123;</span><br><span class="line">     this.name = name</span><br><span class="line">     this.age = age</span><br><span class="line"> &#125;</span><br><span class="line"> // â½…æ³•</span><br><span class="line"> speak()&#123;</span><br><span class="line">    console.log(&#x27;ä½ å¥½ï¼æˆ‘æ˜¯â½¼å¸ˆ:&#x27;,this.name)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// æ¥â¼ â€”â€” Personï¼Œåªèƒ½åŒ…å«æŠ½è±¡â½…æ³•</span><br><span class="line">interface Person &#123;</span><br><span class="line"> // å±æ€§ï¼Œä¸å†™å…·ä½“å€¼</span><br><span class="line"> name:string</span><br><span class="line"> age:number</span><br><span class="line"> // â½…æ³•ï¼Œä¸å†™å…·ä½“å®ç°</span><br><span class="line"> speak():void</span><br><span class="line">&#125;</span><br><span class="line">// åˆ›å»ºTeacherç±»å®ç°Personæ¥â¼</span><br><span class="line">class Teacher implements Person &#123;</span><br><span class="line"> name:string</span><br><span class="line"> age:number</span><br><span class="line"> constructor(name:string,age:number)&#123;</span><br><span class="line">     this.name = name</span><br><span class="line">     this.age = age</span><br><span class="line"> &#125;</span><br><span class="line"> speak()&#123;</span><br><span class="line">    console.log(&#x27;æˆ‘åœ¨â»œå¿«çš„â¾â¾›ä¸­......&#x27;)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="file:///C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20250127173649162.png?lastModify=1738423183" alt="image-20250127173649162"></p><h3 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function test&lt;T&gt;(arg: T): T&#123;</span><br><span class="line">    return arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä¸æŒ‡åç±»å‹ï¼ŒTSä¼šâ¾ƒåŠ¨æ¨æ–­å‡ºæ¥</span><br><span class="line">test(10)</span><br><span class="line"></span><br><span class="line">// æŒ‡åå…·ä½“çš„ç±»å‹</span><br><span class="line">test&lt;number&gt;(10)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function test&lt;T, K&gt;(a: T, b: K): K&#123;</span><br><span class="line"> return b;</span><br><span class="line">&#125;</span><br><span class="line">// ä¸ºå¤šä¸ªæ³›å‹æŒ‡å®šå…·ä½“â¾ƒå€¼</span><br><span class="line">test&lt;number, string&gt;(10, &quot;hello&quot;);</span><br></pre></td></tr></table></figure><p><strong>ç±»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class MyClass&lt;T&gt;&#123;</span><br><span class="line"> prop: T;</span><br><span class="line"> constructor(prop: T)&#123;</span><br><span class="line"> this.prop = prop;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³›å‹çº¦æŸ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface Demo&#123;</span><br><span class="line"> length: number;</span><br><span class="line">&#125;</span><br><span class="line">// æ³›å‹Tå¿…é¡»æ˜¯MyInterçš„â¼¦ç±»ï¼Œå³ï¼šå¿…é¡»æ‹¥æœ‰lengthå±æ€§</span><br><span class="line">function test&lt;T extends Demo&gt;(arg: T): number&#123;</span><br><span class="line"> return arg.length;</span><br><span class="line">&#125;</span><br><span class="line">test(10) // ç±»å‹â€œnumberâ€çš„å‚æ•°ä¸èƒ½èµ‹ç»™ç±»å‹â€œDemoâ€çš„å‚æ•°</span><br><span class="line">test(&#123;name:&#x27;å¼ ä¸‰&#x27;&#125;) // ç±»å‹â€œ&#123; name: string; &#125;â€çš„å‚æ•°ä¸èƒ½èµ‹ç»™ç±»å‹â€œDemoâ€çš„å‚æ•°</span><br><span class="line">test(&#x27;123&#x27;)</span><br><span class="line">test(&#123;name:&#x27;å¼ ä¸‰&#x27;,length:10&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¡µé¢é¢„åŠ è½½UIå®ç°</title>
      <link href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/%E9%A1%B5%E9%9D%A2circle%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB/"/>
      <url>/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/%E9%A1%B5%E9%9D%A2circle%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="é¡µé¢circleåŠ è½½åŠ¨ç”»"><a href="#é¡µé¢circleåŠ è½½åŠ¨ç”»" class="headerlink" title="é¡µé¢circleåŠ è½½åŠ¨ç”»"></a>é¡µé¢circleåŠ è½½åŠ¨ç”»</h1><p><img src="/upload/image-20241116165834762.png" alt="image-20241116165834762.png"></p><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;span&gt;loding......&lt;/span&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    padding: 0;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">&#125;</span><br><span class="line">body &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100vh;</span><br><span class="line">    /* border: 10px solid red; */</span><br><span class="line">&#125;</span><br><span class="line">.container &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    align-items: center;</span><br><span class="line">    /* border: 10px solid rgb(0, 132, 255); */</span><br><span class="line">    background-color: black;</span><br><span class="line">&#125;</span><br><span class="line">/* èƒŒæ™¯å½©è‰²åœ†åœˆ */</span><br><span class="line">.circle &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 200px;</span><br><span class="line">    height: 200px;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    align-items: center;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    /* border: 10px solid rgb(0, 255, 170); */</span><br><span class="line">    background-image: linear-gradient(</span><br><span class="line">        0deg,</span><br><span class="line">        rgb(0, 255, 170),</span><br><span class="line">        rgb(0, 17, 255),</span><br><span class="line">        rgb(255, 0, 255)</span><br><span class="line">    );</span><br><span class="line">    /* !!!åŠ¨ç”»!!! */</span><br><span class="line">    animation: rotate 2s linear infinite;</span><br><span class="line">&#125;</span><br><span class="line">/* æ¨¡ç³Š */</span><br><span class="line">.circle::before &#123;</span><br><span class="line">    content: &#x27;&#x27;;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 200px;</span><br><span class="line">    height: 200px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    /* border: 10px solid rgb(0, 255, 170); */</span><br><span class="line">    background-image: linear-gradient(</span><br><span class="line">        0deg,</span><br><span class="line">        rgb(0, 255, 170),</span><br><span class="line">        rgb(0, 17, 255),</span><br><span class="line">        rgb(255, 0, 255)</span><br><span class="line">    );</span><br><span class="line">    filter: blur(35px);</span><br><span class="line">&#125;</span><br><span class="line">/* é»‘åœˆ */</span><br><span class="line">.circle::after &#123;</span><br><span class="line">    content: &#x27;&#x27;;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 180px;</span><br><span class="line">    height: 180px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    background-color: black;</span><br><span class="line">&#125;</span><br><span class="line">/* æ–‡å­— */</span><br><span class="line">span &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    color: rgb(255, 255, 255);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é‡ç‚¹"><a href="#é‡ç‚¹" class="headerlink" title="é‡ç‚¹"></a><em><strong>é‡ç‚¹</strong></em></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">animation: rotate 2s linear infinite;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/* åŠ¨ç”» */</span><br><span class="line">@keyframes rotate &#123;</span><br><span class="line">    0% &#123;</span><br><span class="line">        transform: rotate(0deg);</span><br><span class="line">    &#125;</span><br><span class="line">    100% &#123;</span><br><span class="line">        transform: rotate(360deg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹æ“é¡µé¢é¢„åŠ è½½</title>
      <link href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/%E9%A1%B5%E9%9D%A2%E9%A2%84%E5%8A%A0%E8%BD%BD/"/>
      <url>/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/%E9%A1%B5%E9%9D%A2%E9%A2%84%E5%8A%A0%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="é¡µé¢é¢„åŠ è½½"><a href="#é¡µé¢é¢„åŠ è½½" class="headerlink" title="é¡µé¢é¢„åŠ è½½"></a>é¡µé¢é¢„åŠ è½½</h1><p><strong>æœ¬æ–‡å®ç°äº†</strong></p><p><strong>1.é¢„åŠ è½½è½¬åœˆåŠ¨ç”»+åŠ è½½å®Œæ¯•é”€æ¯ç»„ä»¶</strong></p><p><strong>2.å¼€å±è’™ç‰ˆç‰¹æ•ˆï¼ˆafterèµ„æºåŠ è½½å®Œæ¯•ï¼‰</strong></p><p><strong>3.ä¸»é¡µèƒŒæ™¯å›¾æ¨¡ç³Š+ç¼©æ”¾åŠ¨ç”»ï¼ˆafterèµ„æºåŠ è½½å®Œæ¯•ï¼‰</strong></p><h2 id="ä»£ç ç»“æ„"><a href="#ä»£ç ç»“æ„" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h2><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åŠ è½½åŠ¨ç”» --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;svg&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;circle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>loding......<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é—¨æ¿"><a href="#é—¨æ¿" class="headerlink" title="é—¨æ¿"></a><strong>é—¨æ¿</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é—¨æ¿ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»é¡µé¢"><a href="#ä¸»é¡µé¢" class="headerlink" title="ä¸»é¡µé¢"></a><strong>ä¸»é¡µé¢</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä¸»é¡µé¢ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;page&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://haowallpaper.com/link/common/file/previewFileImg/718a61f6cd6efa803ca87eb743fec045718a61f6cd6efa803ca87eb743fec045&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h3 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h3><h4 id="é¢„åŠ è½½å·¥å…·"><a href="#é¢„åŠ è½½å·¥å…·" class="headerlink" title="é¢„åŠ è½½å·¥å…·"></a><strong>é¢„åŠ è½½å·¥å…·</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://libs.baidu.com/jquery/1.8.3/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="åŠ¨æ€æ›´æ–°"><a href="#åŠ¨æ€æ›´æ–°" class="headerlink" title="åŠ¨æ€æ›´æ–°"></a><strong>åŠ¨æ€æ›´æ–°</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="variable constant_">JS</span>åŠ¨æ€æ›´æ–° --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> left = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.left&#x27;</span>)  <span class="comment">//å·¦é—¨</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> right = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.right&#x27;</span>)<span class="comment">//å³é—¨</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> page = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.page&#x27;</span>)  <span class="comment">//è·å–å›¾ç‰‡å¯¹è±¡</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $(<span class="variable language_">window</span>).<span class="title function_">on</span>(<span class="string">&#x27;load&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        $(<span class="string">&#x27;.svg&#x27;</span>).<span class="title function_">animate</span>(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">opacity</span>: <span class="number">0</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="number">500</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        )</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            $(<span class="string">&#x27;.svg&#x27;</span>).<span class="title function_">remove</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">//removeç»„ä»¶lodingåæ‰§è¡Œ</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">//é—¨æ¿å¼€å±åŠ¨æ€</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                left.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateX(-60vw)`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                right.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateX(60vw)`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">//æ¨¡ç³Š/æ”¾ç¼©èƒŒæ™¯å›¾ç‰‡æ•ˆæœ</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                page.<span class="property">style</span>.<span class="property">animation</span> = <span class="string">`blur-to-clear 2s cubic-bezier(0.62, 0.21, 0.25, 1) 0s 1</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                        normal backwards running,scale 2s cubic-bezier(0.62, 0.21, 0.25, 1) 0s 1 both`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;, <span class="number">200</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;, <span class="number">500</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><h4 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a><strong>å…¨å±€é…ç½®</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/* å–æ¶ˆæ»šåŠ¨æ¡ */</span></span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠ¨ç”»å‡½æ•°"><a href="#åŠ¨ç”»å‡½æ•°" class="headerlink" title="åŠ¨ç”»å‡½æ•°"></a><strong>åŠ¨ç”»å‡½æ•°</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* åŠ¨ç”» */</span></span><br><span class="line"><span class="keyword">@keyframes</span> rotate &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ¨¡ç³ŠåŠ¨ç”» */</span></span><br><span class="line"><span class="keyword">@keyframes</span> blur-to-clear &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">35px</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">0px</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* å›¾ç‰‡å¤§å°å˜åŒ–åŠ¨ç”» */</span></span><br><span class="line"><span class="keyword">@keyframes</span> scale &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŒ…è£¹åŠ è½½çš„æ ·å¼svgï¼ˆlodingåå»é™¤ï¼‰"><a href="#åŒ…è£¹åŠ è½½çš„æ ·å¼svgï¼ˆlodingåå»é™¤ï¼‰" class="headerlink" title="åŒ…è£¹åŠ è½½çš„æ ·å¼svgï¼ˆlodingåå»é™¤ï¼‰"></a><strong>åŒ…è£¹åŠ è½½çš„æ ·å¼svgï¼ˆlodingåå»é™¤ï¼‰</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.svg</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">999</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸»é¡µèƒŒæ™¯"><a href="#ä¸»é¡µèƒŒæ™¯" class="headerlink" title="ä¸»é¡µèƒŒæ™¯"></a><strong>ä¸»é¡µèƒŒæ™¯</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span><span class="selector-class">.page</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">1080px</span>;</span><br><span class="line">    <span class="attribute">transition</span>: opacity <span class="number">1s</span>;</span><br><span class="line">    <span class="comment">/* èƒŒæ™¯å›¾ç‰‡å˜åŒ–åŠ¨ç”»(å·²å­˜å…¥JS) */</span></span><br><span class="line">    <span class="comment">/* animation: blur-to-clear 2s cubic-bezier(0.62, 0.21, 0.25, 1) 0s 1</span></span><br><span class="line"><span class="comment">    normal backwards running,</span></span><br><span class="line"><span class="comment">    scale 2s cubic-bezier(0.62, 0.21, 0.25, 1) 0s 1 both; */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠ è½½åœ†åœˆæ ·å¼"><a href="#åŠ è½½åœ†åœˆæ ·å¼" class="headerlink" title="åŠ è½½åœ†åœˆæ ·å¼"></a><strong>åŠ è½½åœ†åœˆæ ·å¼</strong></h4><p><strong>è¯¦ç»†æ‹†åˆ†è§æ–‡ç« â€œé¡µé¢circleåŠ è½½åŠ¨ç”»â€</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="comment">/* border: 10px solid rgb(0, 132, 255); */</span></span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.circle</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="comment">/* border: 10px solid rgb(0, 255, 170); */</span></span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">0deg</span>,</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">170</span>),</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">17</span>, <span class="number">255</span>),</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">/* åŠ¨ç”» */</span></span><br><span class="line">    <span class="attribute">animation</span>: rotate <span class="number">2s</span> linear infinite;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* æ¨¡ç³Š */</span></span><br><span class="line"><span class="selector-class">.circle</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="comment">/* border: 10px solid rgb(0, 255, 170); */</span></span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">0deg</span>,</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">170</span>),</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">17</span>, <span class="number">255</span>),</span><br><span class="line">        <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">35px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* é»‘åœˆ */</span></span><br><span class="line"><span class="selector-class">.circle</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">180px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">180px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="comment">/* filter: blur(35px); */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¼€å±é—¨æ¿"><a href="#å¼€å±é—¨æ¿" class="headerlink" title="å¼€å±é—¨æ¿"></a><strong>å¼€å±é—¨æ¿</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">998</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: center center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">998</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50vw</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50vw</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="attribute">transition</span>: transform <span class="number">1s</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: center center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vueç»„ä»¶é€šä¿¡</title>
      <link href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/Vue%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/"/>
      <url>/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/Vue%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="ç»„ä»¶é€šä¿¡"><a href="#ç»„ä»¶é€šä¿¡" class="headerlink" title="ç»„ä»¶é€šä¿¡"></a>ç»„ä»¶é€šä¿¡</h2><h3 id="çˆ¶å­åŒä¼ "><a href="#çˆ¶å­åŒä¼ " class="headerlink" title="çˆ¶å­åŒä¼ "></a>çˆ¶å­åŒä¼ </h3><h5 id="props"><a href="#props" class="headerlink" title="props"></a>props</h5><p><strong>çˆ¶ä¼ å­</strong></p><p><img src="/upload/image-20240825201917435-ppsw.png" alt="image-20240825201917435-ppsw.png"></p><p><strong>å­ä¼ çˆ¶</strong></p><p><img src="/upload/image-20240825203836739-eekr.png" alt="image-20240825203836739-eekr.png"></p><h5 id="v-modelï¼ˆåŒå‘ç»‘å®šï¼‰"><a href="#v-modelï¼ˆåŒå‘ç»‘å®šï¼‰" class="headerlink" title="v-modelï¼ˆåŒå‘ç»‘å®šï¼‰"></a>v-modelï¼ˆåŒå‘ç»‘å®šï¼‰</h5><p><strong>è¡¨å•</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//ç”¨åœ¨htmlæ ‡ç­¾</span><br><span class="line">&lt;input type=&quot;text&quot; v-model=&quot;username&quot;&gt;</span><br><span class="line"></span><br><span class="line">//ç”¨åœ¨ç»„ä»¶æ ‡ç­¾ä¸Š</span><br><span class="line">&lt;ç»„ä»¶ v-model=&quot;username&quot;/&gt;</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240826134133823-jtfn.png" alt="image-20240826134133823-jtfn.png"></p><p><img src="/upload/image-20240826134643288-wved.png" alt="image-20240826134643288-wved.png"></p><h3 id="çˆ¶ä¼ å­"><a href="#çˆ¶ä¼ å­" class="headerlink" title="çˆ¶ä¼ å­"></a>çˆ¶ä¼ å­</h3><h5 id="refs"><a href="#refs" class="headerlink" title="$refs"></a>$refs</h5><p><strong>æ”¹å˜å­çš„ç©å…·</strong></p><p><img src="/upload/image-20240826163102996-vnxq.png" alt="image-20240826163102996-vnxq.png"></p><p><strong>è®©æ‰€æœ‰å­çš„ä¹¦å˜å¤š</strong></p><p><img src="/upload/image-20240826161006792-cmyw.png" alt="image-20240826161006792-cmyw.png"></p><h5 id="é»˜è®¤æ’æ§½"><a href="#é»˜è®¤æ’æ§½" class="headerlink" title="é»˜è®¤æ’æ§½"></a>é»˜è®¤æ’æ§½</h5><p><img src="/upload/image-20240826214619312-wydc.png" alt="image-20240826214619312-wydc.png"></p><p><img src="/upload/image-20240826214724976-nytt.png" alt="image-20240826214724976-nytt.png"></p><h5 id="å…·åæ’æ§½"><a href="#å…·åæ’æ§½" class="headerlink" title="å…·åæ’æ§½"></a>å…·åæ’æ§½</h5><p><img src="/upload/image-20240826221750773-jrvs.png" alt="image-20240826221750773-jrvs.png"></p><h3 id="å­ä¼ çˆ¶"><a href="#å­ä¼ çˆ¶" class="headerlink" title="å­ä¼ çˆ¶"></a>å­ä¼ çˆ¶</h3><h5 id="è‡ªå®šä¹‰"><a href="#è‡ªå®šä¹‰" class="headerlink" title="è‡ªå®šä¹‰"></a>è‡ªå®šä¹‰</h5><p><strong>çˆ¶ç»„ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Child @send-toy=&quot;toy = $event&quot;/&gt;</span><br></pre></td></tr></table></figure><p><strong>å­ç»„ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.$emit(&#x27;send-toy&#x27;, å…·ä½“æ•°æ®)</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240825212202117-gpof.png" alt="image-20240825212202117-gpof.png"></p><h5 id="parent"><a href="#parent" class="headerlink" title="$parent"></a>$parent</h5><p><strong>å‡å°‘çˆ¶çš„æˆ¿äº§</strong></p><p><img src="/upload/image-20240826162719642-svvx.png" alt="image-20240826162719642-svvx.png"></p><h5 id="ä½œç”¨åŸŸæ’æ§½"><a href="#ä½œç”¨åŸŸæ’æ§½" class="headerlink" title="ä½œç”¨åŸŸæ’æ§½"></a>ä½œç”¨åŸŸæ’æ§½</h5><p><strong>params ä½œä¸ºå¯¹è±¡</strong></p><p><img src="/upload/image-20240827151102500-ymag.png" alt="image-20240827151102500-ymag.png"></p><p><img src="/upload/image-20240827151700297-slyx.png" alt="image-20240827151700297-slyx.png"></p><h3 id="ç¥–ä¼ å­™"><a href="#ç¥–ä¼ å­™" class="headerlink" title="ç¥–ä¼ å­™"></a>ç¥–ä¼ å­™</h3><h5 id="attrs"><a href="#attrs" class="headerlink" title="$attrs"></a>$attrs</h5><p><img src="/upload/image-20240826144203197-vibc.png" alt="image-20240826144203197-vibc.png"></p><h5 id="provideï¼ˆé…-injectï¼‰"><a href="#provideï¼ˆé…-injectï¼‰" class="headerlink" title="provideï¼ˆé… injectï¼‰"></a>provideï¼ˆé… injectï¼‰</h5><p><img src="/upload/image-20240826172233626-cazp.png" alt="image-20240826172233626-cazp.png"></p><h3 id="å­™ä¼ ç»„"><a href="#å­™ä¼ ç»„" class="headerlink" title="å­™ä¼ ç»„"></a>å­™ä¼ ç»„</h3><h5 id="injectï¼ˆé…-providï¼‰"><a href="#injectï¼ˆé…-providï¼‰" class="headerlink" title="injectï¼ˆé… providï¼‰"></a>injectï¼ˆé… providï¼‰</h5><p><img src="/upload/image-20240826172226760-ueqn.png" alt="image-20240826172226760-ueqn.png"></p><h3 id="å…„å¼Ÿä¼ "><a href="#å…„å¼Ÿä¼ " class="headerlink" title="å…„å¼Ÿä¼ "></a>å…„å¼Ÿä¼ </h3><h5 id="mitt"><a href="#mitt" class="headerlink" title="mitt"></a>mitt</h5><p><strong>å®‰è£…</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mitt</span><br></pre></td></tr></table></figure><p><strong>&#x2F;utils&#x2F;emitter</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//å¼•å…¥mitt</span><br><span class="line">import mitt from &#x27;mitt&#x27;</span><br><span class="line"></span><br><span class="line">// è°ƒç”¨mittå¾—åˆ°emitterï¼Œemitterèƒ½ï¼šç»‘å®šäº‹ä»¶ã€è§¦å‘äº‹ä»¶</span><br><span class="line">const emitter = mitt()</span><br><span class="line"></span><br><span class="line">// æš´éœ²emitter</span><br><span class="line">export default emitter</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//ç»‘å®šäº‹ä»¶</span><br><span class="line">emitter.on(&#x27;text&#x27;,()=&gt;&#123;&#125;)</span><br><span class="line">//è§¦å‘äº‹ä»¶</span><br><span class="line">emmiter.emit(&#x27;text&#x27;)</span><br><span class="line">//è§£ç»‘äº‹ä»¶</span><br><span class="line">emmiter.off(&#x27;text&#x27;)</span><br><span class="line">//å…¨éƒ¨è§£ç»‘</span><br><span class="line">emmiter.all.clear()</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20240826131941301-xtro.png" alt="image-20240826131941301-xtro.png"></p><h3 id="ä»»æ„ä¼ "><a href="#ä»»æ„ä¼ " class="headerlink" title="ä»»æ„ä¼ "></a>ä»»æ„ä¼ </h3><h5 id="pinia"><a href="#pinia" class="headerlink" title="pinia"></a>pinia</h5><p><strong>æ­å»º</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia</span><br></pre></td></tr></table></figure><p><strong>main.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &#x27;vue&#x27;</span><br><span class="line">import App from &#x27;./App.vue&#x27;</span><br><span class="line"></span><br><span class="line">/* å¼•å…¥createPiniaï¼Œç”¨äºåˆ›å»ºpinia */</span><br><span class="line">import &#123; createPinia &#125; from &#x27;pinia&#x27;</span><br><span class="line"></span><br><span class="line">/* åˆ›å»ºpinia */</span><br><span class="line">const pinia = createPinia()</span><br><span class="line">const app = createApp(App)</span><br><span class="line"></span><br><span class="line">/* ä½¿ç”¨æ’ä»¶ */&#123;&#125;</span><br><span class="line">app.use(pinia)</span><br><span class="line">app.mount(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure><p><strong>&#x2F;stores&#x2F;first.ts</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123;defineStore&#125; from &quot;pinia&quot;;</span><br><span class="line"></span><br><span class="line">import &#123;ref&#125; from &quot;vue&quot;</span><br><span class="line"></span><br><span class="line">export default defineStore(&#x27;first&#x27;,()=&gt;&#123;//åˆ›å»ºè‡ªå·±çš„ä»“åº“</span><br><span class="line">    const name = ref(&#x27;pinia&#x27;);</span><br><span class="line"></span><br><span class="line">    return &#123;name&#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>App.vue</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    import useFristStore from &quot;./stores/first&quot;</span><br><span class="line">    const store = useFirstStore();//è‡ªå·±çš„ä»“åº“</span><br><span class="line">    console.log(store.name);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vueè·¯ç”±</title>
      <link href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/Vue%E8%B7%AF%E7%94%B1/"/>
      <url>/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/Vue%E8%B7%AF%E7%94%B1/</url>
      
        <content type="html"><![CDATA[<h2 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h2><p><img src="/upload/image-20240829155453971.png" alt="image-20240829155453971.png"></p><ul><li><p><code>router/index.ts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import &#123; creatRouter, createWebHistory &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import è‡ªå®šä¹‰å1 from &#x27;../pages/ç»„ä»¶1.vue&#x27;</span><br><span class="line">import è‡ªå®šä¹‰å2 from &#x27;../pages/ç»„ä»¶2.vue&#x27;</span><br><span class="line"></span><br><span class="line">export default createRouter(&#123;</span><br><span class="line">    history: createWebHistory(),</span><br><span class="line">    routes:[</span><br><span class="line">        &#123;</span><br><span class="line">            path:&#x27;/è‡ªå®šä¹‰è·¯ç”±å1&#x27;</span><br><span class="line">            component:/è‡ªå®šä¹‰å1,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            path:&#x27;/è‡ªå®šä¹‰è·¯ç”±å2&#x27;</span><br><span class="line">            component:/è‡ªå®šä¹‰å2,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><code>App.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;......&quot;&gt;</span><br><span class="line">        &lt;!-- å¯¼èˆªåŒº --&gt;</span><br><span class="line">        &lt;router-link active-class=&quot;active&quot; class=&quot;...&quot; to=&quot;/props&quot;&gt;1. props&lt;/router-link&gt;</span><br><span class="line">        &lt;router-link active-class=&quot;active&quot; class=&quot;...&quot; to=&quot;/event&quot;&gt;2. è‡ªå®šä¹‰äº‹ä»¶&lt;/router-link&gt;</span><br><span class="line">        ......</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;......&quot;&gt;</span><br><span class="line">        &lt;!-- å ä½ä¸€ä¸ªå±•ç¤ºåŒº --&gt;</span><br><span class="line">        &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot; name=&quot;App&quot;&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>main.ts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &#x27;vue&#x27;</span><br><span class="line">import App from &#x27;./App.vue&#x27;</span><br><span class="line">import &#123; createPinia &#125; from &#x27;pinia&#x27;</span><br><span class="line">import router from &#x27;./router/index&#x27;</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºåº”ç”¨</span><br><span class="line">const app = createApp(App)</span><br><span class="line">// åˆ›å»ºpinia</span><br><span class="line">const pinia = createPinia()</span><br><span class="line"></span><br><span class="line">// å®‰è£…æ’ä»¶</span><br><span class="line">app.use(pinia)</span><br><span class="line">// å®‰è£…è·¯ç”±å™¨</span><br><span class="line">app.use(router)</span><br><span class="line">// æŒ‚è½½åº”ç”¨</span><br><span class="line">app.mount(&#x27;#app&#x27;)//ä½¿ç”¨.mount()æ–¹æ³•å°†åº”ç”¨æŒ‚è½½åˆ°idä¸º&#x27;app&#x27;çš„å…ƒç´ ä¸Š</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ScssåŸºç¡€</title>
      <link href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/Scss/"/>
      <url>/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/Scss/</url>
      
        <content type="html"><![CDATA[<h1 id="Scss"><a href="#Scss" class="headerlink" title="Scss"></a>Scss</h1><p><strong>Sassä½¿ç”¨Rubyè¯­æ³• : *<em><strong>æ²¡æœ‰èŠ±æ‹¬å·</strong>ï¼Œ<strong>æ²¡æœ‰åˆ†å·</strong>ï¼Œå…·æœ‰</em>*ä¸¥æ ¼çš„ç¼©è¿›</strong></p><h2 id="åŸºç¡€ä½¿ç”¨"><a href="#åŸºç¡€ä½¿ç”¨" class="headerlink" title="åŸºç¡€ä½¿ç”¨"></a>åŸºç¡€ä½¿ç”¨</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install -D sass sass-loader</span><br></pre></td></tr></table></figure><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><p><strong>define.scss ï¼ˆä¸€èˆ¬æ”¾åœ¨srcä¸­çš„stylesæ–‡ä»¶å¤¹ä¸­ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$--primary-color: #123456;</span><br><span class="line">$white-color:$--primary-color-green !default;//è¿™ä¸ªé»˜è®¤å€¼çš„ä¼˜å…ˆçº§é™åˆ°äº†æœ€ä½ï¼Œå½“æ²¡æœ‰å…¶å®ƒåœ°æ–¹èµ‹å€¼æ—¶å€™ï¼Œæ‰ä¼šé€‰æ‹©é»˜è®¤å€¼</span><br></pre></td></tr></table></figure><p><strong>vueç»„ä»¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;style scoped lang=&quot;scss&quot;&gt;</span><br><span class="line">@import &#x27;@/styles/define.scss&#x27;;</span><br><span class="line">    .box&#123;</span><br><span class="line">        color:$--primary-color;</span><br><span class="line">        background-color:$white-color;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="mixin"><a href="#mixin" class="headerlink" title="@mixin"></a>@mixin</h3><p><strong>å¯ä»¥å®šä¹‰ä¸€æ®µä»£ç ä½œä¸ºæ¨¡æ¿æ ·å¼</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@mixin border-radius($radius: 5px, $borderRadius: 8px) &#123;//å¯ä»¥æ¥æ”¶ä¼ å…¥çš„å‚æ•°</span><br><span class="line">  border: &#123;</span><br><span class="line">    radius: $radius;</span><br><span class="line">    top: $borderRadius solid #ff0;</span><br><span class="line">    bottom: $borderRadius solid #f00;</span><br><span class="line">    left: $borderRadius solid #00f;</span><br><span class="line">    right: $borderRadius solid #888;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@include border-radius(5px, 1px);//ä¼ å…¥å‚æ•°ï¼Œè¿”å›è®¡ç®—å¥½çš„æ ·å¼</span><br></pre></td></tr></table></figure><h3 id="extend"><a href="#extend" class="headerlink" title="@extend"></a>@extend</h3><p><strong>ç»§æ‰¿å…¶å®ƒä»£ç æ®µ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@mixin btn($width: 50px, $height: 20px, $font-size: 16px) &#123;</span><br><span class="line">  width: $width;</span><br><span class="line">  height: $height;</span><br><span class="line">  font-size: $font-size;</span><br><span class="line">  text-align: center;</span><br><span class="line">  line-height: $height;</span><br><span class="line">  @include border-radius(5px, 1px);</span><br><span class="line">  &amp;:hover &#123;</span><br><span class="line">    opacity: 0.8;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">.btn &#123;</span><br><span class="line">  @include btn(80px, 30px, 12px);</span><br><span class="line">  margin: &#123;</span><br><span class="line">    top: 10px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">.btn-primary &#123;</span><br><span class="line">  @extend .btn;//ç»§æ‰¿åˆ°äº†btnçš„æ ·å¼</span><br><span class="line">  background-color: $light-blue;</span><br><span class="line">  color: $fontColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Viteé…ç½®scss"><a href="#Viteé…ç½®scss" class="headerlink" title="Viteé…ç½®scss"></a>Viteé…ç½®scss</h2><p><strong>é…ç½®vite.config.ts</strong></p><p>é¡ºä¾¿æŠŠ@åˆ«åè·¯å¾„éƒ½é…ç½®å¥½äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; fileURLToPath &#125; from &#x27;url&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">export default defineConfig(&#123;</span><br><span class="line">    plugins: [vue()],</span><br><span class="line">    css: &#123;</span><br><span class="line">        preprocessorOptions: &#123;</span><br><span class="line">            scss: &#123;</span><br><span class="line">                additionalData: &#x27;@import &quot;@/styles/define.scss&quot;;&#x27;,</span><br><span class="line">                javascriptEnabled: true,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">            &#x27;@&#x27;: fileURLToPath(new URL(&#x27;./src&#x27;, import.meta.url)),</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åˆè¯†gridå¸ƒå±€</title>
      <link href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/grid%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80/"/>
      <url>/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/grid%E7%BD%91%E6%A0%BC%E5%B8%83%E5%B1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="CSSå®šä½å…ƒç´ "><a href="#CSSå®šä½å…ƒç´ " class="headerlink" title="CSSå®šä½å…ƒç´ "></a>CSSå®šä½å…ƒç´ </h1><p><img src="/upload/image-20241110163644817.png" alt="image-20241110163644817.png"></p><h1 id="gridç½‘æ ¼å¸ƒå±€"><a href="#gridç½‘æ ¼å¸ƒå±€" class="headerlink" title="gridç½‘æ ¼å¸ƒå±€"></a>gridç½‘æ ¼å¸ƒå±€</h1><p><strong>æ–°çš„é•¿åº¦å•ä½ï¼šfr</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸€èˆ¬æ¥è¯´ 1fr çš„æ„æ€æ˜¯â€œ100%çš„å‰©ä½™ç©ºé—´â€, .25fr æ„å‘³ç€â€œ25%çš„å‰©ä½™ç©ºé—´â€ã€‚å½“æ—¶å½“ fr å¤§äº 1 çš„æ—¶å€™ï¼Œåˆ™ä¼šé‡æ–°è®¡ç®—æ¯”ä¾‹æ¥åˆ†é…ã€‚</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110161821264.png" alt="image-20241110161821264.png"></p><h3 id="gridå¸ƒå±€"><a href="#gridå¸ƒå±€" class="headerlink" title="gridå¸ƒå±€"></a>gridå¸ƒå±€</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display: grid;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grid-template-columns: 1fr 1fr 1fr 1fr;</span><br></pre></td></tr></table></figure><p><strong>ç­‰ä»·äºï¼ˆrepeatï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grid-template-columns: repeat(4, 1fr);</span><br><span class="line">grid-template-columns: repeat(4, .25fr);</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬éƒ½å»ºè®®ä½¿ç”¨ **<code>fr&gt;=1</code> çš„æƒ…å†µ</p><h3 id="å“åº”å¼è®¾è®¡"><a href="#å“åº”å¼è®¾è®¡" class="headerlink" title="å“åº”å¼è®¾è®¡"></a>å“åº”å¼è®¾è®¡</h3><p>è¿™é‡Œ <code>A</code> å’Œ <code>D</code> éƒ½æ˜¯å›ºå®šçš„ <code>50px</code>ï¼Œ<code>C</code> æ˜¯å æ€»å®½åº¦çš„ <code>20%</code>ï¼Œå‰©ä½™ç©ºé—´å°±å¯ä»¥åˆ†é…ç»™ <code>B</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.grid-container &#123;</span><br><span class="line">  grid-template-columns: 50px 1fr 20% 50px;</span><br><span class="line">  column-gap: 10px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110161302301.png" alt="image-20241110161302301.png"></p><h3 id="èˆ¹æ–°ç”¨æ³•"><a href="#èˆ¹æ–°ç”¨æ³•" class="headerlink" title="èˆ¹æ–°ç”¨æ³•"></a>èˆ¹æ–°ç”¨æ³•</h3><p><strong>3*3çš„ç½‘æ ¼</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//ç½‘æ ¼å¸ƒå±€</span><br><span class="line">.face &#123;</span><br><span class="line">    display: grid;</span><br><span class="line">    grid-template-rows:repeat(3,1fr);</span><br><span class="line">    grid-template-columns: repeat(3,lfr);</span><br><span class="line">    grid-template-areas:</span><br><span class="line">        &quot;lt . rt&quot;</span><br><span class="line">        &quot;lc cc rc&quot;</span><br><span class="line">        &quot;lb . rb&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//è§„åˆ’å—å¸ƒå±€</span><br><span class="line">.lt-dot&#123;</span><br><span class="line">    grid-area: lt;</span><br><span class="line">&#125;</span><br><span class="line">.lr-dot&#123;</span><br><span class="line">    grid-area: lr;</span><br><span class="line">&#125;</span><br><span class="line">.lc-dot&#123;</span><br><span class="line">    grid-area: lc;</span><br><span class="line">&#125;</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110163133135.png" alt="image-20241110163133135.png"></p><h3 id="ç›¸æ¯”Flex"><a href="#ç›¸æ¯”Flex" class="headerlink" title="ç›¸æ¯”Flex"></a>ç›¸æ¯”Flex</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Flexæ˜¯ä¸€ç»´å¸ƒå±€ï¼ŒGridæ˜¯äºŒç»´</span><br><span class="line">æµè§ˆå™¨å¯¹Flexçš„å…¼å®¹æ€§æ›´å¥½</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Gridé€‚ç”¨äºå¤§é¢ç§¯çš„æ•´ä½“å¸ƒå±€</span><br><span class="line">å°é¢ç§¯ç»„ä»¶Flexæ›´çµæ´»</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>gridå¸ƒå±€å®æˆ˜</title>
      <link href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/grid+transform%E5%AE%9E%E7%8E%B0%E9%A1%B5%E9%9D%A23D%E9%AA%B0%E5%AD%90/"/>
      <url>/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/grid+transform%E5%AE%9E%E7%8E%B0%E9%A1%B5%E9%9D%A23D%E9%AA%B0%E5%AD%90/</url>
      
        <content type="html"><![CDATA[<h1 id="grid-transformå®ç°é¡µé¢3Déª°å­"><a href="#grid-transformå®ç°é¡µé¢3Déª°å­" class="headerlink" title="grid+transformå®ç°é¡µé¢3Déª°å­"></a>grid+transformå®ç°é¡µé¢3Déª°å­</h1><h2 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h2><h3 id="transform"><a href="#transform" class="headerlink" title="transform"></a><em>transform</em></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform-style: preserve-3d;/*æ‰€æœ‰å­å…ƒç´ åœ¨3Dç©ºé—´ä¸­å‘ˆç°*/</span><br></pre></td></tr></table></figure><h3 id="åç§»"><a href="#åç§»" class="headerlink" title="åç§»"></a><em><strong>åç§»</strong></em></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: translateX(90px) translateY(90px) translateZ(90px);/*å·¦å³ ä¸‹ä¸Š å‰å*/</span><br></pre></td></tr></table></figure><h3 id="æ—‹è½¬"><a href="#æ—‹è½¬" class="headerlink" title="æ—‹è½¬"></a><em><strong>æ—‹è½¬</strong></em></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110201517099.png" alt="image-20241110201517099.png"></p><h2 id="å®æˆ˜æ•ˆæœ"><a href="#å®æˆ˜æ•ˆæœ" class="headerlink" title="å®æˆ˜æ•ˆæœ"></a><strong>å®æˆ˜æ•ˆæœ</strong></h2><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;wrap&quot; id=&quot;dice&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid first-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot cc-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid second-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid third-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot cc-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid forth-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot lb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid fifth-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot lb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot cc-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rt-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;face face-grid sixth-face&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;dot lt-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot lc-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot lb-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rt-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rc-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;dot rb-dot red&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h5 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">container                       //å¤–å±‚å ä½å®¹å™¨</span><br><span class="line">    wrap / dice                 //æ§åˆ¶æ—‹è½¬</span><br><span class="line">        face / face-grid * 6    //é¢</span><br><span class="line">            dot / red           //ç‚¹</span><br></pre></td></tr></table></figure><h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><h5 id="box-sizing"><a href="#box-sizing" class="headerlink" title="box-sizing"></a><strong>box-sizing</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">div &#123;</span><br><span class="line">    box-sizing: border-box;/*å…ƒç´ çš„widthå’ŒheightåŒ…æ‹¬contentã€paddingå’Œborderçš„å®½åº¦ï¼Œä½†ä¸åŒ…æ‹¬margin*/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ¸å˜è¾¹æ¡†æŠ€æœ¯åšé¢"><a href="#æ¸å˜è¾¹æ¡†æŠ€æœ¯åšé¢" class="headerlink" title="æ¸å˜è¾¹æ¡†æŠ€æœ¯åšé¢"></a><strong>æ¸å˜è¾¹æ¡†æŠ€æœ¯åšé¢</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.face &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 120px;</span><br><span class="line">    height: 120px;</span><br><span class="line">    padding: 20px;/*w/h/péƒ½åŒ…è£¹è¾¹æ¡†çš„å®½åº¦ï¼Œæ˜¯ä»è¾¹æ¡†çš„æœ€é‡Œå¾€é‡Œpadding*/</span><br><span class="line">    opacity: 0.95;</span><br><span class="line">    border: 8px solid transparent; /*8pxçš„é€æ˜è¾¹æ¡†ï¼Œå°±æ˜¯æ¸å˜è¾¹æ¡†çš„å®½åº¦*/</span><br><span class="line">    background-clip: padding-box, border-box;/*å¿…è¦çš„ä¸¤é¡¹*/</span><br><span class="line">    background-origin: padding-box, border-box;/*å¿…è¦çš„ä¸¤é¡¹*/</span><br><span class="line">    background-image: </span><br><span class="line">        linear-gradient(135deg, #e1eeffbb, #f3d5ffbb),</span><br><span class="line">        linear-gradient(135deg, rgb(0, 60, 255), rgb(0, 225, 255), #f0f);/*æ¸å˜è§’åº¦+æ¸å˜é¢œè‰²*/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="gridåšç‚¹ï¼ˆface-gridï¼‰"><a href="#gridåšç‚¹ï¼ˆface-gridï¼‰" class="headerlink" title="gridåšç‚¹ï¼ˆface-gridï¼‰"></a><strong>gridåšç‚¹ï¼ˆface-gridï¼‰</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">.face-grid &#123;</span><br><span class="line">    /*éª°å­ç‚¹æ•°å¸ƒå±€*/</span><br><span class="line">    display: grid;</span><br><span class="line">    grid-template-rows: repeat(3, 1fr);/*è¡Œ*/</span><br><span class="line">    grid-template-columns: repeat(3, 1fr);/*åˆ—*/</span><br><span class="line">    grid-template-areas:</span><br><span class="line">        &#x27;lt . rt&#x27;</span><br><span class="line">        &#x27;lc cc rc&#x27;</span><br><span class="line">        &#x27;lb . rb&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">.lt-dot &#123;</span><br><span class="line">    grid-area: lt;</span><br><span class="line">&#125;</span><br><span class="line">.rt-dot &#123;</span><br><span class="line">    grid-area: rt;</span><br><span class="line">&#125;</span><br><span class="line">.lc-dot &#123;</span><br><span class="line">    grid-area: lc;</span><br><span class="line">&#125;</span><br><span class="line">.cc-dot &#123;</span><br><span class="line">    grid-area: cc;</span><br><span class="line">&#125;</span><br><span class="line">.rc-dot &#123;</span><br><span class="line">    grid-area: rc;</span><br><span class="line">&#125;</span><br><span class="line">.lb-dot &#123;</span><br><span class="line">    grid-area: lb;</span><br><span class="line">&#125;</span><br><span class="line">.rb-dot &#123;</span><br><span class="line">    grid-area: rb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ç‚¹çŠ¶æ ·å¼ï¼ˆdot-redï¼‰"><a href="#ç‚¹çŠ¶æ ·å¼ï¼ˆdot-redï¼‰" class="headerlink" title="ç‚¹çŠ¶æ ·å¼ï¼ˆdot&#x2F;redï¼‰"></a><strong>ç‚¹çŠ¶æ ·å¼ï¼ˆdot&#x2F;redï¼‰</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.dot &#123;/*é»‘ç‚¹*/</span><br><span class="line">    display: inline-block;</span><br><span class="line">    width: 25px;</span><br><span class="line">    height: 25px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    background-color: #1759af;</span><br><span class="line">&#125;</span><br><span class="line">.red &#123;/*çº¢ç‚¹ï¼ˆç»§æ‰¿é»‘ç‚¹å±æ€§ï¼‰*/</span><br><span class="line">    background-color: rgb(162, 0, 211);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åç§»-æ—‹è½¬é¢"><a href="#åç§»-æ—‹è½¬é¢" class="headerlink" title="åç§»+æ—‹è½¬é¢"></a><strong>åç§»+æ—‹è½¬é¢</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1é¢ï¼ˆå‰ï¼‰ å‰ç§» 50%è¾¹é•¿</span><br><span class="line">6é¢ï¼ˆåï¼‰ åç§» 50%è¾¹é•¿</span><br><span class="line">2é¢ï¼ˆå·¦ï¼‰ å·¦ç§» 50%è¾¹é•¿ + Y 90deg</span><br><span class="line">3é¢ï¼ˆå³ï¼‰ å³ç§» 50%è¾¹é•¿ + Y 90deg</span><br><span class="line">5é¢ï¼ˆä¸Šï¼‰ ä¸Šç§» 50%è¾¹é•¿ + X 90deg</span><br><span class="line">4é¢ï¼ˆä¸‹ï¼‰ ä¸‹ç§» 50%è¾¹é•¿ + X 90deg</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.first-face &#123;</span><br><span class="line">    transform: translateZ(60px);</span><br><span class="line">&#125;</span><br><span class="line">.second-face &#123;</span><br><span class="line">    transform: translateX(-60px) rotateY(90deg);</span><br><span class="line">&#125;</span><br><span class="line">.third-face &#123;</span><br><span class="line">    transform: translateX(50%) rotateY(90deg);</span><br><span class="line">&#125;</span><br><span class="line">.forth-face &#123;</span><br><span class="line">    transform: translateY(50%) rotateX(90deg);</span><br><span class="line">&#125;</span><br><span class="line">.fifth-face &#123;</span><br><span class="line">    transform: translateY(-50%) rotateX(90deg);</span><br><span class="line">&#125;</span><br><span class="line">.sixth-face &#123;</span><br><span class="line">    transform: translateZ(-60px);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a><strong>æ•ˆæœå›¾</strong></h5><p><img src="/upload/image-20241115172203521.png" alt="image-20241115172203521.png"></p><h5 id="åŠ ç‚¹åŠ¨æ•ˆï¼ˆCSS-hoverï¼‰"><a href="#åŠ ç‚¹åŠ¨æ•ˆï¼ˆCSS-hoverï¼‰" class="headerlink" title="åŠ ç‚¹åŠ¨æ•ˆï¼ˆCSS_hoverï¼‰"></a><strong>åŠ ç‚¹åŠ¨æ•ˆï¼ˆCSS_hoverï¼‰</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.wrap:hover &#123;</span><br><span class="line">    transform: rotateX(300deg) rotateY(0deg) rotateZ(100deg) !important;</span><br><span class="line">    transition: transform 2s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JSå®ç°éšæœºç‚¹æ•°"><a href="#JSå®ç°éšæœºç‚¹æ•°" class="headerlink" title="JSå®ç°éšæœºç‚¹æ•°"></a>JSå®ç°éšæœºç‚¹æ•°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    let wrap = document.querySelector(&#x27;.wrap&#x27;)</span><br><span class="line">    let rotateX = 0 // åˆå§‹åŒ–æ—‹è½¬è§’åº¦</span><br><span class="line">    let rotateY = 0</span><br><span class="line">    let rotateZ = 0</span><br><span class="line"></span><br><span class="line">    wrap.onclick = function () &#123;</span><br><span class="line">        let x = Math.floor(Math.random() * 10) - 5 //éšæœºæ•°ï¼ŒèŒƒå›´æ˜¯-5åˆ°5</span><br><span class="line">        let y = Math.floor(Math.random() * 10) - 5</span><br><span class="line">        let z = Math.floor(Math.random() * 10) - 5</span><br><span class="line">        rotateX += x * 90</span><br><span class="line">        rotateY += y * 90</span><br><span class="line">        rotateZ += z * 90</span><br><span class="line">        wrap.style.transform = `rotateX($&#123;rotateX&#125;deg) rotateY($&#123;rotateY&#125;deg) rotateZ($&#123;rotateZ&#125;deg)`</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><strong>æš‚æ—¶è¿˜ä¸ä¼šè®¡ç®—æ—‹è½¬åçš„ç‚¹æ•°æ˜¾ç¤º</strong></p><p><strong>ç­‰æœ‰æ€è·¯äº†ç»§ç»­æ›´æ–°</strong></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CSSæ­å»ºé¡µé¢3Dç©ºé—´</title>
      <link href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/CSS%E6%90%AD%E5%BB%BA%E9%A1%B5%E9%9D%A23D%E7%A9%BA%E9%97%B4/"/>
      <url>/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/CSS%E6%90%AD%E5%BB%BA%E9%A1%B5%E9%9D%A23D%E7%A9%BA%E9%97%B4/</url>
      
        <content type="html"><![CDATA[<h1 id="CSSæ­å»ºé¡µé¢3Dç©ºé—´"><a href="#CSSæ­å»ºé¡µé¢3Dç©ºé—´" class="headerlink" title="CSSæ­å»ºé¡µé¢3Dç©ºé—´"></a>CSSæ­å»ºé¡µé¢3Dç©ºé—´</h1><p><strong>é‡ç£…CSSå±æ€§</strong></p><h5 id="transform"><a href="#transform" class="headerlink" title="transform"></a><em>transform</em></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform-style: preserve-3d;/*æ‰€æœ‰å­å…ƒç´ åœ¨3Dç©ºé—´ä¸­å‘ˆç°*/</span><br></pre></td></tr></table></figure><p><em><strong>åç§»</strong></em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: translateX(90px) translateY(90px) translateZ(90px);/*å·¦å³ ä¸‹ä¸Š å‰å*/</span><br></pre></td></tr></table></figure><p><em><strong>æ—‹è½¬</strong></em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)</span><br></pre></td></tr></table></figure><p><img src="/upload/image-20241110201517099.png" alt="image-20241110201517099.png"></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æœ‰å…³CSSçš„å¸¸è§é—®é¢˜</title>
      <link href="/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/CSS%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
      <url>/2025/03/08/%E5%9F%BA%E7%A1%80%E5%89%8D%E7%AB%AF/CSS%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h5 id="å…ƒç´ åŒºåˆ†"><a href="#å…ƒç´ åŒºåˆ†" class="headerlink" title="å…ƒç´ åŒºåˆ†"></a>å…ƒç´ åŒºåˆ†</h5><p><strong>å—å…ƒç´ </strong><strong>div &#x2F; p &#x2F; h &#x2F; ul &#x2F; li</strong></p><p><strong>è¡Œå†…å…ƒç´ </strong><strong>a &#x2F; span &#x2F;br</strong></p><p><strong>è¡Œå†…å—å…ƒç´ </strong><strong>img &#x2F; input &#x2F; td</strong></p><h5 id="é«˜åº¦å¡Œé™·"><a href="#é«˜åº¦å¡Œé™·" class="headerlink" title="é«˜åº¦å¡Œé™·"></a>é«˜åº¦å¡Œé™·</h5><p><strong>å°±æ˜¯å¤–è¾¹è·marginå¡Œé™·</strong></p><p><strong>åªä¼šå‘ç”Ÿåœ¨å‚ç›´æ–¹å‘ï¼Œåªå‡ºç°åœ¨å—çº§å…ƒç´ ä¸Š</strong></p><p><strong>è§£å†³ï¼šå­ç»çˆ¶ç›¸</strong></p><h5 id="æµ®åŠ¨å¡Œé™·"><a href="#æµ®åŠ¨å¡Œé™·" class="headerlink" title="æµ®åŠ¨å¡Œé™·"></a>æµ®åŠ¨å¡Œé™·</h5><p><strong>å…ƒç´ ä¸€æ—¦****æµ®åŠ¨</strong>åï¼Œ<strong>è„±ç¦»æ ‡å‡†æµ</strong>ï¼Œæœç€å‘å·¦æˆ–å³æ–¹å‘ç§»åŠ¨ï¼Œç›´åˆ°è‡ªå·±çš„<strong>è¾¹ç•Œç´§è´´åŒ…å«å—</strong>(ä¸€èˆ¬æ˜¯çˆ¶å…ƒç´ )æˆ–è€…å…¶ä»–æµ®åŠ¨å…ƒç´ çš„è¾¹ç•Œä¸ºæ­¢</p><p><strong>clear</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">div -&gt;  display:float</span><br><span class="line">    span    //float: left</span><br><span class="line">    span    //è‹¥æœªè®¾ç½®é«˜åº¦ï¼Œåˆ™spanæµ®åŠ¨äºçˆ¶å…ƒç´ ä¸Šæ–¹ï¼Œäº§ç”Ÿé«˜åº¦å¡Œé™·</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">    p   -&gt;  clear: both</span><br><span class="line">div</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºBFC</strong></p><p>BFCåŸç†è¯¦æƒ…è§æ–‡ç«  â€œæ ¼å¼åŒ–ä¸Šä¸‹æ–‡â€“BFCä¸IFCâ€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://154.40.44.42:8090/archives/ge-shi-hua-shang-xia-wen--bfcyu-ifc</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">div -&gt;  display:float / overflow: hidden/auto</span><br><span class="line">    span    //float: left</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">    span</span><br><span class="line">div</span><br></pre></td></tr></table></figure><p><strong>ä¼ªå…ƒç´ ï¼ˆ!æœ€æ¨è!ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">div class=clearfix  çˆ¶å…ƒç´ </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.clearfix::after&#123;</span><br><span class="line">    content: &#x27;&#x27;     //è®¾ç½®ä¸ºç©ºå…ƒç´ </span><br><span class="line">    display: block  //è®¾ç½®ä¸ºå—çº§å…ƒç´ </span><br><span class="line">    clear: both     //clearæ¸…é™¤æµ®åŠ¨</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä¸‰è§’å½¢"><a href="#ä¸‰è§’å½¢" class="headerlink" title="ä¸‰è§’å½¢"></a>ä¸‰è§’å½¢</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">w:0</span><br><span class="line">h:0</span><br><span class="line">border: 250px solid transparent</span><br><span class="line">border-æ–¹å‘-color:é¢œè‰²</span><br></pre></td></tr></table></figure><h5 id="å›ºå®šå®½é«˜æ¯”"><a href="#å›ºå®šå®½é«˜æ¯”" class="headerlink" title="å›ºå®šå®½é«˜æ¯”"></a>å›ºå®šå®½é«˜æ¯”</h5><p><strong>éœ€è¦çˆ¶å…ƒç´ </strong></p><p><strong>å®½é«˜æ¯”&#x3D;4:3ç¤ºä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">w:100%              //ä¸ºçˆ¶å…ƒç´ 100%</span><br><span class="line">h:0</span><br><span class="line">padding:0</span><br><span class="line">padding-bottom:75%  //ä¸ºçˆ¶å…ƒç´ 75%</span><br></pre></td></tr></table></figure><h5 id="è¶…å‡ºçœç•¥"><a href="#è¶…å‡ºçœç•¥" class="headerlink" title="è¶…å‡ºçœç•¥"></a>è¶…å‡ºçœç•¥</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">white-space: nowrap;</span><br><span class="line">text-overflow: ellipsis;</span><br><span class="line">overflow: hidden;</span><br></pre></td></tr></table></figure><h5 id="æ¸å˜è¾¹æ¡†"><a href="#æ¸å˜è¾¹æ¡†" class="headerlink" title="æ¸å˜è¾¹æ¡†"></a>æ¸å˜è¾¹æ¡†</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    border: 8px solid transparent; /*8pxçš„é€æ˜è¾¹æ¡†*/</span><br><span class="line">    border-radius: 12px; /*åœ†è§’*/</span><br><span class="line">    background-clip: padding-box, border-box;/*background-clip è®¾ç½®å…ƒç´ çš„èƒŒæ™¯æ˜¯å¦å»¶ä¼¸åˆ°è¾¹æ¡†ã€å†…è¾¹è·ç›’å­ã€å†…å®¹ç›’å­ä¸‹é¢ã€‚èƒŒæ™¯å»¶ä¼¸è‡³è¾¹æ¡†å¤–æ²¿ï¼ˆä½†æ˜¯åœ¨è¾¹æ¡†ä¸‹å±‚ï¼‰ä¸”èƒŒæ™¯å»¶ä¼¸è‡³å†…è¾¹è·ï¼ˆpaddingï¼‰å¤–æ²¿ã€‚ä¸ä¼šç»˜åˆ¶åˆ°è¾¹æ¡†å¤„ã€‚*/</span><br><span class="line">    background-origin: padding-box, border-box;/*èƒŒæ™¯å›¾ç‰‡çš„æ‘†æ”¾ä»¥ border padding åŒºåŸŸä¸ºå‚è€ƒ*/</span><br><span class="line">    background-image: </span><br><span class="line">        linear-gradient(to right, #fff, #fff),</span><br><span class="line">        linear-gradient(135deg, #f00, #ff0, #f0f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WebRTCå®ç°æœ¬åœ°è§†é¢‘é€šè¯ | å…¨æµç¨‹è¯¦è§£</title>
      <link href="/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/WebRTC%E5%AE%9E%E7%8E%B0%E6%9C%AC%E5%9C%B0%E8%A7%86%E9%A2%91%E9%80%9A%E8%AF%9D%E5%85%A8%E6%B5%81%E7%A8%8B/"/>
      <url>/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/WebRTC%E5%AE%9E%E7%8E%B0%E6%9C%AC%E5%9C%B0%E8%A7%86%E9%A2%91%E9%80%9A%E8%AF%9D%E5%85%A8%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="WebRTC-å®ç°æœ¬åœ°è§†é¢‘é€šè¯-å…¨æµç¨‹è¯¦è§£"><a href="#WebRTC-å®ç°æœ¬åœ°è§†é¢‘é€šè¯-å…¨æµç¨‹è¯¦è§£" class="headerlink" title="WebRTC å®ç°æœ¬åœ°è§†é¢‘é€šè¯ | å…¨æµç¨‹è¯¦è§£"></a>WebRTC å®ç°æœ¬åœ°è§†é¢‘é€šè¯ | å…¨æµç¨‹è¯¦è§£</h1><p>æºç è§ä»“åº“ <a href="https://github.com/Breezli/WebRTC_Demo">Breezli&#x2F;WebRTC_Demo: åŸºäº WebRTC æŠ€æœ¯å®ç°çš„æœ¬åœ°ç½‘é¡µç«¯è§†é¢‘é€šè¯</a></p><p>åˆ†ä¸ºå‰åç«¯ä¸¤ä¸ªæ–‡ä»¶å¤¹</p><blockquote><p>webrtc-client (å®¢æˆ·ç«¯)</p><p>webrtc-server (æœåŠ¡ç«¯)</p></blockquote><h2 id="é¢„å…ˆå‡†å¤‡"><a href="#é¢„å…ˆå‡†å¤‡" class="headerlink" title="é¢„å…ˆå‡†å¤‡"></a>é¢„å…ˆå‡†å¤‡</h2><h3 id="webrtc-client"><a href="#webrtc-client" class="headerlink" title="webrtc-client"></a>webrtc-client</h3><p>å‰ç«¯é¡µé¢ç»˜åˆ¶</p><p><code>ä¾èµ–ä¸‹è½½</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pnpm create vite@latest webrtc-client -- --template vue-ts</span><br><span class="line">pnpm install -D tailwindcss postcss autoprefixer</span><br><span class="line">npx tailwindcss init -p</span><br></pre></td></tr></table></figure><p><code>package.json</code>ç›´é€š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webrtc-client&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;private&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;module&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-tsc -b &amp;&amp; vite build&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;preview&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite preview&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;socket.io-client&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.8.1&quot;</span><span class="punctuation">,</span> <span class="comment">//é‡è¦ä¾èµ–</span></span><br><span class="line"><span class="attr">&quot;vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.5.13&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;@vitejs/plugin-vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.2.1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;@vue/tsconfig&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.7.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;autoprefixer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^10.4.20&quot;</span><span class="punctuation">,</span> <span class="comment">//è‡ªåŠ¨æ·»åŠ csså‰ç¼€</span></span><br><span class="line"><span class="attr">&quot;postcss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^8.4.49&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;tailwindcss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.4.17&quot;</span><span class="punctuation">,</span> <span class="comment">//tailwindcssæ ·å¼åº“</span></span><br><span class="line"><span class="attr">&quot;typescript&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~5.6.2&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.0.5&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vue-tsc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.2.0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><code>App.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&quot;flex items-center flex-col text-center p-12 h-screen&quot;&gt;</span><br><span class="line">&lt;div class=&quot;relative h-full mb-4&quot;&gt;</span><br><span class="line">&lt;video</span><br><span class="line">ref=&quot;localVideo&quot;</span><br><span class="line">class=&quot;w-96 h-full bg-gray-200 mb-4 object-cover&quot;&gt;&lt;/video&gt;</span><br><span class="line">&lt;video</span><br><span class="line">ref=&quot;remoteVideo&quot;</span><br><span class="line">class=&quot;w-32 h-48 absolute bottom-0 right-0 object-cover&quot;&gt;&lt;/video&gt;</span><br><span class="line">&lt;div</span><br><span class="line">v-if=&quot;caller &amp;&amp; calling&quot;</span><br><span class="line">class=&quot;absolute top-2/3 left-36 flex flex-col items-center&quot;&gt;</span><br><span class="line">&lt;p class=&quot;mb-4 text-white&quot;&gt;ç­‰å¾…å¯¹æ–¹æ¥å¬...&lt;/p&gt;</span><br><span class="line">&lt;img</span><br><span class="line">@click=&quot;hangUp&quot;</span><br><span class="line">src=&quot;/refuse.svg&quot;</span><br><span class="line">class=&quot;w-16 cursor-pointer&quot;</span><br><span class="line">alt=&quot;&quot; /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div</span><br><span class="line">v-if=&quot;called &amp;&amp; calling&quot;</span><br><span class="line">class=&quot;absolute top-2/3 left-32 flex flex-col items-center&quot;&gt;</span><br><span class="line">&lt;p class=&quot;mb-4 text-white&quot;&gt;æ”¶åˆ°è§†é¢‘é‚€è¯·...&lt;/p&gt;</span><br><span class="line">&lt;div class=&quot;flex&quot;&gt;</span><br><span class="line">&lt;img</span><br><span class="line">@click=&quot;hangUp&quot;</span><br><span class="line">src=&quot;/refuse.svg&quot;</span><br><span class="line">class=&quot;w-16 cursor-pointer mr-4&quot;</span><br><span class="line">alt=&quot;&quot; /&gt;</span><br><span class="line">&lt;img</span><br><span class="line">@click=&quot;acceptCall&quot;</span><br><span class="line">src=&quot;/accept.svg&quot;</span><br><span class="line">class=&quot;w-16 cursor-pointer&quot;</span><br><span class="line">alt=&quot;&quot; /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;flex gap-2 mb-4&quot;&gt;</span><br><span class="line">&lt;button</span><br><span class="line">class=&quot;rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white&quot;</span><br><span class="line">@click=&quot;callRemote&quot;&gt;</span><br><span class="line">å‘èµ·è§†é¢‘</span><br><span class="line">&lt;/button&gt;</span><br><span class="line">&lt;button</span><br><span class="line">class=&quot;rounded-md bg-red-600 px-4 py-2 text-sm font-semibold text-white&quot;</span><br><span class="line">@click=&quot;hangUp&quot;&gt;</span><br><span class="line">æŒ‚æ–­è§†é¢‘</span><br><span class="line">&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p><code>main.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>style.css</code> è¿™é‡Œä½¿ç”¨äº† tailwind çš„æ ·å¼åº“</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@tailwind</span> base;</span><br><span class="line"><span class="keyword">@tailwind</span> components;</span><br><span class="line"><span class="keyword">@tailwind</span> utilities;</span><br></pre></td></tr></table></figure><p><code>tailwind.config.js</code> æ­¤é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ‰€æœ‰æ¨¡æ¿æ–‡ä»¶çš„è·¯å¾„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;tailwindcss&#x27;).Config</span>&#125; */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="attr">content</span>: [<span class="string">&#x27;./index.html&#x27;</span>, <span class="string">&#x27;./src/**/*.&#123;vue,js,ts,jsx,tsx&#125;&#x27;</span>],</span><br><span class="line"><span class="attr">theme</span>: &#123;</span><br><span class="line"><span class="attr">extend</span>: &#123;&#125;,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">plugins</span>: [],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤å‰ç«¯é¡µé¢ç»˜åˆ¶å®Œæˆï¼Œå¯åœ¨ 3000 ç«¯å£å¯å¯åŠ¨ node æœåŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run start</span><br></pre></td></tr></table></figure><h3 id="webrtc-server"><a href="#webrtc-server" class="headerlink" title="webrtc-server"></a>webrtc-server</h3><p>åˆå§‹åŒ–æœåŠ¡ç«¯é¡¹ç›®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm init</span><br></pre></td></tr></table></figure><p><code>socket.io</code> å°è£…äº† websocket åº”ç”¨åˆ›å»ºæœåŠ¡</p><p><code>nodemon</code> ä»£ç æ”¹å˜ä¼šè‡ªåŠ¨é‡å¯(ä¸ç”¨é‡å¤åœ°å¼€å…³)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install socket.io nodemon</span><br></pre></td></tr></table></figure><p><code>package.json</code> æ·»åŠ <code>start</code>å‘½ä»¤ï¼Œä½¿ç”¨<code>nodemon</code>å¯åŠ¨é¡¹ç›®</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nodemon index.js&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>åˆ›å»º<code>index.js</code>ï¼ˆæœ€åˆç‰ˆï¼Œä¹‹ååç«¯çš„æ‰€æœ‰æ“ä½œéƒ½åœ¨è¿™ä¸ªæ–‡ä»¶ä¸Šè¿›è¡Œï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = <span class="built_in">require</span>(<span class="string">&#x27;socket.io&#x27;</span>) <span class="comment">//å°è£…äº†websocketåº”ç”¨åˆ›å»ºæœåŠ¡</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>) <span class="comment">//å¼•å…¥httpæ¨¡å—</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>() <span class="comment">//åˆ›å»ºæœåŠ¡å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> io = <span class="title function_">socket</span>(server, &#123;</span><br><span class="line"><span class="attr">cors</span>: &#123;</span><br><span class="line"><span class="attr">origin</span>: <span class="string">&#x27;*&#x27;</span>, <span class="comment">// é…ç½®è·¨åŸŸ</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/////æ¥ä¸‹æ¥çš„ä¸»ä½“éƒ¨åˆ†/////</span></span><br><span class="line">io.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">sock</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¿æ¥æˆåŠŸ...&#x27;</span>)</span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>) <span class="comment">// å‘å®¢æˆ·ç«¯å‘é€è¿æ¥æˆåŠŸçš„æ¶ˆæ¯</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">io.<span class="title function_">on</span>(<span class="string">&#x27;disconnect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¿æ¥æ–­å¼€&#x27;</span>)</span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;connectionFalse&#x27;</span>) <span class="comment">// å‘å®¢æˆ·ç«¯å‘é€è¿æ¥æ–­å¼€çš„æ¶ˆæ¯</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/////æ¥ä¸‹æ¥çš„ä¸»ä½“éƒ¨åˆ†/////</span></span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="æ’æ’­-socket-é‡è¦æ¦‚å¿µ"><a href="#æ’æ’­-socket-é‡è¦æ¦‚å¿µ" class="headerlink" title="!!!æ’æ’­ socket é‡è¦æ¦‚å¿µ!!!"></a>!!!æ’æ’­ socket é‡è¦æ¦‚å¿µ!!!</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.emitå‘é€äº‹ä»¶</span><br><span class="line">.onç›‘å¬äº‹ä»¶</span><br></pre></td></tr></table></figure><p>å¸¸è§å†…ç½®äº‹ä»¶è¯´æ˜</p><table><thead><tr><th align="center">äº‹ä»¶åç§°</th><th align="center">è§¦å‘åœºæ™¯</th><th align="center">ä½¿ç”¨ä½ç½®</th></tr></thead><tbody><tr><td align="center">connect</td><td align="center">å®¢æˆ·ç«¯æˆåŠŸè¿æ¥åˆ°æœåŠ¡ç«¯æ—¶</td><td align="center">å®¢æˆ·ç«¯</td></tr><tr><td align="center">connection</td><td align="center">æœåŠ¡ç«¯æ¥æ”¶åˆ°æ–°å®¢æˆ·ç«¯è¿æ¥æ—¶</td><td align="center">æœåŠ¡ç«¯</td></tr><tr><td align="center">disconnect</td><td align="center">è¿æ¥æ–­å¼€æ—¶</td><td align="center">å®¢æˆ·ç«¯&#x2F;æœåŠ¡ç«¯</td></tr><tr><td align="center">error</td><td align="center">è¿æ¥å‘ç”Ÿé”™è¯¯æ—¶</td><td align="center">å®¢æˆ·ç«¯&#x2F;æœåŠ¡ç«¯</td></tr></tbody></table><p>åç«¯è‡³æ­¤æ­å»ºå®Œæˆï¼Œå¯åœ¨ 3000 ç«¯å£å¯å¯åŠ¨ node æœåŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm run start</span><br></pre></td></tr></table></figure><h2 id="å‰ç«¯è¿æ¥ä¿¡ä»¤æœåŠ¡å™¨"><a href="#å‰ç«¯è¿æ¥ä¿¡ä»¤æœåŠ¡å™¨" class="headerlink" title="å‰ç«¯è¿æ¥ä¿¡ä»¤æœåŠ¡å™¨"></a>å‰ç«¯è¿æ¥ä¿¡ä»¤æœåŠ¡å™¨</h2><p>ä¾é çš„å°±æ˜¯<code>socket.io-client</code></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†åœ¨<code>App.vue</code>ä¸­å¼€å§‹ç¼–å†™è„šæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, onMounted, onUnmounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; io, Socket &#125; from &#x27;socket.io-client&#x27;</span><br><span class="line"></span><br><span class="line">const socket = ref&lt;Socket&gt;() // å‰ç«¯Socketå®ä¾‹</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">const sock = io(&#x27;localhost:3000&#x27;) // é€šè¿‡ io(&#x27;localhost:3000&#x27;) åˆ›å»ºçš„ Socket.IO å®¢æˆ·ç«¯å®ä¾‹</span><br><span class="line"></span><br><span class="line">// è¿æ¥æˆåŠŸ</span><br><span class="line">sock.on(&#x27;connectionSuccess&#x27;, () =&gt; &#123;</span><br><span class="line">console.log(&#x27;è¿æ¥æˆåŠŸ&#x27;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">socket.value = sock // å­˜å‚¨Socketå®ä¾‹</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>è¿˜è®°å¾—å—ï¼Œå°±åœ¨å‰ä¸¤æ­¥ï¼Œåç«¯åœ¨è¿æ¥æˆåŠŸåå‘å‰ç«¯.emit(å‘é€)äº† connectionSuccess äº‹ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">io.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">sock</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¿æ¥æˆåŠŸ...&#x27;</span>)</span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>) <span class="comment">// å‘å®¢æˆ·ç«¯å‘é€è¿æ¥æˆåŠŸçš„æ¶ˆæ¯</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è€Œåœ¨æ­¤æ—¶çš„å‰ç«¯åŠ å…¥çš„</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// æ¥æ”¶åˆ°æœåŠ¡ç«¯å‘æ¥çš„connectionSuccess(è¿æ¥æˆåŠŸ)äº‹ä»¶</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¿æ¥æˆåŠŸ&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å‰åç«¯äº¤äº’æ­£å¼å¼€å§‹</p><h2 id="å‘èµ·è§†é¢‘è¯·æ±‚"><a href="#å‘èµ·è§†é¢‘è¯·æ±‚" class="headerlink" title="å‘èµ·è§†é¢‘è¯·æ±‚"></a>å‘èµ·è§†é¢‘è¯·æ±‚</h2><h3 id="è·å–æœ¬åœ°éŸ³è§†é¢‘æµ"><a href="#è·å–æœ¬åœ°éŸ³è§†é¢‘æµ" class="headerlink" title="è·å–æœ¬åœ°éŸ³è§†é¢‘æµ"></a>è·å–æœ¬åœ°éŸ³è§†é¢‘æµ</h3><p>å‰ç«¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getLocalStream</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">const</span> stream = <span class="keyword">await</span> navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123;</span><br><span class="line"><span class="comment">// è·å–éŸ³è§†é¢‘æµ</span></span><br><span class="line"><span class="attr">video</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">audio</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br><span class="line">localVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = stream <span class="comment">// å°†åª’ä½“æµè®¾ç½®åˆ° video æ ‡ç­¾ä¸Šæ’­æ”¾</span></span><br><span class="line">localVideo.<span class="property">value</span>!.<span class="title function_">play</span>() <span class="comment">// æ’­æ”¾éŸ³è§†é¢‘æµ</span></span><br><span class="line">localStream.<span class="property">value</span> = stream <span class="comment">// å­˜å‚¨æœ¬åœ°æµ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> stream</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="â€œæˆ¿é—´â€çš„æ¦‚å¿µ"><a href="#â€œæˆ¿é—´â€çš„æ¦‚å¿µ" class="headerlink" title="â€œæˆ¿é—´â€çš„æ¦‚å¿µ"></a>â€œæˆ¿é—´â€çš„æ¦‚å¿µ</h3><blockquote><p>ä¸å¦¨å…ˆåœä¸‹æ¥æ€è€ƒä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆåœ¨åŒä¸€ä¸ªç½‘é¡µï¼Œä¸åŒçš„å®¢æˆ·ç«¯å¯ä»¥çœ‹è§ä¸åŒçš„é¡µé¢ï¼Œå’Œå®æ—¶å…±äº«çš„å†…å®¹</p></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250205190246032.png" alt="image-20250205190246032" style="zoom: 33%;" /><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€çœ‹ä¹‹å‰ç»™å‰ç«¯å†™çš„ç»„ä»¶ï¼ˆlayout çœç•¥ç‰ˆï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;video ref=&quot;localVideo&quot;&gt;&lt;/video&gt;</span><br><span class="line">//æœ¬åœ°è§†é¢‘</span><br><span class="line">&lt;video ref=&quot;remoteVideo&quot;&gt;&lt;/video&gt;</span><br><span class="line">//æ¥æ”¶æ–¹è§†é¢‘ï¼ˆä½äºå³ä¸‹è§’ï¼‰</span><br><span class="line"></span><br><span class="line">&lt;div v-if=&quot;caller &amp;&amp; calling&quot;&gt;//çŠ¶æ€å‚æ•°---caller:å‘é€æ–¹---calling:å‘¼å«ä¸­</span><br><span class="line">    &lt;p&gt;ç­‰å¾…å¯¹æ–¹æ¥å¬...&lt;/p&gt;</span><br><span class="line">    &lt;img @click=&quot;hangUp&quot; src=&quot;/refuse.svg&quot;/&gt;//æŒ‚æ–­</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div v-if=&quot;called &amp;&amp; calling&quot;&gt;//çŠ¶æ€å‚æ•°---called:æ¥æ”¶æ–¹---calling:å‘¼å«ä¸­</span><br><span class="line">    &lt;p&gt;æ”¶åˆ°è§†é¢‘é‚€è¯·...&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    &lt;img @click=&quot;hangUp&quot; src=&quot;/refuse.svg&quot;/&gt;//æŒ‚æ–­</span><br><span class="line">    &lt;img @click=&quot;acceptCall&quot; src=&quot;/accept.svg&quot;/&gt;//æ¥å¬</span><br><span class="line"></span><br><span class="line">    &lt;button @click=&quot;callRemote&quot;&gt;å‘èµ·è§†é¢‘&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;hangUp&quot;&gt;æŒ‚æ–­è§†é¢‘&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸éš¾å‘ç°æˆ‘ä»¬æ˜¯ä¾é çŠ¶æ€å‚æ•°æ¥æ§åˆ¶é¡µé¢æ˜¾ç¤ºçš„</p></blockquote><p>æœ¬é¡¹ç›®å‚æ•°è¡¨å¦‚ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> called = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// æ˜¯å¦æ˜¯æ¥æ”¶æ–¹</span></span><br><span class="line"><span class="keyword">const</span> caller = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// æ˜¯å¦æ˜¯å‘èµ·æ–¹</span></span><br><span class="line"><span class="keyword">const</span> calling = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// å‘¼å«ä¸­</span></span><br><span class="line"><span class="keyword">const</span> communicating = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// è§†é¢‘é€šè¯ä¸­</span></span><br><span class="line"><span class="keyword">const</span> localVideo = ref&lt;<span class="title class_">HTMLVideoElement</span>&gt;() <span class="comment">// videoæ ‡ç­¾å®ä¾‹ï¼Œæ’­æ”¾æœ¬äººçš„è§†é¢‘</span></span><br><span class="line"><span class="keyword">const</span> remoteVideo = ref&lt;<span class="title class_">HTMLVideoElement</span>&gt;() <span class="comment">// videoæ ‡ç­¾å®ä¾‹ï¼Œæ’­æ”¾å¯¹æ–¹çš„è§†é¢‘</span></span><br><span class="line"><span class="keyword">const</span> localStream = ref&lt;<span class="title class_">MediaStream</span>&gt;() <span class="comment">// æœ¬åœ°æµ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> roomId = <span class="string">&#x27;001&#x27;</span> <span class="comment">// æˆ¿é—´ID</span></span><br></pre></td></tr></table></figure><p>é¡ºä¾¿å¸¦ä¸Šå®ä¾‹åˆ›å»º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = ref&lt;<span class="title class_">Socket</span>&gt;() <span class="comment">// Socketå®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> peer = ref&lt;<span class="built_in">any</span>&gt;() <span class="comment">// RTCPeerConnectionå®ä¾‹</span></span><br></pre></td></tr></table></figure><p>è€Œå¯¹äºæˆ‘ä»¬è¿™ä¸ªé¡¹ç›®ï¼Œ<code>æˆ¿é—´</code>çš„æ¦‚å¿µå°±å¾ˆç®€å•</p><blockquote><p>A (å·¦) å‘ B (å³) å‘èµ·æ¥é€šè¯·æ±‚ï¼Œåœ¨ B æ¥æ”¶è¯·æ±‚åï¼ŒåŒæ–¹éƒ½å°†åŠ å…¥è¿™ä¸ªè§†é¢‘é€šè¯çš„â€æˆ¿é—´â€</p><p>æˆ¿é—´ å¯ä»¥é€šè¿‡è‡ªä¸»åˆ†é… id åˆ’åˆ†ï¼Œæ¯ä¸ªæˆ¿é—´ä¹Ÿå¯ä»¥åŠ å…¥å¾ˆå¤šç”¨æˆ· (å¦‚ç›´æ’­ç³»ç»Ÿ)</p><p>æœåŠ¡ç«¯å«æœ‰åŠ å…¥æˆ¿é—´çš„æ“çºµä»£ç  sock.join(Id)</p></blockquote><h3 id="åŠ å…¥æˆ¿é—´è¯·æ±‚"><a href="#åŠ å…¥æˆ¿é—´è¯·æ±‚" class="headerlink" title="åŠ å…¥æˆ¿é—´è¯·æ±‚"></a>åŠ å…¥æˆ¿é—´è¯·æ±‚</h3><p>å‰ç«¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¿æ¥æœåŠ¡å™¨æˆåŠŸ...&#x27;</span>)</span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;joinRoom&#x27;</span>, roomId) <span class="comment">// å‰ç«¯å‘é€åŠ å…¥æˆ¿é—´äº‹ä»¶</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åç«¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;joinRoom&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line">sock.<span class="title function_">join</span>(roomId) <span class="comment">// åŠ å…¥æˆ¿é—´</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="å‘èµ·è§†é¢‘è¯·æ±‚-1"><a href="#å‘èµ·è§†é¢‘è¯·æ±‚-1" class="headerlink" title="å‘èµ·è§†é¢‘è¯·æ±‚"></a>å‘èµ·è§†é¢‘è¯·æ±‚</h3><p><strong>A æ–¹æŒ‰é’®è§¦å‘å‡½æ•°</strong></p><p>å‰ç«¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">callRemote</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å‘èµ·è§†é¢‘&#x27;</span>) <span class="comment">// çŠ¶æ€æ›´æ–°</span></span><br><span class="line">caller.<span class="property">value</span> = <span class="literal">true</span> <span class="comment">// å‘é€æ–¹æ ‡è®°</span></span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">true</span> <span class="comment">// å‘¼å«ä¸­</span></span><br><span class="line"><span class="keyword">await</span> <span class="title function_">getLocalStream</span>() <span class="comment">// è·å–æœ¬åœ°éŸ³è§†é¢‘æµå‡½æ•°</span></span><br><span class="line">socket.<span class="property">value</span>?.<span class="title function_">emit</span>(<span class="string">&#x27;callRemote&#x27;</span>, roomId) <span class="comment">// å‘é€è§†é¢‘è¯·æ±‚äº‹ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åç«¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;callRemote&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// æ”¶åˆ°å‘é€æ–¹çš„è§†é¢‘è¯·æ±‚äº‹ä»¶</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCall&#x27;</span>) <span class="comment">// å‘è¿™ä¸ªæˆ¿é—´ä¸­çš„æ‰€æœ‰äººå¹¿æ’­äº‹ä»¶receiveCall</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å‰ç«¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveCall&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// æˆ¿é—´å†…æ‰€æœ‰æ¥æ”¶æ–¹ç›‘å¬åˆ°è§†é¢‘è¯·æ±‚äº‹ä»¶</span></span><br><span class="line"><span class="keyword">if</span> (!caller.<span class="property">value</span>) &#123;</span><br><span class="line"><span class="comment">// éå‘èµ·æ–¹</span></span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">true</span> <span class="comment">// å‘¼å«ä¸­</span></span><br><span class="line">called.<span class="property">value</span> = <span class="literal">true</span> <span class="comment">// æ¥æ”¶æ–¹æ ‡è®°</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶ A(å‘èµ·)æ–¹å¯åŠ¨æ‘„åƒå¤´å’Œéº¦å…‹é£ï¼Œå¹¶ç­‰å¾…å¯¹æ–¹æ¥å¬</p><p>B(æ¥æ”¶)æ–¹å‡ºç° æ¥å¬&#x2F;æŒ‚æ–­ æŒ‰é’®</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-if=&quot;caller &amp;&amp; calling&quot;&gt;//çŠ¶æ€å‚æ•°---caller:å‘é€æ–¹---calling:å‘¼å«ä¸­</span><br><span class="line">    &lt;p&gt;ç­‰å¾…å¯¹æ–¹æ¥å¬...&lt;/p&gt;</span><br><span class="line">    &lt;img @click=&quot;hangUp&quot; src=&quot;/refuse.svg&quot;/&gt;//æŒ‚æ–­</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div v-if=&quot;called &amp;&amp; calling&quot;&gt;//çŠ¶æ€å‚æ•°---called:æ¥æ”¶æ–¹---calling:å‘¼å«ä¸­</span><br><span class="line">    &lt;p&gt;æ”¶åˆ°è§†é¢‘é‚€è¯·...&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    &lt;img @click=&quot;hangUp&quot; src=&quot;/refuse.svg&quot;/&gt;//æŒ‚æ–­</span><br><span class="line">    &lt;img @click=&quot;acceptCall&quot; src=&quot;/accept.svg&quot;/&gt;//æ¥å¬</span><br><span class="line"></span><br><span class="line">    &lt;button @click=&quot;callRemote&quot;&gt;å‘èµ·è§†é¢‘&lt;/button&gt;//å‘èµ·</span><br><span class="line">    &lt;button @click=&quot;hangUp&quot;&gt;æŒ‚æ–­è§†é¢‘&lt;/button&gt;//æŒ‚æ–­</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h3 id="æ¥æ”¶-æŒ‚æ–­-è§†é¢‘"><a href="#æ¥æ”¶-æŒ‚æ–­-è§†é¢‘" class="headerlink" title="æ¥æ”¶ &#x2F; æŒ‚æ–­ è§†é¢‘"></a>æ¥æ”¶ &#x2F; æŒ‚æ–­ è§†é¢‘</h3><p><strong><em>è¶ç€ç°åœ¨ï¼Œæˆ‘ä»¬æ·»ä¸Šå…¶ä»–æŒ‰é’®ç»‘å®šçš„å‡½æ•°</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‚æ–­è§†é¢‘</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hangUp</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;hangUp&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¥æ”¶è§†é¢‘è¯·æ±‚ï¼ˆæ¥æ”¶æ–¹ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">acceptCall</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;acceptCall&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><em>æ¥ç€æ¥çœ‹åç«¯æ€ä¹ˆå¤„ç†</em></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‚æ–­è§†é¢‘</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;hangUp&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;hangUp&#x27;</span>) <span class="comment">// å‘Idæˆ¿é—´å†…æ‰€æœ‰äººå¹¿æ’­è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¥æ”¶è§†é¢‘è¯·æ±‚</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;acceptCall&#x27;</span>) <span class="comment">// å‘Idæˆ¿é—´å†…æ‰€æœ‰äººå¹¿æ’­è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong><em>è¿”å›å‰ç«¯ï¼Œå¤„ç†æˆ‘ä»¬æ¥æ”¶åˆ°çš„ hangUp || acceptCall</em></strong></p><p><strong>æŒ‚æ–­è§†é¢‘</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;hangUp&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">reset</span>() <span class="comment">// é‡ç½®çŠ¶æ€</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é‡ç½®çŠ¶æ€å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">reset</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">called.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">caller.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">communicating.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">peer.<span class="property">value</span> = <span class="literal">null</span></span><br><span class="line">localVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = <span class="literal">null</span> <span class="comment">// å…³é—­æœ¬åœ°è§†é¢‘</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = <span class="literal">null</span> <span class="comment">// å…³é—­è¿œç¨‹è§†é¢‘</span></span><br><span class="line">localStream.<span class="property">value</span>?.<span class="title function_">getTracks</span>()[<span class="number">0</span>].<span class="title function_">stop</span>() <span class="comment">// å…³é—­æœ¬åœ°æµ</span></span><br><span class="line"><span class="comment">// localStream.value = undefined // å…³é—­æœ¬åœ°æµï¼ˆç›¸åŒæ•ˆæœï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¥å—è§†é¢‘è¯·æ±‚</strong></p><p>è€Œè¿™ä¸ªå°±å˜å¤æ‚äº†</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;</span><br><span class="line"><span class="comment">// å‘é€æ–¹</span></span><br><span class="line">peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>() <span class="comment">// åˆ›å»ºRTCPeerConnectionå¯¹è±¡</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="title function_">addStream</span>(localStream.<span class="property">value</span>) <span class="comment">// æ·»åŠ æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line"></span><br><span class="line">peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// è·å–candidateä¿¡æ¯</span></span><br><span class="line"><span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;) <span class="comment">// å‘æœåŠ¡å™¨å‘é€candidateä¿¡æ¯</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è·å–å¯¹æ–¹çš„éŸ³è§†é¢‘æµ</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment">// æ‹¿åˆ°å¯¹æ–¹çš„è§†é¢‘æµ</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç”Ÿæˆoffer</span></span><br><span class="line"><span class="keyword">const</span> offer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createOffer</span>(&#123;</span><br><span class="line"><span class="attr">offerToReceiveAudio</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦æ¥æ”¶å¯¹æ–¹çš„éŸ³é¢‘</span></span><br><span class="line"><span class="attr">offerToReceiveVideo</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦æ¥æ”¶å¯¹æ–¹çš„è§†é¢‘</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(offer) <span class="comment">// è®¾ç½®æœ¬åœ°æè¿°çš„offer</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, &#123; roomId, offer &#125;) <span class="comment">// å‘é€offer</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="äº¤æ¢-SDP-ä¿¡æ¯å’Œ-candidate-ä¿¡æ¯"><a href="#äº¤æ¢-SDP-ä¿¡æ¯å’Œ-candidate-ä¿¡æ¯" class="headerlink" title="äº¤æ¢ SDP ä¿¡æ¯å’Œ candidate ä¿¡æ¯"></a>äº¤æ¢ SDP ä¿¡æ¯å’Œ candidate ä¿¡æ¯</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p><strong><em>SDP</em></strong> ï¼šWebRTC çš„ä¸€ç§åè®®ï¼Œç”¨äºæè¿°<strong>è®¾å¤‡æ”¯æŒçš„åª’ä½“æ ¼å¼</strong></p><p><strong><em>candidate</em></strong> ï¼šç½‘ç»œä¿¡æ¯</p><p><strong>åª’ä½“åå•†</strong> ï¼šäº¤æ¢ SDP</p><p><strong>ICE</strong> ï¼šWebRTC çš„é€šä¿¡æœºåˆ¶</p><img src="C:\Users\DELL\Desktop\WebRTCèµ„æ–™\WebRTC\è®²ä¹‰\04.png" alt="04" style="zoom: 50%;" /><p>å·¥ä½œåŸç†</p><blockquote><p>1.åŒæ–¹æ”¶é›†æœ¬åœ°ç½‘ç»œåœ°å€ï¼ˆåˆ† å…±æœ‰ | ç§æœ‰ï¼‰+ STUN å’Œ TURN æœåŠ¡å™¨è·å–å€™é€‰åœ°å€</p><p>2.åŒæ–¹é€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨äº¤æ¢è¿™äº›å€™é€‰åœ°å€</p><p>3.åŒæ–¹ä½¿ç”¨å€™é€‰åœ°å€è¿›è¡Œè¿æ¥æµ‹è¯•ï¼Œç¡®å®šæœ€ä½³çš„å¯ç”¨åœ°å€ï¼Œå¼€å§‹å®æ—¶éŸ³è§†é¢‘é€šè¯</p></blockquote><h3 id="åª’ä½“åå•†"><a href="#åª’ä½“åå•†" class="headerlink" title="åª’ä½“åå•†"></a>åª’ä½“åå•†</h3><p><strong>æ¥ä¸‹æ¥æ˜¯æœ€é‡è¦çš„ä¿¡ä»¤äº¤æ¢æ­¥éª¤ï¼ˆWebRTC æ ¸å¿ƒï¼‰</strong></p><p>ä¸»è¦ç”¨åˆ°ä»¥ä¸‹æ–¹æ³•</p><p>åª’ä½“åå•†</p><blockquote><p>createOffer</p><p>createAnswer</p><p>setLocalDesccription</p><p>setRemoteDesccription</p></blockquote><p>é‡è¦äº‹ä»¶</p><blockquote><p>onicecandidate</p><p>onaddstream</p></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250113163924170.png" alt="image-20250113163924170" style="zoom:50%;" /><p>æ­¥éª¤æµç¨‹é‡ç»˜ï¼ˆå¯ä»¥å¯¹æ ‡å·æœ‰ä¸ªå°è±¡ï¼‰</p><blockquote><p>é¢„å‘Šï¼šæ‰€æœ‰å‡½æ•°å‡åœ¨å‰ç«¯å®ç°ï¼Œåç«¯èµ·åˆ°å‘å‰ç«¯å¹¿æ’­ä½œç”¨</p></blockquote><img src="E:\QQç¼“å­˜/IMG_20250205_220254.jpg" alt="IMG_20250205_220254" style="zoom: 25%;" /><p>ç´§æ¥ç€æ¥æ”¶æ–¹æ¥æ”¶åˆ°å¯¹æ–¹åŒæ„çš„æ¶ˆæ¯</p><h3 id="ä¿¡æ¯äº¤æ¢å…¨ç¨‹"><a href="#ä¿¡æ¯äº¤æ¢å…¨ç¨‹" class="headerlink" title="ä¿¡æ¯äº¤æ¢å…¨ç¨‹"></a>ä¿¡æ¯äº¤æ¢å…¨ç¨‹</h3><p>å‰ç«¯ï¼ˆå‘é€æ–¹ï¼‰</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;<span class="comment">// å‘é€æ–¹</span></span><br><span class="line">        peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>()<span class="comment">// åˆ›å»ºRTCPeerConnectionå¯¹è±¡</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="title function_">addStream</span>(localStream.<span class="property">value</span>)<span class="comment">// æ·»åŠ æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–candidateä¿¡æ¯</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line">                <span class="comment">// å‘æœåŠ¡å™¨å‘é€candidateä¿¡æ¯</span></span><br><span class="line">                sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¯¹æ–¹çš„éŸ³è§†é¢‘æµ</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">            calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">            communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">            <span class="comment">// æ‹¿åˆ°å¯¹æ–¹çš„è§†é¢‘æµ</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ---â‘ ---</span><br><span class="line">        <span class="keyword">const</span> offer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createOffer</span>(&#123;<span class="comment">// ç”Ÿæˆoffer</span></span><br><span class="line">            <span class="attr">offerToReceiveAudio</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦æ¥æ”¶å¯¹æ–¹çš„éŸ³é¢‘</span></span><br><span class="line">            <span class="attr">offerToReceiveVideo</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦æ¥æ”¶å¯¹æ–¹çš„è§†é¢‘</span></span><br><span class="line">        &#125;)</span><br><span class="line">        ---â‘¡---</span><br><span class="line">        <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(offer)<span class="comment">// è®¾ç½®æœ¬åœ°æè¿°çš„offer</span></span><br><span class="line">        ---â‘¢---</span><br><span class="line">        sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, &#123; roomId, offer &#125;)<span class="comment">// å‘é€offer !!!æ³¨æ„,è¿™é‡Œofferå·²ç»å½“å‚æ•°ä¼ è¿‡å»äº†!!!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åç«¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, candidate &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, candidate) <span class="comment">// å‘è¿™ä¸ªæˆ¿é—´é‡Œæ‰€æœ‰äººå¹¿æ’­candidateä¿¡æ¯</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendOffer&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, offer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// !!!offeråœ¨è¿™é‡Œ!!!</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, offer) <span class="comment">// å‘è¿™ä¸ªæˆ¿é—´é‡Œæ‰€æœ‰äººå¹¿æ’­offerä¿¡æ¯ &amp;&amp; å‘æ¥æ”¶æ–¹å‘é€è¿™ä¸ªoffer</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å‰ç«¯ï¼ˆæ¥æ”¶æ–¹ï¼‰</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendOffer&#x27;</span>, <span class="title function_">async</span> (<span class="attr">offer</span>: <span class="built_in">any</span>) =&gt; &#123;<span class="comment">// !!!offerä¼ å›å‰ç«¯(åˆ¤æ–­è¢«æ ‡æ³¨çš„æ¥æ”¶æ–¹)!!!</span></span><br><span class="line">    <span class="keyword">if</span> (called.<span class="property">value</span>) &#123;<span class="comment">// æ¥æ”¶æ–¹</span></span><br><span class="line">        <span class="keyword">const</span> stream = <span class="keyword">await</span> <span class="title function_">getLocalStream</span>()<span class="comment">// è·å–æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line">        peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>()<span class="comment">// æ¥æ”¶æ–¹åˆ›å»ºè‡ªå·±çš„RTCPeerConnectionå¯¹è±¡</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="title function_">addStream</span>(stream)<span class="comment">// æ·»åŠ æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line"></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;<span class="comment">// è·å–candidateä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line">                <span class="comment">// å‘æœåŠ¡å™¨å‘é€candidateä¿¡æ¯</span></span><br><span class="line">                sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¯¹æ–¹çš„éŸ³è§†é¢‘æµ</span></span><br><span class="line">        peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">            calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">            communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">            <span class="comment">// æ‹¿åˆ°å¯¹æ–¹çš„è§†é¢‘æµ</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">            remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ---â‘£---</span><br><span class="line">        <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setRemoteDescription</span>(offer)<span class="comment">// è®¾ç½®è¿œç«¯æè¿°ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">        ---â‘¤---</span><br><span class="line">        <span class="keyword">const</span> answer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createAnswer</span>()<span class="comment">// ç”Ÿæˆanswer</span></span><br><span class="line">        ---â‘¥---</span><br><span class="line">        <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(answer)<span class="comment">// è®¾ç½®æœ¬åœ°æè¿°ä¿¡æ¯</span></span><br><span class="line">        ---â‘¦---</span><br><span class="line">        sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendAnswer&#x27;</span>, &#123; roomId, answer &#125;)<span class="comment">// å‘é€answer !!!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åç«¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, candidate &#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// !!!</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, candidate) <span class="comment">// å‘è¿™ä¸ªæˆ¿é—´é‡Œæ‰€æœ‰äººå¹¿æ’­candidateä¿¡æ¯</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendAnswer&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, answer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveAnswer&#x27;</span>, answer) <span class="comment">// å‘è¿™ä¸ªæˆ¿é—´é‡Œæ‰€æœ‰äººå¹¿æ’­answerä¿¡æ¯ &amp;&amp; å‘æ¥æ”¶æ–¹å‘é€è¿™ä¸ªanswer</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å‰ç«¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveAnswer&#x27;</span>, <span class="function">(<span class="params"><span class="attr">answer</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;<span class="comment">// å‘é€æ–¹</span></span><br><span class="line">        ---â‘§---</span><br><span class="line">        peer.<span class="property">value</span>.<span class="title function_">setRemoteDescription</span>(answer)<span class="comment">// è®¾ç½®è¿œç«¯æè¿°ä¿¡æ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è®©æ–‡ç« ä¸é‚£ä¹ˆä¹±ï¼Œæœ€åå†è¡¥ä¸€ä¸‹<em>candidate</em></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, <span class="title function_">async</span> (<span class="attr">candidate</span>: <span class="built_in">any</span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">addIceCandidate</span>(candidate) <span class="comment">// æ·»åŠ candidateä¿¡æ¯</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>ä¸€è·¯ä¸‹æ¥æ˜¯ä¸æ˜¯é€»è¾‘éå¸¸æ¸…æ™°æ˜äº† ğŸ˜ (bushi)</p></blockquote><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><p>å‰ç«¯ (App.vue)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; io, <span class="title class_">Socket</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;socket.io-client&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> roomId = <span class="string">&#x27;001&#x27;</span> <span class="comment">// æˆ¿é—´ID</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> called = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// æ˜¯å¦æ˜¯æ¥æ”¶æ–¹</span></span><br><span class="line"><span class="keyword">const</span> caller = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// æ˜¯å¦æ˜¯å‘èµ·æ–¹</span></span><br><span class="line"><span class="keyword">const</span> calling = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// å‘¼å«ä¸­</span></span><br><span class="line"><span class="keyword">const</span> communicating = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>) <span class="comment">// è§†é¢‘é€šè¯ä¸­</span></span><br><span class="line"><span class="keyword">const</span> localVideo = ref&lt;<span class="title class_">HTMLVideoElement</span>&gt;() <span class="comment">// videoæ ‡ç­¾å®ä¾‹ï¼Œæ’­æ”¾æœ¬äººçš„è§†é¢‘</span></span><br><span class="line"><span class="keyword">const</span> remoteVideo = ref&lt;<span class="title class_">HTMLVideoElement</span>&gt;() <span class="comment">// videoæ ‡ç­¾å®ä¾‹ï¼Œæ’­æ”¾å¯¹æ–¹çš„è§†é¢‘</span></span><br><span class="line"><span class="keyword">const</span> localStream = ref&lt;<span class="title class_">MediaStream</span>&gt;() <span class="comment">// æœ¬åœ°æµ</span></span><br><span class="line"><span class="keyword">const</span> socket = ref&lt;<span class="title class_">Socket</span>&gt;() <span class="comment">// Socketå®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> peer = ref&lt;<span class="built_in">any</span>&gt;() <span class="comment">// RTCPeerConnectionå®ä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> sock = <span class="title function_">io</span>(<span class="string">&#x27;localhost:3001&#x27;</span>) <span class="comment">// è¿æ¥æœåŠ¡å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥æˆåŠŸ</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// è¿›å…¥æˆ¿é—´</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;joinRoom&#x27;</span>, roomId)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶æ–¹ç›‘å¬æ”¶åˆ°è§†é¢‘è¯·æ±‚äº‹ä»¶</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveCall&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!caller.<span class="property">value</span>) &#123;</span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">called.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€æ–¹æ”¶åˆ°åŒæ„è§†é¢‘äº‹ä»¶</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;</span><br><span class="line"><span class="comment">// å‘é€æ–¹</span></span><br><span class="line"><span class="comment">// åˆ›å»ºRTCPeerConnectionå¯¹è±¡</span></span><br><span class="line">peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>()</span><br><span class="line"><span class="comment">// æ·»åŠ æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="title function_">addStream</span>(localStream.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–candidateä¿¡æ¯</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line"><span class="comment">// å‘æœåŠ¡å™¨å‘é€candidateä¿¡æ¯</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å¯¹æ–¹çš„éŸ³è§†é¢‘æµ</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment">// æ‹¿åˆ°å¯¹æ–¹çš„è§†é¢‘æµ</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆoffer</span></span><br><span class="line"><span class="keyword">const</span> offer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createOffer</span>(&#123;</span><br><span class="line"><span class="attr">offerToReceiveAudio</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦æ¥æ”¶å¯¹æ–¹çš„éŸ³é¢‘</span></span><br><span class="line"><span class="attr">offerToReceiveVideo</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦æ¥æ”¶å¯¹æ–¹çš„è§†é¢‘</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// è®¾ç½®æœ¬åœ°æè¿°çš„offer</span></span><br><span class="line"><span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(offer)</span><br><span class="line"><span class="comment">// å‘é€offer</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, &#123; roomId, offer &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶æ–¹æ”¶åˆ°offer</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendOffer&#x27;</span>, <span class="title function_">async</span> (<span class="attr">offer</span>: <span class="built_in">any</span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (called.<span class="property">value</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> stream = <span class="keyword">await</span> <span class="title function_">getLocalStream</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶æ–¹åˆ›å»ºè‡ªå·±çš„RTCPeerConnectionå¯¹è±¡</span></span><br><span class="line">peer.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="title function_">addStream</span>(stream)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–candidateä¿¡æ¯</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="property">onicecandidate</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line"><span class="comment">// å‘æœåŠ¡å™¨å‘é€candidateä¿¡æ¯</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, &#123; roomId, <span class="attr">candidate</span>: event.<span class="property">candidate</span> &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å¯¹æ–¹çš„éŸ³è§†é¢‘æµ</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="property">onaddstream</span> = <span class="function">(<span class="params"><span class="attr">event</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// æ‹¿åˆ°å¯¹æ–¹çš„è§†é¢‘æµ</span></span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">communicating.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = event.<span class="property">stream</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®è¿œç«¯æè¿°ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setRemoteDescription</span>(offer)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆanswer</span></span><br><span class="line"><span class="keyword">const</span> answer = <span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">createAnswer</span>()</span><br><span class="line"><span class="comment">// è®¾ç½®æœ¬åœ°æè¿°ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">setLocalDescription</span>(answer)</span><br><span class="line"><span class="comment">// å‘é€answer</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;sendAnswer&#x27;</span>, &#123; roomId, answer &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€æ–¹æ”¶åˆ°æ¥æ”¶æ–¹çš„answer</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveAnswer&#x27;</span>, <span class="function">(<span class="params"><span class="attr">answer</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (caller.<span class="property">value</span>) &#123;</span><br><span class="line"><span class="comment">// è®¾ç½®è¿œç«¯æè¿°ä¿¡æ¯</span></span><br><span class="line">peer.<span class="property">value</span>.<span class="title function_">setRemoteDescription</span>(answer)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶candidateä¿¡æ¯</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, <span class="title function_">async</span> (<span class="attr">candidate</span>: <span class="built_in">any</span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">await</span> peer.<span class="property">value</span>.<span class="title function_">addIceCandidate</span>(candidate) <span class="comment">// æ·»åŠ candidateä¿¡æ¯</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¶åˆ°æŒ‚æ–­è§†é¢‘è¯·æ±‚</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;hangUp&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">reset</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">socket.<span class="property">value</span> = sock</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getLocalStream</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"><span class="comment">// è·å–éŸ³è§†é¢‘æµ</span></span><br><span class="line"><span class="keyword">const</span> stream = <span class="keyword">await</span> navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123;</span><br><span class="line"><span class="attr">video</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">audio</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// å°†åª’ä½“æµè®¾ç½®åˆ° video æ ‡ç­¾ä¸Šæ’­æ”¾</span></span><br><span class="line">localVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = stream</span><br><span class="line"><span class="comment">// æ’­æ”¾éŸ³è§†é¢‘æµ</span></span><br><span class="line">localVideo.<span class="property">value</span>!.<span class="title function_">play</span>()</span><br><span class="line"><span class="comment">// å­˜å‚¨æœ¬åœ°æµ</span></span><br><span class="line">localStream.<span class="property">value</span> = stream</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> stream</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘èµ·è§†é¢‘è¯·æ±‚ï¼ˆå‘èµ·æ–¹ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">callRemote</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (calling.<span class="property">value</span> || communicating.<span class="property">value</span>) &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment">// è·å–æœ¬åœ°éŸ³è§†é¢‘æµ</span></span><br><span class="line"><span class="keyword">await</span> <span class="title function_">getLocalStream</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘æœåŠ¡å™¨å‘é€å‘èµ·è§†é¢‘è¯·æ±‚çš„äº‹ä»¶</span></span><br><span class="line">caller.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;callRemote&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶è§†é¢‘è¯·æ±‚ï¼ˆæ¥å—æ–¹ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">acceptCall</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"><span class="comment">// å‘æœåŠ¡å™¨å‘é€æ¥å—è§†é¢‘è¯·æ±‚çš„äº‹ä»¶</span></span><br><span class="line">socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;acceptCall&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‚æ–­è§†é¢‘</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hangUp</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">socket.<span class="property">value</span>.<span class="title function_">emit</span>(<span class="string">&#x27;hangUp&#x27;</span>, roomId)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çŠ¶æ€é‡ç½®</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reset</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">called.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">caller.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">calling.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">communicating.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">peer.<span class="property">value</span> = <span class="literal">null</span></span><br><span class="line">localVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = <span class="literal">null</span> <span class="comment">// å…³é—­æœ¬åœ°è§†é¢‘</span></span><br><span class="line">remoteVideo.<span class="property">value</span>!.<span class="property">srcObject</span> = <span class="literal">null</span> <span class="comment">// å…³é—­è¿œç¨‹è§†é¢‘</span></span><br><span class="line">localStream.<span class="property">value</span>?.<span class="title function_">getTracks</span>()[<span class="number">0</span>].<span class="title function_">stop</span>() <span class="comment">// å…³é—­æœ¬åœ°æµ</span></span><br><span class="line"><span class="comment">// localStream.value = undefined // å…³é—­æœ¬åœ°æµ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åç«¯ (index.js)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = <span class="built_in">require</span>(<span class="string">&#x27;socket.io&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> io = <span class="title function_">socket</span>(server, &#123;</span><br><span class="line"><span class="attr">cors</span>: &#123;</span><br><span class="line"><span class="attr">origin</span>: <span class="string">&#x27;*&#x27;</span>, <span class="comment">// é…ç½®è·¨åŸŸ</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">io.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">sock</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¿æ¥æˆåŠŸ...&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘å®¢æˆ·ç«¯å‘é€è¿æ¥æˆåŠŸçš„æ¶ˆæ¯</span></span><br><span class="line">sock.<span class="title function_">emit</span>(<span class="string">&#x27;connectionSuccess&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬å®¢æˆ·ç«¯è¿›å…¥æˆ¿é—´çš„äº‹ä»¶</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;joinRoom&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// åŠ å…¥æˆ¿é—´</span></span><br><span class="line">sock.<span class="title function_">join</span>(roomId)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¶åˆ°å‘é€æ–¹çš„è§†é¢‘è¯·æ±‚äº‹ä»¶</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;callRemote&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// å‘è¿™ä¸ªæˆ¿é—´ä¸­çš„äººå¹¿æ’­è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCall&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¶åˆ°æ¥æ”¶æ–¹çš„åŒæ„è§†é¢‘äº‹ä»¶</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;acceptCall&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// å‘è¿™ä¸ªæˆ¿é—´ä¸­çš„äººå¹¿æ’­è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;acceptCall&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¶åˆ°å‘é€æ–¹çš„offer</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendOffer&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, offer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// å‘æ¥æ”¶æ–¹å‘é€è¿™ä¸ªoffer</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;sendOffer&#x27;</span>, offer)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¶åˆ°æ¥æ”¶æ–¹çš„answer</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendAnswer&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, answer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// å‘è¿™ä¸ªæˆ¿é—´ä¸­çš„äººå¹¿æ’­è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveAnswer&#x27;</span>, answer)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¶åˆ°å‘é€æ–¹çš„candidateä¿¡æ¯</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;sendCandidate&#x27;</span>, <span class="function">(<span class="params">&#123; roomId, candidate &#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// å‘è¿™ä¸ªæˆ¿é—´ä¸­çš„äººå¹¿æ’­candidateä¿¡æ¯</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;receiveCandidate&#x27;</span>, candidate)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¶åˆ°æŒ‚æ–­è§†é¢‘è¯·æ±‚</span></span><br><span class="line">sock.<span class="title function_">on</span>(<span class="string">&#x27;hangUp&#x27;</span>, <span class="function">(<span class="params">roomId</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// å‘è¿™ä¸ªæˆ¿é—´ä¸­çš„äººå¹¿æ’­è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line">io.<span class="title function_">to</span>(roomId).<span class="title function_">emit</span>(<span class="string">&#x27;hangUp&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3001</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="é¡¹ç›®å¯åŠ¨æ–¹å¼"><a href="#é¡¹ç›®å¯åŠ¨æ–¹å¼" class="headerlink" title="é¡¹ç›®å¯åŠ¨æ–¹å¼"></a>é¡¹ç›®å¯åŠ¨æ–¹å¼</h2><p>åç«¯å¯åŠ¨æœåŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm start</span><br></pre></td></tr></table></figure><p>å‰ç«¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pnpm install</span><br><span class="line">pnpm run dev</span><br></pre></td></tr></table></figure><h1 id="WebSocket-NestJS-å‡çº§é¡¹ç›®-æ”¯æŒä¸åŒç½‘ç»œä¸‹è§†é¢‘é€šè¯"><a href="#WebSocket-NestJS-å‡çº§é¡¹ç›®-æ”¯æŒä¸åŒç½‘ç»œä¸‹è§†é¢‘é€šè¯" class="headerlink" title="WebSocket+NestJS å‡çº§é¡¹ç›® | æ”¯æŒä¸åŒç½‘ç»œä¸‹è§†é¢‘é€šè¯"></a>WebSocket+NestJS å‡çº§é¡¹ç›® | æ”¯æŒä¸åŒç½‘ç»œä¸‹è§†é¢‘é€šè¯</h1><h2 id="é¡¹ç›®æ¶æ„é‡æ„"><a href="#é¡¹ç›®æ¶æ„é‡æ„" class="headerlink" title="é¡¹ç›®æ¶æ„é‡æ„"></a>é¡¹ç›®æ¶æ„é‡æ„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ webrtc-client/       # Vue å‰ç«¯</span><br><span class="line">â”‚   â”œâ”€â”€ src/</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ App.vue      # ä¸»ç•Œé¢</span><br><span class="line">â”‚   â”‚   â””â”€â”€ webrtc.ts    # WebRTC æ ¸å¿ƒé€»è¾‘(ä»App.vueåˆ†ç¦»å‡ºæ¥)</span><br><span class="line">â”œâ”€â”€ webrtc-server/       # NestJS åç«¯</span><br><span class="line">â”‚   â”œâ”€â”€ src/</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ signaling/   # ä¿¡ä»¤æœåŠ¡å™¨æ¨¡å—</span><br><span class="line">â”‚   â”‚   â””â”€â”€ main.ts      # å…¥å£æ–‡ä»¶</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>TS + NodeJSå®ç°axios</title>
      <link href="/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0axios/"/>
      <url>/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0axios/</url>
      
        <content type="html"><![CDATA[<h1 id="TS-NodeJS-å®ç°-axios"><a href="#TS-NodeJS-å®ç°-axios" class="headerlink" title="TS + NodeJS å®ç° axios"></a>TS + NodeJS å®ç° axios</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/alexjoverm/typescript-library-starter.git ts-axios</span><br></pre></td></tr></table></figure><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><blockquote><p>åœ¨æµè§ˆå™¨ç«¯ä½¿ç”¨ XMLHttpRequest å¯¹è±¡é€šè®¯</p><p>Promise API</p><p>è¯·æ±‚å“åº”æ‹¦æˆªå™¨</p><p>è¯·æ±‚æ•°æ®å’Œå“åº”æ•°æ®è½¬æ¢</p><p>è¯·æ±‚çš„å–æ¶ˆ</p><p>JSON æ•°æ®çš„è‡ªåŠ¨è½¬æ¢</p><p>å®¢æˆ·ç«¯é˜²æ­¢ XSRF</p></blockquote><p>æ¡†æ¶å·¥å…·</p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250129205459495.png" alt="image-20250129205459495" style="zoom:67%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250129205721267.png" alt="image-20250129205721267" style="zoom:67%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250129205345604.png" alt="image-20250129205345604" style="zoom:80%;" /><h3 id="è¯·æ±‚ä»£ç "><a href="#è¯·æ±‚ä»£ç " class="headerlink" title="è¯·æ±‚ä»£ç "></a>è¯·æ±‚ä»£ç </h3><p>axios æœ€åŸºæœ¬çš„æ“ä½œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line"><span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line"><span class="attr">url</span>: <span class="string">&#x27;/simple/get&#x27;</span>,</span><br><span class="line"><span class="attr">params</span>: &#123;</span><br><span class="line"><span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå…¥å£æ–‡ä»¶</p><p><code>index.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">axios</span>(<span class="params">config</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure><p><code>xhr.ts</code></p><blockquote><p><code>xhr</code> å‡½æ•°ç”¨äºå‘é€ HTTP è¯·æ±‚çš„å·¥å…·å‡½æ•°ï¼ŒåŸºäº XMLHttpRequest API å®ç°ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªç®€å•çš„æ¥å£æ¥é…ç½®å’Œå‘é€è¯·æ±‚ã€‚</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">xhr</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> &#123; data = <span class="literal">null</span>, url, method = <span class="string">&#x27;get&#x27;</span> &#125; = config <span class="comment">// è§£æ„è®¾ç½®é»˜è®¤å€¼</span></span><br><span class="line"><span class="keyword">const</span> request = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>() <span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ª XMLHttpRequest å¯¹è±¡ å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url, <span class="literal">true</span>) <span class="comment">// è°ƒç”¨ open æ–¹æ³• å¹¶ä¼ å…¥ method url true ä¸‰ä¸ªå‚æ•° å¹¶å°† method è½¬æ¢ä¸ºå¤§å†™å¹¶èµ‹å€¼ç»™ method,url. async:true</span></span><br><span class="line">request.<span class="title function_">send</span>(data) <span class="comment">// è°ƒç”¨ send æ–¹æ³• å¹¶ä¼ å…¥ data å‚æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250130164413743.png" alt="image-20250130164413743"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="webpack-é…ç½®"><a href="#webpack-é…ç½®" class="headerlink" title="webpack é…ç½®"></a>webpack é…ç½®</h2><blockquote><p>webpack.config.js</p><p>æ•´ä½“å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« modeï¼ˆå¼€å‘æ¨¡å¼ï¼‰ï¼Œentryï¼Œoutputï¼Œmoduleï¼Œresolveï¼Œplugins å‡ ä¸ªå…³é”®å±æ€§</p></blockquote><h3 id="entry"><a href="#entry" class="headerlink" title="entry"></a><em>entry</em></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">entry</span>: fs.<span class="title function_">readdirSync</span>(__dirname).<span class="title function_">reduce</span>(<span class="function">(<span class="params">entries, dir</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fullDir = path.<span class="title function_">join</span>(__dirname, dir)</span><br><span class="line">    <span class="keyword">const</span> entry = path.<span class="title function_">join</span>(fullDir, <span class="string">&#x27;app.ts&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (fs.<span class="title function_">statSync</span>(fullDir).<span class="title function_">isDirectory</span>() &amp;&amp; fs.<span class="title function_">existsSync</span>(entry)) &#123;</span><br><span class="line">        entries[dir] = [<span class="string">&#x27;webpack-hot-middleware/client&#x27;</span>, entry]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> entries</span><br><span class="line">&#125;, &#123;&#125;),</span><br></pre></td></tr></table></figure><blockquote><p>entries æ”¶é›†äº†å¤šä¸ªç›®å½•çš„å…¥å£æ–‡ä»¶ (app.ts) ï¼Œå¹¶å°†æ¯ä¸ªå…¥å£å¼•å…¥ä¸€ä¸ªç”¨äºçƒ­æ›´æ–°çš„æ–‡ä»¶</p><p>entries æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œkey ä¸ºç›®å½•å</p></blockquote><h3 id="output"><a href="#output" class="headerlink" title="output"></a><em>output</em></h3><blockquote><p>å°† entries çš„ key æ‰“åŒ…æˆ filename</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;__build__&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;/__build__/&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="module"><a href="#module" class="headerlink" title="module"></a><em>module</em></h3><blockquote><p>rules å®šä¹‰ä¸€ç³»åˆ—å¤„ç†ä¸åŒç±»å‹æ–‡ä»¶çš„è§„åˆ™</p><p>.ts :<code>tslint-loader</code> è¿›è¡Œé¢„å¤„ç† (åŒ…æ‹¬ç±»å‹æ£€æŸ¥)</p><p>.tsx :<code>transpileOnly: true</code> åªè¿›è¡Œç¼–è¯‘è€Œä¸è¿›è¡Œç±»å‹æ£€æŸ¥</p><p>.css :<code>style-loader</code> å°† CSS æ³¨å…¥åˆ° DOM ä¸­ï¼Œ<code>css-loader</code> å¤„ç† CSS æ–‡ä»¶ä¸­çš„ <code>@import</code> å’Œ <code>url()</code></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">            <span class="attr">enforce</span>: <span class="string">&#x27;pre&#x27;</span>,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;tslint-loader&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;ts-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>: &#123;</span><br><span class="line">                        <span class="attr">transpileOnly</span>: <span class="literal">true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a><em>resolve</em></h3><blockquote><p>æŒ‡å®šåœ¨å¯¼å…¥æ¨¡å—æ—¶å¯ä»¥çœç•¥çš„æ–‡ä»¶æ‰©å±•åï¼ŒWebpack ä¼šè‡ªåŠ¨å°è¯•è¿™äº›æ‰©å±•åã€‚</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resolve</span>: &#123;</span><br><span class="line"><span class="attr">extensions</span>: [<span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a><em>plugins</em></h3><blockquote><p>çƒ­æ›´æ–° | å‘ç”Ÿé”™è¯¯ä¸æ‰“åŒ…æ–‡ä»¶</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line"><span class="keyword">new</span> webpack.<span class="title class_">HotModuleReplacementPlugin</span>(),</span><br><span class="line"><span class="keyword">new</span> webpack.<span class="title class_">NoEmitOnErrorsPlugin</span>(),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒåŠŸèƒ½"><a href="#æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="æ ¸å¿ƒåŠŸèƒ½"></a>æ ¸å¿ƒåŠŸèƒ½</h2><h3 id="å¤„ç†-url-å‚æ•°-params"><a href="#å¤„ç†-url-å‚æ•°-params" class="headerlink" title="å¤„ç† url å‚æ•°(params)"></a>å¤„ç† url å‚æ•°(params)</h3><blockquote><p>æ ¸å¿ƒæ€æƒ³ï¼šæŠŠ params çš„ key&amp;value <strong>è§£æ„æ‹¼æ¥</strong>åˆ° URL ä¸Š</p></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210214938544.png" alt="image-20250210214938544" style="zoom: 50%;" /><p><code>helpers/url.ts</code></p><h4 id="è§£æ„-URL-params"><a href="#è§£æ„-URL-params" class="headerlink" title="è§£æ„ URL -&gt; params"></a>è§£æ„ URL -&gt; params</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">bulidURL</span>(<span class="params"><span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">params</span>?: <span class="built_in">any</span></span>): <span class="built_in">string</span> &#123;<span class="comment">//è§£æ„</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>éœ€å¤„ç†é€»è¾‘</strong></p><p><em>æ²¡æœ‰å‚æ•°</em></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215202014.png" alt="image-20250210215202014" style="zoom:50%;" /><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!params) &#123;</span><br><span class="line"><span class="comment">// æ²¡æœ‰å‚æ•° ç›´æ¥è¿”å› url</span></span><br><span class="line"><span class="keyword">return</span> url</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è§£æ„-params-key-value"><a href="#è§£æ„-params-key-value" class="headerlink" title="è§£æ„ params -&gt; key&#x2F;value"></a>è§£æ„ params -&gt; key&#x2F;value</h4><p>params æ˜¯ä¸€ä¸ªåŒ…å«è¯·æ±‚å‚æ•°çš„å¯¹è±¡</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line"><span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line"><span class="attr">hobbies</span>: [<span class="string">&#x27;reading&#x27;</span>, <span class="string">&#x27;coding&#x27;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“ä»£ç </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">parts</span>: <span class="built_in">string</span>[] = [] <span class="comment">// å­˜æ”¾å‚æ•°çš„æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(params).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123; <span class="comment">// key ä¾æ¬¡å–åˆ° &#x27;name&#x27;, &#x27;age&#x27;, &#x27;hobbies&#x27; ç­‰å€¼</span></span><br><span class="line">    <span class="keyword">const</span> val = params[key] <span class="comment">// å¯¹è±¡keyå€¼æ‰€å¯¹åº”çš„value</span></span><br><span class="line">    ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><em>value ä¸º null æˆ– undefined</em></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (val === <span class="literal">null</span> || <span class="keyword">typeof</span> val === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>value</em> ä¸º <em>æ•°ç»„</em></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210214959177.png" alt="image-20250210214959177" style="zoom:50%;" /><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> values = [] <span class="comment">// å®šä¹‰ values å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(val)) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ value ä¸ºæ•°ç»„ ç›´æ¥èµ‹å€¼ç»™ values</span></span><br><span class="line">values = val</span><br><span class="line">key += <span class="string">&#x27;[]&#x27;</span> <span class="comment">// é”®ååé¢æ·»åŠ ä¸€ä¸ª []</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">values = [val] <span class="comment">// èµ‹å€¼ç»™ values</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>value</em> ä¸º <em>Data</em> | <em>å­—ç¬¦ä¸²</em> | <em>å¯¹è±¡</em></p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215112025.png" alt="image-20250210215112025" style="zoom:50%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215135428.png" alt="image-20250210215135428" style="zoom:50%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215027145.png" alt="image-20250210215027145" style="zoom:50%;" /><p>helpers&#x2F;util.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isDate</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Date</span> &#123;</span><br><span class="line"><span class="keyword">return</span> toString.<span class="title function_">call</span>(val) === <span class="string">&#x27;[object Date]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isObject</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Object</span> &#123;</span><br><span class="line"><span class="keyword">return</span> val !== <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">&#x27;object&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†å›æ¥</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isDate, isObject &#125; <span class="keyword">from</span> <span class="string">&#x27;./util&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encode</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(val)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%40/g</span>, <span class="string">&#x27;@&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%3A/gi</span>, <span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%24/g</span>, <span class="string">&#x27;$&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%2C/gi</span>, <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%20/g</span>, <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%5B/gi</span>, <span class="string">&#x27;[&#x27;</span>)</span><br><span class="line">.<span class="title function_">replace</span>(<span class="regexp">/%5D/gi</span>, <span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">values.<span class="title function_">forEach</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// éå† values</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isDate</span>(val)) &#123;</span><br><span class="line"><span class="comment">// value ä¸ºæ—¥æœŸ</span></span><br><span class="line">val = val.<span class="title function_">toISOString</span>() <span class="comment">// è½¬æ¢ä¸º ISO æ ¼å¼èµ‹å€¼ç»™ val</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isObject</span>(val)) &#123;</span><br><span class="line"><span class="comment">// value ä¸ºå¯¹è±¡</span></span><br><span class="line">val = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(val) <span class="comment">// è½¬æ¢ä¸ºå­—ç¬¦ä¸²èµ‹å€¼ç»™ val</span></span><br><span class="line">&#125;</span><br><span class="line">parts.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;encode(key)&#125;</span>=<span class="subst">$&#123;encode(val)&#125;</span>`</span>) <span class="comment">// ç‰¹æ®Šå­—ç¬¦è½¬ç èµ‹å€¼ç»™ parts</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ‹¼è£…æˆ URL</p><blockquote><p>parts.join(â€˜&amp;â€™) æ•ˆæœ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;[<span class="string">&#x27;name=John&#x27;</span>, <span class="string">&#x27;age=30&#x27;</span>, <span class="string">&#x27;hobbies[]=reading&#x27;</span>, <span class="string">&#x27;hobbies[]=coding&#x27;</span>]</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;name=John&amp;age=30&amp;hobbies[]=reading&amp;hobbies[]=coding&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215213939.png" alt="image-20250210215213939" style="zoom:50%;" /><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250210215227134.png" alt="image-20250210215227134" style="zoom:50%;" /><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> serializedParams = parts.<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>) <span class="comment">// å°† parts æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ &amp; ä½œä¸ºåˆ†éš”ç¬¦</span></span><br><span class="line"><span class="keyword">if</span> (serializedParams) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ serializedParams ä¸ä¸ºç©º åˆ™æ‹¼æ¥ url</span></span><br><span class="line"><span class="keyword">const</span> markIndex = url.<span class="title function_">indexOf</span>(<span class="string">&#x27;#&#x27;</span>) <span class="comment">// æŸ¥æ‰¾ URL ä¸­æ˜¯å¦å­˜åœ¨ # ç¬¦å· è¿”å› # ç¬¦å·åœ¨ URL ä¸­çš„ä½ç½®ç´¢å¼•</span></span><br><span class="line"><span class="keyword">if</span> (markIndex !== -<span class="number">1</span>) &#123;</span><br><span class="line">url = url.<span class="title function_">slice</span>(<span class="number">0</span>, markIndex) <span class="comment">// ä½¿ç”¨sliceæ–¹æ³•å°†URLæˆªå–åˆ°å“ˆå¸Œéƒ¨åˆ†ä¹‹å‰ï¼Œä»è€Œå»é™¤å“ˆå¸Œéƒ¨åˆ†</span></span><br><span class="line">&#125;</span><br><span class="line">url += (url.<span class="title function_">indexOf</span>(<span class="string">&#x27;?&#x27;</span>) === -<span class="number">1</span> ? <span class="string">&#x27;?&#x27;</span> : <span class="string">&#x27;&amp;&#x27;</span>) + serializedParams <span class="comment">// ç¡®ä¿URLä¸­çš„æŸ¥è¯¢å‚æ•°?å­˜åœ¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†-body-æ•°æ®"><a href="#å¤„ç†-body-æ•°æ®" class="headerlink" title="å¤„ç† body æ•°æ®"></a>å¤„ç† body æ•°æ®</h3><p>helpers&#x2F;util.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isDate</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Date</span> &#123;</span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºæ—¥æœŸ</span></span><br><span class="line"><span class="keyword">return</span> toString.<span class="title function_">call</span>(val) === <span class="string">&#x27;[object Date]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// export function isObject(val: any): val is Object &#123;  // åˆ¤æ–­æ˜¯å¦ä¸ºå¯¹è±¡</span></span><br><span class="line"><span class="comment">//   return val !== null &amp;&amp; typeof val === &#x27;object&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isPlainObject</span>(<span class="params"><span class="attr">val</span>: <span class="built_in">any</span></span>): val is <span class="title class_">Object</span> &#123;</span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºæ™®é€šå¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> toString.<span class="title function_">call</span>(val) === <span class="string">&#x27;[object Object]&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>helpers&#x2F;data.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isPlainObject &#125; <span class="keyword">from</span> <span class="string">&#x27;./util&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">transformRequest</span>(<span class="params"><span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(data)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformURL</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† url è¿”å›æ‹¼æ¥åçš„ url</span></span><br><span class="line"><span class="keyword">const</span> &#123; url, params &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">bulidURL</span>(url, params)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformRequestData</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† data</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequest</span>(config.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†-header"><a href="#å¤„ç†-header" class="headerlink" title="å¤„ç† header"></a>å¤„ç† header</h3><blockquote><p>headers ä¸€èˆ¬ä¼ é€’è¯¸å¦‚è®¤è¯ä¿¡æ¯ã€å†…å®¹ç±»å‹ç­‰å…ƒæ•°æ®ç»™æœåŠ¡å™¨</p></blockquote><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250212030911535.png" alt="image-20250212030911535" style="zoom:50%;" /><p>helpers&#x2F;header.ts</p><blockquote><p>å¤„ç† headers</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">processHeaders</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>, <span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// processHeaders å‡½æ•°æ¥æ”¶ headers å’Œ data ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="title function_">normalizeHeaderName</span>(headers, <span class="string">&#x27;Content-Type&#x27;</span>) <span class="comment">// è°ƒç”¨ normalizeHeaderName å‡½æ•°å°† headers çš„ Content-Type å±æ€§åè§„èŒƒåŒ–</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(data)) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ data æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡</span></span><br><span class="line"><span class="keyword">if</span> (headers &amp;&amp; !headers[<span class="string">&#x27;Content-Type&#x27;</span>]) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ headers ä¸å­˜åœ¨ Content-Type å±æ€§</span></span><br><span class="line">headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json;charset=utf-8&#x27;</span> <span class="comment">// è®¾ç½® Content-Type å±æ€§ä¸º application/json;charset=utf-8</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>Content-Type</code> æ˜¯ HTTP è¯·æ±‚å¤´çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæŒ‡ç¤ºå®ä½“ä¸»ä½“ï¼ˆå³è¯·æ±‚æˆ–å“åº”çš„æ­£æ–‡éƒ¨åˆ†ï¼‰çš„æ•°æ®ç±»å‹ã€‚å®ƒå‘Šè¯‰æ¥æ”¶æ–¹å¦‚ä½•è§£ææ¥æ”¶åˆ°çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“å‘é€ JSON æ ¼å¼çš„æ•°æ®æ—¶ï¼Œé€šå¸¸ä¼šå°† <code>Content-Type</code> è®¾ç½®ä¸º <code>application/json</code>ï¼Œè¿™æ ·æ¥æ”¶æ–¹å°±çŸ¥é“åº”è¯¥ä»¥ JSON çš„å½¢å¼æ¥è§£ææ•°æ®</p></blockquote><p>è¾…åŠ©å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeHeaderName</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>, <span class="attr">normalizedName</span>: <span class="built_in">string</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// normalizeHeaderName å‡½æ•°æ¥æ”¶ headers å’Œ normalizedName ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> (!headers) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ headers ä¸å­˜åœ¨</span></span><br><span class="line"><span class="keyword">return</span> <span class="comment">// ç›´æ¥è¿”å›</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// éå† headers çš„æ‰€æœ‰å±æ€§</span></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">name !== normalizedName &amp;&amp;</span><br><span class="line">name.<span class="title function_">toUpperCase</span>() === normalizedName.<span class="title function_">toUpperCase</span>()</span><br><span class="line">) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœå±æ€§åä¸ç­‰äº normalizedName å¹¶ä¸”å±æ€§åçš„å¤§å†™å½¢å¼ç­‰äº normalizedName çš„å¤§å†™å½¢å¼</span></span><br><span class="line">headers[normalizedName] = headers[name] <span class="comment">// å°† headers çš„å±æ€§åè®¾ç½®ä¸º normalizedName (content-type -&gt; Content-Type)</span></span><br><span class="line"><span class="keyword">delete</span> headers[name] <span class="comment">// åˆ é™¤ headers çš„å±æ€§å</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> headers <span class="comment">// è¿”å› headers</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>types&#x2F;index.ts åŠ å…¥ headers</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line"><span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.ts å¢æ·»å¤„ç†é€»è¾‘</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// å…ˆå¤„ç† headers</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// å†å¤„ç† data</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformHeaders</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† headers è°ƒç”¨ processHeaders æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> &#123; headers = &#123;&#125;, data &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">processHeaders</span>(headers, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>xhr.ts æ·»åŠ  header å¤„ç†é€»è¾‘</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">xhr</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="keyword">const</span> &#123; data = <span class="literal">null</span>, url, method = <span class="string">&#x27;get&#x27;</span>, headers &#125; = config <span class="comment">// æ·»åŠ headerè§£æ„</span></span><br><span class="line"><span class="keyword">const</span> request = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>() <span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ª XMLHttpRequest å¯¹è±¡ å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// éå† headers çš„æ‰€æœ‰å±æ€§</span></span><br><span class="line"><span class="keyword">if</span> (data === <span class="literal">null</span> &amp;&amp; name.<span class="title function_">toLowerCase</span>() === <span class="string">&#x27;content-type&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ data ä¸º null å¹¶ä¸”å±æ€§åä¸º content-type</span></span><br><span class="line"><span class="keyword">delete</span> headers[name] <span class="comment">// åˆ é™¤ headers çš„å±æ€§å</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">request.<span class="title function_">setRequestHeader</span>(name, headers[name]) <span class="comment">// è°ƒç”¨ setRequestHeader æ–¹æ³• å¹¶ä¼ å…¥ name headers[name] ä¸¤ä¸ªå‚æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">request.<span class="title function_">send</span>(data) <span class="comment">// è°ƒç”¨ send æ–¹æ³• å¹¶ä¼ å…¥ data å‚æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><blockquote><p>è¿™éƒ¨åˆ†å¤„ç†å®ç°äº†</p><p>ä¸º Content-Type è‡ªåŠ¨æ·»åŠ  application&#x2F;json;charset&#x3D;UTF-8ï¼ˆå‘ŠçŸ¥æœåŠ¡ç«¯è§£æçš„æ˜¯ JSON æ•°æ®ï¼‰</p></blockquote><h3 id="è·å–å¤„ç†-response"><a href="#è·å–å¤„ç†-response" class="headerlink" title="è·å–å¤„ç† response"></a>è·å–å¤„ç† response</h3><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="comment">//configæ¥å£</span></span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line"><span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">responseType</span>?: <span class="title class_">XMLHttpRequestResponseType</span> <span class="comment">//æ–°å¢</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line"><span class="comment">//responseæ¥å£</span></span><br><span class="line"><span class="attr">data</span>: <span class="built_in">any</span></span><br><span class="line"><span class="attr">status</span>: <span class="built_in">number</span></span><br><span class="line"><span class="attr">statusText</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">headers</span>: <span class="built_in">any</span></span><br><span class="line"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line"><span class="attr">request</span>: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosPromise</span> <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;<span class="title class_">AxiosResponse</span>&gt; &#123;</span><br><span class="line"><span class="comment">//promiseæ¥å£</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>xhr.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">xhr</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// xhr å‡½æ•°æ¥æ”¶ä¸€ä¸ª config å‚æ•°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> <span class="comment">// è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ å¹¶ä¼ å…¥ resolve reject ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line">    <span class="keyword">const</span> &#123; data = <span class="literal">null</span>, url, method = <span class="string">&#x27;get&#x27;</span>, headers, responseType &#125; = config <span class="comment">// è§£æ„èµ‹å€¼æ‹¿åˆ°å˜é‡</span></span><br><span class="line">    <span class="keyword">const</span> request = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>() <span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ª XMLHttpRequest å¯¹è±¡ å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (responseType) &#123;</span><br><span class="line">      request.<span class="property">responseType</span> = responseType</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url, <span class="literal">true</span>) <span class="comment">// è°ƒç”¨ open æ–¹æ³• å¹¶ä¼ å…¥ method url true ä¸‰ä¸ªå‚æ•° å¹¶å°† method è½¬æ¢ä¸ºå¤§å†™å¹¶èµ‹å€¼ç»™ method,url. async:trueå¼‚æ­¥</span></span><br><span class="line"></span><br><span class="line">    request.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> <span class="title function_">handleLoad</span>(<span class="params"></span>) &#123;<span class="comment">// è°ƒç”¨ onreadystatechange æ–¹æ³• å¹¶ä¼ å…¥ handleLoad å‡½æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">      <span class="keyword">if</span> (request.<span class="property">readyState</span> !== <span class="number">4</span>) &#123;<span class="comment">// 4çŠ¶æ€ä¸ºæ­£ç¡®æ¥æ”¶åˆ°æ•°æ® (// æ²¡æœ‰æ”¶åˆ°æ­£ç¡®çš„å“åº”)</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> responseHeaders = request.<span class="title function_">getAllResponseHeaders</span>() <span class="comment">// è°ƒç”¨ getAllResponseHeaders æ–¹æ³• å¹¶èµ‹å€¼ç»™ responseHeaders å˜é‡ï¼ˆåé¢è¦å¤„ç†è¿™ä¸ªå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">      <span class="keyword">const</span> responseData = responseType &amp;&amp; responseType !== <span class="string">&#x27;text&#x27;</span> ? request.<span class="property">response</span> : request.<span class="property">responseText</span> <span class="comment">// è°ƒç”¨ responseText æ–¹æ³• å¹¶èµ‹å€¼ç»™ responseData å˜é‡</span></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">response</span>: <span class="title class_">AxiosResponse</span> = &#123;</span><br><span class="line">        <span class="attr">data</span>: responseData,</span><br><span class="line">        <span class="attr">status</span>: request.<span class="property">status</span>,</span><br><span class="line">        <span class="attr">statusText</span>: request.<span class="property">statusText</span>,</span><br><span class="line">        <span class="attr">headers</span>: responseHeaders,</span><br><span class="line">        config,</span><br><span class="line">        request</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">resolve</span>(response) <span class="comment">// è°ƒç”¨ resolve æ–¹æ³• å¹¶ä¼ å…¥ response å‚æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function"><span class="params">name</span> =&gt;</span> &#123;<span class="comment">// éå† headers çš„æ‰€æœ‰å±æ€§</span></span><br><span class="line">      <span class="keyword">if</span> (data === <span class="literal">null</span> &amp;&amp; name.<span class="title function_">toLowerCase</span>() === <span class="string">&#x27;content-type&#x27;</span>) &#123;<span class="comment">// å¦‚æœ data ä¸º null å¹¶ä¸”å±æ€§åä¸º content-type</span></span><br><span class="line">        <span class="keyword">delete</span> headers[name] <span class="comment">// åˆ é™¤ headers çš„å±æ€§å</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        request.<span class="title function_">setRequestHeader</span>(name, headers[name]) <span class="comment">// è°ƒç”¨ setRequestHeader æ–¹æ³• å¹¶ä¼ å…¥ name headers[name] ä¸¤ä¸ªå‚æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    request.<span class="title function_">send</span>(data) <span class="comment">// è°ƒç”¨ send æ–¹æ³• å¹¶ä¼ å…¥ data å‚æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">axios</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line"><span class="comment">// axios å‡½æ•°æ¥æ”¶ä¸€ä¸ª config å‚æ•°</span></span><br><span class="line"><span class="title function_">processConfig</span>(config)</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">xhr</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>getAllResponseHeaders</code>æ–¹æ³•å¤„ç†</p><p>XMLHttpRequest å¯¹è±¡çš„ getAllResponseHeaders æ–¹æ³•è·å–åˆ°çš„å€¼æ˜¯å¦‚ä¸‹å­—ç¬¦ä¸²</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">date<span class="punctuation">:</span>Fri<span class="punctuation">,</span><span class="number">05</span> Apr <span class="number">2019</span> <span class="number">12</span><span class="punctuation">:</span><span class="number">40</span><span class="punctuation">:</span><span class="number">49</span> GMT</span><br><span class="line">etag<span class="punctuation">:</span> W/<span class="string">&quot;d-Ssxx4FRxEutDLwo2+xkkxKc4y0k&#x27;&#x27;</span></span><br><span class="line"><span class="string">connection: keep-alive</span></span><br><span class="line"><span class="string">x-powered-by: Express</span></span><br><span class="line"><span class="string">content-length:13</span></span><br><span class="line"><span class="string">content-type:application/json;charset=utf-8</span></span><br></pre></td></tr></table></figure><blockquote><p>æ¯ä¸€è¡Œéƒ½æ˜¯ä»¥å›è½¦å’Œæ¢è¡Œç¬¦<code>\r\n</code>ç»“æŸï¼Œæ˜¯æ¯ä¸ª header å±æ€§çš„åˆ†éš”ç¬¦</p></blockquote><p>è€Œæˆ‘ä»¬å¸Œæœ›è§£ææˆçš„å¯¹è±¡ç»“æ„</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    date<span class="punctuation">:</span>Fri<span class="punctuation">,</span><span class="number">05</span> Apr <span class="number">2019</span> <span class="number">12</span><span class="punctuation">:</span><span class="number">40</span><span class="punctuation">:</span><span class="number">49</span> GMT</span><br><span class="line">etag<span class="punctuation">:</span> W/<span class="string">&quot;d-Ssxx4FRxEutDLwo2+xkkxKc4y0k&#x27;&#x27;,</span></span><br><span class="line"><span class="string">connection: keep-alive,</span></span><br><span class="line"><span class="string">x-powered-by: Express,</span></span><br><span class="line"><span class="string">content-length:13</span></span><br><span class="line"><span class="string">content-type:application/json;charset=utf-8</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>headers.ts æ–°å¢ parseHeaders æ–¹æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">parseHeaders</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">string</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// parseHeaders å‡½æ•°æ¥æ”¶ headers å‚æ•°</span></span><br><span class="line"><span class="keyword">let</span> parsed = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>) <span class="comment">// åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">if</span> (!headers) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ headers ä¸å­˜åœ¨</span></span><br><span class="line"><span class="keyword">return</span> parsed <span class="comment">// è¿”å› parsed</span></span><br><span class="line">&#125;</span><br><span class="line">headers.<span class="title function_">split</span>(<span class="string">&#x27;\r\n&#x27;</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">line</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// éå† headers çš„æ¯ä¸€è¡Œ</span></span><br><span class="line"><span class="keyword">let</span> [key, val] = line.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>) <span class="comment">// åˆ†å‰²æ¯ä¸€è¡Œçš„ key å’Œ val</span></span><br><span class="line">key = key.<span class="title function_">trim</span>().<span class="title function_">toLowerCase</span>() <span class="comment">// å»æ‰ key çš„ç©ºæ ¼å¹¶å°† key è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line"><span class="keyword">if</span> (!key) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ key ä¸å­˜åœ¨</span></span><br><span class="line"><span class="keyword">return</span> <span class="comment">// ç›´æ¥è¿”å›</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (val) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ val å­˜åœ¨</span></span><br><span class="line">val = val.<span class="title function_">trim</span>() <span class="comment">// å»æ‰ val çš„ç©ºæ ¼</span></span><br><span class="line">&#125;</span><br><span class="line">parsed[key] = val <span class="comment">// å°† key å’Œ val èµ‹å€¼ç»™ parsed</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> parsed <span class="comment">// è¿”å› parsed</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†å“åº”-data"><a href="#å¤„ç†å“åº”-data" class="headerlink" title="å¤„ç†å“åº” data"></a>å¤„ç†å“åº” data</h3><p>ä¸è®¾ç½® responseType æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯è¿”å›æ•°æ®æ˜¯å­—ç¬¦ä¸²ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data: &quot;&#123;&quot;a&quot;:1,&quot;b&quot;:2&#125;&quot;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦è½¬æˆå¯¹è±¡</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data<span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    a<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    b<span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>data.ts æ–°å¢ transformResponse è½¬åŒ–å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">transformResponse</span>(<span class="params"><span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> data === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"><span class="comment">// do nothing</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.ts å¤„ç† axios</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/data&#x27;</span> <span class="comment">// æ–°å¢å¼•å…¥è½¬åŒ–å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">axios</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line"><span class="title function_">processConfig</span>(config)</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">xhr</span>(config).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//è¯·æ±‚ç»“æŸåå¯¹ response data è¿›è¡Œå¤„ç†</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">transformResponseData</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformResponseData</span>(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>): <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† response data</span></span><br><span class="line">res.<span class="property">data</span> = <span class="title function_">transformResponse</span>(res.<span class="property">data</span>)</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/// åŸºç¡€æ ¸å¿ƒåŠŸèƒ½è‡³æ­¤å·²å…¨éƒ¨å®ç° ///</span><br></pre></td></tr></table></figure><h2 id="é”™è¯¯å¤„ç†-reject-æ‹’å›"><a href="#é”™è¯¯å¤„ç†-reject-æ‹’å›" class="headerlink" title="é”™è¯¯å¤„ç†(reject æ‹’å›)"></a>é”™è¯¯å¤„ç†(reject æ‹’å›)</h2><h3 id="å¤„ç†ç½‘ç»œé”™è¯¯"><a href="#å¤„ç†ç½‘ç»œé”™è¯¯" class="headerlink" title="å¤„ç†ç½‘ç»œé”™è¯¯"></a>å¤„ç†ç½‘ç»œé”™è¯¯</h3><p>ç½‘ç»œä¸é€šæ—¶å‘é€è¯·æ±‚ä¼šè§¦å‘ XMLHttpRequest å¯¹è±¡å®ä¾‹çš„ error äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ onerror äº‹ä»¶å›è°ƒå‡½æ•°ä¸­æ•è·æ­¤ç±»é”™è¯¯</p><p>xhr.ts ä¸­æ·»åŠ </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onerror</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨ onerror æ–¹æ³• å¹¶ä¼ å…¥ handleError å‡½æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Network Error&#x27;</span>)) <span class="comment">// è°ƒç”¨ reject æ–¹æ³• å¹¶ä¼ å…¥ Network Error å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†è¶…æ—¶é”™è¯¯"><a href="#å¤„ç†è¶…æ—¶é”™è¯¯" class="headerlink" title="å¤„ç†è¶…æ—¶é”™è¯¯"></a>å¤„ç†è¶…æ—¶é”™è¯¯</h3><p>è®¾ç½®ä¸€ä¸ª timeoutï¼Œå½“è¯·æ±‚è¶…è¿‡æŸä¸ªæ—¶é—´åæ²¡æ”¶åˆ°å“åº”åˆ™ç»ˆæ­¢ï¼Œå¹¶è§¦å‘ timeout äº‹ä»¶</p><blockquote><p>é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 0ï¼ˆæ°¸ä¸è¶…æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å…è®¸ç¨‹åºå¯é…ç½®è¶…æ—¶æ—¶é—´</p></blockquote><p>type &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="comment">//configæ¥å£</span></span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line"><span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">responseType</span>?: <span class="title class_">XMLHttpRequestResponseType</span></span><br><span class="line"><span class="attr">timeout</span>?: <span class="built_in">number</span> <span class="comment">// æ–°å¢timeout</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>xhr.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">data = <span class="literal">null</span>,</span><br><span class="line">url,</span><br><span class="line">method = <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">headers,</span><br><span class="line">responseType,</span><br><span class="line">timeout,</span><br><span class="line">&#125; = config <span class="comment">// æ–°å¢è§£æ„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å¢é€»è¾‘</span></span><br><span class="line"><span class="keyword">if</span> (timeout) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ timeout å­˜åœ¨</span></span><br><span class="line">request.<span class="property">timeout</span> = timeout</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request.<span class="property">ontimeout</span> = <span class="keyword">function</span> <span class="title function_">handleTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Timeout of <span class="subst">$&#123;timeout&#125;</span> ms exceeded`</span>)) <span class="comment">// è¶…è¿‡ $&#123;timeout&#125; æ¯«ç§’ è¶…æ—¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çŠ¶æ€ç å¤„ç†-200-é”™è¯¯"><a href="#çŠ¶æ€ç å¤„ç†-200-é”™è¯¯" class="headerlink" title="çŠ¶æ€ç å¤„ç†(!200 é”™è¯¯)"></a>çŠ¶æ€ç å¤„ç†(!200 é”™è¯¯)</h3><blockquote><p>å¤„ç†æ—¶æœºï¼šæ¥æ”¶åˆ°å“åº”çš„æ—¶å€™</p></blockquote><p>xhr.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> <span class="title function_">handleLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (request.<span class="property">readyState</span> !== <span class="number">4</span>) &#123;</span><br><span class="line"><span class="comment">// æ²¡æœ‰æ”¶åˆ°æ­£ç¡®çš„å“åº”</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¹Ÿå°±æ˜¯åœ¨è¿™é‡Œ//</span></span><br><span class="line"><span class="keyword">if</span> (request.<span class="property">status</span> === <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœå‘é€ç½‘ç»œé”™è¯¯ || è¶…æ—¶é”™è¯¯</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">resolve</span>(response) <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// ä¼ å…¥å¤„ç† response å‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> (response.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; response.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line"><span class="comment">// çŠ¶æ€ç  å¤§äºç­‰äº 200 å¹¶ä¸”å°äº 300</span></span><br><span class="line"><span class="title function_">resolve</span>(response) <span class="comment">// è°ƒç”¨ resolve æ–¹æ³• å¹¶ä¼ å…¥ response å‚æ•°</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Request failed with status code <span class="subst">$&#123;response.status&#125;</span>`</span>)) <span class="comment">// æŠ¥é”™çŠ¶æ€ç </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é”™è¯¯ä¿¡æ¯å¢å¼º"><a href="#é”™è¯¯ä¿¡æ¯å¢å¼º" class="headerlink" title="é”™è¯¯ä¿¡æ¯å¢å¼º"></a>é”™è¯¯ä¿¡æ¯å¢å¼º</h3><blockquote><p>æŒ‰ç…§ä¹‹å‰çš„æ“ä½œï¼Œæˆ‘ä»¬å®ç°äº†å¯¹åŸºç¡€é”™è¯¯ä¿¡æ¯çš„å¤„ç†ï¼Œä½†æˆ‘ä»¬å¯¹å¤–æä¾›çš„é”™è¯¯ä¿¡æ¯æ˜¯ååˆ†æœ‰é™çš„</p><p>æˆ‘ä»¬å¸Œæœ›å¯¹å¤–æä¾›çš„é”™è¯¯ä¿¡æ¯åŒ…æ‹¬</p><p>é”™è¯¯æ–‡æœ¬ä¿¡æ¯ï¼ˆæŠ¥é”™æ˜¾ç¤ºï¼‰</p><p>è¯·æ±‚å¯¹è±¡é…ç½® config</p><p>é”™è¯¯ä»£ç  code</p><p>XMLHttpRequest å¯¹è±¡å®ä¾‹ request</p><p>è‡ªå®šä¹‰å“åº”å¯¹è±¡ response</p></blockquote><h4 id="åˆ›å»º-AxiosError-ç±»"><a href="#åˆ›å»º-AxiosError-ç±»" class="headerlink" title="åˆ›å»º AxiosError ç±»"></a>åˆ›å»º AxiosError ç±»</h4><p>types &#x2F; index.ts å®šä¹‰æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosError</span> <span class="keyword">extends</span> <span class="title class_">Error</span> &#123;</span><br><span class="line"><span class="comment">//erroræ¥å£</span></span><br><span class="line"><span class="attr">isAxiosError</span>: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line"><span class="attr">code</span>?: <span class="built_in">string</span></span><br><span class="line"><span class="attr">request</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å»º helpers &#x2F; error.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AxiosError</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªAxiosErrorç±»ç»§æ‰¿Errorç±» å®ç°AxiosErroræ¥å£ å¹¶è®¾ç½® isAxiosErrorä¸ºtrue</span></span><br><span class="line"><span class="attr">isAxiosError</span>: <span class="built_in">boolean</span></span><br><span class="line"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line"><span class="attr">code</span>?: <span class="built_in">string</span> | <span class="literal">null</span></span><br><span class="line"><span class="attr">request</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params"><span class="comment">//æ„é€ å‡½æ•° æ¥æ”¶äº”ä¸ªå‚æ•°èµ‹å€¼ç»™å¯¹åº”çš„å±æ€§ å¹¶è®¾ç½® isAxiosErrorä¸ºtrue</span></span></span><br><span class="line"><span class="params"><span class="attr">message</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>,</span></span><br><span class="line"><span class="params"><span class="attr">code</span>?: <span class="built_in">string</span> | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params"><span class="attr">request</span>?: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params"><span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">super</span>(message) <span class="comment">//è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•° ä¼ å…¥messageå‚æ•°èµ‹å€¼ç»™messageå±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">config</span> = config</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">code</span> = code</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">request</span> = request</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">response</span> = response</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">isAxiosError</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="variable language_">this</span>, <span class="title class_">AxiosError</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// ä¿®å¤åŸå‹é“¾é—®é¢˜</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createError</span>(<span class="params"> <span class="comment">//å®šä¹‰ä¸€ä¸ªcreateErrorå‡½æ•° æ¥æ”¶äº”ä¸ªå‚æ•° å¹¶è¿”å›ä¸€ä¸ªAxiosErrorå¯¹è±¡</span></span></span><br><span class="line"><span class="params"><span class="attr">message</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>,</span></span><br><span class="line"><span class="params"><span class="attr">code</span>?: <span class="built_in">string</span> | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params"><span class="attr">request</span>?: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params"><span class="attr">response</span>?: <span class="title class_">AxiosResponse</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> error = <span class="keyword">new</span> <span class="title class_">AxiosError</span>(message, config, code, request, response)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="createError-æ–¹æ³•åº”ç”¨"><a href="#createError-æ–¹æ³•åº”ç”¨" class="headerlink" title="createError æ–¹æ³•åº”ç”¨"></a>createError æ–¹æ³•åº”ç”¨</h4><blockquote><p>å¯¹é”™è¯¯å¯¹è±¡åˆ›å»ºçš„é€»è¾‘è¿›è¡Œä¿®æ”¹</p></blockquote><p>xhr.ts</p><p><strong><em>onerror ä¿®æ”¹</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onerror</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Network Error&#x27;</span>)) <span class="comment">// è°ƒç”¨ reject æ–¹æ³• å¹¶ä¼ å…¥ Network Error å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›¿æ¢ä¸º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onerror</span> = <span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="title function_">createError</span>(<span class="string">&#x27;Network Error&#x27;</span>, config, <span class="literal">null</span>, request)) <span class="comment">// ä¼ å…¥ &#x27;Network Error&#x27;,config,null,request å‚æ•°ï¼ˆäº‹ä»¶è§¦å‘æ—¶æ‹¿ä¸åˆ°responseå°±ä¸ä¼ äº†ï¼‰ è°ƒç”¨ createError æ–¹æ³•å¹¶ä¼ å…¥å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><em>ontimeout ä¿®æ”¹</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">ontimeout</span> = <span class="keyword">function</span> <span class="title function_">handleTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨ ontimeout æ–¹æ³• å¹¶ä¼ å…¥ handleTimeout å‡½æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Timeout of <span class="subst">$&#123;timeout&#125;</span> ms exceeded`</span>)) <span class="comment">// è°ƒç”¨ reject æ–¹æ³• å¹¶ä¼ å…¥ Timeout of $&#123;timeout&#125; ms exceeded å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›¿æ¢ä¸º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">ontimeout</span> = <span class="keyword">function</span> <span class="title function_">handleTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨ ontimeout æ–¹æ³• å¹¶ä¼ å…¥ handleTimeout å‡½æ•° å¹¶èµ‹å€¼ç»™ request å˜é‡</span></span><br><span class="line"><span class="title function_">reject</span>(</span><br><span class="line"><span class="title function_">createError</span>(</span><br><span class="line"><span class="string">`Timeout of <span class="subst">$&#123;timeout&#125;</span> ms exceeded`</span>,</span><br><span class="line">config,</span><br><span class="line"><span class="string">&#x27;ECONNABORTED&#x27;</span>,</span><br><span class="line">request</span><br><span class="line">)</span><br><span class="line">) <span class="comment">// ä¼ å…¥ `Timeout of $&#123;timeout&#125; ms exceeded`,config,&#x27;ECONNABORTED&#x27;,request å‚æ•° è°ƒç”¨ createError æ–¹æ³• å¹¶ä¼ å…¥å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><em>handleResponse ä¿®æ”¹</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// ä¼ å…¥å¤„ç† response å‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> (response.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; response.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line"><span class="comment">// çŠ¶æ€ç  å¤§äºç­‰äº 200 å¹¶ä¸”å°äº 300</span></span><br><span class="line"><span class="title function_">resolve</span>(response) <span class="comment">// è°ƒç”¨ resolve æ–¹æ³• å¹¶ä¼ å…¥ response å‚æ•°</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Request failed with status code <span class="subst">$&#123;response.status&#125;</span>`</span>)) <span class="comment">// è°ƒç”¨ reject æ–¹æ³• å¹¶ä¼ å…¥ Request failed with status code $&#123;response.status&#125; å‚æ•°</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›¿æ¢ä¸º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params"><span class="attr">response</span>: <span class="title class_">AxiosResponse</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// ä¼ å…¥å¤„ç† response å‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> (response.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; response.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line"><span class="comment">// çŠ¶æ€ç  å¤§äºç­‰äº 200 å¹¶ä¸”å°äº 300</span></span><br><span class="line"><span class="title function_">resolve</span>(response) <span class="comment">// è°ƒç”¨ resolve æ–¹æ³• å¹¶ä¼ å…¥ response å‚æ•°</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">reject</span>(</span><br><span class="line"><span class="title function_">createError</span>(</span><br><span class="line"><span class="string">`Request failed with status code <span class="subst">$&#123;response.status&#125;</span>`</span>,</span><br><span class="line">config,</span><br><span class="line"><span class="literal">null</span>,</span><br><span class="line">request,</span><br><span class="line">response</span><br><span class="line">)</span><br><span class="line">) <span class="comment">// ä¼ å…¥ `Request failed with status code $&#123;response.status&#125;`,config,null,request,response å‚æ•° è°ƒç”¨ createError æ–¹æ³• å¹¶ä¼ å…¥å‚æ•°</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¥å£æ‰©å±•"><a href="#æ¥å£æ‰©å±•" class="headerlink" title="æ¥å£æ‰©å±•"></a>æ¥å£æ‰©å±•</h2><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><blockquote><p>ä¸ºäº†ç”¨æˆ·æ›´åŠ æ–¹ä¾¿åœ°ä½¿ç”¨ axios å‘é€è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ‰€æœ‰æ”¯æŒçš„è¯·æ±‚æ–¹æ³•æ‰©å±•ä¸€äº›æ¥å£</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//[å¯é€‰é¡¹]</span></span><br><span class="line">axios.<span class="property">request</span>(config)</span><br><span class="line">axios.<span class="property">get</span>(url[,config])</span><br><span class="line">axios.<span class="property">delete</span>(url[,config])</span><br><span class="line">axios.<span class="property">head</span>(url[,config])</span><br><span class="line">axios.<span class="property">options</span>(url[,config])</span><br><span class="line">axios.<span class="property">post</span>(url[,datal,config])</span><br><span class="line">axios.<span class="property">put</span>(url[,datal,config])</span><br><span class="line">axios.<span class="property">patch</span>(url[,datal,config])</span><br></pre></td></tr></table></figure><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line"><span class="comment">//axiosæ¥å£</span></span><br><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">get</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">delete</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">head</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">options</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">post</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: <span class="built_in">any</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">put</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: <span class="built_in">any</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line"><span class="title function_">patch</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">data</span>?: <span class="built_in">any</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInstance</span> <span class="keyword">extends</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line"><span class="comment">//axioså®ä¾‹æ¥å£ æ—¢æœ‰å‡½æ•°ç±»å‹åˆæœ‰å±æ€§æ¥å£</span></span><br><span class="line">(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º-Axios-ts"><a href="#åˆ›å»º-Axios-ts" class="headerlink" title="åˆ›å»º Axios.ts"></a>åˆ›å»º Axios.ts</h3><blockquote><p>å­˜æ”¾ä¸€äº›å‘é€è¯·æ±‚æ ¸å¿ƒä»£ç </p></blockquote><p>core &#x2F; Axios.ts &#x2F;&#x2F;å¤§å†™è¡¨ç¤ºæ˜¯ä¸€ä¸ªç±»</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line"><span class="comment">// å®ç°requestæ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>core &#x2F; dispatchRequest.ts</p><blockquote><p>å°è£… axios.ts æ ¸å¿ƒä»£ç </p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> xhr <span class="keyword">from</span> <span class="string">&#x27;../xhr&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; bulidURL &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/url&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/data&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; processHeaders &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/header&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">dispatchRequest</span>(<span class="params"></span></span><br><span class="line"><span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line"><span class="comment">// dispatchRequest å‡½æ•°æ¥æ”¶ä¸€ä¸ª config å‚æ•°</span></span><br><span class="line"><span class="title function_">processConfig</span>(config)</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">xhr</span>(config).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//è¯·æ±‚ç»“æŸåå¯¹ response data è¿›è¡Œå¤„ç†</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">transformResponseData</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// å…ˆå¤„ç† headers</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// å†å¤„ç† data</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformURL</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† url è¿”å›æ‹¼æ¥åçš„ url</span></span><br><span class="line"><span class="keyword">const</span> &#123; url, params &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">bulidURL</span>(url, params)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformRequestData</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† data è°ƒç”¨ transformRequest æ–¹æ³•</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequest</span>(config.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformHeaders</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† headers è°ƒç”¨ processHeaders æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> &#123; headers = &#123;&#125;, data &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">processHeaders</span>(headers, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformResponseData</span>(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>): <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† response data</span></span><br><span class="line">res.<span class="property">data</span> = <span class="title function_">transformResponse</span>(res.<span class="property">data</span>)</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç„¶åå°† xhr.ts ç§»å…¥ core æ–‡ä»¶å¤¹ï¼ˆxhr ä¹Ÿä½œä¸ºæ ¸å¿ƒæ¨¡å—ï¼‰</p></blockquote><p><strong>éƒ¨åˆ†æŠ¥é”™ä¿®æ”¹</strong> (ä¸¥æ ¼æ¨¡å¼)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//dispatchRequest.ts</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">bulidURL</span>(url!, params)</span><br><span class="line"></span><br><span class="line"><span class="comment">//xht.ts</span></span><br><span class="line">request.<span class="title function_">open</span>(method.<span class="title function_">toUpperCase</span>(), url!, <span class="literal">true</span>) <span class="comment">// è°ƒç”¨ open æ–¹æ³•ä¼ å…¥ method url true ä¸‰ä¸ªå‚æ•° å¹¶å°† method è½¬æ¢ä¸ºå¤§å†™å¹¶èµ‹å€¼ç»™ method,url. async:trueå¼‚æ­¥</span></span><br></pre></td></tr></table></figure><blockquote><p>Tipsï¼š æ–­è¨€ï¼ˆ ! ï¼‰</p><blockquote><p>TS ä¸­ï¼Œå½“ä½ ä¿è¯æŸä¸ªå˜é‡ä¸ä¼šä¸º <code>null</code> æˆ–è€… <code>undefined</code>ï¼Œä½†ç¼–è¯‘å™¨å´æ— æ³•æ¨æ–­å‡ºæ¥çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨éç©ºæ–­è¨€æ“ä½œç¬¦ ( ! )ï¼Œä¸ä¼šåœ¨è¿è¡Œæ—¶è¿›è¡Œæ£€æŸ¥ï¼Œä½†è¦æ˜¯ä½ åšå‡ºäº†é”™è¯¯çš„ä¿è¯ï¼Œåœ¨è¿è¡Œæ—¶å°±å¯èƒ½ä¼šå‡ºç°é”™è¯¯ã€‚</p></blockquote></blockquote><h3 id="å®ç°-Axios-ç±»ä¸­æ¥å£"><a href="#å®ç°-Axios-ç±»ä¸­æ¥å£" class="headerlink" title="å®ç° Axios ç±»ä¸­æ¥å£"></a>å®ç° Axios ç±»ä¸­æ¥å£</h3><p><code>Axios.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> dispatchRequest <span class="keyword">from</span> <span class="string">&#x27;./dispatchRequest&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">  <span class="title function_">request</span>(...)</span><br><span class="line">  <span class="title function_">get</span>(...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <strong><em>request</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥configå‚æ•° å¹¶è¿”å›AxiosPromise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong><em>é€»è¾‘å°è£…</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">_requestMethodWithoutData</span>(</span><br><span class="line">    <span class="attr">method</span>: <span class="title class_">Method</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line">    <span class="comment">// å°è£…_requestMethodWithoutDataæ–¹æ³•ä¼ å…¥method,urlå’Œconfigå‚æ•° å¹¶è¿”å›AxiosPromise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="title class_">Object</span>.<span class="title function_">assign</span>(config || &#123;&#125;, &#123; method, url &#125;)) <span class="comment">// è°ƒç”¨requestæ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>å®ç° <strong><em>get</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">get</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥urlå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;get&#x27;</span>, url, config) <span class="comment">// è°ƒç”¨æ–¹æ³• ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <strong><em>delete</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">delete</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥urlå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;delete&#x27;</span>, url, config) <span class="comment">// è°ƒç”¨æ–¹æ³• ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <strong><em>head</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">head</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥urlå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;head&#x27;</span>, url, config) <span class="comment">// è°ƒç”¨æ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <strong><em>options</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">options</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥urlå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithoutData</span>(<span class="string">&#x27;options&#x27;</span>, url, config) <span class="comment">// è°ƒç”¨æ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong><em>é€»è¾‘å°è£…</em></strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">_requestMethodWithData</span>(</span><br><span class="line">    <span class="attr">method</span>: <span class="title class_">Method</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">data</span>?: <span class="built_in">any</span>,</span><br><span class="line">    <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">): <span class="title class_">AxiosPromise</span> &#123;</span><br><span class="line">    <span class="comment">// å°è£…_requestMethodWithDataæ–¹æ³•ä¼ å…¥method,url,dataå’Œconfigå‚æ•° å¹¶è¿”å›AxiosPromise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="title class_">Object</span>.<span class="title function_">assign</span>(config || &#123;&#125;, &#123; method, url, data &#125;)) <span class="comment">// è°ƒç”¨requestæ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>å®ç° <strong><em>post</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">head</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥url,dataå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithData</span>(<span class="string">&#x27;post&#x27;</span>, url, data, config) <span class="comment">// è°ƒç”¨æ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <strong><em>put</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">put</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥url,dataå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithData</span>(<span class="string">&#x27;put&#x27;</span>, url, data, config) <span class="comment">// è°ƒç”¨æ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <strong><em>patch</em></strong> æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">patch</span>(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// ä¼ å…¥url,dataå’Œconfigå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_requestMethodWithData</span>(<span class="string">&#x27;patch&#x27;</span>, url, data, config) <span class="comment">// è°ƒç”¨æ–¹æ³• å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ··åˆå¯¹è±¡å®ç°"><a href="#æ··åˆå¯¹è±¡å®ç°" class="headerlink" title="æ··åˆå¯¹è±¡å®ç°"></a>æ··åˆå¯¹è±¡å®ç°</h3><blockquote><p>é¦–å…ˆè¿™ä¸ªå¯¹è±¡æ˜¯å‡½æ•°ï¼Œå…¶æ¬¡è¿™ä¸ªå¯¹è±¡åŒ…æ‹¬ Axios ç±»å†…æ‰€æœ‰åŸå‹å±æ€§å’Œå®ä¾‹å±æ€§</p></blockquote><p>helpers &#x2F; utils</p><blockquote><p><code>extend</code> åˆæˆå‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> target = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">const</span> source = &#123; <span class="attr">b</span>: <span class="number">2</span> &#125;</span><br><span class="line"><span class="keyword">const</span> result = <span class="title function_">extend</span>(target, source)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result) <span class="comment">// è¾“å‡º: &#123; a: 1, b: 2 &#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨**<em>æ³›å‹</em>** <code>T</code> å’Œ <code>U</code></p><p><code>T</code> ä»£è¡¨ç›®æ ‡å¯¹è±¡ <code>to</code> çš„ç±»å‹ï¼Œ<code>U</code> ä»£è¡¨æºå¯¹è±¡ <code>from</code> çš„ç±»å‹</p><p>å‡½æ•°çš„è¿”å›å€¼ç±»å‹æ˜¯ <code>T &amp; U</code>ï¼Œä¹Ÿå°±æ˜¯ <code>to</code> å’Œ <code>from</code> ä¸¤ä¸ªå¯¹è±¡ç±»å‹çš„äº¤é›†ã€‚</p></blockquote></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> extend&lt;T, U&gt;(<span class="attr">to</span>: T, <span class="attr">from</span>: U): T &amp; U &#123;</span><br><span class="line"><span class="comment">// åˆå¹¶å¯¹è±¡</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="keyword">from</span>) &#123;</span><br><span class="line">;(to <span class="keyword">as</span> T &amp; U)[key] = <span class="keyword">from</span>[key] <span class="keyword">as</span> <span class="built_in">any</span> <span class="comment">//æŠŠ from å¯¹è±¡çš„å±æ€§å€¼èµ‹å€¼ç»™ to å¯¹è±¡å¯¹åº”çš„å±æ€§ã€‚è¿™é‡Œè¿ç”¨äº†ç±»å‹æ–­è¨€ as T &amp; U å’Œ as anyï¼Œè®© TypeScript ç¼–è¯‘å™¨è®¤å¯è¿™ç§èµ‹å€¼æ“ä½œã€‚</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> to <span class="keyword">as</span> T &amp; U <span class="comment">//ä¹Ÿç”¨äº†ç±»å‹æ–­è¨€ as T &amp; U</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å·¥å‚å‡½æ•°å®ç°"><a href="#å·¥å‚å‡½æ•°å®ç°" class="headerlink" title="å·¥å‚å‡½æ•°å®ç°"></a>å·¥å‚å‡½æ•°å®ç°</h3><p>å¤„ç† axios.ts</p><blockquote><p>åˆ æ‰å†…å®¹ï¼Œåªä¿ç•™ export default axios</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosInstance</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Axios</span> <span class="keyword">from</span> <span class="string">&#x27;./core/Axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/util&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"></span>): <span class="title class_">AxiosInstance</span> &#123;</span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> <span class="title class_">Axios</span>() <span class="comment">//å®ä¾‹åŒ–ä¸€ä¸ª Axios å¯¹è±¡ å¹¶èµ‹å€¼ç»™ context å˜é‡</span></span><br><span class="line"><span class="keyword">const</span> instance = <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span>.<span class="title function_">bind</span>(context) <span class="comment">//è°ƒç”¨ request æ–¹æ³• å¹¶ä¼ å…¥ context å‚æ•° å¹¶èµ‹å€¼ç»™ instance å˜é‡ ç»‘å®š this æŒ‡å‘ context</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">extend</span>(instance, context) <span class="comment">//è°ƒç”¨ extend æ–¹æ³• å¹¶ä¼ å…¥ instance å’Œ context å‚æ•° å®ç° instance å¯¹è±¡ç»§æ‰¿ context å¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> instance <span class="keyword">as</span> <span class="title class_">AxiosInstance</span> <span class="comment">//è¿”å› instance å¯¹è±¡ å¹¶æ–­è¨€ä¸º AxiosInstance ç±»å‹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="title function_">createInstance</span>() <span class="comment">//è°ƒç”¨ createInstance æ–¹æ³• å¹¶èµ‹å€¼ç»™ axios å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure><h3 id="axios-å‡½æ•°é‡è½½"><a href="#axios-å‡½æ•°é‡è½½" class="headerlink" title="axios å‡½æ•°é‡è½½"></a>axios å‡½æ•°é‡è½½</h3><blockquote><p>ç›®å‰æˆ‘ä»¬å‡½æ•°åªèƒ½å­˜æ”¾ä¸€ä¸ªå¯¹è±¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">url: &#x27;/extend/post&#x27;,</span><br><span class="line">method: &#x27;post&#x27;,</span><br><span class="line">data:&#123;</span><br><span class="line">msg:&#x27;hi&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚æœ axios åŒæ—¶å«æœ‰ä¸¤ä¸ªå‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">axios(&#x27;/extend/post&#x27;,&#123;</span><br><span class="line">method: &#x27;post&#x27;,</span><br><span class="line">data:&#123;</span><br><span class="line">msg:&#x27;hi&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></blockquote><p>type &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInstance</span> <span class="keyword">extends</span> <span class="title class_">Axios</span> &#123;<span class="comment">//axioså®ä¾‹æ¥å£ æ—¢æœ‰å‡½æ•°ç±»å‹åˆæœ‰å±æ€§æ¥å£</span></span><br><span class="line">  (<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromis</span>) <span class="comment">//(configå•å‚)</span></span><br><span class="line">  (<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> <span class="comment">//æ·»åŠ ï¼šå‡½æ•°é‡è½½(url+configåŒå‚)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>core &#x2F; Axios.ts</p><blockquote><p>ä¿®æ”¹ request æ–¹æ³•</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// å®ç°requestæ–¹æ³•ä¼ å…¥configå‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¹ä¸º ğŸ‘‡</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">url</span>: <span class="built_in">any</span>, <span class="attr">config</span>: <span class="built_in">any</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// å®ç°requestæ–¹æ³•ä¼ å…¥urlï¼Ÿconfigï¼Ÿå‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">&#x27;string&#x27;</span>) &#123; <span class="comment">//url+configåŒå‚</span></span><br><span class="line">        <span class="keyword">if</span> (!config) &#123;</span><br><span class="line">            config = &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        config.<span class="property">url</span> = url</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//configå•å‚</span></span><br><span class="line">        config = url <span class="comment">//æ­¤æ—¶çš„urlå°±æ˜¯config</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å“åº”æ•°æ®æ”¯æŒæ³›å‹"><a href="#å“åº”æ•°æ®æ”¯æŒæ³›å‹" class="headerlink" title="å“åº”æ•°æ®æ”¯æŒæ³›å‹"></a>å“åº”æ•°æ®æ”¯æŒæ³›å‹</h3><blockquote><p>é€šå¸¸æƒ…å†µï¼Œæˆ‘ä»¬ä¼šå°†åç«¯è¿”å›æ•°æ®æ ¼å¼å•ç‹¬æ”¾å…¥ä¸€ä¸ªæ¥å£ä¸­</p></blockquote><p>è®¾ç½®æ³›å‹ï¼Œæé«˜ç±»å‹çµæ´»æ€§</p><p>type &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosResponse</span>&lt;T = <span class="built_in">any</span>&gt; &#123; <span class="comment">//responseæ¥å£</span></span><br><span class="line">    <span class="attr">data</span>: T</span><br><span class="line">    <span class="attr">status</span>: <span class="built_in">number</span></span><br><span class="line">    <span class="attr">statusText</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">headers</span>: <span class="built_in">any</span></span><br><span class="line">    <span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">    <span class="attr">request</span>: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosPromise</span>&lt;T = <span class="built_in">any</span>&gt; <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;<span class="title class_">AxiosResponse</span>&lt;T&gt;&gt; &#123; <span class="comment">//promiseæ¥å£</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Axios</span> &#123; <span class="comment">//axiosæ¥å£</span></span><br><span class="line">    request&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt;</span><br><span class="line">    get&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInstance</span> <span class="keyword">extends</span> <span class="title class_">Axios</span> &#123; <span class="comment">//axioså®ä¾‹æ¥å£ æ—¢æœ‰å‡½æ•°ç±»å‹åˆæœ‰å±æ€§æ¥å£</span></span><br><span class="line">&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt;</span><br><span class="line">&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosPromise</span>&lt;T&gt; <span class="comment">//å‡½æ•°é‡è½½</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‹¦æˆªå™¨å®ç°"><a href="#æ‹¦æˆªå™¨å®ç°" class="headerlink" title="æ‹¦æˆªå™¨å®ç°"></a>æ‹¦æˆªå™¨å®ç°</h2><blockquote><p>ä¹Ÿå°±æ˜¯ axios äºŒæ¬¡å°è£…ä¸­å¸¸è§çš„è¯·æ±‚æ‹¦æˆªå™¨ &amp; å“åº”æ‹¦æˆªå™¨</p><p>æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ç”¨æˆ· asios æ‹¦æˆªå™¨æ˜¯æ€ä¹ˆå†™çš„</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>:<span class="string">&#x27;/api</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">instance.interceptors.request.use(res =&gt;&#123;//è¯·æ±‚æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="string">    console.log(&#x27;</span>res<span class="string">&#x27;,res)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">instance.interceptors.response.use(res =&gt;&#123;//å“åº”æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="string">    console.log(&#x27;</span>res<span class="string">&#x27;,res)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default instance</span></span><br></pre></td></tr></table></figure><p>Tipï¼šrequest æ˜¯åæ·»åŠ çš„å…ˆæ‰§è¡Œï¼Œresponse æ˜¯å…ˆæ·»åŠ çš„å…ˆæ‰§è¡Œ</p></blockquote><h3 id="æ‹¦æˆªå™¨ç®¡ç†ç±»"><a href="#æ‹¦æˆªå™¨ç®¡ç†ç±»" class="headerlink" title="æ‹¦æˆªå™¨ç®¡ç†ç±»"></a>æ‹¦æˆªå™¨ç®¡ç†ç±»</h3><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosInterceptorManager</span>&lt;T&gt; &#123;</span><br><span class="line"><span class="comment">//æ‹¦æˆªå™¨æ¥å£</span></span><br><span class="line"><span class="title function_">use</span>(<span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt;, <span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span>): <span class="built_in">number</span> <span class="comment">//æ·»åŠ æ‹¦æˆªå™¨ è¿”å›æ‹¦æˆªå™¨id</span></span><br><span class="line"><span class="title function_">eject</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">void</span> <span class="comment">//åˆ é™¤æ‹¦æˆªå™¨ è¿”å›æ‹¦æˆªå™¨id</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ResolvedFn</span>&lt;T = <span class="built_in">any</span>&gt; &#123;</span><br><span class="line"><span class="comment">//æˆåŠŸæ‹¦æˆªå™¨æ¥å£</span></span><br><span class="line">(<span class="attr">val</span>: T): T | <span class="title class_">Promise</span>&lt;T&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">RejectedFn</span> &#123;</span><br><span class="line"><span class="comment">//å¤±è´¥æ‹¦æˆªå™¨æ¥å£</span></span><br><span class="line">(<span class="attr">error</span>: <span class="built_in">any</span>): <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>core &#x2F; interceptorManager.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ResolvedFn</span>, <span class="title class_">RejectedFn</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Interceptor</span>&lt;T&gt; &#123;</span><br><span class="line"><span class="comment">// æ‹¦æˆªå™¨æ¥å£</span></span><br><span class="line"><span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt;</span><br><span class="line"><span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">InterceptorManager</span>&lt;T&gt; &#123;</span><br><span class="line"><span class="comment">// æ‹¦æˆªå™¨ç®¡ç†ç±»</span></span><br><span class="line"><span class="keyword">private</span> <span class="attr">interceptors</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Interceptor</span>&lt;T&gt;&gt; <span class="comment">// æ‹¦æˆªå™¨æ•°ç»„å­˜æ”¾çš„æ˜¯æ‹¦æˆªå™¨å¯¹è±¡ æ¯ä¸ªå¯¹è±¡æœ‰ä¸¤ä¸ªå±æ€§ resolved rejected</span></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// æ„é€ å‡½æ•° åˆå§‹åŒ–æ‹¦æˆªå™¨æ•°ç»„</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">interceptors</span> = [] <span class="comment">// æ‹¦æˆªå™¨æ•°ç»„ä¸­å­˜æ”¾çš„æ˜¯æ‹¦æˆªå™¨å¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">use</span>(<span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt;, <span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span>): <span class="built_in">number</span> &#123;</span><br><span class="line"><span class="comment">// æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line"><span class="comment">// å°†æ‹¦æˆªå™¨å¯¹è±¡æ·»åŠ åˆ°æ‹¦æˆªå™¨æ•°ç»„ä¸­</span></span><br><span class="line">resolved,</span><br><span class="line">rejected,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">length</span> - <span class="number">1</span> <span class="comment">// è¿”å›æ‹¦æˆªå™¨çš„id ç”¨äºåˆ é™¤æ‹¦æˆªå™¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">forEach</span>(<span class="attr">fn</span>: <span class="function">(<span class="params"><span class="attr">interceptor</span>: <span class="title class_">Interceptor</span>&lt;T&gt;</span>) =&gt;</span> <span class="built_in">void</span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// éå†æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">interceptor</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// éå†æ‹¦æˆªå™¨æ•°ç»„</span></span><br><span class="line"><span class="keyword">if</span> (interceptor !== <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">// åˆ¤æ–­æ‹¦æˆªå™¨æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="title function_">fn</span>(interceptor) <span class="comment">// å­˜åœ¨åˆ™è°ƒç”¨fnå‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">eject</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// åˆ é™¤æ‹¦æˆªå™¨ é€šè¿‡idåˆ é™¤æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">interceptors</span>[id]) &#123;</span><br><span class="line"><span class="comment">// åˆ¤æ–­æ‹¦æˆªå™¨æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">interceptors</span>[id] = <span class="literal">null</span> <span class="comment">// å­˜åœ¨åˆ™å°†æ‹¦æˆªå™¨ç½®ä¸ºnull</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é“¾å¼è°ƒç”¨å®ç°"><a href="#é“¾å¼è°ƒç”¨å®ç°" class="headerlink" title="é“¾å¼è°ƒç”¨å®ç°"></a>é“¾å¼è°ƒç”¨å®ç°</h3><p>core &#x2F; Axios.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>,<span class="title class_">AxiosResponse</span>, <span class="title class_">Method</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">InterceptorManager</span> <span class="keyword">from</span> <span class="string">&#x27;./interceptorManager&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Interceptors</span> &#123;</span><br><span class="line">    <span class="attr">request</span>: <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;</span><br><span class="line">    <span class="attr">response</span>: <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">    <span class="attr">interceptors</span>: <span class="title class_">Interceptors</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">interceptors</span> = &#123; <span class="comment">//ç”¨æˆ·å¯ä»¥é€šè¿‡axios.interceptors.request.use()æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line">            <span class="attr">request</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;(),</span><br><span class="line">            <span class="attr">response</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">request</span>(...)...</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œå–„ request (å®ç°è°ƒç”¨é“¾)</p><blockquote><p><img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20250218152615640.png" alt="image-20250218152615640"></p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosPromise</span>, <span class="title class_">AxiosResponse</span>, <span class="title class_">Method</span>,<span class="title class_">ResolvedFn</span>,<span class="title class_">RejectedFn</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PromiseChain</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="attr">resolved</span>: <span class="title class_">ResolvedFn</span>&lt;T&gt; | (<span class="function">(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>) =&gt;</span> <span class="title class_">AxiosPromise</span>)<span class="comment">//resolvedæ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ æ¥æ”¶ä¸€ä¸ªAxiosRequestConfigç±»å‹çš„å‚æ•° è¿”å›ä¸€ä¸ªAxiosPromiseç±»å‹çš„å‚æ•°</span></span><br><span class="line">    <span class="attr">rejected</span>?: <span class="title class_">RejectedFn</span> <span class="comment">//rejectedæ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ æ¥æ”¶ä¸€ä¸ªAxiosRequestConfigç±»å‹çš„å‚æ•° è¿”å›ä¸€ä¸ªAxiosPromiseç±»å‹çš„å‚æ•°</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="title function_">request</span>(<span class="attr">url</span>: <span class="built_in">any</span>, <span class="attr">config</span>: <span class="built_in">any</span>): <span class="title class_">AxiosPromise</span> &#123;<span class="comment">// å®ç°requestæ–¹æ³•ä¼ å…¥å‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!config) &#123;</span><br><span class="line">            config = &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        config.<span class="property">url</span> = url</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        config = url</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">chain</span>:<span class="title class_">PromiseChain</span>&lt;<span class="built_in">any</span>&gt;[] = [</span><br><span class="line">        &#123;<span class="comment">// åˆ›å»ºä¸€ä¸ªæ•°ç»„chain</span></span><br><span class="line">            <span class="attr">resolved</span>: dispatchRequest,</span><br><span class="line">            <span class="attr">rejected</span>: <span class="literal">undefined</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">interceptor</span> =&gt;</span> &#123;<span class="comment">// éå†requestæ‹¦æˆªå™¨</span></span><br><span class="line">        chain.<span class="title function_">unshift</span>(interceptor) <span class="comment">// å°†æ‹¦æˆªå™¨æ·»åŠ åˆ°chainæ•°ç»„çš„å¼€å¤´</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">interceptor</span> =&gt;</span> &#123;<span class="comment">// éå†responseæ‹¦æˆªå™¨</span></span><br><span class="line">        chain.<span class="title function_">push</span>(interceptor) <span class="comment">// å°†æ‹¦æˆªå™¨æ·»åŠ åˆ°chainæ•°ç»„çš„æœ«å°¾</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(config) <span class="comment">// åˆ›å»ºä¸€ä¸ªpromiseå¯¹è±¡ å¹¶ä¼ å…¥configå‚æ•°</span></span><br><span class="line">    <span class="keyword">while</span> (chain.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// éå†chainæ•°ç»„</span></span><br><span class="line">        <span class="keyword">const</span> &#123; resolved, rejected &#125; = chain.<span class="title function_">shift</span>()! <span class="comment">// å–å‡ºchainæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">              promise = promise.<span class="title function_">then</span>(resolved, rejected) <span class="comment">// å°†promiseå¯¹è±¡çš„thenæ–¹æ³•ä¼ å…¥resolvedå’Œrejectedå‚æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆå¹¶ç”¨æˆ·é…ç½®"><a href="#åˆå¹¶ç”¨æˆ·é…ç½®" class="headerlink" title="åˆå¹¶ç”¨æˆ·é…ç½®"></a>åˆå¹¶ç”¨æˆ·é…ç½®</h2><blockquote><p>ç”¨æˆ·åœ¨å‘é€è¯·æ±‚æ—¶å¯ä»¥ä¼ å…¥ä¸€ä¸ªé…ç½®æ¥å†³å®šè¯·æ±‚çš„ä¸åŒè¡Œä¸º</p><p>ç”šè‡³å¯ä»¥ç›´æ¥ä¿®æ”¹ä¸€äº›é»˜è®¤é…ç½® (defaults)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">axios.<span class="property">defaults</span>.<span class="property">headers</span>.<span class="property">common</span>[<span class="string">&#x27;test&#x27;</span>] = <span class="number">123</span> <span class="comment">//é»˜è®¤å¯¹ä»»ä½•ç±»å‹çš„è¯·æ±‚çš„headeréƒ½æ·»åŠ testå±æ€§</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">headers</span>.<span class="property">post</span>[<span class="string">&#x27;Content-Type&#x27;</span>] =</span><br><span class="line"><span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span> <span class="comment">//é»˜è®¤å¯¹postè¯·æ±‚çš„headeréƒ½æ·»åŠ Content-Typeå±æ€§</span></span><br><span class="line">axios.<span class="property">defaults</span>.<span class="property">timeout</span> = <span class="number">2000</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="é»˜è®¤é…ç½®è®¾ç½®"><a href="#é»˜è®¤é…ç½®è®¾ç½®" class="headerlink" title="é»˜è®¤é…ç½®è®¾ç½®"></a>é»˜è®¤é…ç½®è®¾ç½®</h3><p>defaults.ts é…ç½®é»˜è®¤è¯·æ±‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span> = &#123;</span><br><span class="line"><span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"><span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line"><span class="attr">timeout</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="attr">common</span>: &#123;</span><br><span class="line"><span class="title class_">Accept</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>, <span class="comment">//é€šç”¨çš„è¯·æ±‚å¤´ æ¥å—çš„å“åº”ç±»å‹ä¸ºjson/plainæ–‡æœ¬*/*è¡¨ç¤ºä»»æ„ç±»å‹ ä¼˜å…ˆçº§æœ€ä½</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> methodsNoData = [<span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;head&#x27;</span>, <span class="string">&#x27;options&#x27;</span>]</span><br><span class="line"></span><br><span class="line">methodsNoData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">method</span>) =&gt;</span> &#123;</span><br><span class="line">defaults.<span class="property">headers</span>[method] = &#123;&#125; <span class="comment">//æ²¡æœ‰æ•°æ®çš„è¯·æ±‚å¤´ ä¼˜å…ˆçº§é«˜äºé€šç”¨çš„è¯·æ±‚å¤´</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> methodsWithData = [<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;put&#x27;</span>, <span class="string">&#x27;patch&#x27;</span>]</span><br><span class="line"></span><br><span class="line">methodsWithData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">method</span>) =&gt;</span> &#123;</span><br><span class="line">defaults.<span class="property">headers</span>[method] = &#123;</span><br><span class="line"><span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>, <span class="comment">//è¡¨å•æäº¤çš„è¯·æ±‚å¤´ ä¼˜å…ˆçº§é«˜äºé€šç”¨çš„è¯·æ±‚å¤´</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defaults</span><br></pre></td></tr></table></figure><p>core &#x2F; Axios.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">    <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span></span><br><span class="line">    <span class="attr">interceptors</span>: <span class="title class_">Interceptors</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">initConfig</span>?: <span class="title class_">AxiosRequestConfig</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">defaults</span> = initConfig <span class="comment">// åˆå§‹åŒ–defaultså±æ€§</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">interceptors</span> = &#123;</span><br><span class="line">            <span class="comment">//ç”¨æˆ·å¯ä»¥é€šè¿‡axios.interceptors.request.use()æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line">            <span class="attr">request</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;(),</span><br><span class="line">            <span class="attr">response</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">    <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span> <span class="comment">//é»˜è®¤é…ç½®</span></span><br><span class="line">    <span class="attr">interceptors</span>: &#123; <span class="comment">//æ‹¦æˆªå™¨</span></span><br><span class="line">        <span class="attr">request</span>: <span class="title class_">AxiosInterceptorManager</span>&lt;<span class="title class_">AxiosRequestConfig</span>&gt;</span><br><span class="line">        <span class="attr">response</span>: <span class="title class_">AxiosInterceptorManager</span>&lt;<span class="title class_">AxiosResponse</span>&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å†™ axios.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosInstance</span>, <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Axios</span> <span class="keyword">from</span> <span class="string">&#x27;./core/Axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/util&#x27;</span></span><br><span class="line"><span class="keyword">import</span> defaults <span class="keyword">from</span> <span class="string">&#x27;./defaults&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosInstance</span> &#123;</span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> <span class="title class_">Axios</span>(config) <span class="comment">//åˆ›å»ºä¸€ä¸ª Axios å®ä¾‹ å¹¶ä¼ å…¥ config å‚æ•° å¹¶èµ‹å€¼ç»™ context å˜é‡</span></span><br><span class="line"><span class="keyword">const</span> instance = <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span>.<span class="title function_">bind</span>(context) <span class="comment">//è°ƒç”¨ request æ–¹æ³• å¹¶ä¼ å…¥ context å‚æ•° å¹¶èµ‹å€¼ç»™ instance å˜é‡ ç»‘å®š this æŒ‡å‘ context</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">extend</span>(instance, context) <span class="comment">//è°ƒç”¨ extend æ–¹æ³• å¹¶ä¼ å…¥ instance å’Œ context å‚æ•° å®ç° instance å¯¹è±¡ç»§æ‰¿ context å¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> instance <span class="keyword">as</span> <span class="title class_">AxiosInstance</span> <span class="comment">//è¿”å› instance å¯¹è±¡ å¹¶æ–­è¨€ä¸º AxiosInstance ç±»å‹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="title function_">createInstance</span>(defaults) <span class="comment">//è°ƒç”¨ createInstance æ–¹æ³• å¹¶ä¼ å…¥ defaults å‚æ•° å¹¶èµ‹å€¼ç»™ axios å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure><h3 id="åˆå¹¶ç­–ç•¥å®ç°"><a href="#åˆå¹¶ç­–ç•¥å®ç°" class="headerlink" title="åˆå¹¶ç­–ç•¥å®ç°"></a>åˆå¹¶ç­–ç•¥å®ç°</h3><p>åˆ›å»º core &#x2F; mergeConfig.ts</p><blockquote><p><code>config1</code> ä¸ºé»˜è®¤é…ç½®</p><p><code>config2</code> ä»£è¡¨ç”¨æˆ·ä¼ å…¥çš„è‡ªå®šä¹‰é…ç½®</p><blockquote><p>å®ç°ç¤ºä¾‹ (å‡è®¾ <code>config1</code> å’Œ <code>config2</code> å¦‚ä¸‹ï¼š)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config1 = &#123;</span><br><span class="line"><span class="attr">timeout</span>: <span class="number">1000</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config2 = &#123;</span><br><span class="line"><span class="attr">timeout</span>: <span class="number">2000</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="title class_">Authorization</span>: <span class="string">&#x27;Bearer token&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå¹¶ <code>timeout</code> å±æ€§æ—¶ï¼Œ<code>val1</code> å°±æ˜¯ <code>config1.timeout</code> çš„å€¼ <code>1000</code>ï¼Œ<code>val2</code> å°±æ˜¯ <code>config2.timeout</code> çš„å€¼ <code>2000</code>ã€‚</p></blockquote></blockquote><h4 id="timeout-é€»è¾‘"><a href="#timeout-é€»è¾‘" class="headerlink" title="timeout é€»è¾‘"></a>timeout é€»è¾‘</h4><p>mergeConfig.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> strats = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>) <span class="comment">//åˆå¹¶ç­–ç•¥ keyä¸ºå±æ€§å valueä¸ºåˆå¹¶ç­–ç•¥å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defaultStrat</span>(<span class="params"><span class="attr">val1</span>: <span class="built_in">any</span>, <span class="attr">val2</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">//é»˜è®¤åˆå¹¶ç­–ç•¥</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">typeof</span> val2 !== <span class="string">&#x27;undefined&#x27;</span> ? val2 : val1 <span class="comment">//ä¼˜å…ˆå–val2 å¦‚æœval2ä¸å­˜åœ¨åˆ™å–val1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fromVal2Strat</span>(<span class="params"><span class="attr">val1</span>: <span class="built_in">any</span>, <span class="attr">val2</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> val2 !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">//å¿½ç•¥val1 åªå–val2</span></span><br><span class="line"><span class="keyword">return</span> val2</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stratKeysFromVal2 = [<span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;params&#x27;</span>, <span class="string">&#x27;data&#x27;</span>]</span><br><span class="line"></span><br><span class="line">stratKeysFromVal2.<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//å¯¹äºurl params dataå±æ€§ åªå–val2</span></span><br><span class="line">strats[key] = fromVal2Strat</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">mergeConfig</span>(<span class="params"></span></span><br><span class="line"><span class="params"><span class="attr">config1</span>: <span class="title class_">AxiosRequestConfig</span>,</span></span><br><span class="line"><span class="params"><span class="attr">config2</span>?: <span class="title class_">AxiosRequestConfig</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!config2) &#123;</span><br><span class="line">config2 = &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> config = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>) <span class="comment">//åˆå¹¶åçš„é…ç½®ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> config2) &#123;</span><br><span class="line"><span class="title function_">mergeField</span>(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> config1) &#123;</span><br><span class="line"><span class="keyword">if</span> (!config2[key]) &#123;</span><br><span class="line"><span class="title function_">mergeField</span>(key)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mergeField</span>(<span class="params"><span class="attr">key</span>: <span class="built_in">string</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="keyword">const</span> strat = strats[key] || defaultStrat <span class="comment">//åˆå¹¶ç­–ç•¥</span></span><br><span class="line">config[key] = <span class="title function_">strat</span>(config1[key], config2![key])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>types &#x2F; index.ts æ·»åŠ è‡ªåŠ¨ç´¢å¼•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    [<span class="attr">propName</span>: <span class="built_in">string</span>]: <span class="built_in">any</span> <span class="comment">//å­—ç¬¦ä¸²è‡ªåŠ¨ç´¢å¼•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="headers-é€»è¾‘"><a href="#headers-é€»è¾‘" class="headerlink" title="headers é€»è¾‘"></a>headers é€»è¾‘</h4><h5 id="åˆå¹¶"><a href="#åˆå¹¶" class="headerlink" title="åˆå¹¶"></a>åˆå¹¶</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepMergeStrat</span>(<span class="params"><span class="attr">val1</span>: <span class="built_in">any</span>, <span class="attr">val2</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(val2)) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœval2æ˜¯å¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">deepMerge</span>(val1, val2) <span class="comment">//é€’å½’åˆå¹¶</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> val2 !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœval2ä¸æ˜¯å¯¹è±¡ ä¸”val2å­˜åœ¨</span></span><br><span class="line"><span class="keyword">return</span> val2</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(val1)) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœval2ä¸æ˜¯å¯¹è±¡ ä¸”val2ä¸å­˜åœ¨ ä¸”val1æ˜¯å¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">deepMerge</span>(val1) <span class="comment">//é€’å½’åˆå¹¶</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> val1 !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœval2ä¸æ˜¯å¯¹è±¡ ä¸”val2ä¸å­˜åœ¨ ä¸”val1ä¸æ˜¯å¯¹è±¡ ä¸”val1å­˜åœ¨</span></span><br><span class="line"><span class="keyword">return</span> val1</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>deepMerge å·¥å…·å‡½æ•°å®ç°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deepMerge</span>(<span class="params">...<span class="attr">objs</span>: <span class="built_in">any</span>[]</span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// æ·±åº¦åˆå¹¶å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">objs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (obj) &#123;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> val = obj[key]</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(val)) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(result[key])) &#123;</span><br><span class="line">result[key] = <span class="title function_">deepMerge</span>(result[key], val)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">result[key] = <span class="title function_">deepMerge</span>(val)</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">result[key] = val</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¯·æ±‚ä¸­åº”ç”¨å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="attr">url</span>: <span class="built_in">any</span>, <span class="attr">config</span>: <span class="built_in">any</span>): <span class="title class_">AxiosPromise</span> &#123; <span class="comment">// å®ç°requestæ–¹æ³•ä¼ å…¥å‚æ•°</span></span><br><span class="line">    ã€‚ã€‚ã€‚</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!config) &#123;</span><br><span class="line">            config = &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        config.<span class="property">url</span> = url</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        config = url</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘é€è¯·æ±‚ä¹‹å‰åº”ç”¨</span></span><br><span class="line">    config = <span class="variable language_">this</span>.<span class="title function_">mergeConfig</span>(<span class="variable language_">this</span>.<span class="property">defaults</span>,config) <span class="comment">// åˆå¹¶config</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">chain</span>:<span class="title class_">PromiseChain</span>&lt;<span class="built_in">any</span>&gt;[] = [</span><br><span class="line">        &#123;<span class="comment">// åˆ›å»ºä¸€ä¸ªæ•°ç»„chain</span></span><br><span class="line">            <span class="attr">resolved</span>: dispatchRequest,</span><br><span class="line">            <span class="attr">rejected</span>: <span class="literal">undefined</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    ã€‚ã€‚ã€‚</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å‹ç¼©"><a href="#å‹ç¼©" class="headerlink" title="å‹ç¼©"></a>å‹ç¼©</h5><blockquote><p>åˆå¹¶åçš„ headers æ˜¯ä¸€ä¸ªå¤æ‚å¯¹è±¡ï¼Œå¤šäº† commonã€postã€get ç­‰å±æ€§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">headers:&#123;</span><br><span class="line">    common:&#123;</span><br><span class="line">    Accept:&#x27;application/json,text/plain,*/*&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    post: &#123;</span><br><span class="line">    &#x27;Content-Type&#x27;:&#x27;application/x-www-form-urlencoded&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦å‹ç¼©æˆä¸€çº§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">headers:&#123;</span><br><span class="line">Accept:&#x27;application/json,text/plain,*/*&#x27;,</span><br><span class="line">&#x27;Content-Type&#x27;:&#x27;application/x-www-form-urlencoded&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Tipï¼šå¯¹äº comman ä¸­å®šä¹‰çš„ header å­—æ®µï¼Œæˆ‘ä»¬éƒ½è¦æå–ï¼Œè€Œå¯¹äº postã€get è¿™ç±»æå–ï¼Œéœ€è¦å’Œè¯¥æ¬¡è¯·æ±‚çš„æ–¹æ³•å¯¹åº”ã€‚</p></blockquote><p>headers.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">flattenHeaders</span>(<span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>, <span class="attr">method</span>: <span class="title class_">Method</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// flattenHeaders å‡½æ•°æ¥æ”¶ headers å’Œ method å‚æ•° å°† headers ä¸­çš„å±æ€§åè§„èŒƒåŒ– å¹¶åˆ é™¤ä¸å¿…è¦çš„å±æ€§ å¹¶è¿”å›ä¸€ä¸ªæ–°çš„ headers å¯¹è±¡</span></span><br><span class="line"><span class="keyword">if</span> (!headers) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ headers ä¸å­˜åœ¨</span></span><br><span class="line"><span class="keyword">return</span> headers <span class="comment">// è¿”å› headers</span></span><br><span class="line">&#125;</span><br><span class="line">headers = <span class="title function_">deepMerge</span>(headers, <span class="literal">null</span>) <span class="comment">// è°ƒç”¨ deepMerge å‡½æ•°å°† headers æ·±åº¦åˆå¹¶</span></span><br><span class="line"><span class="keyword">const</span> methodsToDelete = [</span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªæ•°ç»„ methodsToDelete å­˜å‚¨éœ€è¦åˆ é™¤çš„ headers å±æ€§å</span></span><br><span class="line"><span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;get&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;head&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;options&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;post&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;put&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;patch&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;common&#x27;</span>,</span><br><span class="line">]</span><br><span class="line">methodsToDelete.<span class="title function_">forEach</span>(<span class="function">(<span class="params">method</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// éå† methodsToDelete æ•°ç»„</span></span><br><span class="line"><span class="keyword">delete</span> headers[method] <span class="comment">// åˆ é™¤ headers çš„å±æ€§å</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> headers <span class="comment">// è¿”å› headers</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>dispatchRequest.ts åº”ç”¨å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// å…ˆå¤„ç† headers</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// å†å¤„ç† data</span></span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">flattenHeaders</span>(config.<span class="property">headers</span>, config.<span class="property">method</span>!) <span class="comment">//å¤„ç† headers æ‰å¹³åŒ–</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ›´å¤šé…ç½®"><a href="#æ›´å¤šé…ç½®" class="headerlink" title="æ›´å¤šé…ç½®"></a>æ›´å¤šé…ç½®</h3><h4 id="transfromRequest-transfromResponse"><a href="#transfromRequest-transfromResponse" class="headerlink" title="transfromRequest &amp; transfromResponse"></a>transfromRequest &amp; transfromResponse</h4><blockquote><p>å®˜æ–¹ axios ä¸­æä¾›<code>transfromRequest</code>&amp;<code>transfromResponse</code>ï¼Œå€¼ä¸º**<em>ä¸€ä¸ªæ•°ç»„æˆ–ä¸€ä¸ªå‡½æ•°</em>**</p><p>è¿™ä¸¤ä¸ªå±æ€§å…è®¸ç”¨æˆ·åœ¨ <strong>æ•°æ®å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰</strong>(åªé€‚ç”¨äº putã€postã€patchï¼Œè€Œä¸”å¯ä»¥ä¿®æ”¹ headers å¯¹è±¡) &#x2F; <strong>æŠŠå“åº”æ•°æ®ä¼ é€’ç»™ then æˆ– catch ä¹‹å‰</strong> å¯¹å…¶ä¿®æ”¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">    transformRequest: [</span><br><span class="line">        (function(data) &#123;</span><br><span class="line">            return qs.stringify(data); // è‡ªå®šä¹‰çš„ transformRequest</span><br><span class="line">        &#125;),</span><br><span class="line">        ...axios.defaults.transformRequest // ä¿ç•™é»˜è®¤çš„ transformRequest</span><br><span class="line">    ],</span><br><span class="line">    transformResponse: [</span><br><span class="line">        ...axios.defaults.transformResponse, // å±•å¼€é»˜è®¤çš„ transformResponse</span><br><span class="line">        function(data) &#123;</span><br><span class="line">            if (typeof data === &#x27;object&#x27;) &#123; // è‡ªå®šä¹‰çš„ transformResponse</span><br><span class="line">                data.b = 2; // ä¿®æ”¹å“åº”æ•°æ®</span><br><span class="line">            &#125;</span><br><span class="line">            return data;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    url: &#x27;/config/post&#x27;, // è¯·æ±‚çš„ URL</span><br><span class="line">    method: &#x27;post&#x27;, // è¯·æ±‚æ–¹æ³•</span><br><span class="line">    data: &#123;</span><br><span class="line">        a: 1 // è¯·æ±‚çš„æ•°æ®</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote><h5 id="å®šä¹‰æ¥å£"><a href="#å®šä¹‰æ¥å£" class="headerlink" title="å®šä¹‰æ¥å£"></a>å®šä¹‰æ¥å£</h5><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line"><span class="comment">//configæ¥å£</span></span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span></span><br><span class="line"><span class="attr">method</span>?: <span class="title class_">Method</span></span><br><span class="line"><span class="attr">data</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">params</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">headers</span>?: <span class="built_in">any</span></span><br><span class="line"><span class="attr">responseType</span>?: <span class="title class_">XMLHttpRequestResponseType</span></span><br><span class="line"><span class="attr">timeout</span>?: <span class="built_in">number</span></span><br><span class="line"><span class="attr">transformRequest</span>?: <span class="title class_">AxiosTransformer</span> | <span class="title class_">AxiosTransformer</span>[] <span class="comment">//è¯·æ±‚æ•°æ®è½¬æ¢å‡½æ•°</span></span><br><span class="line"><span class="attr">transformResponse</span>?: <span class="title class_">AxiosTransformer</span> | <span class="title class_">AxiosTransformer</span>[] <span class="comment">//å“åº”æ•°æ®è½¬æ¢å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">[<span class="attr">propName</span>: <span class="built_in">string</span>]: <span class="built_in">any</span> <span class="comment">//å­—ç¬¦ä¸²è‡ªåŠ¨ç´¢å¼•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosTransformer</span> &#123;</span><br><span class="line"><span class="comment">//è½¬æ¢æ¥å£</span></span><br><span class="line">(<span class="attr">data</span>: <span class="built_in">any</span>, <span class="attr">headers</span>?: <span class="built_in">any</span>): <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>defaults.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; processHeaders &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/header&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">defaults</span>: <span class="title class_">AxiosRequestConfig</span> = &#123;</span><br><span class="line"><span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"><span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line"><span class="attr">timeout</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="attr">common</span>: &#123;</span><br><span class="line"><span class="title class_">Accept</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>, <span class="comment">//é€šç”¨çš„è¯·æ±‚å¤´ æ¥å—çš„å“åº”ç±»å‹ä¸ºjson/plainæ–‡æœ¬*/*è¡¨ç¤ºä»»æ„ç±»å‹ ä¼˜å…ˆçº§æœ€ä½</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="attr">transformRequest</span>: [</span><br><span class="line"><span class="keyword">function</span> (<span class="params"><span class="attr">data</span>: <span class="built_in">any</span>, <span class="attr">headers</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="title function_">processHeaders</span>(headers, data) <span class="comment">//å¤„ç†è¯·æ±‚å¤´</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">transformRequest</span>(data) <span class="comment">//å¤„ç†è¯·æ±‚æ•°æ®</span></span><br><span class="line">&#125;,</span><br><span class="line">],</span><br><span class="line"><span class="attr">transformResponse</span>: [</span><br><span class="line"><span class="keyword">function</span> (<span class="params"><span class="attr">data</span>: <span class="built_in">any</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">transformResponse</span>(data) <span class="comment">//å¤„ç†å“åº”æ•°æ®</span></span><br><span class="line">&#125;,</span><br><span class="line">],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é‡æ„-transform-é€»è¾‘"><a href="#é‡æ„-transform-é€»è¾‘" class="headerlink" title="é‡æ„ transform é€»è¾‘"></a>é‡æ„ transform é€»è¾‘</h5><p>core &#x2F; transform.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosTransformer</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">transform</span>(<span class="params"> <span class="comment">//transformå‡½æ•°æ¥æ”¶data headers fnsä¸‰ä¸ªå‚æ•°</span></span></span><br><span class="line"><span class="params"><span class="attr">data</span>: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params"><span class="attr">headers</span>: <span class="built_in">any</span>,</span></span><br><span class="line"><span class="params"><span class="attr">fns</span>?: <span class="title class_">AxiosTransformer</span> | <span class="title class_">AxiosTransformer</span>[]</span></span><br><span class="line"><span class="params"></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!fns) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰ä¼ å…¥fns ç›´æ¥è¿”å›data</span></span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(fns)) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœfnsä¸æ˜¯æ•°ç»„ å°†å…¶è½¬ä¸ºæ•°ç»„</span></span><br><span class="line">fns = [fns]</span><br><span class="line">&#125;</span><br><span class="line">fns.<span class="title function_">forEach</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//éå†fnsæ•°ç»„ ä¾æ¬¡è°ƒç”¨fnå‡½æ•°</span></span><br><span class="line">data = <span class="title function_">fn</span>(data, headers)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>core &#x2F; dispatchRequest.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> transform <span class="keyword">from</span> <span class="string">&#x27;./transform&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">transformHeaders</span>(config) <span class="comment">// å…ˆå¤„ç† headers</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequestData</span>(config) <span class="comment">// å†å¤„ç† data</span></span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">flattenHeaders</span>(config.<span class="property">headers</span>, config.<span class="property">method</span>!) <span class="comment">//å¤„ç† headers æ‰å¹³åŒ–</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´æ”¹ä¸º ğŸ‘‡</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processConfig</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† config</span></span><br><span class="line">config.<span class="property">url</span> = <span class="title function_">transformURL</span>(config)</span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transform</span>(config.<span class="property">data</span>, config.<span class="property">headers</span>, config.<span class="property">transformRequest</span>) <span class="comment">//å¤„ç† data</span></span><br><span class="line">config.<span class="property">headers</span> = <span class="title function_">flattenHeaders</span>(config.<span class="property">headers</span>, config.<span class="property">method</span>!) <span class="comment">//å¤„ç† headers æ‰å¹³åŒ–</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ æ‰ä¸ç”¨çš„ä¸œè¥¿</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; transformRequest, transformResponse &#125; <span class="keyword">from</span> <span class="string">&#x27;../helpers/data&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformRequestData</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† data è°ƒç”¨ transformRequest æ–¹æ³•</span></span><br><span class="line">config.<span class="property">data</span> = <span class="title function_">transformRequest</span>(config.<span class="property">data</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformHeaders</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="built_in">any</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† headers è°ƒç”¨ processHeaders æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> &#123; headers = &#123;&#125;, data &#125; = config</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">processHeaders</span>(headers, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´æ”¹é€»è¾‘</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">transformResponseData</span>(<span class="params"><span class="attr">res</span>: <span class="title class_">AxiosResponse</span></span>): <span class="title class_">AxiosResponse</span> &#123;</span><br><span class="line"><span class="comment">// å¤„ç† response data</span></span><br><span class="line">res.<span class="property">data</span> = <span class="title function_">transform</span>(res.<span class="property">data</span>, res.<span class="property">headers</span>, res.<span class="property">config</span>.<span class="property">transformResponse</span>)</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="create"><a href="#create" class="headerlink" title="create"></a>create</h4><blockquote><p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ axios éƒ½æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œä¸€æ—¦æˆ‘ä»¬ä¿®æ”¹äº† axios çš„é»˜è®¤é…ç½®ï¼Œä¼šå½±å“æ‰€æœ‰çš„è¯·æ±‚ã€‚æˆ‘ä»¬å¸Œæœ›æä¾›äº†ä¸€ä¸ª<code>axios.create</code>çš„é™æ€æ¥å£å…è®¸æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ axios å®ä¾‹ï¼ŒåŒæ—¶å…è®¸æˆ‘ä»¬ä¼ å…¥æ–°çš„é…ç½®å’Œé»˜è®¤é…ç½®åˆå¹¶ï¼Œå¹¶åšä¸ºæ–°çš„é»˜è®¤é…ç½®ã€‚</p></blockquote><h5 id="æ‰©å±•æ–°çš„æ¥å£"><a href="#æ‰©å±•æ–°çš„æ¥å£" class="headerlink" title="æ‰©å±•æ–°çš„æ¥å£"></a>æ‰©å±•æ–°çš„æ¥å£</h5><p>types &#x2F; index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">AxiosStatic</span> <span class="keyword">extends</span> <span class="title class_">AxiosInstance</span> &#123;</span><br><span class="line"><span class="comment">//axiosé™æ€æ¥å£</span></span><br><span class="line"><span class="title function_">create</span>(<span class="attr">config</span>?: <span class="title class_">AxiosRequestConfig</span>): <span class="title class_">AxiosInstance</span> <span class="comment">//åˆ›å»ºaxioså®ä¾‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>axios.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosStatic</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Axios</span> <span class="keyword">from</span> <span class="string">&#x27;./core/Axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;./helpers/util&#x27;</span></span><br><span class="line"><span class="keyword">import</span> defaults <span class="keyword">from</span> <span class="string">&#x27;./defaults&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mergeConfig <span class="keyword">from</span> <span class="string">&#x27;./core/mergeConfig&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInstance</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span></span>): <span class="title class_">AxiosStatic</span> &#123;</span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> <span class="title class_">Axios</span>(config) <span class="comment">//åˆ›å»ºä¸€ä¸ª Axios å®ä¾‹ å¹¶ä¼ å…¥ config å‚æ•° å¹¶èµ‹å€¼ç»™ context å˜é‡</span></span><br><span class="line"><span class="keyword">const</span> instance = <span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span>.<span class="title function_">bind</span>(context) <span class="comment">//è°ƒç”¨ request æ–¹æ³• å¹¶ä¼ å…¥ context å‚æ•° å¹¶èµ‹å€¼ç»™ instance å˜é‡ ç»‘å®š this æŒ‡å‘ context</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">extend</span>(instance, context) <span class="comment">//è°ƒç”¨ extend æ–¹æ³• å¹¶ä¼ å…¥ instance å’Œ context å‚æ•° å®ç° instance å¯¹è±¡ç»§æ‰¿ context å¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> instance <span class="keyword">as</span> <span class="title class_">AxiosStatic</span> <span class="comment">//è¿”å› instance å¯¹è±¡ å¹¶æ–­è¨€ä¸º AxiosStatic ç±»å‹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="title function_">createInstance</span>(defaults) <span class="comment">//è°ƒç”¨ createInstance æ–¹æ³• å¹¶ä¼ å…¥ defaults å‚æ•° å¹¶èµ‹å€¼ç»™ axios å˜é‡</span></span><br><span class="line"></span><br><span class="line">axios.<span class="property">create</span> = <span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">config</span>) &#123;</span><br><span class="line"><span class="comment">//axios.create æ–¹æ³•æ¥æ”¶ä¸€ä¸ª config å‚æ•° å¹¶è¿”å›ä¸€ä¸ª createInstance æ–¹æ³•çš„è°ƒç”¨ç»“æœ å¹¶ä¼ å…¥ mergeConfig æ–¹æ³•çš„è°ƒç”¨ç»“æœ å¹¶ä¼ å…¥ defaults å’Œ config å‚æ•°</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">createInstance</span>(<span class="title function_">mergeConfig</span>(defaults, config))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æºç æ¢ç©¶ runtime-coreæ¨¡å—</title>
      <link href="/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E6%BA%90%E7%A0%81%E6%8E%A2%E7%A9%B6%20runtime-core%E6%A8%A1%E5%9D%97/"/>
      <url>/2025/03/04/%E6%B7%B1%E5%85%A5%E5%89%8D%E7%AB%AF/%E6%BA%90%E7%A0%81%E6%8E%A2%E7%A9%B6%20runtime-core%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="æºç æ¢ç©¶-runtime-core-æ¨¡å—"><a href="#æºç æ¢ç©¶-runtime-core-æ¨¡å—" class="headerlink" title="æºç æ¢ç©¶ runtime-core æ¨¡å—"></a>æºç æ¢ç©¶ runtime-core æ¨¡å—</h1><blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†å¯¹è¿™è¡Œæ ¸å¿ƒä»£ç çš„æºç è¿›è¡Œå…¨æµç¨‹è¿½è¸ª</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#root&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å·²ç»é€šè¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const rootContainer = document.querySelector(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ° <strong><em>rootContainer</em></strong> ï¼š<div id="app"></div></p></blockquote><p>æ‹†åˆ†æˆä¸¤ä¸ªæ­¥éª¤</p><blockquote><p>createApp(App)</p><p>.mount(â€œ#rootâ€)</p></blockquote><h2 id="createApp-App"><a href="#createApp-App" class="headerlink" title="createApp(App)"></a>createApp(App)</h2><h3 id="å…³äº-App"><a href="#å…³äº-App" class="headerlink" title="å…³äº App"></a>å…³äº App</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹ç”¨æˆ·è¿™è¾¹çš„æ“ä½œ</p><p>App.js</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">App</span> = &#123;</span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// UIé€»è¾‘</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">h</span>(</span><br><span class="line"><span class="comment">// Vue ä¸­çš„åˆ›å»ºè™šæ‹Ÿ DOM çš„è¾…åŠ©å‡½æ•°,ç”¨äºåˆ›å»ºè™šæ‹Ÿ DOM èŠ‚ç‚¹,æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š</span></span><br><span class="line"><span class="string">&#x27;div&#x27;</span>, <span class="comment">// typeï¼šè¦åˆ›å»ºçš„ HTML æ ‡ç­¾åæˆ–ç»„ä»¶é€‰é¡¹å¯¹è±¡.</span></span><br><span class="line">&#123; <span class="attr">id</span>: <span class="string">&#x27;root&#x27;</span>, <span class="attr">class</span>: [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;hard&#x27;</span>] &#125;, <span class="comment">// propsï¼šæ ‡ç­¾å±æ€§,å¯ä»¥æ˜¯ä¸€ä¸ª å¯¹è±¡ æˆ– æ•°ç»„.</span></span><br><span class="line"><span class="string">&#x27;hi, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">msg</span> <span class="comment">// childrenï¼šå­èŠ‚ç‚¹,å¯ä»¥æ˜¯ å­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„ã€å…¶ä»–è™šæ‹Ÿ DOM èŠ‚ç‚¹.</span></span><br><span class="line">)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// ç»„åˆå¼ API çš„å…¥å£ç‚¹,ç”¨äºç»„åˆç»„ä»¶çš„é€»è¾‘ï¼Œä¾‹å¦‚å“åº”å¼æ•°æ®ã€ç”Ÿå‘½å‘¨æœŸé’©å­ã€è®¡ç®—å±æ€§ç­‰</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="attr">msg</span>: <span class="string">&#x27;mini-vue&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œç»™ h è¾…åŠ©å‡½æ•°ä¼ å…¥ä¸‰ä¸ªå‚æ•°</p><p><strong><em>type</em></strong>ï¼šè¦åˆ›å»ºçš„ HTML æ ‡ç­¾åæˆ–ç»„ä»¶é€‰é¡¹å¯¹è±¡(div)</p><p><strong><em>props</em></strong>ï¼šæ ‡ç­¾å±æ€§,å¯ä»¥æ˜¯ä¸€ä¸ª å¯¹è±¡ æˆ– æ•°ç»„</p><p><strong><em>children</em></strong>ï¼šå­èŠ‚ç‚¹,å¯ä»¥æ˜¯ å­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„ã€å…¶ä»–è™šæ‹Ÿ DOM èŠ‚ç‚¹</p></blockquote><p>æ¥çœ‹çœ‹ h è¾…åŠ©å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">h</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">createVNode</span>(<span class="keyword">type</span>, props, children)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€ createVNode</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createVNode</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> vnode = &#123;</span><br><span class="line"><span class="keyword">type</span>, <span class="comment">// ç±»å‹</span></span><br><span class="line">props, <span class="comment">// å±æ€§</span></span><br><span class="line">children, <span class="comment">// å­©å­</span></span><br><span class="line"><span class="attr">el</span>: <span class="literal">null</span>, <span class="comment">// å¯¹åº”çš„çœŸå®dom</span></span><br><span class="line"><span class="attr">component</span>: <span class="literal">null</span>, <span class="comment">// ç»„ä»¶å®ä¾‹</span></span><br><span class="line"><span class="attr">key</span>: props === <span class="literal">null</span> || props === <span class="built_in">void</span> <span class="number">0</span> ? <span class="built_in">void</span> <span class="number">0</span> : props.<span class="property">key</span>, <span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="comment">// shapeFlag: getShapeFlag(type), // ç±»å‹æ ‡è¯†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç°åœ¨ App çš„ç»“æ„å°±å˜æˆäº†è¿™æ ·</p><p>render()</p><blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type<span class="punctuation">,</span> <span class="comment">// ç±»å‹</span></span><br><span class="line">props<span class="punctuation">,</span> <span class="comment">// å±æ€§</span></span><br><span class="line">children<span class="punctuation">,</span> <span class="comment">// å­©å­</span></span><br><span class="line">el<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// å¯¹åº”çš„çœŸå®dom</span></span><br><span class="line">component<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// ç»„ä»¶å®ä¾‹</span></span><br><span class="line">key<span class="punctuation">:</span> props === <span class="literal"><span class="keyword">null</span></span> || props === void <span class="number">0</span> ? void <span class="number">0</span> <span class="punctuation">:</span> props.key<span class="punctuation">,</span> <span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br></pre></td></tr></table></figure></blockquote><p>setup()</p></blockquote><h3 id="å…³äº-createApp"><a href="#å…³äº-createApp" class="headerlink" title="å…³äº createApp"></a>å…³äº createApp</h3><blockquote><p>ä¼ å…¥ç»“æ„ App-&gt;rootComponent</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createApp</span>(<span class="params">rootComponent</span>) &#123;</span><br><span class="line"><span class="comment">//rootComponentå°±æ˜¯App</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="title function_">mount</span>(<span class="params">rootContainer</span>) &#123;</span><br><span class="line"><span class="comment">//.mountæ–¹æ³•çš„æ‰©å±•</span></span><br><span class="line"><span class="keyword">const</span> vnode = <span class="title function_">createVNode</span>(rootComponent)</span><br><span class="line"><span class="title function_">render</span>(vnode, rootContainer)</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç”±æ­¤è¿›å…¥.mount(â€œ#rootâ€)éƒ¨åˆ†</p></blockquote><h2 id="mount-â€œ-rootâ€"><a href="#mount-â€œ-rootâ€" class="headerlink" title=".mount(â€œ#rootâ€)"></a>.mount(â€œ#rootâ€)</h2><blockquote><p>æ¥ç€çœ‹ mount æ–¹æ³•çš„å†…éƒ¨</p><p>&#x2F;&#x2F; æŒ‚è½½å›æ ¹å®¹å™¨<br>&#x2F;&#x2F; å…ˆæŠŠæ ¹ç»„ä»¶è½¬æ¢æˆè™šæ‹ŸèŠ‚ç‚¹ vnode<br>&#x2F;&#x2F; ä¹‹åæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šåŸºäº vnode åšå¤„ç†</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createApp</span>(<span class="params">rootComponent</span>) &#123;</span><br><span class="line"><span class="comment">// rootComponent å°±æ˜¯ &#123;render: Æ’, setup: Æ’&#125;</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="title function_">mount</span>(<span class="params">rootContainer</span>) &#123;</span><br><span class="line"><span class="comment">// rootContainer å°±æ˜¯ div#app</span></span><br><span class="line"><span class="keyword">const</span> vnode = <span class="title function_">createVNode</span>(rootComponent) <span class="comment">// æ ¹ç»„ä»¶è½¬æ¢æˆè™šæ‹ŸèŠ‚ç‚¹vnode</span></span><br><span class="line"><span class="title function_">render</span>(vnode, rootContainer) <span class="comment">// å°† vnode æ¸²æŸ“åˆ° container ä¸­</span></span><br><span class="line"><span class="comment">// ä¹‹åæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šåŸºäºvnodeåšå¤„ç†</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="createVNode"><a href="#createVNode" class="headerlink" title="createVNode"></a>createVNode</h3><blockquote><p>rootComponent ä¼ è¿›æ¥äº† {render: Æ’, setup: Æ’}</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createVNode</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> vnode = &#123;</span><br><span class="line"><span class="keyword">type</span>, <span class="comment">// ç±»å‹</span></span><br><span class="line">props, <span class="comment">// å±æ€§</span></span><br><span class="line">children, <span class="comment">// å­©å­</span></span><br><span class="line"><span class="attr">el</span>: <span class="literal">null</span>, <span class="comment">// å¯¹åº”çš„çœŸå®dom</span></span><br><span class="line"><span class="attr">component</span>: <span class="literal">null</span>, <span class="comment">// ç»„ä»¶å®ä¾‹</span></span><br><span class="line"><span class="attr">key</span>: props === <span class="literal">null</span> || props === <span class="built_in">void</span> <span class="number">0</span> ? <span class="built_in">void</span> <span class="number">0</span> : props.<span class="property">key</span>, <span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="comment">// shapeFlag: getShapeFlag(type), // ç±»å‹æ ‡è¯†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç°åœ¨ {render: Æ’, setup: Æ’} è¢«æŒ‚åˆ°äº†è™šæ‹ŸèŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå±æ€§ <strong><em>type</em></strong> ä¸Š</p></blockquote><blockquote><p>ç°åœ¨ <strong><em>vnode</em></strong> çš„ç»“æ„å°±å˜æˆäº†è¿™æ ·</p><p><strong>type</strong></p><blockquote><p>render()</p><blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type<span class="punctuation">,</span> <span class="comment">// ç±»å‹</span></span><br><span class="line">props<span class="punctuation">,</span> <span class="comment">// å±æ€§</span></span><br><span class="line">children<span class="punctuation">,</span> <span class="comment">// å­©å­</span></span><br><span class="line">el<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// å¯¹åº”çš„çœŸå®dom</span></span><br><span class="line">component<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// ç»„ä»¶å®ä¾‹</span></span><br><span class="line">key<span class="punctuation">:</span> props === <span class="literal"><span class="keyword">null</span></span> || props === void <span class="number">0</span> ? void <span class="number">0</span> <span class="punctuation">:</span> props.key<span class="punctuation">,</span> <span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br></pre></td></tr></table></figure></blockquote><p>setup()</p></blockquote><p><strong>props</strong></p><p><strong>children</strong></p><p><strong>el</strong></p><p><strong>component</strong></p><p><strong>key</strong></p></blockquote><h3 id="render"><a href="#render" class="headerlink" title="render"></a>render</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(vnode, rootContainer) <span class="comment">// å°† vnode æ¸²æŸ“åˆ° container ä¸­</span></span><br></pre></td></tr></table></figure><blockquote><p>vnode : åˆšæ‰å†™çš„ç»“æ„ ğŸ‘†</p><p>rootContainer : div#app</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="comment">// ç›´æ¥æŒ‡å‘patchå‡½æ•°</span></span><br><span class="line"><span class="title function_">patch</span>(vnode, container)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="patch-æ‹†ç®±å›è°ƒ"><a href="#patch-æ‹†ç®±å›è°ƒ" class="headerlink" title="patch æ‹†ç®±å›è°ƒ"></a>patch æ‹†ç®±å›è°ƒ</h3><blockquote><p>æ‹†ç®±å‡½æ•°ï¼Œæ·±å±‚å›è°ƒçš„èµ·ç‚¹</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">type</span> === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// å…ƒç´ åˆ†æ”¯</span></span><br><span class="line"><span class="title function_">processElement</span>(vnode, container)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">type</span> === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// ç»„ä»¶åˆ†æ”¯</span></span><br><span class="line"><span class="title function_">processComponent</span>(vnode)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="processComponent-ç»„ä»¶åˆ†æ”¯ï¼ˆé¦–æ¬¡è¿›å…¥ï¼‰"><a href="#processComponent-ç»„ä»¶åˆ†æ”¯ï¼ˆé¦–æ¬¡è¿›å…¥ï¼‰" class="headerlink" title="processComponent ç»„ä»¶åˆ†æ”¯ï¼ˆé¦–æ¬¡è¿›å…¥ï¼‰"></a>processComponent ç»„ä»¶åˆ†æ”¯ï¼ˆé¦–æ¬¡è¿›å…¥ï¼‰</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processComponent</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="title function_">mountComponent</span>(vnode)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="mountComponent-ç»„ä»¶åˆå§‹åŒ–åˆ†æ”¯"><a href="#mountComponent-ç»„ä»¶åˆå§‹åŒ–åˆ†æ”¯" class="headerlink" title="mountComponent ç»„ä»¶åˆå§‹åŒ–åˆ†æ”¯"></a>mountComponent ç»„ä»¶åˆå§‹åŒ–åˆ†æ”¯</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountComponent</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> instance = <span class="title function_">createComponentInstance</span>(vnode) <span class="comment">// åˆ›å»ºç»„ä»¶å®ä¾‹</span></span><br><span class="line"><span class="title function_">setupComponent</span>(instance) <span class="comment">// å¤„ç†ç»„ä»¶</span></span><br><span class="line"><span class="title function_">setupRenderEffect</span>(instance, vnode, container) <span class="comment">// å¤„ç†ç»„ä»¶æ¸²æŸ“</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="createComponentInstance"><a href="#createComponentInstance" class="headerlink" title="createComponentInstance"></a>createComponentInstance</h6><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createComponentInstance</span>(<span class="params">vnode</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> instance = &#123;</span><br><span class="line">vnode,</span><br><span class="line"><span class="attr">type</span>: vnode.<span class="property">type</span>,</span><br><span class="line"><span class="attr">props</span>: vnode.<span class="property">props</span>,</span><br><span class="line"><span class="attr">slots</span>: vnode.<span class="property">slots</span>, <span class="comment">// æ’æ§½</span></span><br><span class="line"><span class="attr">proxy</span>: <span class="literal">null</span>, <span class="comment">// ä»£ç†å¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> instance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿”å›çš„ <strong><em>instance</em></strong> ç»“æ„</p><p><strong>vnode</strong>(æ–°å¢) ï¼šç»§æ‰¿å½“å‰ä¼ è¿‡æ¥çš„æ•´ä¸ª vnode ç»“æ„</p><p><strong>type</strong></p><blockquote><p>render()</p><blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type<span class="punctuation">,</span> <span class="comment">// ç±»å‹</span></span><br><span class="line">props<span class="punctuation">,</span> <span class="comment">// å±æ€§</span></span><br><span class="line">children<span class="punctuation">,</span> <span class="comment">// å­©å­</span></span><br><span class="line">el<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// å¯¹åº”çš„çœŸå®dom</span></span><br><span class="line">component<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// ç»„ä»¶å®ä¾‹</span></span><br><span class="line">key<span class="punctuation">:</span> props === <span class="literal"><span class="keyword">null</span></span> || props === void <span class="number">0</span> ? void <span class="number">0</span> <span class="punctuation">:</span> props.key<span class="punctuation">,</span> <span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br></pre></td></tr></table></figure></blockquote><p>setup()</p></blockquote><p><strong>props</strong></p><p><strong>slots</strong>(æ–°å¢)</p><p><strong>proxy</strong>(æ–°å¢)</p><p><strong>children</strong></p><p><strong>el</strong></p><p><strong>component</strong></p><p><strong>key</strong></p></blockquote><h6 id="setupComponent"><a href="#setupComponent" class="headerlink" title="setupComponent"></a>setupComponent</h6><blockquote><p>instance çš„ç»“æ„è§ä¸Š ğŸ‘†</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setupComponent</span>(<span class="params">instance</span>) &#123;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–ç»„ä»¶</span></span><br><span class="line"><span class="title function_">initProps</span>(instance)</span><br><span class="line"><span class="title function_">initSlots</span>(instance)</span><br><span class="line"><span class="title function_">setupStatefulComponent</span>(instance) <span class="comment">// å¤„ç†ç»„ä»¶çš„setup</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>setupStatefulComponent</strong></p><blockquote><p>æŒ‰è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œè§£æ„å‡ºæ¥çš„ setup ç»“æ„ä¸º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Æ’ <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;mini-vue&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setupStatefulComponent</span>(<span class="params">instance</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Component</span> = instance.<span class="property">type</span> <span class="comment">// å…ˆæ‹¿åˆ°ç»„ä»¶ &#123;render: Æ’, setup: Æ’&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; setup &#125; = <span class="title class_">Component</span> <span class="comment">//è§£æ„å‡ºsetup(ç»“æ„è§ä¸Šé¢æ³¨é‡Š)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (setup) &#123;</span><br><span class="line"><span class="comment">// setCurrentInstance(instance)</span></span><br><span class="line"><span class="keyword">const</span> setupResult = <span class="title function_">setup</span>() <span class="comment">// &#123;msg: &#x27;mini-vue&#x27;&#125;</span></span><br><span class="line"><span class="comment">// setCurrentInstance(null)</span></span><br><span class="line"><span class="title function_">handleSetupResult</span>(instance, setupResult) <span class="comment">// instance &amp; &#123;msg: &#x27;mini-vue&#x27;&#125;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">finishComponentSetup</span>(instance)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸‹é¢è¿™ä¸ªå…ˆç•™ä¸ªå‘ğŸ•³åé¢çœ‹</span></span><br><span class="line">instance.<span class="property">proxy</span> = <span class="keyword">new</span> <span class="title class_">Proxy</span>(instance, &#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> &#123; setup, props &#125; = target</span><br><span class="line"><span class="keyword">if</span> (key <span class="keyword">in</span> setup) &#123;</span><br><span class="line"><span class="keyword">return</span> setup[key]</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (key <span class="keyword">in</span> props) &#123;</span><br><span class="line"><span class="keyword">return</span> props[key]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key)</span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœ setup å­˜åœ¨</strong></p><p>handleSetupResult ï¼ˆå¤„ç†ç»„ä»¶çš„ setupï¼‰</p><blockquote><p>ä¼ å…¥ instance &amp; {msg: â€˜mini-vueâ€™}</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleSetupResult</span>(<span class="params"><span class="attr">instance</span>: <span class="built_in">any</span>, <span class="attr">setupResult</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> setupResult === <span class="string">&#x27;object&#x27;</span> &amp;&amp; setupResult !== <span class="literal">null</span>) &#123;</span><br><span class="line">instance.<span class="property">setupState</span> = setupResult <span class="comment">// instanceæ–°å¢å±æ€§setupState</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">finishComponentSetup</span>(instance) <span class="comment">// å¤„ç†ç»„ä»¶çš„render</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>finishComponentSetup ï¼ˆå¤„ç†ç»„ä»¶çš„ renderï¼‰</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">finishComponentSetup</span>(<span class="params">instance</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Component</span> = instance.<span class="property">type</span> <span class="comment">// å…ˆæ‹¿åˆ°ç»„ä»¶ &#123;render: Æ’, setup: Æ’&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">Component</span>.<span class="property">render</span>) &#123;</span><br><span class="line">instance.<span class="property">render</span> = <span class="title class_">Component</span>.<span class="property">render</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">instance.<span class="property">render</span> = instance.<span class="property">vnode</span>.<span class="property">render</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œ instance åˆæ–°å¢äº† render å±æ€§</p></blockquote><p><strong>å¦‚æœ setup ä¸å­˜åœ¨</strong></p><blockquote><p>ç›´æ¥å¤„ç†ç»„ä»¶çš„ render</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">finishComponentSetup</span>(instance)</span><br></pre></td></tr></table></figure><blockquote><p>åˆ°è¿™é‡Œå°±æ˜¯ç»„ä»¶åˆå§‹åŒ–çš„æœ€åº•å±‚äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å›åˆ° <em>mountComponent</em> å®Œæˆ <em>setupRenderEffect</em> éƒ¨åˆ†</p></blockquote><h6 id="setupRenderEffect"><a href="#setupRenderEffect" class="headerlink" title="setupRenderEffect"></a>setupRenderEffect</h6><blockquote><p>è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•° <strong><em>instance</em></strong>, <strong><em>vnode</em></strong>, <strong><em>container</em></strong></p><p>å·²çŸ¥ <strong>container</strong> ä½œä¸ºå®¹å™¨ä¸º<div id="app"></div></p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹ç›®å‰ <strong>instance</strong> &amp; <strong>vnode</strong> å†…éƒ¨çš„å‚æ•°</p><table><thead><tr><th align="left">instance</th><th align="left">vnode</th><th align="center">å±æ€§</th></tr></thead><tbody><tr><td align="left">âœ…</td><td align="left">âœ…</td><td align="center">children</td></tr><tr><td align="left">âœ…</td><td align="left">âœ…</td><td align="center">component</td></tr><tr><td align="left">âœ…</td><td align="left">âœ…</td><td align="center">el</td></tr><tr><td align="left">âœ…</td><td align="left">âœ…</td><td align="center">key</td></tr><tr><td align="left">âœ…</td><td align="left">âœ…</td><td align="center">props</td></tr><tr><td align="left">âœ… å†…éƒ¨æ˜¯å³è¾¹ vnode çš„å‰äº”ä¸ªå±æ€§</td><td align="left">â›”</td><td align="center"><strong><em>vnode</em></strong></td></tr><tr><td align="left">âœ… { render: Æ’, setup: Æ’ }</td><td align="left">âœ… { render: Æ’, setup: Æ’ }</td><td align="center"><strong><em>type</em></strong></td></tr><tr><td align="left">âœ…</td><td align="left">â›”</td><td align="center">proxy</td></tr><tr><td align="left">âœ…</td><td align="left">â›”</td><td align="center">slots</td></tr><tr><td align="left">âœ… { msg: â€˜mini-vueâ€™ }</td><td align="left">â›”</td><td align="center">setupState</td></tr></tbody></table></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupRenderEffect</span>(<span class="params"><span class="attr">instance</span>: <span class="built_in">any</span>, <span class="attr">vnode</span>: <span class="built_in">any</span>, <span class="attr">container</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line"><span class="comment">//æˆ‘ä»¬å…ˆçœ‹è¿™ä¸€éƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">const</span> &#123; proxy &#125; = instance</span><br><span class="line"><span class="keyword">const</span> subTree = instance.<span class="property">render</span>.<span class="title function_">call</span>(proxy) <span class="comment">// æ³¨æ„!æ˜¯è¿™ä¸ªæ—¶å€™å»è°ƒç”¨renderé‡Œçš„hå‡½æ•°äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vnode -&gt; patch</span></span><br><span class="line"><span class="comment">// vnode -&gt; element -&gt; mountElement</span></span><br><span class="line"><span class="comment">// patch(subTree, container)</span></span><br><span class="line"><span class="comment">// vnode.el = subTree.el</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›é¡¾ h å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">h</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">createVNode</span>(<span class="keyword">type</span>, props, children)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å†çœ‹è¿™æ—¶å€™çš„ type, props, children ä¹Ÿå°±æ˜¯ç”¨æˆ·æ ·ä¾‹</p><p>typeï¼šâ€™divâ€™</p><p>propsï¼š{ id: â€˜rootâ€™, class: [â€˜redâ€™, â€˜hardâ€™] }</p><p>childrenï¼šâ€™hi, mini-vueâ€™</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createVNode</span>(<span class="params"><span class="keyword">type</span>, props, children</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> vnode = &#123;</span><br><span class="line"><span class="keyword">type</span>, <span class="comment">// ä¼ å…¥ç±»å‹</span></span><br><span class="line">props, <span class="comment">// ä¼ å…¥å±æ€§</span></span><br><span class="line">children, <span class="comment">// ä¼ å…¥å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="attr">el</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">component</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">key</span>: props === <span class="literal">null</span> || props === <span class="built_in">void</span> <span class="number">0</span> ? <span class="built_in">void</span> <span class="number">0</span> : props.<span class="property">key</span>, <span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é‚£ä¹ˆæ¥ä¸‹æ¥çš„ <strong><em>subTree</em></strong> ç»“æ„å°±æ˜¯</p><p><strong>type</strong> &#x3D; â€˜divâ€™</p><p><strong>props</strong> &#x3D; { id: â€˜rootâ€™, class: [â€˜redâ€™, â€˜hardâ€™] }</p><p><strong>children</strong> &#x3D; â€˜hi, mini-vueâ€™</p><p><strong>el</strong></p><p><strong>component</strong></p><p><strong>key</strong></p></blockquote><blockquote><p>ä»¥åŠ <strong><em>container</em></strong> ç»“æ„</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span> <span class="attr">class</span>=<span class="string">&quot;red, hard&quot;</span>&gt;</span>hi, mini-vue<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><p>è¿”å› <strong>setupRenderEffect</strong> å‡½æ•°ï¼Œç»§ç»­çœ‹ä¸‹é¢çš„é€»è¾‘</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupRenderEffect</span>(<span class="params"><span class="attr">instance</span>: <span class="built_in">any</span>, <span class="attr">vnode</span>: <span class="built_in">any</span>, <span class="attr">container</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line"><span class="comment">// const &#123; proxy &#125; = instance</span></span><br><span class="line"><span class="comment">// const subTree = instance.render.call(proxy) // æ³¨æ„!æ˜¯è¿™ä¸ªæ—¶å€™å»è°ƒç”¨renderé‡Œçš„hå‡½æ•°äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vnode -&gt; patch</span></span><br><span class="line"><span class="comment">// vnode -&gt; element -&gt; mountElement</span></span><br><span class="line"><span class="title function_">patch</span>(subTree, container) <span class="comment">//ä¼ å…¥subtree container</span></span><br><span class="line">vnode.<span class="property">el</span> = subTree.<span class="property">el</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è°ƒç”¨ <strong><em>patch</em></strong> å›è°ƒæ‹†ç®±</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">type</span> === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// å…ƒç´ åˆ†æ”¯ &lt;-è¿™æ¬¡è¿›è¿™ä¸ª</span></span><br><span class="line"><span class="title function_">processElement</span>(vnode, container) <span class="comment">// æ­¤æ—¶çš„ vnode.type å·²ç»æ˜¯&#x27;div&#x27;äº†</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">type</span> === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// ç»„ä»¶åˆ†æ”¯</span></span><br><span class="line"><span class="title function_">processComponent</span>(vnode)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¿«è¿›åˆ°ä¸‹é¢çš„ processElement å…ƒç´ åˆ†æ”¯</p></blockquote><h5 id="updateComponent-æ›´æ–°åˆ†æ”¯"><a href="#updateComponent-æ›´æ–°åˆ†æ”¯" class="headerlink" title="updateComponent æ›´æ–°åˆ†æ”¯"></a>updateComponent æ›´æ–°åˆ†æ”¯</h5><blockquote><p><strong><em>!!! ç¬¬ä¸€æ¬¡çœ‹å…ˆæ è¿‡è¿™ä¸€éƒ¨åˆ†,å…ˆçœ‹åæ–‡ â€˜processElement å…ƒç´ åˆ†æ”¯â€™ å®ç°æ‹†ç®± !!!</em></strong></p></blockquote><h4 id="processElement-å…ƒç´ åˆ†æ”¯"><a href="#processElement-å…ƒç´ åˆ†æ”¯" class="headerlink" title="processElement å…ƒç´ åˆ†æ”¯"></a>processElement å…ƒç´ åˆ†æ”¯</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="title function_">mountElement</span>(vnode, container)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="mountElement-å…ƒç´ åˆå§‹åŒ–åˆ†æ”¯"><a href="#mountElement-å…ƒç´ åˆå§‹åŒ–åˆ†æ”¯" class="headerlink" title="mountElement å…ƒç´ åˆå§‹åŒ–åˆ†æ”¯"></a>mountElement å…ƒç´ åˆå§‹åŒ–åˆ†æ”¯</h5><blockquote><p>è‹¥ä»¥é¦–æ¬¡æ ·ä¾‹ä¼ å…¥ä¸ºä¾‹ï¼Œè¿›å…¥æ–‡æœ¬èŠ‚ç‚¹</p><p>è‹¥ä»¥äºŒæ¬¡æ ·ä¾‹ä¼ å…¥ä¸ºä¾‹ï¼Œè¿›å…¥æ•°ç»„èŠ‚ç‚¹</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(vnode.<span class="property">type</span>) <span class="comment">// åˆ›å»ºçœŸå®dom &lt;div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="keyword">const</span> &#123; children, props &#125; = vnode</span><br><span class="line"><span class="comment">// (é¦–æ¬¡)è§£æ„ä¸º</span></span><br><span class="line"><span class="comment">// &#x27;hi, mini-vue&#x27;</span></span><br><span class="line"><span class="comment">// &#123; id: &#x27;root&#x27;, class: [&#x27;red&#x27;, &#x27;hard&#x27;] &#125;</span></span><br><span class="line"><span class="comment">// (äºŒæ¬¡)è§£æ„ä¸º</span></span><br><span class="line"><span class="comment">// [h(&#x27;p&#x27;, &#123; class: &#x27;red&#x27; &#125;, &#x27;hi&#x27;), h(&#x27;p&#x27;, &#123; class: &#x27;blue&#x27; &#125;, &#x27;mini-vue&#x27;)]</span></span><br><span class="line"><span class="comment">// &#123; id: &#x27;root&#x27;, class: [&#x27;red&#x27;, &#x27;hard&#x27;] &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> children === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">// æ–‡æœ¬èŠ‚ç‚¹(é¦–æ¬¡æ ·ä¾‹)</span></span><br><span class="line">el.<span class="property">textContent</span> = children <span class="comment">// ç›´æ¥æŠŠ&#x27;hi, mini-vue&#x27;æ’å…¥åˆ°&lt;div&gt;&lt;/div&gt;ä¸‹0ä½å¤„</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(children)) &#123;</span><br><span class="line"><span class="comment">// æ•°ç»„èŠ‚ç‚¹(äºŒæ¬¡æ ·ä¾‹)</span></span><br><span class="line"><span class="title function_">mountChildren</span>(vnode, el) <span class="comment">// æ‹†åˆ†æ•°ç»„ + patchå›è°ƒ (æ­¤æ—¶elæ˜¯&lt;p&gt;,containeræ˜¯&lt;div&gt;)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (props) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> props) &#123;</span><br><span class="line"><span class="comment">// éå†key</span></span><br><span class="line"><span class="keyword">const</span> val = props[key] <span class="comment">// æ‹¿åˆ°å±æ€§å€¼val</span></span><br><span class="line">el.<span class="title function_">setAttribute</span>(key, val) <span class="comment">// Webå†…ç½®API,æŠŠé”®å€¼å¯¹åµŒå…¥divæ ‡ç­¾</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">container.<span class="title function_">append</span>(el) <span class="comment">// Webå†…ç½®API,æŠŠelæŒ‚è½½åˆ°å®¹å™¨ä¸­</span></span><br><span class="line"><span class="comment">// (é¦–æ¬¡)æŒ‚è½½ä¸º</span></span><br><span class="line"><span class="comment">// container : &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment">// el : &lt;div id=&quot;root&quot; class=&quot;red,hard&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment">// (äºŒæ¬¡)æŒ‚è½½ä¸º</span></span><br><span class="line"><span class="comment">// container : &lt;div id=&quot;root&quot; class=&quot;red,hard&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment">// el : &lt;p class=&quot;...&quot;&gt;&lt;/p&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>(é¦–æ¬¡æ ·ä¾‹) for (const key in props) çš„è¿‡ç¨‹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span> <span class="attr">class</span>=<span class="string">&quot;red,hard&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><blockquote><p>(é¦–æ¬¡æ ·ä¾‹) container.append(el) çš„ç»“æœ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- container --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&gt; 0 =</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span> <span class="attr">class</span>=<span class="string">&quot;red, hard&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&gt; &gt; 0 = hi, mini-vue</span><br></pre></td></tr></table></figure></blockquote><p>æ­¤æ—¶è¿”å› <strong><em>setupRenderEffect</em></strong> çš„æœ€åä¸€è¡Œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vnode.<span class="property">el</span> = subTree.<span class="property">el</span></span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶æ‰“å¼€ html ç½‘é¡µï¼Œå°±å¯ä»¥çœ‹åˆ°å±å¹•ä¸Šçš„ hi, mini-vue å­—æ ·äº†</p></blockquote><p><strong><em>!!! äºŒæ¬¡å¤ç›˜ !!!</em></strong></p><blockquote><p>ç°åœ¨æˆ‘ä»¬å°† h çš„ children å‚æ•°æ”¹æˆæ•°ç»„</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title function_">h</span>(</span><br><span class="line"><span class="comment">// åˆ›å»ºè™šæ‹Ÿ DOM èŠ‚ç‚¹,æ¥æ”¶ä¸‰ä¸ªå‚æ•°</span></span><br><span class="line"><span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">&#123; <span class="attr">id</span>: <span class="string">&#x27;root&#x27;</span>, <span class="attr">class</span>: [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;hard&#x27;</span>] &#125;,</span><br><span class="line"><span class="comment">// &#x27;hi, mini-vue&#x27; //stringç±»å‹</span></span><br><span class="line">[<span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;red&#x27;</span> &#125;, <span class="string">&#x27;hi&#x27;</span>), <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;blue&#x27;</span> &#125;, <span class="string">&#x27;mini-vue&#x27;</span>)] <span class="comment">// arrayç±»å‹</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”åœ¨ index.html ä¸­æ·»åŠ  css æ ·å¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.red</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.blue</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">color</span>: blue;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></blockquote><p>è¿˜è®°å¾— children åˆ¤æ–­ç±»å‹çš„åˆ†æ”¯å—ï¼Œå°±åœ¨åˆšå†™çš„ <strong><em>mountElement</em></strong> å‡½æ•°é‡Œï¼Œè¿”å›å»å†çœ‹çœ‹ï¼Œçœ‹å®Œå†å›åˆ°è¿™é‡Œ</p><h6 id="mountChildren"><a href="#mountChildren" class="headerlink" title="mountChildren"></a>mountChildren</h6><blockquote><p>æ‰€ä»¥ç°åœ¨äºŒæ¬¡æ ·ä¾‹ä¸­çš„æ•°æ®å¦‚ä¸‹</p><p><strong>vnode.children</strong> å­èŠ‚ç‚¹æ ‡ç­¾æ•°ç»„</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;[<span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;red&#x27;</span> &#125;, <span class="string">&#x27;hi&#x27;</span>), <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;blue&#x27;</span> &#125;, <span class="string">&#x27;mini-vue&#x27;</span>)]</span><br></pre></td></tr></table></figure><p><strong>container</strong> æ ¹å®¹å™¨</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountChildren</span>(<span class="params"><span class="attr">vnode</span>: <span class="built_in">any</span>, <span class="attr">container</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">vnode.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params"><span class="attr">v</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">patch</span>(v, container) <span class="comment">// é€’å½’å¤„ç†children</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å–å‡ºæ¥çš„ <strong><em>v</em></strong> ä¾æ­¤æ˜¯</p><table><thead><tr><th align="center"></th><th align="center">ç¬¬ä¸€æ¬¡ (è°ƒç”¨ h)</th><th align="center">ç¬¬äºŒæ¬¡ (è°ƒç”¨ h)</th></tr></thead><tbody><tr><td align="center"><strong>type</strong></td><td align="center">p</td><td align="center">p</td></tr><tr><td align="center"><strong>props</strong></td><td align="center">{ class: â€˜ red â€˜ }</td><td align="center">{ class: â€˜ blue â€˜ }</td></tr><tr><td align="center"><strong>children</strong></td><td align="center">â€˜ hi â€˜</td><td align="center">â€˜ mini-vue â€˜</td></tr></tbody></table></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ·±å…¥å‰ç«¯ </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
